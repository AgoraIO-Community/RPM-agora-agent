function _mergeNamespaces(nt,_){for(var tt=0;tt<_.length;tt++){const ot=_[tt];if(typeof ot!="string"&&!Array.isArray(ot)){for(const st in ot)if(st!=="default"&&!(st in nt)){const at=Object.getOwnPropertyDescriptor(ot,st);at&&Object.defineProperty(nt,st,at.get?at:{enumerable:!0,get:()=>ot[st]})}}}return Object.freeze(Object.defineProperty(nt,Symbol.toStringTag,{value:"Module"}))}(function(){const _=document.createElement("link").relList;if(_&&_.supports&&_.supports("modulepreload"))return;for(const st of document.querySelectorAll('link[rel="modulepreload"]'))ot(st);new MutationObserver(st=>{for(const at of st)if(at.type==="childList")for(const lt of at.addedNodes)lt.tagName==="LINK"&&lt.rel==="modulepreload"&&ot(lt)}).observe(document,{childList:!0,subtree:!0});function tt(st){const at={};return st.integrity&&(at.integrity=st.integrity),st.referrerPolicy&&(at.referrerPolicy=st.referrerPolicy),st.crossOrigin==="use-credentials"?at.credentials="include":st.crossOrigin==="anonymous"?at.credentials="omit":at.credentials="same-origin",at}function ot(st){if(st.ep)return;st.ep=!0;const at=tt(st);fetch(st.href,at)}})();var commonjsGlobal=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function getDefaultExportFromCjs(nt){return nt&&nt.__esModule&&Object.prototype.hasOwnProperty.call(nt,"default")?nt.default:nt}var jsxRuntime={exports:{}},reactJsxRuntime_production_min={},react={exports:{}},react_production_min={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var l$5=Symbol.for("react.element"),n$5=Symbol.for("react.portal"),p$7=Symbol.for("react.fragment"),q$3=Symbol.for("react.strict_mode"),r$4=Symbol.for("react.profiler"),t$3=Symbol.for("react.provider"),u$5=Symbol.for("react.context"),v$5=Symbol.for("react.forward_ref"),w$3=Symbol.for("react.suspense"),x$5=Symbol.for("react.memo"),y$5=Symbol.for("react.lazy"),z$3=Symbol.iterator;function A$3(nt){return nt===null||typeof nt!="object"?null:(nt=z$3&&nt[z$3]||nt["@@iterator"],typeof nt=="function"?nt:null)}var B$2={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},C$3=Object.assign,D$5={};function E$4(nt,_,tt){this.props=nt,this.context=_,this.refs=D$5,this.updater=tt||B$2}E$4.prototype.isReactComponent={};E$4.prototype.setState=function(nt,_){if(typeof nt!="object"&&typeof nt!="function"&&nt!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,nt,_,"setState")};E$4.prototype.forceUpdate=function(nt){this.updater.enqueueForceUpdate(this,nt,"forceUpdate")};function F$2(){}F$2.prototype=E$4.prototype;function G$2(nt,_,tt){this.props=nt,this.context=_,this.refs=D$5,this.updater=tt||B$2}var H$4=G$2.prototype=new F$2;H$4.constructor=G$2;C$3(H$4,E$4.prototype);H$4.isPureReactComponent=!0;var I$4=Array.isArray,J$2=Object.prototype.hasOwnProperty,K$1={current:null},L$5={key:!0,ref:!0,__self:!0,__source:!0};function M$3(nt,_,tt){var ot,st={},at=null,lt=null;if(_!=null)for(ot in _.ref!==void 0&&(lt=_.ref),_.key!==void 0&&(at=""+_.key),_)J$2.call(_,ot)&&!L$5.hasOwnProperty(ot)&&(st[ot]=_[ot]);var dt=arguments.length-2;if(dt===1)st.children=tt;else if(1<dt){for(var ht=Array(dt),ft=0;ft<dt;ft++)ht[ft]=arguments[ft+2];st.children=ht}if(nt&&nt.defaultProps)for(ot in dt=nt.defaultProps,dt)st[ot]===void 0&&(st[ot]=dt[ot]);return{$$typeof:l$5,type:nt,key:at,ref:lt,props:st,_owner:K$1.current}}function N$4(nt,_){return{$$typeof:l$5,type:nt.type,key:_,ref:nt.ref,props:nt.props,_owner:nt._owner}}function O$3(nt){return typeof nt=="object"&&nt!==null&&nt.$$typeof===l$5}function escape$1(nt){var _={"=":"=0",":":"=2"};return"$"+nt.replace(/[=:]/g,function(tt){return _[tt]})}var P$3=/\/+/g;function Q$2(nt,_){return typeof nt=="object"&&nt!==null&&nt.key!=null?escape$1(""+nt.key):_.toString(36)}function R$4(nt,_,tt,ot,st){var at=typeof nt;(at==="undefined"||at==="boolean")&&(nt=null);var lt=!1;if(nt===null)lt=!0;else switch(at){case"string":case"number":lt=!0;break;case"object":switch(nt.$$typeof){case l$5:case n$5:lt=!0}}if(lt)return lt=nt,st=st(lt),nt=ot===""?"."+Q$2(lt,0):ot,I$4(st)?(tt="",nt!=null&&(tt=nt.replace(P$3,"$&/")+"/"),R$4(st,_,tt,"",function(ft){return ft})):st!=null&&(O$3(st)&&(st=N$4(st,tt+(!st.key||lt&&lt.key===st.key?"":(""+st.key).replace(P$3,"$&/")+"/")+nt)),_.push(st)),1;if(lt=0,ot=ot===""?".":ot+":",I$4(nt))for(var dt=0;dt<nt.length;dt++){at=nt[dt];var ht=ot+Q$2(at,dt);lt+=R$4(at,_,tt,ht,st)}else if(ht=A$3(nt),typeof ht=="function")for(nt=ht.call(nt),dt=0;!(at=nt.next()).done;)at=at.value,ht=ot+Q$2(at,dt++),lt+=R$4(at,_,tt,ht,st);else if(at==="object")throw _=String(nt),Error("Objects are not valid as a React child (found: "+(_==="[object Object]"?"object with keys {"+Object.keys(nt).join(", ")+"}":_)+"). If you meant to render a collection of children, use an array instead.");return lt}function S$5(nt,_,tt){if(nt==null)return nt;var ot=[],st=0;return R$4(nt,ot,"","",function(at){return _.call(tt,at,st++)}),ot}function T$5(nt){if(nt._status===-1){var _=nt._result;_=_(),_.then(function(tt){(nt._status===0||nt._status===-1)&&(nt._status=1,nt._result=tt)},function(tt){(nt._status===0||nt._status===-1)&&(nt._status=2,nt._result=tt)}),nt._status===-1&&(nt._status=0,nt._result=_)}if(nt._status===1)return nt._result.default;throw nt._result}var U$3={current:null},V$4={transition:null},W$4={ReactCurrentDispatcher:U$3,ReactCurrentBatchConfig:V$4,ReactCurrentOwner:K$1};function X$2(){throw Error("act(...) is not supported in production builds of React.")}react_production_min.Children={map:S$5,forEach:function(nt,_,tt){S$5(nt,function(){_.apply(this,arguments)},tt)},count:function(nt){var _=0;return S$5(nt,function(){_++}),_},toArray:function(nt){return S$5(nt,function(_){return _})||[]},only:function(nt){if(!O$3(nt))throw Error("React.Children.only expected to receive a single React element child.");return nt}};react_production_min.Component=E$4;react_production_min.Fragment=p$7;react_production_min.Profiler=r$4;react_production_min.PureComponent=G$2;react_production_min.StrictMode=q$3;react_production_min.Suspense=w$3;react_production_min.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=W$4;react_production_min.act=X$2;react_production_min.cloneElement=function(nt,_,tt){if(nt==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+nt+".");var ot=C$3({},nt.props),st=nt.key,at=nt.ref,lt=nt._owner;if(_!=null){if(_.ref!==void 0&&(at=_.ref,lt=K$1.current),_.key!==void 0&&(st=""+_.key),nt.type&&nt.type.defaultProps)var dt=nt.type.defaultProps;for(ht in _)J$2.call(_,ht)&&!L$5.hasOwnProperty(ht)&&(ot[ht]=_[ht]===void 0&&dt!==void 0?dt[ht]:_[ht])}var ht=arguments.length-2;if(ht===1)ot.children=tt;else if(1<ht){dt=Array(ht);for(var ft=0;ft<ht;ft++)dt[ft]=arguments[ft+2];ot.children=dt}return{$$typeof:l$5,type:nt.type,key:st,ref:at,props:ot,_owner:lt}};react_production_min.createContext=function(nt){return nt={$$typeof:u$5,_currentValue:nt,_currentValue2:nt,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},nt.Provider={$$typeof:t$3,_context:nt},nt.Consumer=nt};react_production_min.createElement=M$3;react_production_min.createFactory=function(nt){var _=M$3.bind(null,nt);return _.type=nt,_};react_production_min.createRef=function(){return{current:null}};react_production_min.forwardRef=function(nt){return{$$typeof:v$5,render:nt}};react_production_min.isValidElement=O$3;react_production_min.lazy=function(nt){return{$$typeof:y$5,_payload:{_status:-1,_result:nt},_init:T$5}};react_production_min.memo=function(nt,_){return{$$typeof:x$5,type:nt,compare:_===void 0?null:_}};react_production_min.startTransition=function(nt){var _=V$4.transition;V$4.transition={};try{nt()}finally{V$4.transition=_}};react_production_min.unstable_act=X$2;react_production_min.useCallback=function(nt,_){return U$3.current.useCallback(nt,_)};react_production_min.useContext=function(nt){return U$3.current.useContext(nt)};react_production_min.useDebugValue=function(){};react_production_min.useDeferredValue=function(nt){return U$3.current.useDeferredValue(nt)};react_production_min.useEffect=function(nt,_){return U$3.current.useEffect(nt,_)};react_production_min.useId=function(){return U$3.current.useId()};react_production_min.useImperativeHandle=function(nt,_,tt){return U$3.current.useImperativeHandle(nt,_,tt)};react_production_min.useInsertionEffect=function(nt,_){return U$3.current.useInsertionEffect(nt,_)};react_production_min.useLayoutEffect=function(nt,_){return U$3.current.useLayoutEffect(nt,_)};react_production_min.useMemo=function(nt,_){return U$3.current.useMemo(nt,_)};react_production_min.useReducer=function(nt,_,tt){return U$3.current.useReducer(nt,_,tt)};react_production_min.useRef=function(nt){return U$3.current.useRef(nt)};react_production_min.useState=function(nt){return U$3.current.useState(nt)};react_production_min.useSyncExternalStore=function(nt,_,tt){return U$3.current.useSyncExternalStore(nt,_,tt)};react_production_min.useTransition=function(){return U$3.current.useTransition()};react_production_min.version="18.3.1";react.exports=react_production_min;var reactExports=react.exports;const React=getDefaultExportFromCjs(reactExports),$2AODx$react=_mergeNamespaces({__proto__:null,default:React},[reactExports]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var f$5=reactExports,k$5=Symbol.for("react.element"),l$4=Symbol.for("react.fragment"),m$6=Object.prototype.hasOwnProperty,n$4=f$5.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,p$6={key:!0,ref:!0,__self:!0,__source:!0};function q$2(nt,_,tt){var ot,st={},at=null,lt=null;tt!==void 0&&(at=""+tt),_.key!==void 0&&(at=""+_.key),_.ref!==void 0&&(lt=_.ref);for(ot in _)m$6.call(_,ot)&&!p$6.hasOwnProperty(ot)&&(st[ot]=_[ot]);if(nt&&nt.defaultProps)for(ot in _=nt.defaultProps,_)st[ot]===void 0&&(st[ot]=_[ot]);return{$$typeof:k$5,type:nt,key:at,ref:lt,props:st,_owner:n$4.current}}reactJsxRuntime_production_min.Fragment=l$4;reactJsxRuntime_production_min.jsx=q$2;reactJsxRuntime_production_min.jsxs=q$2;jsxRuntime.exports=reactJsxRuntime_production_min;var jsxRuntimeExports=jsxRuntime.exports;const Fragment=jsxRuntimeExports.Fragment,jsx=jsxRuntimeExports.jsx,jsxs=jsxRuntimeExports.jsxs;var client={},reactDom={exports:{}},reactDom_production_min={},scheduler$1={exports:{}},scheduler_production_min$1={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(nt){function _(yn,An){var Sn=yn.length;yn.push(An);e:for(;0<Sn;){var gn=Sn-1>>>1,_n=yn[gn];if(0<st(_n,An))yn[gn]=An,yn[Sn]=_n,Sn=gn;else break e}}function tt(yn){return yn.length===0?null:yn[0]}function ot(yn){if(yn.length===0)return null;var An=yn[0],Sn=yn.pop();if(Sn!==An){yn[0]=Sn;e:for(var gn=0,_n=yn.length,Rn=_n>>>1;gn<Rn;){var bn=2*(gn+1)-1,jn=yn[bn],kn=bn+1,Gn=yn[kn];if(0>st(jn,Sn))kn<_n&&0>st(Gn,jn)?(yn[gn]=Gn,yn[kn]=Sn,gn=kn):(yn[gn]=jn,yn[bn]=Sn,gn=bn);else if(kn<_n&&0>st(Gn,Sn))yn[gn]=Gn,yn[kn]=Sn,gn=kn;else break e}}return An}function st(yn,An){var Sn=yn.sortIndex-An.sortIndex;return Sn!==0?Sn:yn.id-An.id}if(typeof performance=="object"&&typeof performance.now=="function"){var at=performance;nt.unstable_now=function(){return at.now()}}else{var lt=Date,dt=lt.now();nt.unstable_now=function(){return lt.now()-dt}}var ht=[],ft=[],gt=1,Et=null,yt=3,Ct=!1,wt=!1,It=!1,Pt=typeof setTimeout=="function"?setTimeout:null,Rt=typeof clearTimeout=="function"?clearTimeout:null,xt=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function Nt(yn){for(var An=tt(ft);An!==null;){if(An.callback===null)ot(ft);else if(An.startTime<=yn)ot(ft),An.sortIndex=An.expirationTime,_(ht,An);else break;An=tt(ft)}}function kt(yn){if(It=!1,Nt(yn),!wt)if(tt(ht)!==null)wt=!0,On(Vt);else{var An=tt(ft);An!==null&&Pn(kt,An.startTime-yn)}}function Vt(yn,An){wt=!1,It&&(It=!1,Rt(Yt),Yt=-1),Ct=!0;var Sn=yt;try{for(Nt(An),Et=tt(ht);Et!==null&&(!(Et.expirationTime>An)||yn&&!pn());){var gn=Et.callback;if(typeof gn=="function"){Et.callback=null,yt=Et.priorityLevel;var _n=gn(Et.expirationTime<=An);An=nt.unstable_now(),typeof _n=="function"?Et.callback=_n:Et===tt(ht)&&ot(ht),Nt(An)}else ot(ht);Et=tt(ht)}if(Et!==null)var Rn=!0;else{var bn=tt(ft);bn!==null&&Pn(kt,bn.startTime-An),Rn=!1}return Rn}finally{Et=null,yt=Sn,Ct=!1}}var Ft=!1,zt=null,Yt=-1,Kt=5,qt=-1;function pn(){return!(nt.unstable_now()-qt<Kt)}function an(){if(zt!==null){var yn=nt.unstable_now();qt=yn;var An=!0;try{An=zt(!0,yn)}finally{An?fn():(Ft=!1,zt=null)}}else Ft=!1}var fn;if(typeof xt=="function")fn=function(){xt(an)};else if(typeof MessageChannel<"u"){var dn=new MessageChannel,Cn=dn.port2;dn.port1.onmessage=an,fn=function(){Cn.postMessage(null)}}else fn=function(){Pt(an,0)};function On(yn){zt=yn,Ft||(Ft=!0,fn())}function Pn(yn,An){Yt=Pt(function(){yn(nt.unstable_now())},An)}nt.unstable_IdlePriority=5,nt.unstable_ImmediatePriority=1,nt.unstable_LowPriority=4,nt.unstable_NormalPriority=3,nt.unstable_Profiling=null,nt.unstable_UserBlockingPriority=2,nt.unstable_cancelCallback=function(yn){yn.callback=null},nt.unstable_continueExecution=function(){wt||Ct||(wt=!0,On(Vt))},nt.unstable_forceFrameRate=function(yn){0>yn||125<yn?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Kt=0<yn?Math.floor(1e3/yn):5},nt.unstable_getCurrentPriorityLevel=function(){return yt},nt.unstable_getFirstCallbackNode=function(){return tt(ht)},nt.unstable_next=function(yn){switch(yt){case 1:case 2:case 3:var An=3;break;default:An=yt}var Sn=yt;yt=An;try{return yn()}finally{yt=Sn}},nt.unstable_pauseExecution=function(){},nt.unstable_requestPaint=function(){},nt.unstable_runWithPriority=function(yn,An){switch(yn){case 1:case 2:case 3:case 4:case 5:break;default:yn=3}var Sn=yt;yt=yn;try{return An()}finally{yt=Sn}},nt.unstable_scheduleCallback=function(yn,An,Sn){var gn=nt.unstable_now();switch(typeof Sn=="object"&&Sn!==null?(Sn=Sn.delay,Sn=typeof Sn=="number"&&0<Sn?gn+Sn:gn):Sn=gn,yn){case 1:var _n=-1;break;case 2:_n=250;break;case 5:_n=1073741823;break;case 4:_n=1e4;break;default:_n=5e3}return _n=Sn+_n,yn={id:gt++,callback:An,priorityLevel:yn,startTime:Sn,expirationTime:_n,sortIndex:-1},Sn>gn?(yn.sortIndex=Sn,_(ft,yn),tt(ht)===null&&yn===tt(ft)&&(It?(Rt(Yt),Yt=-1):It=!0,Pn(kt,Sn-gn))):(yn.sortIndex=_n,_(ht,yn),wt||Ct||(wt=!0,On(Vt))),yn},nt.unstable_shouldYield=pn,nt.unstable_wrapCallback=function(yn){var An=yt;return function(){var Sn=yt;yt=An;try{return yn.apply(this,arguments)}finally{yt=Sn}}}})(scheduler_production_min$1);scheduler$1.exports=scheduler_production_min$1;var schedulerExports$1=scheduler$1.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var aa=reactExports,ca=schedulerExports$1;function p$5(nt){for(var _="https://reactjs.org/docs/error-decoder.html?invariant="+nt,tt=1;tt<arguments.length;tt++)_+="&args[]="+encodeURIComponent(arguments[tt]);return"Minified React error #"+nt+"; visit "+_+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var da=new Set,ea={};function fa(nt,_){ha(nt,_),ha(nt+"Capture",_)}function ha(nt,_){for(ea[nt]=_,nt=0;nt<_.length;nt++)da.add(_[nt])}var ia=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),ja=Object.prototype.hasOwnProperty,ka=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,la={},ma={};function oa(nt){return ja.call(ma,nt)?!0:ja.call(la,nt)?!1:ka.test(nt)?ma[nt]=!0:(la[nt]=!0,!1)}function pa(nt,_,tt,ot){if(tt!==null&&tt.type===0)return!1;switch(typeof _){case"function":case"symbol":return!0;case"boolean":return ot?!1:tt!==null?!tt.acceptsBooleans:(nt=nt.toLowerCase().slice(0,5),nt!=="data-"&&nt!=="aria-");default:return!1}}function qa(nt,_,tt,ot){if(_===null||typeof _>"u"||pa(nt,_,tt,ot))return!0;if(ot)return!1;if(tt!==null)switch(tt.type){case 3:return!_;case 4:return _===!1;case 5:return isNaN(_);case 6:return isNaN(_)||1>_}return!1}function v$4(nt,_,tt,ot,st,at,lt){this.acceptsBooleans=_===2||_===3||_===4,this.attributeName=ot,this.attributeNamespace=st,this.mustUseProperty=tt,this.propertyName=nt,this.type=_,this.sanitizeURL=at,this.removeEmptyString=lt}var z$2={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(nt){z$2[nt]=new v$4(nt,0,!1,nt,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(nt){var _=nt[0];z$2[_]=new v$4(_,1,!1,nt[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(nt){z$2[nt]=new v$4(nt,2,!1,nt.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(nt){z$2[nt]=new v$4(nt,2,!1,nt,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(nt){z$2[nt]=new v$4(nt,3,!1,nt.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(nt){z$2[nt]=new v$4(nt,3,!0,nt,null,!1,!1)});["capture","download"].forEach(function(nt){z$2[nt]=new v$4(nt,4,!1,nt,null,!1,!1)});["cols","rows","size","span"].forEach(function(nt){z$2[nt]=new v$4(nt,6,!1,nt,null,!1,!1)});["rowSpan","start"].forEach(function(nt){z$2[nt]=new v$4(nt,5,!1,nt.toLowerCase(),null,!1,!1)});var ra=/[\-:]([a-z])/g;function sa(nt){return nt[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(nt){var _=nt.replace(ra,sa);z$2[_]=new v$4(_,1,!1,nt,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(nt){var _=nt.replace(ra,sa);z$2[_]=new v$4(_,1,!1,nt,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(nt){var _=nt.replace(ra,sa);z$2[_]=new v$4(_,1,!1,nt,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(nt){z$2[nt]=new v$4(nt,1,!1,nt.toLowerCase(),null,!1,!1)});z$2.xlinkHref=new v$4("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(nt){z$2[nt]=new v$4(nt,1,!1,nt.toLowerCase(),null,!0,!0)});function ta(nt,_,tt,ot){var st=z$2.hasOwnProperty(_)?z$2[_]:null;(st!==null?st.type!==0:ot||!(2<_.length)||_[0]!=="o"&&_[0]!=="O"||_[1]!=="n"&&_[1]!=="N")&&(qa(_,tt,st,ot)&&(tt=null),ot||st===null?oa(_)&&(tt===null?nt.removeAttribute(_):nt.setAttribute(_,""+tt)):st.mustUseProperty?nt[st.propertyName]=tt===null?st.type===3?!1:"":tt:(_=st.attributeName,ot=st.attributeNamespace,tt===null?nt.removeAttribute(_):(st=st.type,tt=st===3||st===4&&tt===!0?"":""+tt,ot?nt.setAttributeNS(ot,_,tt):nt.setAttribute(_,tt))))}var ua=aa.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,va=Symbol.for("react.element"),wa=Symbol.for("react.portal"),ya=Symbol.for("react.fragment"),za=Symbol.for("react.strict_mode"),Aa=Symbol.for("react.profiler"),Ba=Symbol.for("react.provider"),Ca=Symbol.for("react.context"),Da=Symbol.for("react.forward_ref"),Ea=Symbol.for("react.suspense"),Fa=Symbol.for("react.suspense_list"),Ga=Symbol.for("react.memo"),Ha=Symbol.for("react.lazy"),Ia=Symbol.for("react.offscreen"),Ja=Symbol.iterator;function Ka(nt){return nt===null||typeof nt!="object"?null:(nt=Ja&&nt[Ja]||nt["@@iterator"],typeof nt=="function"?nt:null)}var A$2=Object.assign,La;function Ma(nt){if(La===void 0)try{throw Error()}catch(tt){var _=tt.stack.trim().match(/\n( *(at )?)/);La=_&&_[1]||""}return`
`+La+nt}var Na=!1;function Oa(nt,_){if(!nt||Na)return"";Na=!0;var tt=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(_)if(_=function(){throw Error()},Object.defineProperty(_.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(_,[])}catch(ft){var ot=ft}Reflect.construct(nt,[],_)}else{try{_.call()}catch(ft){ot=ft}nt.call(_.prototype)}else{try{throw Error()}catch(ft){ot=ft}nt()}}catch(ft){if(ft&&ot&&typeof ft.stack=="string"){for(var st=ft.stack.split(`
`),at=ot.stack.split(`
`),lt=st.length-1,dt=at.length-1;1<=lt&&0<=dt&&st[lt]!==at[dt];)dt--;for(;1<=lt&&0<=dt;lt--,dt--)if(st[lt]!==at[dt]){if(lt!==1||dt!==1)do if(lt--,dt--,0>dt||st[lt]!==at[dt]){var ht=`
`+st[lt].replace(" at new "," at ");return nt.displayName&&ht.includes("<anonymous>")&&(ht=ht.replace("<anonymous>",nt.displayName)),ht}while(1<=lt&&0<=dt);break}}}finally{Na=!1,Error.prepareStackTrace=tt}return(nt=nt?nt.displayName||nt.name:"")?Ma(nt):""}function Pa(nt){switch(nt.tag){case 5:return Ma(nt.type);case 16:return Ma("Lazy");case 13:return Ma("Suspense");case 19:return Ma("SuspenseList");case 0:case 2:case 15:return nt=Oa(nt.type,!1),nt;case 11:return nt=Oa(nt.type.render,!1),nt;case 1:return nt=Oa(nt.type,!0),nt;default:return""}}function Qa(nt){if(nt==null)return null;if(typeof nt=="function")return nt.displayName||nt.name||null;if(typeof nt=="string")return nt;switch(nt){case ya:return"Fragment";case wa:return"Portal";case Aa:return"Profiler";case za:return"StrictMode";case Ea:return"Suspense";case Fa:return"SuspenseList"}if(typeof nt=="object")switch(nt.$$typeof){case Ca:return(nt.displayName||"Context")+".Consumer";case Ba:return(nt._context.displayName||"Context")+".Provider";case Da:var _=nt.render;return nt=nt.displayName,nt||(nt=_.displayName||_.name||"",nt=nt!==""?"ForwardRef("+nt+")":"ForwardRef"),nt;case Ga:return _=nt.displayName||null,_!==null?_:Qa(nt.type)||"Memo";case Ha:_=nt._payload,nt=nt._init;try{return Qa(nt(_))}catch{}}return null}function Ra(nt){var _=nt.type;switch(nt.tag){case 24:return"Cache";case 9:return(_.displayName||"Context")+".Consumer";case 10:return(_._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return nt=_.render,nt=nt.displayName||nt.name||"",_.displayName||(nt!==""?"ForwardRef("+nt+")":"ForwardRef");case 7:return"Fragment";case 5:return _;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Qa(_);case 8:return _===za?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof _=="function")return _.displayName||_.name||null;if(typeof _=="string")return _}return null}function Sa(nt){switch(typeof nt){case"boolean":case"number":case"string":case"undefined":return nt;case"object":return nt;default:return""}}function Ta(nt){var _=nt.type;return(nt=nt.nodeName)&&nt.toLowerCase()==="input"&&(_==="checkbox"||_==="radio")}function Ua(nt){var _=Ta(nt)?"checked":"value",tt=Object.getOwnPropertyDescriptor(nt.constructor.prototype,_),ot=""+nt[_];if(!nt.hasOwnProperty(_)&&typeof tt<"u"&&typeof tt.get=="function"&&typeof tt.set=="function"){var st=tt.get,at=tt.set;return Object.defineProperty(nt,_,{configurable:!0,get:function(){return st.call(this)},set:function(lt){ot=""+lt,at.call(this,lt)}}),Object.defineProperty(nt,_,{enumerable:tt.enumerable}),{getValue:function(){return ot},setValue:function(lt){ot=""+lt},stopTracking:function(){nt._valueTracker=null,delete nt[_]}}}}function Va(nt){nt._valueTracker||(nt._valueTracker=Ua(nt))}function Wa(nt){if(!nt)return!1;var _=nt._valueTracker;if(!_)return!0;var tt=_.getValue(),ot="";return nt&&(ot=Ta(nt)?nt.checked?"true":"false":nt.value),nt=ot,nt!==tt?(_.setValue(nt),!0):!1}function Xa(nt){if(nt=nt||(typeof document<"u"?document:void 0),typeof nt>"u")return null;try{return nt.activeElement||nt.body}catch{return nt.body}}function Ya(nt,_){var tt=_.checked;return A$2({},_,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:tt??nt._wrapperState.initialChecked})}function Za(nt,_){var tt=_.defaultValue==null?"":_.defaultValue,ot=_.checked!=null?_.checked:_.defaultChecked;tt=Sa(_.value!=null?_.value:tt),nt._wrapperState={initialChecked:ot,initialValue:tt,controlled:_.type==="checkbox"||_.type==="radio"?_.checked!=null:_.value!=null}}function ab(nt,_){_=_.checked,_!=null&&ta(nt,"checked",_,!1)}function bb(nt,_){ab(nt,_);var tt=Sa(_.value),ot=_.type;if(tt!=null)ot==="number"?(tt===0&&nt.value===""||nt.value!=tt)&&(nt.value=""+tt):nt.value!==""+tt&&(nt.value=""+tt);else if(ot==="submit"||ot==="reset"){nt.removeAttribute("value");return}_.hasOwnProperty("value")?cb(nt,_.type,tt):_.hasOwnProperty("defaultValue")&&cb(nt,_.type,Sa(_.defaultValue)),_.checked==null&&_.defaultChecked!=null&&(nt.defaultChecked=!!_.defaultChecked)}function db(nt,_,tt){if(_.hasOwnProperty("value")||_.hasOwnProperty("defaultValue")){var ot=_.type;if(!(ot!=="submit"&&ot!=="reset"||_.value!==void 0&&_.value!==null))return;_=""+nt._wrapperState.initialValue,tt||_===nt.value||(nt.value=_),nt.defaultValue=_}tt=nt.name,tt!==""&&(nt.name=""),nt.defaultChecked=!!nt._wrapperState.initialChecked,tt!==""&&(nt.name=tt)}function cb(nt,_,tt){(_!=="number"||Xa(nt.ownerDocument)!==nt)&&(tt==null?nt.defaultValue=""+nt._wrapperState.initialValue:nt.defaultValue!==""+tt&&(nt.defaultValue=""+tt))}var eb=Array.isArray;function fb(nt,_,tt,ot){if(nt=nt.options,_){_={};for(var st=0;st<tt.length;st++)_["$"+tt[st]]=!0;for(tt=0;tt<nt.length;tt++)st=_.hasOwnProperty("$"+nt[tt].value),nt[tt].selected!==st&&(nt[tt].selected=st),st&&ot&&(nt[tt].defaultSelected=!0)}else{for(tt=""+Sa(tt),_=null,st=0;st<nt.length;st++){if(nt[st].value===tt){nt[st].selected=!0,ot&&(nt[st].defaultSelected=!0);return}_!==null||nt[st].disabled||(_=nt[st])}_!==null&&(_.selected=!0)}}function gb(nt,_){if(_.dangerouslySetInnerHTML!=null)throw Error(p$5(91));return A$2({},_,{value:void 0,defaultValue:void 0,children:""+nt._wrapperState.initialValue})}function hb(nt,_){var tt=_.value;if(tt==null){if(tt=_.children,_=_.defaultValue,tt!=null){if(_!=null)throw Error(p$5(92));if(eb(tt)){if(1<tt.length)throw Error(p$5(93));tt=tt[0]}_=tt}_==null&&(_=""),tt=_}nt._wrapperState={initialValue:Sa(tt)}}function ib(nt,_){var tt=Sa(_.value),ot=Sa(_.defaultValue);tt!=null&&(tt=""+tt,tt!==nt.value&&(nt.value=tt),_.defaultValue==null&&nt.defaultValue!==tt&&(nt.defaultValue=tt)),ot!=null&&(nt.defaultValue=""+ot)}function jb(nt){var _=nt.textContent;_===nt._wrapperState.initialValue&&_!==""&&_!==null&&(nt.value=_)}function kb(nt){switch(nt){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function lb(nt,_){return nt==null||nt==="http://www.w3.org/1999/xhtml"?kb(_):nt==="http://www.w3.org/2000/svg"&&_==="foreignObject"?"http://www.w3.org/1999/xhtml":nt}var mb,nb=function(nt){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(_,tt,ot,st){MSApp.execUnsafeLocalFunction(function(){return nt(_,tt,ot,st)})}:nt}(function(nt,_){if(nt.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in nt)nt.innerHTML=_;else{for(mb=mb||document.createElement("div"),mb.innerHTML="<svg>"+_.valueOf().toString()+"</svg>",_=mb.firstChild;nt.firstChild;)nt.removeChild(nt.firstChild);for(;_.firstChild;)nt.appendChild(_.firstChild)}});function ob(nt,_){if(_){var tt=nt.firstChild;if(tt&&tt===nt.lastChild&&tt.nodeType===3){tt.nodeValue=_;return}}nt.textContent=_}var pb={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},qb=["Webkit","ms","Moz","O"];Object.keys(pb).forEach(function(nt){qb.forEach(function(_){_=_+nt.charAt(0).toUpperCase()+nt.substring(1),pb[_]=pb[nt]})});function rb(nt,_,tt){return _==null||typeof _=="boolean"||_===""?"":tt||typeof _!="number"||_===0||pb.hasOwnProperty(nt)&&pb[nt]?(""+_).trim():_+"px"}function sb(nt,_){nt=nt.style;for(var tt in _)if(_.hasOwnProperty(tt)){var ot=tt.indexOf("--")===0,st=rb(tt,_[tt],ot);tt==="float"&&(tt="cssFloat"),ot?nt.setProperty(tt,st):nt[tt]=st}}var tb=A$2({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function ub(nt,_){if(_){if(tb[nt]&&(_.children!=null||_.dangerouslySetInnerHTML!=null))throw Error(p$5(137,nt));if(_.dangerouslySetInnerHTML!=null){if(_.children!=null)throw Error(p$5(60));if(typeof _.dangerouslySetInnerHTML!="object"||!("__html"in _.dangerouslySetInnerHTML))throw Error(p$5(61))}if(_.style!=null&&typeof _.style!="object")throw Error(p$5(62))}}function vb(nt,_){if(nt.indexOf("-")===-1)return typeof _.is=="string";switch(nt){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var wb=null;function xb(nt){return nt=nt.target||nt.srcElement||window,nt.correspondingUseElement&&(nt=nt.correspondingUseElement),nt.nodeType===3?nt.parentNode:nt}var yb=null,zb=null,Ab=null;function Bb(nt){if(nt=Cb(nt)){if(typeof yb!="function")throw Error(p$5(280));var _=nt.stateNode;_&&(_=Db(_),yb(nt.stateNode,nt.type,_))}}function Eb(nt){zb?Ab?Ab.push(nt):Ab=[nt]:zb=nt}function Fb(){if(zb){var nt=zb,_=Ab;if(Ab=zb=null,Bb(nt),_)for(nt=0;nt<_.length;nt++)Bb(_[nt])}}function Gb(nt,_){return nt(_)}function Hb(){}var Ib=!1;function Jb(nt,_,tt){if(Ib)return nt(_,tt);Ib=!0;try{return Gb(nt,_,tt)}finally{Ib=!1,(zb!==null||Ab!==null)&&(Hb(),Fb())}}function Kb(nt,_){var tt=nt.stateNode;if(tt===null)return null;var ot=Db(tt);if(ot===null)return null;tt=ot[_];e:switch(_){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(ot=!ot.disabled)||(nt=nt.type,ot=!(nt==="button"||nt==="input"||nt==="select"||nt==="textarea")),nt=!ot;break e;default:nt=!1}if(nt)return null;if(tt&&typeof tt!="function")throw Error(p$5(231,_,typeof tt));return tt}var Lb=!1;if(ia)try{var Mb={};Object.defineProperty(Mb,"passive",{get:function(){Lb=!0}}),window.addEventListener("test",Mb,Mb),window.removeEventListener("test",Mb,Mb)}catch{Lb=!1}function Nb(nt,_,tt,ot,st,at,lt,dt,ht){var ft=Array.prototype.slice.call(arguments,3);try{_.apply(tt,ft)}catch(gt){this.onError(gt)}}var Ob=!1,Pb=null,Qb=!1,Rb=null,Sb={onError:function(nt){Ob=!0,Pb=nt}};function Tb(nt,_,tt,ot,st,at,lt,dt,ht){Ob=!1,Pb=null,Nb.apply(Sb,arguments)}function Ub(nt,_,tt,ot,st,at,lt,dt,ht){if(Tb.apply(this,arguments),Ob){if(Ob){var ft=Pb;Ob=!1,Pb=null}else throw Error(p$5(198));Qb||(Qb=!0,Rb=ft)}}function Vb(nt){var _=nt,tt=nt;if(nt.alternate)for(;_.return;)_=_.return;else{nt=_;do _=nt,_.flags&4098&&(tt=_.return),nt=_.return;while(nt)}return _.tag===3?tt:null}function Wb(nt){if(nt.tag===13){var _=nt.memoizedState;if(_===null&&(nt=nt.alternate,nt!==null&&(_=nt.memoizedState)),_!==null)return _.dehydrated}return null}function Xb(nt){if(Vb(nt)!==nt)throw Error(p$5(188))}function Yb(nt){var _=nt.alternate;if(!_){if(_=Vb(nt),_===null)throw Error(p$5(188));return _!==nt?null:nt}for(var tt=nt,ot=_;;){var st=tt.return;if(st===null)break;var at=st.alternate;if(at===null){if(ot=st.return,ot!==null){tt=ot;continue}break}if(st.child===at.child){for(at=st.child;at;){if(at===tt)return Xb(st),nt;if(at===ot)return Xb(st),_;at=at.sibling}throw Error(p$5(188))}if(tt.return!==ot.return)tt=st,ot=at;else{for(var lt=!1,dt=st.child;dt;){if(dt===tt){lt=!0,tt=st,ot=at;break}if(dt===ot){lt=!0,ot=st,tt=at;break}dt=dt.sibling}if(!lt){for(dt=at.child;dt;){if(dt===tt){lt=!0,tt=at,ot=st;break}if(dt===ot){lt=!0,ot=at,tt=st;break}dt=dt.sibling}if(!lt)throw Error(p$5(189))}}if(tt.alternate!==ot)throw Error(p$5(190))}if(tt.tag!==3)throw Error(p$5(188));return tt.stateNode.current===tt?nt:_}function Zb(nt){return nt=Yb(nt),nt!==null?$b(nt):null}function $b(nt){if(nt.tag===5||nt.tag===6)return nt;for(nt=nt.child;nt!==null;){var _=$b(nt);if(_!==null)return _;nt=nt.sibling}return null}var ac=ca.unstable_scheduleCallback,bc=ca.unstable_cancelCallback,cc=ca.unstable_shouldYield,dc=ca.unstable_requestPaint,B$1=ca.unstable_now,ec=ca.unstable_getCurrentPriorityLevel,fc=ca.unstable_ImmediatePriority,gc=ca.unstable_UserBlockingPriority,hc=ca.unstable_NormalPriority,ic=ca.unstable_LowPriority,jc=ca.unstable_IdlePriority,kc=null,lc=null;function mc(nt){if(lc&&typeof lc.onCommitFiberRoot=="function")try{lc.onCommitFiberRoot(kc,nt,void 0,(nt.current.flags&128)===128)}catch{}}var oc=Math.clz32?Math.clz32:nc,pc=Math.log,qc=Math.LN2;function nc(nt){return nt>>>=0,nt===0?32:31-(pc(nt)/qc|0)|0}var rc=64,sc=4194304;function tc(nt){switch(nt&-nt){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return nt&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return nt&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return nt}}function uc(nt,_){var tt=nt.pendingLanes;if(tt===0)return 0;var ot=0,st=nt.suspendedLanes,at=nt.pingedLanes,lt=tt&268435455;if(lt!==0){var dt=lt&~st;dt!==0?ot=tc(dt):(at&=lt,at!==0&&(ot=tc(at)))}else lt=tt&~st,lt!==0?ot=tc(lt):at!==0&&(ot=tc(at));if(ot===0)return 0;if(_!==0&&_!==ot&&!(_&st)&&(st=ot&-ot,at=_&-_,st>=at||st===16&&(at&4194240)!==0))return _;if(ot&4&&(ot|=tt&16),_=nt.entangledLanes,_!==0)for(nt=nt.entanglements,_&=ot;0<_;)tt=31-oc(_),st=1<<tt,ot|=nt[tt],_&=~st;return ot}function vc(nt,_){switch(nt){case 1:case 2:case 4:return _+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return _+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function wc(nt,_){for(var tt=nt.suspendedLanes,ot=nt.pingedLanes,st=nt.expirationTimes,at=nt.pendingLanes;0<at;){var lt=31-oc(at),dt=1<<lt,ht=st[lt];ht===-1?(!(dt&tt)||dt&ot)&&(st[lt]=vc(dt,_)):ht<=_&&(nt.expiredLanes|=dt),at&=~dt}}function xc(nt){return nt=nt.pendingLanes&-1073741825,nt!==0?nt:nt&1073741824?1073741824:0}function yc(){var nt=rc;return rc<<=1,!(rc&4194240)&&(rc=64),nt}function zc(nt){for(var _=[],tt=0;31>tt;tt++)_.push(nt);return _}function Ac(nt,_,tt){nt.pendingLanes|=_,_!==536870912&&(nt.suspendedLanes=0,nt.pingedLanes=0),nt=nt.eventTimes,_=31-oc(_),nt[_]=tt}function Bc(nt,_){var tt=nt.pendingLanes&~_;nt.pendingLanes=_,nt.suspendedLanes=0,nt.pingedLanes=0,nt.expiredLanes&=_,nt.mutableReadLanes&=_,nt.entangledLanes&=_,_=nt.entanglements;var ot=nt.eventTimes;for(nt=nt.expirationTimes;0<tt;){var st=31-oc(tt),at=1<<st;_[st]=0,ot[st]=-1,nt[st]=-1,tt&=~at}}function Cc(nt,_){var tt=nt.entangledLanes|=_;for(nt=nt.entanglements;tt;){var ot=31-oc(tt),st=1<<ot;st&_|nt[ot]&_&&(nt[ot]|=_),tt&=~st}}var C$2=0;function Dc(nt){return nt&=-nt,1<nt?4<nt?nt&268435455?16:536870912:4:1}var Ec,Fc,Gc,Hc,Ic,Jc=!1,Kc=[],Lc=null,Mc=null,Nc=null,Oc=new Map,Pc=new Map,Qc=[],Rc="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Sc(nt,_){switch(nt){case"focusin":case"focusout":Lc=null;break;case"dragenter":case"dragleave":Mc=null;break;case"mouseover":case"mouseout":Nc=null;break;case"pointerover":case"pointerout":Oc.delete(_.pointerId);break;case"gotpointercapture":case"lostpointercapture":Pc.delete(_.pointerId)}}function Tc(nt,_,tt,ot,st,at){return nt===null||nt.nativeEvent!==at?(nt={blockedOn:_,domEventName:tt,eventSystemFlags:ot,nativeEvent:at,targetContainers:[st]},_!==null&&(_=Cb(_),_!==null&&Fc(_)),nt):(nt.eventSystemFlags|=ot,_=nt.targetContainers,st!==null&&_.indexOf(st)===-1&&_.push(st),nt)}function Uc(nt,_,tt,ot,st){switch(_){case"focusin":return Lc=Tc(Lc,nt,_,tt,ot,st),!0;case"dragenter":return Mc=Tc(Mc,nt,_,tt,ot,st),!0;case"mouseover":return Nc=Tc(Nc,nt,_,tt,ot,st),!0;case"pointerover":var at=st.pointerId;return Oc.set(at,Tc(Oc.get(at)||null,nt,_,tt,ot,st)),!0;case"gotpointercapture":return at=st.pointerId,Pc.set(at,Tc(Pc.get(at)||null,nt,_,tt,ot,st)),!0}return!1}function Vc(nt){var _=Wc(nt.target);if(_!==null){var tt=Vb(_);if(tt!==null){if(_=tt.tag,_===13){if(_=Wb(tt),_!==null){nt.blockedOn=_,Ic(nt.priority,function(){Gc(tt)});return}}else if(_===3&&tt.stateNode.current.memoizedState.isDehydrated){nt.blockedOn=tt.tag===3?tt.stateNode.containerInfo:null;return}}}nt.blockedOn=null}function Xc(nt){if(nt.blockedOn!==null)return!1;for(var _=nt.targetContainers;0<_.length;){var tt=Yc(nt.domEventName,nt.eventSystemFlags,_[0],nt.nativeEvent);if(tt===null){tt=nt.nativeEvent;var ot=new tt.constructor(tt.type,tt);wb=ot,tt.target.dispatchEvent(ot),wb=null}else return _=Cb(tt),_!==null&&Fc(_),nt.blockedOn=tt,!1;_.shift()}return!0}function Zc(nt,_,tt){Xc(nt)&&tt.delete(_)}function $c(){Jc=!1,Lc!==null&&Xc(Lc)&&(Lc=null),Mc!==null&&Xc(Mc)&&(Mc=null),Nc!==null&&Xc(Nc)&&(Nc=null),Oc.forEach(Zc),Pc.forEach(Zc)}function ad(nt,_){nt.blockedOn===_&&(nt.blockedOn=null,Jc||(Jc=!0,ca.unstable_scheduleCallback(ca.unstable_NormalPriority,$c)))}function bd(nt){function _(st){return ad(st,nt)}if(0<Kc.length){ad(Kc[0],nt);for(var tt=1;tt<Kc.length;tt++){var ot=Kc[tt];ot.blockedOn===nt&&(ot.blockedOn=null)}}for(Lc!==null&&ad(Lc,nt),Mc!==null&&ad(Mc,nt),Nc!==null&&ad(Nc,nt),Oc.forEach(_),Pc.forEach(_),tt=0;tt<Qc.length;tt++)ot=Qc[tt],ot.blockedOn===nt&&(ot.blockedOn=null);for(;0<Qc.length&&(tt=Qc[0],tt.blockedOn===null);)Vc(tt),tt.blockedOn===null&&Qc.shift()}var cd=ua.ReactCurrentBatchConfig,dd=!0;function ed(nt,_,tt,ot){var st=C$2,at=cd.transition;cd.transition=null;try{C$2=1,fd$1(nt,_,tt,ot)}finally{C$2=st,cd.transition=at}}function gd(nt,_,tt,ot){var st=C$2,at=cd.transition;cd.transition=null;try{C$2=4,fd$1(nt,_,tt,ot)}finally{C$2=st,cd.transition=at}}function fd$1(nt,_,tt,ot){if(dd){var st=Yc(nt,_,tt,ot);if(st===null)hd(nt,_,ot,id$1,tt),Sc(nt,ot);else if(Uc(st,nt,_,tt,ot))ot.stopPropagation();else if(Sc(nt,ot),_&4&&-1<Rc.indexOf(nt)){for(;st!==null;){var at=Cb(st);if(at!==null&&Ec(at),at=Yc(nt,_,tt,ot),at===null&&hd(nt,_,ot,id$1,tt),at===st)break;st=at}st!==null&&ot.stopPropagation()}else hd(nt,_,ot,null,tt)}}var id$1=null;function Yc(nt,_,tt,ot){if(id$1=null,nt=xb(ot),nt=Wc(nt),nt!==null)if(_=Vb(nt),_===null)nt=null;else if(tt=_.tag,tt===13){if(nt=Wb(_),nt!==null)return nt;nt=null}else if(tt===3){if(_.stateNode.current.memoizedState.isDehydrated)return _.tag===3?_.stateNode.containerInfo:null;nt=null}else _!==nt&&(nt=null);return id$1=nt,null}function jd(nt){switch(nt){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(ec()){case fc:return 1;case gc:return 4;case hc:case ic:return 16;case jc:return 536870912;default:return 16}default:return 16}}var kd=null,ld=null,md=null;function nd(){if(md)return md;var nt,_=ld,tt=_.length,ot,st="value"in kd?kd.value:kd.textContent,at=st.length;for(nt=0;nt<tt&&_[nt]===st[nt];nt++);var lt=tt-nt;for(ot=1;ot<=lt&&_[tt-ot]===st[at-ot];ot++);return md=st.slice(nt,1<ot?1-ot:void 0)}function od(nt){var _=nt.keyCode;return"charCode"in nt?(nt=nt.charCode,nt===0&&_===13&&(nt=13)):nt=_,nt===10&&(nt=13),32<=nt||nt===13?nt:0}function pd(){return!0}function qd(){return!1}function rd(nt){function _(tt,ot,st,at,lt){this._reactName=tt,this._targetInst=st,this.type=ot,this.nativeEvent=at,this.target=lt,this.currentTarget=null;for(var dt in nt)nt.hasOwnProperty(dt)&&(tt=nt[dt],this[dt]=tt?tt(at):at[dt]);return this.isDefaultPrevented=(at.defaultPrevented!=null?at.defaultPrevented:at.returnValue===!1)?pd:qd,this.isPropagationStopped=qd,this}return A$2(_.prototype,{preventDefault:function(){this.defaultPrevented=!0;var tt=this.nativeEvent;tt&&(tt.preventDefault?tt.preventDefault():typeof tt.returnValue!="unknown"&&(tt.returnValue=!1),this.isDefaultPrevented=pd)},stopPropagation:function(){var tt=this.nativeEvent;tt&&(tt.stopPropagation?tt.stopPropagation():typeof tt.cancelBubble!="unknown"&&(tt.cancelBubble=!0),this.isPropagationStopped=pd)},persist:function(){},isPersistent:pd}),_}var sd={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(nt){return nt.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},td$1=rd(sd),ud=A$2({},sd,{view:0,detail:0}),vd=rd(ud),wd,xd,yd,Ad=A$2({},ud,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:zd,button:0,buttons:0,relatedTarget:function(nt){return nt.relatedTarget===void 0?nt.fromElement===nt.srcElement?nt.toElement:nt.fromElement:nt.relatedTarget},movementX:function(nt){return"movementX"in nt?nt.movementX:(nt!==yd&&(yd&&nt.type==="mousemove"?(wd=nt.screenX-yd.screenX,xd=nt.screenY-yd.screenY):xd=wd=0,yd=nt),wd)},movementY:function(nt){return"movementY"in nt?nt.movementY:xd}}),Bd=rd(Ad),Cd=A$2({},Ad,{dataTransfer:0}),Dd=rd(Cd),Ed=A$2({},ud,{relatedTarget:0}),Fd=rd(Ed),Gd=A$2({},sd,{animationName:0,elapsedTime:0,pseudoElement:0}),Hd=rd(Gd),Id=A$2({},sd,{clipboardData:function(nt){return"clipboardData"in nt?nt.clipboardData:window.clipboardData}}),Jd=rd(Id),Kd=A$2({},sd,{data:0}),Ld=rd(Kd),Md={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Nd={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Od={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Pd(nt){var _=this.nativeEvent;return _.getModifierState?_.getModifierState(nt):(nt=Od[nt])?!!_[nt]:!1}function zd(){return Pd}var Qd=A$2({},ud,{key:function(nt){if(nt.key){var _=Md[nt.key]||nt.key;if(_!=="Unidentified")return _}return nt.type==="keypress"?(nt=od(nt),nt===13?"Enter":String.fromCharCode(nt)):nt.type==="keydown"||nt.type==="keyup"?Nd[nt.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:zd,charCode:function(nt){return nt.type==="keypress"?od(nt):0},keyCode:function(nt){return nt.type==="keydown"||nt.type==="keyup"?nt.keyCode:0},which:function(nt){return nt.type==="keypress"?od(nt):nt.type==="keydown"||nt.type==="keyup"?nt.keyCode:0}}),Rd=rd(Qd),Sd=A$2({},Ad,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Td=rd(Sd),Ud=A$2({},ud,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:zd}),Vd=rd(Ud),Wd=A$2({},sd,{propertyName:0,elapsedTime:0,pseudoElement:0}),Xd=rd(Wd),Yd=A$2({},Ad,{deltaX:function(nt){return"deltaX"in nt?nt.deltaX:"wheelDeltaX"in nt?-nt.wheelDeltaX:0},deltaY:function(nt){return"deltaY"in nt?nt.deltaY:"wheelDeltaY"in nt?-nt.wheelDeltaY:"wheelDelta"in nt?-nt.wheelDelta:0},deltaZ:0,deltaMode:0}),Zd=rd(Yd),$d=[9,13,27,32],ae=ia&&"CompositionEvent"in window,be=null;ia&&"documentMode"in document&&(be=document.documentMode);var ce=ia&&"TextEvent"in window&&!be,de=ia&&(!ae||be&&8<be&&11>=be),ee$1=String.fromCharCode(32),fe=!1;function ge(nt,_){switch(nt){case"keyup":return $d.indexOf(_.keyCode)!==-1;case"keydown":return _.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function he(nt){return nt=nt.detail,typeof nt=="object"&&"data"in nt?nt.data:null}var ie=!1;function je(nt,_){switch(nt){case"compositionend":return he(_);case"keypress":return _.which!==32?null:(fe=!0,ee$1);case"textInput":return nt=_.data,nt===ee$1&&fe?null:nt;default:return null}}function ke(nt,_){if(ie)return nt==="compositionend"||!ae&&ge(nt,_)?(nt=nd(),md=ld=kd=null,ie=!1,nt):null;switch(nt){case"paste":return null;case"keypress":if(!(_.ctrlKey||_.altKey||_.metaKey)||_.ctrlKey&&_.altKey){if(_.char&&1<_.char.length)return _.char;if(_.which)return String.fromCharCode(_.which)}return null;case"compositionend":return de&&_.locale!=="ko"?null:_.data;default:return null}}var le={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function me(nt){var _=nt&&nt.nodeName&&nt.nodeName.toLowerCase();return _==="input"?!!le[nt.type]:_==="textarea"}function ne(nt,_,tt,ot){Eb(ot),_=oe(_,"onChange"),0<_.length&&(tt=new td$1("onChange","change",null,tt,ot),nt.push({event:tt,listeners:_}))}var pe=null,qe=null;function re$1(nt){se(nt,0)}function te(nt){var _=ue(nt);if(Wa(_))return nt}function ve(nt,_){if(nt==="change")return _}var we=!1;if(ia){var xe$1;if(ia){var ye="oninput"in document;if(!ye){var ze=document.createElement("div");ze.setAttribute("oninput","return;"),ye=typeof ze.oninput=="function"}xe$1=ye}else xe$1=!1;we=xe$1&&(!document.documentMode||9<document.documentMode)}function Ae(){pe&&(pe.detachEvent("onpropertychange",Be),qe=pe=null)}function Be(nt){if(nt.propertyName==="value"&&te(qe)){var _=[];ne(_,qe,nt,xb(nt)),Jb(re$1,_)}}function Ce$1(nt,_,tt){nt==="focusin"?(Ae(),pe=_,qe=tt,pe.attachEvent("onpropertychange",Be)):nt==="focusout"&&Ae()}function De(nt){if(nt==="selectionchange"||nt==="keyup"||nt==="keydown")return te(qe)}function Ee(nt,_){if(nt==="click")return te(_)}function Fe(nt,_){if(nt==="input"||nt==="change")return te(_)}function Ge(nt,_){return nt===_&&(nt!==0||1/nt===1/_)||nt!==nt&&_!==_}var He=typeof Object.is=="function"?Object.is:Ge;function Ie(nt,_){if(He(nt,_))return!0;if(typeof nt!="object"||nt===null||typeof _!="object"||_===null)return!1;var tt=Object.keys(nt),ot=Object.keys(_);if(tt.length!==ot.length)return!1;for(ot=0;ot<tt.length;ot++){var st=tt[ot];if(!ja.call(_,st)||!He(nt[st],_[st]))return!1}return!0}function Je(nt){for(;nt&&nt.firstChild;)nt=nt.firstChild;return nt}function Ke(nt,_){var tt=Je(nt);nt=0;for(var ot;tt;){if(tt.nodeType===3){if(ot=nt+tt.textContent.length,nt<=_&&ot>=_)return{node:tt,offset:_-nt};nt=ot}e:{for(;tt;){if(tt.nextSibling){tt=tt.nextSibling;break e}tt=tt.parentNode}tt=void 0}tt=Je(tt)}}function Le(nt,_){return nt&&_?nt===_?!0:nt&&nt.nodeType===3?!1:_&&_.nodeType===3?Le(nt,_.parentNode):"contains"in nt?nt.contains(_):nt.compareDocumentPosition?!!(nt.compareDocumentPosition(_)&16):!1:!1}function Me$1(){for(var nt=window,_=Xa();_ instanceof nt.HTMLIFrameElement;){try{var tt=typeof _.contentWindow.location.href=="string"}catch{tt=!1}if(tt)nt=_.contentWindow;else break;_=Xa(nt.document)}return _}function Ne$1(nt){var _=nt&&nt.nodeName&&nt.nodeName.toLowerCase();return _&&(_==="input"&&(nt.type==="text"||nt.type==="search"||nt.type==="tel"||nt.type==="url"||nt.type==="password")||_==="textarea"||nt.contentEditable==="true")}function Oe(nt){var _=Me$1(),tt=nt.focusedElem,ot=nt.selectionRange;if(_!==tt&&tt&&tt.ownerDocument&&Le(tt.ownerDocument.documentElement,tt)){if(ot!==null&&Ne$1(tt)){if(_=ot.start,nt=ot.end,nt===void 0&&(nt=_),"selectionStart"in tt)tt.selectionStart=_,tt.selectionEnd=Math.min(nt,tt.value.length);else if(nt=(_=tt.ownerDocument||document)&&_.defaultView||window,nt.getSelection){nt=nt.getSelection();var st=tt.textContent.length,at=Math.min(ot.start,st);ot=ot.end===void 0?at:Math.min(ot.end,st),!nt.extend&&at>ot&&(st=ot,ot=at,at=st),st=Ke(tt,at);var lt=Ke(tt,ot);st&&lt&&(nt.rangeCount!==1||nt.anchorNode!==st.node||nt.anchorOffset!==st.offset||nt.focusNode!==lt.node||nt.focusOffset!==lt.offset)&&(_=_.createRange(),_.setStart(st.node,st.offset),nt.removeAllRanges(),at>ot?(nt.addRange(_),nt.extend(lt.node,lt.offset)):(_.setEnd(lt.node,lt.offset),nt.addRange(_)))}}for(_=[],nt=tt;nt=nt.parentNode;)nt.nodeType===1&&_.push({element:nt,left:nt.scrollLeft,top:nt.scrollTop});for(typeof tt.focus=="function"&&tt.focus(),tt=0;tt<_.length;tt++)nt=_[tt],nt.element.scrollLeft=nt.left,nt.element.scrollTop=nt.top}}var Pe=ia&&"documentMode"in document&&11>=document.documentMode,Qe=null,Re=null,Se=null,Te=!1;function Ue(nt,_,tt){var ot=tt.window===tt?tt.document:tt.nodeType===9?tt:tt.ownerDocument;Te||Qe==null||Qe!==Xa(ot)||(ot=Qe,"selectionStart"in ot&&Ne$1(ot)?ot={start:ot.selectionStart,end:ot.selectionEnd}:(ot=(ot.ownerDocument&&ot.ownerDocument.defaultView||window).getSelection(),ot={anchorNode:ot.anchorNode,anchorOffset:ot.anchorOffset,focusNode:ot.focusNode,focusOffset:ot.focusOffset}),Se&&Ie(Se,ot)||(Se=ot,ot=oe(Re,"onSelect"),0<ot.length&&(_=new td$1("onSelect","select",null,_,tt),nt.push({event:_,listeners:ot}),_.target=Qe)))}function Ve(nt,_){var tt={};return tt[nt.toLowerCase()]=_.toLowerCase(),tt["Webkit"+nt]="webkit"+_,tt["Moz"+nt]="moz"+_,tt}var We={animationend:Ve("Animation","AnimationEnd"),animationiteration:Ve("Animation","AnimationIteration"),animationstart:Ve("Animation","AnimationStart"),transitionend:Ve("Transition","TransitionEnd")},Xe={},Ye={};ia&&(Ye=document.createElement("div").style,"AnimationEvent"in window||(delete We.animationend.animation,delete We.animationiteration.animation,delete We.animationstart.animation),"TransitionEvent"in window||delete We.transitionend.transition);function Ze(nt){if(Xe[nt])return Xe[nt];if(!We[nt])return nt;var _=We[nt],tt;for(tt in _)if(_.hasOwnProperty(tt)&&tt in Ye)return Xe[nt]=_[tt];return nt}var $e=Ze("animationend"),af=Ze("animationiteration"),bf=Ze("animationstart"),cf=Ze("transitionend"),df=new Map,ef="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function ff(nt,_){df.set(nt,_),fa(_,[nt])}for(var gf=0;gf<ef.length;gf++){var hf=ef[gf],jf=hf.toLowerCase(),kf=hf[0].toUpperCase()+hf.slice(1);ff(jf,"on"+kf)}ff($e,"onAnimationEnd");ff(af,"onAnimationIteration");ff(bf,"onAnimationStart");ff("dblclick","onDoubleClick");ff("focusin","onFocus");ff("focusout","onBlur");ff(cf,"onTransitionEnd");ha("onMouseEnter",["mouseout","mouseover"]);ha("onMouseLeave",["mouseout","mouseover"]);ha("onPointerEnter",["pointerout","pointerover"]);ha("onPointerLeave",["pointerout","pointerover"]);fa("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));fa("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));fa("onBeforeInput",["compositionend","keypress","textInput","paste"]);fa("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));fa("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));fa("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var lf="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),mf=new Set("cancel close invalid load scroll toggle".split(" ").concat(lf));function nf(nt,_,tt){var ot=nt.type||"unknown-event";nt.currentTarget=tt,Ub(ot,_,void 0,nt),nt.currentTarget=null}function se(nt,_){_=(_&4)!==0;for(var tt=0;tt<nt.length;tt++){var ot=nt[tt],st=ot.event;ot=ot.listeners;e:{var at=void 0;if(_)for(var lt=ot.length-1;0<=lt;lt--){var dt=ot[lt],ht=dt.instance,ft=dt.currentTarget;if(dt=dt.listener,ht!==at&&st.isPropagationStopped())break e;nf(st,dt,ft),at=ht}else for(lt=0;lt<ot.length;lt++){if(dt=ot[lt],ht=dt.instance,ft=dt.currentTarget,dt=dt.listener,ht!==at&&st.isPropagationStopped())break e;nf(st,dt,ft),at=ht}}}if(Qb)throw nt=Rb,Qb=!1,Rb=null,nt}function D$4(nt,_){var tt=_[of];tt===void 0&&(tt=_[of]=new Set);var ot=nt+"__bubble";tt.has(ot)||(pf(_,nt,2,!1),tt.add(ot))}function qf(nt,_,tt){var ot=0;_&&(ot|=4),pf(tt,nt,ot,_)}var rf="_reactListening"+Math.random().toString(36).slice(2);function sf(nt){if(!nt[rf]){nt[rf]=!0,da.forEach(function(tt){tt!=="selectionchange"&&(mf.has(tt)||qf(tt,!1,nt),qf(tt,!0,nt))});var _=nt.nodeType===9?nt:nt.ownerDocument;_===null||_[rf]||(_[rf]=!0,qf("selectionchange",!1,_))}}function pf(nt,_,tt,ot){switch(jd(_)){case 1:var st=ed;break;case 4:st=gd;break;default:st=fd$1}tt=st.bind(null,_,tt,nt),st=void 0,!Lb||_!=="touchstart"&&_!=="touchmove"&&_!=="wheel"||(st=!0),ot?st!==void 0?nt.addEventListener(_,tt,{capture:!0,passive:st}):nt.addEventListener(_,tt,!0):st!==void 0?nt.addEventListener(_,tt,{passive:st}):nt.addEventListener(_,tt,!1)}function hd(nt,_,tt,ot,st){var at=ot;if(!(_&1)&&!(_&2)&&ot!==null)e:for(;;){if(ot===null)return;var lt=ot.tag;if(lt===3||lt===4){var dt=ot.stateNode.containerInfo;if(dt===st||dt.nodeType===8&&dt.parentNode===st)break;if(lt===4)for(lt=ot.return;lt!==null;){var ht=lt.tag;if((ht===3||ht===4)&&(ht=lt.stateNode.containerInfo,ht===st||ht.nodeType===8&&ht.parentNode===st))return;lt=lt.return}for(;dt!==null;){if(lt=Wc(dt),lt===null)return;if(ht=lt.tag,ht===5||ht===6){ot=at=lt;continue e}dt=dt.parentNode}}ot=ot.return}Jb(function(){var ft=at,gt=xb(tt),Et=[];e:{var yt=df.get(nt);if(yt!==void 0){var Ct=td$1,wt=nt;switch(nt){case"keypress":if(od(tt)===0)break e;case"keydown":case"keyup":Ct=Rd;break;case"focusin":wt="focus",Ct=Fd;break;case"focusout":wt="blur",Ct=Fd;break;case"beforeblur":case"afterblur":Ct=Fd;break;case"click":if(tt.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Ct=Bd;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Ct=Dd;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Ct=Vd;break;case $e:case af:case bf:Ct=Hd;break;case cf:Ct=Xd;break;case"scroll":Ct=vd;break;case"wheel":Ct=Zd;break;case"copy":case"cut":case"paste":Ct=Jd;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Ct=Td}var It=(_&4)!==0,Pt=!It&&nt==="scroll",Rt=It?yt!==null?yt+"Capture":null:yt;It=[];for(var xt=ft,Nt;xt!==null;){Nt=xt;var kt=Nt.stateNode;if(Nt.tag===5&&kt!==null&&(Nt=kt,Rt!==null&&(kt=Kb(xt,Rt),kt!=null&&It.push(tf(xt,kt,Nt)))),Pt)break;xt=xt.return}0<It.length&&(yt=new Ct(yt,wt,null,tt,gt),Et.push({event:yt,listeners:It}))}}if(!(_&7)){e:{if(yt=nt==="mouseover"||nt==="pointerover",Ct=nt==="mouseout"||nt==="pointerout",yt&&tt!==wb&&(wt=tt.relatedTarget||tt.fromElement)&&(Wc(wt)||wt[uf]))break e;if((Ct||yt)&&(yt=gt.window===gt?gt:(yt=gt.ownerDocument)?yt.defaultView||yt.parentWindow:window,Ct?(wt=tt.relatedTarget||tt.toElement,Ct=ft,wt=wt?Wc(wt):null,wt!==null&&(Pt=Vb(wt),wt!==Pt||wt.tag!==5&&wt.tag!==6)&&(wt=null)):(Ct=null,wt=ft),Ct!==wt)){if(It=Bd,kt="onMouseLeave",Rt="onMouseEnter",xt="mouse",(nt==="pointerout"||nt==="pointerover")&&(It=Td,kt="onPointerLeave",Rt="onPointerEnter",xt="pointer"),Pt=Ct==null?yt:ue(Ct),Nt=wt==null?yt:ue(wt),yt=new It(kt,xt+"leave",Ct,tt,gt),yt.target=Pt,yt.relatedTarget=Nt,kt=null,Wc(gt)===ft&&(It=new It(Rt,xt+"enter",wt,tt,gt),It.target=Nt,It.relatedTarget=Pt,kt=It),Pt=kt,Ct&&wt)t:{for(It=Ct,Rt=wt,xt=0,Nt=It;Nt;Nt=vf(Nt))xt++;for(Nt=0,kt=Rt;kt;kt=vf(kt))Nt++;for(;0<xt-Nt;)It=vf(It),xt--;for(;0<Nt-xt;)Rt=vf(Rt),Nt--;for(;xt--;){if(It===Rt||Rt!==null&&It===Rt.alternate)break t;It=vf(It),Rt=vf(Rt)}It=null}else It=null;Ct!==null&&wf(Et,yt,Ct,It,!1),wt!==null&&Pt!==null&&wf(Et,Pt,wt,It,!0)}}e:{if(yt=ft?ue(ft):window,Ct=yt.nodeName&&yt.nodeName.toLowerCase(),Ct==="select"||Ct==="input"&&yt.type==="file")var Vt=ve;else if(me(yt))if(we)Vt=Fe;else{Vt=De;var Ft=Ce$1}else(Ct=yt.nodeName)&&Ct.toLowerCase()==="input"&&(yt.type==="checkbox"||yt.type==="radio")&&(Vt=Ee);if(Vt&&(Vt=Vt(nt,ft))){ne(Et,Vt,tt,gt);break e}Ft&&Ft(nt,yt,ft),nt==="focusout"&&(Ft=yt._wrapperState)&&Ft.controlled&&yt.type==="number"&&cb(yt,"number",yt.value)}switch(Ft=ft?ue(ft):window,nt){case"focusin":(me(Ft)||Ft.contentEditable==="true")&&(Qe=Ft,Re=ft,Se=null);break;case"focusout":Se=Re=Qe=null;break;case"mousedown":Te=!0;break;case"contextmenu":case"mouseup":case"dragend":Te=!1,Ue(Et,tt,gt);break;case"selectionchange":if(Pe)break;case"keydown":case"keyup":Ue(Et,tt,gt)}var zt;if(ae)e:{switch(nt){case"compositionstart":var Yt="onCompositionStart";break e;case"compositionend":Yt="onCompositionEnd";break e;case"compositionupdate":Yt="onCompositionUpdate";break e}Yt=void 0}else ie?ge(nt,tt)&&(Yt="onCompositionEnd"):nt==="keydown"&&tt.keyCode===229&&(Yt="onCompositionStart");Yt&&(de&&tt.locale!=="ko"&&(ie||Yt!=="onCompositionStart"?Yt==="onCompositionEnd"&&ie&&(zt=nd()):(kd=gt,ld="value"in kd?kd.value:kd.textContent,ie=!0)),Ft=oe(ft,Yt),0<Ft.length&&(Yt=new Ld(Yt,nt,null,tt,gt),Et.push({event:Yt,listeners:Ft}),zt?Yt.data=zt:(zt=he(tt),zt!==null&&(Yt.data=zt)))),(zt=ce?je(nt,tt):ke(nt,tt))&&(ft=oe(ft,"onBeforeInput"),0<ft.length&&(gt=new Ld("onBeforeInput","beforeinput",null,tt,gt),Et.push({event:gt,listeners:ft}),gt.data=zt))}se(Et,_)})}function tf(nt,_,tt){return{instance:nt,listener:_,currentTarget:tt}}function oe(nt,_){for(var tt=_+"Capture",ot=[];nt!==null;){var st=nt,at=st.stateNode;st.tag===5&&at!==null&&(st=at,at=Kb(nt,tt),at!=null&&ot.unshift(tf(nt,at,st)),at=Kb(nt,_),at!=null&&ot.push(tf(nt,at,st))),nt=nt.return}return ot}function vf(nt){if(nt===null)return null;do nt=nt.return;while(nt&&nt.tag!==5);return nt||null}function wf(nt,_,tt,ot,st){for(var at=_._reactName,lt=[];tt!==null&&tt!==ot;){var dt=tt,ht=dt.alternate,ft=dt.stateNode;if(ht!==null&&ht===ot)break;dt.tag===5&&ft!==null&&(dt=ft,st?(ht=Kb(tt,at),ht!=null&&lt.unshift(tf(tt,ht,dt))):st||(ht=Kb(tt,at),ht!=null&&lt.push(tf(tt,ht,dt)))),tt=tt.return}lt.length!==0&&nt.push({event:_,listeners:lt})}var xf=/\r\n?/g,yf=/\u0000|\uFFFD/g;function zf(nt){return(typeof nt=="string"?nt:""+nt).replace(xf,`
`).replace(yf,"")}function Af(nt,_,tt){if(_=zf(_),zf(nt)!==_&&tt)throw Error(p$5(425))}function Bf(){}var Cf=null,Df=null;function Ef(nt,_){return nt==="textarea"||nt==="noscript"||typeof _.children=="string"||typeof _.children=="number"||typeof _.dangerouslySetInnerHTML=="object"&&_.dangerouslySetInnerHTML!==null&&_.dangerouslySetInnerHTML.__html!=null}var Ff=typeof setTimeout=="function"?setTimeout:void 0,Gf=typeof clearTimeout=="function"?clearTimeout:void 0,Hf=typeof Promise=="function"?Promise:void 0,Jf=typeof queueMicrotask=="function"?queueMicrotask:typeof Hf<"u"?function(nt){return Hf.resolve(null).then(nt).catch(If)}:Ff;function If(nt){setTimeout(function(){throw nt})}function Kf(nt,_){var tt=_,ot=0;do{var st=tt.nextSibling;if(nt.removeChild(tt),st&&st.nodeType===8)if(tt=st.data,tt==="/$"){if(ot===0){nt.removeChild(st),bd(_);return}ot--}else tt!=="$"&&tt!=="$?"&&tt!=="$!"||ot++;tt=st}while(tt);bd(_)}function Lf(nt){for(;nt!=null;nt=nt.nextSibling){var _=nt.nodeType;if(_===1||_===3)break;if(_===8){if(_=nt.data,_==="$"||_==="$!"||_==="$?")break;if(_==="/$")return null}}return nt}function Mf(nt){nt=nt.previousSibling;for(var _=0;nt;){if(nt.nodeType===8){var tt=nt.data;if(tt==="$"||tt==="$!"||tt==="$?"){if(_===0)return nt;_--}else tt==="/$"&&_++}nt=nt.previousSibling}return null}var Nf=Math.random().toString(36).slice(2),Of="__reactFiber$"+Nf,Pf="__reactProps$"+Nf,uf="__reactContainer$"+Nf,of="__reactEvents$"+Nf,Qf="__reactListeners$"+Nf,Rf="__reactHandles$"+Nf;function Wc(nt){var _=nt[Of];if(_)return _;for(var tt=nt.parentNode;tt;){if(_=tt[uf]||tt[Of]){if(tt=_.alternate,_.child!==null||tt!==null&&tt.child!==null)for(nt=Mf(nt);nt!==null;){if(tt=nt[Of])return tt;nt=Mf(nt)}return _}nt=tt,tt=nt.parentNode}return null}function Cb(nt){return nt=nt[Of]||nt[uf],!nt||nt.tag!==5&&nt.tag!==6&&nt.tag!==13&&nt.tag!==3?null:nt}function ue(nt){if(nt.tag===5||nt.tag===6)return nt.stateNode;throw Error(p$5(33))}function Db(nt){return nt[Pf]||null}var Sf=[],Tf=-1;function Uf(nt){return{current:nt}}function E$3(nt){0>Tf||(nt.current=Sf[Tf],Sf[Tf]=null,Tf--)}function G$1(nt,_){Tf++,Sf[Tf]=nt.current,nt.current=_}var Vf={},H$3=Uf(Vf),Wf=Uf(!1),Xf=Vf;function Yf(nt,_){var tt=nt.type.contextTypes;if(!tt)return Vf;var ot=nt.stateNode;if(ot&&ot.__reactInternalMemoizedUnmaskedChildContext===_)return ot.__reactInternalMemoizedMaskedChildContext;var st={},at;for(at in tt)st[at]=_[at];return ot&&(nt=nt.stateNode,nt.__reactInternalMemoizedUnmaskedChildContext=_,nt.__reactInternalMemoizedMaskedChildContext=st),st}function Zf(nt){return nt=nt.childContextTypes,nt!=null}function $f(){E$3(Wf),E$3(H$3)}function ag(nt,_,tt){if(H$3.current!==Vf)throw Error(p$5(168));G$1(H$3,_),G$1(Wf,tt)}function bg(nt,_,tt){var ot=nt.stateNode;if(_=_.childContextTypes,typeof ot.getChildContext!="function")return tt;ot=ot.getChildContext();for(var st in ot)if(!(st in _))throw Error(p$5(108,Ra(nt)||"Unknown",st));return A$2({},tt,ot)}function cg(nt){return nt=(nt=nt.stateNode)&&nt.__reactInternalMemoizedMergedChildContext||Vf,Xf=H$3.current,G$1(H$3,nt),G$1(Wf,Wf.current),!0}function dg(nt,_,tt){var ot=nt.stateNode;if(!ot)throw Error(p$5(169));tt?(nt=bg(nt,_,Xf),ot.__reactInternalMemoizedMergedChildContext=nt,E$3(Wf),E$3(H$3),G$1(H$3,nt)):E$3(Wf),G$1(Wf,tt)}var eg=null,fg=!1,gg=!1;function hg(nt){eg===null?eg=[nt]:eg.push(nt)}function ig(nt){fg=!0,hg(nt)}function jg(){if(!gg&&eg!==null){gg=!0;var nt=0,_=C$2;try{var tt=eg;for(C$2=1;nt<tt.length;nt++){var ot=tt[nt];do ot=ot(!0);while(ot!==null)}eg=null,fg=!1}catch(st){throw eg!==null&&(eg=eg.slice(nt+1)),ac(fc,jg),st}finally{C$2=_,gg=!1}}return null}var kg=[],lg=0,mg=null,ng=0,og=[],pg=0,qg=null,rg=1,sg="";function tg(nt,_){kg[lg++]=ng,kg[lg++]=mg,mg=nt,ng=_}function ug(nt,_,tt){og[pg++]=rg,og[pg++]=sg,og[pg++]=qg,qg=nt;var ot=rg;nt=sg;var st=32-oc(ot)-1;ot&=~(1<<st),tt+=1;var at=32-oc(_)+st;if(30<at){var lt=st-st%5;at=(ot&(1<<lt)-1).toString(32),ot>>=lt,st-=lt,rg=1<<32-oc(_)+st|tt<<st|ot,sg=at+nt}else rg=1<<at|tt<<st|ot,sg=nt}function vg(nt){nt.return!==null&&(tg(nt,1),ug(nt,1,0))}function wg(nt){for(;nt===mg;)mg=kg[--lg],kg[lg]=null,ng=kg[--lg],kg[lg]=null;for(;nt===qg;)qg=og[--pg],og[pg]=null,sg=og[--pg],og[pg]=null,rg=og[--pg],og[pg]=null}var xg=null,yg=null,I$3=!1,zg=null;function Ag(nt,_){var tt=Bg(5,null,null,0);tt.elementType="DELETED",tt.stateNode=_,tt.return=nt,_=nt.deletions,_===null?(nt.deletions=[tt],nt.flags|=16):_.push(tt)}function Cg(nt,_){switch(nt.tag){case 5:var tt=nt.type;return _=_.nodeType!==1||tt.toLowerCase()!==_.nodeName.toLowerCase()?null:_,_!==null?(nt.stateNode=_,xg=nt,yg=Lf(_.firstChild),!0):!1;case 6:return _=nt.pendingProps===""||_.nodeType!==3?null:_,_!==null?(nt.stateNode=_,xg=nt,yg=null,!0):!1;case 13:return _=_.nodeType!==8?null:_,_!==null?(tt=qg!==null?{id:rg,overflow:sg}:null,nt.memoizedState={dehydrated:_,treeContext:tt,retryLane:1073741824},tt=Bg(18,null,null,0),tt.stateNode=_,tt.return=nt,nt.child=tt,xg=nt,yg=null,!0):!1;default:return!1}}function Dg(nt){return(nt.mode&1)!==0&&(nt.flags&128)===0}function Eg(nt){if(I$3){var _=yg;if(_){var tt=_;if(!Cg(nt,_)){if(Dg(nt))throw Error(p$5(418));_=Lf(tt.nextSibling);var ot=xg;_&&Cg(nt,_)?Ag(ot,tt):(nt.flags=nt.flags&-4097|2,I$3=!1,xg=nt)}}else{if(Dg(nt))throw Error(p$5(418));nt.flags=nt.flags&-4097|2,I$3=!1,xg=nt}}}function Fg(nt){for(nt=nt.return;nt!==null&&nt.tag!==5&&nt.tag!==3&&nt.tag!==13;)nt=nt.return;xg=nt}function Gg(nt){if(nt!==xg)return!1;if(!I$3)return Fg(nt),I$3=!0,!1;var _;if((_=nt.tag!==3)&&!(_=nt.tag!==5)&&(_=nt.type,_=_!=="head"&&_!=="body"&&!Ef(nt.type,nt.memoizedProps)),_&&(_=yg)){if(Dg(nt))throw Hg(),Error(p$5(418));for(;_;)Ag(nt,_),_=Lf(_.nextSibling)}if(Fg(nt),nt.tag===13){if(nt=nt.memoizedState,nt=nt!==null?nt.dehydrated:null,!nt)throw Error(p$5(317));e:{for(nt=nt.nextSibling,_=0;nt;){if(nt.nodeType===8){var tt=nt.data;if(tt==="/$"){if(_===0){yg=Lf(nt.nextSibling);break e}_--}else tt!=="$"&&tt!=="$!"&&tt!=="$?"||_++}nt=nt.nextSibling}yg=null}}else yg=xg?Lf(nt.stateNode.nextSibling):null;return!0}function Hg(){for(var nt=yg;nt;)nt=Lf(nt.nextSibling)}function Ig(){yg=xg=null,I$3=!1}function Jg(nt){zg===null?zg=[nt]:zg.push(nt)}var Kg=ua.ReactCurrentBatchConfig;function Lg(nt,_,tt){if(nt=tt.ref,nt!==null&&typeof nt!="function"&&typeof nt!="object"){if(tt._owner){if(tt=tt._owner,tt){if(tt.tag!==1)throw Error(p$5(309));var ot=tt.stateNode}if(!ot)throw Error(p$5(147,nt));var st=ot,at=""+nt;return _!==null&&_.ref!==null&&typeof _.ref=="function"&&_.ref._stringRef===at?_.ref:(_=function(lt){var dt=st.refs;lt===null?delete dt[at]:dt[at]=lt},_._stringRef=at,_)}if(typeof nt!="string")throw Error(p$5(284));if(!tt._owner)throw Error(p$5(290,nt))}return nt}function Mg(nt,_){throw nt=Object.prototype.toString.call(_),Error(p$5(31,nt==="[object Object]"?"object with keys {"+Object.keys(_).join(", ")+"}":nt))}function Ng(nt){var _=nt._init;return _(nt._payload)}function Og(nt){function _(Rt,xt){if(nt){var Nt=Rt.deletions;Nt===null?(Rt.deletions=[xt],Rt.flags|=16):Nt.push(xt)}}function tt(Rt,xt){if(!nt)return null;for(;xt!==null;)_(Rt,xt),xt=xt.sibling;return null}function ot(Rt,xt){for(Rt=new Map;xt!==null;)xt.key!==null?Rt.set(xt.key,xt):Rt.set(xt.index,xt),xt=xt.sibling;return Rt}function st(Rt,xt){return Rt=Pg(Rt,xt),Rt.index=0,Rt.sibling=null,Rt}function at(Rt,xt,Nt){return Rt.index=Nt,nt?(Nt=Rt.alternate,Nt!==null?(Nt=Nt.index,Nt<xt?(Rt.flags|=2,xt):Nt):(Rt.flags|=2,xt)):(Rt.flags|=1048576,xt)}function lt(Rt){return nt&&Rt.alternate===null&&(Rt.flags|=2),Rt}function dt(Rt,xt,Nt,kt){return xt===null||xt.tag!==6?(xt=Qg(Nt,Rt.mode,kt),xt.return=Rt,xt):(xt=st(xt,Nt),xt.return=Rt,xt)}function ht(Rt,xt,Nt,kt){var Vt=Nt.type;return Vt===ya?gt(Rt,xt,Nt.props.children,kt,Nt.key):xt!==null&&(xt.elementType===Vt||typeof Vt=="object"&&Vt!==null&&Vt.$$typeof===Ha&&Ng(Vt)===xt.type)?(kt=st(xt,Nt.props),kt.ref=Lg(Rt,xt,Nt),kt.return=Rt,kt):(kt=Rg(Nt.type,Nt.key,Nt.props,null,Rt.mode,kt),kt.ref=Lg(Rt,xt,Nt),kt.return=Rt,kt)}function ft(Rt,xt,Nt,kt){return xt===null||xt.tag!==4||xt.stateNode.containerInfo!==Nt.containerInfo||xt.stateNode.implementation!==Nt.implementation?(xt=Sg(Nt,Rt.mode,kt),xt.return=Rt,xt):(xt=st(xt,Nt.children||[]),xt.return=Rt,xt)}function gt(Rt,xt,Nt,kt,Vt){return xt===null||xt.tag!==7?(xt=Tg(Nt,Rt.mode,kt,Vt),xt.return=Rt,xt):(xt=st(xt,Nt),xt.return=Rt,xt)}function Et(Rt,xt,Nt){if(typeof xt=="string"&&xt!==""||typeof xt=="number")return xt=Qg(""+xt,Rt.mode,Nt),xt.return=Rt,xt;if(typeof xt=="object"&&xt!==null){switch(xt.$$typeof){case va:return Nt=Rg(xt.type,xt.key,xt.props,null,Rt.mode,Nt),Nt.ref=Lg(Rt,null,xt),Nt.return=Rt,Nt;case wa:return xt=Sg(xt,Rt.mode,Nt),xt.return=Rt,xt;case Ha:var kt=xt._init;return Et(Rt,kt(xt._payload),Nt)}if(eb(xt)||Ka(xt))return xt=Tg(xt,Rt.mode,Nt,null),xt.return=Rt,xt;Mg(Rt,xt)}return null}function yt(Rt,xt,Nt,kt){var Vt=xt!==null?xt.key:null;if(typeof Nt=="string"&&Nt!==""||typeof Nt=="number")return Vt!==null?null:dt(Rt,xt,""+Nt,kt);if(typeof Nt=="object"&&Nt!==null){switch(Nt.$$typeof){case va:return Nt.key===Vt?ht(Rt,xt,Nt,kt):null;case wa:return Nt.key===Vt?ft(Rt,xt,Nt,kt):null;case Ha:return Vt=Nt._init,yt(Rt,xt,Vt(Nt._payload),kt)}if(eb(Nt)||Ka(Nt))return Vt!==null?null:gt(Rt,xt,Nt,kt,null);Mg(Rt,Nt)}return null}function Ct(Rt,xt,Nt,kt,Vt){if(typeof kt=="string"&&kt!==""||typeof kt=="number")return Rt=Rt.get(Nt)||null,dt(xt,Rt,""+kt,Vt);if(typeof kt=="object"&&kt!==null){switch(kt.$$typeof){case va:return Rt=Rt.get(kt.key===null?Nt:kt.key)||null,ht(xt,Rt,kt,Vt);case wa:return Rt=Rt.get(kt.key===null?Nt:kt.key)||null,ft(xt,Rt,kt,Vt);case Ha:var Ft=kt._init;return Ct(Rt,xt,Nt,Ft(kt._payload),Vt)}if(eb(kt)||Ka(kt))return Rt=Rt.get(Nt)||null,gt(xt,Rt,kt,Vt,null);Mg(xt,kt)}return null}function wt(Rt,xt,Nt,kt){for(var Vt=null,Ft=null,zt=xt,Yt=xt=0,Kt=null;zt!==null&&Yt<Nt.length;Yt++){zt.index>Yt?(Kt=zt,zt=null):Kt=zt.sibling;var qt=yt(Rt,zt,Nt[Yt],kt);if(qt===null){zt===null&&(zt=Kt);break}nt&&zt&&qt.alternate===null&&_(Rt,zt),xt=at(qt,xt,Yt),Ft===null?Vt=qt:Ft.sibling=qt,Ft=qt,zt=Kt}if(Yt===Nt.length)return tt(Rt,zt),I$3&&tg(Rt,Yt),Vt;if(zt===null){for(;Yt<Nt.length;Yt++)zt=Et(Rt,Nt[Yt],kt),zt!==null&&(xt=at(zt,xt,Yt),Ft===null?Vt=zt:Ft.sibling=zt,Ft=zt);return I$3&&tg(Rt,Yt),Vt}for(zt=ot(Rt,zt);Yt<Nt.length;Yt++)Kt=Ct(zt,Rt,Yt,Nt[Yt],kt),Kt!==null&&(nt&&Kt.alternate!==null&&zt.delete(Kt.key===null?Yt:Kt.key),xt=at(Kt,xt,Yt),Ft===null?Vt=Kt:Ft.sibling=Kt,Ft=Kt);return nt&&zt.forEach(function(pn){return _(Rt,pn)}),I$3&&tg(Rt,Yt),Vt}function It(Rt,xt,Nt,kt){var Vt=Ka(Nt);if(typeof Vt!="function")throw Error(p$5(150));if(Nt=Vt.call(Nt),Nt==null)throw Error(p$5(151));for(var Ft=Vt=null,zt=xt,Yt=xt=0,Kt=null,qt=Nt.next();zt!==null&&!qt.done;Yt++,qt=Nt.next()){zt.index>Yt?(Kt=zt,zt=null):Kt=zt.sibling;var pn=yt(Rt,zt,qt.value,kt);if(pn===null){zt===null&&(zt=Kt);break}nt&&zt&&pn.alternate===null&&_(Rt,zt),xt=at(pn,xt,Yt),Ft===null?Vt=pn:Ft.sibling=pn,Ft=pn,zt=Kt}if(qt.done)return tt(Rt,zt),I$3&&tg(Rt,Yt),Vt;if(zt===null){for(;!qt.done;Yt++,qt=Nt.next())qt=Et(Rt,qt.value,kt),qt!==null&&(xt=at(qt,xt,Yt),Ft===null?Vt=qt:Ft.sibling=qt,Ft=qt);return I$3&&tg(Rt,Yt),Vt}for(zt=ot(Rt,zt);!qt.done;Yt++,qt=Nt.next())qt=Ct(zt,Rt,Yt,qt.value,kt),qt!==null&&(nt&&qt.alternate!==null&&zt.delete(qt.key===null?Yt:qt.key),xt=at(qt,xt,Yt),Ft===null?Vt=qt:Ft.sibling=qt,Ft=qt);return nt&&zt.forEach(function(an){return _(Rt,an)}),I$3&&tg(Rt,Yt),Vt}function Pt(Rt,xt,Nt,kt){if(typeof Nt=="object"&&Nt!==null&&Nt.type===ya&&Nt.key===null&&(Nt=Nt.props.children),typeof Nt=="object"&&Nt!==null){switch(Nt.$$typeof){case va:e:{for(var Vt=Nt.key,Ft=xt;Ft!==null;){if(Ft.key===Vt){if(Vt=Nt.type,Vt===ya){if(Ft.tag===7){tt(Rt,Ft.sibling),xt=st(Ft,Nt.props.children),xt.return=Rt,Rt=xt;break e}}else if(Ft.elementType===Vt||typeof Vt=="object"&&Vt!==null&&Vt.$$typeof===Ha&&Ng(Vt)===Ft.type){tt(Rt,Ft.sibling),xt=st(Ft,Nt.props),xt.ref=Lg(Rt,Ft,Nt),xt.return=Rt,Rt=xt;break e}tt(Rt,Ft);break}else _(Rt,Ft);Ft=Ft.sibling}Nt.type===ya?(xt=Tg(Nt.props.children,Rt.mode,kt,Nt.key),xt.return=Rt,Rt=xt):(kt=Rg(Nt.type,Nt.key,Nt.props,null,Rt.mode,kt),kt.ref=Lg(Rt,xt,Nt),kt.return=Rt,Rt=kt)}return lt(Rt);case wa:e:{for(Ft=Nt.key;xt!==null;){if(xt.key===Ft)if(xt.tag===4&&xt.stateNode.containerInfo===Nt.containerInfo&&xt.stateNode.implementation===Nt.implementation){tt(Rt,xt.sibling),xt=st(xt,Nt.children||[]),xt.return=Rt,Rt=xt;break e}else{tt(Rt,xt);break}else _(Rt,xt);xt=xt.sibling}xt=Sg(Nt,Rt.mode,kt),xt.return=Rt,Rt=xt}return lt(Rt);case Ha:return Ft=Nt._init,Pt(Rt,xt,Ft(Nt._payload),kt)}if(eb(Nt))return wt(Rt,xt,Nt,kt);if(Ka(Nt))return It(Rt,xt,Nt,kt);Mg(Rt,Nt)}return typeof Nt=="string"&&Nt!==""||typeof Nt=="number"?(Nt=""+Nt,xt!==null&&xt.tag===6?(tt(Rt,xt.sibling),xt=st(xt,Nt),xt.return=Rt,Rt=xt):(tt(Rt,xt),xt=Qg(Nt,Rt.mode,kt),xt.return=Rt,Rt=xt),lt(Rt)):tt(Rt,xt)}return Pt}var Ug=Og(!0),Vg=Og(!1),Wg=Uf(null),Xg=null,Yg=null,Zg=null;function $g(){Zg=Yg=Xg=null}function ah(nt){var _=Wg.current;E$3(Wg),nt._currentValue=_}function bh(nt,_,tt){for(;nt!==null;){var ot=nt.alternate;if((nt.childLanes&_)!==_?(nt.childLanes|=_,ot!==null&&(ot.childLanes|=_)):ot!==null&&(ot.childLanes&_)!==_&&(ot.childLanes|=_),nt===tt)break;nt=nt.return}}function ch(nt,_){Xg=nt,Zg=Yg=null,nt=nt.dependencies,nt!==null&&nt.firstContext!==null&&(nt.lanes&_&&(dh=!0),nt.firstContext=null)}function eh(nt){var _=nt._currentValue;if(Zg!==nt)if(nt={context:nt,memoizedValue:_,next:null},Yg===null){if(Xg===null)throw Error(p$5(308));Yg=nt,Xg.dependencies={lanes:0,firstContext:nt}}else Yg=Yg.next=nt;return _}var fh=null;function gh(nt){fh===null?fh=[nt]:fh.push(nt)}function hh(nt,_,tt,ot){var st=_.interleaved;return st===null?(tt.next=tt,gh(_)):(tt.next=st.next,st.next=tt),_.interleaved=tt,ih(nt,ot)}function ih(nt,_){nt.lanes|=_;var tt=nt.alternate;for(tt!==null&&(tt.lanes|=_),tt=nt,nt=nt.return;nt!==null;)nt.childLanes|=_,tt=nt.alternate,tt!==null&&(tt.childLanes|=_),tt=nt,nt=nt.return;return tt.tag===3?tt.stateNode:null}var jh=!1;function kh(nt){nt.updateQueue={baseState:nt.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function lh(nt,_){nt=nt.updateQueue,_.updateQueue===nt&&(_.updateQueue={baseState:nt.baseState,firstBaseUpdate:nt.firstBaseUpdate,lastBaseUpdate:nt.lastBaseUpdate,shared:nt.shared,effects:nt.effects})}function mh(nt,_){return{eventTime:nt,lane:_,tag:0,payload:null,callback:null,next:null}}function nh(nt,_,tt){var ot=nt.updateQueue;if(ot===null)return null;if(ot=ot.shared,K&2){var st=ot.pending;return st===null?_.next=_:(_.next=st.next,st.next=_),ot.pending=_,ih(nt,tt)}return st=ot.interleaved,st===null?(_.next=_,gh(ot)):(_.next=st.next,st.next=_),ot.interleaved=_,ih(nt,tt)}function oh(nt,_,tt){if(_=_.updateQueue,_!==null&&(_=_.shared,(tt&4194240)!==0)){var ot=_.lanes;ot&=nt.pendingLanes,tt|=ot,_.lanes=tt,Cc(nt,tt)}}function ph(nt,_){var tt=nt.updateQueue,ot=nt.alternate;if(ot!==null&&(ot=ot.updateQueue,tt===ot)){var st=null,at=null;if(tt=tt.firstBaseUpdate,tt!==null){do{var lt={eventTime:tt.eventTime,lane:tt.lane,tag:tt.tag,payload:tt.payload,callback:tt.callback,next:null};at===null?st=at=lt:at=at.next=lt,tt=tt.next}while(tt!==null);at===null?st=at=_:at=at.next=_}else st=at=_;tt={baseState:ot.baseState,firstBaseUpdate:st,lastBaseUpdate:at,shared:ot.shared,effects:ot.effects},nt.updateQueue=tt;return}nt=tt.lastBaseUpdate,nt===null?tt.firstBaseUpdate=_:nt.next=_,tt.lastBaseUpdate=_}function qh(nt,_,tt,ot){var st=nt.updateQueue;jh=!1;var at=st.firstBaseUpdate,lt=st.lastBaseUpdate,dt=st.shared.pending;if(dt!==null){st.shared.pending=null;var ht=dt,ft=ht.next;ht.next=null,lt===null?at=ft:lt.next=ft,lt=ht;var gt=nt.alternate;gt!==null&&(gt=gt.updateQueue,dt=gt.lastBaseUpdate,dt!==lt&&(dt===null?gt.firstBaseUpdate=ft:dt.next=ft,gt.lastBaseUpdate=ht))}if(at!==null){var Et=st.baseState;lt=0,gt=ft=ht=null,dt=at;do{var yt=dt.lane,Ct=dt.eventTime;if((ot&yt)===yt){gt!==null&&(gt=gt.next={eventTime:Ct,lane:0,tag:dt.tag,payload:dt.payload,callback:dt.callback,next:null});e:{var wt=nt,It=dt;switch(yt=_,Ct=tt,It.tag){case 1:if(wt=It.payload,typeof wt=="function"){Et=wt.call(Ct,Et,yt);break e}Et=wt;break e;case 3:wt.flags=wt.flags&-65537|128;case 0:if(wt=It.payload,yt=typeof wt=="function"?wt.call(Ct,Et,yt):wt,yt==null)break e;Et=A$2({},Et,yt);break e;case 2:jh=!0}}dt.callback!==null&&dt.lane!==0&&(nt.flags|=64,yt=st.effects,yt===null?st.effects=[dt]:yt.push(dt))}else Ct={eventTime:Ct,lane:yt,tag:dt.tag,payload:dt.payload,callback:dt.callback,next:null},gt===null?(ft=gt=Ct,ht=Et):gt=gt.next=Ct,lt|=yt;if(dt=dt.next,dt===null){if(dt=st.shared.pending,dt===null)break;yt=dt,dt=yt.next,yt.next=null,st.lastBaseUpdate=yt,st.shared.pending=null}}while(1);if(gt===null&&(ht=Et),st.baseState=ht,st.firstBaseUpdate=ft,st.lastBaseUpdate=gt,_=st.shared.interleaved,_!==null){st=_;do lt|=st.lane,st=st.next;while(st!==_)}else at===null&&(st.shared.lanes=0);rh|=lt,nt.lanes=lt,nt.memoizedState=Et}}function sh(nt,_,tt){if(nt=_.effects,_.effects=null,nt!==null)for(_=0;_<nt.length;_++){var ot=nt[_],st=ot.callback;if(st!==null){if(ot.callback=null,ot=tt,typeof st!="function")throw Error(p$5(191,st));st.call(ot)}}}var th={},uh=Uf(th),vh=Uf(th),wh=Uf(th);function xh(nt){if(nt===th)throw Error(p$5(174));return nt}function yh(nt,_){switch(G$1(wh,_),G$1(vh,nt),G$1(uh,th),nt=_.nodeType,nt){case 9:case 11:_=(_=_.documentElement)?_.namespaceURI:lb(null,"");break;default:nt=nt===8?_.parentNode:_,_=nt.namespaceURI||null,nt=nt.tagName,_=lb(_,nt)}E$3(uh),G$1(uh,_)}function zh(){E$3(uh),E$3(vh),E$3(wh)}function Ah(nt){xh(wh.current);var _=xh(uh.current),tt=lb(_,nt.type);_!==tt&&(G$1(vh,nt),G$1(uh,tt))}function Bh(nt){vh.current===nt&&(E$3(uh),E$3(vh))}var L$4=Uf(0);function Ch(nt){for(var _=nt;_!==null;){if(_.tag===13){var tt=_.memoizedState;if(tt!==null&&(tt=tt.dehydrated,tt===null||tt.data==="$?"||tt.data==="$!"))return _}else if(_.tag===19&&_.memoizedProps.revealOrder!==void 0){if(_.flags&128)return _}else if(_.child!==null){_.child.return=_,_=_.child;continue}if(_===nt)break;for(;_.sibling===null;){if(_.return===null||_.return===nt)return null;_=_.return}_.sibling.return=_.return,_=_.sibling}return null}var Dh=[];function Eh(){for(var nt=0;nt<Dh.length;nt++)Dh[nt]._workInProgressVersionPrimary=null;Dh.length=0}var Fh=ua.ReactCurrentDispatcher,Gh=ua.ReactCurrentBatchConfig,Hh=0,M$2=null,N$3=null,O$2=null,Ih=!1,Jh=!1,Kh=0,Lh=0;function P$2(){throw Error(p$5(321))}function Mh(nt,_){if(_===null)return!1;for(var tt=0;tt<_.length&&tt<nt.length;tt++)if(!He(nt[tt],_[tt]))return!1;return!0}function Nh(nt,_,tt,ot,st,at){if(Hh=at,M$2=_,_.memoizedState=null,_.updateQueue=null,_.lanes=0,Fh.current=nt===null||nt.memoizedState===null?Oh:Ph,nt=tt(ot,st),Jh){at=0;do{if(Jh=!1,Kh=0,25<=at)throw Error(p$5(301));at+=1,O$2=N$3=null,_.updateQueue=null,Fh.current=Qh,nt=tt(ot,st)}while(Jh)}if(Fh.current=Rh,_=N$3!==null&&N$3.next!==null,Hh=0,O$2=N$3=M$2=null,Ih=!1,_)throw Error(p$5(300));return nt}function Sh(){var nt=Kh!==0;return Kh=0,nt}function Th(){var nt={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return O$2===null?M$2.memoizedState=O$2=nt:O$2=O$2.next=nt,O$2}function Uh(){if(N$3===null){var nt=M$2.alternate;nt=nt!==null?nt.memoizedState:null}else nt=N$3.next;var _=O$2===null?M$2.memoizedState:O$2.next;if(_!==null)O$2=_,N$3=nt;else{if(nt===null)throw Error(p$5(310));N$3=nt,nt={memoizedState:N$3.memoizedState,baseState:N$3.baseState,baseQueue:N$3.baseQueue,queue:N$3.queue,next:null},O$2===null?M$2.memoizedState=O$2=nt:O$2=O$2.next=nt}return O$2}function Vh(nt,_){return typeof _=="function"?_(nt):_}function Wh(nt){var _=Uh(),tt=_.queue;if(tt===null)throw Error(p$5(311));tt.lastRenderedReducer=nt;var ot=N$3,st=ot.baseQueue,at=tt.pending;if(at!==null){if(st!==null){var lt=st.next;st.next=at.next,at.next=lt}ot.baseQueue=st=at,tt.pending=null}if(st!==null){at=st.next,ot=ot.baseState;var dt=lt=null,ht=null,ft=at;do{var gt=ft.lane;if((Hh&gt)===gt)ht!==null&&(ht=ht.next={lane:0,action:ft.action,hasEagerState:ft.hasEagerState,eagerState:ft.eagerState,next:null}),ot=ft.hasEagerState?ft.eagerState:nt(ot,ft.action);else{var Et={lane:gt,action:ft.action,hasEagerState:ft.hasEagerState,eagerState:ft.eagerState,next:null};ht===null?(dt=ht=Et,lt=ot):ht=ht.next=Et,M$2.lanes|=gt,rh|=gt}ft=ft.next}while(ft!==null&&ft!==at);ht===null?lt=ot:ht.next=dt,He(ot,_.memoizedState)||(dh=!0),_.memoizedState=ot,_.baseState=lt,_.baseQueue=ht,tt.lastRenderedState=ot}if(nt=tt.interleaved,nt!==null){st=nt;do at=st.lane,M$2.lanes|=at,rh|=at,st=st.next;while(st!==nt)}else st===null&&(tt.lanes=0);return[_.memoizedState,tt.dispatch]}function Xh(nt){var _=Uh(),tt=_.queue;if(tt===null)throw Error(p$5(311));tt.lastRenderedReducer=nt;var ot=tt.dispatch,st=tt.pending,at=_.memoizedState;if(st!==null){tt.pending=null;var lt=st=st.next;do at=nt(at,lt.action),lt=lt.next;while(lt!==st);He(at,_.memoizedState)||(dh=!0),_.memoizedState=at,_.baseQueue===null&&(_.baseState=at),tt.lastRenderedState=at}return[at,ot]}function Yh(){}function Zh(nt,_){var tt=M$2,ot=Uh(),st=_(),at=!He(ot.memoizedState,st);if(at&&(ot.memoizedState=st,dh=!0),ot=ot.queue,$h(ai.bind(null,tt,ot,nt),[nt]),ot.getSnapshot!==_||at||O$2!==null&&O$2.memoizedState.tag&1){if(tt.flags|=2048,bi(9,ci.bind(null,tt,ot,st,_),void 0,null),Q$1===null)throw Error(p$5(349));Hh&30||di(tt,_,st)}return st}function di(nt,_,tt){nt.flags|=16384,nt={getSnapshot:_,value:tt},_=M$2.updateQueue,_===null?(_={lastEffect:null,stores:null},M$2.updateQueue=_,_.stores=[nt]):(tt=_.stores,tt===null?_.stores=[nt]:tt.push(nt))}function ci(nt,_,tt,ot){_.value=tt,_.getSnapshot=ot,ei(_)&&fi(nt)}function ai(nt,_,tt){return tt(function(){ei(_)&&fi(nt)})}function ei(nt){var _=nt.getSnapshot;nt=nt.value;try{var tt=_();return!He(nt,tt)}catch{return!0}}function fi(nt){var _=ih(nt,1);_!==null&&gi(_,nt,1,-1)}function hi(nt){var _=Th();return typeof nt=="function"&&(nt=nt()),_.memoizedState=_.baseState=nt,nt={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Vh,lastRenderedState:nt},_.queue=nt,nt=nt.dispatch=ii.bind(null,M$2,nt),[_.memoizedState,nt]}function bi(nt,_,tt,ot){return nt={tag:nt,create:_,destroy:tt,deps:ot,next:null},_=M$2.updateQueue,_===null?(_={lastEffect:null,stores:null},M$2.updateQueue=_,_.lastEffect=nt.next=nt):(tt=_.lastEffect,tt===null?_.lastEffect=nt.next=nt:(ot=tt.next,tt.next=nt,nt.next=ot,_.lastEffect=nt)),nt}function ji(){return Uh().memoizedState}function ki(nt,_,tt,ot){var st=Th();M$2.flags|=nt,st.memoizedState=bi(1|_,tt,void 0,ot===void 0?null:ot)}function li(nt,_,tt,ot){var st=Uh();ot=ot===void 0?null:ot;var at=void 0;if(N$3!==null){var lt=N$3.memoizedState;if(at=lt.destroy,ot!==null&&Mh(ot,lt.deps)){st.memoizedState=bi(_,tt,at,ot);return}}M$2.flags|=nt,st.memoizedState=bi(1|_,tt,at,ot)}function mi(nt,_){return ki(8390656,8,nt,_)}function $h(nt,_){return li(2048,8,nt,_)}function ni(nt,_){return li(4,2,nt,_)}function oi(nt,_){return li(4,4,nt,_)}function pi(nt,_){if(typeof _=="function")return nt=nt(),_(nt),function(){_(null)};if(_!=null)return nt=nt(),_.current=nt,function(){_.current=null}}function qi(nt,_,tt){return tt=tt!=null?tt.concat([nt]):null,li(4,4,pi.bind(null,_,nt),tt)}function ri(){}function si(nt,_){var tt=Uh();_=_===void 0?null:_;var ot=tt.memoizedState;return ot!==null&&_!==null&&Mh(_,ot[1])?ot[0]:(tt.memoizedState=[nt,_],nt)}function ti(nt,_){var tt=Uh();_=_===void 0?null:_;var ot=tt.memoizedState;return ot!==null&&_!==null&&Mh(_,ot[1])?ot[0]:(nt=nt(),tt.memoizedState=[nt,_],nt)}function ui(nt,_,tt){return Hh&21?(He(tt,_)||(tt=yc(),M$2.lanes|=tt,rh|=tt,nt.baseState=!0),_):(nt.baseState&&(nt.baseState=!1,dh=!0),nt.memoizedState=tt)}function vi(nt,_){var tt=C$2;C$2=tt!==0&&4>tt?tt:4,nt(!0);var ot=Gh.transition;Gh.transition={};try{nt(!1),_()}finally{C$2=tt,Gh.transition=ot}}function wi(){return Uh().memoizedState}function xi(nt,_,tt){var ot=yi(nt);if(tt={lane:ot,action:tt,hasEagerState:!1,eagerState:null,next:null},zi(nt))Ai(_,tt);else if(tt=hh(nt,_,tt,ot),tt!==null){var st=R$3();gi(tt,nt,ot,st),Bi(tt,_,ot)}}function ii(nt,_,tt){var ot=yi(nt),st={lane:ot,action:tt,hasEagerState:!1,eagerState:null,next:null};if(zi(nt))Ai(_,st);else{var at=nt.alternate;if(nt.lanes===0&&(at===null||at.lanes===0)&&(at=_.lastRenderedReducer,at!==null))try{var lt=_.lastRenderedState,dt=at(lt,tt);if(st.hasEagerState=!0,st.eagerState=dt,He(dt,lt)){var ht=_.interleaved;ht===null?(st.next=st,gh(_)):(st.next=ht.next,ht.next=st),_.interleaved=st;return}}catch{}finally{}tt=hh(nt,_,st,ot),tt!==null&&(st=R$3(),gi(tt,nt,ot,st),Bi(tt,_,ot))}}function zi(nt){var _=nt.alternate;return nt===M$2||_!==null&&_===M$2}function Ai(nt,_){Jh=Ih=!0;var tt=nt.pending;tt===null?_.next=_:(_.next=tt.next,tt.next=_),nt.pending=_}function Bi(nt,_,tt){if(tt&4194240){var ot=_.lanes;ot&=nt.pendingLanes,tt|=ot,_.lanes=tt,Cc(nt,tt)}}var Rh={readContext:eh,useCallback:P$2,useContext:P$2,useEffect:P$2,useImperativeHandle:P$2,useInsertionEffect:P$2,useLayoutEffect:P$2,useMemo:P$2,useReducer:P$2,useRef:P$2,useState:P$2,useDebugValue:P$2,useDeferredValue:P$2,useTransition:P$2,useMutableSource:P$2,useSyncExternalStore:P$2,useId:P$2,unstable_isNewReconciler:!1},Oh={readContext:eh,useCallback:function(nt,_){return Th().memoizedState=[nt,_===void 0?null:_],nt},useContext:eh,useEffect:mi,useImperativeHandle:function(nt,_,tt){return tt=tt!=null?tt.concat([nt]):null,ki(4194308,4,pi.bind(null,_,nt),tt)},useLayoutEffect:function(nt,_){return ki(4194308,4,nt,_)},useInsertionEffect:function(nt,_){return ki(4,2,nt,_)},useMemo:function(nt,_){var tt=Th();return _=_===void 0?null:_,nt=nt(),tt.memoizedState=[nt,_],nt},useReducer:function(nt,_,tt){var ot=Th();return _=tt!==void 0?tt(_):_,ot.memoizedState=ot.baseState=_,nt={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:nt,lastRenderedState:_},ot.queue=nt,nt=nt.dispatch=xi.bind(null,M$2,nt),[ot.memoizedState,nt]},useRef:function(nt){var _=Th();return nt={current:nt},_.memoizedState=nt},useState:hi,useDebugValue:ri,useDeferredValue:function(nt){return Th().memoizedState=nt},useTransition:function(){var nt=hi(!1),_=nt[0];return nt=vi.bind(null,nt[1]),Th().memoizedState=nt,[_,nt]},useMutableSource:function(){},useSyncExternalStore:function(nt,_,tt){var ot=M$2,st=Th();if(I$3){if(tt===void 0)throw Error(p$5(407));tt=tt()}else{if(tt=_(),Q$1===null)throw Error(p$5(349));Hh&30||di(ot,_,tt)}st.memoizedState=tt;var at={value:tt,getSnapshot:_};return st.queue=at,mi(ai.bind(null,ot,at,nt),[nt]),ot.flags|=2048,bi(9,ci.bind(null,ot,at,tt,_),void 0,null),tt},useId:function(){var nt=Th(),_=Q$1.identifierPrefix;if(I$3){var tt=sg,ot=rg;tt=(ot&~(1<<32-oc(ot)-1)).toString(32)+tt,_=":"+_+"R"+tt,tt=Kh++,0<tt&&(_+="H"+tt.toString(32)),_+=":"}else tt=Lh++,_=":"+_+"r"+tt.toString(32)+":";return nt.memoizedState=_},unstable_isNewReconciler:!1},Ph={readContext:eh,useCallback:si,useContext:eh,useEffect:$h,useImperativeHandle:qi,useInsertionEffect:ni,useLayoutEffect:oi,useMemo:ti,useReducer:Wh,useRef:ji,useState:function(){return Wh(Vh)},useDebugValue:ri,useDeferredValue:function(nt){var _=Uh();return ui(_,N$3.memoizedState,nt)},useTransition:function(){var nt=Wh(Vh)[0],_=Uh().memoizedState;return[nt,_]},useMutableSource:Yh,useSyncExternalStore:Zh,useId:wi,unstable_isNewReconciler:!1},Qh={readContext:eh,useCallback:si,useContext:eh,useEffect:$h,useImperativeHandle:qi,useInsertionEffect:ni,useLayoutEffect:oi,useMemo:ti,useReducer:Xh,useRef:ji,useState:function(){return Xh(Vh)},useDebugValue:ri,useDeferredValue:function(nt){var _=Uh();return N$3===null?_.memoizedState=nt:ui(_,N$3.memoizedState,nt)},useTransition:function(){var nt=Xh(Vh)[0],_=Uh().memoizedState;return[nt,_]},useMutableSource:Yh,useSyncExternalStore:Zh,useId:wi,unstable_isNewReconciler:!1};function Ci(nt,_){if(nt&&nt.defaultProps){_=A$2({},_),nt=nt.defaultProps;for(var tt in nt)_[tt]===void 0&&(_[tt]=nt[tt]);return _}return _}function Di(nt,_,tt,ot){_=nt.memoizedState,tt=tt(ot,_),tt=tt==null?_:A$2({},_,tt),nt.memoizedState=tt,nt.lanes===0&&(nt.updateQueue.baseState=tt)}var Ei={isMounted:function(nt){return(nt=nt._reactInternals)?Vb(nt)===nt:!1},enqueueSetState:function(nt,_,tt){nt=nt._reactInternals;var ot=R$3(),st=yi(nt),at=mh(ot,st);at.payload=_,tt!=null&&(at.callback=tt),_=nh(nt,at,st),_!==null&&(gi(_,nt,st,ot),oh(_,nt,st))},enqueueReplaceState:function(nt,_,tt){nt=nt._reactInternals;var ot=R$3(),st=yi(nt),at=mh(ot,st);at.tag=1,at.payload=_,tt!=null&&(at.callback=tt),_=nh(nt,at,st),_!==null&&(gi(_,nt,st,ot),oh(_,nt,st))},enqueueForceUpdate:function(nt,_){nt=nt._reactInternals;var tt=R$3(),ot=yi(nt),st=mh(tt,ot);st.tag=2,_!=null&&(st.callback=_),_=nh(nt,st,ot),_!==null&&(gi(_,nt,ot,tt),oh(_,nt,ot))}};function Fi(nt,_,tt,ot,st,at,lt){return nt=nt.stateNode,typeof nt.shouldComponentUpdate=="function"?nt.shouldComponentUpdate(ot,at,lt):_.prototype&&_.prototype.isPureReactComponent?!Ie(tt,ot)||!Ie(st,at):!0}function Gi(nt,_,tt){var ot=!1,st=Vf,at=_.contextType;return typeof at=="object"&&at!==null?at=eh(at):(st=Zf(_)?Xf:H$3.current,ot=_.contextTypes,at=(ot=ot!=null)?Yf(nt,st):Vf),_=new _(tt,at),nt.memoizedState=_.state!==null&&_.state!==void 0?_.state:null,_.updater=Ei,nt.stateNode=_,_._reactInternals=nt,ot&&(nt=nt.stateNode,nt.__reactInternalMemoizedUnmaskedChildContext=st,nt.__reactInternalMemoizedMaskedChildContext=at),_}function Hi(nt,_,tt,ot){nt=_.state,typeof _.componentWillReceiveProps=="function"&&_.componentWillReceiveProps(tt,ot),typeof _.UNSAFE_componentWillReceiveProps=="function"&&_.UNSAFE_componentWillReceiveProps(tt,ot),_.state!==nt&&Ei.enqueueReplaceState(_,_.state,null)}function Ii(nt,_,tt,ot){var st=nt.stateNode;st.props=tt,st.state=nt.memoizedState,st.refs={},kh(nt);var at=_.contextType;typeof at=="object"&&at!==null?st.context=eh(at):(at=Zf(_)?Xf:H$3.current,st.context=Yf(nt,at)),st.state=nt.memoizedState,at=_.getDerivedStateFromProps,typeof at=="function"&&(Di(nt,_,at,tt),st.state=nt.memoizedState),typeof _.getDerivedStateFromProps=="function"||typeof st.getSnapshotBeforeUpdate=="function"||typeof st.UNSAFE_componentWillMount!="function"&&typeof st.componentWillMount!="function"||(_=st.state,typeof st.componentWillMount=="function"&&st.componentWillMount(),typeof st.UNSAFE_componentWillMount=="function"&&st.UNSAFE_componentWillMount(),_!==st.state&&Ei.enqueueReplaceState(st,st.state,null),qh(nt,tt,st,ot),st.state=nt.memoizedState),typeof st.componentDidMount=="function"&&(nt.flags|=4194308)}function Ji(nt,_){try{var tt="",ot=_;do tt+=Pa(ot),ot=ot.return;while(ot);var st=tt}catch(at){st=`
Error generating stack: `+at.message+`
`+at.stack}return{value:nt,source:_,stack:st,digest:null}}function Ki(nt,_,tt){return{value:nt,source:null,stack:tt??null,digest:_??null}}function Li(nt,_){try{console.error(_.value)}catch(tt){setTimeout(function(){throw tt})}}var Mi=typeof WeakMap=="function"?WeakMap:Map;function Ni(nt,_,tt){tt=mh(-1,tt),tt.tag=3,tt.payload={element:null};var ot=_.value;return tt.callback=function(){Oi||(Oi=!0,Pi=ot),Li(nt,_)},tt}function Qi(nt,_,tt){tt=mh(-1,tt),tt.tag=3;var ot=nt.type.getDerivedStateFromError;if(typeof ot=="function"){var st=_.value;tt.payload=function(){return ot(st)},tt.callback=function(){Li(nt,_)}}var at=nt.stateNode;return at!==null&&typeof at.componentDidCatch=="function"&&(tt.callback=function(){Li(nt,_),typeof ot!="function"&&(Ri===null?Ri=new Set([this]):Ri.add(this));var lt=_.stack;this.componentDidCatch(_.value,{componentStack:lt!==null?lt:""})}),tt}function Si(nt,_,tt){var ot=nt.pingCache;if(ot===null){ot=nt.pingCache=new Mi;var st=new Set;ot.set(_,st)}else st=ot.get(_),st===void 0&&(st=new Set,ot.set(_,st));st.has(tt)||(st.add(tt),nt=Ti.bind(null,nt,_,tt),_.then(nt,nt))}function Ui(nt){do{var _;if((_=nt.tag===13)&&(_=nt.memoizedState,_=_!==null?_.dehydrated!==null:!0),_)return nt;nt=nt.return}while(nt!==null);return null}function Vi(nt,_,tt,ot,st){return nt.mode&1?(nt.flags|=65536,nt.lanes=st,nt):(nt===_?nt.flags|=65536:(nt.flags|=128,tt.flags|=131072,tt.flags&=-52805,tt.tag===1&&(tt.alternate===null?tt.tag=17:(_=mh(-1,1),_.tag=2,nh(tt,_,1))),tt.lanes|=1),nt)}var Wi=ua.ReactCurrentOwner,dh=!1;function Xi(nt,_,tt,ot){_.child=nt===null?Vg(_,null,tt,ot):Ug(_,nt.child,tt,ot)}function Yi(nt,_,tt,ot,st){tt=tt.render;var at=_.ref;return ch(_,st),ot=Nh(nt,_,tt,ot,at,st),tt=Sh(),nt!==null&&!dh?(_.updateQueue=nt.updateQueue,_.flags&=-2053,nt.lanes&=~st,Zi(nt,_,st)):(I$3&&tt&&vg(_),_.flags|=1,Xi(nt,_,ot,st),_.child)}function $i(nt,_,tt,ot,st){if(nt===null){var at=tt.type;return typeof at=="function"&&!aj(at)&&at.defaultProps===void 0&&tt.compare===null&&tt.defaultProps===void 0?(_.tag=15,_.type=at,bj(nt,_,at,ot,st)):(nt=Rg(tt.type,null,ot,_,_.mode,st),nt.ref=_.ref,nt.return=_,_.child=nt)}if(at=nt.child,!(nt.lanes&st)){var lt=at.memoizedProps;if(tt=tt.compare,tt=tt!==null?tt:Ie,tt(lt,ot)&&nt.ref===_.ref)return Zi(nt,_,st)}return _.flags|=1,nt=Pg(at,ot),nt.ref=_.ref,nt.return=_,_.child=nt}function bj(nt,_,tt,ot,st){if(nt!==null){var at=nt.memoizedProps;if(Ie(at,ot)&&nt.ref===_.ref)if(dh=!1,_.pendingProps=ot=at,(nt.lanes&st)!==0)nt.flags&131072&&(dh=!0);else return _.lanes=nt.lanes,Zi(nt,_,st)}return cj(nt,_,tt,ot,st)}function dj(nt,_,tt){var ot=_.pendingProps,st=ot.children,at=nt!==null?nt.memoizedState:null;if(ot.mode==="hidden")if(!(_.mode&1))_.memoizedState={baseLanes:0,cachePool:null,transitions:null},G$1(ej,fj),fj|=tt;else{if(!(tt&1073741824))return nt=at!==null?at.baseLanes|tt:tt,_.lanes=_.childLanes=1073741824,_.memoizedState={baseLanes:nt,cachePool:null,transitions:null},_.updateQueue=null,G$1(ej,fj),fj|=nt,null;_.memoizedState={baseLanes:0,cachePool:null,transitions:null},ot=at!==null?at.baseLanes:tt,G$1(ej,fj),fj|=ot}else at!==null?(ot=at.baseLanes|tt,_.memoizedState=null):ot=tt,G$1(ej,fj),fj|=ot;return Xi(nt,_,st,tt),_.child}function gj(nt,_){var tt=_.ref;(nt===null&&tt!==null||nt!==null&&nt.ref!==tt)&&(_.flags|=512,_.flags|=2097152)}function cj(nt,_,tt,ot,st){var at=Zf(tt)?Xf:H$3.current;return at=Yf(_,at),ch(_,st),tt=Nh(nt,_,tt,ot,at,st),ot=Sh(),nt!==null&&!dh?(_.updateQueue=nt.updateQueue,_.flags&=-2053,nt.lanes&=~st,Zi(nt,_,st)):(I$3&&ot&&vg(_),_.flags|=1,Xi(nt,_,tt,st),_.child)}function hj(nt,_,tt,ot,st){if(Zf(tt)){var at=!0;cg(_)}else at=!1;if(ch(_,st),_.stateNode===null)ij(nt,_),Gi(_,tt,ot),Ii(_,tt,ot,st),ot=!0;else if(nt===null){var lt=_.stateNode,dt=_.memoizedProps;lt.props=dt;var ht=lt.context,ft=tt.contextType;typeof ft=="object"&&ft!==null?ft=eh(ft):(ft=Zf(tt)?Xf:H$3.current,ft=Yf(_,ft));var gt=tt.getDerivedStateFromProps,Et=typeof gt=="function"||typeof lt.getSnapshotBeforeUpdate=="function";Et||typeof lt.UNSAFE_componentWillReceiveProps!="function"&&typeof lt.componentWillReceiveProps!="function"||(dt!==ot||ht!==ft)&&Hi(_,lt,ot,ft),jh=!1;var yt=_.memoizedState;lt.state=yt,qh(_,ot,lt,st),ht=_.memoizedState,dt!==ot||yt!==ht||Wf.current||jh?(typeof gt=="function"&&(Di(_,tt,gt,ot),ht=_.memoizedState),(dt=jh||Fi(_,tt,dt,ot,yt,ht,ft))?(Et||typeof lt.UNSAFE_componentWillMount!="function"&&typeof lt.componentWillMount!="function"||(typeof lt.componentWillMount=="function"&&lt.componentWillMount(),typeof lt.UNSAFE_componentWillMount=="function"&&lt.UNSAFE_componentWillMount()),typeof lt.componentDidMount=="function"&&(_.flags|=4194308)):(typeof lt.componentDidMount=="function"&&(_.flags|=4194308),_.memoizedProps=ot,_.memoizedState=ht),lt.props=ot,lt.state=ht,lt.context=ft,ot=dt):(typeof lt.componentDidMount=="function"&&(_.flags|=4194308),ot=!1)}else{lt=_.stateNode,lh(nt,_),dt=_.memoizedProps,ft=_.type===_.elementType?dt:Ci(_.type,dt),lt.props=ft,Et=_.pendingProps,yt=lt.context,ht=tt.contextType,typeof ht=="object"&&ht!==null?ht=eh(ht):(ht=Zf(tt)?Xf:H$3.current,ht=Yf(_,ht));var Ct=tt.getDerivedStateFromProps;(gt=typeof Ct=="function"||typeof lt.getSnapshotBeforeUpdate=="function")||typeof lt.UNSAFE_componentWillReceiveProps!="function"&&typeof lt.componentWillReceiveProps!="function"||(dt!==Et||yt!==ht)&&Hi(_,lt,ot,ht),jh=!1,yt=_.memoizedState,lt.state=yt,qh(_,ot,lt,st);var wt=_.memoizedState;dt!==Et||yt!==wt||Wf.current||jh?(typeof Ct=="function"&&(Di(_,tt,Ct,ot),wt=_.memoizedState),(ft=jh||Fi(_,tt,ft,ot,yt,wt,ht)||!1)?(gt||typeof lt.UNSAFE_componentWillUpdate!="function"&&typeof lt.componentWillUpdate!="function"||(typeof lt.componentWillUpdate=="function"&&lt.componentWillUpdate(ot,wt,ht),typeof lt.UNSAFE_componentWillUpdate=="function"&&lt.UNSAFE_componentWillUpdate(ot,wt,ht)),typeof lt.componentDidUpdate=="function"&&(_.flags|=4),typeof lt.getSnapshotBeforeUpdate=="function"&&(_.flags|=1024)):(typeof lt.componentDidUpdate!="function"||dt===nt.memoizedProps&&yt===nt.memoizedState||(_.flags|=4),typeof lt.getSnapshotBeforeUpdate!="function"||dt===nt.memoizedProps&&yt===nt.memoizedState||(_.flags|=1024),_.memoizedProps=ot,_.memoizedState=wt),lt.props=ot,lt.state=wt,lt.context=ht,ot=ft):(typeof lt.componentDidUpdate!="function"||dt===nt.memoizedProps&&yt===nt.memoizedState||(_.flags|=4),typeof lt.getSnapshotBeforeUpdate!="function"||dt===nt.memoizedProps&&yt===nt.memoizedState||(_.flags|=1024),ot=!1)}return jj(nt,_,tt,ot,at,st)}function jj(nt,_,tt,ot,st,at){gj(nt,_);var lt=(_.flags&128)!==0;if(!ot&&!lt)return st&&dg(_,tt,!1),Zi(nt,_,at);ot=_.stateNode,Wi.current=_;var dt=lt&&typeof tt.getDerivedStateFromError!="function"?null:ot.render();return _.flags|=1,nt!==null&&lt?(_.child=Ug(_,nt.child,null,at),_.child=Ug(_,null,dt,at)):Xi(nt,_,dt,at),_.memoizedState=ot.state,st&&dg(_,tt,!0),_.child}function kj(nt){var _=nt.stateNode;_.pendingContext?ag(nt,_.pendingContext,_.pendingContext!==_.context):_.context&&ag(nt,_.context,!1),yh(nt,_.containerInfo)}function lj(nt,_,tt,ot,st){return Ig(),Jg(st),_.flags|=256,Xi(nt,_,tt,ot),_.child}var mj={dehydrated:null,treeContext:null,retryLane:0};function nj(nt){return{baseLanes:nt,cachePool:null,transitions:null}}function oj(nt,_,tt){var ot=_.pendingProps,st=L$4.current,at=!1,lt=(_.flags&128)!==0,dt;if((dt=lt)||(dt=nt!==null&&nt.memoizedState===null?!1:(st&2)!==0),dt?(at=!0,_.flags&=-129):(nt===null||nt.memoizedState!==null)&&(st|=1),G$1(L$4,st&1),nt===null)return Eg(_),nt=_.memoizedState,nt!==null&&(nt=nt.dehydrated,nt!==null)?(_.mode&1?nt.data==="$!"?_.lanes=8:_.lanes=1073741824:_.lanes=1,null):(lt=ot.children,nt=ot.fallback,at?(ot=_.mode,at=_.child,lt={mode:"hidden",children:lt},!(ot&1)&&at!==null?(at.childLanes=0,at.pendingProps=lt):at=pj(lt,ot,0,null),nt=Tg(nt,ot,tt,null),at.return=_,nt.return=_,at.sibling=nt,_.child=at,_.child.memoizedState=nj(tt),_.memoizedState=mj,nt):qj(_,lt));if(st=nt.memoizedState,st!==null&&(dt=st.dehydrated,dt!==null))return rj(nt,_,lt,ot,dt,st,tt);if(at){at=ot.fallback,lt=_.mode,st=nt.child,dt=st.sibling;var ht={mode:"hidden",children:ot.children};return!(lt&1)&&_.child!==st?(ot=_.child,ot.childLanes=0,ot.pendingProps=ht,_.deletions=null):(ot=Pg(st,ht),ot.subtreeFlags=st.subtreeFlags&14680064),dt!==null?at=Pg(dt,at):(at=Tg(at,lt,tt,null),at.flags|=2),at.return=_,ot.return=_,ot.sibling=at,_.child=ot,ot=at,at=_.child,lt=nt.child.memoizedState,lt=lt===null?nj(tt):{baseLanes:lt.baseLanes|tt,cachePool:null,transitions:lt.transitions},at.memoizedState=lt,at.childLanes=nt.childLanes&~tt,_.memoizedState=mj,ot}return at=nt.child,nt=at.sibling,ot=Pg(at,{mode:"visible",children:ot.children}),!(_.mode&1)&&(ot.lanes=tt),ot.return=_,ot.sibling=null,nt!==null&&(tt=_.deletions,tt===null?(_.deletions=[nt],_.flags|=16):tt.push(nt)),_.child=ot,_.memoizedState=null,ot}function qj(nt,_){return _=pj({mode:"visible",children:_},nt.mode,0,null),_.return=nt,nt.child=_}function sj(nt,_,tt,ot){return ot!==null&&Jg(ot),Ug(_,nt.child,null,tt),nt=qj(_,_.pendingProps.children),nt.flags|=2,_.memoizedState=null,nt}function rj(nt,_,tt,ot,st,at,lt){if(tt)return _.flags&256?(_.flags&=-257,ot=Ki(Error(p$5(422))),sj(nt,_,lt,ot)):_.memoizedState!==null?(_.child=nt.child,_.flags|=128,null):(at=ot.fallback,st=_.mode,ot=pj({mode:"visible",children:ot.children},st,0,null),at=Tg(at,st,lt,null),at.flags|=2,ot.return=_,at.return=_,ot.sibling=at,_.child=ot,_.mode&1&&Ug(_,nt.child,null,lt),_.child.memoizedState=nj(lt),_.memoizedState=mj,at);if(!(_.mode&1))return sj(nt,_,lt,null);if(st.data==="$!"){if(ot=st.nextSibling&&st.nextSibling.dataset,ot)var dt=ot.dgst;return ot=dt,at=Error(p$5(419)),ot=Ki(at,ot,void 0),sj(nt,_,lt,ot)}if(dt=(lt&nt.childLanes)!==0,dh||dt){if(ot=Q$1,ot!==null){switch(lt&-lt){case 4:st=2;break;case 16:st=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:st=32;break;case 536870912:st=268435456;break;default:st=0}st=st&(ot.suspendedLanes|lt)?0:st,st!==0&&st!==at.retryLane&&(at.retryLane=st,ih(nt,st),gi(ot,nt,st,-1))}return tj(),ot=Ki(Error(p$5(421))),sj(nt,_,lt,ot)}return st.data==="$?"?(_.flags|=128,_.child=nt.child,_=uj.bind(null,nt),st._reactRetry=_,null):(nt=at.treeContext,yg=Lf(st.nextSibling),xg=_,I$3=!0,zg=null,nt!==null&&(og[pg++]=rg,og[pg++]=sg,og[pg++]=qg,rg=nt.id,sg=nt.overflow,qg=_),_=qj(_,ot.children),_.flags|=4096,_)}function vj(nt,_,tt){nt.lanes|=_;var ot=nt.alternate;ot!==null&&(ot.lanes|=_),bh(nt.return,_,tt)}function wj(nt,_,tt,ot,st){var at=nt.memoizedState;at===null?nt.memoizedState={isBackwards:_,rendering:null,renderingStartTime:0,last:ot,tail:tt,tailMode:st}:(at.isBackwards=_,at.rendering=null,at.renderingStartTime=0,at.last=ot,at.tail=tt,at.tailMode=st)}function xj(nt,_,tt){var ot=_.pendingProps,st=ot.revealOrder,at=ot.tail;if(Xi(nt,_,ot.children,tt),ot=L$4.current,ot&2)ot=ot&1|2,_.flags|=128;else{if(nt!==null&&nt.flags&128)e:for(nt=_.child;nt!==null;){if(nt.tag===13)nt.memoizedState!==null&&vj(nt,tt,_);else if(nt.tag===19)vj(nt,tt,_);else if(nt.child!==null){nt.child.return=nt,nt=nt.child;continue}if(nt===_)break e;for(;nt.sibling===null;){if(nt.return===null||nt.return===_)break e;nt=nt.return}nt.sibling.return=nt.return,nt=nt.sibling}ot&=1}if(G$1(L$4,ot),!(_.mode&1))_.memoizedState=null;else switch(st){case"forwards":for(tt=_.child,st=null;tt!==null;)nt=tt.alternate,nt!==null&&Ch(nt)===null&&(st=tt),tt=tt.sibling;tt=st,tt===null?(st=_.child,_.child=null):(st=tt.sibling,tt.sibling=null),wj(_,!1,st,tt,at);break;case"backwards":for(tt=null,st=_.child,_.child=null;st!==null;){if(nt=st.alternate,nt!==null&&Ch(nt)===null){_.child=st;break}nt=st.sibling,st.sibling=tt,tt=st,st=nt}wj(_,!0,tt,null,at);break;case"together":wj(_,!1,null,null,void 0);break;default:_.memoizedState=null}return _.child}function ij(nt,_){!(_.mode&1)&&nt!==null&&(nt.alternate=null,_.alternate=null,_.flags|=2)}function Zi(nt,_,tt){if(nt!==null&&(_.dependencies=nt.dependencies),rh|=_.lanes,!(tt&_.childLanes))return null;if(nt!==null&&_.child!==nt.child)throw Error(p$5(153));if(_.child!==null){for(nt=_.child,tt=Pg(nt,nt.pendingProps),_.child=tt,tt.return=_;nt.sibling!==null;)nt=nt.sibling,tt=tt.sibling=Pg(nt,nt.pendingProps),tt.return=_;tt.sibling=null}return _.child}function yj(nt,_,tt){switch(_.tag){case 3:kj(_),Ig();break;case 5:Ah(_);break;case 1:Zf(_.type)&&cg(_);break;case 4:yh(_,_.stateNode.containerInfo);break;case 10:var ot=_.type._context,st=_.memoizedProps.value;G$1(Wg,ot._currentValue),ot._currentValue=st;break;case 13:if(ot=_.memoizedState,ot!==null)return ot.dehydrated!==null?(G$1(L$4,L$4.current&1),_.flags|=128,null):tt&_.child.childLanes?oj(nt,_,tt):(G$1(L$4,L$4.current&1),nt=Zi(nt,_,tt),nt!==null?nt.sibling:null);G$1(L$4,L$4.current&1);break;case 19:if(ot=(tt&_.childLanes)!==0,nt.flags&128){if(ot)return xj(nt,_,tt);_.flags|=128}if(st=_.memoizedState,st!==null&&(st.rendering=null,st.tail=null,st.lastEffect=null),G$1(L$4,L$4.current),ot)break;return null;case 22:case 23:return _.lanes=0,dj(nt,_,tt)}return Zi(nt,_,tt)}var zj,Aj,Bj,Cj;zj=function(nt,_){for(var tt=_.child;tt!==null;){if(tt.tag===5||tt.tag===6)nt.appendChild(tt.stateNode);else if(tt.tag!==4&&tt.child!==null){tt.child.return=tt,tt=tt.child;continue}if(tt===_)break;for(;tt.sibling===null;){if(tt.return===null||tt.return===_)return;tt=tt.return}tt.sibling.return=tt.return,tt=tt.sibling}};Aj=function(){};Bj=function(nt,_,tt,ot){var st=nt.memoizedProps;if(st!==ot){nt=_.stateNode,xh(uh.current);var at=null;switch(tt){case"input":st=Ya(nt,st),ot=Ya(nt,ot),at=[];break;case"select":st=A$2({},st,{value:void 0}),ot=A$2({},ot,{value:void 0}),at=[];break;case"textarea":st=gb(nt,st),ot=gb(nt,ot),at=[];break;default:typeof st.onClick!="function"&&typeof ot.onClick=="function"&&(nt.onclick=Bf)}ub(tt,ot);var lt;tt=null;for(ft in st)if(!ot.hasOwnProperty(ft)&&st.hasOwnProperty(ft)&&st[ft]!=null)if(ft==="style"){var dt=st[ft];for(lt in dt)dt.hasOwnProperty(lt)&&(tt||(tt={}),tt[lt]="")}else ft!=="dangerouslySetInnerHTML"&&ft!=="children"&&ft!=="suppressContentEditableWarning"&&ft!=="suppressHydrationWarning"&&ft!=="autoFocus"&&(ea.hasOwnProperty(ft)?at||(at=[]):(at=at||[]).push(ft,null));for(ft in ot){var ht=ot[ft];if(dt=st!=null?st[ft]:void 0,ot.hasOwnProperty(ft)&&ht!==dt&&(ht!=null||dt!=null))if(ft==="style")if(dt){for(lt in dt)!dt.hasOwnProperty(lt)||ht&&ht.hasOwnProperty(lt)||(tt||(tt={}),tt[lt]="");for(lt in ht)ht.hasOwnProperty(lt)&&dt[lt]!==ht[lt]&&(tt||(tt={}),tt[lt]=ht[lt])}else tt||(at||(at=[]),at.push(ft,tt)),tt=ht;else ft==="dangerouslySetInnerHTML"?(ht=ht?ht.__html:void 0,dt=dt?dt.__html:void 0,ht!=null&&dt!==ht&&(at=at||[]).push(ft,ht)):ft==="children"?typeof ht!="string"&&typeof ht!="number"||(at=at||[]).push(ft,""+ht):ft!=="suppressContentEditableWarning"&&ft!=="suppressHydrationWarning"&&(ea.hasOwnProperty(ft)?(ht!=null&&ft==="onScroll"&&D$4("scroll",nt),at||dt===ht||(at=[])):(at=at||[]).push(ft,ht))}tt&&(at=at||[]).push("style",tt);var ft=at;(_.updateQueue=ft)&&(_.flags|=4)}};Cj=function(nt,_,tt,ot){tt!==ot&&(_.flags|=4)};function Dj(nt,_){if(!I$3)switch(nt.tailMode){case"hidden":_=nt.tail;for(var tt=null;_!==null;)_.alternate!==null&&(tt=_),_=_.sibling;tt===null?nt.tail=null:tt.sibling=null;break;case"collapsed":tt=nt.tail;for(var ot=null;tt!==null;)tt.alternate!==null&&(ot=tt),tt=tt.sibling;ot===null?_||nt.tail===null?nt.tail=null:nt.tail.sibling=null:ot.sibling=null}}function S$4(nt){var _=nt.alternate!==null&&nt.alternate.child===nt.child,tt=0,ot=0;if(_)for(var st=nt.child;st!==null;)tt|=st.lanes|st.childLanes,ot|=st.subtreeFlags&14680064,ot|=st.flags&14680064,st.return=nt,st=st.sibling;else for(st=nt.child;st!==null;)tt|=st.lanes|st.childLanes,ot|=st.subtreeFlags,ot|=st.flags,st.return=nt,st=st.sibling;return nt.subtreeFlags|=ot,nt.childLanes=tt,_}function Ej(nt,_,tt){var ot=_.pendingProps;switch(wg(_),_.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return S$4(_),null;case 1:return Zf(_.type)&&$f(),S$4(_),null;case 3:return ot=_.stateNode,zh(),E$3(Wf),E$3(H$3),Eh(),ot.pendingContext&&(ot.context=ot.pendingContext,ot.pendingContext=null),(nt===null||nt.child===null)&&(Gg(_)?_.flags|=4:nt===null||nt.memoizedState.isDehydrated&&!(_.flags&256)||(_.flags|=1024,zg!==null&&(Fj(zg),zg=null))),Aj(nt,_),S$4(_),null;case 5:Bh(_);var st=xh(wh.current);if(tt=_.type,nt!==null&&_.stateNode!=null)Bj(nt,_,tt,ot,st),nt.ref!==_.ref&&(_.flags|=512,_.flags|=2097152);else{if(!ot){if(_.stateNode===null)throw Error(p$5(166));return S$4(_),null}if(nt=xh(uh.current),Gg(_)){ot=_.stateNode,tt=_.type;var at=_.memoizedProps;switch(ot[Of]=_,ot[Pf]=at,nt=(_.mode&1)!==0,tt){case"dialog":D$4("cancel",ot),D$4("close",ot);break;case"iframe":case"object":case"embed":D$4("load",ot);break;case"video":case"audio":for(st=0;st<lf.length;st++)D$4(lf[st],ot);break;case"source":D$4("error",ot);break;case"img":case"image":case"link":D$4("error",ot),D$4("load",ot);break;case"details":D$4("toggle",ot);break;case"input":Za(ot,at),D$4("invalid",ot);break;case"select":ot._wrapperState={wasMultiple:!!at.multiple},D$4("invalid",ot);break;case"textarea":hb(ot,at),D$4("invalid",ot)}ub(tt,at),st=null;for(var lt in at)if(at.hasOwnProperty(lt)){var dt=at[lt];lt==="children"?typeof dt=="string"?ot.textContent!==dt&&(at.suppressHydrationWarning!==!0&&Af(ot.textContent,dt,nt),st=["children",dt]):typeof dt=="number"&&ot.textContent!==""+dt&&(at.suppressHydrationWarning!==!0&&Af(ot.textContent,dt,nt),st=["children",""+dt]):ea.hasOwnProperty(lt)&&dt!=null&&lt==="onScroll"&&D$4("scroll",ot)}switch(tt){case"input":Va(ot),db(ot,at,!0);break;case"textarea":Va(ot),jb(ot);break;case"select":case"option":break;default:typeof at.onClick=="function"&&(ot.onclick=Bf)}ot=st,_.updateQueue=ot,ot!==null&&(_.flags|=4)}else{lt=st.nodeType===9?st:st.ownerDocument,nt==="http://www.w3.org/1999/xhtml"&&(nt=kb(tt)),nt==="http://www.w3.org/1999/xhtml"?tt==="script"?(nt=lt.createElement("div"),nt.innerHTML="<script><\/script>",nt=nt.removeChild(nt.firstChild)):typeof ot.is=="string"?nt=lt.createElement(tt,{is:ot.is}):(nt=lt.createElement(tt),tt==="select"&&(lt=nt,ot.multiple?lt.multiple=!0:ot.size&&(lt.size=ot.size))):nt=lt.createElementNS(nt,tt),nt[Of]=_,nt[Pf]=ot,zj(nt,_,!1,!1),_.stateNode=nt;e:{switch(lt=vb(tt,ot),tt){case"dialog":D$4("cancel",nt),D$4("close",nt),st=ot;break;case"iframe":case"object":case"embed":D$4("load",nt),st=ot;break;case"video":case"audio":for(st=0;st<lf.length;st++)D$4(lf[st],nt);st=ot;break;case"source":D$4("error",nt),st=ot;break;case"img":case"image":case"link":D$4("error",nt),D$4("load",nt),st=ot;break;case"details":D$4("toggle",nt),st=ot;break;case"input":Za(nt,ot),st=Ya(nt,ot),D$4("invalid",nt);break;case"option":st=ot;break;case"select":nt._wrapperState={wasMultiple:!!ot.multiple},st=A$2({},ot,{value:void 0}),D$4("invalid",nt);break;case"textarea":hb(nt,ot),st=gb(nt,ot),D$4("invalid",nt);break;default:st=ot}ub(tt,st),dt=st;for(at in dt)if(dt.hasOwnProperty(at)){var ht=dt[at];at==="style"?sb(nt,ht):at==="dangerouslySetInnerHTML"?(ht=ht?ht.__html:void 0,ht!=null&&nb(nt,ht)):at==="children"?typeof ht=="string"?(tt!=="textarea"||ht!=="")&&ob(nt,ht):typeof ht=="number"&&ob(nt,""+ht):at!=="suppressContentEditableWarning"&&at!=="suppressHydrationWarning"&&at!=="autoFocus"&&(ea.hasOwnProperty(at)?ht!=null&&at==="onScroll"&&D$4("scroll",nt):ht!=null&&ta(nt,at,ht,lt))}switch(tt){case"input":Va(nt),db(nt,ot,!1);break;case"textarea":Va(nt),jb(nt);break;case"option":ot.value!=null&&nt.setAttribute("value",""+Sa(ot.value));break;case"select":nt.multiple=!!ot.multiple,at=ot.value,at!=null?fb(nt,!!ot.multiple,at,!1):ot.defaultValue!=null&&fb(nt,!!ot.multiple,ot.defaultValue,!0);break;default:typeof st.onClick=="function"&&(nt.onclick=Bf)}switch(tt){case"button":case"input":case"select":case"textarea":ot=!!ot.autoFocus;break e;case"img":ot=!0;break e;default:ot=!1}}ot&&(_.flags|=4)}_.ref!==null&&(_.flags|=512,_.flags|=2097152)}return S$4(_),null;case 6:if(nt&&_.stateNode!=null)Cj(nt,_,nt.memoizedProps,ot);else{if(typeof ot!="string"&&_.stateNode===null)throw Error(p$5(166));if(tt=xh(wh.current),xh(uh.current),Gg(_)){if(ot=_.stateNode,tt=_.memoizedProps,ot[Of]=_,(at=ot.nodeValue!==tt)&&(nt=xg,nt!==null))switch(nt.tag){case 3:Af(ot.nodeValue,tt,(nt.mode&1)!==0);break;case 5:nt.memoizedProps.suppressHydrationWarning!==!0&&Af(ot.nodeValue,tt,(nt.mode&1)!==0)}at&&(_.flags|=4)}else ot=(tt.nodeType===9?tt:tt.ownerDocument).createTextNode(ot),ot[Of]=_,_.stateNode=ot}return S$4(_),null;case 13:if(E$3(L$4),ot=_.memoizedState,nt===null||nt.memoizedState!==null&&nt.memoizedState.dehydrated!==null){if(I$3&&yg!==null&&_.mode&1&&!(_.flags&128))Hg(),Ig(),_.flags|=98560,at=!1;else if(at=Gg(_),ot!==null&&ot.dehydrated!==null){if(nt===null){if(!at)throw Error(p$5(318));if(at=_.memoizedState,at=at!==null?at.dehydrated:null,!at)throw Error(p$5(317));at[Of]=_}else Ig(),!(_.flags&128)&&(_.memoizedState=null),_.flags|=4;S$4(_),at=!1}else zg!==null&&(Fj(zg),zg=null),at=!0;if(!at)return _.flags&65536?_:null}return _.flags&128?(_.lanes=tt,_):(ot=ot!==null,ot!==(nt!==null&&nt.memoizedState!==null)&&ot&&(_.child.flags|=8192,_.mode&1&&(nt===null||L$4.current&1?T$4===0&&(T$4=3):tj())),_.updateQueue!==null&&(_.flags|=4),S$4(_),null);case 4:return zh(),Aj(nt,_),nt===null&&sf(_.stateNode.containerInfo),S$4(_),null;case 10:return ah(_.type._context),S$4(_),null;case 17:return Zf(_.type)&&$f(),S$4(_),null;case 19:if(E$3(L$4),at=_.memoizedState,at===null)return S$4(_),null;if(ot=(_.flags&128)!==0,lt=at.rendering,lt===null)if(ot)Dj(at,!1);else{if(T$4!==0||nt!==null&&nt.flags&128)for(nt=_.child;nt!==null;){if(lt=Ch(nt),lt!==null){for(_.flags|=128,Dj(at,!1),ot=lt.updateQueue,ot!==null&&(_.updateQueue=ot,_.flags|=4),_.subtreeFlags=0,ot=tt,tt=_.child;tt!==null;)at=tt,nt=ot,at.flags&=14680066,lt=at.alternate,lt===null?(at.childLanes=0,at.lanes=nt,at.child=null,at.subtreeFlags=0,at.memoizedProps=null,at.memoizedState=null,at.updateQueue=null,at.dependencies=null,at.stateNode=null):(at.childLanes=lt.childLanes,at.lanes=lt.lanes,at.child=lt.child,at.subtreeFlags=0,at.deletions=null,at.memoizedProps=lt.memoizedProps,at.memoizedState=lt.memoizedState,at.updateQueue=lt.updateQueue,at.type=lt.type,nt=lt.dependencies,at.dependencies=nt===null?null:{lanes:nt.lanes,firstContext:nt.firstContext}),tt=tt.sibling;return G$1(L$4,L$4.current&1|2),_.child}nt=nt.sibling}at.tail!==null&&B$1()>Gj&&(_.flags|=128,ot=!0,Dj(at,!1),_.lanes=4194304)}else{if(!ot)if(nt=Ch(lt),nt!==null){if(_.flags|=128,ot=!0,tt=nt.updateQueue,tt!==null&&(_.updateQueue=tt,_.flags|=4),Dj(at,!0),at.tail===null&&at.tailMode==="hidden"&&!lt.alternate&&!I$3)return S$4(_),null}else 2*B$1()-at.renderingStartTime>Gj&&tt!==1073741824&&(_.flags|=128,ot=!0,Dj(at,!1),_.lanes=4194304);at.isBackwards?(lt.sibling=_.child,_.child=lt):(tt=at.last,tt!==null?tt.sibling=lt:_.child=lt,at.last=lt)}return at.tail!==null?(_=at.tail,at.rendering=_,at.tail=_.sibling,at.renderingStartTime=B$1(),_.sibling=null,tt=L$4.current,G$1(L$4,ot?tt&1|2:tt&1),_):(S$4(_),null);case 22:case 23:return Hj(),ot=_.memoizedState!==null,nt!==null&&nt.memoizedState!==null!==ot&&(_.flags|=8192),ot&&_.mode&1?fj&1073741824&&(S$4(_),_.subtreeFlags&6&&(_.flags|=8192)):S$4(_),null;case 24:return null;case 25:return null}throw Error(p$5(156,_.tag))}function Ij(nt,_){switch(wg(_),_.tag){case 1:return Zf(_.type)&&$f(),nt=_.flags,nt&65536?(_.flags=nt&-65537|128,_):null;case 3:return zh(),E$3(Wf),E$3(H$3),Eh(),nt=_.flags,nt&65536&&!(nt&128)?(_.flags=nt&-65537|128,_):null;case 5:return Bh(_),null;case 13:if(E$3(L$4),nt=_.memoizedState,nt!==null&&nt.dehydrated!==null){if(_.alternate===null)throw Error(p$5(340));Ig()}return nt=_.flags,nt&65536?(_.flags=nt&-65537|128,_):null;case 19:return E$3(L$4),null;case 4:return zh(),null;case 10:return ah(_.type._context),null;case 22:case 23:return Hj(),null;case 24:return null;default:return null}}var Jj=!1,U$2=!1,Kj=typeof WeakSet=="function"?WeakSet:Set,V$3=null;function Lj(nt,_){var tt=nt.ref;if(tt!==null)if(typeof tt=="function")try{tt(null)}catch(ot){W$3(nt,_,ot)}else tt.current=null}function Mj(nt,_,tt){try{tt()}catch(ot){W$3(nt,_,ot)}}var Nj=!1;function Oj(nt,_){if(Cf=dd,nt=Me$1(),Ne$1(nt)){if("selectionStart"in nt)var tt={start:nt.selectionStart,end:nt.selectionEnd};else e:{tt=(tt=nt.ownerDocument)&&tt.defaultView||window;var ot=tt.getSelection&&tt.getSelection();if(ot&&ot.rangeCount!==0){tt=ot.anchorNode;var st=ot.anchorOffset,at=ot.focusNode;ot=ot.focusOffset;try{tt.nodeType,at.nodeType}catch{tt=null;break e}var lt=0,dt=-1,ht=-1,ft=0,gt=0,Et=nt,yt=null;t:for(;;){for(var Ct;Et!==tt||st!==0&&Et.nodeType!==3||(dt=lt+st),Et!==at||ot!==0&&Et.nodeType!==3||(ht=lt+ot),Et.nodeType===3&&(lt+=Et.nodeValue.length),(Ct=Et.firstChild)!==null;)yt=Et,Et=Ct;for(;;){if(Et===nt)break t;if(yt===tt&&++ft===st&&(dt=lt),yt===at&&++gt===ot&&(ht=lt),(Ct=Et.nextSibling)!==null)break;Et=yt,yt=Et.parentNode}Et=Ct}tt=dt===-1||ht===-1?null:{start:dt,end:ht}}else tt=null}tt=tt||{start:0,end:0}}else tt=null;for(Df={focusedElem:nt,selectionRange:tt},dd=!1,V$3=_;V$3!==null;)if(_=V$3,nt=_.child,(_.subtreeFlags&1028)!==0&&nt!==null)nt.return=_,V$3=nt;else for(;V$3!==null;){_=V$3;try{var wt=_.alternate;if(_.flags&1024)switch(_.tag){case 0:case 11:case 15:break;case 1:if(wt!==null){var It=wt.memoizedProps,Pt=wt.memoizedState,Rt=_.stateNode,xt=Rt.getSnapshotBeforeUpdate(_.elementType===_.type?It:Ci(_.type,It),Pt);Rt.__reactInternalSnapshotBeforeUpdate=xt}break;case 3:var Nt=_.stateNode.containerInfo;Nt.nodeType===1?Nt.textContent="":Nt.nodeType===9&&Nt.documentElement&&Nt.removeChild(Nt.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(p$5(163))}}catch(kt){W$3(_,_.return,kt)}if(nt=_.sibling,nt!==null){nt.return=_.return,V$3=nt;break}V$3=_.return}return wt=Nj,Nj=!1,wt}function Pj(nt,_,tt){var ot=_.updateQueue;if(ot=ot!==null?ot.lastEffect:null,ot!==null){var st=ot=ot.next;do{if((st.tag&nt)===nt){var at=st.destroy;st.destroy=void 0,at!==void 0&&Mj(_,tt,at)}st=st.next}while(st!==ot)}}function Qj(nt,_){if(_=_.updateQueue,_=_!==null?_.lastEffect:null,_!==null){var tt=_=_.next;do{if((tt.tag&nt)===nt){var ot=tt.create;tt.destroy=ot()}tt=tt.next}while(tt!==_)}}function Rj(nt){var _=nt.ref;if(_!==null){var tt=nt.stateNode;switch(nt.tag){case 5:nt=tt;break;default:nt=tt}typeof _=="function"?_(nt):_.current=nt}}function Sj(nt){var _=nt.alternate;_!==null&&(nt.alternate=null,Sj(_)),nt.child=null,nt.deletions=null,nt.sibling=null,nt.tag===5&&(_=nt.stateNode,_!==null&&(delete _[Of],delete _[Pf],delete _[of],delete _[Qf],delete _[Rf])),nt.stateNode=null,nt.return=null,nt.dependencies=null,nt.memoizedProps=null,nt.memoizedState=null,nt.pendingProps=null,nt.stateNode=null,nt.updateQueue=null}function Tj(nt){return nt.tag===5||nt.tag===3||nt.tag===4}function Uj(nt){e:for(;;){for(;nt.sibling===null;){if(nt.return===null||Tj(nt.return))return null;nt=nt.return}for(nt.sibling.return=nt.return,nt=nt.sibling;nt.tag!==5&&nt.tag!==6&&nt.tag!==18;){if(nt.flags&2||nt.child===null||nt.tag===4)continue e;nt.child.return=nt,nt=nt.child}if(!(nt.flags&2))return nt.stateNode}}function Vj(nt,_,tt){var ot=nt.tag;if(ot===5||ot===6)nt=nt.stateNode,_?tt.nodeType===8?tt.parentNode.insertBefore(nt,_):tt.insertBefore(nt,_):(tt.nodeType===8?(_=tt.parentNode,_.insertBefore(nt,tt)):(_=tt,_.appendChild(nt)),tt=tt._reactRootContainer,tt!=null||_.onclick!==null||(_.onclick=Bf));else if(ot!==4&&(nt=nt.child,nt!==null))for(Vj(nt,_,tt),nt=nt.sibling;nt!==null;)Vj(nt,_,tt),nt=nt.sibling}function Wj(nt,_,tt){var ot=nt.tag;if(ot===5||ot===6)nt=nt.stateNode,_?tt.insertBefore(nt,_):tt.appendChild(nt);else if(ot!==4&&(nt=nt.child,nt!==null))for(Wj(nt,_,tt),nt=nt.sibling;nt!==null;)Wj(nt,_,tt),nt=nt.sibling}var X$1=null,Xj=!1;function Yj(nt,_,tt){for(tt=tt.child;tt!==null;)Zj(nt,_,tt),tt=tt.sibling}function Zj(nt,_,tt){if(lc&&typeof lc.onCommitFiberUnmount=="function")try{lc.onCommitFiberUnmount(kc,tt)}catch{}switch(tt.tag){case 5:U$2||Lj(tt,_);case 6:var ot=X$1,st=Xj;X$1=null,Yj(nt,_,tt),X$1=ot,Xj=st,X$1!==null&&(Xj?(nt=X$1,tt=tt.stateNode,nt.nodeType===8?nt.parentNode.removeChild(tt):nt.removeChild(tt)):X$1.removeChild(tt.stateNode));break;case 18:X$1!==null&&(Xj?(nt=X$1,tt=tt.stateNode,nt.nodeType===8?Kf(nt.parentNode,tt):nt.nodeType===1&&Kf(nt,tt),bd(nt)):Kf(X$1,tt.stateNode));break;case 4:ot=X$1,st=Xj,X$1=tt.stateNode.containerInfo,Xj=!0,Yj(nt,_,tt),X$1=ot,Xj=st;break;case 0:case 11:case 14:case 15:if(!U$2&&(ot=tt.updateQueue,ot!==null&&(ot=ot.lastEffect,ot!==null))){st=ot=ot.next;do{var at=st,lt=at.destroy;at=at.tag,lt!==void 0&&(at&2||at&4)&&Mj(tt,_,lt),st=st.next}while(st!==ot)}Yj(nt,_,tt);break;case 1:if(!U$2&&(Lj(tt,_),ot=tt.stateNode,typeof ot.componentWillUnmount=="function"))try{ot.props=tt.memoizedProps,ot.state=tt.memoizedState,ot.componentWillUnmount()}catch(dt){W$3(tt,_,dt)}Yj(nt,_,tt);break;case 21:Yj(nt,_,tt);break;case 22:tt.mode&1?(U$2=(ot=U$2)||tt.memoizedState!==null,Yj(nt,_,tt),U$2=ot):Yj(nt,_,tt);break;default:Yj(nt,_,tt)}}function ak(nt){var _=nt.updateQueue;if(_!==null){nt.updateQueue=null;var tt=nt.stateNode;tt===null&&(tt=nt.stateNode=new Kj),_.forEach(function(ot){var st=bk.bind(null,nt,ot);tt.has(ot)||(tt.add(ot),ot.then(st,st))})}}function ck(nt,_){var tt=_.deletions;if(tt!==null)for(var ot=0;ot<tt.length;ot++){var st=tt[ot];try{var at=nt,lt=_,dt=lt;e:for(;dt!==null;){switch(dt.tag){case 5:X$1=dt.stateNode,Xj=!1;break e;case 3:X$1=dt.stateNode.containerInfo,Xj=!0;break e;case 4:X$1=dt.stateNode.containerInfo,Xj=!0;break e}dt=dt.return}if(X$1===null)throw Error(p$5(160));Zj(at,lt,st),X$1=null,Xj=!1;var ht=st.alternate;ht!==null&&(ht.return=null),st.return=null}catch(ft){W$3(st,_,ft)}}if(_.subtreeFlags&12854)for(_=_.child;_!==null;)dk(_,nt),_=_.sibling}function dk(nt,_){var tt=nt.alternate,ot=nt.flags;switch(nt.tag){case 0:case 11:case 14:case 15:if(ck(_,nt),ek(nt),ot&4){try{Pj(3,nt,nt.return),Qj(3,nt)}catch(It){W$3(nt,nt.return,It)}try{Pj(5,nt,nt.return)}catch(It){W$3(nt,nt.return,It)}}break;case 1:ck(_,nt),ek(nt),ot&512&&tt!==null&&Lj(tt,tt.return);break;case 5:if(ck(_,nt),ek(nt),ot&512&&tt!==null&&Lj(tt,tt.return),nt.flags&32){var st=nt.stateNode;try{ob(st,"")}catch(It){W$3(nt,nt.return,It)}}if(ot&4&&(st=nt.stateNode,st!=null)){var at=nt.memoizedProps,lt=tt!==null?tt.memoizedProps:at,dt=nt.type,ht=nt.updateQueue;if(nt.updateQueue=null,ht!==null)try{dt==="input"&&at.type==="radio"&&at.name!=null&&ab(st,at),vb(dt,lt);var ft=vb(dt,at);for(lt=0;lt<ht.length;lt+=2){var gt=ht[lt],Et=ht[lt+1];gt==="style"?sb(st,Et):gt==="dangerouslySetInnerHTML"?nb(st,Et):gt==="children"?ob(st,Et):ta(st,gt,Et,ft)}switch(dt){case"input":bb(st,at);break;case"textarea":ib(st,at);break;case"select":var yt=st._wrapperState.wasMultiple;st._wrapperState.wasMultiple=!!at.multiple;var Ct=at.value;Ct!=null?fb(st,!!at.multiple,Ct,!1):yt!==!!at.multiple&&(at.defaultValue!=null?fb(st,!!at.multiple,at.defaultValue,!0):fb(st,!!at.multiple,at.multiple?[]:"",!1))}st[Pf]=at}catch(It){W$3(nt,nt.return,It)}}break;case 6:if(ck(_,nt),ek(nt),ot&4){if(nt.stateNode===null)throw Error(p$5(162));st=nt.stateNode,at=nt.memoizedProps;try{st.nodeValue=at}catch(It){W$3(nt,nt.return,It)}}break;case 3:if(ck(_,nt),ek(nt),ot&4&&tt!==null&&tt.memoizedState.isDehydrated)try{bd(_.containerInfo)}catch(It){W$3(nt,nt.return,It)}break;case 4:ck(_,nt),ek(nt);break;case 13:ck(_,nt),ek(nt),st=nt.child,st.flags&8192&&(at=st.memoizedState!==null,st.stateNode.isHidden=at,!at||st.alternate!==null&&st.alternate.memoizedState!==null||(fk=B$1())),ot&4&&ak(nt);break;case 22:if(gt=tt!==null&&tt.memoizedState!==null,nt.mode&1?(U$2=(ft=U$2)||gt,ck(_,nt),U$2=ft):ck(_,nt),ek(nt),ot&8192){if(ft=nt.memoizedState!==null,(nt.stateNode.isHidden=ft)&&!gt&&nt.mode&1)for(V$3=nt,gt=nt.child;gt!==null;){for(Et=V$3=gt;V$3!==null;){switch(yt=V$3,Ct=yt.child,yt.tag){case 0:case 11:case 14:case 15:Pj(4,yt,yt.return);break;case 1:Lj(yt,yt.return);var wt=yt.stateNode;if(typeof wt.componentWillUnmount=="function"){ot=yt,tt=yt.return;try{_=ot,wt.props=_.memoizedProps,wt.state=_.memoizedState,wt.componentWillUnmount()}catch(It){W$3(ot,tt,It)}}break;case 5:Lj(yt,yt.return);break;case 22:if(yt.memoizedState!==null){gk(Et);continue}}Ct!==null?(Ct.return=yt,V$3=Ct):gk(Et)}gt=gt.sibling}e:for(gt=null,Et=nt;;){if(Et.tag===5){if(gt===null){gt=Et;try{st=Et.stateNode,ft?(at=st.style,typeof at.setProperty=="function"?at.setProperty("display","none","important"):at.display="none"):(dt=Et.stateNode,ht=Et.memoizedProps.style,lt=ht!=null&&ht.hasOwnProperty("display")?ht.display:null,dt.style.display=rb("display",lt))}catch(It){W$3(nt,nt.return,It)}}}else if(Et.tag===6){if(gt===null)try{Et.stateNode.nodeValue=ft?"":Et.memoizedProps}catch(It){W$3(nt,nt.return,It)}}else if((Et.tag!==22&&Et.tag!==23||Et.memoizedState===null||Et===nt)&&Et.child!==null){Et.child.return=Et,Et=Et.child;continue}if(Et===nt)break e;for(;Et.sibling===null;){if(Et.return===null||Et.return===nt)break e;gt===Et&&(gt=null),Et=Et.return}gt===Et&&(gt=null),Et.sibling.return=Et.return,Et=Et.sibling}}break;case 19:ck(_,nt),ek(nt),ot&4&&ak(nt);break;case 21:break;default:ck(_,nt),ek(nt)}}function ek(nt){var _=nt.flags;if(_&2){try{e:{for(var tt=nt.return;tt!==null;){if(Tj(tt)){var ot=tt;break e}tt=tt.return}throw Error(p$5(160))}switch(ot.tag){case 5:var st=ot.stateNode;ot.flags&32&&(ob(st,""),ot.flags&=-33);var at=Uj(nt);Wj(nt,at,st);break;case 3:case 4:var lt=ot.stateNode.containerInfo,dt=Uj(nt);Vj(nt,dt,lt);break;default:throw Error(p$5(161))}}catch(ht){W$3(nt,nt.return,ht)}nt.flags&=-3}_&4096&&(nt.flags&=-4097)}function hk(nt,_,tt){V$3=nt,ik(nt)}function ik(nt,_,tt){for(var ot=(nt.mode&1)!==0;V$3!==null;){var st=V$3,at=st.child;if(st.tag===22&&ot){var lt=st.memoizedState!==null||Jj;if(!lt){var dt=st.alternate,ht=dt!==null&&dt.memoizedState!==null||U$2;dt=Jj;var ft=U$2;if(Jj=lt,(U$2=ht)&&!ft)for(V$3=st;V$3!==null;)lt=V$3,ht=lt.child,lt.tag===22&&lt.memoizedState!==null?jk(st):ht!==null?(ht.return=lt,V$3=ht):jk(st);for(;at!==null;)V$3=at,ik(at),at=at.sibling;V$3=st,Jj=dt,U$2=ft}kk(nt)}else st.subtreeFlags&8772&&at!==null?(at.return=st,V$3=at):kk(nt)}}function kk(nt){for(;V$3!==null;){var _=V$3;if(_.flags&8772){var tt=_.alternate;try{if(_.flags&8772)switch(_.tag){case 0:case 11:case 15:U$2||Qj(5,_);break;case 1:var ot=_.stateNode;if(_.flags&4&&!U$2)if(tt===null)ot.componentDidMount();else{var st=_.elementType===_.type?tt.memoizedProps:Ci(_.type,tt.memoizedProps);ot.componentDidUpdate(st,tt.memoizedState,ot.__reactInternalSnapshotBeforeUpdate)}var at=_.updateQueue;at!==null&&sh(_,at,ot);break;case 3:var lt=_.updateQueue;if(lt!==null){if(tt=null,_.child!==null)switch(_.child.tag){case 5:tt=_.child.stateNode;break;case 1:tt=_.child.stateNode}sh(_,lt,tt)}break;case 5:var dt=_.stateNode;if(tt===null&&_.flags&4){tt=dt;var ht=_.memoizedProps;switch(_.type){case"button":case"input":case"select":case"textarea":ht.autoFocus&&tt.focus();break;case"img":ht.src&&(tt.src=ht.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(_.memoizedState===null){var ft=_.alternate;if(ft!==null){var gt=ft.memoizedState;if(gt!==null){var Et=gt.dehydrated;Et!==null&&bd(Et)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(p$5(163))}U$2||_.flags&512&&Rj(_)}catch(yt){W$3(_,_.return,yt)}}if(_===nt){V$3=null;break}if(tt=_.sibling,tt!==null){tt.return=_.return,V$3=tt;break}V$3=_.return}}function gk(nt){for(;V$3!==null;){var _=V$3;if(_===nt){V$3=null;break}var tt=_.sibling;if(tt!==null){tt.return=_.return,V$3=tt;break}V$3=_.return}}function jk(nt){for(;V$3!==null;){var _=V$3;try{switch(_.tag){case 0:case 11:case 15:var tt=_.return;try{Qj(4,_)}catch(ht){W$3(_,tt,ht)}break;case 1:var ot=_.stateNode;if(typeof ot.componentDidMount=="function"){var st=_.return;try{ot.componentDidMount()}catch(ht){W$3(_,st,ht)}}var at=_.return;try{Rj(_)}catch(ht){W$3(_,at,ht)}break;case 5:var lt=_.return;try{Rj(_)}catch(ht){W$3(_,lt,ht)}}}catch(ht){W$3(_,_.return,ht)}if(_===nt){V$3=null;break}var dt=_.sibling;if(dt!==null){dt.return=_.return,V$3=dt;break}V$3=_.return}}var lk=Math.ceil,mk=ua.ReactCurrentDispatcher,nk=ua.ReactCurrentOwner,ok=ua.ReactCurrentBatchConfig,K=0,Q$1=null,Y$2=null,Z=0,fj=0,ej=Uf(0),T$4=0,pk=null,rh=0,qk=0,rk=0,sk=null,tk=null,fk=0,Gj=1/0,uk=null,Oi=!1,Pi=null,Ri=null,vk=!1,wk=null,xk=0,yk=0,zk=null,Ak=-1,Bk=0;function R$3(){return K&6?B$1():Ak!==-1?Ak:Ak=B$1()}function yi(nt){return nt.mode&1?K&2&&Z!==0?Z&-Z:Kg.transition!==null?(Bk===0&&(Bk=yc()),Bk):(nt=C$2,nt!==0||(nt=window.event,nt=nt===void 0?16:jd(nt.type)),nt):1}function gi(nt,_,tt,ot){if(50<yk)throw yk=0,zk=null,Error(p$5(185));Ac(nt,tt,ot),(!(K&2)||nt!==Q$1)&&(nt===Q$1&&(!(K&2)&&(qk|=tt),T$4===4&&Ck(nt,Z)),Dk(nt,ot),tt===1&&K===0&&!(_.mode&1)&&(Gj=B$1()+500,fg&&jg()))}function Dk(nt,_){var tt=nt.callbackNode;wc(nt,_);var ot=uc(nt,nt===Q$1?Z:0);if(ot===0)tt!==null&&bc(tt),nt.callbackNode=null,nt.callbackPriority=0;else if(_=ot&-ot,nt.callbackPriority!==_){if(tt!=null&&bc(tt),_===1)nt.tag===0?ig(Ek.bind(null,nt)):hg(Ek.bind(null,nt)),Jf(function(){!(K&6)&&jg()}),tt=null;else{switch(Dc(ot)){case 1:tt=fc;break;case 4:tt=gc;break;case 16:tt=hc;break;case 536870912:tt=jc;break;default:tt=hc}tt=Fk(tt,Gk.bind(null,nt))}nt.callbackPriority=_,nt.callbackNode=tt}}function Gk(nt,_){if(Ak=-1,Bk=0,K&6)throw Error(p$5(327));var tt=nt.callbackNode;if(Hk()&&nt.callbackNode!==tt)return null;var ot=uc(nt,nt===Q$1?Z:0);if(ot===0)return null;if(ot&30||ot&nt.expiredLanes||_)_=Ik(nt,ot);else{_=ot;var st=K;K|=2;var at=Jk();(Q$1!==nt||Z!==_)&&(uk=null,Gj=B$1()+500,Kk(nt,_));do try{Lk();break}catch(dt){Mk(nt,dt)}while(1);$g(),mk.current=at,K=st,Y$2!==null?_=0:(Q$1=null,Z=0,_=T$4)}if(_!==0){if(_===2&&(st=xc(nt),st!==0&&(ot=st,_=Nk(nt,st))),_===1)throw tt=pk,Kk(nt,0),Ck(nt,ot),Dk(nt,B$1()),tt;if(_===6)Ck(nt,ot);else{if(st=nt.current.alternate,!(ot&30)&&!Ok(st)&&(_=Ik(nt,ot),_===2&&(at=xc(nt),at!==0&&(ot=at,_=Nk(nt,at))),_===1))throw tt=pk,Kk(nt,0),Ck(nt,ot),Dk(nt,B$1()),tt;switch(nt.finishedWork=st,nt.finishedLanes=ot,_){case 0:case 1:throw Error(p$5(345));case 2:Pk(nt,tk,uk);break;case 3:if(Ck(nt,ot),(ot&130023424)===ot&&(_=fk+500-B$1(),10<_)){if(uc(nt,0)!==0)break;if(st=nt.suspendedLanes,(st&ot)!==ot){R$3(),nt.pingedLanes|=nt.suspendedLanes&st;break}nt.timeoutHandle=Ff(Pk.bind(null,nt,tk,uk),_);break}Pk(nt,tk,uk);break;case 4:if(Ck(nt,ot),(ot&4194240)===ot)break;for(_=nt.eventTimes,st=-1;0<ot;){var lt=31-oc(ot);at=1<<lt,lt=_[lt],lt>st&&(st=lt),ot&=~at}if(ot=st,ot=B$1()-ot,ot=(120>ot?120:480>ot?480:1080>ot?1080:1920>ot?1920:3e3>ot?3e3:4320>ot?4320:1960*lk(ot/1960))-ot,10<ot){nt.timeoutHandle=Ff(Pk.bind(null,nt,tk,uk),ot);break}Pk(nt,tk,uk);break;case 5:Pk(nt,tk,uk);break;default:throw Error(p$5(329))}}}return Dk(nt,B$1()),nt.callbackNode===tt?Gk.bind(null,nt):null}function Nk(nt,_){var tt=sk;return nt.current.memoizedState.isDehydrated&&(Kk(nt,_).flags|=256),nt=Ik(nt,_),nt!==2&&(_=tk,tk=tt,_!==null&&Fj(_)),nt}function Fj(nt){tk===null?tk=nt:tk.push.apply(tk,nt)}function Ok(nt){for(var _=nt;;){if(_.flags&16384){var tt=_.updateQueue;if(tt!==null&&(tt=tt.stores,tt!==null))for(var ot=0;ot<tt.length;ot++){var st=tt[ot],at=st.getSnapshot;st=st.value;try{if(!He(at(),st))return!1}catch{return!1}}}if(tt=_.child,_.subtreeFlags&16384&&tt!==null)tt.return=_,_=tt;else{if(_===nt)break;for(;_.sibling===null;){if(_.return===null||_.return===nt)return!0;_=_.return}_.sibling.return=_.return,_=_.sibling}}return!0}function Ck(nt,_){for(_&=~rk,_&=~qk,nt.suspendedLanes|=_,nt.pingedLanes&=~_,nt=nt.expirationTimes;0<_;){var tt=31-oc(_),ot=1<<tt;nt[tt]=-1,_&=~ot}}function Ek(nt){if(K&6)throw Error(p$5(327));Hk();var _=uc(nt,0);if(!(_&1))return Dk(nt,B$1()),null;var tt=Ik(nt,_);if(nt.tag!==0&&tt===2){var ot=xc(nt);ot!==0&&(_=ot,tt=Nk(nt,ot))}if(tt===1)throw tt=pk,Kk(nt,0),Ck(nt,_),Dk(nt,B$1()),tt;if(tt===6)throw Error(p$5(345));return nt.finishedWork=nt.current.alternate,nt.finishedLanes=_,Pk(nt,tk,uk),Dk(nt,B$1()),null}function Qk(nt,_){var tt=K;K|=1;try{return nt(_)}finally{K=tt,K===0&&(Gj=B$1()+500,fg&&jg())}}function Rk(nt){wk!==null&&wk.tag===0&&!(K&6)&&Hk();var _=K;K|=1;var tt=ok.transition,ot=C$2;try{if(ok.transition=null,C$2=1,nt)return nt()}finally{C$2=ot,ok.transition=tt,K=_,!(K&6)&&jg()}}function Hj(){fj=ej.current,E$3(ej)}function Kk(nt,_){nt.finishedWork=null,nt.finishedLanes=0;var tt=nt.timeoutHandle;if(tt!==-1&&(nt.timeoutHandle=-1,Gf(tt)),Y$2!==null)for(tt=Y$2.return;tt!==null;){var ot=tt;switch(wg(ot),ot.tag){case 1:ot=ot.type.childContextTypes,ot!=null&&$f();break;case 3:zh(),E$3(Wf),E$3(H$3),Eh();break;case 5:Bh(ot);break;case 4:zh();break;case 13:E$3(L$4);break;case 19:E$3(L$4);break;case 10:ah(ot.type._context);break;case 22:case 23:Hj()}tt=tt.return}if(Q$1=nt,Y$2=nt=Pg(nt.current,null),Z=fj=_,T$4=0,pk=null,rk=qk=rh=0,tk=sk=null,fh!==null){for(_=0;_<fh.length;_++)if(tt=fh[_],ot=tt.interleaved,ot!==null){tt.interleaved=null;var st=ot.next,at=tt.pending;if(at!==null){var lt=at.next;at.next=st,ot.next=lt}tt.pending=ot}fh=null}return nt}function Mk(nt,_){do{var tt=Y$2;try{if($g(),Fh.current=Rh,Ih){for(var ot=M$2.memoizedState;ot!==null;){var st=ot.queue;st!==null&&(st.pending=null),ot=ot.next}Ih=!1}if(Hh=0,O$2=N$3=M$2=null,Jh=!1,Kh=0,nk.current=null,tt===null||tt.return===null){T$4=1,pk=_,Y$2=null;break}e:{var at=nt,lt=tt.return,dt=tt,ht=_;if(_=Z,dt.flags|=32768,ht!==null&&typeof ht=="object"&&typeof ht.then=="function"){var ft=ht,gt=dt,Et=gt.tag;if(!(gt.mode&1)&&(Et===0||Et===11||Et===15)){var yt=gt.alternate;yt?(gt.updateQueue=yt.updateQueue,gt.memoizedState=yt.memoizedState,gt.lanes=yt.lanes):(gt.updateQueue=null,gt.memoizedState=null)}var Ct=Ui(lt);if(Ct!==null){Ct.flags&=-257,Vi(Ct,lt,dt,at,_),Ct.mode&1&&Si(at,ft,_),_=Ct,ht=ft;var wt=_.updateQueue;if(wt===null){var It=new Set;It.add(ht),_.updateQueue=It}else wt.add(ht);break e}else{if(!(_&1)){Si(at,ft,_),tj();break e}ht=Error(p$5(426))}}else if(I$3&&dt.mode&1){var Pt=Ui(lt);if(Pt!==null){!(Pt.flags&65536)&&(Pt.flags|=256),Vi(Pt,lt,dt,at,_),Jg(Ji(ht,dt));break e}}at=ht=Ji(ht,dt),T$4!==4&&(T$4=2),sk===null?sk=[at]:sk.push(at),at=lt;do{switch(at.tag){case 3:at.flags|=65536,_&=-_,at.lanes|=_;var Rt=Ni(at,ht,_);ph(at,Rt);break e;case 1:dt=ht;var xt=at.type,Nt=at.stateNode;if(!(at.flags&128)&&(typeof xt.getDerivedStateFromError=="function"||Nt!==null&&typeof Nt.componentDidCatch=="function"&&(Ri===null||!Ri.has(Nt)))){at.flags|=65536,_&=-_,at.lanes|=_;var kt=Qi(at,dt,_);ph(at,kt);break e}}at=at.return}while(at!==null)}Sk(tt)}catch(Vt){_=Vt,Y$2===tt&&tt!==null&&(Y$2=tt=tt.return);continue}break}while(1)}function Jk(){var nt=mk.current;return mk.current=Rh,nt===null?Rh:nt}function tj(){(T$4===0||T$4===3||T$4===2)&&(T$4=4),Q$1===null||!(rh&268435455)&&!(qk&268435455)||Ck(Q$1,Z)}function Ik(nt,_){var tt=K;K|=2;var ot=Jk();(Q$1!==nt||Z!==_)&&(uk=null,Kk(nt,_));do try{Tk();break}catch(st){Mk(nt,st)}while(1);if($g(),K=tt,mk.current=ot,Y$2!==null)throw Error(p$5(261));return Q$1=null,Z=0,T$4}function Tk(){for(;Y$2!==null;)Uk(Y$2)}function Lk(){for(;Y$2!==null&&!cc();)Uk(Y$2)}function Uk(nt){var _=Vk(nt.alternate,nt,fj);nt.memoizedProps=nt.pendingProps,_===null?Sk(nt):Y$2=_,nk.current=null}function Sk(nt){var _=nt;do{var tt=_.alternate;if(nt=_.return,_.flags&32768){if(tt=Ij(tt,_),tt!==null){tt.flags&=32767,Y$2=tt;return}if(nt!==null)nt.flags|=32768,nt.subtreeFlags=0,nt.deletions=null;else{T$4=6,Y$2=null;return}}else if(tt=Ej(tt,_,fj),tt!==null){Y$2=tt;return}if(_=_.sibling,_!==null){Y$2=_;return}Y$2=_=nt}while(_!==null);T$4===0&&(T$4=5)}function Pk(nt,_,tt){var ot=C$2,st=ok.transition;try{ok.transition=null,C$2=1,Wk(nt,_,tt,ot)}finally{ok.transition=st,C$2=ot}return null}function Wk(nt,_,tt,ot){do Hk();while(wk!==null);if(K&6)throw Error(p$5(327));tt=nt.finishedWork;var st=nt.finishedLanes;if(tt===null)return null;if(nt.finishedWork=null,nt.finishedLanes=0,tt===nt.current)throw Error(p$5(177));nt.callbackNode=null,nt.callbackPriority=0;var at=tt.lanes|tt.childLanes;if(Bc(nt,at),nt===Q$1&&(Y$2=Q$1=null,Z=0),!(tt.subtreeFlags&2064)&&!(tt.flags&2064)||vk||(vk=!0,Fk(hc,function(){return Hk(),null})),at=(tt.flags&15990)!==0,tt.subtreeFlags&15990||at){at=ok.transition,ok.transition=null;var lt=C$2;C$2=1;var dt=K;K|=4,nk.current=null,Oj(nt,tt),dk(tt,nt),Oe(Df),dd=!!Cf,Df=Cf=null,nt.current=tt,hk(tt),dc(),K=dt,C$2=lt,ok.transition=at}else nt.current=tt;if(vk&&(vk=!1,wk=nt,xk=st),at=nt.pendingLanes,at===0&&(Ri=null),mc(tt.stateNode),Dk(nt,B$1()),_!==null)for(ot=nt.onRecoverableError,tt=0;tt<_.length;tt++)st=_[tt],ot(st.value,{componentStack:st.stack,digest:st.digest});if(Oi)throw Oi=!1,nt=Pi,Pi=null,nt;return xk&1&&nt.tag!==0&&Hk(),at=nt.pendingLanes,at&1?nt===zk?yk++:(yk=0,zk=nt):yk=0,jg(),null}function Hk(){if(wk!==null){var nt=Dc(xk),_=ok.transition,tt=C$2;try{if(ok.transition=null,C$2=16>nt?16:nt,wk===null)var ot=!1;else{if(nt=wk,wk=null,xk=0,K&6)throw Error(p$5(331));var st=K;for(K|=4,V$3=nt.current;V$3!==null;){var at=V$3,lt=at.child;if(V$3.flags&16){var dt=at.deletions;if(dt!==null){for(var ht=0;ht<dt.length;ht++){var ft=dt[ht];for(V$3=ft;V$3!==null;){var gt=V$3;switch(gt.tag){case 0:case 11:case 15:Pj(8,gt,at)}var Et=gt.child;if(Et!==null)Et.return=gt,V$3=Et;else for(;V$3!==null;){gt=V$3;var yt=gt.sibling,Ct=gt.return;if(Sj(gt),gt===ft){V$3=null;break}if(yt!==null){yt.return=Ct,V$3=yt;break}V$3=Ct}}}var wt=at.alternate;if(wt!==null){var It=wt.child;if(It!==null){wt.child=null;do{var Pt=It.sibling;It.sibling=null,It=Pt}while(It!==null)}}V$3=at}}if(at.subtreeFlags&2064&&lt!==null)lt.return=at,V$3=lt;else e:for(;V$3!==null;){if(at=V$3,at.flags&2048)switch(at.tag){case 0:case 11:case 15:Pj(9,at,at.return)}var Rt=at.sibling;if(Rt!==null){Rt.return=at.return,V$3=Rt;break e}V$3=at.return}}var xt=nt.current;for(V$3=xt;V$3!==null;){lt=V$3;var Nt=lt.child;if(lt.subtreeFlags&2064&&Nt!==null)Nt.return=lt,V$3=Nt;else e:for(lt=xt;V$3!==null;){if(dt=V$3,dt.flags&2048)try{switch(dt.tag){case 0:case 11:case 15:Qj(9,dt)}}catch(Vt){W$3(dt,dt.return,Vt)}if(dt===lt){V$3=null;break e}var kt=dt.sibling;if(kt!==null){kt.return=dt.return,V$3=kt;break e}V$3=dt.return}}if(K=st,jg(),lc&&typeof lc.onPostCommitFiberRoot=="function")try{lc.onPostCommitFiberRoot(kc,nt)}catch{}ot=!0}return ot}finally{C$2=tt,ok.transition=_}}return!1}function Xk(nt,_,tt){_=Ji(tt,_),_=Ni(nt,_,1),nt=nh(nt,_,1),_=R$3(),nt!==null&&(Ac(nt,1,_),Dk(nt,_))}function W$3(nt,_,tt){if(nt.tag===3)Xk(nt,nt,tt);else for(;_!==null;){if(_.tag===3){Xk(_,nt,tt);break}else if(_.tag===1){var ot=_.stateNode;if(typeof _.type.getDerivedStateFromError=="function"||typeof ot.componentDidCatch=="function"&&(Ri===null||!Ri.has(ot))){nt=Ji(tt,nt),nt=Qi(_,nt,1),_=nh(_,nt,1),nt=R$3(),_!==null&&(Ac(_,1,nt),Dk(_,nt));break}}_=_.return}}function Ti(nt,_,tt){var ot=nt.pingCache;ot!==null&&ot.delete(_),_=R$3(),nt.pingedLanes|=nt.suspendedLanes&tt,Q$1===nt&&(Z&tt)===tt&&(T$4===4||T$4===3&&(Z&130023424)===Z&&500>B$1()-fk?Kk(nt,0):rk|=tt),Dk(nt,_)}function Yk(nt,_){_===0&&(nt.mode&1?(_=sc,sc<<=1,!(sc&130023424)&&(sc=4194304)):_=1);var tt=R$3();nt=ih(nt,_),nt!==null&&(Ac(nt,_,tt),Dk(nt,tt))}function uj(nt){var _=nt.memoizedState,tt=0;_!==null&&(tt=_.retryLane),Yk(nt,tt)}function bk(nt,_){var tt=0;switch(nt.tag){case 13:var ot=nt.stateNode,st=nt.memoizedState;st!==null&&(tt=st.retryLane);break;case 19:ot=nt.stateNode;break;default:throw Error(p$5(314))}ot!==null&&ot.delete(_),Yk(nt,tt)}var Vk;Vk=function(nt,_,tt){if(nt!==null)if(nt.memoizedProps!==_.pendingProps||Wf.current)dh=!0;else{if(!(nt.lanes&tt)&&!(_.flags&128))return dh=!1,yj(nt,_,tt);dh=!!(nt.flags&131072)}else dh=!1,I$3&&_.flags&1048576&&ug(_,ng,_.index);switch(_.lanes=0,_.tag){case 2:var ot=_.type;ij(nt,_),nt=_.pendingProps;var st=Yf(_,H$3.current);ch(_,tt),st=Nh(null,_,ot,nt,st,tt);var at=Sh();return _.flags|=1,typeof st=="object"&&st!==null&&typeof st.render=="function"&&st.$$typeof===void 0?(_.tag=1,_.memoizedState=null,_.updateQueue=null,Zf(ot)?(at=!0,cg(_)):at=!1,_.memoizedState=st.state!==null&&st.state!==void 0?st.state:null,kh(_),st.updater=Ei,_.stateNode=st,st._reactInternals=_,Ii(_,ot,nt,tt),_=jj(null,_,ot,!0,at,tt)):(_.tag=0,I$3&&at&&vg(_),Xi(null,_,st,tt),_=_.child),_;case 16:ot=_.elementType;e:{switch(ij(nt,_),nt=_.pendingProps,st=ot._init,ot=st(ot._payload),_.type=ot,st=_.tag=Zk(ot),nt=Ci(ot,nt),st){case 0:_=cj(null,_,ot,nt,tt);break e;case 1:_=hj(null,_,ot,nt,tt);break e;case 11:_=Yi(null,_,ot,nt,tt);break e;case 14:_=$i(null,_,ot,Ci(ot.type,nt),tt);break e}throw Error(p$5(306,ot,""))}return _;case 0:return ot=_.type,st=_.pendingProps,st=_.elementType===ot?st:Ci(ot,st),cj(nt,_,ot,st,tt);case 1:return ot=_.type,st=_.pendingProps,st=_.elementType===ot?st:Ci(ot,st),hj(nt,_,ot,st,tt);case 3:e:{if(kj(_),nt===null)throw Error(p$5(387));ot=_.pendingProps,at=_.memoizedState,st=at.element,lh(nt,_),qh(_,ot,null,tt);var lt=_.memoizedState;if(ot=lt.element,at.isDehydrated)if(at={element:ot,isDehydrated:!1,cache:lt.cache,pendingSuspenseBoundaries:lt.pendingSuspenseBoundaries,transitions:lt.transitions},_.updateQueue.baseState=at,_.memoizedState=at,_.flags&256){st=Ji(Error(p$5(423)),_),_=lj(nt,_,ot,tt,st);break e}else if(ot!==st){st=Ji(Error(p$5(424)),_),_=lj(nt,_,ot,tt,st);break e}else for(yg=Lf(_.stateNode.containerInfo.firstChild),xg=_,I$3=!0,zg=null,tt=Vg(_,null,ot,tt),_.child=tt;tt;)tt.flags=tt.flags&-3|4096,tt=tt.sibling;else{if(Ig(),ot===st){_=Zi(nt,_,tt);break e}Xi(nt,_,ot,tt)}_=_.child}return _;case 5:return Ah(_),nt===null&&Eg(_),ot=_.type,st=_.pendingProps,at=nt!==null?nt.memoizedProps:null,lt=st.children,Ef(ot,st)?lt=null:at!==null&&Ef(ot,at)&&(_.flags|=32),gj(nt,_),Xi(nt,_,lt,tt),_.child;case 6:return nt===null&&Eg(_),null;case 13:return oj(nt,_,tt);case 4:return yh(_,_.stateNode.containerInfo),ot=_.pendingProps,nt===null?_.child=Ug(_,null,ot,tt):Xi(nt,_,ot,tt),_.child;case 11:return ot=_.type,st=_.pendingProps,st=_.elementType===ot?st:Ci(ot,st),Yi(nt,_,ot,st,tt);case 7:return Xi(nt,_,_.pendingProps,tt),_.child;case 8:return Xi(nt,_,_.pendingProps.children,tt),_.child;case 12:return Xi(nt,_,_.pendingProps.children,tt),_.child;case 10:e:{if(ot=_.type._context,st=_.pendingProps,at=_.memoizedProps,lt=st.value,G$1(Wg,ot._currentValue),ot._currentValue=lt,at!==null)if(He(at.value,lt)){if(at.children===st.children&&!Wf.current){_=Zi(nt,_,tt);break e}}else for(at=_.child,at!==null&&(at.return=_);at!==null;){var dt=at.dependencies;if(dt!==null){lt=at.child;for(var ht=dt.firstContext;ht!==null;){if(ht.context===ot){if(at.tag===1){ht=mh(-1,tt&-tt),ht.tag=2;var ft=at.updateQueue;if(ft!==null){ft=ft.shared;var gt=ft.pending;gt===null?ht.next=ht:(ht.next=gt.next,gt.next=ht),ft.pending=ht}}at.lanes|=tt,ht=at.alternate,ht!==null&&(ht.lanes|=tt),bh(at.return,tt,_),dt.lanes|=tt;break}ht=ht.next}}else if(at.tag===10)lt=at.type===_.type?null:at.child;else if(at.tag===18){if(lt=at.return,lt===null)throw Error(p$5(341));lt.lanes|=tt,dt=lt.alternate,dt!==null&&(dt.lanes|=tt),bh(lt,tt,_),lt=at.sibling}else lt=at.child;if(lt!==null)lt.return=at;else for(lt=at;lt!==null;){if(lt===_){lt=null;break}if(at=lt.sibling,at!==null){at.return=lt.return,lt=at;break}lt=lt.return}at=lt}Xi(nt,_,st.children,tt),_=_.child}return _;case 9:return st=_.type,ot=_.pendingProps.children,ch(_,tt),st=eh(st),ot=ot(st),_.flags|=1,Xi(nt,_,ot,tt),_.child;case 14:return ot=_.type,st=Ci(ot,_.pendingProps),st=Ci(ot.type,st),$i(nt,_,ot,st,tt);case 15:return bj(nt,_,_.type,_.pendingProps,tt);case 17:return ot=_.type,st=_.pendingProps,st=_.elementType===ot?st:Ci(ot,st),ij(nt,_),_.tag=1,Zf(ot)?(nt=!0,cg(_)):nt=!1,ch(_,tt),Gi(_,ot,st),Ii(_,ot,st,tt),jj(null,_,ot,!0,nt,tt);case 19:return xj(nt,_,tt);case 22:return dj(nt,_,tt)}throw Error(p$5(156,_.tag))};function Fk(nt,_){return ac(nt,_)}function $k(nt,_,tt,ot){this.tag=nt,this.key=tt,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=_,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=ot,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Bg(nt,_,tt,ot){return new $k(nt,_,tt,ot)}function aj(nt){return nt=nt.prototype,!(!nt||!nt.isReactComponent)}function Zk(nt){if(typeof nt=="function")return aj(nt)?1:0;if(nt!=null){if(nt=nt.$$typeof,nt===Da)return 11;if(nt===Ga)return 14}return 2}function Pg(nt,_){var tt=nt.alternate;return tt===null?(tt=Bg(nt.tag,_,nt.key,nt.mode),tt.elementType=nt.elementType,tt.type=nt.type,tt.stateNode=nt.stateNode,tt.alternate=nt,nt.alternate=tt):(tt.pendingProps=_,tt.type=nt.type,tt.flags=0,tt.subtreeFlags=0,tt.deletions=null),tt.flags=nt.flags&14680064,tt.childLanes=nt.childLanes,tt.lanes=nt.lanes,tt.child=nt.child,tt.memoizedProps=nt.memoizedProps,tt.memoizedState=nt.memoizedState,tt.updateQueue=nt.updateQueue,_=nt.dependencies,tt.dependencies=_===null?null:{lanes:_.lanes,firstContext:_.firstContext},tt.sibling=nt.sibling,tt.index=nt.index,tt.ref=nt.ref,tt}function Rg(nt,_,tt,ot,st,at){var lt=2;if(ot=nt,typeof nt=="function")aj(nt)&&(lt=1);else if(typeof nt=="string")lt=5;else e:switch(nt){case ya:return Tg(tt.children,st,at,_);case za:lt=8,st|=8;break;case Aa:return nt=Bg(12,tt,_,st|2),nt.elementType=Aa,nt.lanes=at,nt;case Ea:return nt=Bg(13,tt,_,st),nt.elementType=Ea,nt.lanes=at,nt;case Fa:return nt=Bg(19,tt,_,st),nt.elementType=Fa,nt.lanes=at,nt;case Ia:return pj(tt,st,at,_);default:if(typeof nt=="object"&&nt!==null)switch(nt.$$typeof){case Ba:lt=10;break e;case Ca:lt=9;break e;case Da:lt=11;break e;case Ga:lt=14;break e;case Ha:lt=16,ot=null;break e}throw Error(p$5(130,nt==null?nt:typeof nt,""))}return _=Bg(lt,tt,_,st),_.elementType=nt,_.type=ot,_.lanes=at,_}function Tg(nt,_,tt,ot){return nt=Bg(7,nt,ot,_),nt.lanes=tt,nt}function pj(nt,_,tt,ot){return nt=Bg(22,nt,ot,_),nt.elementType=Ia,nt.lanes=tt,nt.stateNode={isHidden:!1},nt}function Qg(nt,_,tt){return nt=Bg(6,nt,null,_),nt.lanes=tt,nt}function Sg(nt,_,tt){return _=Bg(4,nt.children!==null?nt.children:[],nt.key,_),_.lanes=tt,_.stateNode={containerInfo:nt.containerInfo,pendingChildren:null,implementation:nt.implementation},_}function al(nt,_,tt,ot,st){this.tag=_,this.containerInfo=nt,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=zc(0),this.expirationTimes=zc(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=zc(0),this.identifierPrefix=ot,this.onRecoverableError=st,this.mutableSourceEagerHydrationData=null}function bl(nt,_,tt,ot,st,at,lt,dt,ht){return nt=new al(nt,_,tt,dt,ht),_===1?(_=1,at===!0&&(_|=8)):_=0,at=Bg(3,null,null,_),nt.current=at,at.stateNode=nt,at.memoizedState={element:ot,isDehydrated:tt,cache:null,transitions:null,pendingSuspenseBoundaries:null},kh(at),nt}function cl(nt,_,tt){var ot=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:wa,key:ot==null?null:""+ot,children:nt,containerInfo:_,implementation:tt}}function dl(nt){if(!nt)return Vf;nt=nt._reactInternals;e:{if(Vb(nt)!==nt||nt.tag!==1)throw Error(p$5(170));var _=nt;do{switch(_.tag){case 3:_=_.stateNode.context;break e;case 1:if(Zf(_.type)){_=_.stateNode.__reactInternalMemoizedMergedChildContext;break e}}_=_.return}while(_!==null);throw Error(p$5(171))}if(nt.tag===1){var tt=nt.type;if(Zf(tt))return bg(nt,tt,_)}return _}function el(nt,_,tt,ot,st,at,lt,dt,ht){return nt=bl(tt,ot,!0,nt,st,at,lt,dt,ht),nt.context=dl(null),tt=nt.current,ot=R$3(),st=yi(tt),at=mh(ot,st),at.callback=_??null,nh(tt,at,st),nt.current.lanes=st,Ac(nt,st,ot),Dk(nt,ot),nt}function fl$1(nt,_,tt,ot){var st=_.current,at=R$3(),lt=yi(st);return tt=dl(tt),_.context===null?_.context=tt:_.pendingContext=tt,_=mh(at,lt),_.payload={element:nt},ot=ot===void 0?null:ot,ot!==null&&(_.callback=ot),nt=nh(st,_,lt),nt!==null&&(gi(nt,st,lt,at),oh(nt,st,lt)),lt}function gl(nt){if(nt=nt.current,!nt.child)return null;switch(nt.child.tag){case 5:return nt.child.stateNode;default:return nt.child.stateNode}}function hl(nt,_){if(nt=nt.memoizedState,nt!==null&&nt.dehydrated!==null){var tt=nt.retryLane;nt.retryLane=tt!==0&&tt<_?tt:_}}function il(nt,_){hl(nt,_),(nt=nt.alternate)&&hl(nt,_)}function jl(){return null}var kl=typeof reportError=="function"?reportError:function(nt){console.error(nt)};function ll(nt){this._internalRoot=nt}ml.prototype.render=ll.prototype.render=function(nt){var _=this._internalRoot;if(_===null)throw Error(p$5(409));fl$1(nt,_,null,null)};ml.prototype.unmount=ll.prototype.unmount=function(){var nt=this._internalRoot;if(nt!==null){this._internalRoot=null;var _=nt.containerInfo;Rk(function(){fl$1(null,nt,null,null)}),_[uf]=null}};function ml(nt){this._internalRoot=nt}ml.prototype.unstable_scheduleHydration=function(nt){if(nt){var _=Hc();nt={blockedOn:null,target:nt,priority:_};for(var tt=0;tt<Qc.length&&_!==0&&_<Qc[tt].priority;tt++);Qc.splice(tt,0,nt),tt===0&&Vc(nt)}};function nl(nt){return!(!nt||nt.nodeType!==1&&nt.nodeType!==9&&nt.nodeType!==11)}function ol(nt){return!(!nt||nt.nodeType!==1&&nt.nodeType!==9&&nt.nodeType!==11&&(nt.nodeType!==8||nt.nodeValue!==" react-mount-point-unstable "))}function pl(){}function ql(nt,_,tt,ot,st){if(st){if(typeof ot=="function"){var at=ot;ot=function(){var ft=gl(lt);at.call(ft)}}var lt=el(_,ot,nt,0,null,!1,!1,"",pl);return nt._reactRootContainer=lt,nt[uf]=lt.current,sf(nt.nodeType===8?nt.parentNode:nt),Rk(),lt}for(;st=nt.lastChild;)nt.removeChild(st);if(typeof ot=="function"){var dt=ot;ot=function(){var ft=gl(ht);dt.call(ft)}}var ht=bl(nt,0,!1,null,null,!1,!1,"",pl);return nt._reactRootContainer=ht,nt[uf]=ht.current,sf(nt.nodeType===8?nt.parentNode:nt),Rk(function(){fl$1(_,ht,tt,ot)}),ht}function rl(nt,_,tt,ot,st){var at=tt._reactRootContainer;if(at){var lt=at;if(typeof st=="function"){var dt=st;st=function(){var ht=gl(lt);dt.call(ht)}}fl$1(_,lt,nt,st)}else lt=ql(tt,_,nt,st,ot);return gl(lt)}Ec=function(nt){switch(nt.tag){case 3:var _=nt.stateNode;if(_.current.memoizedState.isDehydrated){var tt=tc(_.pendingLanes);tt!==0&&(Cc(_,tt|1),Dk(_,B$1()),!(K&6)&&(Gj=B$1()+500,jg()))}break;case 13:Rk(function(){var ot=ih(nt,1);if(ot!==null){var st=R$3();gi(ot,nt,1,st)}}),il(nt,1)}};Fc=function(nt){if(nt.tag===13){var _=ih(nt,134217728);if(_!==null){var tt=R$3();gi(_,nt,134217728,tt)}il(nt,134217728)}};Gc=function(nt){if(nt.tag===13){var _=yi(nt),tt=ih(nt,_);if(tt!==null){var ot=R$3();gi(tt,nt,_,ot)}il(nt,_)}};Hc=function(){return C$2};Ic=function(nt,_){var tt=C$2;try{return C$2=nt,_()}finally{C$2=tt}};yb=function(nt,_,tt){switch(_){case"input":if(bb(nt,tt),_=tt.name,tt.type==="radio"&&_!=null){for(tt=nt;tt.parentNode;)tt=tt.parentNode;for(tt=tt.querySelectorAll("input[name="+JSON.stringify(""+_)+'][type="radio"]'),_=0;_<tt.length;_++){var ot=tt[_];if(ot!==nt&&ot.form===nt.form){var st=Db(ot);if(!st)throw Error(p$5(90));Wa(ot),bb(ot,st)}}}break;case"textarea":ib(nt,tt);break;case"select":_=tt.value,_!=null&&fb(nt,!!tt.multiple,_,!1)}};Gb=Qk;Hb=Rk;var sl={usingClientEntryPoint:!1,Events:[Cb,ue,Db,Eb,Fb,Qk]},tl={findFiberByHostInstance:Wc,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},ul={bundleType:tl.bundleType,version:tl.version,rendererPackageName:tl.rendererPackageName,rendererConfig:tl.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:ua.ReactCurrentDispatcher,findHostInstanceByFiber:function(nt){return nt=Zb(nt),nt===null?null:nt.stateNode},findFiberByHostInstance:tl.findFiberByHostInstance||jl,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var vl=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!vl.isDisabled&&vl.supportsFiber)try{kc=vl.inject(ul),lc=vl}catch{}}reactDom_production_min.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=sl;reactDom_production_min.createPortal=function(nt,_){var tt=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!nl(_))throw Error(p$5(200));return cl(nt,_,null,tt)};reactDom_production_min.createRoot=function(nt,_){if(!nl(nt))throw Error(p$5(299));var tt=!1,ot="",st=kl;return _!=null&&(_.unstable_strictMode===!0&&(tt=!0),_.identifierPrefix!==void 0&&(ot=_.identifierPrefix),_.onRecoverableError!==void 0&&(st=_.onRecoverableError)),_=bl(nt,1,!1,null,null,tt,!1,ot,st),nt[uf]=_.current,sf(nt.nodeType===8?nt.parentNode:nt),new ll(_)};reactDom_production_min.findDOMNode=function(nt){if(nt==null)return null;if(nt.nodeType===1)return nt;var _=nt._reactInternals;if(_===void 0)throw typeof nt.render=="function"?Error(p$5(188)):(nt=Object.keys(nt).join(","),Error(p$5(268,nt)));return nt=Zb(_),nt=nt===null?null:nt.stateNode,nt};reactDom_production_min.flushSync=function(nt){return Rk(nt)};reactDom_production_min.hydrate=function(nt,_,tt){if(!ol(_))throw Error(p$5(200));return rl(null,nt,_,!0,tt)};reactDom_production_min.hydrateRoot=function(nt,_,tt){if(!nl(nt))throw Error(p$5(405));var ot=tt!=null&&tt.hydratedSources||null,st=!1,at="",lt=kl;if(tt!=null&&(tt.unstable_strictMode===!0&&(st=!0),tt.identifierPrefix!==void 0&&(at=tt.identifierPrefix),tt.onRecoverableError!==void 0&&(lt=tt.onRecoverableError)),_=el(_,null,nt,1,tt??null,st,!1,at,lt),nt[uf]=_.current,sf(nt),ot)for(nt=0;nt<ot.length;nt++)tt=ot[nt],st=tt._getVersion,st=st(tt._source),_.mutableSourceEagerHydrationData==null?_.mutableSourceEagerHydrationData=[tt,st]:_.mutableSourceEagerHydrationData.push(tt,st);return new ml(_)};reactDom_production_min.render=function(nt,_,tt){if(!ol(_))throw Error(p$5(200));return rl(null,nt,_,!1,tt)};reactDom_production_min.unmountComponentAtNode=function(nt){if(!ol(nt))throw Error(p$5(40));return nt._reactRootContainer?(Rk(function(){rl(null,null,nt,!1,function(){nt._reactRootContainer=null,nt[uf]=null})}),!0):!1};reactDom_production_min.unstable_batchedUpdates=Qk;reactDom_production_min.unstable_renderSubtreeIntoContainer=function(nt,_,tt,ot){if(!ol(tt))throw Error(p$5(200));if(nt==null||nt._reactInternals===void 0)throw Error(p$5(38));return rl(nt,_,tt,!1,ot)};reactDom_production_min.version="18.3.1-next-f1338f8080-20240426";function checkDCE(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(checkDCE)}catch(nt){console.error(nt)}}checkDCE(),reactDom.exports=reactDom_production_min;var reactDomExports=reactDom.exports;const ReactDOM=getDefaultExportFromCjs(reactDomExports);var m$5=reactDomExports;client.createRoot=m$5.createRoot,client.hydrateRoot=m$5.hydrateRoot;function _extends$1(){return _extends$1=Object.assign?Object.assign.bind():function(nt){for(var _=1;_<arguments.length;_++){var tt=arguments[_];for(var ot in tt)({}).hasOwnProperty.call(tt,ot)&&(nt[ot]=tt[ot])}return nt},_extends$1.apply(null,arguments)}/**
 * @license
 * Copyright 2010-2023 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const REVISION="153",MOUSE={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},TOUCH={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},CullFaceNone=0,CullFaceBack=1,CullFaceFront=2,CullFaceFrontBack=3,BasicShadowMap=0,PCFShadowMap=1,PCFSoftShadowMap=2,VSMShadowMap=3,FrontSide=0,BackSide=1,DoubleSide=2,TwoPassDoubleSide=2,NoBlending=0,NormalBlending=1,AdditiveBlending=2,SubtractiveBlending=3,MultiplyBlending=4,CustomBlending=5,AddEquation=100,SubtractEquation=101,ReverseSubtractEquation=102,MinEquation=103,MaxEquation=104,ZeroFactor=200,OneFactor=201,SrcColorFactor=202,OneMinusSrcColorFactor=203,SrcAlphaFactor=204,OneMinusSrcAlphaFactor=205,DstAlphaFactor=206,OneMinusDstAlphaFactor=207,DstColorFactor=208,OneMinusDstColorFactor=209,SrcAlphaSaturateFactor=210,NeverDepth=0,AlwaysDepth=1,LessDepth=2,LessEqualDepth=3,EqualDepth=4,GreaterEqualDepth=5,GreaterDepth=6,NotEqualDepth=7,MultiplyOperation=0,MixOperation=1,AddOperation=2,NoToneMapping=0,LinearToneMapping=1,ReinhardToneMapping=2,CineonToneMapping=3,ACESFilmicToneMapping=4,CustomToneMapping=5,UVMapping=300,CubeReflectionMapping=301,CubeRefractionMapping=302,EquirectangularReflectionMapping=303,EquirectangularRefractionMapping=304,CubeUVReflectionMapping=306,RepeatWrapping=1e3,ClampToEdgeWrapping=1001,MirroredRepeatWrapping=1002,NearestFilter=1003,NearestMipmapNearestFilter=1004,NearestMipMapNearestFilter=1004,NearestMipmapLinearFilter=1005,NearestMipMapLinearFilter=1005,LinearFilter=1006,LinearMipmapNearestFilter=1007,LinearMipMapNearestFilter=1007,LinearMipmapLinearFilter=1008,LinearMipMapLinearFilter=1008,UnsignedByteType=1009,ByteType=1010,ShortType=1011,UnsignedShortType=1012,IntType=1013,UnsignedIntType=1014,FloatType=1015,HalfFloatType=1016,UnsignedShort4444Type=1017,UnsignedShort5551Type=1018,UnsignedInt248Type=1020,AlphaFormat=1021,RGBAFormat=1023,LuminanceFormat=1024,LuminanceAlphaFormat=1025,DepthFormat=1026,DepthStencilFormat=1027,RedFormat=1028,RedIntegerFormat=1029,RGFormat=1030,RGIntegerFormat=1031,RGBAIntegerFormat=1033,RGB_S3TC_DXT1_Format=33776,RGBA_S3TC_DXT1_Format=33777,RGBA_S3TC_DXT3_Format=33778,RGBA_S3TC_DXT5_Format=33779,RGB_PVRTC_4BPPV1_Format=35840,RGB_PVRTC_2BPPV1_Format=35841,RGBA_PVRTC_4BPPV1_Format=35842,RGBA_PVRTC_2BPPV1_Format=35843,RGB_ETC1_Format=36196,RGB_ETC2_Format=37492,RGBA_ETC2_EAC_Format=37496,RGBA_ASTC_4x4_Format=37808,RGBA_ASTC_5x4_Format=37809,RGBA_ASTC_5x5_Format=37810,RGBA_ASTC_6x5_Format=37811,RGBA_ASTC_6x6_Format=37812,RGBA_ASTC_8x5_Format=37813,RGBA_ASTC_8x6_Format=37814,RGBA_ASTC_8x8_Format=37815,RGBA_ASTC_10x5_Format=37816,RGBA_ASTC_10x6_Format=37817,RGBA_ASTC_10x8_Format=37818,RGBA_ASTC_10x10_Format=37819,RGBA_ASTC_12x10_Format=37820,RGBA_ASTC_12x12_Format=37821,RGBA_BPTC_Format=36492,RED_RGTC1_Format=36283,SIGNED_RED_RGTC1_Format=36284,RED_GREEN_RGTC2_Format=36285,SIGNED_RED_GREEN_RGTC2_Format=36286,LoopOnce=2200,LoopRepeat=2201,LoopPingPong=2202,InterpolateDiscrete=2300,InterpolateLinear=2301,InterpolateSmooth=2302,ZeroCurvatureEnding=2400,ZeroSlopeEnding=2401,WrapAroundEnding=2402,NormalAnimationBlendMode=2500,AdditiveAnimationBlendMode=2501,TrianglesDrawMode=0,TriangleStripDrawMode=1,TriangleFanDrawMode=2,LinearEncoding$1=3e3,sRGBEncoding$1=3001,BasicDepthPacking=3200,RGBADepthPacking=3201,TangentSpaceNormalMap=0,ObjectSpaceNormalMap=1,NoColorSpace="",SRGBColorSpace$1="srgb",LinearSRGBColorSpace$1="srgb-linear",DisplayP3ColorSpace="display-p3",ZeroStencilOp=0,KeepStencilOp=7680,ReplaceStencilOp=7681,IncrementStencilOp=7682,DecrementStencilOp=7683,IncrementWrapStencilOp=34055,DecrementWrapStencilOp=34056,InvertStencilOp=5386,NeverStencilFunc=512,LessStencilFunc=513,EqualStencilFunc=514,LessEqualStencilFunc=515,GreaterStencilFunc=516,NotEqualStencilFunc=517,GreaterEqualStencilFunc=518,AlwaysStencilFunc=519,NeverCompare=512,LessCompare=513,EqualCompare=514,LessEqualCompare=515,GreaterCompare=516,NotEqualCompare=517,GreaterEqualCompare=518,AlwaysCompare=519,StaticDrawUsage=35044,DynamicDrawUsage=35048,StreamDrawUsage=35040,StaticReadUsage=35045,DynamicReadUsage=35049,StreamReadUsage=35041,StaticCopyUsage=35046,DynamicCopyUsage=35050,StreamCopyUsage=35042,GLSL1="100",GLSL3="300 es",_SRGBAFormat=1035,WebGLCoordinateSystem=2e3,WebGPUCoordinateSystem=2001;let EventDispatcher$1=class{addEventListener(_,tt){this._listeners===void 0&&(this._listeners={});const ot=this._listeners;ot[_]===void 0&&(ot[_]=[]),ot[_].indexOf(tt)===-1&&ot[_].push(tt)}hasEventListener(_,tt){if(this._listeners===void 0)return!1;const ot=this._listeners;return ot[_]!==void 0&&ot[_].indexOf(tt)!==-1}removeEventListener(_,tt){if(this._listeners===void 0)return;const st=this._listeners[_];if(st!==void 0){const at=st.indexOf(tt);at!==-1&&st.splice(at,1)}}dispatchEvent(_){if(this._listeners===void 0)return;const ot=this._listeners[_.type];if(ot!==void 0){_.target=this;const st=ot.slice(0);for(let at=0,lt=st.length;at<lt;at++)st[at].call(this,_);_.target=null}}};const _lut$1=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let _seed=1234567;const DEG2RAD$1=Math.PI/180,RAD2DEG=180/Math.PI;function generateUUID$1(){const nt=Math.random()*4294967295|0,_=Math.random()*4294967295|0,tt=Math.random()*4294967295|0,ot=Math.random()*4294967295|0;return(_lut$1[nt&255]+_lut$1[nt>>8&255]+_lut$1[nt>>16&255]+_lut$1[nt>>24&255]+"-"+_lut$1[_&255]+_lut$1[_>>8&255]+"-"+_lut$1[_>>16&15|64]+_lut$1[_>>24&255]+"-"+_lut$1[tt&63|128]+_lut$1[tt>>8&255]+"-"+_lut$1[tt>>16&255]+_lut$1[tt>>24&255]+_lut$1[ot&255]+_lut$1[ot>>8&255]+_lut$1[ot>>16&255]+_lut$1[ot>>24&255]).toLowerCase()}function clamp$3(nt,_,tt){return Math.max(_,Math.min(tt,nt))}function euclideanModulo(nt,_){return(nt%_+_)%_}function mapLinear(nt,_,tt,ot,st){return ot+(nt-_)*(st-ot)/(tt-_)}function inverseLerp(nt,_,tt){return nt!==_?(tt-nt)/(_-nt):0}function lerp(nt,_,tt){return(1-tt)*nt+tt*_}function damp(nt,_,tt,ot){return lerp(nt,_,1-Math.exp(-tt*ot))}function pingpong(nt,_=1){return _-Math.abs(euclideanModulo(nt,_*2)-_)}function smoothstep(nt,_,tt){return nt<=_?0:nt>=tt?1:(nt=(nt-_)/(tt-_),nt*nt*(3-2*nt))}function smootherstep(nt,_,tt){return nt<=_?0:nt>=tt?1:(nt=(nt-_)/(tt-_),nt*nt*nt*(nt*(nt*6-15)+10))}function randInt(nt,_){return nt+Math.floor(Math.random()*(_-nt+1))}function randFloat(nt,_){return nt+Math.random()*(_-nt)}function randFloatSpread(nt){return nt*(.5-Math.random())}function seededRandom(nt){nt!==void 0&&(_seed=nt);let _=_seed+=1831565813;return _=Math.imul(_^_>>>15,_|1),_^=_+Math.imul(_^_>>>7,_|61),((_^_>>>14)>>>0)/4294967296}function degToRad(nt){return nt*DEG2RAD$1}function radToDeg(nt){return nt*RAD2DEG}function isPowerOfTwo(nt){return(nt&nt-1)===0&&nt!==0}function ceilPowerOfTwo(nt){return Math.pow(2,Math.ceil(Math.log(nt)/Math.LN2))}function floorPowerOfTwo(nt){return Math.pow(2,Math.floor(Math.log(nt)/Math.LN2))}function setQuaternionFromProperEuler(nt,_,tt,ot,st){const at=Math.cos,lt=Math.sin,dt=at(tt/2),ht=lt(tt/2),ft=at((_+ot)/2),gt=lt((_+ot)/2),Et=at((_-ot)/2),yt=lt((_-ot)/2),Ct=at((ot-_)/2),wt=lt((ot-_)/2);switch(st){case"XYX":nt.set(dt*gt,ht*Et,ht*yt,dt*ft);break;case"YZY":nt.set(ht*yt,dt*gt,ht*Et,dt*ft);break;case"ZXZ":nt.set(ht*Et,ht*yt,dt*gt,dt*ft);break;case"XZX":nt.set(dt*gt,ht*wt,ht*Ct,dt*ft);break;case"YXY":nt.set(ht*Ct,dt*gt,ht*wt,dt*ft);break;case"ZYZ":nt.set(ht*wt,ht*Ct,dt*gt,dt*ft);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+st)}}function denormalize(nt,_){switch(_.constructor){case Float32Array:return nt;case Uint32Array:return nt/4294967295;case Uint16Array:return nt/65535;case Uint8Array:return nt/255;case Int32Array:return Math.max(nt/2147483647,-1);case Int16Array:return Math.max(nt/32767,-1);case Int8Array:return Math.max(nt/127,-1);default:throw new Error("Invalid component type.")}}function normalize$5(nt,_){switch(_.constructor){case Float32Array:return nt;case Uint32Array:return Math.round(nt*4294967295);case Uint16Array:return Math.round(nt*65535);case Uint8Array:return Math.round(nt*255);case Int32Array:return Math.round(nt*2147483647);case Int16Array:return Math.round(nt*32767);case Int8Array:return Math.round(nt*127);default:throw new Error("Invalid component type.")}}const MathUtils={DEG2RAD:DEG2RAD$1,RAD2DEG,generateUUID:generateUUID$1,clamp:clamp$3,euclideanModulo,mapLinear,inverseLerp,lerp,damp,pingpong,smoothstep,smootherstep,randInt,randFloat,randFloatSpread,seededRandom,degToRad,radToDeg,isPowerOfTwo,ceilPowerOfTwo,floorPowerOfTwo,setQuaternionFromProperEuler,normalize:normalize$5,denormalize};class Vector2{constructor(_=0,tt=0){Vector2.prototype.isVector2=!0,this.x=_,this.y=tt}get width(){return this.x}set width(_){this.x=_}get height(){return this.y}set height(_){this.y=_}set(_,tt){return this.x=_,this.y=tt,this}setScalar(_){return this.x=_,this.y=_,this}setX(_){return this.x=_,this}setY(_){return this.y=_,this}setComponent(_,tt){switch(_){case 0:this.x=tt;break;case 1:this.y=tt;break;default:throw new Error("index is out of range: "+_)}return this}getComponent(_){switch(_){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+_)}}clone(){return new this.constructor(this.x,this.y)}copy(_){return this.x=_.x,this.y=_.y,this}add(_){return this.x+=_.x,this.y+=_.y,this}addScalar(_){return this.x+=_,this.y+=_,this}addVectors(_,tt){return this.x=_.x+tt.x,this.y=_.y+tt.y,this}addScaledVector(_,tt){return this.x+=_.x*tt,this.y+=_.y*tt,this}sub(_){return this.x-=_.x,this.y-=_.y,this}subScalar(_){return this.x-=_,this.y-=_,this}subVectors(_,tt){return this.x=_.x-tt.x,this.y=_.y-tt.y,this}multiply(_){return this.x*=_.x,this.y*=_.y,this}multiplyScalar(_){return this.x*=_,this.y*=_,this}divide(_){return this.x/=_.x,this.y/=_.y,this}divideScalar(_){return this.multiplyScalar(1/_)}applyMatrix3(_){const tt=this.x,ot=this.y,st=_.elements;return this.x=st[0]*tt+st[3]*ot+st[6],this.y=st[1]*tt+st[4]*ot+st[7],this}min(_){return this.x=Math.min(this.x,_.x),this.y=Math.min(this.y,_.y),this}max(_){return this.x=Math.max(this.x,_.x),this.y=Math.max(this.y,_.y),this}clamp(_,tt){return this.x=Math.max(_.x,Math.min(tt.x,this.x)),this.y=Math.max(_.y,Math.min(tt.y,this.y)),this}clampScalar(_,tt){return this.x=Math.max(_,Math.min(tt,this.x)),this.y=Math.max(_,Math.min(tt,this.y)),this}clampLength(_,tt){const ot=this.length();return this.divideScalar(ot||1).multiplyScalar(Math.max(_,Math.min(tt,ot)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(_){return this.x*_.x+this.y*_.y}cross(_){return this.x*_.y-this.y*_.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(_){const tt=Math.sqrt(this.lengthSq()*_.lengthSq());if(tt===0)return Math.PI/2;const ot=this.dot(_)/tt;return Math.acos(clamp$3(ot,-1,1))}distanceTo(_){return Math.sqrt(this.distanceToSquared(_))}distanceToSquared(_){const tt=this.x-_.x,ot=this.y-_.y;return tt*tt+ot*ot}manhattanDistanceTo(_){return Math.abs(this.x-_.x)+Math.abs(this.y-_.y)}setLength(_){return this.normalize().multiplyScalar(_)}lerp(_,tt){return this.x+=(_.x-this.x)*tt,this.y+=(_.y-this.y)*tt,this}lerpVectors(_,tt,ot){return this.x=_.x+(tt.x-_.x)*ot,this.y=_.y+(tt.y-_.y)*ot,this}equals(_){return _.x===this.x&&_.y===this.y}fromArray(_,tt=0){return this.x=_[tt],this.y=_[tt+1],this}toArray(_=[],tt=0){return _[tt]=this.x,_[tt+1]=this.y,_}fromBufferAttribute(_,tt){return this.x=_.getX(tt),this.y=_.getY(tt),this}rotateAround(_,tt){const ot=Math.cos(tt),st=Math.sin(tt),at=this.x-_.x,lt=this.y-_.y;return this.x=at*ot-lt*st+_.x,this.y=at*st+lt*ot+_.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class Matrix3{constructor(_,tt,ot,st,at,lt,dt,ht,ft){Matrix3.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],_!==void 0&&this.set(_,tt,ot,st,at,lt,dt,ht,ft)}set(_,tt,ot,st,at,lt,dt,ht,ft){const gt=this.elements;return gt[0]=_,gt[1]=st,gt[2]=dt,gt[3]=tt,gt[4]=at,gt[5]=ht,gt[6]=ot,gt[7]=lt,gt[8]=ft,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(_){const tt=this.elements,ot=_.elements;return tt[0]=ot[0],tt[1]=ot[1],tt[2]=ot[2],tt[3]=ot[3],tt[4]=ot[4],tt[5]=ot[5],tt[6]=ot[6],tt[7]=ot[7],tt[8]=ot[8],this}extractBasis(_,tt,ot){return _.setFromMatrix3Column(this,0),tt.setFromMatrix3Column(this,1),ot.setFromMatrix3Column(this,2),this}setFromMatrix4(_){const tt=_.elements;return this.set(tt[0],tt[4],tt[8],tt[1],tt[5],tt[9],tt[2],tt[6],tt[10]),this}multiply(_){return this.multiplyMatrices(this,_)}premultiply(_){return this.multiplyMatrices(_,this)}multiplyMatrices(_,tt){const ot=_.elements,st=tt.elements,at=this.elements,lt=ot[0],dt=ot[3],ht=ot[6],ft=ot[1],gt=ot[4],Et=ot[7],yt=ot[2],Ct=ot[5],wt=ot[8],It=st[0],Pt=st[3],Rt=st[6],xt=st[1],Nt=st[4],kt=st[7],Vt=st[2],Ft=st[5],zt=st[8];return at[0]=lt*It+dt*xt+ht*Vt,at[3]=lt*Pt+dt*Nt+ht*Ft,at[6]=lt*Rt+dt*kt+ht*zt,at[1]=ft*It+gt*xt+Et*Vt,at[4]=ft*Pt+gt*Nt+Et*Ft,at[7]=ft*Rt+gt*kt+Et*zt,at[2]=yt*It+Ct*xt+wt*Vt,at[5]=yt*Pt+Ct*Nt+wt*Ft,at[8]=yt*Rt+Ct*kt+wt*zt,this}multiplyScalar(_){const tt=this.elements;return tt[0]*=_,tt[3]*=_,tt[6]*=_,tt[1]*=_,tt[4]*=_,tt[7]*=_,tt[2]*=_,tt[5]*=_,tt[8]*=_,this}determinant(){const _=this.elements,tt=_[0],ot=_[1],st=_[2],at=_[3],lt=_[4],dt=_[5],ht=_[6],ft=_[7],gt=_[8];return tt*lt*gt-tt*dt*ft-ot*at*gt+ot*dt*ht+st*at*ft-st*lt*ht}invert(){const _=this.elements,tt=_[0],ot=_[1],st=_[2],at=_[3],lt=_[4],dt=_[5],ht=_[6],ft=_[7],gt=_[8],Et=gt*lt-dt*ft,yt=dt*ht-gt*at,Ct=ft*at-lt*ht,wt=tt*Et+ot*yt+st*Ct;if(wt===0)return this.set(0,0,0,0,0,0,0,0,0);const It=1/wt;return _[0]=Et*It,_[1]=(st*ft-gt*ot)*It,_[2]=(dt*ot-st*lt)*It,_[3]=yt*It,_[4]=(gt*tt-st*ht)*It,_[5]=(st*at-dt*tt)*It,_[6]=Ct*It,_[7]=(ot*ht-ft*tt)*It,_[8]=(lt*tt-ot*at)*It,this}transpose(){let _;const tt=this.elements;return _=tt[1],tt[1]=tt[3],tt[3]=_,_=tt[2],tt[2]=tt[6],tt[6]=_,_=tt[5],tt[5]=tt[7],tt[7]=_,this}getNormalMatrix(_){return this.setFromMatrix4(_).invert().transpose()}transposeIntoArray(_){const tt=this.elements;return _[0]=tt[0],_[1]=tt[3],_[2]=tt[6],_[3]=tt[1],_[4]=tt[4],_[5]=tt[7],_[6]=tt[2],_[7]=tt[5],_[8]=tt[8],this}setUvTransform(_,tt,ot,st,at,lt,dt){const ht=Math.cos(at),ft=Math.sin(at);return this.set(ot*ht,ot*ft,-ot*(ht*lt+ft*dt)+lt+_,-st*ft,st*ht,-st*(-ft*lt+ht*dt)+dt+tt,0,0,1),this}scale(_,tt){return this.premultiply(_m3.makeScale(_,tt)),this}rotate(_){return this.premultiply(_m3.makeRotation(-_)),this}translate(_,tt){return this.premultiply(_m3.makeTranslation(_,tt)),this}makeTranslation(_,tt){return _.isVector2?this.set(1,0,_.x,0,1,_.y,0,0,1):this.set(1,0,_,0,1,tt,0,0,1),this}makeRotation(_){const tt=Math.cos(_),ot=Math.sin(_);return this.set(tt,-ot,0,ot,tt,0,0,0,1),this}makeScale(_,tt){return this.set(_,0,0,0,tt,0,0,0,1),this}equals(_){const tt=this.elements,ot=_.elements;for(let st=0;st<9;st++)if(tt[st]!==ot[st])return!1;return!0}fromArray(_,tt=0){for(let ot=0;ot<9;ot++)this.elements[ot]=_[ot+tt];return this}toArray(_=[],tt=0){const ot=this.elements;return _[tt]=ot[0],_[tt+1]=ot[1],_[tt+2]=ot[2],_[tt+3]=ot[3],_[tt+4]=ot[4],_[tt+5]=ot[5],_[tt+6]=ot[6],_[tt+7]=ot[7],_[tt+8]=ot[8],_}clone(){return new this.constructor().fromArray(this.elements)}}const _m3=new Matrix3;function arrayNeedsUint32(nt){for(let _=nt.length-1;_>=0;--_)if(nt[_]>=65535)return!0;return!1}const TYPED_ARRAYS={Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function getTypedArray(nt,_){return new TYPED_ARRAYS[nt](_)}function createElementNS(nt){return document.createElementNS("http://www.w3.org/1999/xhtml",nt)}const _cache={};function warnOnce(nt){nt in _cache||(_cache[nt]=!0,console.warn(nt))}function SRGBToLinear(nt){return nt<.04045?nt*.0773993808:Math.pow(nt*.9478672986+.0521327014,2.4)}function LinearToSRGB(nt){return nt<.0031308?nt*12.92:1.055*Math.pow(nt,.41666)-.055}const LINEAR_SRGB_TO_LINEAR_DISPLAY_P3=new Matrix3().fromArray([.8224621,.0331941,.0170827,.177538,.9668058,.0723974,-1e-7,1e-7,.9105199]),LINEAR_DISPLAY_P3_TO_LINEAR_SRGB=new Matrix3().fromArray([1.2249401,-.0420569,-.0196376,-.2249404,1.0420571,-.0786361,1e-7,0,1.0982735]);function DisplayP3ToLinearSRGB(nt){return nt.convertSRGBToLinear().applyMatrix3(LINEAR_DISPLAY_P3_TO_LINEAR_SRGB)}function LinearSRGBToDisplayP3(nt){return nt.applyMatrix3(LINEAR_SRGB_TO_LINEAR_DISPLAY_P3).convertLinearToSRGB()}const TO_LINEAR={[LinearSRGBColorSpace$1]:nt=>nt,[SRGBColorSpace$1]:nt=>nt.convertSRGBToLinear(),[DisplayP3ColorSpace]:DisplayP3ToLinearSRGB},FROM_LINEAR={[LinearSRGBColorSpace$1]:nt=>nt,[SRGBColorSpace$1]:nt=>nt.convertLinearToSRGB(),[DisplayP3ColorSpace]:LinearSRGBToDisplayP3},ColorManagement={enabled:!0,get legacyMode(){return console.warn("THREE.ColorManagement: .legacyMode=false renamed to .enabled=true in r150."),!this.enabled},set legacyMode(nt){console.warn("THREE.ColorManagement: .legacyMode=false renamed to .enabled=true in r150."),this.enabled=!nt},get workingColorSpace(){return LinearSRGBColorSpace$1},set workingColorSpace(nt){console.warn("THREE.ColorManagement: .workingColorSpace is readonly.")},convert:function(nt,_,tt){if(this.enabled===!1||_===tt||!_||!tt)return nt;const ot=TO_LINEAR[_],st=FROM_LINEAR[tt];if(ot===void 0||st===void 0)throw new Error(`Unsupported color space conversion, "${_}" to "${tt}".`);return st(ot(nt))},fromWorkingColorSpace:function(nt,_){return this.convert(nt,this.workingColorSpace,_)},toWorkingColorSpace:function(nt,_){return this.convert(nt,_,this.workingColorSpace)}};let _canvas;class ImageUtils{static getDataURL(_){if(/^data:/i.test(_.src)||typeof HTMLCanvasElement>"u")return _.src;let tt;if(_ instanceof HTMLCanvasElement)tt=_;else{_canvas===void 0&&(_canvas=createElementNS("canvas")),_canvas.width=_.width,_canvas.height=_.height;const ot=_canvas.getContext("2d");_ instanceof ImageData?ot.putImageData(_,0,0):ot.drawImage(_,0,0,_.width,_.height),tt=_canvas}return tt.width>2048||tt.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",_),tt.toDataURL("image/jpeg",.6)):tt.toDataURL("image/png")}static sRGBToLinear(_){if(typeof HTMLImageElement<"u"&&_ instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&_ instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&_ instanceof ImageBitmap){const tt=createElementNS("canvas");tt.width=_.width,tt.height=_.height;const ot=tt.getContext("2d");ot.drawImage(_,0,0,_.width,_.height);const st=ot.getImageData(0,0,_.width,_.height),at=st.data;for(let lt=0;lt<at.length;lt++)at[lt]=SRGBToLinear(at[lt]/255)*255;return ot.putImageData(st,0,0),tt}else if(_.data){const tt=_.data.slice(0);for(let ot=0;ot<tt.length;ot++)tt instanceof Uint8Array||tt instanceof Uint8ClampedArray?tt[ot]=Math.floor(SRGBToLinear(tt[ot]/255)*255):tt[ot]=SRGBToLinear(tt[ot]);return{data:tt,width:_.width,height:_.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),_}}let sourceId=0;class Source{constructor(_=null){this.isSource=!0,Object.defineProperty(this,"id",{value:sourceId++}),this.uuid=generateUUID$1(),this.data=_,this.version=0}set needsUpdate(_){_===!0&&this.version++}toJSON(_){const tt=_===void 0||typeof _=="string";if(!tt&&_.images[this.uuid]!==void 0)return _.images[this.uuid];const ot={uuid:this.uuid,url:""},st=this.data;if(st!==null){let at;if(Array.isArray(st)){at=[];for(let lt=0,dt=st.length;lt<dt;lt++)st[lt].isDataTexture?at.push(serializeImage(st[lt].image)):at.push(serializeImage(st[lt]))}else at=serializeImage(st);ot.url=at}return tt||(_.images[this.uuid]=ot),ot}}function serializeImage(nt){return typeof HTMLImageElement<"u"&&nt instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&nt instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&nt instanceof ImageBitmap?ImageUtils.getDataURL(nt):nt.data?{data:Array.from(nt.data),width:nt.width,height:nt.height,type:nt.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let textureId=0;class Texture extends EventDispatcher$1{constructor(_=Texture.DEFAULT_IMAGE,tt=Texture.DEFAULT_MAPPING,ot=ClampToEdgeWrapping,st=ClampToEdgeWrapping,at=LinearFilter,lt=LinearMipmapLinearFilter,dt=RGBAFormat,ht=UnsignedByteType,ft=Texture.DEFAULT_ANISOTROPY,gt=NoColorSpace){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:textureId++}),this.uuid=generateUUID$1(),this.name="",this.source=new Source(_),this.mipmaps=[],this.mapping=tt,this.channel=0,this.wrapS=ot,this.wrapT=st,this.magFilter=at,this.minFilter=lt,this.anisotropy=ft,this.format=dt,this.internalFormat=null,this.type=ht,this.offset=new Vector2(0,0),this.repeat=new Vector2(1,1),this.center=new Vector2(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Matrix3,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,typeof gt=="string"?this.colorSpace=gt:(warnOnce("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace=gt===sRGBEncoding$1?SRGBColorSpace$1:NoColorSpace),this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(_=null){this.source.data=_}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(_){return this.name=_.name,this.source=_.source,this.mipmaps=_.mipmaps.slice(0),this.mapping=_.mapping,this.channel=_.channel,this.wrapS=_.wrapS,this.wrapT=_.wrapT,this.magFilter=_.magFilter,this.minFilter=_.minFilter,this.anisotropy=_.anisotropy,this.format=_.format,this.internalFormat=_.internalFormat,this.type=_.type,this.offset.copy(_.offset),this.repeat.copy(_.repeat),this.center.copy(_.center),this.rotation=_.rotation,this.matrixAutoUpdate=_.matrixAutoUpdate,this.matrix.copy(_.matrix),this.generateMipmaps=_.generateMipmaps,this.premultiplyAlpha=_.premultiplyAlpha,this.flipY=_.flipY,this.unpackAlignment=_.unpackAlignment,this.colorSpace=_.colorSpace,this.userData=JSON.parse(JSON.stringify(_.userData)),this.needsUpdate=!0,this}toJSON(_){const tt=_===void 0||typeof _=="string";if(!tt&&_.textures[this.uuid]!==void 0)return _.textures[this.uuid];const ot={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(_).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(ot.userData=this.userData),tt||(_.textures[this.uuid]=ot),ot}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(_){if(this.mapping!==UVMapping)return _;if(_.applyMatrix3(this.matrix),_.x<0||_.x>1)switch(this.wrapS){case RepeatWrapping:_.x=_.x-Math.floor(_.x);break;case ClampToEdgeWrapping:_.x=_.x<0?0:1;break;case MirroredRepeatWrapping:Math.abs(Math.floor(_.x)%2)===1?_.x=Math.ceil(_.x)-_.x:_.x=_.x-Math.floor(_.x);break}if(_.y<0||_.y>1)switch(this.wrapT){case RepeatWrapping:_.y=_.y-Math.floor(_.y);break;case ClampToEdgeWrapping:_.y=_.y<0?0:1;break;case MirroredRepeatWrapping:Math.abs(Math.floor(_.y)%2)===1?_.y=Math.ceil(_.y)-_.y:_.y=_.y-Math.floor(_.y);break}return this.flipY&&(_.y=1-_.y),_}set needsUpdate(_){_===!0&&(this.version++,this.source.needsUpdate=!0)}get encoding(){return warnOnce("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace===SRGBColorSpace$1?sRGBEncoding$1:LinearEncoding$1}set encoding(_){warnOnce("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace=_===sRGBEncoding$1?SRGBColorSpace$1:NoColorSpace}}Texture.DEFAULT_IMAGE=null;Texture.DEFAULT_MAPPING=UVMapping;Texture.DEFAULT_ANISOTROPY=1;class Vector4{constructor(_=0,tt=0,ot=0,st=1){Vector4.prototype.isVector4=!0,this.x=_,this.y=tt,this.z=ot,this.w=st}get width(){return this.z}set width(_){this.z=_}get height(){return this.w}set height(_){this.w=_}set(_,tt,ot,st){return this.x=_,this.y=tt,this.z=ot,this.w=st,this}setScalar(_){return this.x=_,this.y=_,this.z=_,this.w=_,this}setX(_){return this.x=_,this}setY(_){return this.y=_,this}setZ(_){return this.z=_,this}setW(_){return this.w=_,this}setComponent(_,tt){switch(_){case 0:this.x=tt;break;case 1:this.y=tt;break;case 2:this.z=tt;break;case 3:this.w=tt;break;default:throw new Error("index is out of range: "+_)}return this}getComponent(_){switch(_){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+_)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(_){return this.x=_.x,this.y=_.y,this.z=_.z,this.w=_.w!==void 0?_.w:1,this}add(_){return this.x+=_.x,this.y+=_.y,this.z+=_.z,this.w+=_.w,this}addScalar(_){return this.x+=_,this.y+=_,this.z+=_,this.w+=_,this}addVectors(_,tt){return this.x=_.x+tt.x,this.y=_.y+tt.y,this.z=_.z+tt.z,this.w=_.w+tt.w,this}addScaledVector(_,tt){return this.x+=_.x*tt,this.y+=_.y*tt,this.z+=_.z*tt,this.w+=_.w*tt,this}sub(_){return this.x-=_.x,this.y-=_.y,this.z-=_.z,this.w-=_.w,this}subScalar(_){return this.x-=_,this.y-=_,this.z-=_,this.w-=_,this}subVectors(_,tt){return this.x=_.x-tt.x,this.y=_.y-tt.y,this.z=_.z-tt.z,this.w=_.w-tt.w,this}multiply(_){return this.x*=_.x,this.y*=_.y,this.z*=_.z,this.w*=_.w,this}multiplyScalar(_){return this.x*=_,this.y*=_,this.z*=_,this.w*=_,this}applyMatrix4(_){const tt=this.x,ot=this.y,st=this.z,at=this.w,lt=_.elements;return this.x=lt[0]*tt+lt[4]*ot+lt[8]*st+lt[12]*at,this.y=lt[1]*tt+lt[5]*ot+lt[9]*st+lt[13]*at,this.z=lt[2]*tt+lt[6]*ot+lt[10]*st+lt[14]*at,this.w=lt[3]*tt+lt[7]*ot+lt[11]*st+lt[15]*at,this}divideScalar(_){return this.multiplyScalar(1/_)}setAxisAngleFromQuaternion(_){this.w=2*Math.acos(_.w);const tt=Math.sqrt(1-_.w*_.w);return tt<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=_.x/tt,this.y=_.y/tt,this.z=_.z/tt),this}setAxisAngleFromRotationMatrix(_){let tt,ot,st,at;const ht=_.elements,ft=ht[0],gt=ht[4],Et=ht[8],yt=ht[1],Ct=ht[5],wt=ht[9],It=ht[2],Pt=ht[6],Rt=ht[10];if(Math.abs(gt-yt)<.01&&Math.abs(Et-It)<.01&&Math.abs(wt-Pt)<.01){if(Math.abs(gt+yt)<.1&&Math.abs(Et+It)<.1&&Math.abs(wt+Pt)<.1&&Math.abs(ft+Ct+Rt-3)<.1)return this.set(1,0,0,0),this;tt=Math.PI;const Nt=(ft+1)/2,kt=(Ct+1)/2,Vt=(Rt+1)/2,Ft=(gt+yt)/4,zt=(Et+It)/4,Yt=(wt+Pt)/4;return Nt>kt&&Nt>Vt?Nt<.01?(ot=0,st=.707106781,at=.707106781):(ot=Math.sqrt(Nt),st=Ft/ot,at=zt/ot):kt>Vt?kt<.01?(ot=.707106781,st=0,at=.707106781):(st=Math.sqrt(kt),ot=Ft/st,at=Yt/st):Vt<.01?(ot=.707106781,st=.707106781,at=0):(at=Math.sqrt(Vt),ot=zt/at,st=Yt/at),this.set(ot,st,at,tt),this}let xt=Math.sqrt((Pt-wt)*(Pt-wt)+(Et-It)*(Et-It)+(yt-gt)*(yt-gt));return Math.abs(xt)<.001&&(xt=1),this.x=(Pt-wt)/xt,this.y=(Et-It)/xt,this.z=(yt-gt)/xt,this.w=Math.acos((ft+Ct+Rt-1)/2),this}min(_){return this.x=Math.min(this.x,_.x),this.y=Math.min(this.y,_.y),this.z=Math.min(this.z,_.z),this.w=Math.min(this.w,_.w),this}max(_){return this.x=Math.max(this.x,_.x),this.y=Math.max(this.y,_.y),this.z=Math.max(this.z,_.z),this.w=Math.max(this.w,_.w),this}clamp(_,tt){return this.x=Math.max(_.x,Math.min(tt.x,this.x)),this.y=Math.max(_.y,Math.min(tt.y,this.y)),this.z=Math.max(_.z,Math.min(tt.z,this.z)),this.w=Math.max(_.w,Math.min(tt.w,this.w)),this}clampScalar(_,tt){return this.x=Math.max(_,Math.min(tt,this.x)),this.y=Math.max(_,Math.min(tt,this.y)),this.z=Math.max(_,Math.min(tt,this.z)),this.w=Math.max(_,Math.min(tt,this.w)),this}clampLength(_,tt){const ot=this.length();return this.divideScalar(ot||1).multiplyScalar(Math.max(_,Math.min(tt,ot)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(_){return this.x*_.x+this.y*_.y+this.z*_.z+this.w*_.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(_){return this.normalize().multiplyScalar(_)}lerp(_,tt){return this.x+=(_.x-this.x)*tt,this.y+=(_.y-this.y)*tt,this.z+=(_.z-this.z)*tt,this.w+=(_.w-this.w)*tt,this}lerpVectors(_,tt,ot){return this.x=_.x+(tt.x-_.x)*ot,this.y=_.y+(tt.y-_.y)*ot,this.z=_.z+(tt.z-_.z)*ot,this.w=_.w+(tt.w-_.w)*ot,this}equals(_){return _.x===this.x&&_.y===this.y&&_.z===this.z&&_.w===this.w}fromArray(_,tt=0){return this.x=_[tt],this.y=_[tt+1],this.z=_[tt+2],this.w=_[tt+3],this}toArray(_=[],tt=0){return _[tt]=this.x,_[tt+1]=this.y,_[tt+2]=this.z,_[tt+3]=this.w,_}fromBufferAttribute(_,tt){return this.x=_.getX(tt),this.y=_.getY(tt),this.z=_.getZ(tt),this.w=_.getW(tt),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class WebGLRenderTarget extends EventDispatcher$1{constructor(_=1,tt=1,ot={}){super(),this.isWebGLRenderTarget=!0,this.width=_,this.height=tt,this.depth=1,this.scissor=new Vector4(0,0,_,tt),this.scissorTest=!1,this.viewport=new Vector4(0,0,_,tt);const st={width:_,height:tt,depth:1};ot.encoding!==void 0&&(warnOnce("THREE.WebGLRenderTarget: option.encoding has been replaced by option.colorSpace."),ot.colorSpace=ot.encoding===sRGBEncoding$1?SRGBColorSpace$1:NoColorSpace),this.texture=new Texture(st,ot.mapping,ot.wrapS,ot.wrapT,ot.magFilter,ot.minFilter,ot.format,ot.type,ot.anisotropy,ot.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.flipY=!1,this.texture.generateMipmaps=ot.generateMipmaps!==void 0?ot.generateMipmaps:!1,this.texture.internalFormat=ot.internalFormat!==void 0?ot.internalFormat:null,this.texture.minFilter=ot.minFilter!==void 0?ot.minFilter:LinearFilter,this.depthBuffer=ot.depthBuffer!==void 0?ot.depthBuffer:!0,this.stencilBuffer=ot.stencilBuffer!==void 0?ot.stencilBuffer:!1,this.depthTexture=ot.depthTexture!==void 0?ot.depthTexture:null,this.samples=ot.samples!==void 0?ot.samples:0}setSize(_,tt,ot=1){(this.width!==_||this.height!==tt||this.depth!==ot)&&(this.width=_,this.height=tt,this.depth=ot,this.texture.image.width=_,this.texture.image.height=tt,this.texture.image.depth=ot,this.dispose()),this.viewport.set(0,0,_,tt),this.scissor.set(0,0,_,tt)}clone(){return new this.constructor().copy(this)}copy(_){this.width=_.width,this.height=_.height,this.depth=_.depth,this.scissor.copy(_.scissor),this.scissorTest=_.scissorTest,this.viewport.copy(_.viewport),this.texture=_.texture.clone(),this.texture.isRenderTargetTexture=!0;const tt=Object.assign({},_.texture.image);return this.texture.source=new Source(tt),this.depthBuffer=_.depthBuffer,this.stencilBuffer=_.stencilBuffer,_.depthTexture!==null&&(this.depthTexture=_.depthTexture.clone()),this.samples=_.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class DataArrayTexture extends Texture{constructor(_=null,tt=1,ot=1,st=1){super(null),this.isDataArrayTexture=!0,this.image={data:_,width:tt,height:ot,depth:st},this.magFilter=NearestFilter,this.minFilter=NearestFilter,this.wrapR=ClampToEdgeWrapping,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class WebGLArrayRenderTarget extends WebGLRenderTarget{constructor(_=1,tt=1,ot=1){super(_,tt),this.isWebGLArrayRenderTarget=!0,this.depth=ot,this.texture=new DataArrayTexture(null,_,tt,ot),this.texture.isRenderTargetTexture=!0}}class Data3DTexture extends Texture{constructor(_=null,tt=1,ot=1,st=1){super(null),this.isData3DTexture=!0,this.image={data:_,width:tt,height:ot,depth:st},this.magFilter=NearestFilter,this.minFilter=NearestFilter,this.wrapR=ClampToEdgeWrapping,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class WebGL3DRenderTarget extends WebGLRenderTarget{constructor(_=1,tt=1,ot=1){super(_,tt),this.isWebGL3DRenderTarget=!0,this.depth=ot,this.texture=new Data3DTexture(null,_,tt,ot),this.texture.isRenderTargetTexture=!0}}class WebGLMultipleRenderTargets extends WebGLRenderTarget{constructor(_=1,tt=1,ot=1,st={}){super(_,tt,st),this.isWebGLMultipleRenderTargets=!0;const at=this.texture;this.texture=[];for(let lt=0;lt<ot;lt++)this.texture[lt]=at.clone(),this.texture[lt].isRenderTargetTexture=!0}setSize(_,tt,ot=1){if(this.width!==_||this.height!==tt||this.depth!==ot){this.width=_,this.height=tt,this.depth=ot;for(let st=0,at=this.texture.length;st<at;st++)this.texture[st].image.width=_,this.texture[st].image.height=tt,this.texture[st].image.depth=ot;this.dispose()}return this.viewport.set(0,0,_,tt),this.scissor.set(0,0,_,tt),this}copy(_){this.dispose(),this.width=_.width,this.height=_.height,this.depth=_.depth,this.scissor.copy(_.scissor),this.scissorTest=_.scissorTest,this.viewport.copy(_.viewport),this.depthBuffer=_.depthBuffer,this.stencilBuffer=_.stencilBuffer,_.depthTexture!==null&&(this.depthTexture=_.depthTexture.clone()),this.texture.length=0;for(let tt=0,ot=_.texture.length;tt<ot;tt++)this.texture[tt]=_.texture[tt].clone(),this.texture[tt].isRenderTargetTexture=!0;return this}}class Quaternion{constructor(_=0,tt=0,ot=0,st=1){this.isQuaternion=!0,this._x=_,this._y=tt,this._z=ot,this._w=st}static slerpFlat(_,tt,ot,st,at,lt,dt){let ht=ot[st+0],ft=ot[st+1],gt=ot[st+2],Et=ot[st+3];const yt=at[lt+0],Ct=at[lt+1],wt=at[lt+2],It=at[lt+3];if(dt===0){_[tt+0]=ht,_[tt+1]=ft,_[tt+2]=gt,_[tt+3]=Et;return}if(dt===1){_[tt+0]=yt,_[tt+1]=Ct,_[tt+2]=wt,_[tt+3]=It;return}if(Et!==It||ht!==yt||ft!==Ct||gt!==wt){let Pt=1-dt;const Rt=ht*yt+ft*Ct+gt*wt+Et*It,xt=Rt>=0?1:-1,Nt=1-Rt*Rt;if(Nt>Number.EPSILON){const Vt=Math.sqrt(Nt),Ft=Math.atan2(Vt,Rt*xt);Pt=Math.sin(Pt*Ft)/Vt,dt=Math.sin(dt*Ft)/Vt}const kt=dt*xt;if(ht=ht*Pt+yt*kt,ft=ft*Pt+Ct*kt,gt=gt*Pt+wt*kt,Et=Et*Pt+It*kt,Pt===1-dt){const Vt=1/Math.sqrt(ht*ht+ft*ft+gt*gt+Et*Et);ht*=Vt,ft*=Vt,gt*=Vt,Et*=Vt}}_[tt]=ht,_[tt+1]=ft,_[tt+2]=gt,_[tt+3]=Et}static multiplyQuaternionsFlat(_,tt,ot,st,at,lt){const dt=ot[st],ht=ot[st+1],ft=ot[st+2],gt=ot[st+3],Et=at[lt],yt=at[lt+1],Ct=at[lt+2],wt=at[lt+3];return _[tt]=dt*wt+gt*Et+ht*Ct-ft*yt,_[tt+1]=ht*wt+gt*yt+ft*Et-dt*Ct,_[tt+2]=ft*wt+gt*Ct+dt*yt-ht*Et,_[tt+3]=gt*wt-dt*Et-ht*yt-ft*Ct,_}get x(){return this._x}set x(_){this._x=_,this._onChangeCallback()}get y(){return this._y}set y(_){this._y=_,this._onChangeCallback()}get z(){return this._z}set z(_){this._z=_,this._onChangeCallback()}get w(){return this._w}set w(_){this._w=_,this._onChangeCallback()}set(_,tt,ot,st){return this._x=_,this._y=tt,this._z=ot,this._w=st,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(_){return this._x=_.x,this._y=_.y,this._z=_.z,this._w=_.w,this._onChangeCallback(),this}setFromEuler(_,tt){const ot=_._x,st=_._y,at=_._z,lt=_._order,dt=Math.cos,ht=Math.sin,ft=dt(ot/2),gt=dt(st/2),Et=dt(at/2),yt=ht(ot/2),Ct=ht(st/2),wt=ht(at/2);switch(lt){case"XYZ":this._x=yt*gt*Et+ft*Ct*wt,this._y=ft*Ct*Et-yt*gt*wt,this._z=ft*gt*wt+yt*Ct*Et,this._w=ft*gt*Et-yt*Ct*wt;break;case"YXZ":this._x=yt*gt*Et+ft*Ct*wt,this._y=ft*Ct*Et-yt*gt*wt,this._z=ft*gt*wt-yt*Ct*Et,this._w=ft*gt*Et+yt*Ct*wt;break;case"ZXY":this._x=yt*gt*Et-ft*Ct*wt,this._y=ft*Ct*Et+yt*gt*wt,this._z=ft*gt*wt+yt*Ct*Et,this._w=ft*gt*Et-yt*Ct*wt;break;case"ZYX":this._x=yt*gt*Et-ft*Ct*wt,this._y=ft*Ct*Et+yt*gt*wt,this._z=ft*gt*wt-yt*Ct*Et,this._w=ft*gt*Et+yt*Ct*wt;break;case"YZX":this._x=yt*gt*Et+ft*Ct*wt,this._y=ft*Ct*Et+yt*gt*wt,this._z=ft*gt*wt-yt*Ct*Et,this._w=ft*gt*Et-yt*Ct*wt;break;case"XZY":this._x=yt*gt*Et-ft*Ct*wt,this._y=ft*Ct*Et-yt*gt*wt,this._z=ft*gt*wt+yt*Ct*Et,this._w=ft*gt*Et+yt*Ct*wt;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+lt)}return tt!==!1&&this._onChangeCallback(),this}setFromAxisAngle(_,tt){const ot=tt/2,st=Math.sin(ot);return this._x=_.x*st,this._y=_.y*st,this._z=_.z*st,this._w=Math.cos(ot),this._onChangeCallback(),this}setFromRotationMatrix(_){const tt=_.elements,ot=tt[0],st=tt[4],at=tt[8],lt=tt[1],dt=tt[5],ht=tt[9],ft=tt[2],gt=tt[6],Et=tt[10],yt=ot+dt+Et;if(yt>0){const Ct=.5/Math.sqrt(yt+1);this._w=.25/Ct,this._x=(gt-ht)*Ct,this._y=(at-ft)*Ct,this._z=(lt-st)*Ct}else if(ot>dt&&ot>Et){const Ct=2*Math.sqrt(1+ot-dt-Et);this._w=(gt-ht)/Ct,this._x=.25*Ct,this._y=(st+lt)/Ct,this._z=(at+ft)/Ct}else if(dt>Et){const Ct=2*Math.sqrt(1+dt-ot-Et);this._w=(at-ft)/Ct,this._x=(st+lt)/Ct,this._y=.25*Ct,this._z=(ht+gt)/Ct}else{const Ct=2*Math.sqrt(1+Et-ot-dt);this._w=(lt-st)/Ct,this._x=(at+ft)/Ct,this._y=(ht+gt)/Ct,this._z=.25*Ct}return this._onChangeCallback(),this}setFromUnitVectors(_,tt){let ot=_.dot(tt)+1;return ot<Number.EPSILON?(ot=0,Math.abs(_.x)>Math.abs(_.z)?(this._x=-_.y,this._y=_.x,this._z=0,this._w=ot):(this._x=0,this._y=-_.z,this._z=_.y,this._w=ot)):(this._x=_.y*tt.z-_.z*tt.y,this._y=_.z*tt.x-_.x*tt.z,this._z=_.x*tt.y-_.y*tt.x,this._w=ot),this.normalize()}angleTo(_){return 2*Math.acos(Math.abs(clamp$3(this.dot(_),-1,1)))}rotateTowards(_,tt){const ot=this.angleTo(_);if(ot===0)return this;const st=Math.min(1,tt/ot);return this.slerp(_,st),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(_){return this._x*_._x+this._y*_._y+this._z*_._z+this._w*_._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let _=this.length();return _===0?(this._x=0,this._y=0,this._z=0,this._w=1):(_=1/_,this._x=this._x*_,this._y=this._y*_,this._z=this._z*_,this._w=this._w*_),this._onChangeCallback(),this}multiply(_){return this.multiplyQuaternions(this,_)}premultiply(_){return this.multiplyQuaternions(_,this)}multiplyQuaternions(_,tt){const ot=_._x,st=_._y,at=_._z,lt=_._w,dt=tt._x,ht=tt._y,ft=tt._z,gt=tt._w;return this._x=ot*gt+lt*dt+st*ft-at*ht,this._y=st*gt+lt*ht+at*dt-ot*ft,this._z=at*gt+lt*ft+ot*ht-st*dt,this._w=lt*gt-ot*dt-st*ht-at*ft,this._onChangeCallback(),this}slerp(_,tt){if(tt===0)return this;if(tt===1)return this.copy(_);const ot=this._x,st=this._y,at=this._z,lt=this._w;let dt=lt*_._w+ot*_._x+st*_._y+at*_._z;if(dt<0?(this._w=-_._w,this._x=-_._x,this._y=-_._y,this._z=-_._z,dt=-dt):this.copy(_),dt>=1)return this._w=lt,this._x=ot,this._y=st,this._z=at,this;const ht=1-dt*dt;if(ht<=Number.EPSILON){const Ct=1-tt;return this._w=Ct*lt+tt*this._w,this._x=Ct*ot+tt*this._x,this._y=Ct*st+tt*this._y,this._z=Ct*at+tt*this._z,this.normalize(),this._onChangeCallback(),this}const ft=Math.sqrt(ht),gt=Math.atan2(ft,dt),Et=Math.sin((1-tt)*gt)/ft,yt=Math.sin(tt*gt)/ft;return this._w=lt*Et+this._w*yt,this._x=ot*Et+this._x*yt,this._y=st*Et+this._y*yt,this._z=at*Et+this._z*yt,this._onChangeCallback(),this}slerpQuaternions(_,tt,ot){return this.copy(_).slerp(tt,ot)}random(){const _=Math.random(),tt=Math.sqrt(1-_),ot=Math.sqrt(_),st=2*Math.PI*Math.random(),at=2*Math.PI*Math.random();return this.set(tt*Math.cos(st),ot*Math.sin(at),ot*Math.cos(at),tt*Math.sin(st))}equals(_){return _._x===this._x&&_._y===this._y&&_._z===this._z&&_._w===this._w}fromArray(_,tt=0){return this._x=_[tt],this._y=_[tt+1],this._z=_[tt+2],this._w=_[tt+3],this._onChangeCallback(),this}toArray(_=[],tt=0){return _[tt]=this._x,_[tt+1]=this._y,_[tt+2]=this._z,_[tt+3]=this._w,_}fromBufferAttribute(_,tt){return this._x=_.getX(tt),this._y=_.getY(tt),this._z=_.getZ(tt),this._w=_.getW(tt),this}toJSON(){return this.toArray()}_onChange(_){return this._onChangeCallback=_,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class Vector3{constructor(_=0,tt=0,ot=0){Vector3.prototype.isVector3=!0,this.x=_,this.y=tt,this.z=ot}set(_,tt,ot){return ot===void 0&&(ot=this.z),this.x=_,this.y=tt,this.z=ot,this}setScalar(_){return this.x=_,this.y=_,this.z=_,this}setX(_){return this.x=_,this}setY(_){return this.y=_,this}setZ(_){return this.z=_,this}setComponent(_,tt){switch(_){case 0:this.x=tt;break;case 1:this.y=tt;break;case 2:this.z=tt;break;default:throw new Error("index is out of range: "+_)}return this}getComponent(_){switch(_){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+_)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(_){return this.x=_.x,this.y=_.y,this.z=_.z,this}add(_){return this.x+=_.x,this.y+=_.y,this.z+=_.z,this}addScalar(_){return this.x+=_,this.y+=_,this.z+=_,this}addVectors(_,tt){return this.x=_.x+tt.x,this.y=_.y+tt.y,this.z=_.z+tt.z,this}addScaledVector(_,tt){return this.x+=_.x*tt,this.y+=_.y*tt,this.z+=_.z*tt,this}sub(_){return this.x-=_.x,this.y-=_.y,this.z-=_.z,this}subScalar(_){return this.x-=_,this.y-=_,this.z-=_,this}subVectors(_,tt){return this.x=_.x-tt.x,this.y=_.y-tt.y,this.z=_.z-tt.z,this}multiply(_){return this.x*=_.x,this.y*=_.y,this.z*=_.z,this}multiplyScalar(_){return this.x*=_,this.y*=_,this.z*=_,this}multiplyVectors(_,tt){return this.x=_.x*tt.x,this.y=_.y*tt.y,this.z=_.z*tt.z,this}applyEuler(_){return this.applyQuaternion(_quaternion$4.setFromEuler(_))}applyAxisAngle(_,tt){return this.applyQuaternion(_quaternion$4.setFromAxisAngle(_,tt))}applyMatrix3(_){const tt=this.x,ot=this.y,st=this.z,at=_.elements;return this.x=at[0]*tt+at[3]*ot+at[6]*st,this.y=at[1]*tt+at[4]*ot+at[7]*st,this.z=at[2]*tt+at[5]*ot+at[8]*st,this}applyNormalMatrix(_){return this.applyMatrix3(_).normalize()}applyMatrix4(_){const tt=this.x,ot=this.y,st=this.z,at=_.elements,lt=1/(at[3]*tt+at[7]*ot+at[11]*st+at[15]);return this.x=(at[0]*tt+at[4]*ot+at[8]*st+at[12])*lt,this.y=(at[1]*tt+at[5]*ot+at[9]*st+at[13])*lt,this.z=(at[2]*tt+at[6]*ot+at[10]*st+at[14])*lt,this}applyQuaternion(_){const tt=this.x,ot=this.y,st=this.z,at=_.x,lt=_.y,dt=_.z,ht=_.w,ft=ht*tt+lt*st-dt*ot,gt=ht*ot+dt*tt-at*st,Et=ht*st+at*ot-lt*tt,yt=-at*tt-lt*ot-dt*st;return this.x=ft*ht+yt*-at+gt*-dt-Et*-lt,this.y=gt*ht+yt*-lt+Et*-at-ft*-dt,this.z=Et*ht+yt*-dt+ft*-lt-gt*-at,this}project(_){return this.applyMatrix4(_.matrixWorldInverse).applyMatrix4(_.projectionMatrix)}unproject(_){return this.applyMatrix4(_.projectionMatrixInverse).applyMatrix4(_.matrixWorld)}transformDirection(_){const tt=this.x,ot=this.y,st=this.z,at=_.elements;return this.x=at[0]*tt+at[4]*ot+at[8]*st,this.y=at[1]*tt+at[5]*ot+at[9]*st,this.z=at[2]*tt+at[6]*ot+at[10]*st,this.normalize()}divide(_){return this.x/=_.x,this.y/=_.y,this.z/=_.z,this}divideScalar(_){return this.multiplyScalar(1/_)}min(_){return this.x=Math.min(this.x,_.x),this.y=Math.min(this.y,_.y),this.z=Math.min(this.z,_.z),this}max(_){return this.x=Math.max(this.x,_.x),this.y=Math.max(this.y,_.y),this.z=Math.max(this.z,_.z),this}clamp(_,tt){return this.x=Math.max(_.x,Math.min(tt.x,this.x)),this.y=Math.max(_.y,Math.min(tt.y,this.y)),this.z=Math.max(_.z,Math.min(tt.z,this.z)),this}clampScalar(_,tt){return this.x=Math.max(_,Math.min(tt,this.x)),this.y=Math.max(_,Math.min(tt,this.y)),this.z=Math.max(_,Math.min(tt,this.z)),this}clampLength(_,tt){const ot=this.length();return this.divideScalar(ot||1).multiplyScalar(Math.max(_,Math.min(tt,ot)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(_){return this.x*_.x+this.y*_.y+this.z*_.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(_){return this.normalize().multiplyScalar(_)}lerp(_,tt){return this.x+=(_.x-this.x)*tt,this.y+=(_.y-this.y)*tt,this.z+=(_.z-this.z)*tt,this}lerpVectors(_,tt,ot){return this.x=_.x+(tt.x-_.x)*ot,this.y=_.y+(tt.y-_.y)*ot,this.z=_.z+(tt.z-_.z)*ot,this}cross(_){return this.crossVectors(this,_)}crossVectors(_,tt){const ot=_.x,st=_.y,at=_.z,lt=tt.x,dt=tt.y,ht=tt.z;return this.x=st*ht-at*dt,this.y=at*lt-ot*ht,this.z=ot*dt-st*lt,this}projectOnVector(_){const tt=_.lengthSq();if(tt===0)return this.set(0,0,0);const ot=_.dot(this)/tt;return this.copy(_).multiplyScalar(ot)}projectOnPlane(_){return _vector$b.copy(this).projectOnVector(_),this.sub(_vector$b)}reflect(_){return this.sub(_vector$b.copy(_).multiplyScalar(2*this.dot(_)))}angleTo(_){const tt=Math.sqrt(this.lengthSq()*_.lengthSq());if(tt===0)return Math.PI/2;const ot=this.dot(_)/tt;return Math.acos(clamp$3(ot,-1,1))}distanceTo(_){return Math.sqrt(this.distanceToSquared(_))}distanceToSquared(_){const tt=this.x-_.x,ot=this.y-_.y,st=this.z-_.z;return tt*tt+ot*ot+st*st}manhattanDistanceTo(_){return Math.abs(this.x-_.x)+Math.abs(this.y-_.y)+Math.abs(this.z-_.z)}setFromSpherical(_){return this.setFromSphericalCoords(_.radius,_.phi,_.theta)}setFromSphericalCoords(_,tt,ot){const st=Math.sin(tt)*_;return this.x=st*Math.sin(ot),this.y=Math.cos(tt)*_,this.z=st*Math.cos(ot),this}setFromCylindrical(_){return this.setFromCylindricalCoords(_.radius,_.theta,_.y)}setFromCylindricalCoords(_,tt,ot){return this.x=_*Math.sin(tt),this.y=ot,this.z=_*Math.cos(tt),this}setFromMatrixPosition(_){const tt=_.elements;return this.x=tt[12],this.y=tt[13],this.z=tt[14],this}setFromMatrixScale(_){const tt=this.setFromMatrixColumn(_,0).length(),ot=this.setFromMatrixColumn(_,1).length(),st=this.setFromMatrixColumn(_,2).length();return this.x=tt,this.y=ot,this.z=st,this}setFromMatrixColumn(_,tt){return this.fromArray(_.elements,tt*4)}setFromMatrix3Column(_,tt){return this.fromArray(_.elements,tt*3)}setFromEuler(_){return this.x=_._x,this.y=_._y,this.z=_._z,this}setFromColor(_){return this.x=_.r,this.y=_.g,this.z=_.b,this}equals(_){return _.x===this.x&&_.y===this.y&&_.z===this.z}fromArray(_,tt=0){return this.x=_[tt],this.y=_[tt+1],this.z=_[tt+2],this}toArray(_=[],tt=0){return _[tt]=this.x,_[tt+1]=this.y,_[tt+2]=this.z,_}fromBufferAttribute(_,tt){return this.x=_.getX(tt),this.y=_.getY(tt),this.z=_.getZ(tt),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const _=(Math.random()-.5)*2,tt=Math.random()*Math.PI*2,ot=Math.sqrt(1-_**2);return this.x=ot*Math.cos(tt),this.y=ot*Math.sin(tt),this.z=_,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const _vector$b=new Vector3,_quaternion$4=new Quaternion;class Box3{constructor(_=new Vector3(1/0,1/0,1/0),tt=new Vector3(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=_,this.max=tt}set(_,tt){return this.min.copy(_),this.max.copy(tt),this}setFromArray(_){this.makeEmpty();for(let tt=0,ot=_.length;tt<ot;tt+=3)this.expandByPoint(_vector$a.fromArray(_,tt));return this}setFromBufferAttribute(_){this.makeEmpty();for(let tt=0,ot=_.count;tt<ot;tt++)this.expandByPoint(_vector$a.fromBufferAttribute(_,tt));return this}setFromPoints(_){this.makeEmpty();for(let tt=0,ot=_.length;tt<ot;tt++)this.expandByPoint(_[tt]);return this}setFromCenterAndSize(_,tt){const ot=_vector$a.copy(tt).multiplyScalar(.5);return this.min.copy(_).sub(ot),this.max.copy(_).add(ot),this}setFromObject(_,tt=!1){return this.makeEmpty(),this.expandByObject(_,tt)}clone(){return new this.constructor().copy(this)}copy(_){return this.min.copy(_.min),this.max.copy(_.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(_){return this.isEmpty()?_.set(0,0,0):_.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(_){return this.isEmpty()?_.set(0,0,0):_.subVectors(this.max,this.min)}expandByPoint(_){return this.min.min(_),this.max.max(_),this}expandByVector(_){return this.min.sub(_),this.max.add(_),this}expandByScalar(_){return this.min.addScalar(-_),this.max.addScalar(_),this}expandByObject(_,tt=!1){if(_.updateWorldMatrix(!1,!1),_.boundingBox!==void 0)_.boundingBox===null&&_.computeBoundingBox(),_box$3.copy(_.boundingBox),_box$3.applyMatrix4(_.matrixWorld),this.union(_box$3);else{const st=_.geometry;if(st!==void 0)if(tt&&st.attributes!==void 0&&st.attributes.position!==void 0){const at=st.attributes.position;for(let lt=0,dt=at.count;lt<dt;lt++)_vector$a.fromBufferAttribute(at,lt).applyMatrix4(_.matrixWorld),this.expandByPoint(_vector$a)}else st.boundingBox===null&&st.computeBoundingBox(),_box$3.copy(st.boundingBox),_box$3.applyMatrix4(_.matrixWorld),this.union(_box$3)}const ot=_.children;for(let st=0,at=ot.length;st<at;st++)this.expandByObject(ot[st],tt);return this}containsPoint(_){return!(_.x<this.min.x||_.x>this.max.x||_.y<this.min.y||_.y>this.max.y||_.z<this.min.z||_.z>this.max.z)}containsBox(_){return this.min.x<=_.min.x&&_.max.x<=this.max.x&&this.min.y<=_.min.y&&_.max.y<=this.max.y&&this.min.z<=_.min.z&&_.max.z<=this.max.z}getParameter(_,tt){return tt.set((_.x-this.min.x)/(this.max.x-this.min.x),(_.y-this.min.y)/(this.max.y-this.min.y),(_.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(_){return!(_.max.x<this.min.x||_.min.x>this.max.x||_.max.y<this.min.y||_.min.y>this.max.y||_.max.z<this.min.z||_.min.z>this.max.z)}intersectsSphere(_){return this.clampPoint(_.center,_vector$a),_vector$a.distanceToSquared(_.center)<=_.radius*_.radius}intersectsPlane(_){let tt,ot;return _.normal.x>0?(tt=_.normal.x*this.min.x,ot=_.normal.x*this.max.x):(tt=_.normal.x*this.max.x,ot=_.normal.x*this.min.x),_.normal.y>0?(tt+=_.normal.y*this.min.y,ot+=_.normal.y*this.max.y):(tt+=_.normal.y*this.max.y,ot+=_.normal.y*this.min.y),_.normal.z>0?(tt+=_.normal.z*this.min.z,ot+=_.normal.z*this.max.z):(tt+=_.normal.z*this.max.z,ot+=_.normal.z*this.min.z),tt<=-_.constant&&ot>=-_.constant}intersectsTriangle(_){if(this.isEmpty())return!1;this.getCenter(_center),_extents.subVectors(this.max,_center),_v0$2.subVectors(_.a,_center),_v1$7.subVectors(_.b,_center),_v2$4.subVectors(_.c,_center),_f0.subVectors(_v1$7,_v0$2),_f1.subVectors(_v2$4,_v1$7),_f2.subVectors(_v0$2,_v2$4);let tt=[0,-_f0.z,_f0.y,0,-_f1.z,_f1.y,0,-_f2.z,_f2.y,_f0.z,0,-_f0.x,_f1.z,0,-_f1.x,_f2.z,0,-_f2.x,-_f0.y,_f0.x,0,-_f1.y,_f1.x,0,-_f2.y,_f2.x,0];return!satForAxes(tt,_v0$2,_v1$7,_v2$4,_extents)||(tt=[1,0,0,0,1,0,0,0,1],!satForAxes(tt,_v0$2,_v1$7,_v2$4,_extents))?!1:(_triangleNormal.crossVectors(_f0,_f1),tt=[_triangleNormal.x,_triangleNormal.y,_triangleNormal.z],satForAxes(tt,_v0$2,_v1$7,_v2$4,_extents))}clampPoint(_,tt){return tt.copy(_).clamp(this.min,this.max)}distanceToPoint(_){return this.clampPoint(_,_vector$a).distanceTo(_)}getBoundingSphere(_){return this.isEmpty()?_.makeEmpty():(this.getCenter(_.center),_.radius=this.getSize(_vector$a).length()*.5),_}intersect(_){return this.min.max(_.min),this.max.min(_.max),this.isEmpty()&&this.makeEmpty(),this}union(_){return this.min.min(_.min),this.max.max(_.max),this}applyMatrix4(_){return this.isEmpty()?this:(_points[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(_),_points[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(_),_points[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(_),_points[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(_),_points[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(_),_points[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(_),_points[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(_),_points[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(_),this.setFromPoints(_points),this)}translate(_){return this.min.add(_),this.max.add(_),this}equals(_){return _.min.equals(this.min)&&_.max.equals(this.max)}}const _points=[new Vector3,new Vector3,new Vector3,new Vector3,new Vector3,new Vector3,new Vector3,new Vector3],_vector$a=new Vector3,_box$3=new Box3,_v0$2=new Vector3,_v1$7=new Vector3,_v2$4=new Vector3,_f0=new Vector3,_f1=new Vector3,_f2=new Vector3,_center=new Vector3,_extents=new Vector3,_triangleNormal=new Vector3,_testAxis=new Vector3;function satForAxes(nt,_,tt,ot,st){for(let at=0,lt=nt.length-3;at<=lt;at+=3){_testAxis.fromArray(nt,at);const dt=st.x*Math.abs(_testAxis.x)+st.y*Math.abs(_testAxis.y)+st.z*Math.abs(_testAxis.z),ht=_.dot(_testAxis),ft=tt.dot(_testAxis),gt=ot.dot(_testAxis);if(Math.max(-Math.max(ht,ft,gt),Math.min(ht,ft,gt))>dt)return!1}return!0}const _box$2=new Box3,_v1$6=new Vector3,_v2$3=new Vector3;class Sphere{constructor(_=new Vector3,tt=-1){this.center=_,this.radius=tt}set(_,tt){return this.center.copy(_),this.radius=tt,this}setFromPoints(_,tt){const ot=this.center;tt!==void 0?ot.copy(tt):_box$2.setFromPoints(_).getCenter(ot);let st=0;for(let at=0,lt=_.length;at<lt;at++)st=Math.max(st,ot.distanceToSquared(_[at]));return this.radius=Math.sqrt(st),this}copy(_){return this.center.copy(_.center),this.radius=_.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(_){return _.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(_){return _.distanceTo(this.center)-this.radius}intersectsSphere(_){const tt=this.radius+_.radius;return _.center.distanceToSquared(this.center)<=tt*tt}intersectsBox(_){return _.intersectsSphere(this)}intersectsPlane(_){return Math.abs(_.distanceToPoint(this.center))<=this.radius}clampPoint(_,tt){const ot=this.center.distanceToSquared(_);return tt.copy(_),ot>this.radius*this.radius&&(tt.sub(this.center).normalize(),tt.multiplyScalar(this.radius).add(this.center)),tt}getBoundingBox(_){return this.isEmpty()?(_.makeEmpty(),_):(_.set(this.center,this.center),_.expandByScalar(this.radius),_)}applyMatrix4(_){return this.center.applyMatrix4(_),this.radius=this.radius*_.getMaxScaleOnAxis(),this}translate(_){return this.center.add(_),this}expandByPoint(_){if(this.isEmpty())return this.center.copy(_),this.radius=0,this;_v1$6.subVectors(_,this.center);const tt=_v1$6.lengthSq();if(tt>this.radius*this.radius){const ot=Math.sqrt(tt),st=(ot-this.radius)*.5;this.center.addScaledVector(_v1$6,st/ot),this.radius+=st}return this}union(_){return _.isEmpty()?this:this.isEmpty()?(this.copy(_),this):(this.center.equals(_.center)===!0?this.radius=Math.max(this.radius,_.radius):(_v2$3.subVectors(_.center,this.center).setLength(_.radius),this.expandByPoint(_v1$6.copy(_.center).add(_v2$3)),this.expandByPoint(_v1$6.copy(_.center).sub(_v2$3))),this)}equals(_){return _.center.equals(this.center)&&_.radius===this.radius}clone(){return new this.constructor().copy(this)}}const _vector$9=new Vector3,_segCenter=new Vector3,_segDir=new Vector3,_diff=new Vector3,_edge1=new Vector3,_edge2=new Vector3,_normal$1=new Vector3;class Ray{constructor(_=new Vector3,tt=new Vector3(0,0,-1)){this.origin=_,this.direction=tt}set(_,tt){return this.origin.copy(_),this.direction.copy(tt),this}copy(_){return this.origin.copy(_.origin),this.direction.copy(_.direction),this}at(_,tt){return tt.copy(this.origin).addScaledVector(this.direction,_)}lookAt(_){return this.direction.copy(_).sub(this.origin).normalize(),this}recast(_){return this.origin.copy(this.at(_,_vector$9)),this}closestPointToPoint(_,tt){tt.subVectors(_,this.origin);const ot=tt.dot(this.direction);return ot<0?tt.copy(this.origin):tt.copy(this.origin).addScaledVector(this.direction,ot)}distanceToPoint(_){return Math.sqrt(this.distanceSqToPoint(_))}distanceSqToPoint(_){const tt=_vector$9.subVectors(_,this.origin).dot(this.direction);return tt<0?this.origin.distanceToSquared(_):(_vector$9.copy(this.origin).addScaledVector(this.direction,tt),_vector$9.distanceToSquared(_))}distanceSqToSegment(_,tt,ot,st){_segCenter.copy(_).add(tt).multiplyScalar(.5),_segDir.copy(tt).sub(_).normalize(),_diff.copy(this.origin).sub(_segCenter);const at=_.distanceTo(tt)*.5,lt=-this.direction.dot(_segDir),dt=_diff.dot(this.direction),ht=-_diff.dot(_segDir),ft=_diff.lengthSq(),gt=Math.abs(1-lt*lt);let Et,yt,Ct,wt;if(gt>0)if(Et=lt*ht-dt,yt=lt*dt-ht,wt=at*gt,Et>=0)if(yt>=-wt)if(yt<=wt){const It=1/gt;Et*=It,yt*=It,Ct=Et*(Et+lt*yt+2*dt)+yt*(lt*Et+yt+2*ht)+ft}else yt=at,Et=Math.max(0,-(lt*yt+dt)),Ct=-Et*Et+yt*(yt+2*ht)+ft;else yt=-at,Et=Math.max(0,-(lt*yt+dt)),Ct=-Et*Et+yt*(yt+2*ht)+ft;else yt<=-wt?(Et=Math.max(0,-(-lt*at+dt)),yt=Et>0?-at:Math.min(Math.max(-at,-ht),at),Ct=-Et*Et+yt*(yt+2*ht)+ft):yt<=wt?(Et=0,yt=Math.min(Math.max(-at,-ht),at),Ct=yt*(yt+2*ht)+ft):(Et=Math.max(0,-(lt*at+dt)),yt=Et>0?at:Math.min(Math.max(-at,-ht),at),Ct=-Et*Et+yt*(yt+2*ht)+ft);else yt=lt>0?-at:at,Et=Math.max(0,-(lt*yt+dt)),Ct=-Et*Et+yt*(yt+2*ht)+ft;return ot&&ot.copy(this.origin).addScaledVector(this.direction,Et),st&&st.copy(_segCenter).addScaledVector(_segDir,yt),Ct}intersectSphere(_,tt){_vector$9.subVectors(_.center,this.origin);const ot=_vector$9.dot(this.direction),st=_vector$9.dot(_vector$9)-ot*ot,at=_.radius*_.radius;if(st>at)return null;const lt=Math.sqrt(at-st),dt=ot-lt,ht=ot+lt;return ht<0?null:dt<0?this.at(ht,tt):this.at(dt,tt)}intersectsSphere(_){return this.distanceSqToPoint(_.center)<=_.radius*_.radius}distanceToPlane(_){const tt=_.normal.dot(this.direction);if(tt===0)return _.distanceToPoint(this.origin)===0?0:null;const ot=-(this.origin.dot(_.normal)+_.constant)/tt;return ot>=0?ot:null}intersectPlane(_,tt){const ot=this.distanceToPlane(_);return ot===null?null:this.at(ot,tt)}intersectsPlane(_){const tt=_.distanceToPoint(this.origin);return tt===0||_.normal.dot(this.direction)*tt<0}intersectBox(_,tt){let ot,st,at,lt,dt,ht;const ft=1/this.direction.x,gt=1/this.direction.y,Et=1/this.direction.z,yt=this.origin;return ft>=0?(ot=(_.min.x-yt.x)*ft,st=(_.max.x-yt.x)*ft):(ot=(_.max.x-yt.x)*ft,st=(_.min.x-yt.x)*ft),gt>=0?(at=(_.min.y-yt.y)*gt,lt=(_.max.y-yt.y)*gt):(at=(_.max.y-yt.y)*gt,lt=(_.min.y-yt.y)*gt),ot>lt||at>st||((at>ot||isNaN(ot))&&(ot=at),(lt<st||isNaN(st))&&(st=lt),Et>=0?(dt=(_.min.z-yt.z)*Et,ht=(_.max.z-yt.z)*Et):(dt=(_.max.z-yt.z)*Et,ht=(_.min.z-yt.z)*Et),ot>ht||dt>st)||((dt>ot||ot!==ot)&&(ot=dt),(ht<st||st!==st)&&(st=ht),st<0)?null:this.at(ot>=0?ot:st,tt)}intersectsBox(_){return this.intersectBox(_,_vector$9)!==null}intersectTriangle(_,tt,ot,st,at){_edge1.subVectors(tt,_),_edge2.subVectors(ot,_),_normal$1.crossVectors(_edge1,_edge2);let lt=this.direction.dot(_normal$1),dt;if(lt>0){if(st)return null;dt=1}else if(lt<0)dt=-1,lt=-lt;else return null;_diff.subVectors(this.origin,_);const ht=dt*this.direction.dot(_edge2.crossVectors(_diff,_edge2));if(ht<0)return null;const ft=dt*this.direction.dot(_edge1.cross(_diff));if(ft<0||ht+ft>lt)return null;const gt=-dt*_diff.dot(_normal$1);return gt<0?null:this.at(gt/lt,at)}applyMatrix4(_){return this.origin.applyMatrix4(_),this.direction.transformDirection(_),this}equals(_){return _.origin.equals(this.origin)&&_.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class Matrix4{constructor(_,tt,ot,st,at,lt,dt,ht,ft,gt,Et,yt,Ct,wt,It,Pt){Matrix4.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],_!==void 0&&this.set(_,tt,ot,st,at,lt,dt,ht,ft,gt,Et,yt,Ct,wt,It,Pt)}set(_,tt,ot,st,at,lt,dt,ht,ft,gt,Et,yt,Ct,wt,It,Pt){const Rt=this.elements;return Rt[0]=_,Rt[4]=tt,Rt[8]=ot,Rt[12]=st,Rt[1]=at,Rt[5]=lt,Rt[9]=dt,Rt[13]=ht,Rt[2]=ft,Rt[6]=gt,Rt[10]=Et,Rt[14]=yt,Rt[3]=Ct,Rt[7]=wt,Rt[11]=It,Rt[15]=Pt,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new Matrix4().fromArray(this.elements)}copy(_){const tt=this.elements,ot=_.elements;return tt[0]=ot[0],tt[1]=ot[1],tt[2]=ot[2],tt[3]=ot[3],tt[4]=ot[4],tt[5]=ot[5],tt[6]=ot[6],tt[7]=ot[7],tt[8]=ot[8],tt[9]=ot[9],tt[10]=ot[10],tt[11]=ot[11],tt[12]=ot[12],tt[13]=ot[13],tt[14]=ot[14],tt[15]=ot[15],this}copyPosition(_){const tt=this.elements,ot=_.elements;return tt[12]=ot[12],tt[13]=ot[13],tt[14]=ot[14],this}setFromMatrix3(_){const tt=_.elements;return this.set(tt[0],tt[3],tt[6],0,tt[1],tt[4],tt[7],0,tt[2],tt[5],tt[8],0,0,0,0,1),this}extractBasis(_,tt,ot){return _.setFromMatrixColumn(this,0),tt.setFromMatrixColumn(this,1),ot.setFromMatrixColumn(this,2),this}makeBasis(_,tt,ot){return this.set(_.x,tt.x,ot.x,0,_.y,tt.y,ot.y,0,_.z,tt.z,ot.z,0,0,0,0,1),this}extractRotation(_){const tt=this.elements,ot=_.elements,st=1/_v1$5.setFromMatrixColumn(_,0).length(),at=1/_v1$5.setFromMatrixColumn(_,1).length(),lt=1/_v1$5.setFromMatrixColumn(_,2).length();return tt[0]=ot[0]*st,tt[1]=ot[1]*st,tt[2]=ot[2]*st,tt[3]=0,tt[4]=ot[4]*at,tt[5]=ot[5]*at,tt[6]=ot[6]*at,tt[7]=0,tt[8]=ot[8]*lt,tt[9]=ot[9]*lt,tt[10]=ot[10]*lt,tt[11]=0,tt[12]=0,tt[13]=0,tt[14]=0,tt[15]=1,this}makeRotationFromEuler(_){const tt=this.elements,ot=_.x,st=_.y,at=_.z,lt=Math.cos(ot),dt=Math.sin(ot),ht=Math.cos(st),ft=Math.sin(st),gt=Math.cos(at),Et=Math.sin(at);if(_.order==="XYZ"){const yt=lt*gt,Ct=lt*Et,wt=dt*gt,It=dt*Et;tt[0]=ht*gt,tt[4]=-ht*Et,tt[8]=ft,tt[1]=Ct+wt*ft,tt[5]=yt-It*ft,tt[9]=-dt*ht,tt[2]=It-yt*ft,tt[6]=wt+Ct*ft,tt[10]=lt*ht}else if(_.order==="YXZ"){const yt=ht*gt,Ct=ht*Et,wt=ft*gt,It=ft*Et;tt[0]=yt+It*dt,tt[4]=wt*dt-Ct,tt[8]=lt*ft,tt[1]=lt*Et,tt[5]=lt*gt,tt[9]=-dt,tt[2]=Ct*dt-wt,tt[6]=It+yt*dt,tt[10]=lt*ht}else if(_.order==="ZXY"){const yt=ht*gt,Ct=ht*Et,wt=ft*gt,It=ft*Et;tt[0]=yt-It*dt,tt[4]=-lt*Et,tt[8]=wt+Ct*dt,tt[1]=Ct+wt*dt,tt[5]=lt*gt,tt[9]=It-yt*dt,tt[2]=-lt*ft,tt[6]=dt,tt[10]=lt*ht}else if(_.order==="ZYX"){const yt=lt*gt,Ct=lt*Et,wt=dt*gt,It=dt*Et;tt[0]=ht*gt,tt[4]=wt*ft-Ct,tt[8]=yt*ft+It,tt[1]=ht*Et,tt[5]=It*ft+yt,tt[9]=Ct*ft-wt,tt[2]=-ft,tt[6]=dt*ht,tt[10]=lt*ht}else if(_.order==="YZX"){const yt=lt*ht,Ct=lt*ft,wt=dt*ht,It=dt*ft;tt[0]=ht*gt,tt[4]=It-yt*Et,tt[8]=wt*Et+Ct,tt[1]=Et,tt[5]=lt*gt,tt[9]=-dt*gt,tt[2]=-ft*gt,tt[6]=Ct*Et+wt,tt[10]=yt-It*Et}else if(_.order==="XZY"){const yt=lt*ht,Ct=lt*ft,wt=dt*ht,It=dt*ft;tt[0]=ht*gt,tt[4]=-Et,tt[8]=ft*gt,tt[1]=yt*Et+It,tt[5]=lt*gt,tt[9]=Ct*Et-wt,tt[2]=wt*Et-Ct,tt[6]=dt*gt,tt[10]=It*Et+yt}return tt[3]=0,tt[7]=0,tt[11]=0,tt[12]=0,tt[13]=0,tt[14]=0,tt[15]=1,this}makeRotationFromQuaternion(_){return this.compose(_zero,_,_one)}lookAt(_,tt,ot){const st=this.elements;return _z.subVectors(_,tt),_z.lengthSq()===0&&(_z.z=1),_z.normalize(),_x.crossVectors(ot,_z),_x.lengthSq()===0&&(Math.abs(ot.z)===1?_z.x+=1e-4:_z.z+=1e-4,_z.normalize(),_x.crossVectors(ot,_z)),_x.normalize(),_y.crossVectors(_z,_x),st[0]=_x.x,st[4]=_y.x,st[8]=_z.x,st[1]=_x.y,st[5]=_y.y,st[9]=_z.y,st[2]=_x.z,st[6]=_y.z,st[10]=_z.z,this}multiply(_){return this.multiplyMatrices(this,_)}premultiply(_){return this.multiplyMatrices(_,this)}multiplyMatrices(_,tt){const ot=_.elements,st=tt.elements,at=this.elements,lt=ot[0],dt=ot[4],ht=ot[8],ft=ot[12],gt=ot[1],Et=ot[5],yt=ot[9],Ct=ot[13],wt=ot[2],It=ot[6],Pt=ot[10],Rt=ot[14],xt=ot[3],Nt=ot[7],kt=ot[11],Vt=ot[15],Ft=st[0],zt=st[4],Yt=st[8],Kt=st[12],qt=st[1],pn=st[5],an=st[9],fn=st[13],dn=st[2],Cn=st[6],On=st[10],Pn=st[14],yn=st[3],An=st[7],Sn=st[11],gn=st[15];return at[0]=lt*Ft+dt*qt+ht*dn+ft*yn,at[4]=lt*zt+dt*pn+ht*Cn+ft*An,at[8]=lt*Yt+dt*an+ht*On+ft*Sn,at[12]=lt*Kt+dt*fn+ht*Pn+ft*gn,at[1]=gt*Ft+Et*qt+yt*dn+Ct*yn,at[5]=gt*zt+Et*pn+yt*Cn+Ct*An,at[9]=gt*Yt+Et*an+yt*On+Ct*Sn,at[13]=gt*Kt+Et*fn+yt*Pn+Ct*gn,at[2]=wt*Ft+It*qt+Pt*dn+Rt*yn,at[6]=wt*zt+It*pn+Pt*Cn+Rt*An,at[10]=wt*Yt+It*an+Pt*On+Rt*Sn,at[14]=wt*Kt+It*fn+Pt*Pn+Rt*gn,at[3]=xt*Ft+Nt*qt+kt*dn+Vt*yn,at[7]=xt*zt+Nt*pn+kt*Cn+Vt*An,at[11]=xt*Yt+Nt*an+kt*On+Vt*Sn,at[15]=xt*Kt+Nt*fn+kt*Pn+Vt*gn,this}multiplyScalar(_){const tt=this.elements;return tt[0]*=_,tt[4]*=_,tt[8]*=_,tt[12]*=_,tt[1]*=_,tt[5]*=_,tt[9]*=_,tt[13]*=_,tt[2]*=_,tt[6]*=_,tt[10]*=_,tt[14]*=_,tt[3]*=_,tt[7]*=_,tt[11]*=_,tt[15]*=_,this}determinant(){const _=this.elements,tt=_[0],ot=_[4],st=_[8],at=_[12],lt=_[1],dt=_[5],ht=_[9],ft=_[13],gt=_[2],Et=_[6],yt=_[10],Ct=_[14],wt=_[3],It=_[7],Pt=_[11],Rt=_[15];return wt*(+at*ht*Et-st*ft*Et-at*dt*yt+ot*ft*yt+st*dt*Ct-ot*ht*Ct)+It*(+tt*ht*Ct-tt*ft*yt+at*lt*yt-st*lt*Ct+st*ft*gt-at*ht*gt)+Pt*(+tt*ft*Et-tt*dt*Ct-at*lt*Et+ot*lt*Ct+at*dt*gt-ot*ft*gt)+Rt*(-st*dt*gt-tt*ht*Et+tt*dt*yt+st*lt*Et-ot*lt*yt+ot*ht*gt)}transpose(){const _=this.elements;let tt;return tt=_[1],_[1]=_[4],_[4]=tt,tt=_[2],_[2]=_[8],_[8]=tt,tt=_[6],_[6]=_[9],_[9]=tt,tt=_[3],_[3]=_[12],_[12]=tt,tt=_[7],_[7]=_[13],_[13]=tt,tt=_[11],_[11]=_[14],_[14]=tt,this}setPosition(_,tt,ot){const st=this.elements;return _.isVector3?(st[12]=_.x,st[13]=_.y,st[14]=_.z):(st[12]=_,st[13]=tt,st[14]=ot),this}invert(){const _=this.elements,tt=_[0],ot=_[1],st=_[2],at=_[3],lt=_[4],dt=_[5],ht=_[6],ft=_[7],gt=_[8],Et=_[9],yt=_[10],Ct=_[11],wt=_[12],It=_[13],Pt=_[14],Rt=_[15],xt=Et*Pt*ft-It*yt*ft+It*ht*Ct-dt*Pt*Ct-Et*ht*Rt+dt*yt*Rt,Nt=wt*yt*ft-gt*Pt*ft-wt*ht*Ct+lt*Pt*Ct+gt*ht*Rt-lt*yt*Rt,kt=gt*It*ft-wt*Et*ft+wt*dt*Ct-lt*It*Ct-gt*dt*Rt+lt*Et*Rt,Vt=wt*Et*ht-gt*It*ht-wt*dt*yt+lt*It*yt+gt*dt*Pt-lt*Et*Pt,Ft=tt*xt+ot*Nt+st*kt+at*Vt;if(Ft===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const zt=1/Ft;return _[0]=xt*zt,_[1]=(It*yt*at-Et*Pt*at-It*st*Ct+ot*Pt*Ct+Et*st*Rt-ot*yt*Rt)*zt,_[2]=(dt*Pt*at-It*ht*at+It*st*ft-ot*Pt*ft-dt*st*Rt+ot*ht*Rt)*zt,_[3]=(Et*ht*at-dt*yt*at-Et*st*ft+ot*yt*ft+dt*st*Ct-ot*ht*Ct)*zt,_[4]=Nt*zt,_[5]=(gt*Pt*at-wt*yt*at+wt*st*Ct-tt*Pt*Ct-gt*st*Rt+tt*yt*Rt)*zt,_[6]=(wt*ht*at-lt*Pt*at-wt*st*ft+tt*Pt*ft+lt*st*Rt-tt*ht*Rt)*zt,_[7]=(lt*yt*at-gt*ht*at+gt*st*ft-tt*yt*ft-lt*st*Ct+tt*ht*Ct)*zt,_[8]=kt*zt,_[9]=(wt*Et*at-gt*It*at-wt*ot*Ct+tt*It*Ct+gt*ot*Rt-tt*Et*Rt)*zt,_[10]=(lt*It*at-wt*dt*at+wt*ot*ft-tt*It*ft-lt*ot*Rt+tt*dt*Rt)*zt,_[11]=(gt*dt*at-lt*Et*at-gt*ot*ft+tt*Et*ft+lt*ot*Ct-tt*dt*Ct)*zt,_[12]=Vt*zt,_[13]=(gt*It*st-wt*Et*st+wt*ot*yt-tt*It*yt-gt*ot*Pt+tt*Et*Pt)*zt,_[14]=(wt*dt*st-lt*It*st-wt*ot*ht+tt*It*ht+lt*ot*Pt-tt*dt*Pt)*zt,_[15]=(lt*Et*st-gt*dt*st+gt*ot*ht-tt*Et*ht-lt*ot*yt+tt*dt*yt)*zt,this}scale(_){const tt=this.elements,ot=_.x,st=_.y,at=_.z;return tt[0]*=ot,tt[4]*=st,tt[8]*=at,tt[1]*=ot,tt[5]*=st,tt[9]*=at,tt[2]*=ot,tt[6]*=st,tt[10]*=at,tt[3]*=ot,tt[7]*=st,tt[11]*=at,this}getMaxScaleOnAxis(){const _=this.elements,tt=_[0]*_[0]+_[1]*_[1]+_[2]*_[2],ot=_[4]*_[4]+_[5]*_[5]+_[6]*_[6],st=_[8]*_[8]+_[9]*_[9]+_[10]*_[10];return Math.sqrt(Math.max(tt,ot,st))}makeTranslation(_,tt,ot){return _.isVector3?this.set(1,0,0,_.x,0,1,0,_.y,0,0,1,_.z,0,0,0,1):this.set(1,0,0,_,0,1,0,tt,0,0,1,ot,0,0,0,1),this}makeRotationX(_){const tt=Math.cos(_),ot=Math.sin(_);return this.set(1,0,0,0,0,tt,-ot,0,0,ot,tt,0,0,0,0,1),this}makeRotationY(_){const tt=Math.cos(_),ot=Math.sin(_);return this.set(tt,0,ot,0,0,1,0,0,-ot,0,tt,0,0,0,0,1),this}makeRotationZ(_){const tt=Math.cos(_),ot=Math.sin(_);return this.set(tt,-ot,0,0,ot,tt,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(_,tt){const ot=Math.cos(tt),st=Math.sin(tt),at=1-ot,lt=_.x,dt=_.y,ht=_.z,ft=at*lt,gt=at*dt;return this.set(ft*lt+ot,ft*dt-st*ht,ft*ht+st*dt,0,ft*dt+st*ht,gt*dt+ot,gt*ht-st*lt,0,ft*ht-st*dt,gt*ht+st*lt,at*ht*ht+ot,0,0,0,0,1),this}makeScale(_,tt,ot){return this.set(_,0,0,0,0,tt,0,0,0,0,ot,0,0,0,0,1),this}makeShear(_,tt,ot,st,at,lt){return this.set(1,ot,at,0,_,1,lt,0,tt,st,1,0,0,0,0,1),this}compose(_,tt,ot){const st=this.elements,at=tt._x,lt=tt._y,dt=tt._z,ht=tt._w,ft=at+at,gt=lt+lt,Et=dt+dt,yt=at*ft,Ct=at*gt,wt=at*Et,It=lt*gt,Pt=lt*Et,Rt=dt*Et,xt=ht*ft,Nt=ht*gt,kt=ht*Et,Vt=ot.x,Ft=ot.y,zt=ot.z;return st[0]=(1-(It+Rt))*Vt,st[1]=(Ct+kt)*Vt,st[2]=(wt-Nt)*Vt,st[3]=0,st[4]=(Ct-kt)*Ft,st[5]=(1-(yt+Rt))*Ft,st[6]=(Pt+xt)*Ft,st[7]=0,st[8]=(wt+Nt)*zt,st[9]=(Pt-xt)*zt,st[10]=(1-(yt+It))*zt,st[11]=0,st[12]=_.x,st[13]=_.y,st[14]=_.z,st[15]=1,this}decompose(_,tt,ot){const st=this.elements;let at=_v1$5.set(st[0],st[1],st[2]).length();const lt=_v1$5.set(st[4],st[5],st[6]).length(),dt=_v1$5.set(st[8],st[9],st[10]).length();this.determinant()<0&&(at=-at),_.x=st[12],_.y=st[13],_.z=st[14],_m1$2.copy(this);const ft=1/at,gt=1/lt,Et=1/dt;return _m1$2.elements[0]*=ft,_m1$2.elements[1]*=ft,_m1$2.elements[2]*=ft,_m1$2.elements[4]*=gt,_m1$2.elements[5]*=gt,_m1$2.elements[6]*=gt,_m1$2.elements[8]*=Et,_m1$2.elements[9]*=Et,_m1$2.elements[10]*=Et,tt.setFromRotationMatrix(_m1$2),ot.x=at,ot.y=lt,ot.z=dt,this}makePerspective(_,tt,ot,st,at,lt,dt=WebGLCoordinateSystem){const ht=this.elements,ft=2*at/(tt-_),gt=2*at/(ot-st),Et=(tt+_)/(tt-_),yt=(ot+st)/(ot-st);let Ct,wt;if(dt===WebGLCoordinateSystem)Ct=-(lt+at)/(lt-at),wt=-2*lt*at/(lt-at);else if(dt===WebGPUCoordinateSystem)Ct=-lt/(lt-at),wt=-lt*at/(lt-at);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+dt);return ht[0]=ft,ht[4]=0,ht[8]=Et,ht[12]=0,ht[1]=0,ht[5]=gt,ht[9]=yt,ht[13]=0,ht[2]=0,ht[6]=0,ht[10]=Ct,ht[14]=wt,ht[3]=0,ht[7]=0,ht[11]=-1,ht[15]=0,this}makeOrthographic(_,tt,ot,st,at,lt,dt=WebGLCoordinateSystem){const ht=this.elements,ft=1/(tt-_),gt=1/(ot-st),Et=1/(lt-at),yt=(tt+_)*ft,Ct=(ot+st)*gt;let wt,It;if(dt===WebGLCoordinateSystem)wt=(lt+at)*Et,It=-2*Et;else if(dt===WebGPUCoordinateSystem)wt=at*Et,It=-1*Et;else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+dt);return ht[0]=2*ft,ht[4]=0,ht[8]=0,ht[12]=-yt,ht[1]=0,ht[5]=2*gt,ht[9]=0,ht[13]=-Ct,ht[2]=0,ht[6]=0,ht[10]=It,ht[14]=-wt,ht[3]=0,ht[7]=0,ht[11]=0,ht[15]=1,this}equals(_){const tt=this.elements,ot=_.elements;for(let st=0;st<16;st++)if(tt[st]!==ot[st])return!1;return!0}fromArray(_,tt=0){for(let ot=0;ot<16;ot++)this.elements[ot]=_[ot+tt];return this}toArray(_=[],tt=0){const ot=this.elements;return _[tt]=ot[0],_[tt+1]=ot[1],_[tt+2]=ot[2],_[tt+3]=ot[3],_[tt+4]=ot[4],_[tt+5]=ot[5],_[tt+6]=ot[6],_[tt+7]=ot[7],_[tt+8]=ot[8],_[tt+9]=ot[9],_[tt+10]=ot[10],_[tt+11]=ot[11],_[tt+12]=ot[12],_[tt+13]=ot[13],_[tt+14]=ot[14],_[tt+15]=ot[15],_}}const _v1$5=new Vector3,_m1$2=new Matrix4,_zero=new Vector3(0,0,0),_one=new Vector3(1,1,1),_x=new Vector3,_y=new Vector3,_z=new Vector3,_matrix=new Matrix4,_quaternion$3=new Quaternion;class Euler{constructor(_=0,tt=0,ot=0,st=Euler.DEFAULT_ORDER){this.isEuler=!0,this._x=_,this._y=tt,this._z=ot,this._order=st}get x(){return this._x}set x(_){this._x=_,this._onChangeCallback()}get y(){return this._y}set y(_){this._y=_,this._onChangeCallback()}get z(){return this._z}set z(_){this._z=_,this._onChangeCallback()}get order(){return this._order}set order(_){this._order=_,this._onChangeCallback()}set(_,tt,ot,st=this._order){return this._x=_,this._y=tt,this._z=ot,this._order=st,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(_){return this._x=_._x,this._y=_._y,this._z=_._z,this._order=_._order,this._onChangeCallback(),this}setFromRotationMatrix(_,tt=this._order,ot=!0){const st=_.elements,at=st[0],lt=st[4],dt=st[8],ht=st[1],ft=st[5],gt=st[9],Et=st[2],yt=st[6],Ct=st[10];switch(tt){case"XYZ":this._y=Math.asin(clamp$3(dt,-1,1)),Math.abs(dt)<.9999999?(this._x=Math.atan2(-gt,Ct),this._z=Math.atan2(-lt,at)):(this._x=Math.atan2(yt,ft),this._z=0);break;case"YXZ":this._x=Math.asin(-clamp$3(gt,-1,1)),Math.abs(gt)<.9999999?(this._y=Math.atan2(dt,Ct),this._z=Math.atan2(ht,ft)):(this._y=Math.atan2(-Et,at),this._z=0);break;case"ZXY":this._x=Math.asin(clamp$3(yt,-1,1)),Math.abs(yt)<.9999999?(this._y=Math.atan2(-Et,Ct),this._z=Math.atan2(-lt,ft)):(this._y=0,this._z=Math.atan2(ht,at));break;case"ZYX":this._y=Math.asin(-clamp$3(Et,-1,1)),Math.abs(Et)<.9999999?(this._x=Math.atan2(yt,Ct),this._z=Math.atan2(ht,at)):(this._x=0,this._z=Math.atan2(-lt,ft));break;case"YZX":this._z=Math.asin(clamp$3(ht,-1,1)),Math.abs(ht)<.9999999?(this._x=Math.atan2(-gt,ft),this._y=Math.atan2(-Et,at)):(this._x=0,this._y=Math.atan2(dt,Ct));break;case"XZY":this._z=Math.asin(-clamp$3(lt,-1,1)),Math.abs(lt)<.9999999?(this._x=Math.atan2(yt,ft),this._y=Math.atan2(dt,at)):(this._x=Math.atan2(-gt,Ct),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+tt)}return this._order=tt,ot===!0&&this._onChangeCallback(),this}setFromQuaternion(_,tt,ot){return _matrix.makeRotationFromQuaternion(_),this.setFromRotationMatrix(_matrix,tt,ot)}setFromVector3(_,tt=this._order){return this.set(_.x,_.y,_.z,tt)}reorder(_){return _quaternion$3.setFromEuler(this),this.setFromQuaternion(_quaternion$3,_)}equals(_){return _._x===this._x&&_._y===this._y&&_._z===this._z&&_._order===this._order}fromArray(_){return this._x=_[0],this._y=_[1],this._z=_[2],_[3]!==void 0&&(this._order=_[3]),this._onChangeCallback(),this}toArray(_=[],tt=0){return _[tt]=this._x,_[tt+1]=this._y,_[tt+2]=this._z,_[tt+3]=this._order,_}_onChange(_){return this._onChangeCallback=_,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}Euler.DEFAULT_ORDER="XYZ";class Layers{constructor(){this.mask=1}set(_){this.mask=(1<<_|0)>>>0}enable(_){this.mask|=1<<_|0}enableAll(){this.mask=-1}toggle(_){this.mask^=1<<_|0}disable(_){this.mask&=~(1<<_|0)}disableAll(){this.mask=0}test(_){return(this.mask&_.mask)!==0}isEnabled(_){return(this.mask&(1<<_|0))!==0}}let _object3DId=0;const _v1$4=new Vector3,_q1=new Quaternion,_m1$1=new Matrix4,_target=new Vector3,_position$3=new Vector3,_scale$2=new Vector3,_quaternion$2=new Quaternion,_xAxis=new Vector3(1,0,0),_yAxis=new Vector3(0,1,0),_zAxis=new Vector3(0,0,1),_addedEvent={type:"added"},_removedEvent={type:"removed"};class Object3D extends EventDispatcher$1{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:_object3DId++}),this.uuid=generateUUID$1(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Object3D.DEFAULT_UP.clone();const _=new Vector3,tt=new Euler,ot=new Quaternion,st=new Vector3(1,1,1);function at(){ot.setFromEuler(tt,!1)}function lt(){tt.setFromQuaternion(ot,void 0,!1)}tt._onChange(at),ot._onChange(lt),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:_},rotation:{configurable:!0,enumerable:!0,value:tt},quaternion:{configurable:!0,enumerable:!0,value:ot},scale:{configurable:!0,enumerable:!0,value:st},modelViewMatrix:{value:new Matrix4},normalMatrix:{value:new Matrix3}}),this.matrix=new Matrix4,this.matrixWorld=new Matrix4,this.matrixAutoUpdate=Object3D.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.matrixWorldAutoUpdate=Object3D.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.layers=new Layers,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(_){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(_),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(_){return this.quaternion.premultiply(_),this}setRotationFromAxisAngle(_,tt){this.quaternion.setFromAxisAngle(_,tt)}setRotationFromEuler(_){this.quaternion.setFromEuler(_,!0)}setRotationFromMatrix(_){this.quaternion.setFromRotationMatrix(_)}setRotationFromQuaternion(_){this.quaternion.copy(_)}rotateOnAxis(_,tt){return _q1.setFromAxisAngle(_,tt),this.quaternion.multiply(_q1),this}rotateOnWorldAxis(_,tt){return _q1.setFromAxisAngle(_,tt),this.quaternion.premultiply(_q1),this}rotateX(_){return this.rotateOnAxis(_xAxis,_)}rotateY(_){return this.rotateOnAxis(_yAxis,_)}rotateZ(_){return this.rotateOnAxis(_zAxis,_)}translateOnAxis(_,tt){return _v1$4.copy(_).applyQuaternion(this.quaternion),this.position.add(_v1$4.multiplyScalar(tt)),this}translateX(_){return this.translateOnAxis(_xAxis,_)}translateY(_){return this.translateOnAxis(_yAxis,_)}translateZ(_){return this.translateOnAxis(_zAxis,_)}localToWorld(_){return this.updateWorldMatrix(!0,!1),_.applyMatrix4(this.matrixWorld)}worldToLocal(_){return this.updateWorldMatrix(!0,!1),_.applyMatrix4(_m1$1.copy(this.matrixWorld).invert())}lookAt(_,tt,ot){_.isVector3?_target.copy(_):_target.set(_,tt,ot);const st=this.parent;this.updateWorldMatrix(!0,!1),_position$3.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?_m1$1.lookAt(_position$3,_target,this.up):_m1$1.lookAt(_target,_position$3,this.up),this.quaternion.setFromRotationMatrix(_m1$1),st&&(_m1$1.extractRotation(st.matrixWorld),_q1.setFromRotationMatrix(_m1$1),this.quaternion.premultiply(_q1.invert()))}add(_){if(arguments.length>1){for(let tt=0;tt<arguments.length;tt++)this.add(arguments[tt]);return this}return _===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",_),this):(_&&_.isObject3D?(_.parent!==null&&_.parent.remove(_),_.parent=this,this.children.push(_),_.dispatchEvent(_addedEvent)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",_),this)}remove(_){if(arguments.length>1){for(let ot=0;ot<arguments.length;ot++)this.remove(arguments[ot]);return this}const tt=this.children.indexOf(_);return tt!==-1&&(_.parent=null,this.children.splice(tt,1),_.dispatchEvent(_removedEvent)),this}removeFromParent(){const _=this.parent;return _!==null&&_.remove(this),this}clear(){for(let _=0;_<this.children.length;_++){const tt=this.children[_];tt.parent=null,tt.dispatchEvent(_removedEvent)}return this.children.length=0,this}attach(_){return this.updateWorldMatrix(!0,!1),_m1$1.copy(this.matrixWorld).invert(),_.parent!==null&&(_.parent.updateWorldMatrix(!0,!1),_m1$1.multiply(_.parent.matrixWorld)),_.applyMatrix4(_m1$1),this.add(_),_.updateWorldMatrix(!1,!0),this}getObjectById(_){return this.getObjectByProperty("id",_)}getObjectByName(_){return this.getObjectByProperty("name",_)}getObjectByProperty(_,tt){if(this[_]===tt)return this;for(let ot=0,st=this.children.length;ot<st;ot++){const lt=this.children[ot].getObjectByProperty(_,tt);if(lt!==void 0)return lt}}getObjectsByProperty(_,tt){let ot=[];this[_]===tt&&ot.push(this);for(let st=0,at=this.children.length;st<at;st++){const lt=this.children[st].getObjectsByProperty(_,tt);lt.length>0&&(ot=ot.concat(lt))}return ot}getWorldPosition(_){return this.updateWorldMatrix(!0,!1),_.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(_){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(_position$3,_,_scale$2),_}getWorldScale(_){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(_position$3,_quaternion$2,_),_}getWorldDirection(_){this.updateWorldMatrix(!0,!1);const tt=this.matrixWorld.elements;return _.set(tt[8],tt[9],tt[10]).normalize()}raycast(){}traverse(_){_(this);const tt=this.children;for(let ot=0,st=tt.length;ot<st;ot++)tt[ot].traverse(_)}traverseVisible(_){if(this.visible===!1)return;_(this);const tt=this.children;for(let ot=0,st=tt.length;ot<st;ot++)tt[ot].traverseVisible(_)}traverseAncestors(_){const tt=this.parent;tt!==null&&(_(tt),tt.traverseAncestors(_))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(_){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||_)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,_=!0);const tt=this.children;for(let ot=0,st=tt.length;ot<st;ot++){const at=tt[ot];(at.matrixWorldAutoUpdate===!0||_===!0)&&at.updateMatrixWorld(_)}}updateWorldMatrix(_,tt){const ot=this.parent;if(_===!0&&ot!==null&&ot.matrixWorldAutoUpdate===!0&&ot.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),tt===!0){const st=this.children;for(let at=0,lt=st.length;at<lt;at++){const dt=st[at];dt.matrixWorldAutoUpdate===!0&&dt.updateWorldMatrix(!1,!0)}}}toJSON(_){const tt=_===void 0||typeof _=="string",ot={};tt&&(_={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},ot.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const st={};st.uuid=this.uuid,st.type=this.type,this.name!==""&&(st.name=this.name),this.castShadow===!0&&(st.castShadow=!0),this.receiveShadow===!0&&(st.receiveShadow=!0),this.visible===!1&&(st.visible=!1),this.frustumCulled===!1&&(st.frustumCulled=!1),this.renderOrder!==0&&(st.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(st.userData=this.userData),st.layers=this.layers.mask,st.matrix=this.matrix.toArray(),st.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(st.matrixAutoUpdate=!1),this.isInstancedMesh&&(st.type="InstancedMesh",st.count=this.count,st.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(st.instanceColor=this.instanceColor.toJSON()));function at(dt,ht){return dt[ht.uuid]===void 0&&(dt[ht.uuid]=ht.toJSON(_)),ht.uuid}if(this.isScene)this.background&&(this.background.isColor?st.background=this.background.toJSON():this.background.isTexture&&(st.background=this.background.toJSON(_).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(st.environment=this.environment.toJSON(_).uuid);else if(this.isMesh||this.isLine||this.isPoints){st.geometry=at(_.geometries,this.geometry);const dt=this.geometry.parameters;if(dt!==void 0&&dt.shapes!==void 0){const ht=dt.shapes;if(Array.isArray(ht))for(let ft=0,gt=ht.length;ft<gt;ft++){const Et=ht[ft];at(_.shapes,Et)}else at(_.shapes,ht)}}if(this.isSkinnedMesh&&(st.bindMode=this.bindMode,st.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(at(_.skeletons,this.skeleton),st.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const dt=[];for(let ht=0,ft=this.material.length;ht<ft;ht++)dt.push(at(_.materials,this.material[ht]));st.material=dt}else st.material=at(_.materials,this.material);if(this.children.length>0){st.children=[];for(let dt=0;dt<this.children.length;dt++)st.children.push(this.children[dt].toJSON(_).object)}if(this.animations.length>0){st.animations=[];for(let dt=0;dt<this.animations.length;dt++){const ht=this.animations[dt];st.animations.push(at(_.animations,ht))}}if(tt){const dt=lt(_.geometries),ht=lt(_.materials),ft=lt(_.textures),gt=lt(_.images),Et=lt(_.shapes),yt=lt(_.skeletons),Ct=lt(_.animations),wt=lt(_.nodes);dt.length>0&&(ot.geometries=dt),ht.length>0&&(ot.materials=ht),ft.length>0&&(ot.textures=ft),gt.length>0&&(ot.images=gt),Et.length>0&&(ot.shapes=Et),yt.length>0&&(ot.skeletons=yt),Ct.length>0&&(ot.animations=Ct),wt.length>0&&(ot.nodes=wt)}return ot.object=st,ot;function lt(dt){const ht=[];for(const ft in dt){const gt=dt[ft];delete gt.metadata,ht.push(gt)}return ht}}clone(_){return new this.constructor().copy(this,_)}copy(_,tt=!0){if(this.name=_.name,this.up.copy(_.up),this.position.copy(_.position),this.rotation.order=_.rotation.order,this.quaternion.copy(_.quaternion),this.scale.copy(_.scale),this.matrix.copy(_.matrix),this.matrixWorld.copy(_.matrixWorld),this.matrixAutoUpdate=_.matrixAutoUpdate,this.matrixWorldNeedsUpdate=_.matrixWorldNeedsUpdate,this.matrixWorldAutoUpdate=_.matrixWorldAutoUpdate,this.layers.mask=_.layers.mask,this.visible=_.visible,this.castShadow=_.castShadow,this.receiveShadow=_.receiveShadow,this.frustumCulled=_.frustumCulled,this.renderOrder=_.renderOrder,this.animations=_.animations,this.userData=JSON.parse(JSON.stringify(_.userData)),tt===!0)for(let ot=0;ot<_.children.length;ot++){const st=_.children[ot];this.add(st.clone())}return this}}Object3D.DEFAULT_UP=new Vector3(0,1,0);Object3D.DEFAULT_MATRIX_AUTO_UPDATE=!0;Object3D.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const _v0$1=new Vector3,_v1$3=new Vector3,_v2$2=new Vector3,_v3$1=new Vector3,_vab=new Vector3,_vac=new Vector3,_vbc=new Vector3,_vap=new Vector3,_vbp=new Vector3,_vcp=new Vector3;let warnedGetUV=!1;class Triangle{constructor(_=new Vector3,tt=new Vector3,ot=new Vector3){this.a=_,this.b=tt,this.c=ot}static getNormal(_,tt,ot,st){st.subVectors(ot,tt),_v0$1.subVectors(_,tt),st.cross(_v0$1);const at=st.lengthSq();return at>0?st.multiplyScalar(1/Math.sqrt(at)):st.set(0,0,0)}static getBarycoord(_,tt,ot,st,at){_v0$1.subVectors(st,tt),_v1$3.subVectors(ot,tt),_v2$2.subVectors(_,tt);const lt=_v0$1.dot(_v0$1),dt=_v0$1.dot(_v1$3),ht=_v0$1.dot(_v2$2),ft=_v1$3.dot(_v1$3),gt=_v1$3.dot(_v2$2),Et=lt*ft-dt*dt;if(Et===0)return at.set(-2,-1,-1);const yt=1/Et,Ct=(ft*ht-dt*gt)*yt,wt=(lt*gt-dt*ht)*yt;return at.set(1-Ct-wt,wt,Ct)}static containsPoint(_,tt,ot,st){return this.getBarycoord(_,tt,ot,st,_v3$1),_v3$1.x>=0&&_v3$1.y>=0&&_v3$1.x+_v3$1.y<=1}static getUV(_,tt,ot,st,at,lt,dt,ht){return warnedGetUV===!1&&(console.warn("THREE.Triangle.getUV() has been renamed to THREE.Triangle.getInterpolation()."),warnedGetUV=!0),this.getInterpolation(_,tt,ot,st,at,lt,dt,ht)}static getInterpolation(_,tt,ot,st,at,lt,dt,ht){return this.getBarycoord(_,tt,ot,st,_v3$1),ht.setScalar(0),ht.addScaledVector(at,_v3$1.x),ht.addScaledVector(lt,_v3$1.y),ht.addScaledVector(dt,_v3$1.z),ht}static isFrontFacing(_,tt,ot,st){return _v0$1.subVectors(ot,tt),_v1$3.subVectors(_,tt),_v0$1.cross(_v1$3).dot(st)<0}set(_,tt,ot){return this.a.copy(_),this.b.copy(tt),this.c.copy(ot),this}setFromPointsAndIndices(_,tt,ot,st){return this.a.copy(_[tt]),this.b.copy(_[ot]),this.c.copy(_[st]),this}setFromAttributeAndIndices(_,tt,ot,st){return this.a.fromBufferAttribute(_,tt),this.b.fromBufferAttribute(_,ot),this.c.fromBufferAttribute(_,st),this}clone(){return new this.constructor().copy(this)}copy(_){return this.a.copy(_.a),this.b.copy(_.b),this.c.copy(_.c),this}getArea(){return _v0$1.subVectors(this.c,this.b),_v1$3.subVectors(this.a,this.b),_v0$1.cross(_v1$3).length()*.5}getMidpoint(_){return _.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(_){return Triangle.getNormal(this.a,this.b,this.c,_)}getPlane(_){return _.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(_,tt){return Triangle.getBarycoord(_,this.a,this.b,this.c,tt)}getUV(_,tt,ot,st,at){return warnedGetUV===!1&&(console.warn("THREE.Triangle.getUV() has been renamed to THREE.Triangle.getInterpolation()."),warnedGetUV=!0),Triangle.getInterpolation(_,this.a,this.b,this.c,tt,ot,st,at)}getInterpolation(_,tt,ot,st,at){return Triangle.getInterpolation(_,this.a,this.b,this.c,tt,ot,st,at)}containsPoint(_){return Triangle.containsPoint(_,this.a,this.b,this.c)}isFrontFacing(_){return Triangle.isFrontFacing(this.a,this.b,this.c,_)}intersectsBox(_){return _.intersectsTriangle(this)}closestPointToPoint(_,tt){const ot=this.a,st=this.b,at=this.c;let lt,dt;_vab.subVectors(st,ot),_vac.subVectors(at,ot),_vap.subVectors(_,ot);const ht=_vab.dot(_vap),ft=_vac.dot(_vap);if(ht<=0&&ft<=0)return tt.copy(ot);_vbp.subVectors(_,st);const gt=_vab.dot(_vbp),Et=_vac.dot(_vbp);if(gt>=0&&Et<=gt)return tt.copy(st);const yt=ht*Et-gt*ft;if(yt<=0&&ht>=0&&gt<=0)return lt=ht/(ht-gt),tt.copy(ot).addScaledVector(_vab,lt);_vcp.subVectors(_,at);const Ct=_vab.dot(_vcp),wt=_vac.dot(_vcp);if(wt>=0&&Ct<=wt)return tt.copy(at);const It=Ct*ft-ht*wt;if(It<=0&&ft>=0&&wt<=0)return dt=ft/(ft-wt),tt.copy(ot).addScaledVector(_vac,dt);const Pt=gt*wt-Ct*Et;if(Pt<=0&&Et-gt>=0&&Ct-wt>=0)return _vbc.subVectors(at,st),dt=(Et-gt)/(Et-gt+(Ct-wt)),tt.copy(st).addScaledVector(_vbc,dt);const Rt=1/(Pt+It+yt);return lt=It*Rt,dt=yt*Rt,tt.copy(ot).addScaledVector(_vab,lt).addScaledVector(_vac,dt)}equals(_){return _.a.equals(this.a)&&_.b.equals(this.b)&&_.c.equals(this.c)}}let materialId=0;class Material extends EventDispatcher$1{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:materialId++}),this.uuid=generateUUID$1(),this.name="",this.type="Material",this.blending=NormalBlending,this.side=FrontSide,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=SrcAlphaFactor,this.blendDst=OneMinusSrcAlphaFactor,this.blendEquation=AddEquation,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=LessEqualDepth,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=AlwaysStencilFunc,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=KeepStencilOp,this.stencilZFail=KeepStencilOp,this.stencilZPass=KeepStencilOp,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(_){this._alphaTest>0!=_>0&&this.version++,this._alphaTest=_}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(_){if(_!==void 0)for(const tt in _){const ot=_[tt];if(ot===void 0){console.warn(`THREE.Material: parameter '${tt}' has value of undefined.`);continue}const st=this[tt];if(st===void 0){console.warn(`THREE.Material: '${tt}' is not a property of THREE.${this.type}.`);continue}st&&st.isColor?st.set(ot):st&&st.isVector3&&ot&&ot.isVector3?st.copy(ot):this[tt]=ot}}toJSON(_){const tt=_===void 0||typeof _=="string";tt&&(_={textures:{},images:{}});const ot={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};ot.uuid=this.uuid,ot.type=this.type,this.name!==""&&(ot.name=this.name),this.color&&this.color.isColor&&(ot.color=this.color.getHex()),this.roughness!==void 0&&(ot.roughness=this.roughness),this.metalness!==void 0&&(ot.metalness=this.metalness),this.sheen!==void 0&&(ot.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(ot.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(ot.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(ot.emissive=this.emissive.getHex()),this.emissiveIntensity&&this.emissiveIntensity!==1&&(ot.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(ot.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(ot.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(ot.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(ot.shininess=this.shininess),this.clearcoat!==void 0&&(ot.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(ot.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(ot.clearcoatMap=this.clearcoatMap.toJSON(_).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(ot.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(_).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(ot.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(_).uuid,ot.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.iridescence!==void 0&&(ot.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(ot.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(ot.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(ot.iridescenceMap=this.iridescenceMap.toJSON(_).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(ot.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(_).uuid),this.anisotropy!==void 0&&(ot.anisotropy=this.anisotropy),this.anisotropyRotation!==void 0&&(ot.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(ot.anisotropyMap=this.anisotropyMap.toJSON(_).uuid),this.map&&this.map.isTexture&&(ot.map=this.map.toJSON(_).uuid),this.matcap&&this.matcap.isTexture&&(ot.matcap=this.matcap.toJSON(_).uuid),this.alphaMap&&this.alphaMap.isTexture&&(ot.alphaMap=this.alphaMap.toJSON(_).uuid),this.lightMap&&this.lightMap.isTexture&&(ot.lightMap=this.lightMap.toJSON(_).uuid,ot.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(ot.aoMap=this.aoMap.toJSON(_).uuid,ot.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(ot.bumpMap=this.bumpMap.toJSON(_).uuid,ot.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(ot.normalMap=this.normalMap.toJSON(_).uuid,ot.normalMapType=this.normalMapType,ot.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(ot.displacementMap=this.displacementMap.toJSON(_).uuid,ot.displacementScale=this.displacementScale,ot.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(ot.roughnessMap=this.roughnessMap.toJSON(_).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(ot.metalnessMap=this.metalnessMap.toJSON(_).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(ot.emissiveMap=this.emissiveMap.toJSON(_).uuid),this.specularMap&&this.specularMap.isTexture&&(ot.specularMap=this.specularMap.toJSON(_).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(ot.specularIntensityMap=this.specularIntensityMap.toJSON(_).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(ot.specularColorMap=this.specularColorMap.toJSON(_).uuid),this.envMap&&this.envMap.isTexture&&(ot.envMap=this.envMap.toJSON(_).uuid,this.combine!==void 0&&(ot.combine=this.combine)),this.envMapIntensity!==void 0&&(ot.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(ot.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(ot.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(ot.gradientMap=this.gradientMap.toJSON(_).uuid),this.transmission!==void 0&&(ot.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(ot.transmissionMap=this.transmissionMap.toJSON(_).uuid),this.thickness!==void 0&&(ot.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(ot.thicknessMap=this.thicknessMap.toJSON(_).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(ot.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(ot.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(ot.size=this.size),this.shadowSide!==null&&(ot.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(ot.sizeAttenuation=this.sizeAttenuation),this.blending!==NormalBlending&&(ot.blending=this.blending),this.side!==FrontSide&&(ot.side=this.side),this.vertexColors&&(ot.vertexColors=!0),this.opacity<1&&(ot.opacity=this.opacity),this.transparent===!0&&(ot.transparent=this.transparent),ot.depthFunc=this.depthFunc,ot.depthTest=this.depthTest,ot.depthWrite=this.depthWrite,ot.colorWrite=this.colorWrite,ot.stencilWrite=this.stencilWrite,ot.stencilWriteMask=this.stencilWriteMask,ot.stencilFunc=this.stencilFunc,ot.stencilRef=this.stencilRef,ot.stencilFuncMask=this.stencilFuncMask,ot.stencilFail=this.stencilFail,ot.stencilZFail=this.stencilZFail,ot.stencilZPass=this.stencilZPass,this.rotation!==void 0&&this.rotation!==0&&(ot.rotation=this.rotation),this.polygonOffset===!0&&(ot.polygonOffset=!0),this.polygonOffsetFactor!==0&&(ot.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(ot.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(ot.linewidth=this.linewidth),this.dashSize!==void 0&&(ot.dashSize=this.dashSize),this.gapSize!==void 0&&(ot.gapSize=this.gapSize),this.scale!==void 0&&(ot.scale=this.scale),this.dithering===!0&&(ot.dithering=!0),this.alphaTest>0&&(ot.alphaTest=this.alphaTest),this.alphaToCoverage===!0&&(ot.alphaToCoverage=this.alphaToCoverage),this.premultipliedAlpha===!0&&(ot.premultipliedAlpha=this.premultipliedAlpha),this.forceSinglePass===!0&&(ot.forceSinglePass=this.forceSinglePass),this.wireframe===!0&&(ot.wireframe=this.wireframe),this.wireframeLinewidth>1&&(ot.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(ot.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(ot.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(ot.flatShading=this.flatShading),this.visible===!1&&(ot.visible=!1),this.toneMapped===!1&&(ot.toneMapped=!1),this.fog===!1&&(ot.fog=!1),Object.keys(this.userData).length>0&&(ot.userData=this.userData);function st(at){const lt=[];for(const dt in at){const ht=at[dt];delete ht.metadata,lt.push(ht)}return lt}if(tt){const at=st(_.textures),lt=st(_.images);at.length>0&&(ot.textures=at),lt.length>0&&(ot.images=lt)}return ot}clone(){return new this.constructor().copy(this)}copy(_){this.name=_.name,this.blending=_.blending,this.side=_.side,this.vertexColors=_.vertexColors,this.opacity=_.opacity,this.transparent=_.transparent,this.blendSrc=_.blendSrc,this.blendDst=_.blendDst,this.blendEquation=_.blendEquation,this.blendSrcAlpha=_.blendSrcAlpha,this.blendDstAlpha=_.blendDstAlpha,this.blendEquationAlpha=_.blendEquationAlpha,this.depthFunc=_.depthFunc,this.depthTest=_.depthTest,this.depthWrite=_.depthWrite,this.stencilWriteMask=_.stencilWriteMask,this.stencilFunc=_.stencilFunc,this.stencilRef=_.stencilRef,this.stencilFuncMask=_.stencilFuncMask,this.stencilFail=_.stencilFail,this.stencilZFail=_.stencilZFail,this.stencilZPass=_.stencilZPass,this.stencilWrite=_.stencilWrite;const tt=_.clippingPlanes;let ot=null;if(tt!==null){const st=tt.length;ot=new Array(st);for(let at=0;at!==st;++at)ot[at]=tt[at].clone()}return this.clippingPlanes=ot,this.clipIntersection=_.clipIntersection,this.clipShadows=_.clipShadows,this.shadowSide=_.shadowSide,this.colorWrite=_.colorWrite,this.precision=_.precision,this.polygonOffset=_.polygonOffset,this.polygonOffsetFactor=_.polygonOffsetFactor,this.polygonOffsetUnits=_.polygonOffsetUnits,this.dithering=_.dithering,this.alphaTest=_.alphaTest,this.alphaToCoverage=_.alphaToCoverage,this.premultipliedAlpha=_.premultipliedAlpha,this.forceSinglePass=_.forceSinglePass,this.visible=_.visible,this.toneMapped=_.toneMapped,this.userData=JSON.parse(JSON.stringify(_.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(_){_===!0&&this.version++}}const _colorKeywords={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},_hslA={h:0,s:0,l:0},_hslB={h:0,s:0,l:0};function hue2rgb(nt,_,tt){return tt<0&&(tt+=1),tt>1&&(tt-=1),tt<1/6?nt+(_-nt)*6*tt:tt<1/2?_:tt<2/3?nt+(_-nt)*6*(2/3-tt):nt}let Color$1=class{constructor(_,tt,ot){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(_,tt,ot)}set(_,tt,ot){if(tt===void 0&&ot===void 0){const st=_;st&&st.isColor?this.copy(st):typeof st=="number"?this.setHex(st):typeof st=="string"&&this.setStyle(st)}else this.setRGB(_,tt,ot);return this}setScalar(_){return this.r=_,this.g=_,this.b=_,this}setHex(_,tt=SRGBColorSpace$1){return _=Math.floor(_),this.r=(_>>16&255)/255,this.g=(_>>8&255)/255,this.b=(_&255)/255,ColorManagement.toWorkingColorSpace(this,tt),this}setRGB(_,tt,ot,st=ColorManagement.workingColorSpace){return this.r=_,this.g=tt,this.b=ot,ColorManagement.toWorkingColorSpace(this,st),this}setHSL(_,tt,ot,st=ColorManagement.workingColorSpace){if(_=euclideanModulo(_,1),tt=clamp$3(tt,0,1),ot=clamp$3(ot,0,1),tt===0)this.r=this.g=this.b=ot;else{const at=ot<=.5?ot*(1+tt):ot+tt-ot*tt,lt=2*ot-at;this.r=hue2rgb(lt,at,_+1/3),this.g=hue2rgb(lt,at,_),this.b=hue2rgb(lt,at,_-1/3)}return ColorManagement.toWorkingColorSpace(this,st),this}setStyle(_,tt=SRGBColorSpace$1){function ot(at){at!==void 0&&parseFloat(at)<1&&console.warn("THREE.Color: Alpha component of "+_+" will be ignored.")}let st;if(st=/^(\w+)\(([^\)]*)\)/.exec(_)){let at;const lt=st[1],dt=st[2];switch(lt){case"rgb":case"rgba":if(at=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(dt))return ot(at[4]),this.setRGB(Math.min(255,parseInt(at[1],10))/255,Math.min(255,parseInt(at[2],10))/255,Math.min(255,parseInt(at[3],10))/255,tt);if(at=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(dt))return ot(at[4]),this.setRGB(Math.min(100,parseInt(at[1],10))/100,Math.min(100,parseInt(at[2],10))/100,Math.min(100,parseInt(at[3],10))/100,tt);break;case"hsl":case"hsla":if(at=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(dt))return ot(at[4]),this.setHSL(parseFloat(at[1])/360,parseFloat(at[2])/100,parseFloat(at[3])/100,tt);break;default:console.warn("THREE.Color: Unknown color model "+_)}}else if(st=/^\#([A-Fa-f\d]+)$/.exec(_)){const at=st[1],lt=at.length;if(lt===3)return this.setRGB(parseInt(at.charAt(0),16)/15,parseInt(at.charAt(1),16)/15,parseInt(at.charAt(2),16)/15,tt);if(lt===6)return this.setHex(parseInt(at,16),tt);console.warn("THREE.Color: Invalid hex color "+_)}else if(_&&_.length>0)return this.setColorName(_,tt);return this}setColorName(_,tt=SRGBColorSpace$1){const ot=_colorKeywords[_.toLowerCase()];return ot!==void 0?this.setHex(ot,tt):console.warn("THREE.Color: Unknown color "+_),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(_){return this.r=_.r,this.g=_.g,this.b=_.b,this}copySRGBToLinear(_){return this.r=SRGBToLinear(_.r),this.g=SRGBToLinear(_.g),this.b=SRGBToLinear(_.b),this}copyLinearToSRGB(_){return this.r=LinearToSRGB(_.r),this.g=LinearToSRGB(_.g),this.b=LinearToSRGB(_.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(_=SRGBColorSpace$1){return ColorManagement.fromWorkingColorSpace(_color.copy(this),_),Math.round(clamp$3(_color.r*255,0,255))*65536+Math.round(clamp$3(_color.g*255,0,255))*256+Math.round(clamp$3(_color.b*255,0,255))}getHexString(_=SRGBColorSpace$1){return("000000"+this.getHex(_).toString(16)).slice(-6)}getHSL(_,tt=ColorManagement.workingColorSpace){ColorManagement.fromWorkingColorSpace(_color.copy(this),tt);const ot=_color.r,st=_color.g,at=_color.b,lt=Math.max(ot,st,at),dt=Math.min(ot,st,at);let ht,ft;const gt=(dt+lt)/2;if(dt===lt)ht=0,ft=0;else{const Et=lt-dt;switch(ft=gt<=.5?Et/(lt+dt):Et/(2-lt-dt),lt){case ot:ht=(st-at)/Et+(st<at?6:0);break;case st:ht=(at-ot)/Et+2;break;case at:ht=(ot-st)/Et+4;break}ht/=6}return _.h=ht,_.s=ft,_.l=gt,_}getRGB(_,tt=ColorManagement.workingColorSpace){return ColorManagement.fromWorkingColorSpace(_color.copy(this),tt),_.r=_color.r,_.g=_color.g,_.b=_color.b,_}getStyle(_=SRGBColorSpace$1){ColorManagement.fromWorkingColorSpace(_color.copy(this),_);const tt=_color.r,ot=_color.g,st=_color.b;return _!==SRGBColorSpace$1?`color(${_} ${tt.toFixed(3)} ${ot.toFixed(3)} ${st.toFixed(3)})`:`rgb(${Math.round(tt*255)},${Math.round(ot*255)},${Math.round(st*255)})`}offsetHSL(_,tt,ot){return this.getHSL(_hslA),_hslA.h+=_,_hslA.s+=tt,_hslA.l+=ot,this.setHSL(_hslA.h,_hslA.s,_hslA.l),this}add(_){return this.r+=_.r,this.g+=_.g,this.b+=_.b,this}addColors(_,tt){return this.r=_.r+tt.r,this.g=_.g+tt.g,this.b=_.b+tt.b,this}addScalar(_){return this.r+=_,this.g+=_,this.b+=_,this}sub(_){return this.r=Math.max(0,this.r-_.r),this.g=Math.max(0,this.g-_.g),this.b=Math.max(0,this.b-_.b),this}multiply(_){return this.r*=_.r,this.g*=_.g,this.b*=_.b,this}multiplyScalar(_){return this.r*=_,this.g*=_,this.b*=_,this}lerp(_,tt){return this.r+=(_.r-this.r)*tt,this.g+=(_.g-this.g)*tt,this.b+=(_.b-this.b)*tt,this}lerpColors(_,tt,ot){return this.r=_.r+(tt.r-_.r)*ot,this.g=_.g+(tt.g-_.g)*ot,this.b=_.b+(tt.b-_.b)*ot,this}lerpHSL(_,tt){this.getHSL(_hslA),_.getHSL(_hslB);const ot=lerp(_hslA.h,_hslB.h,tt),st=lerp(_hslA.s,_hslB.s,tt),at=lerp(_hslA.l,_hslB.l,tt);return this.setHSL(ot,st,at),this}setFromVector3(_){return this.r=_.x,this.g=_.y,this.b=_.z,this}applyMatrix3(_){const tt=this.r,ot=this.g,st=this.b,at=_.elements;return this.r=at[0]*tt+at[3]*ot+at[6]*st,this.g=at[1]*tt+at[4]*ot+at[7]*st,this.b=at[2]*tt+at[5]*ot+at[8]*st,this}equals(_){return _.r===this.r&&_.g===this.g&&_.b===this.b}fromArray(_,tt=0){return this.r=_[tt],this.g=_[tt+1],this.b=_[tt+2],this}toArray(_=[],tt=0){return _[tt]=this.r,_[tt+1]=this.g,_[tt+2]=this.b,_}fromBufferAttribute(_,tt){return this.r=_.getX(tt),this.g=_.getY(tt),this.b=_.getZ(tt),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}};const _color=new Color$1;Color$1.NAMES=_colorKeywords;class MeshBasicMaterial extends Material{constructor(_){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new Color$1(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(_)}copy(_){return super.copy(_),this.color.copy(_.color),this.map=_.map,this.lightMap=_.lightMap,this.lightMapIntensity=_.lightMapIntensity,this.aoMap=_.aoMap,this.aoMapIntensity=_.aoMapIntensity,this.specularMap=_.specularMap,this.alphaMap=_.alphaMap,this.envMap=_.envMap,this.combine=_.combine,this.reflectivity=_.reflectivity,this.refractionRatio=_.refractionRatio,this.wireframe=_.wireframe,this.wireframeLinewidth=_.wireframeLinewidth,this.wireframeLinecap=_.wireframeLinecap,this.wireframeLinejoin=_.wireframeLinejoin,this.fog=_.fog,this}}const _tables=_generateTables();function _generateTables(){const nt=new ArrayBuffer(4),_=new Float32Array(nt),tt=new Uint32Array(nt),ot=new Uint32Array(512),st=new Uint32Array(512);for(let ht=0;ht<256;++ht){const ft=ht-127;ft<-27?(ot[ht]=0,ot[ht|256]=32768,st[ht]=24,st[ht|256]=24):ft<-14?(ot[ht]=1024>>-ft-14,ot[ht|256]=1024>>-ft-14|32768,st[ht]=-ft-1,st[ht|256]=-ft-1):ft<=15?(ot[ht]=ft+15<<10,ot[ht|256]=ft+15<<10|32768,st[ht]=13,st[ht|256]=13):ft<128?(ot[ht]=31744,ot[ht|256]=64512,st[ht]=24,st[ht|256]=24):(ot[ht]=31744,ot[ht|256]=64512,st[ht]=13,st[ht|256]=13)}const at=new Uint32Array(2048),lt=new Uint32Array(64),dt=new Uint32Array(64);for(let ht=1;ht<1024;++ht){let ft=ht<<13,gt=0;for(;!(ft&8388608);)ft<<=1,gt-=8388608;ft&=-8388609,gt+=947912704,at[ht]=ft|gt}for(let ht=1024;ht<2048;++ht)at[ht]=939524096+(ht-1024<<13);for(let ht=1;ht<31;++ht)lt[ht]=ht<<23;lt[31]=1199570944,lt[32]=2147483648;for(let ht=33;ht<63;++ht)lt[ht]=2147483648+(ht-32<<23);lt[63]=3347054592;for(let ht=1;ht<64;++ht)ht!==32&&(dt[ht]=1024);return{floatView:_,uint32View:tt,baseTable:ot,shiftTable:st,mantissaTable:at,exponentTable:lt,offsetTable:dt}}function toHalfFloat(nt){Math.abs(nt)>65504&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),nt=clamp$3(nt,-65504,65504),_tables.floatView[0]=nt;const _=_tables.uint32View[0],tt=_>>23&511;return _tables.baseTable[tt]+((_&8388607)>>_tables.shiftTable[tt])}function fromHalfFloat(nt){const _=nt>>10;return _tables.uint32View[0]=_tables.mantissaTable[_tables.offsetTable[_]+(nt&1023)]+_tables.exponentTable[_],_tables.floatView[0]}const DataUtils={toHalfFloat,fromHalfFloat},_vector$8=new Vector3,_vector2$1=new Vector2;class BufferAttribute{constructor(_,tt,ot=!1){if(Array.isArray(_))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=_,this.itemSize=tt,this.count=_!==void 0?_.length/tt:0,this.normalized=ot,this.usage=StaticDrawUsage,this.updateRange={offset:0,count:-1},this.gpuType=FloatType,this.version=0}onUploadCallback(){}set needsUpdate(_){_===!0&&this.version++}setUsage(_){return this.usage=_,this}copy(_){return this.name=_.name,this.array=new _.array.constructor(_.array),this.itemSize=_.itemSize,this.count=_.count,this.normalized=_.normalized,this.usage=_.usage,this.gpuType=_.gpuType,this}copyAt(_,tt,ot){_*=this.itemSize,ot*=tt.itemSize;for(let st=0,at=this.itemSize;st<at;st++)this.array[_+st]=tt.array[ot+st];return this}copyArray(_){return this.array.set(_),this}applyMatrix3(_){if(this.itemSize===2)for(let tt=0,ot=this.count;tt<ot;tt++)_vector2$1.fromBufferAttribute(this,tt),_vector2$1.applyMatrix3(_),this.setXY(tt,_vector2$1.x,_vector2$1.y);else if(this.itemSize===3)for(let tt=0,ot=this.count;tt<ot;tt++)_vector$8.fromBufferAttribute(this,tt),_vector$8.applyMatrix3(_),this.setXYZ(tt,_vector$8.x,_vector$8.y,_vector$8.z);return this}applyMatrix4(_){for(let tt=0,ot=this.count;tt<ot;tt++)_vector$8.fromBufferAttribute(this,tt),_vector$8.applyMatrix4(_),this.setXYZ(tt,_vector$8.x,_vector$8.y,_vector$8.z);return this}applyNormalMatrix(_){for(let tt=0,ot=this.count;tt<ot;tt++)_vector$8.fromBufferAttribute(this,tt),_vector$8.applyNormalMatrix(_),this.setXYZ(tt,_vector$8.x,_vector$8.y,_vector$8.z);return this}transformDirection(_){for(let tt=0,ot=this.count;tt<ot;tt++)_vector$8.fromBufferAttribute(this,tt),_vector$8.transformDirection(_),this.setXYZ(tt,_vector$8.x,_vector$8.y,_vector$8.z);return this}set(_,tt=0){return this.array.set(_,tt),this}getX(_){let tt=this.array[_*this.itemSize];return this.normalized&&(tt=denormalize(tt,this.array)),tt}setX(_,tt){return this.normalized&&(tt=normalize$5(tt,this.array)),this.array[_*this.itemSize]=tt,this}getY(_){let tt=this.array[_*this.itemSize+1];return this.normalized&&(tt=denormalize(tt,this.array)),tt}setY(_,tt){return this.normalized&&(tt=normalize$5(tt,this.array)),this.array[_*this.itemSize+1]=tt,this}getZ(_){let tt=this.array[_*this.itemSize+2];return this.normalized&&(tt=denormalize(tt,this.array)),tt}setZ(_,tt){return this.normalized&&(tt=normalize$5(tt,this.array)),this.array[_*this.itemSize+2]=tt,this}getW(_){let tt=this.array[_*this.itemSize+3];return this.normalized&&(tt=denormalize(tt,this.array)),tt}setW(_,tt){return this.normalized&&(tt=normalize$5(tt,this.array)),this.array[_*this.itemSize+3]=tt,this}setXY(_,tt,ot){return _*=this.itemSize,this.normalized&&(tt=normalize$5(tt,this.array),ot=normalize$5(ot,this.array)),this.array[_+0]=tt,this.array[_+1]=ot,this}setXYZ(_,tt,ot,st){return _*=this.itemSize,this.normalized&&(tt=normalize$5(tt,this.array),ot=normalize$5(ot,this.array),st=normalize$5(st,this.array)),this.array[_+0]=tt,this.array[_+1]=ot,this.array[_+2]=st,this}setXYZW(_,tt,ot,st,at){return _*=this.itemSize,this.normalized&&(tt=normalize$5(tt,this.array),ot=normalize$5(ot,this.array),st=normalize$5(st,this.array),at=normalize$5(at,this.array)),this.array[_+0]=tt,this.array[_+1]=ot,this.array[_+2]=st,this.array[_+3]=at,this}onUpload(_){return this.onUploadCallback=_,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const _={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(_.name=this.name),this.usage!==StaticDrawUsage&&(_.usage=this.usage),(this.updateRange.offset!==0||this.updateRange.count!==-1)&&(_.updateRange=this.updateRange),_}copyColorsArray(){console.error("THREE.BufferAttribute: copyColorsArray() was removed in r144.")}copyVector2sArray(){console.error("THREE.BufferAttribute: copyVector2sArray() was removed in r144.")}copyVector3sArray(){console.error("THREE.BufferAttribute: copyVector3sArray() was removed in r144.")}copyVector4sArray(){console.error("THREE.BufferAttribute: copyVector4sArray() was removed in r144.")}}class Int8BufferAttribute extends BufferAttribute{constructor(_,tt,ot){super(new Int8Array(_),tt,ot)}}class Uint8BufferAttribute extends BufferAttribute{constructor(_,tt,ot){super(new Uint8Array(_),tt,ot)}}class Uint8ClampedBufferAttribute extends BufferAttribute{constructor(_,tt,ot){super(new Uint8ClampedArray(_),tt,ot)}}class Int16BufferAttribute extends BufferAttribute{constructor(_,tt,ot){super(new Int16Array(_),tt,ot)}}class Uint16BufferAttribute extends BufferAttribute{constructor(_,tt,ot){super(new Uint16Array(_),tt,ot)}}class Int32BufferAttribute extends BufferAttribute{constructor(_,tt,ot){super(new Int32Array(_),tt,ot)}}class Uint32BufferAttribute extends BufferAttribute{constructor(_,tt,ot){super(new Uint32Array(_),tt,ot)}}class Float16BufferAttribute extends BufferAttribute{constructor(_,tt,ot){super(new Uint16Array(_),tt,ot),this.isFloat16BufferAttribute=!0}getX(_){let tt=fromHalfFloat(this.array[_*this.itemSize]);return this.normalized&&(tt=denormalize(tt,this.array)),tt}setX(_,tt){return this.normalized&&(tt=normalize$5(tt,this.array)),this.array[_*this.itemSize]=toHalfFloat(tt),this}getY(_){let tt=fromHalfFloat(this.array[_*this.itemSize+1]);return this.normalized&&(tt=denormalize(tt,this.array)),tt}setY(_,tt){return this.normalized&&(tt=normalize$5(tt,this.array)),this.array[_*this.itemSize+1]=toHalfFloat(tt),this}getZ(_){let tt=fromHalfFloat(this.array[_*this.itemSize+2]);return this.normalized&&(tt=denormalize(tt,this.array)),tt}setZ(_,tt){return this.normalized&&(tt=normalize$5(tt,this.array)),this.array[_*this.itemSize+2]=toHalfFloat(tt),this}getW(_){let tt=fromHalfFloat(this.array[_*this.itemSize+3]);return this.normalized&&(tt=denormalize(tt,this.array)),tt}setW(_,tt){return this.normalized&&(tt=normalize$5(tt,this.array)),this.array[_*this.itemSize+3]=toHalfFloat(tt),this}setXY(_,tt,ot){return _*=this.itemSize,this.normalized&&(tt=normalize$5(tt,this.array),ot=normalize$5(ot,this.array)),this.array[_+0]=toHalfFloat(tt),this.array[_+1]=toHalfFloat(ot),this}setXYZ(_,tt,ot,st){return _*=this.itemSize,this.normalized&&(tt=normalize$5(tt,this.array),ot=normalize$5(ot,this.array),st=normalize$5(st,this.array)),this.array[_+0]=toHalfFloat(tt),this.array[_+1]=toHalfFloat(ot),this.array[_+2]=toHalfFloat(st),this}setXYZW(_,tt,ot,st,at){return _*=this.itemSize,this.normalized&&(tt=normalize$5(tt,this.array),ot=normalize$5(ot,this.array),st=normalize$5(st,this.array),at=normalize$5(at,this.array)),this.array[_+0]=toHalfFloat(tt),this.array[_+1]=toHalfFloat(ot),this.array[_+2]=toHalfFloat(st),this.array[_+3]=toHalfFloat(at),this}}class Float32BufferAttribute extends BufferAttribute{constructor(_,tt,ot){super(new Float32Array(_),tt,ot)}}class Float64BufferAttribute extends BufferAttribute{constructor(_,tt,ot){super(new Float64Array(_),tt,ot)}}let _id$1=0;const _m1=new Matrix4,_obj=new Object3D,_offset=new Vector3,_box$1=new Box3,_boxMorphTargets=new Box3,_vector$7=new Vector3;class BufferGeometry extends EventDispatcher$1{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:_id$1++}),this.uuid=generateUUID$1(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(_){return Array.isArray(_)?this.index=new(arrayNeedsUint32(_)?Uint32BufferAttribute:Uint16BufferAttribute)(_,1):this.index=_,this}getAttribute(_){return this.attributes[_]}setAttribute(_,tt){return this.attributes[_]=tt,this}deleteAttribute(_){return delete this.attributes[_],this}hasAttribute(_){return this.attributes[_]!==void 0}addGroup(_,tt,ot=0){this.groups.push({start:_,count:tt,materialIndex:ot})}clearGroups(){this.groups=[]}setDrawRange(_,tt){this.drawRange.start=_,this.drawRange.count=tt}applyMatrix4(_){const tt=this.attributes.position;tt!==void 0&&(tt.applyMatrix4(_),tt.needsUpdate=!0);const ot=this.attributes.normal;if(ot!==void 0){const at=new Matrix3().getNormalMatrix(_);ot.applyNormalMatrix(at),ot.needsUpdate=!0}const st=this.attributes.tangent;return st!==void 0&&(st.transformDirection(_),st.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(_){return _m1.makeRotationFromQuaternion(_),this.applyMatrix4(_m1),this}rotateX(_){return _m1.makeRotationX(_),this.applyMatrix4(_m1),this}rotateY(_){return _m1.makeRotationY(_),this.applyMatrix4(_m1),this}rotateZ(_){return _m1.makeRotationZ(_),this.applyMatrix4(_m1),this}translate(_,tt,ot){return _m1.makeTranslation(_,tt,ot),this.applyMatrix4(_m1),this}scale(_,tt,ot){return _m1.makeScale(_,tt,ot),this.applyMatrix4(_m1),this}lookAt(_){return _obj.lookAt(_),_obj.updateMatrix(),this.applyMatrix4(_obj.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(_offset).negate(),this.translate(_offset.x,_offset.y,_offset.z),this}setFromPoints(_){const tt=[];for(let ot=0,st=_.length;ot<st;ot++){const at=_[ot];tt.push(at.x,at.y,at.z||0)}return this.setAttribute("position",new Float32BufferAttribute(tt,3)),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Box3);const _=this.attributes.position,tt=this.morphAttributes.position;if(_&&_.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingBox.set(new Vector3(-1/0,-1/0,-1/0),new Vector3(1/0,1/0,1/0));return}if(_!==void 0){if(this.boundingBox.setFromBufferAttribute(_),tt)for(let ot=0,st=tt.length;ot<st;ot++){const at=tt[ot];_box$1.setFromBufferAttribute(at),this.morphTargetsRelative?(_vector$7.addVectors(this.boundingBox.min,_box$1.min),this.boundingBox.expandByPoint(_vector$7),_vector$7.addVectors(this.boundingBox.max,_box$1.max),this.boundingBox.expandByPoint(_vector$7)):(this.boundingBox.expandByPoint(_box$1.min),this.boundingBox.expandByPoint(_box$1.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Sphere);const _=this.attributes.position,tt=this.morphAttributes.position;if(_&&_.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingSphere.set(new Vector3,1/0);return}if(_){const ot=this.boundingSphere.center;if(_box$1.setFromBufferAttribute(_),tt)for(let at=0,lt=tt.length;at<lt;at++){const dt=tt[at];_boxMorphTargets.setFromBufferAttribute(dt),this.morphTargetsRelative?(_vector$7.addVectors(_box$1.min,_boxMorphTargets.min),_box$1.expandByPoint(_vector$7),_vector$7.addVectors(_box$1.max,_boxMorphTargets.max),_box$1.expandByPoint(_vector$7)):(_box$1.expandByPoint(_boxMorphTargets.min),_box$1.expandByPoint(_boxMorphTargets.max))}_box$1.getCenter(ot);let st=0;for(let at=0,lt=_.count;at<lt;at++)_vector$7.fromBufferAttribute(_,at),st=Math.max(st,ot.distanceToSquared(_vector$7));if(tt)for(let at=0,lt=tt.length;at<lt;at++){const dt=tt[at],ht=this.morphTargetsRelative;for(let ft=0,gt=dt.count;ft<gt;ft++)_vector$7.fromBufferAttribute(dt,ft),ht&&(_offset.fromBufferAttribute(_,ft),_vector$7.add(_offset)),st=Math.max(st,ot.distanceToSquared(_vector$7))}this.boundingSphere.radius=Math.sqrt(st),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const _=this.index,tt=this.attributes;if(_===null||tt.position===void 0||tt.normal===void 0||tt.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const ot=_.array,st=tt.position.array,at=tt.normal.array,lt=tt.uv.array,dt=st.length/3;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new BufferAttribute(new Float32Array(4*dt),4));const ht=this.getAttribute("tangent").array,ft=[],gt=[];for(let qt=0;qt<dt;qt++)ft[qt]=new Vector3,gt[qt]=new Vector3;const Et=new Vector3,yt=new Vector3,Ct=new Vector3,wt=new Vector2,It=new Vector2,Pt=new Vector2,Rt=new Vector3,xt=new Vector3;function Nt(qt,pn,an){Et.fromArray(st,qt*3),yt.fromArray(st,pn*3),Ct.fromArray(st,an*3),wt.fromArray(lt,qt*2),It.fromArray(lt,pn*2),Pt.fromArray(lt,an*2),yt.sub(Et),Ct.sub(Et),It.sub(wt),Pt.sub(wt);const fn=1/(It.x*Pt.y-Pt.x*It.y);isFinite(fn)&&(Rt.copy(yt).multiplyScalar(Pt.y).addScaledVector(Ct,-It.y).multiplyScalar(fn),xt.copy(Ct).multiplyScalar(It.x).addScaledVector(yt,-Pt.x).multiplyScalar(fn),ft[qt].add(Rt),ft[pn].add(Rt),ft[an].add(Rt),gt[qt].add(xt),gt[pn].add(xt),gt[an].add(xt))}let kt=this.groups;kt.length===0&&(kt=[{start:0,count:ot.length}]);for(let qt=0,pn=kt.length;qt<pn;++qt){const an=kt[qt],fn=an.start,dn=an.count;for(let Cn=fn,On=fn+dn;Cn<On;Cn+=3)Nt(ot[Cn+0],ot[Cn+1],ot[Cn+2])}const Vt=new Vector3,Ft=new Vector3,zt=new Vector3,Yt=new Vector3;function Kt(qt){zt.fromArray(at,qt*3),Yt.copy(zt);const pn=ft[qt];Vt.copy(pn),Vt.sub(zt.multiplyScalar(zt.dot(pn))).normalize(),Ft.crossVectors(Yt,pn);const fn=Ft.dot(gt[qt])<0?-1:1;ht[qt*4]=Vt.x,ht[qt*4+1]=Vt.y,ht[qt*4+2]=Vt.z,ht[qt*4+3]=fn}for(let qt=0,pn=kt.length;qt<pn;++qt){const an=kt[qt],fn=an.start,dn=an.count;for(let Cn=fn,On=fn+dn;Cn<On;Cn+=3)Kt(ot[Cn+0]),Kt(ot[Cn+1]),Kt(ot[Cn+2])}}computeVertexNormals(){const _=this.index,tt=this.getAttribute("position");if(tt!==void 0){let ot=this.getAttribute("normal");if(ot===void 0)ot=new BufferAttribute(new Float32Array(tt.count*3),3),this.setAttribute("normal",ot);else for(let yt=0,Ct=ot.count;yt<Ct;yt++)ot.setXYZ(yt,0,0,0);const st=new Vector3,at=new Vector3,lt=new Vector3,dt=new Vector3,ht=new Vector3,ft=new Vector3,gt=new Vector3,Et=new Vector3;if(_)for(let yt=0,Ct=_.count;yt<Ct;yt+=3){const wt=_.getX(yt+0),It=_.getX(yt+1),Pt=_.getX(yt+2);st.fromBufferAttribute(tt,wt),at.fromBufferAttribute(tt,It),lt.fromBufferAttribute(tt,Pt),gt.subVectors(lt,at),Et.subVectors(st,at),gt.cross(Et),dt.fromBufferAttribute(ot,wt),ht.fromBufferAttribute(ot,It),ft.fromBufferAttribute(ot,Pt),dt.add(gt),ht.add(gt),ft.add(gt),ot.setXYZ(wt,dt.x,dt.y,dt.z),ot.setXYZ(It,ht.x,ht.y,ht.z),ot.setXYZ(Pt,ft.x,ft.y,ft.z)}else for(let yt=0,Ct=tt.count;yt<Ct;yt+=3)st.fromBufferAttribute(tt,yt+0),at.fromBufferAttribute(tt,yt+1),lt.fromBufferAttribute(tt,yt+2),gt.subVectors(lt,at),Et.subVectors(st,at),gt.cross(Et),ot.setXYZ(yt+0,gt.x,gt.y,gt.z),ot.setXYZ(yt+1,gt.x,gt.y,gt.z),ot.setXYZ(yt+2,gt.x,gt.y,gt.z);this.normalizeNormals(),ot.needsUpdate=!0}}merge(){return console.error("THREE.BufferGeometry.merge() has been removed. Use THREE.BufferGeometryUtils.mergeGeometries() instead."),this}normalizeNormals(){const _=this.attributes.normal;for(let tt=0,ot=_.count;tt<ot;tt++)_vector$7.fromBufferAttribute(_,tt),_vector$7.normalize(),_.setXYZ(tt,_vector$7.x,_vector$7.y,_vector$7.z)}toNonIndexed(){function _(dt,ht){const ft=dt.array,gt=dt.itemSize,Et=dt.normalized,yt=new ft.constructor(ht.length*gt);let Ct=0,wt=0;for(let It=0,Pt=ht.length;It<Pt;It++){dt.isInterleavedBufferAttribute?Ct=ht[It]*dt.data.stride+dt.offset:Ct=ht[It]*gt;for(let Rt=0;Rt<gt;Rt++)yt[wt++]=ft[Ct++]}return new BufferAttribute(yt,gt,Et)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const tt=new BufferGeometry,ot=this.index.array,st=this.attributes;for(const dt in st){const ht=st[dt],ft=_(ht,ot);tt.setAttribute(dt,ft)}const at=this.morphAttributes;for(const dt in at){const ht=[],ft=at[dt];for(let gt=0,Et=ft.length;gt<Et;gt++){const yt=ft[gt],Ct=_(yt,ot);ht.push(Ct)}tt.morphAttributes[dt]=ht}tt.morphTargetsRelative=this.morphTargetsRelative;const lt=this.groups;for(let dt=0,ht=lt.length;dt<ht;dt++){const ft=lt[dt];tt.addGroup(ft.start,ft.count,ft.materialIndex)}return tt}toJSON(){const _={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(_.uuid=this.uuid,_.type=this.type,this.name!==""&&(_.name=this.name),Object.keys(this.userData).length>0&&(_.userData=this.userData),this.parameters!==void 0){const ht=this.parameters;for(const ft in ht)ht[ft]!==void 0&&(_[ft]=ht[ft]);return _}_.data={attributes:{}};const tt=this.index;tt!==null&&(_.data.index={type:tt.array.constructor.name,array:Array.prototype.slice.call(tt.array)});const ot=this.attributes;for(const ht in ot){const ft=ot[ht];_.data.attributes[ht]=ft.toJSON(_.data)}const st={};let at=!1;for(const ht in this.morphAttributes){const ft=this.morphAttributes[ht],gt=[];for(let Et=0,yt=ft.length;Et<yt;Et++){const Ct=ft[Et];gt.push(Ct.toJSON(_.data))}gt.length>0&&(st[ht]=gt,at=!0)}at&&(_.data.morphAttributes=st,_.data.morphTargetsRelative=this.morphTargetsRelative);const lt=this.groups;lt.length>0&&(_.data.groups=JSON.parse(JSON.stringify(lt)));const dt=this.boundingSphere;return dt!==null&&(_.data.boundingSphere={center:dt.center.toArray(),radius:dt.radius}),_}clone(){return new this.constructor().copy(this)}copy(_){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const tt={};this.name=_.name;const ot=_.index;ot!==null&&this.setIndex(ot.clone(tt));const st=_.attributes;for(const ft in st){const gt=st[ft];this.setAttribute(ft,gt.clone(tt))}const at=_.morphAttributes;for(const ft in at){const gt=[],Et=at[ft];for(let yt=0,Ct=Et.length;yt<Ct;yt++)gt.push(Et[yt].clone(tt));this.morphAttributes[ft]=gt}this.morphTargetsRelative=_.morphTargetsRelative;const lt=_.groups;for(let ft=0,gt=lt.length;ft<gt;ft++){const Et=lt[ft];this.addGroup(Et.start,Et.count,Et.materialIndex)}const dt=_.boundingBox;dt!==null&&(this.boundingBox=dt.clone());const ht=_.boundingSphere;return ht!==null&&(this.boundingSphere=ht.clone()),this.drawRange.start=_.drawRange.start,this.drawRange.count=_.drawRange.count,this.userData=_.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const _inverseMatrix$3=new Matrix4,_ray$3=new Ray,_sphere$5=new Sphere,_sphereHitAt=new Vector3,_vA$1=new Vector3,_vB$1=new Vector3,_vC$1=new Vector3,_tempA=new Vector3,_morphA=new Vector3,_uvA$1=new Vector2,_uvB$1=new Vector2,_uvC$1=new Vector2,_normalA=new Vector3,_normalB=new Vector3,_normalC=new Vector3,_intersectionPoint=new Vector3,_intersectionPointWorld=new Vector3;class Mesh extends Object3D{constructor(_=new BufferGeometry,tt=new MeshBasicMaterial){super(),this.isMesh=!0,this.type="Mesh",this.geometry=_,this.material=tt,this.updateMorphTargets()}copy(_,tt){return super.copy(_,tt),_.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=_.morphTargetInfluences.slice()),_.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},_.morphTargetDictionary)),this.material=_.material,this.geometry=_.geometry,this}updateMorphTargets(){const tt=this.geometry.morphAttributes,ot=Object.keys(tt);if(ot.length>0){const st=tt[ot[0]];if(st!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let at=0,lt=st.length;at<lt;at++){const dt=st[at].name||String(at);this.morphTargetInfluences.push(0),this.morphTargetDictionary[dt]=at}}}}getVertexPosition(_,tt){const ot=this.geometry,st=ot.attributes.position,at=ot.morphAttributes.position,lt=ot.morphTargetsRelative;tt.fromBufferAttribute(st,_);const dt=this.morphTargetInfluences;if(at&&dt){_morphA.set(0,0,0);for(let ht=0,ft=at.length;ht<ft;ht++){const gt=dt[ht],Et=at[ht];gt!==0&&(_tempA.fromBufferAttribute(Et,_),lt?_morphA.addScaledVector(_tempA,gt):_morphA.addScaledVector(_tempA.sub(tt),gt))}tt.add(_morphA)}return tt}raycast(_,tt){const ot=this.geometry,st=this.material,at=this.matrixWorld;st!==void 0&&(ot.boundingSphere===null&&ot.computeBoundingSphere(),_sphere$5.copy(ot.boundingSphere),_sphere$5.applyMatrix4(at),_ray$3.copy(_.ray).recast(_.near),!(_sphere$5.containsPoint(_ray$3.origin)===!1&&(_ray$3.intersectSphere(_sphere$5,_sphereHitAt)===null||_ray$3.origin.distanceToSquared(_sphereHitAt)>(_.far-_.near)**2))&&(_inverseMatrix$3.copy(at).invert(),_ray$3.copy(_.ray).applyMatrix4(_inverseMatrix$3),!(ot.boundingBox!==null&&_ray$3.intersectsBox(ot.boundingBox)===!1)&&this._computeIntersections(_,tt,_ray$3)))}_computeIntersections(_,tt,ot){let st;const at=this.geometry,lt=this.material,dt=at.index,ht=at.attributes.position,ft=at.attributes.uv,gt=at.attributes.uv1,Et=at.attributes.normal,yt=at.groups,Ct=at.drawRange;if(dt!==null)if(Array.isArray(lt))for(let wt=0,It=yt.length;wt<It;wt++){const Pt=yt[wt],Rt=lt[Pt.materialIndex],xt=Math.max(Pt.start,Ct.start),Nt=Math.min(dt.count,Math.min(Pt.start+Pt.count,Ct.start+Ct.count));for(let kt=xt,Vt=Nt;kt<Vt;kt+=3){const Ft=dt.getX(kt),zt=dt.getX(kt+1),Yt=dt.getX(kt+2);st=checkGeometryIntersection(this,Rt,_,ot,ft,gt,Et,Ft,zt,Yt),st&&(st.faceIndex=Math.floor(kt/3),st.face.materialIndex=Pt.materialIndex,tt.push(st))}}else{const wt=Math.max(0,Ct.start),It=Math.min(dt.count,Ct.start+Ct.count);for(let Pt=wt,Rt=It;Pt<Rt;Pt+=3){const xt=dt.getX(Pt),Nt=dt.getX(Pt+1),kt=dt.getX(Pt+2);st=checkGeometryIntersection(this,lt,_,ot,ft,gt,Et,xt,Nt,kt),st&&(st.faceIndex=Math.floor(Pt/3),tt.push(st))}}else if(ht!==void 0)if(Array.isArray(lt))for(let wt=0,It=yt.length;wt<It;wt++){const Pt=yt[wt],Rt=lt[Pt.materialIndex],xt=Math.max(Pt.start,Ct.start),Nt=Math.min(ht.count,Math.min(Pt.start+Pt.count,Ct.start+Ct.count));for(let kt=xt,Vt=Nt;kt<Vt;kt+=3){const Ft=kt,zt=kt+1,Yt=kt+2;st=checkGeometryIntersection(this,Rt,_,ot,ft,gt,Et,Ft,zt,Yt),st&&(st.faceIndex=Math.floor(kt/3),st.face.materialIndex=Pt.materialIndex,tt.push(st))}}else{const wt=Math.max(0,Ct.start),It=Math.min(ht.count,Ct.start+Ct.count);for(let Pt=wt,Rt=It;Pt<Rt;Pt+=3){const xt=Pt,Nt=Pt+1,kt=Pt+2;st=checkGeometryIntersection(this,lt,_,ot,ft,gt,Et,xt,Nt,kt),st&&(st.faceIndex=Math.floor(Pt/3),tt.push(st))}}}}function checkIntersection(nt,_,tt,ot,st,at,lt,dt){let ht;if(_.side===BackSide?ht=ot.intersectTriangle(lt,at,st,!0,dt):ht=ot.intersectTriangle(st,at,lt,_.side===FrontSide,dt),ht===null)return null;_intersectionPointWorld.copy(dt),_intersectionPointWorld.applyMatrix4(nt.matrixWorld);const ft=tt.ray.origin.distanceTo(_intersectionPointWorld);return ft<tt.near||ft>tt.far?null:{distance:ft,point:_intersectionPointWorld.clone(),object:nt}}function checkGeometryIntersection(nt,_,tt,ot,st,at,lt,dt,ht,ft){nt.getVertexPosition(dt,_vA$1),nt.getVertexPosition(ht,_vB$1),nt.getVertexPosition(ft,_vC$1);const gt=checkIntersection(nt,_,tt,ot,_vA$1,_vB$1,_vC$1,_intersectionPoint);if(gt){st&&(_uvA$1.fromBufferAttribute(st,dt),_uvB$1.fromBufferAttribute(st,ht),_uvC$1.fromBufferAttribute(st,ft),gt.uv=Triangle.getInterpolation(_intersectionPoint,_vA$1,_vB$1,_vC$1,_uvA$1,_uvB$1,_uvC$1,new Vector2)),at&&(_uvA$1.fromBufferAttribute(at,dt),_uvB$1.fromBufferAttribute(at,ht),_uvC$1.fromBufferAttribute(at,ft),gt.uv1=Triangle.getInterpolation(_intersectionPoint,_vA$1,_vB$1,_vC$1,_uvA$1,_uvB$1,_uvC$1,new Vector2),gt.uv2=gt.uv1),lt&&(_normalA.fromBufferAttribute(lt,dt),_normalB.fromBufferAttribute(lt,ht),_normalC.fromBufferAttribute(lt,ft),gt.normal=Triangle.getInterpolation(_intersectionPoint,_vA$1,_vB$1,_vC$1,_normalA,_normalB,_normalC,new Vector3),gt.normal.dot(ot.direction)>0&&gt.normal.multiplyScalar(-1));const Et={a:dt,b:ht,c:ft,normal:new Vector3,materialIndex:0};Triangle.getNormal(_vA$1,_vB$1,_vC$1,Et.normal),gt.face=Et}return gt}class BoxGeometry extends BufferGeometry{constructor(_=1,tt=1,ot=1,st=1,at=1,lt=1){super(),this.type="BoxGeometry",this.parameters={width:_,height:tt,depth:ot,widthSegments:st,heightSegments:at,depthSegments:lt};const dt=this;st=Math.floor(st),at=Math.floor(at),lt=Math.floor(lt);const ht=[],ft=[],gt=[],Et=[];let yt=0,Ct=0;wt("z","y","x",-1,-1,ot,tt,_,lt,at,0),wt("z","y","x",1,-1,ot,tt,-_,lt,at,1),wt("x","z","y",1,1,_,ot,tt,st,lt,2),wt("x","z","y",1,-1,_,ot,-tt,st,lt,3),wt("x","y","z",1,-1,_,tt,ot,st,at,4),wt("x","y","z",-1,-1,_,tt,-ot,st,at,5),this.setIndex(ht),this.setAttribute("position",new Float32BufferAttribute(ft,3)),this.setAttribute("normal",new Float32BufferAttribute(gt,3)),this.setAttribute("uv",new Float32BufferAttribute(Et,2));function wt(It,Pt,Rt,xt,Nt,kt,Vt,Ft,zt,Yt,Kt){const qt=kt/zt,pn=Vt/Yt,an=kt/2,fn=Vt/2,dn=Ft/2,Cn=zt+1,On=Yt+1;let Pn=0,yn=0;const An=new Vector3;for(let Sn=0;Sn<On;Sn++){const gn=Sn*pn-fn;for(let _n=0;_n<Cn;_n++){const Rn=_n*qt-an;An[It]=Rn*xt,An[Pt]=gn*Nt,An[Rt]=dn,ft.push(An.x,An.y,An.z),An[It]=0,An[Pt]=0,An[Rt]=Ft>0?1:-1,gt.push(An.x,An.y,An.z),Et.push(_n/zt),Et.push(1-Sn/Yt),Pn+=1}}for(let Sn=0;Sn<Yt;Sn++)for(let gn=0;gn<zt;gn++){const _n=yt+gn+Cn*Sn,Rn=yt+gn+Cn*(Sn+1),bn=yt+(gn+1)+Cn*(Sn+1),jn=yt+(gn+1)+Cn*Sn;ht.push(_n,Rn,jn),ht.push(Rn,bn,jn),yn+=6}dt.addGroup(Ct,yn,Kt),Ct+=yn,yt+=Pn}}copy(_){return super.copy(_),this.parameters=Object.assign({},_.parameters),this}static fromJSON(_){return new BoxGeometry(_.width,_.height,_.depth,_.widthSegments,_.heightSegments,_.depthSegments)}}function cloneUniforms(nt){const _={};for(const tt in nt){_[tt]={};for(const ot in nt[tt]){const st=nt[tt][ot];st&&(st.isColor||st.isMatrix3||st.isMatrix4||st.isVector2||st.isVector3||st.isVector4||st.isTexture||st.isQuaternion)?st.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),_[tt][ot]=null):_[tt][ot]=st.clone():Array.isArray(st)?_[tt][ot]=st.slice():_[tt][ot]=st}}return _}function mergeUniforms(nt){const _={};for(let tt=0;tt<nt.length;tt++){const ot=cloneUniforms(nt[tt]);for(const st in ot)_[st]=ot[st]}return _}function cloneUniformsGroups(nt){const _=[];for(let tt=0;tt<nt.length;tt++)_.push(nt[tt].clone());return _}function getUnlitUniformColorSpace(nt){return nt.getRenderTarget()===null?nt.outputColorSpace:LinearSRGBColorSpace$1}const UniformsUtils={clone:cloneUniforms,merge:mergeUniforms};var default_vertex=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,default_fragment=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;class ShaderMaterial extends Material{constructor(_){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=default_vertex,this.fragmentShader=default_fragment,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,_!==void 0&&this.setValues(_)}copy(_){return super.copy(_),this.fragmentShader=_.fragmentShader,this.vertexShader=_.vertexShader,this.uniforms=cloneUniforms(_.uniforms),this.uniformsGroups=cloneUniformsGroups(_.uniformsGroups),this.defines=Object.assign({},_.defines),this.wireframe=_.wireframe,this.wireframeLinewidth=_.wireframeLinewidth,this.fog=_.fog,this.lights=_.lights,this.clipping=_.clipping,this.extensions=Object.assign({},_.extensions),this.glslVersion=_.glslVersion,this}toJSON(_){const tt=super.toJSON(_);tt.glslVersion=this.glslVersion,tt.uniforms={};for(const st in this.uniforms){const lt=this.uniforms[st].value;lt&&lt.isTexture?tt.uniforms[st]={type:"t",value:lt.toJSON(_).uuid}:lt&&lt.isColor?tt.uniforms[st]={type:"c",value:lt.getHex()}:lt&&lt.isVector2?tt.uniforms[st]={type:"v2",value:lt.toArray()}:lt&&lt.isVector3?tt.uniforms[st]={type:"v3",value:lt.toArray()}:lt&&lt.isVector4?tt.uniforms[st]={type:"v4",value:lt.toArray()}:lt&&lt.isMatrix3?tt.uniforms[st]={type:"m3",value:lt.toArray()}:lt&&lt.isMatrix4?tt.uniforms[st]={type:"m4",value:lt.toArray()}:tt.uniforms[st]={value:lt}}Object.keys(this.defines).length>0&&(tt.defines=this.defines),tt.vertexShader=this.vertexShader,tt.fragmentShader=this.fragmentShader,tt.lights=this.lights,tt.clipping=this.clipping;const ot={};for(const st in this.extensions)this.extensions[st]===!0&&(ot[st]=!0);return Object.keys(ot).length>0&&(tt.extensions=ot),tt}}class Camera extends Object3D{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new Matrix4,this.projectionMatrix=new Matrix4,this.projectionMatrixInverse=new Matrix4,this.coordinateSystem=WebGLCoordinateSystem}copy(_,tt){return super.copy(_,tt),this.matrixWorldInverse.copy(_.matrixWorldInverse),this.projectionMatrix.copy(_.projectionMatrix),this.projectionMatrixInverse.copy(_.projectionMatrixInverse),this.coordinateSystem=_.coordinateSystem,this}getWorldDirection(_){this.updateWorldMatrix(!0,!1);const tt=this.matrixWorld.elements;return _.set(-tt[8],-tt[9],-tt[10]).normalize()}updateMatrixWorld(_){super.updateMatrixWorld(_),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(_,tt){super.updateWorldMatrix(_,tt),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}class PerspectiveCamera extends Camera{constructor(_=50,tt=1,ot=.1,st=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=_,this.zoom=1,this.near=ot,this.far=st,this.focus=10,this.aspect=tt,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(_,tt){return super.copy(_,tt),this.fov=_.fov,this.zoom=_.zoom,this.near=_.near,this.far=_.far,this.focus=_.focus,this.aspect=_.aspect,this.view=_.view===null?null:Object.assign({},_.view),this.filmGauge=_.filmGauge,this.filmOffset=_.filmOffset,this}setFocalLength(_){const tt=.5*this.getFilmHeight()/_;this.fov=RAD2DEG*2*Math.atan(tt),this.updateProjectionMatrix()}getFocalLength(){const _=Math.tan(DEG2RAD$1*.5*this.fov);return .5*this.getFilmHeight()/_}getEffectiveFOV(){return RAD2DEG*2*Math.atan(Math.tan(DEG2RAD$1*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(_,tt,ot,st,at,lt){this.aspect=_/tt,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=_,this.view.fullHeight=tt,this.view.offsetX=ot,this.view.offsetY=st,this.view.width=at,this.view.height=lt,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const _=this.near;let tt=_*Math.tan(DEG2RAD$1*.5*this.fov)/this.zoom,ot=2*tt,st=this.aspect*ot,at=-.5*st;const lt=this.view;if(this.view!==null&&this.view.enabled){const ht=lt.fullWidth,ft=lt.fullHeight;at+=lt.offsetX*st/ht,tt-=lt.offsetY*ot/ft,st*=lt.width/ht,ot*=lt.height/ft}const dt=this.filmOffset;dt!==0&&(at+=_*dt/this.getFilmWidth()),this.projectionMatrix.makePerspective(at,at+st,tt,tt-ot,_,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(_){const tt=super.toJSON(_);return tt.object.fov=this.fov,tt.object.zoom=this.zoom,tt.object.near=this.near,tt.object.far=this.far,tt.object.focus=this.focus,tt.object.aspect=this.aspect,this.view!==null&&(tt.object.view=Object.assign({},this.view)),tt.object.filmGauge=this.filmGauge,tt.object.filmOffset=this.filmOffset,tt}}const fov=-90,aspect=1;class CubeCamera extends Object3D{constructor(_,tt,ot){super(),this.type="CubeCamera",this.renderTarget=ot,this.coordinateSystem=null;const st=new PerspectiveCamera(fov,aspect,_,tt);st.layers=this.layers,this.add(st);const at=new PerspectiveCamera(fov,aspect,_,tt);at.layers=this.layers,this.add(at);const lt=new PerspectiveCamera(fov,aspect,_,tt);lt.layers=this.layers,this.add(lt);const dt=new PerspectiveCamera(fov,aspect,_,tt);dt.layers=this.layers,this.add(dt);const ht=new PerspectiveCamera(fov,aspect,_,tt);ht.layers=this.layers,this.add(ht);const ft=new PerspectiveCamera(fov,aspect,_,tt);ft.layers=this.layers,this.add(ft)}updateCoordinateSystem(){const _=this.coordinateSystem,tt=this.children.concat(),[ot,st,at,lt,dt,ht]=tt;for(const ft of tt)this.remove(ft);if(_===WebGLCoordinateSystem)ot.up.set(0,1,0),ot.lookAt(1,0,0),st.up.set(0,1,0),st.lookAt(-1,0,0),at.up.set(0,0,-1),at.lookAt(0,1,0),lt.up.set(0,0,1),lt.lookAt(0,-1,0),dt.up.set(0,1,0),dt.lookAt(0,0,1),ht.up.set(0,1,0),ht.lookAt(0,0,-1);else if(_===WebGPUCoordinateSystem)ot.up.set(0,-1,0),ot.lookAt(-1,0,0),st.up.set(0,-1,0),st.lookAt(1,0,0),at.up.set(0,0,1),at.lookAt(0,1,0),lt.up.set(0,0,-1),lt.lookAt(0,-1,0),dt.up.set(0,-1,0),dt.lookAt(0,0,1),ht.up.set(0,-1,0),ht.lookAt(0,0,-1);else throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+_);for(const ft of tt)this.add(ft),ft.updateMatrixWorld()}update(_,tt){this.parent===null&&this.updateMatrixWorld();const ot=this.renderTarget;this.coordinateSystem!==_.coordinateSystem&&(this.coordinateSystem=_.coordinateSystem,this.updateCoordinateSystem());const[st,at,lt,dt,ht,ft]=this.children,gt=_.getRenderTarget(),Et=_.toneMapping,yt=_.xr.enabled;_.toneMapping=NoToneMapping,_.xr.enabled=!1;const Ct=ot.texture.generateMipmaps;ot.texture.generateMipmaps=!1,_.setRenderTarget(ot,0),_.render(tt,st),_.setRenderTarget(ot,1),_.render(tt,at),_.setRenderTarget(ot,2),_.render(tt,lt),_.setRenderTarget(ot,3),_.render(tt,dt),_.setRenderTarget(ot,4),_.render(tt,ht),ot.texture.generateMipmaps=Ct,_.setRenderTarget(ot,5),_.render(tt,ft),_.setRenderTarget(gt),_.toneMapping=Et,_.xr.enabled=yt,ot.texture.needsPMREMUpdate=!0}}class CubeTexture extends Texture{constructor(_,tt,ot,st,at,lt,dt,ht,ft,gt){_=_!==void 0?_:[],tt=tt!==void 0?tt:CubeReflectionMapping,super(_,tt,ot,st,at,lt,dt,ht,ft,gt),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(_){this.image=_}}class WebGLCubeRenderTarget extends WebGLRenderTarget{constructor(_=1,tt={}){super(_,_,tt),this.isWebGLCubeRenderTarget=!0;const ot={width:_,height:_,depth:1},st=[ot,ot,ot,ot,ot,ot];tt.encoding!==void 0&&(warnOnce("THREE.WebGLCubeRenderTarget: option.encoding has been replaced by option.colorSpace."),tt.colorSpace=tt.encoding===sRGBEncoding$1?SRGBColorSpace$1:NoColorSpace),this.texture=new CubeTexture(st,tt.mapping,tt.wrapS,tt.wrapT,tt.magFilter,tt.minFilter,tt.format,tt.type,tt.anisotropy,tt.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=tt.generateMipmaps!==void 0?tt.generateMipmaps:!1,this.texture.minFilter=tt.minFilter!==void 0?tt.minFilter:LinearFilter}fromEquirectangularTexture(_,tt){this.texture.type=tt.type,this.texture.colorSpace=tt.colorSpace,this.texture.generateMipmaps=tt.generateMipmaps,this.texture.minFilter=tt.minFilter,this.texture.magFilter=tt.magFilter;const ot={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},st=new BoxGeometry(5,5,5),at=new ShaderMaterial({name:"CubemapFromEquirect",uniforms:cloneUniforms(ot.uniforms),vertexShader:ot.vertexShader,fragmentShader:ot.fragmentShader,side:BackSide,blending:NoBlending});at.uniforms.tEquirect.value=tt;const lt=new Mesh(st,at),dt=tt.minFilter;return tt.minFilter===LinearMipmapLinearFilter&&(tt.minFilter=LinearFilter),new CubeCamera(1,10,this).update(_,lt),tt.minFilter=dt,lt.geometry.dispose(),lt.material.dispose(),this}clear(_,tt,ot,st){const at=_.getRenderTarget();for(let lt=0;lt<6;lt++)_.setRenderTarget(this,lt),_.clear(tt,ot,st);_.setRenderTarget(at)}}const _vector1=new Vector3,_vector2=new Vector3,_normalMatrix=new Matrix3;class Plane{constructor(_=new Vector3(1,0,0),tt=0){this.isPlane=!0,this.normal=_,this.constant=tt}set(_,tt){return this.normal.copy(_),this.constant=tt,this}setComponents(_,tt,ot,st){return this.normal.set(_,tt,ot),this.constant=st,this}setFromNormalAndCoplanarPoint(_,tt){return this.normal.copy(_),this.constant=-tt.dot(this.normal),this}setFromCoplanarPoints(_,tt,ot){const st=_vector1.subVectors(ot,tt).cross(_vector2.subVectors(_,tt)).normalize();return this.setFromNormalAndCoplanarPoint(st,_),this}copy(_){return this.normal.copy(_.normal),this.constant=_.constant,this}normalize(){const _=1/this.normal.length();return this.normal.multiplyScalar(_),this.constant*=_,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(_){return this.normal.dot(_)+this.constant}distanceToSphere(_){return this.distanceToPoint(_.center)-_.radius}projectPoint(_,tt){return tt.copy(_).addScaledVector(this.normal,-this.distanceToPoint(_))}intersectLine(_,tt){const ot=_.delta(_vector1),st=this.normal.dot(ot);if(st===0)return this.distanceToPoint(_.start)===0?tt.copy(_.start):null;const at=-(_.start.dot(this.normal)+this.constant)/st;return at<0||at>1?null:tt.copy(_.start).addScaledVector(ot,at)}intersectsLine(_){const tt=this.distanceToPoint(_.start),ot=this.distanceToPoint(_.end);return tt<0&&ot>0||ot<0&&tt>0}intersectsBox(_){return _.intersectsPlane(this)}intersectsSphere(_){return _.intersectsPlane(this)}coplanarPoint(_){return _.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(_,tt){const ot=tt||_normalMatrix.getNormalMatrix(_),st=this.coplanarPoint(_vector1).applyMatrix4(_),at=this.normal.applyMatrix3(ot).normalize();return this.constant=-st.dot(at),this}translate(_){return this.constant-=_.dot(this.normal),this}equals(_){return _.normal.equals(this.normal)&&_.constant===this.constant}clone(){return new this.constructor().copy(this)}}const _sphere$4=new Sphere,_vector$6=new Vector3;class Frustum{constructor(_=new Plane,tt=new Plane,ot=new Plane,st=new Plane,at=new Plane,lt=new Plane){this.planes=[_,tt,ot,st,at,lt]}set(_,tt,ot,st,at,lt){const dt=this.planes;return dt[0].copy(_),dt[1].copy(tt),dt[2].copy(ot),dt[3].copy(st),dt[4].copy(at),dt[5].copy(lt),this}copy(_){const tt=this.planes;for(let ot=0;ot<6;ot++)tt[ot].copy(_.planes[ot]);return this}setFromProjectionMatrix(_,tt=WebGLCoordinateSystem){const ot=this.planes,st=_.elements,at=st[0],lt=st[1],dt=st[2],ht=st[3],ft=st[4],gt=st[5],Et=st[6],yt=st[7],Ct=st[8],wt=st[9],It=st[10],Pt=st[11],Rt=st[12],xt=st[13],Nt=st[14],kt=st[15];if(ot[0].setComponents(ht-at,yt-ft,Pt-Ct,kt-Rt).normalize(),ot[1].setComponents(ht+at,yt+ft,Pt+Ct,kt+Rt).normalize(),ot[2].setComponents(ht+lt,yt+gt,Pt+wt,kt+xt).normalize(),ot[3].setComponents(ht-lt,yt-gt,Pt-wt,kt-xt).normalize(),ot[4].setComponents(ht-dt,yt-Et,Pt-It,kt-Nt).normalize(),tt===WebGLCoordinateSystem)ot[5].setComponents(ht+dt,yt+Et,Pt+It,kt+Nt).normalize();else if(tt===WebGPUCoordinateSystem)ot[5].setComponents(dt,Et,It,Nt).normalize();else throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+tt);return this}intersectsObject(_){if(_.boundingSphere!==void 0)_.boundingSphere===null&&_.computeBoundingSphere(),_sphere$4.copy(_.boundingSphere).applyMatrix4(_.matrixWorld);else{const tt=_.geometry;tt.boundingSphere===null&&tt.computeBoundingSphere(),_sphere$4.copy(tt.boundingSphere).applyMatrix4(_.matrixWorld)}return this.intersectsSphere(_sphere$4)}intersectsSprite(_){return _sphere$4.center.set(0,0,0),_sphere$4.radius=.7071067811865476,_sphere$4.applyMatrix4(_.matrixWorld),this.intersectsSphere(_sphere$4)}intersectsSphere(_){const tt=this.planes,ot=_.center,st=-_.radius;for(let at=0;at<6;at++)if(tt[at].distanceToPoint(ot)<st)return!1;return!0}intersectsBox(_){const tt=this.planes;for(let ot=0;ot<6;ot++){const st=tt[ot];if(_vector$6.x=st.normal.x>0?_.max.x:_.min.x,_vector$6.y=st.normal.y>0?_.max.y:_.min.y,_vector$6.z=st.normal.z>0?_.max.z:_.min.z,st.distanceToPoint(_vector$6)<0)return!1}return!0}containsPoint(_){const tt=this.planes;for(let ot=0;ot<6;ot++)if(tt[ot].distanceToPoint(_)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}function WebGLAnimation(){let nt=null,_=!1,tt=null,ot=null;function st(at,lt){tt(at,lt),ot=nt.requestAnimationFrame(st)}return{start:function(){_!==!0&&tt!==null&&(ot=nt.requestAnimationFrame(st),_=!0)},stop:function(){nt.cancelAnimationFrame(ot),_=!1},setAnimationLoop:function(at){tt=at},setContext:function(at){nt=at}}}function WebGLAttributes(nt,_){const tt=_.isWebGL2,ot=new WeakMap;function st(ft,gt){const Et=ft.array,yt=ft.usage,Ct=nt.createBuffer();nt.bindBuffer(gt,Ct),nt.bufferData(gt,Et,yt),ft.onUploadCallback();let wt;if(Et instanceof Float32Array)wt=nt.FLOAT;else if(Et instanceof Uint16Array)if(ft.isFloat16BufferAttribute)if(tt)wt=nt.HALF_FLOAT;else throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");else wt=nt.UNSIGNED_SHORT;else if(Et instanceof Int16Array)wt=nt.SHORT;else if(Et instanceof Uint32Array)wt=nt.UNSIGNED_INT;else if(Et instanceof Int32Array)wt=nt.INT;else if(Et instanceof Int8Array)wt=nt.BYTE;else if(Et instanceof Uint8Array)wt=nt.UNSIGNED_BYTE;else if(Et instanceof Uint8ClampedArray)wt=nt.UNSIGNED_BYTE;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+Et);return{buffer:Ct,type:wt,bytesPerElement:Et.BYTES_PER_ELEMENT,version:ft.version}}function at(ft,gt,Et){const yt=gt.array,Ct=gt.updateRange;nt.bindBuffer(Et,ft),Ct.count===-1?nt.bufferSubData(Et,0,yt):(tt?nt.bufferSubData(Et,Ct.offset*yt.BYTES_PER_ELEMENT,yt,Ct.offset,Ct.count):nt.bufferSubData(Et,Ct.offset*yt.BYTES_PER_ELEMENT,yt.subarray(Ct.offset,Ct.offset+Ct.count)),Ct.count=-1),gt.onUploadCallback()}function lt(ft){return ft.isInterleavedBufferAttribute&&(ft=ft.data),ot.get(ft)}function dt(ft){ft.isInterleavedBufferAttribute&&(ft=ft.data);const gt=ot.get(ft);gt&&(nt.deleteBuffer(gt.buffer),ot.delete(ft))}function ht(ft,gt){if(ft.isGLBufferAttribute){const yt=ot.get(ft);(!yt||yt.version<ft.version)&&ot.set(ft,{buffer:ft.buffer,type:ft.type,bytesPerElement:ft.elementSize,version:ft.version});return}ft.isInterleavedBufferAttribute&&(ft=ft.data);const Et=ot.get(ft);Et===void 0?ot.set(ft,st(ft,gt)):Et.version<ft.version&&(at(Et.buffer,ft,gt),Et.version=ft.version)}return{get:lt,remove:dt,update:ht}}class PlaneGeometry extends BufferGeometry{constructor(_=1,tt=1,ot=1,st=1){super(),this.type="PlaneGeometry",this.parameters={width:_,height:tt,widthSegments:ot,heightSegments:st};const at=_/2,lt=tt/2,dt=Math.floor(ot),ht=Math.floor(st),ft=dt+1,gt=ht+1,Et=_/dt,yt=tt/ht,Ct=[],wt=[],It=[],Pt=[];for(let Rt=0;Rt<gt;Rt++){const xt=Rt*yt-lt;for(let Nt=0;Nt<ft;Nt++){const kt=Nt*Et-at;wt.push(kt,-xt,0),It.push(0,0,1),Pt.push(Nt/dt),Pt.push(1-Rt/ht)}}for(let Rt=0;Rt<ht;Rt++)for(let xt=0;xt<dt;xt++){const Nt=xt+ft*Rt,kt=xt+ft*(Rt+1),Vt=xt+1+ft*(Rt+1),Ft=xt+1+ft*Rt;Ct.push(Nt,kt,Ft),Ct.push(kt,Vt,Ft)}this.setIndex(Ct),this.setAttribute("position",new Float32BufferAttribute(wt,3)),this.setAttribute("normal",new Float32BufferAttribute(It,3)),this.setAttribute("uv",new Float32BufferAttribute(Pt,2))}copy(_){return super.copy(_),this.parameters=Object.assign({},_.parameters),this}static fromJSON(_){return new PlaneGeometry(_.width,_.height,_.widthSegments,_.heightSegments)}}var alphamap_fragment=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;
#endif`,alphamap_pars_fragment=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,alphatest_fragment=`#ifdef USE_ALPHATEST
	if ( diffuseColor.a < alphaTest ) discard;
#endif`,alphatest_pars_fragment=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,aomap_fragment=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,aomap_pars_fragment=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,begin_vertex="vec3 transformed = vec3( position );",beginnormal_vertex=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,bsdfs=`float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
} // validated`,iridescence_fragment=`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			 return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float R21 = R12;
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,bumpmap_pars_fragment=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vBumpMapUv );
		vec2 dSTdy = dFdy( vBumpMapUv );
		float Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = dFdx( surf_pos.xyz );
		vec3 vSigmaY = dFdy( surf_pos.xyz );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,clipping_planes_fragment=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#pragma unroll_loop_start
	for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
		plane = clippingPlanes[ i ];
		if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
	}
	#pragma unroll_loop_end
	#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
		bool clipped = true;
		#pragma unroll_loop_start
		for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
		}
		#pragma unroll_loop_end
		if ( clipped ) discard;
	#endif
#endif`,clipping_planes_pars_fragment=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,clipping_planes_pars_vertex=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,clipping_planes_vertex=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,color_fragment=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,color_pars_fragment=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,color_pars_vertex=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	varying vec3 vColor;
#endif`,color_vertex=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif`,common$1=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
struct GeometricContext {
	vec3 position;
	vec3 normal;
	vec3 viewDir;
#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal;
#endif
};
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
float luminance( const in vec3 rgb ) {
	const vec3 weights = vec3( 0.2126729, 0.7151522, 0.0721750 );
	return dot( weights, rgb );
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}
vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
} // validated`,cube_uv_reflection_fragment=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		highp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_v0 0.339
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_v1 0.276
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_v4 0.046
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_v5 0.016
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_v6 0.0038
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,defaultnormal_vertex=`vec3 transformedNormal = objectNormal;
#ifdef USE_INSTANCING
	mat3 m = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );
	transformedNormal = m * transformedNormal;
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	vec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,displacementmap_pars_vertex=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,displacementmap_vertex=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );
#endif`,emissivemap_fragment=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,emissivemap_pars_fragment=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,encodings_fragment="gl_FragColor = linearToOutputTexel( gl_FragColor );",encodings_pars_fragment=`vec4 LinearToLinear( in vec4 value ) {
	return value;
}
vec4 LinearTosRGB( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}`,envmap_fragment=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,envmap_common_pars_fragment=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,envmap_pars_fragment=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,envmap_pars_vertex=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,envmap_vertex=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,fog_vertex=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,fog_pars_vertex=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,fog_fragment=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,fog_pars_fragment=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,gradientmap_pars_fragment=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,lightmap_fragment=`#ifdef USE_LIGHTMAP
	vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
	vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
	reflectedLight.indirectDiffuse += lightMapIrradiance;
#endif`,lightmap_pars_fragment=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,lights_lambert_fragment=`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,lights_lambert_pars_fragment=`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert`,lights_pars_begin=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
uniform vec3 lightProbe[ 9 ];
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	#if defined ( LEGACY_LIGHTS )
		if ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {
			return pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );
		}
		return 1.0;
	#else
		float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
		if ( cutoffDistance > 0.0 ) {
			distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
		}
		return distanceFalloff;
	#endif
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometry.position;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometry.position;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,envmap_physical_pars_fragment=`#ifdef USE_ENVMAP
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	#ifdef USE_ANISOTROPY
		vec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {
			#ifdef ENVMAP_TYPE_CUBE_UV
				vec3 bentNormal = cross( bitangent, viewDir );
				bentNormal = normalize( cross( bentNormal, bitangent ) );
				bentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );
				return getIBLRadiance( viewDir, bentNormal, roughness );
			#else
				return vec3( 0.0 );
			#endif
		}
	#endif
#endif`,lights_toon_fragment=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,lights_toon_pars_fragment=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon`,lights_phong_fragment=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,lights_phong_pars_fragment=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong`,lights_physical_fragment=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef USE_SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULAR_COLORMAP
			specularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;
		#endif
		#ifdef USE_SPECULAR_INTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEEN_COLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEEN_ROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;
	#endif
#endif
#ifdef USE_ANISOTROPY
	#ifdef USE_ANISOTROPYMAP
		mat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );
		vec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;
		vec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;
	#else
		vec2 anisotropyV = anisotropyVector;
	#endif
	material.anisotropy = length( anisotropyV );
	anisotropyV /= material.anisotropy;
	material.anisotropy = saturate( material.anisotropy );
	material.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );
	material.anisotropyT = tbn[ 0 ] * anisotropyV.x - tbn[ 1 ] * anisotropyV.y;
	material.anisotropyB = tbn[ 1 ] * anisotropyV.x + tbn[ 0 ] * anisotropyV.y;
#endif`,lights_physical_pars_fragment=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
	#ifdef USE_ANISOTROPY
		float anisotropy;
		float alphaT;
		vec3 anisotropyT;
		vec3 anisotropyB;
	#endif
};
vec3 clearcoatSpecular = vec3( 0.0 );
vec3 sheenSpecular = vec3( 0.0 );
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
#ifdef USE_ANISOTROPY
	float V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {
		float gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );
		float gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );
		float v = 0.5 / ( gv + gl );
		return saturate(v);
	}
	float D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {
		float a2 = alphaT * alphaB;
		highp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );
		highp float v2 = dot( v, v );
		float w2 = a2 / v2;
		return RECIPROCAL_PI * a2 * pow2 ( w2 );
	}
#endif
#ifdef USE_CLEARCOAT
	vec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {
		vec3 f0 = material.clearcoatF0;
		float f90 = material.clearcoatF90;
		float roughness = material.clearcoatRoughness;
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = F_Schlick( f0, f90, dotVH );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {
	vec3 f0 = material.specularColor;
	float f90 = material.specularF90;
	float roughness = material.roughness;
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	#ifdef USE_IRIDESCENCE
		F = mix( F, material.iridescenceFresnel, material.iridescence );
	#endif
	#ifdef USE_ANISOTROPY
		float dotTL = dot( material.anisotropyT, lightDir );
		float dotTV = dot( material.anisotropyT, viewDir );
		float dotTH = dot( material.anisotropyT, halfDir );
		float dotBL = dot( material.anisotropyB, lightDir );
		float dotBV = dot( material.anisotropyB, viewDir );
		float dotBH = dot( material.anisotropyB, halfDir );
		float V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );
		float D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );
	#else
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
	#endif
	return F * ( V * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometry.normal;
		vec3 viewDir = geometry.viewDir;
		vec3 position = geometry.position;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecular += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometry.viewDir, geometry.clearcoatNormal, material );
	#endif
	#ifdef USE_SHEEN
		sheenSpecular += irradiance * BRDF_Sheen( directLight.direction, geometry.viewDir, geometry.normal, material.sheenColor, material.sheenRoughness );
	#endif
	reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material );
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecular += irradiance * material.sheenColor * IBLSheenBRDF( geometry.normal, geometry.viewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,lights_fragment_begin=`
GeometricContext geometry;
geometry.position = - vViewPosition;
geometry.normal = normal;
geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
#ifdef USE_CLEARCOAT
	geometry.clearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometry.viewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometry, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	irradiance += getLightProbeIrradiance( lightProbe, geometry.normal );
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,lights_fragment_maps=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometry.normal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	#ifdef USE_ANISOTROPY
		radiance += getIBLAnisotropyRadiance( geometry.viewDir, geometry.normal, material.roughness, material.anisotropyB, material.anisotropy );
	#else
		radiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );
	#endif
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,lights_fragment_end=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );
#endif`,logdepthbuf_fragment=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	gl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,logdepthbuf_pars_fragment=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,logdepthbuf_pars_vertex=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		varying float vFragDepth;
		varying float vIsPerspective;
	#else
		uniform float logDepthBufFC;
	#endif
#endif`,logdepthbuf_vertex=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		vFragDepth = 1.0 + gl_Position.w;
		vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
	#else
		if ( isPerspectiveMatrix( projectionMatrix ) ) {
			gl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;
			gl_Position.z *= gl_Position.w;
		}
	#endif
#endif`,map_fragment=`#ifdef USE_MAP
	diffuseColor *= texture2D( map, vMapUv );
#endif`,map_pars_fragment=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,map_particle_fragment=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	#if defined( USE_POINTS_UV )
		vec2 uv = vUv;
	#else
		vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
	#endif
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,map_particle_pars_fragment=`#if defined( USE_POINTS_UV )
	varying vec2 vUv;
#else
	#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
		uniform mat3 uvTransform;
	#endif
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,metalnessmap_fragment=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );
	metalnessFactor *= texelMetalness.b;
#endif`,metalnessmap_pars_fragment=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,morphcolor_vertex=`#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,morphnormal_vertex=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		objectNormal += morphNormal0 * morphTargetInfluences[ 0 ];
		objectNormal += morphNormal1 * morphTargetInfluences[ 1 ];
		objectNormal += morphNormal2 * morphTargetInfluences[ 2 ];
		objectNormal += morphNormal3 * morphTargetInfluences[ 3 ];
	#endif
#endif`,morphtarget_pars_vertex=`#ifdef USE_MORPHTARGETS
	uniform float morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
		uniform sampler2DArray morphTargetsTexture;
		uniform ivec2 morphTargetsTextureSize;
		vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
			int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
			int y = texelIndex / morphTargetsTextureSize.x;
			int x = texelIndex - y * morphTargetsTextureSize.x;
			ivec3 morphUV = ivec3( x, y, morphTargetIndex );
			return texelFetch( morphTargetsTexture, morphUV, 0 );
		}
	#else
		#ifndef USE_MORPHNORMALS
			uniform float morphTargetInfluences[ 8 ];
		#else
			uniform float morphTargetInfluences[ 4 ];
		#endif
	#endif
#endif`,morphtarget_vertex=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		transformed += morphTarget0 * morphTargetInfluences[ 0 ];
		transformed += morphTarget1 * morphTargetInfluences[ 1 ];
		transformed += morphTarget2 * morphTargetInfluences[ 2 ];
		transformed += morphTarget3 * morphTargetInfluences[ 3 ];
		#ifndef USE_MORPHNORMALS
			transformed += morphTarget4 * morphTargetInfluences[ 4 ];
			transformed += morphTarget5 * morphTargetInfluences[ 5 ];
			transformed += morphTarget6 * morphTargetInfluences[ 6 ];
			transformed += morphTarget7 * morphTargetInfluences[ 7 ];
		#endif
	#endif
#endif`,normal_fragment_begin=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal *= faceDirection;
	#endif
#endif
#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )
	#ifdef USE_TANGENT
		mat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn = getTangentFrame( - vViewPosition, normal, vNormalMapUv );
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn[0] *= faceDirection;
		tbn[1] *= faceDirection;
	#endif
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	#ifdef USE_TANGENT
		mat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn2[0] *= faceDirection;
		tbn2[1] *= faceDirection;
	#endif
#endif
vec3 geometryNormal = normal;`,normal_fragment_maps=`#ifdef USE_NORMALMAP_OBJECTSPACE
	normal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( USE_NORMALMAP_TANGENTSPACE )
	vec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	normal = normalize( tbn * mapN );
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,normal_pars_fragment=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,normal_pars_vertex=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,normal_vertex=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,normalmap_pars_fragment=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef USE_NORMALMAP_OBJECTSPACE
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )
	mat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( uv.st );
		vec2 st1 = dFdy( uv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );
		return mat3( T * scale, B * scale, N );
	}
#endif`,clearcoat_normal_fragment_begin=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = geometryNormal;
#endif`,clearcoat_normal_fragment_maps=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	clearcoatNormal = normalize( tbn2 * clearcoatMapN );
#endif`,clearcoat_pars_fragment=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif`,iridescence_pars_fragment=`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,output_fragment=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,packing=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;
const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );
const vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );
const float ShiftRight8 = 1. / 256.;
vec4 packDepthToRGBA( const in float v ) {
	vec4 r = vec4( fract( v * PackFactors ), v );
	r.yzw -= r.xyz * ShiftRight8;	return r * PackUpscale;
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors );
}
vec2 packDepthToRG( in highp float v ) {
	return packDepthToRGBA( v ).yx;
}
float unpackRGToDepth( const in highp vec2 v ) {
	return unpackRGBAToDepth( vec4( v.xy, 0.0, 0.0 ) );
}
vec4 pack2HalfToRGBA( vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return depth * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * depth - far );
}`,premultiplied_alpha_fragment=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,project_vertex=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,dithering_fragment=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,dithering_pars_fragment=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,roughnessmap_fragment=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );
	roughnessFactor *= texelRoughness.g;
#endif`,roughnessmap_pars_fragment=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,shadowmap_pars_fragment=`#if NUM_SPOT_LIGHT_COORDS > 0
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
	uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
		bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return shadow;
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
		vec3 lightToPosition = shadowCoord.xyz;
		float dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );		dp += shadowBias;
		vec3 bd3D = normalize( lightToPosition );
		#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
			vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
			return (
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
			) * ( 1.0 / 9.0 );
		#else
			return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
		#endif
	}
#endif`,shadowmap_pars_vertex=`#if NUM_SPOT_LIGHT_COORDS > 0
	uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,shadowmap_vertex=`#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
	vec4 shadowWorldPosition;
#endif
#if defined( USE_SHADOWMAP )
	#if NUM_DIR_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
			vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
			vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
#endif
#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
#endif`,shadowmask_pars_fragment=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,skinbase_vertex=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,skinning_pars_vertex=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	uniform int boneTextureSize;
	mat4 getBoneMatrix( const in float i ) {
		float j = i * 4.0;
		float x = mod( j, float( boneTextureSize ) );
		float y = floor( j / float( boneTextureSize ) );
		float dx = 1.0 / float( boneTextureSize );
		float dy = 1.0 / float( boneTextureSize );
		y = dy * ( y + 0.5 );
		vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );
		vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );
		vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );
		vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );
		mat4 bone = mat4( v1, v2, v3, v4 );
		return bone;
	}
#endif`,skinning_vertex=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,skinnormal_vertex=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,specularmap_fragment=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,specularmap_pars_fragment=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,tonemapping_fragment=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,tonemapping_pars_fragment=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return saturate( toneMappingExposure * color );
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 OptimizedCineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,transmission_fragment=`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmitted = getIBLVolumeRefraction(
		n, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );
#endif`,transmission_pars_fragment=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	float w0( float a ) {
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );
	}
	float w1( float a ) {
		return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );
	}
	float w2( float a ){
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );
	}
	float w3( float a ) {
		return ( 1.0 / 6.0 ) * ( a * a * a );
	}
	float g0( float a ) {
		return w0( a ) + w1( a );
	}
	float g1( float a ) {
		return w2( a ) + w3( a );
	}
	float h0( float a ) {
		return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );
	}
	float h1( float a ) {
		return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );
	}
	vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {
		uv = uv * texelSize.zw + 0.5;
		vec2 iuv = floor( uv );
		vec2 fuv = fract( uv );
		float g0x = g0( fuv.x );
		float g1x = g1( fuv.x );
		float h0x = h0( fuv.x );
		float h1x = h1( fuv.x );
		float h0y = h0( fuv.y );
		float h1y = h1( fuv.y );
		vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +
			g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );
	}
	vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {
		vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );
		vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );
		vec2 fLodSizeInv = 1.0 / fLodSize;
		vec2 cLodSizeInv = 1.0 / cLodSize;
		vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );
		vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );
		return mix( fSample, cSample, fract( lod ) );
	}
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		return textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );
	}
	vec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) ) {
			return vec3( 1.0 );
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
		vec3 refractedRayExit = position + transmissionRay;
		vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
		vec2 refractionCoords = ndcPos.xy / ndcPos.w;
		refractionCoords += 1.0;
		refractionCoords /= 2.0;
		vec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
		vec3 transmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );
		vec3 attenuatedColor = transmittance * transmittedLight.rgb;
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		float transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;
		return vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );
	}
#endif`,uv_pars_fragment=`#ifdef USE_UV
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_SPECULARMAP
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,uv_pars_vertex=`#ifdef USE_UV
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	uniform mat3 mapTransform;
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	uniform mat3 alphaMapTransform;
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	uniform mat3 lightMapTransform;
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	uniform mat3 aoMapTransform;
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	uniform mat3 bumpMapTransform;
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	uniform mat3 normalMapTransform;
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_DISPLACEMENTMAP
	uniform mat3 displacementMapTransform;
	varying vec2 vDisplacementMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	uniform mat3 emissiveMapTransform;
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	uniform mat3 metalnessMapTransform;
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	uniform mat3 roughnessMapTransform;
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	uniform mat3 anisotropyMapTransform;
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	uniform mat3 clearcoatMapTransform;
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform mat3 clearcoatNormalMapTransform;
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform mat3 clearcoatRoughnessMapTransform;
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	uniform mat3 sheenColorMapTransform;
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	uniform mat3 sheenRoughnessMapTransform;
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	uniform mat3 iridescenceMapTransform;
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform mat3 iridescenceThicknessMapTransform;
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SPECULARMAP
	uniform mat3 specularMapTransform;
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	uniform mat3 specularColorMapTransform;
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	uniform mat3 specularIntensityMapTransform;
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,uv_vertex=`#ifdef USE_UV
	vUv = vec3( uv, 1 ).xy;
#endif
#ifdef USE_MAP
	vMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ALPHAMAP
	vAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_LIGHTMAP
	vLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_AOMAP
	vAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_BUMPMAP
	vBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_NORMALMAP
	vNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_DISPLACEMENTMAP
	vDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_EMISSIVEMAP
	vEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_METALNESSMAP
	vMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ROUGHNESSMAP
	vRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ANISOTROPYMAP
	vAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOATMAP
	vClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	vClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	vClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCEMAP
	vIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	vIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_COLORMAP
	vSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	vSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULARMAP
	vSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_COLORMAP
	vSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	vSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_TRANSMISSIONMAP
	vTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_THICKNESSMAP
	vThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;
#endif`,worldpos_vertex=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`;const vertex$h=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,fragment$h=`uniform sampler2D t2D;
uniform float backgroundIntensity;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,vertex$g=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,fragment$g=`#ifdef ENVMAP_TYPE_CUBE
	uniform samplerCube envMap;
#elif defined( ENVMAP_TYPE_CUBE_UV )
	uniform sampler2D envMap;
#endif
uniform float flipEnvMap;
uniform float backgroundBlurriness;
uniform float backgroundIntensity;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	#ifdef ENVMAP_TYPE_CUBE
		vec4 texColor = textureCube( envMap, vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 texColor = textureCubeUV( envMap, vWorldDirection, backgroundBlurriness );
	#else
		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,vertex$f=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,fragment$f=`uniform samplerCube tCube;
uniform float tFlip;
uniform float opacity;
varying vec3 vWorldDirection;
void main() {
	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );
	gl_FragColor = texColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,vertex$e=`#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,fragment$e=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#endif
}`,vertex$d=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,fragment$d=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,vertex$c=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,fragment$c=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,vertex$b=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,fragment$b=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,vertex$a=`#include <common>
#include <uv_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,fragment$a=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,vertex$9=`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,fragment$9=`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,vertex$8=`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,fragment$8=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,vertex$7=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	vViewPosition = - mvPosition.xyz;
#endif
}`,fragment$7=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), opacity );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,vertex$6=`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,fragment$6=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,vertex$5=`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,fragment$5=`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define USE_SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef USE_SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULAR_COLORMAP
		uniform sampler2D specularColorMap;
	#endif
	#ifdef USE_SPECULAR_INTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEEN_COLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEEN_ROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
#ifdef USE_ANISOTROPY
	uniform vec2 anisotropyVector;
	#ifdef USE_ANISOTROPYMAP
		uniform sampler2D anisotropyMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecular;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;
	#endif
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,vertex$4=`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,fragment$4=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,vertex$3=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
#ifdef USE_POINTS_UV
	varying vec2 vUv;
	uniform mat3 uvTransform;
#endif
void main() {
	#ifdef USE_POINTS_UV
		vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	#endif
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,fragment$3=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,vertex$2=`#include <common>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,fragment$2=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <logdepthbuf_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	#include <logdepthbuf_fragment>
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,vertex$1=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
	vec2 scale;
	scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
	scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,fragment$1=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,ShaderChunk={alphamap_fragment,alphamap_pars_fragment,alphatest_fragment,alphatest_pars_fragment,aomap_fragment,aomap_pars_fragment,begin_vertex,beginnormal_vertex,bsdfs,iridescence_fragment,bumpmap_pars_fragment,clipping_planes_fragment,clipping_planes_pars_fragment,clipping_planes_pars_vertex,clipping_planes_vertex,color_fragment,color_pars_fragment,color_pars_vertex,color_vertex,common:common$1,cube_uv_reflection_fragment,defaultnormal_vertex,displacementmap_pars_vertex,displacementmap_vertex,emissivemap_fragment,emissivemap_pars_fragment,encodings_fragment,encodings_pars_fragment,envmap_fragment,envmap_common_pars_fragment,envmap_pars_fragment,envmap_pars_vertex,envmap_physical_pars_fragment,envmap_vertex,fog_vertex,fog_pars_vertex,fog_fragment,fog_pars_fragment,gradientmap_pars_fragment,lightmap_fragment,lightmap_pars_fragment,lights_lambert_fragment,lights_lambert_pars_fragment,lights_pars_begin,lights_toon_fragment,lights_toon_pars_fragment,lights_phong_fragment,lights_phong_pars_fragment,lights_physical_fragment,lights_physical_pars_fragment,lights_fragment_begin,lights_fragment_maps,lights_fragment_end,logdepthbuf_fragment,logdepthbuf_pars_fragment,logdepthbuf_pars_vertex,logdepthbuf_vertex,map_fragment,map_pars_fragment,map_particle_fragment,map_particle_pars_fragment,metalnessmap_fragment,metalnessmap_pars_fragment,morphcolor_vertex,morphnormal_vertex,morphtarget_pars_vertex,morphtarget_vertex,normal_fragment_begin,normal_fragment_maps,normal_pars_fragment,normal_pars_vertex,normal_vertex,normalmap_pars_fragment,clearcoat_normal_fragment_begin,clearcoat_normal_fragment_maps,clearcoat_pars_fragment,iridescence_pars_fragment,output_fragment,packing,premultiplied_alpha_fragment,project_vertex,dithering_fragment,dithering_pars_fragment,roughnessmap_fragment,roughnessmap_pars_fragment,shadowmap_pars_fragment,shadowmap_pars_vertex,shadowmap_vertex,shadowmask_pars_fragment,skinbase_vertex,skinning_pars_vertex,skinning_vertex,skinnormal_vertex,specularmap_fragment,specularmap_pars_fragment,tonemapping_fragment,tonemapping_pars_fragment,transmission_fragment,transmission_pars_fragment,uv_pars_fragment,uv_pars_vertex,uv_vertex,worldpos_vertex,background_vert:vertex$h,background_frag:fragment$h,backgroundCube_vert:vertex$g,backgroundCube_frag:fragment$g,cube_vert:vertex$f,cube_frag:fragment$f,depth_vert:vertex$e,depth_frag:fragment$e,distanceRGBA_vert:vertex$d,distanceRGBA_frag:fragment$d,equirect_vert:vertex$c,equirect_frag:fragment$c,linedashed_vert:vertex$b,linedashed_frag:fragment$b,meshbasic_vert:vertex$a,meshbasic_frag:fragment$a,meshlambert_vert:vertex$9,meshlambert_frag:fragment$9,meshmatcap_vert:vertex$8,meshmatcap_frag:fragment$8,meshnormal_vert:vertex$7,meshnormal_frag:fragment$7,meshphong_vert:vertex$6,meshphong_frag:fragment$6,meshphysical_vert:vertex$5,meshphysical_frag:fragment$5,meshtoon_vert:vertex$4,meshtoon_frag:fragment$4,points_vert:vertex$3,points_frag:fragment$3,shadow_vert:vertex$2,shadow_frag:fragment$2,sprite_vert:vertex$1,sprite_frag:fragment$1},UniformsLib={common:{diffuse:{value:new Color$1(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new Matrix3},alphaMap:{value:null},alphaMapTransform:{value:new Matrix3},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new Matrix3}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new Matrix3}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new Matrix3}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new Matrix3},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new Matrix3},normalScale:{value:new Vector2(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new Matrix3},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new Matrix3}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new Matrix3}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new Matrix3}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Color$1(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Color$1(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new Matrix3},alphaTest:{value:0},uvTransform:{value:new Matrix3}},sprite:{diffuse:{value:new Color$1(16777215)},opacity:{value:1},center:{value:new Vector2(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new Matrix3},alphaMap:{value:null},alphaMapTransform:{value:new Matrix3},alphaTest:{value:0}}},ShaderLib={basic:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.specularmap,UniformsLib.envmap,UniformsLib.aomap,UniformsLib.lightmap,UniformsLib.fog]),vertexShader:ShaderChunk.meshbasic_vert,fragmentShader:ShaderChunk.meshbasic_frag},lambert:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.specularmap,UniformsLib.envmap,UniformsLib.aomap,UniformsLib.lightmap,UniformsLib.emissivemap,UniformsLib.bumpmap,UniformsLib.normalmap,UniformsLib.displacementmap,UniformsLib.fog,UniformsLib.lights,{emissive:{value:new Color$1(0)}}]),vertexShader:ShaderChunk.meshlambert_vert,fragmentShader:ShaderChunk.meshlambert_frag},phong:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.specularmap,UniformsLib.envmap,UniformsLib.aomap,UniformsLib.lightmap,UniformsLib.emissivemap,UniformsLib.bumpmap,UniformsLib.normalmap,UniformsLib.displacementmap,UniformsLib.fog,UniformsLib.lights,{emissive:{value:new Color$1(0)},specular:{value:new Color$1(1118481)},shininess:{value:30}}]),vertexShader:ShaderChunk.meshphong_vert,fragmentShader:ShaderChunk.meshphong_frag},standard:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.envmap,UniformsLib.aomap,UniformsLib.lightmap,UniformsLib.emissivemap,UniformsLib.bumpmap,UniformsLib.normalmap,UniformsLib.displacementmap,UniformsLib.roughnessmap,UniformsLib.metalnessmap,UniformsLib.fog,UniformsLib.lights,{emissive:{value:new Color$1(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:ShaderChunk.meshphysical_vert,fragmentShader:ShaderChunk.meshphysical_frag},toon:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.aomap,UniformsLib.lightmap,UniformsLib.emissivemap,UniformsLib.bumpmap,UniformsLib.normalmap,UniformsLib.displacementmap,UniformsLib.gradientmap,UniformsLib.fog,UniformsLib.lights,{emissive:{value:new Color$1(0)}}]),vertexShader:ShaderChunk.meshtoon_vert,fragmentShader:ShaderChunk.meshtoon_frag},matcap:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.bumpmap,UniformsLib.normalmap,UniformsLib.displacementmap,UniformsLib.fog,{matcap:{value:null}}]),vertexShader:ShaderChunk.meshmatcap_vert,fragmentShader:ShaderChunk.meshmatcap_frag},points:{uniforms:mergeUniforms([UniformsLib.points,UniformsLib.fog]),vertexShader:ShaderChunk.points_vert,fragmentShader:ShaderChunk.points_frag},dashed:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:ShaderChunk.linedashed_vert,fragmentShader:ShaderChunk.linedashed_frag},depth:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.displacementmap]),vertexShader:ShaderChunk.depth_vert,fragmentShader:ShaderChunk.depth_frag},normal:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.bumpmap,UniformsLib.normalmap,UniformsLib.displacementmap,{opacity:{value:1}}]),vertexShader:ShaderChunk.meshnormal_vert,fragmentShader:ShaderChunk.meshnormal_frag},sprite:{uniforms:mergeUniforms([UniformsLib.sprite,UniformsLib.fog]),vertexShader:ShaderChunk.sprite_vert,fragmentShader:ShaderChunk.sprite_frag},background:{uniforms:{uvTransform:{value:new Matrix3},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:ShaderChunk.background_vert,fragmentShader:ShaderChunk.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1}},vertexShader:ShaderChunk.backgroundCube_vert,fragmentShader:ShaderChunk.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:ShaderChunk.cube_vert,fragmentShader:ShaderChunk.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:ShaderChunk.equirect_vert,fragmentShader:ShaderChunk.equirect_frag},distanceRGBA:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.displacementmap,{referencePosition:{value:new Vector3},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:ShaderChunk.distanceRGBA_vert,fragmentShader:ShaderChunk.distanceRGBA_frag},shadow:{uniforms:mergeUniforms([UniformsLib.lights,UniformsLib.fog,{color:{value:new Color$1(0)},opacity:{value:1}}]),vertexShader:ShaderChunk.shadow_vert,fragmentShader:ShaderChunk.shadow_frag}};ShaderLib.physical={uniforms:mergeUniforms([ShaderLib.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new Matrix3},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new Matrix3},clearcoatNormalScale:{value:new Vector2(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new Matrix3},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new Matrix3},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new Matrix3},sheen:{value:0},sheenColor:{value:new Color$1(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new Matrix3},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new Matrix3},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new Matrix3},transmissionSamplerSize:{value:new Vector2},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new Matrix3},attenuationDistance:{value:0},attenuationColor:{value:new Color$1(0)},specularColor:{value:new Color$1(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new Matrix3},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new Matrix3},anisotropyVector:{value:new Vector2},anisotropyMap:{value:null},anisotropyMapTransform:{value:new Matrix3}}]),vertexShader:ShaderChunk.meshphysical_vert,fragmentShader:ShaderChunk.meshphysical_frag};const _rgb={r:0,b:0,g:0};function WebGLBackground(nt,_,tt,ot,st,at,lt){const dt=new Color$1(0);let ht=at===!0?0:1,ft,gt,Et=null,yt=0,Ct=null;function wt(Pt,Rt){let xt=!1,Nt=Rt.isScene===!0?Rt.background:null;switch(Nt&&Nt.isTexture&&(Nt=(Rt.backgroundBlurriness>0?tt:_).get(Nt)),Nt===null?It(dt,ht):Nt&&Nt.isColor&&(It(Nt,1),xt=!0),nt.xr.getEnvironmentBlendMode()){case"opaque":xt=!0;break;case"additive":ot.buffers.color.setClear(0,0,0,1,lt),xt=!0;break;case"alpha-blend":ot.buffers.color.setClear(0,0,0,0,lt),xt=!0;break}(nt.autoClear||xt)&&nt.clear(nt.autoClearColor,nt.autoClearDepth,nt.autoClearStencil),Nt&&(Nt.isCubeTexture||Nt.mapping===CubeUVReflectionMapping)?(gt===void 0&&(gt=new Mesh(new BoxGeometry(1,1,1),new ShaderMaterial({name:"BackgroundCubeMaterial",uniforms:cloneUniforms(ShaderLib.backgroundCube.uniforms),vertexShader:ShaderLib.backgroundCube.vertexShader,fragmentShader:ShaderLib.backgroundCube.fragmentShader,side:BackSide,depthTest:!1,depthWrite:!1,fog:!1})),gt.geometry.deleteAttribute("normal"),gt.geometry.deleteAttribute("uv"),gt.onBeforeRender=function(Ft,zt,Yt){this.matrixWorld.copyPosition(Yt.matrixWorld)},Object.defineProperty(gt.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),st.update(gt)),gt.material.uniforms.envMap.value=Nt,gt.material.uniforms.flipEnvMap.value=Nt.isCubeTexture&&Nt.isRenderTargetTexture===!1?-1:1,gt.material.uniforms.backgroundBlurriness.value=Rt.backgroundBlurriness,gt.material.uniforms.backgroundIntensity.value=Rt.backgroundIntensity,gt.material.toneMapped=Nt.colorSpace!==SRGBColorSpace$1,(Et!==Nt||yt!==Nt.version||Ct!==nt.toneMapping)&&(gt.material.needsUpdate=!0,Et=Nt,yt=Nt.version,Ct=nt.toneMapping),gt.layers.enableAll(),Pt.unshift(gt,gt.geometry,gt.material,0,0,null)):Nt&&Nt.isTexture&&(ft===void 0&&(ft=new Mesh(new PlaneGeometry(2,2),new ShaderMaterial({name:"BackgroundMaterial",uniforms:cloneUniforms(ShaderLib.background.uniforms),vertexShader:ShaderLib.background.vertexShader,fragmentShader:ShaderLib.background.fragmentShader,side:FrontSide,depthTest:!1,depthWrite:!1,fog:!1})),ft.geometry.deleteAttribute("normal"),Object.defineProperty(ft.material,"map",{get:function(){return this.uniforms.t2D.value}}),st.update(ft)),ft.material.uniforms.t2D.value=Nt,ft.material.uniforms.backgroundIntensity.value=Rt.backgroundIntensity,ft.material.toneMapped=Nt.colorSpace!==SRGBColorSpace$1,Nt.matrixAutoUpdate===!0&&Nt.updateMatrix(),ft.material.uniforms.uvTransform.value.copy(Nt.matrix),(Et!==Nt||yt!==Nt.version||Ct!==nt.toneMapping)&&(ft.material.needsUpdate=!0,Et=Nt,yt=Nt.version,Ct=nt.toneMapping),ft.layers.enableAll(),Pt.unshift(ft,ft.geometry,ft.material,0,0,null))}function It(Pt,Rt){Pt.getRGB(_rgb,getUnlitUniformColorSpace(nt)),ot.buffers.color.setClear(_rgb.r,_rgb.g,_rgb.b,Rt,lt)}return{getClearColor:function(){return dt},setClearColor:function(Pt,Rt=1){dt.set(Pt),ht=Rt,It(dt,ht)},getClearAlpha:function(){return ht},setClearAlpha:function(Pt){ht=Pt,It(dt,ht)},render:wt}}function WebGLBindingStates(nt,_,tt,ot){const st=nt.getParameter(nt.MAX_VERTEX_ATTRIBS),at=ot.isWebGL2?null:_.get("OES_vertex_array_object"),lt=ot.isWebGL2||at!==null,dt={},ht=Pt(null);let ft=ht,gt=!1;function Et(dn,Cn,On,Pn,yn){let An=!1;if(lt){const Sn=It(Pn,On,Cn);ft!==Sn&&(ft=Sn,Ct(ft.object)),An=Rt(dn,Pn,On,yn),An&&xt(dn,Pn,On,yn)}else{const Sn=Cn.wireframe===!0;(ft.geometry!==Pn.id||ft.program!==On.id||ft.wireframe!==Sn)&&(ft.geometry=Pn.id,ft.program=On.id,ft.wireframe=Sn,An=!0)}yn!==null&&tt.update(yn,nt.ELEMENT_ARRAY_BUFFER),(An||gt)&&(gt=!1,Yt(dn,Cn,On,Pn),yn!==null&&nt.bindBuffer(nt.ELEMENT_ARRAY_BUFFER,tt.get(yn).buffer))}function yt(){return ot.isWebGL2?nt.createVertexArray():at.createVertexArrayOES()}function Ct(dn){return ot.isWebGL2?nt.bindVertexArray(dn):at.bindVertexArrayOES(dn)}function wt(dn){return ot.isWebGL2?nt.deleteVertexArray(dn):at.deleteVertexArrayOES(dn)}function It(dn,Cn,On){const Pn=On.wireframe===!0;let yn=dt[dn.id];yn===void 0&&(yn={},dt[dn.id]=yn);let An=yn[Cn.id];An===void 0&&(An={},yn[Cn.id]=An);let Sn=An[Pn];return Sn===void 0&&(Sn=Pt(yt()),An[Pn]=Sn),Sn}function Pt(dn){const Cn=[],On=[],Pn=[];for(let yn=0;yn<st;yn++)Cn[yn]=0,On[yn]=0,Pn[yn]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:Cn,enabledAttributes:On,attributeDivisors:Pn,object:dn,attributes:{},index:null}}function Rt(dn,Cn,On,Pn){const yn=ft.attributes,An=Cn.attributes;let Sn=0;const gn=On.getAttributes();for(const _n in gn)if(gn[_n].location>=0){const bn=yn[_n];let jn=An[_n];if(jn===void 0&&(_n==="instanceMatrix"&&dn.instanceMatrix&&(jn=dn.instanceMatrix),_n==="instanceColor"&&dn.instanceColor&&(jn=dn.instanceColor)),bn===void 0||bn.attribute!==jn||jn&&bn.data!==jn.data)return!0;Sn++}return ft.attributesNum!==Sn||ft.index!==Pn}function xt(dn,Cn,On,Pn){const yn={},An=Cn.attributes;let Sn=0;const gn=On.getAttributes();for(const _n in gn)if(gn[_n].location>=0){let bn=An[_n];bn===void 0&&(_n==="instanceMatrix"&&dn.instanceMatrix&&(bn=dn.instanceMatrix),_n==="instanceColor"&&dn.instanceColor&&(bn=dn.instanceColor));const jn={};jn.attribute=bn,bn&&bn.data&&(jn.data=bn.data),yn[_n]=jn,Sn++}ft.attributes=yn,ft.attributesNum=Sn,ft.index=Pn}function Nt(){const dn=ft.newAttributes;for(let Cn=0,On=dn.length;Cn<On;Cn++)dn[Cn]=0}function kt(dn){Vt(dn,0)}function Vt(dn,Cn){const On=ft.newAttributes,Pn=ft.enabledAttributes,yn=ft.attributeDivisors;On[dn]=1,Pn[dn]===0&&(nt.enableVertexAttribArray(dn),Pn[dn]=1),yn[dn]!==Cn&&((ot.isWebGL2?nt:_.get("ANGLE_instanced_arrays"))[ot.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](dn,Cn),yn[dn]=Cn)}function Ft(){const dn=ft.newAttributes,Cn=ft.enabledAttributes;for(let On=0,Pn=Cn.length;On<Pn;On++)Cn[On]!==dn[On]&&(nt.disableVertexAttribArray(On),Cn[On]=0)}function zt(dn,Cn,On,Pn,yn,An,Sn){Sn===!0?nt.vertexAttribIPointer(dn,Cn,On,yn,An):nt.vertexAttribPointer(dn,Cn,On,Pn,yn,An)}function Yt(dn,Cn,On,Pn){if(ot.isWebGL2===!1&&(dn.isInstancedMesh||Pn.isInstancedBufferGeometry)&&_.get("ANGLE_instanced_arrays")===null)return;Nt();const yn=Pn.attributes,An=On.getAttributes(),Sn=Cn.defaultAttributeValues;for(const gn in An){const _n=An[gn];if(_n.location>=0){let Rn=yn[gn];if(Rn===void 0&&(gn==="instanceMatrix"&&dn.instanceMatrix&&(Rn=dn.instanceMatrix),gn==="instanceColor"&&dn.instanceColor&&(Rn=dn.instanceColor)),Rn!==void 0){const bn=Rn.normalized,jn=Rn.itemSize,kn=tt.get(Rn);if(kn===void 0)continue;const Gn=kn.buffer,Vn=kn.type,qn=kn.bytesPerElement,Tr=ot.isWebGL2===!0&&(Vn===nt.INT||Vn===nt.UNSIGNED_INT||Rn.gpuType===IntType);if(Rn.isInterleavedBufferAttribute){const Mn=Rn.data,Zt=Mn.stride,wn=Rn.offset;if(Mn.isInstancedInterleavedBuffer){for(let xn=0;xn<_n.locationSize;xn++)Vt(_n.location+xn,Mn.meshPerAttribute);dn.isInstancedMesh!==!0&&Pn._maxInstanceCount===void 0&&(Pn._maxInstanceCount=Mn.meshPerAttribute*Mn.count)}else for(let xn=0;xn<_n.locationSize;xn++)kt(_n.location+xn);nt.bindBuffer(nt.ARRAY_BUFFER,Gn);for(let xn=0;xn<_n.locationSize;xn++)zt(_n.location+xn,jn/_n.locationSize,Vn,bn,Zt*qn,(wn+jn/_n.locationSize*xn)*qn,Tr)}else{if(Rn.isInstancedBufferAttribute){for(let Mn=0;Mn<_n.locationSize;Mn++)Vt(_n.location+Mn,Rn.meshPerAttribute);dn.isInstancedMesh!==!0&&Pn._maxInstanceCount===void 0&&(Pn._maxInstanceCount=Rn.meshPerAttribute*Rn.count)}else for(let Mn=0;Mn<_n.locationSize;Mn++)kt(_n.location+Mn);nt.bindBuffer(nt.ARRAY_BUFFER,Gn);for(let Mn=0;Mn<_n.locationSize;Mn++)zt(_n.location+Mn,jn/_n.locationSize,Vn,bn,jn*qn,jn/_n.locationSize*Mn*qn,Tr)}}else if(Sn!==void 0){const bn=Sn[gn];if(bn!==void 0)switch(bn.length){case 2:nt.vertexAttrib2fv(_n.location,bn);break;case 3:nt.vertexAttrib3fv(_n.location,bn);break;case 4:nt.vertexAttrib4fv(_n.location,bn);break;default:nt.vertexAttrib1fv(_n.location,bn)}}}}Ft()}function Kt(){an();for(const dn in dt){const Cn=dt[dn];for(const On in Cn){const Pn=Cn[On];for(const yn in Pn)wt(Pn[yn].object),delete Pn[yn];delete Cn[On]}delete dt[dn]}}function qt(dn){if(dt[dn.id]===void 0)return;const Cn=dt[dn.id];for(const On in Cn){const Pn=Cn[On];for(const yn in Pn)wt(Pn[yn].object),delete Pn[yn];delete Cn[On]}delete dt[dn.id]}function pn(dn){for(const Cn in dt){const On=dt[Cn];if(On[dn.id]===void 0)continue;const Pn=On[dn.id];for(const yn in Pn)wt(Pn[yn].object),delete Pn[yn];delete On[dn.id]}}function an(){fn(),gt=!0,ft!==ht&&(ft=ht,Ct(ft.object))}function fn(){ht.geometry=null,ht.program=null,ht.wireframe=!1}return{setup:Et,reset:an,resetDefaultState:fn,dispose:Kt,releaseStatesOfGeometry:qt,releaseStatesOfProgram:pn,initAttributes:Nt,enableAttribute:kt,disableUnusedAttributes:Ft}}function WebGLBufferRenderer(nt,_,tt,ot){const st=ot.isWebGL2;let at;function lt(ft){at=ft}function dt(ft,gt){nt.drawArrays(at,ft,gt),tt.update(gt,at,1)}function ht(ft,gt,Et){if(Et===0)return;let yt,Ct;if(st)yt=nt,Ct="drawArraysInstanced";else if(yt=_.get("ANGLE_instanced_arrays"),Ct="drawArraysInstancedANGLE",yt===null){console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}yt[Ct](at,ft,gt,Et),tt.update(gt,at,Et)}this.setMode=lt,this.render=dt,this.renderInstances=ht}function WebGLCapabilities(nt,_,tt){let ot;function st(){if(ot!==void 0)return ot;if(_.has("EXT_texture_filter_anisotropic")===!0){const zt=_.get("EXT_texture_filter_anisotropic");ot=nt.getParameter(zt.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else ot=0;return ot}function at(zt){if(zt==="highp"){if(nt.getShaderPrecisionFormat(nt.VERTEX_SHADER,nt.HIGH_FLOAT).precision>0&&nt.getShaderPrecisionFormat(nt.FRAGMENT_SHADER,nt.HIGH_FLOAT).precision>0)return"highp";zt="mediump"}return zt==="mediump"&&nt.getShaderPrecisionFormat(nt.VERTEX_SHADER,nt.MEDIUM_FLOAT).precision>0&&nt.getShaderPrecisionFormat(nt.FRAGMENT_SHADER,nt.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}const lt=typeof WebGL2RenderingContext<"u"&&nt.constructor.name==="WebGL2RenderingContext";let dt=tt.precision!==void 0?tt.precision:"highp";const ht=at(dt);ht!==dt&&(console.warn("THREE.WebGLRenderer:",dt,"not supported, using",ht,"instead."),dt=ht);const ft=lt||_.has("WEBGL_draw_buffers"),gt=tt.logarithmicDepthBuffer===!0,Et=nt.getParameter(nt.MAX_TEXTURE_IMAGE_UNITS),yt=nt.getParameter(nt.MAX_VERTEX_TEXTURE_IMAGE_UNITS),Ct=nt.getParameter(nt.MAX_TEXTURE_SIZE),wt=nt.getParameter(nt.MAX_CUBE_MAP_TEXTURE_SIZE),It=nt.getParameter(nt.MAX_VERTEX_ATTRIBS),Pt=nt.getParameter(nt.MAX_VERTEX_UNIFORM_VECTORS),Rt=nt.getParameter(nt.MAX_VARYING_VECTORS),xt=nt.getParameter(nt.MAX_FRAGMENT_UNIFORM_VECTORS),Nt=yt>0,kt=lt||_.has("OES_texture_float"),Vt=Nt&&kt,Ft=lt?nt.getParameter(nt.MAX_SAMPLES):0;return{isWebGL2:lt,drawBuffers:ft,getMaxAnisotropy:st,getMaxPrecision:at,precision:dt,logarithmicDepthBuffer:gt,maxTextures:Et,maxVertexTextures:yt,maxTextureSize:Ct,maxCubemapSize:wt,maxAttributes:It,maxVertexUniforms:Pt,maxVaryings:Rt,maxFragmentUniforms:xt,vertexTextures:Nt,floatFragmentTextures:kt,floatVertexTextures:Vt,maxSamples:Ft}}function WebGLClipping(nt){const _=this;let tt=null,ot=0,st=!1,at=!1;const lt=new Plane,dt=new Matrix3,ht={value:null,needsUpdate:!1};this.uniform=ht,this.numPlanes=0,this.numIntersection=0,this.init=function(Et,yt){const Ct=Et.length!==0||yt||ot!==0||st;return st=yt,ot=Et.length,Ct},this.beginShadows=function(){at=!0,gt(null)},this.endShadows=function(){at=!1},this.setGlobalState=function(Et,yt){tt=gt(Et,yt,0)},this.setState=function(Et,yt,Ct){const wt=Et.clippingPlanes,It=Et.clipIntersection,Pt=Et.clipShadows,Rt=nt.get(Et);if(!st||wt===null||wt.length===0||at&&!Pt)at?gt(null):ft();else{const xt=at?0:ot,Nt=xt*4;let kt=Rt.clippingState||null;ht.value=kt,kt=gt(wt,yt,Nt,Ct);for(let Vt=0;Vt!==Nt;++Vt)kt[Vt]=tt[Vt];Rt.clippingState=kt,this.numIntersection=It?this.numPlanes:0,this.numPlanes+=xt}};function ft(){ht.value!==tt&&(ht.value=tt,ht.needsUpdate=ot>0),_.numPlanes=ot,_.numIntersection=0}function gt(Et,yt,Ct,wt){const It=Et!==null?Et.length:0;let Pt=null;if(It!==0){if(Pt=ht.value,wt!==!0||Pt===null){const Rt=Ct+It*4,xt=yt.matrixWorldInverse;dt.getNormalMatrix(xt),(Pt===null||Pt.length<Rt)&&(Pt=new Float32Array(Rt));for(let Nt=0,kt=Ct;Nt!==It;++Nt,kt+=4)lt.copy(Et[Nt]).applyMatrix4(xt,dt),lt.normal.toArray(Pt,kt),Pt[kt+3]=lt.constant}ht.value=Pt,ht.needsUpdate=!0}return _.numPlanes=It,_.numIntersection=0,Pt}}function WebGLCubeMaps(nt){let _=new WeakMap;function tt(lt,dt){return dt===EquirectangularReflectionMapping?lt.mapping=CubeReflectionMapping:dt===EquirectangularRefractionMapping&&(lt.mapping=CubeRefractionMapping),lt}function ot(lt){if(lt&&lt.isTexture&&lt.isRenderTargetTexture===!1){const dt=lt.mapping;if(dt===EquirectangularReflectionMapping||dt===EquirectangularRefractionMapping)if(_.has(lt)){const ht=_.get(lt).texture;return tt(ht,lt.mapping)}else{const ht=lt.image;if(ht&&ht.height>0){const ft=new WebGLCubeRenderTarget(ht.height/2);return ft.fromEquirectangularTexture(nt,lt),_.set(lt,ft),lt.addEventListener("dispose",st),tt(ft.texture,lt.mapping)}else return null}}return lt}function st(lt){const dt=lt.target;dt.removeEventListener("dispose",st);const ht=_.get(dt);ht!==void 0&&(_.delete(dt),ht.dispose())}function at(){_=new WeakMap}return{get:ot,dispose:at}}class OrthographicCamera extends Camera{constructor(_=-1,tt=1,ot=1,st=-1,at=.1,lt=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=_,this.right=tt,this.top=ot,this.bottom=st,this.near=at,this.far=lt,this.updateProjectionMatrix()}copy(_,tt){return super.copy(_,tt),this.left=_.left,this.right=_.right,this.top=_.top,this.bottom=_.bottom,this.near=_.near,this.far=_.far,this.zoom=_.zoom,this.view=_.view===null?null:Object.assign({},_.view),this}setViewOffset(_,tt,ot,st,at,lt){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=_,this.view.fullHeight=tt,this.view.offsetX=ot,this.view.offsetY=st,this.view.width=at,this.view.height=lt,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const _=(this.right-this.left)/(2*this.zoom),tt=(this.top-this.bottom)/(2*this.zoom),ot=(this.right+this.left)/2,st=(this.top+this.bottom)/2;let at=ot-_,lt=ot+_,dt=st+tt,ht=st-tt;if(this.view!==null&&this.view.enabled){const ft=(this.right-this.left)/this.view.fullWidth/this.zoom,gt=(this.top-this.bottom)/this.view.fullHeight/this.zoom;at+=ft*this.view.offsetX,lt=at+ft*this.view.width,dt-=gt*this.view.offsetY,ht=dt-gt*this.view.height}this.projectionMatrix.makeOrthographic(at,lt,dt,ht,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(_){const tt=super.toJSON(_);return tt.object.zoom=this.zoom,tt.object.left=this.left,tt.object.right=this.right,tt.object.top=this.top,tt.object.bottom=this.bottom,tt.object.near=this.near,tt.object.far=this.far,this.view!==null&&(tt.object.view=Object.assign({},this.view)),tt}}const LOD_MIN=4,EXTRA_LOD_SIGMA=[.125,.215,.35,.446,.526,.582],MAX_SAMPLES=20,_flatCamera=new OrthographicCamera,_clearColor=new Color$1;let _oldTarget=null;const PHI=(1+Math.sqrt(5))/2,INV_PHI=1/PHI,_axisDirections=[new Vector3(1,1,1),new Vector3(-1,1,1),new Vector3(1,1,-1),new Vector3(-1,1,-1),new Vector3(0,PHI,INV_PHI),new Vector3(0,PHI,-INV_PHI),new Vector3(INV_PHI,0,PHI),new Vector3(-INV_PHI,0,PHI),new Vector3(PHI,INV_PHI,0),new Vector3(-PHI,INV_PHI,0)];class PMREMGenerator{constructor(_){this._renderer=_,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(_,tt=0,ot=.1,st=100){_oldTarget=this._renderer.getRenderTarget(),this._setSize(256);const at=this._allocateTargets();return at.depthBuffer=!0,this._sceneToCubeUV(_,ot,st,at),tt>0&&this._blur(at,0,0,tt),this._applyPMREM(at),this._cleanup(at),at}fromEquirectangular(_,tt=null){return this._fromTexture(_,tt)}fromCubemap(_,tt=null){return this._fromTexture(_,tt)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=_getCubemapMaterial(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=_getEquirectMaterial(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(_){this._lodMax=Math.floor(Math.log2(_)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let _=0;_<this._lodPlanes.length;_++)this._lodPlanes[_].dispose()}_cleanup(_){this._renderer.setRenderTarget(_oldTarget),_.scissorTest=!1,_setViewport(_,0,0,_.width,_.height)}_fromTexture(_,tt){_.mapping===CubeReflectionMapping||_.mapping===CubeRefractionMapping?this._setSize(_.image.length===0?16:_.image[0].width||_.image[0].image.width):this._setSize(_.image.width/4),_oldTarget=this._renderer.getRenderTarget();const ot=tt||this._allocateTargets();return this._textureToCubeUV(_,ot),this._applyPMREM(ot),this._cleanup(ot),ot}_allocateTargets(){const _=3*Math.max(this._cubeSize,112),tt=4*this._cubeSize,ot={magFilter:LinearFilter,minFilter:LinearFilter,generateMipmaps:!1,type:HalfFloatType,format:RGBAFormat,colorSpace:LinearSRGBColorSpace$1,depthBuffer:!1},st=_createRenderTarget(_,tt,ot);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==_||this._pingPongRenderTarget.height!==tt){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=_createRenderTarget(_,tt,ot);const{_lodMax:at}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=_createPlanes(at)),this._blurMaterial=_getBlurShader(at,_,tt)}return st}_compileMaterial(_){const tt=new Mesh(this._lodPlanes[0],_);this._renderer.compile(tt,_flatCamera)}_sceneToCubeUV(_,tt,ot,st){const dt=new PerspectiveCamera(90,1,tt,ot),ht=[1,-1,1,1,1,1],ft=[1,1,1,-1,-1,-1],gt=this._renderer,Et=gt.autoClear,yt=gt.toneMapping;gt.getClearColor(_clearColor),gt.toneMapping=NoToneMapping,gt.autoClear=!1;const Ct=new MeshBasicMaterial({name:"PMREM.Background",side:BackSide,depthWrite:!1,depthTest:!1}),wt=new Mesh(new BoxGeometry,Ct);let It=!1;const Pt=_.background;Pt?Pt.isColor&&(Ct.color.copy(Pt),_.background=null,It=!0):(Ct.color.copy(_clearColor),It=!0);for(let Rt=0;Rt<6;Rt++){const xt=Rt%3;xt===0?(dt.up.set(0,ht[Rt],0),dt.lookAt(ft[Rt],0,0)):xt===1?(dt.up.set(0,0,ht[Rt]),dt.lookAt(0,ft[Rt],0)):(dt.up.set(0,ht[Rt],0),dt.lookAt(0,0,ft[Rt]));const Nt=this._cubeSize;_setViewport(st,xt*Nt,Rt>2?Nt:0,Nt,Nt),gt.setRenderTarget(st),It&&gt.render(wt,dt),gt.render(_,dt)}wt.geometry.dispose(),wt.material.dispose(),gt.toneMapping=yt,gt.autoClear=Et,_.background=Pt}_textureToCubeUV(_,tt){const ot=this._renderer,st=_.mapping===CubeReflectionMapping||_.mapping===CubeRefractionMapping;st?(this._cubemapMaterial===null&&(this._cubemapMaterial=_getCubemapMaterial()),this._cubemapMaterial.uniforms.flipEnvMap.value=_.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=_getEquirectMaterial());const at=st?this._cubemapMaterial:this._equirectMaterial,lt=new Mesh(this._lodPlanes[0],at),dt=at.uniforms;dt.envMap.value=_;const ht=this._cubeSize;_setViewport(tt,0,0,3*ht,2*ht),ot.setRenderTarget(tt),ot.render(lt,_flatCamera)}_applyPMREM(_){const tt=this._renderer,ot=tt.autoClear;tt.autoClear=!1;for(let st=1;st<this._lodPlanes.length;st++){const at=Math.sqrt(this._sigmas[st]*this._sigmas[st]-this._sigmas[st-1]*this._sigmas[st-1]),lt=_axisDirections[(st-1)%_axisDirections.length];this._blur(_,st-1,st,at,lt)}tt.autoClear=ot}_blur(_,tt,ot,st,at){const lt=this._pingPongRenderTarget;this._halfBlur(_,lt,tt,ot,st,"latitudinal",at),this._halfBlur(lt,_,ot,ot,st,"longitudinal",at)}_halfBlur(_,tt,ot,st,at,lt,dt){const ht=this._renderer,ft=this._blurMaterial;lt!=="latitudinal"&&lt!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const gt=3,Et=new Mesh(this._lodPlanes[st],ft),yt=ft.uniforms,Ct=this._sizeLods[ot]-1,wt=isFinite(at)?Math.PI/(2*Ct):2*Math.PI/(2*MAX_SAMPLES-1),It=at/wt,Pt=isFinite(at)?1+Math.floor(gt*It):MAX_SAMPLES;Pt>MAX_SAMPLES&&console.warn(`sigmaRadians, ${at}, is too large and will clip, as it requested ${Pt} samples when the maximum is set to ${MAX_SAMPLES}`);const Rt=[];let xt=0;for(let zt=0;zt<MAX_SAMPLES;++zt){const Yt=zt/It,Kt=Math.exp(-Yt*Yt/2);Rt.push(Kt),zt===0?xt+=Kt:zt<Pt&&(xt+=2*Kt)}for(let zt=0;zt<Rt.length;zt++)Rt[zt]=Rt[zt]/xt;yt.envMap.value=_.texture,yt.samples.value=Pt,yt.weights.value=Rt,yt.latitudinal.value=lt==="latitudinal",dt&&(yt.poleAxis.value=dt);const{_lodMax:Nt}=this;yt.dTheta.value=wt,yt.mipInt.value=Nt-ot;const kt=this._sizeLods[st],Vt=3*kt*(st>Nt-LOD_MIN?st-Nt+LOD_MIN:0),Ft=4*(this._cubeSize-kt);_setViewport(tt,Vt,Ft,3*kt,2*kt),ht.setRenderTarget(tt),ht.render(Et,_flatCamera)}}function _createPlanes(nt){const _=[],tt=[],ot=[];let st=nt;const at=nt-LOD_MIN+1+EXTRA_LOD_SIGMA.length;for(let lt=0;lt<at;lt++){const dt=Math.pow(2,st);tt.push(dt);let ht=1/dt;lt>nt-LOD_MIN?ht=EXTRA_LOD_SIGMA[lt-nt+LOD_MIN-1]:lt===0&&(ht=0),ot.push(ht);const ft=1/(dt-2),gt=-ft,Et=1+ft,yt=[gt,gt,Et,gt,Et,Et,gt,gt,Et,Et,gt,Et],Ct=6,wt=6,It=3,Pt=2,Rt=1,xt=new Float32Array(It*wt*Ct),Nt=new Float32Array(Pt*wt*Ct),kt=new Float32Array(Rt*wt*Ct);for(let Ft=0;Ft<Ct;Ft++){const zt=Ft%3*2/3-1,Yt=Ft>2?0:-1,Kt=[zt,Yt,0,zt+2/3,Yt,0,zt+2/3,Yt+1,0,zt,Yt,0,zt+2/3,Yt+1,0,zt,Yt+1,0];xt.set(Kt,It*wt*Ft),Nt.set(yt,Pt*wt*Ft);const qt=[Ft,Ft,Ft,Ft,Ft,Ft];kt.set(qt,Rt*wt*Ft)}const Vt=new BufferGeometry;Vt.setAttribute("position",new BufferAttribute(xt,It)),Vt.setAttribute("uv",new BufferAttribute(Nt,Pt)),Vt.setAttribute("faceIndex",new BufferAttribute(kt,Rt)),_.push(Vt),st>LOD_MIN&&st--}return{lodPlanes:_,sizeLods:tt,sigmas:ot}}function _createRenderTarget(nt,_,tt){const ot=new WebGLRenderTarget(nt,_,tt);return ot.texture.mapping=CubeUVReflectionMapping,ot.texture.name="PMREM.cubeUv",ot.scissorTest=!0,ot}function _setViewport(nt,_,tt,ot,st){nt.viewport.set(_,tt,ot,st),nt.scissor.set(_,tt,ot,st)}function _getBlurShader(nt,_,tt){const ot=new Float32Array(MAX_SAMPLES),st=new Vector3(0,1,0);return new ShaderMaterial({name:"SphericalGaussianBlur",defines:{n:MAX_SAMPLES,CUBEUV_TEXEL_WIDTH:1/_,CUBEUV_TEXEL_HEIGHT:1/tt,CUBEUV_MAX_MIP:`${nt}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:ot},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:st}},vertexShader:_getCommonVertexShader(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:NoBlending,depthTest:!1,depthWrite:!1})}function _getEquirectMaterial(){return new ShaderMaterial({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:_getCommonVertexShader(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:NoBlending,depthTest:!1,depthWrite:!1})}function _getCubemapMaterial(){return new ShaderMaterial({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:_getCommonVertexShader(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:NoBlending,depthTest:!1,depthWrite:!1})}function _getCommonVertexShader(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function WebGLCubeUVMaps(nt){let _=new WeakMap,tt=null;function ot(dt){if(dt&&dt.isTexture){const ht=dt.mapping,ft=ht===EquirectangularReflectionMapping||ht===EquirectangularRefractionMapping,gt=ht===CubeReflectionMapping||ht===CubeRefractionMapping;if(ft||gt)if(dt.isRenderTargetTexture&&dt.needsPMREMUpdate===!0){dt.needsPMREMUpdate=!1;let Et=_.get(dt);return tt===null&&(tt=new PMREMGenerator(nt)),Et=ft?tt.fromEquirectangular(dt,Et):tt.fromCubemap(dt,Et),_.set(dt,Et),Et.texture}else{if(_.has(dt))return _.get(dt).texture;{const Et=dt.image;if(ft&&Et&&Et.height>0||gt&&Et&&st(Et)){tt===null&&(tt=new PMREMGenerator(nt));const yt=ft?tt.fromEquirectangular(dt):tt.fromCubemap(dt);return _.set(dt,yt),dt.addEventListener("dispose",at),yt.texture}else return null}}}return dt}function st(dt){let ht=0;const ft=6;for(let gt=0;gt<ft;gt++)dt[gt]!==void 0&&ht++;return ht===ft}function at(dt){const ht=dt.target;ht.removeEventListener("dispose",at);const ft=_.get(ht);ft!==void 0&&(_.delete(ht),ft.dispose())}function lt(){_=new WeakMap,tt!==null&&(tt.dispose(),tt=null)}return{get:ot,dispose:lt}}function WebGLExtensions(nt){const _={};function tt(ot){if(_[ot]!==void 0)return _[ot];let st;switch(ot){case"WEBGL_depth_texture":st=nt.getExtension("WEBGL_depth_texture")||nt.getExtension("MOZ_WEBGL_depth_texture")||nt.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":st=nt.getExtension("EXT_texture_filter_anisotropic")||nt.getExtension("MOZ_EXT_texture_filter_anisotropic")||nt.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":st=nt.getExtension("WEBGL_compressed_texture_s3tc")||nt.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||nt.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":st=nt.getExtension("WEBGL_compressed_texture_pvrtc")||nt.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:st=nt.getExtension(ot)}return _[ot]=st,st}return{has:function(ot){return tt(ot)!==null},init:function(ot){ot.isWebGL2?tt("EXT_color_buffer_float"):(tt("WEBGL_depth_texture"),tt("OES_texture_float"),tt("OES_texture_half_float"),tt("OES_texture_half_float_linear"),tt("OES_standard_derivatives"),tt("OES_element_index_uint"),tt("OES_vertex_array_object"),tt("ANGLE_instanced_arrays")),tt("OES_texture_float_linear"),tt("EXT_color_buffer_half_float"),tt("WEBGL_multisampled_render_to_texture")},get:function(ot){const st=tt(ot);return st===null&&console.warn("THREE.WebGLRenderer: "+ot+" extension not supported."),st}}}function WebGLGeometries(nt,_,tt,ot){const st={},at=new WeakMap;function lt(Et){const yt=Et.target;yt.index!==null&&_.remove(yt.index);for(const wt in yt.attributes)_.remove(yt.attributes[wt]);for(const wt in yt.morphAttributes){const It=yt.morphAttributes[wt];for(let Pt=0,Rt=It.length;Pt<Rt;Pt++)_.remove(It[Pt])}yt.removeEventListener("dispose",lt),delete st[yt.id];const Ct=at.get(yt);Ct&&(_.remove(Ct),at.delete(yt)),ot.releaseStatesOfGeometry(yt),yt.isInstancedBufferGeometry===!0&&delete yt._maxInstanceCount,tt.memory.geometries--}function dt(Et,yt){return st[yt.id]===!0||(yt.addEventListener("dispose",lt),st[yt.id]=!0,tt.memory.geometries++),yt}function ht(Et){const yt=Et.attributes;for(const wt in yt)_.update(yt[wt],nt.ARRAY_BUFFER);const Ct=Et.morphAttributes;for(const wt in Ct){const It=Ct[wt];for(let Pt=0,Rt=It.length;Pt<Rt;Pt++)_.update(It[Pt],nt.ARRAY_BUFFER)}}function ft(Et){const yt=[],Ct=Et.index,wt=Et.attributes.position;let It=0;if(Ct!==null){const xt=Ct.array;It=Ct.version;for(let Nt=0,kt=xt.length;Nt<kt;Nt+=3){const Vt=xt[Nt+0],Ft=xt[Nt+1],zt=xt[Nt+2];yt.push(Vt,Ft,Ft,zt,zt,Vt)}}else{const xt=wt.array;It=wt.version;for(let Nt=0,kt=xt.length/3-1;Nt<kt;Nt+=3){const Vt=Nt+0,Ft=Nt+1,zt=Nt+2;yt.push(Vt,Ft,Ft,zt,zt,Vt)}}const Pt=new(arrayNeedsUint32(yt)?Uint32BufferAttribute:Uint16BufferAttribute)(yt,1);Pt.version=It;const Rt=at.get(Et);Rt&&_.remove(Rt),at.set(Et,Pt)}function gt(Et){const yt=at.get(Et);if(yt){const Ct=Et.index;Ct!==null&&yt.version<Ct.version&&ft(Et)}else ft(Et);return at.get(Et)}return{get:dt,update:ht,getWireframeAttribute:gt}}function WebGLIndexedBufferRenderer(nt,_,tt,ot){const st=ot.isWebGL2;let at;function lt(yt){at=yt}let dt,ht;function ft(yt){dt=yt.type,ht=yt.bytesPerElement}function gt(yt,Ct){nt.drawElements(at,Ct,dt,yt*ht),tt.update(Ct,at,1)}function Et(yt,Ct,wt){if(wt===0)return;let It,Pt;if(st)It=nt,Pt="drawElementsInstanced";else if(It=_.get("ANGLE_instanced_arrays"),Pt="drawElementsInstancedANGLE",It===null){console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}It[Pt](at,Ct,dt,yt*ht,wt),tt.update(Ct,at,wt)}this.setMode=lt,this.setIndex=ft,this.render=gt,this.renderInstances=Et}function WebGLInfo(nt){const _={geometries:0,textures:0},tt={frame:0,calls:0,triangles:0,points:0,lines:0};function ot(at,lt,dt){switch(tt.calls++,lt){case nt.TRIANGLES:tt.triangles+=dt*(at/3);break;case nt.LINES:tt.lines+=dt*(at/2);break;case nt.LINE_STRIP:tt.lines+=dt*(at-1);break;case nt.LINE_LOOP:tt.lines+=dt*at;break;case nt.POINTS:tt.points+=dt*at;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",lt);break}}function st(){tt.calls=0,tt.triangles=0,tt.points=0,tt.lines=0}return{memory:_,render:tt,programs:null,autoReset:!0,reset:st,update:ot}}function numericalSort(nt,_){return nt[0]-_[0]}function absNumericalSort(nt,_){return Math.abs(_[1])-Math.abs(nt[1])}function WebGLMorphtargets(nt,_,tt){const ot={},st=new Float32Array(8),at=new WeakMap,lt=new Vector4,dt=[];for(let ft=0;ft<8;ft++)dt[ft]=[ft,0];function ht(ft,gt,Et){const yt=ft.morphTargetInfluences;if(_.isWebGL2===!0){const wt=gt.morphAttributes.position||gt.morphAttributes.normal||gt.morphAttributes.color,It=wt!==void 0?wt.length:0;let Pt=at.get(gt);if(Pt===void 0||Pt.count!==It){let Cn=function(){fn.dispose(),at.delete(gt),gt.removeEventListener("dispose",Cn)};var Ct=Cn;Pt!==void 0&&Pt.texture.dispose();const Nt=gt.morphAttributes.position!==void 0,kt=gt.morphAttributes.normal!==void 0,Vt=gt.morphAttributes.color!==void 0,Ft=gt.morphAttributes.position||[],zt=gt.morphAttributes.normal||[],Yt=gt.morphAttributes.color||[];let Kt=0;Nt===!0&&(Kt=1),kt===!0&&(Kt=2),Vt===!0&&(Kt=3);let qt=gt.attributes.position.count*Kt,pn=1;qt>_.maxTextureSize&&(pn=Math.ceil(qt/_.maxTextureSize),qt=_.maxTextureSize);const an=new Float32Array(qt*pn*4*It),fn=new DataArrayTexture(an,qt,pn,It);fn.type=FloatType,fn.needsUpdate=!0;const dn=Kt*4;for(let On=0;On<It;On++){const Pn=Ft[On],yn=zt[On],An=Yt[On],Sn=qt*pn*4*On;for(let gn=0;gn<Pn.count;gn++){const _n=gn*dn;Nt===!0&&(lt.fromBufferAttribute(Pn,gn),an[Sn+_n+0]=lt.x,an[Sn+_n+1]=lt.y,an[Sn+_n+2]=lt.z,an[Sn+_n+3]=0),kt===!0&&(lt.fromBufferAttribute(yn,gn),an[Sn+_n+4]=lt.x,an[Sn+_n+5]=lt.y,an[Sn+_n+6]=lt.z,an[Sn+_n+7]=0),Vt===!0&&(lt.fromBufferAttribute(An,gn),an[Sn+_n+8]=lt.x,an[Sn+_n+9]=lt.y,an[Sn+_n+10]=lt.z,an[Sn+_n+11]=An.itemSize===4?lt.w:1)}}Pt={count:It,texture:fn,size:new Vector2(qt,pn)},at.set(gt,Pt),gt.addEventListener("dispose",Cn)}let Rt=0;for(let Nt=0;Nt<yt.length;Nt++)Rt+=yt[Nt];const xt=gt.morphTargetsRelative?1:1-Rt;Et.getUniforms().setValue(nt,"morphTargetBaseInfluence",xt),Et.getUniforms().setValue(nt,"morphTargetInfluences",yt),Et.getUniforms().setValue(nt,"morphTargetsTexture",Pt.texture,tt),Et.getUniforms().setValue(nt,"morphTargetsTextureSize",Pt.size)}else{const wt=yt===void 0?0:yt.length;let It=ot[gt.id];if(It===void 0||It.length!==wt){It=[];for(let kt=0;kt<wt;kt++)It[kt]=[kt,0];ot[gt.id]=It}for(let kt=0;kt<wt;kt++){const Vt=It[kt];Vt[0]=kt,Vt[1]=yt[kt]}It.sort(absNumericalSort);for(let kt=0;kt<8;kt++)kt<wt&&It[kt][1]?(dt[kt][0]=It[kt][0],dt[kt][1]=It[kt][1]):(dt[kt][0]=Number.MAX_SAFE_INTEGER,dt[kt][1]=0);dt.sort(numericalSort);const Pt=gt.morphAttributes.position,Rt=gt.morphAttributes.normal;let xt=0;for(let kt=0;kt<8;kt++){const Vt=dt[kt],Ft=Vt[0],zt=Vt[1];Ft!==Number.MAX_SAFE_INTEGER&&zt?(Pt&&gt.getAttribute("morphTarget"+kt)!==Pt[Ft]&&gt.setAttribute("morphTarget"+kt,Pt[Ft]),Rt&&gt.getAttribute("morphNormal"+kt)!==Rt[Ft]&&gt.setAttribute("morphNormal"+kt,Rt[Ft]),st[kt]=zt,xt+=zt):(Pt&&gt.hasAttribute("morphTarget"+kt)===!0&&gt.deleteAttribute("morphTarget"+kt),Rt&&gt.hasAttribute("morphNormal"+kt)===!0&&gt.deleteAttribute("morphNormal"+kt),st[kt]=0)}const Nt=gt.morphTargetsRelative?1:1-xt;Et.getUniforms().setValue(nt,"morphTargetBaseInfluence",Nt),Et.getUniforms().setValue(nt,"morphTargetInfluences",st)}}return{update:ht}}function WebGLObjects(nt,_,tt,ot){let st=new WeakMap;function at(ht){const ft=ot.render.frame,gt=ht.geometry,Et=_.get(ht,gt);return st.get(Et)!==ft&&(_.update(Et),st.set(Et,ft)),ht.isInstancedMesh&&(ht.hasEventListener("dispose",dt)===!1&&ht.addEventListener("dispose",dt),tt.update(ht.instanceMatrix,nt.ARRAY_BUFFER),ht.instanceColor!==null&&tt.update(ht.instanceColor,nt.ARRAY_BUFFER)),Et}function lt(){st=new WeakMap}function dt(ht){const ft=ht.target;ft.removeEventListener("dispose",dt),tt.remove(ft.instanceMatrix),ft.instanceColor!==null&&tt.remove(ft.instanceColor)}return{update:at,dispose:lt}}const emptyTexture=new Texture,emptyArrayTexture=new DataArrayTexture,empty3dTexture=new Data3DTexture,emptyCubeTexture=new CubeTexture,arrayCacheF32=[],arrayCacheI32=[],mat4array=new Float32Array(16),mat3array=new Float32Array(9),mat2array=new Float32Array(4);function flatten$1(nt,_,tt){const ot=nt[0];if(ot<=0||ot>0)return nt;const st=_*tt;let at=arrayCacheF32[st];if(at===void 0&&(at=new Float32Array(st),arrayCacheF32[st]=at),_!==0){ot.toArray(at,0);for(let lt=1,dt=0;lt!==_;++lt)dt+=tt,nt[lt].toArray(at,dt)}return at}function arraysEqual(nt,_){if(nt.length!==_.length)return!1;for(let tt=0,ot=nt.length;tt<ot;tt++)if(nt[tt]!==_[tt])return!1;return!0}function copyArray(nt,_){for(let tt=0,ot=_.length;tt<ot;tt++)nt[tt]=_[tt]}function allocTexUnits(nt,_){let tt=arrayCacheI32[_];tt===void 0&&(tt=new Int32Array(_),arrayCacheI32[_]=tt);for(let ot=0;ot!==_;++ot)tt[ot]=nt.allocateTextureUnit();return tt}function setValueV1f(nt,_){const tt=this.cache;tt[0]!==_&&(nt.uniform1f(this.addr,_),tt[0]=_)}function setValueV2f(nt,_){const tt=this.cache;if(_.x!==void 0)(tt[0]!==_.x||tt[1]!==_.y)&&(nt.uniform2f(this.addr,_.x,_.y),tt[0]=_.x,tt[1]=_.y);else{if(arraysEqual(tt,_))return;nt.uniform2fv(this.addr,_),copyArray(tt,_)}}function setValueV3f(nt,_){const tt=this.cache;if(_.x!==void 0)(tt[0]!==_.x||tt[1]!==_.y||tt[2]!==_.z)&&(nt.uniform3f(this.addr,_.x,_.y,_.z),tt[0]=_.x,tt[1]=_.y,tt[2]=_.z);else if(_.r!==void 0)(tt[0]!==_.r||tt[1]!==_.g||tt[2]!==_.b)&&(nt.uniform3f(this.addr,_.r,_.g,_.b),tt[0]=_.r,tt[1]=_.g,tt[2]=_.b);else{if(arraysEqual(tt,_))return;nt.uniform3fv(this.addr,_),copyArray(tt,_)}}function setValueV4f(nt,_){const tt=this.cache;if(_.x!==void 0)(tt[0]!==_.x||tt[1]!==_.y||tt[2]!==_.z||tt[3]!==_.w)&&(nt.uniform4f(this.addr,_.x,_.y,_.z,_.w),tt[0]=_.x,tt[1]=_.y,tt[2]=_.z,tt[3]=_.w);else{if(arraysEqual(tt,_))return;nt.uniform4fv(this.addr,_),copyArray(tt,_)}}function setValueM2(nt,_){const tt=this.cache,ot=_.elements;if(ot===void 0){if(arraysEqual(tt,_))return;nt.uniformMatrix2fv(this.addr,!1,_),copyArray(tt,_)}else{if(arraysEqual(tt,ot))return;mat2array.set(ot),nt.uniformMatrix2fv(this.addr,!1,mat2array),copyArray(tt,ot)}}function setValueM3(nt,_){const tt=this.cache,ot=_.elements;if(ot===void 0){if(arraysEqual(tt,_))return;nt.uniformMatrix3fv(this.addr,!1,_),copyArray(tt,_)}else{if(arraysEqual(tt,ot))return;mat3array.set(ot),nt.uniformMatrix3fv(this.addr,!1,mat3array),copyArray(tt,ot)}}function setValueM4(nt,_){const tt=this.cache,ot=_.elements;if(ot===void 0){if(arraysEqual(tt,_))return;nt.uniformMatrix4fv(this.addr,!1,_),copyArray(tt,_)}else{if(arraysEqual(tt,ot))return;mat4array.set(ot),nt.uniformMatrix4fv(this.addr,!1,mat4array),copyArray(tt,ot)}}function setValueV1i(nt,_){const tt=this.cache;tt[0]!==_&&(nt.uniform1i(this.addr,_),tt[0]=_)}function setValueV2i(nt,_){const tt=this.cache;if(_.x!==void 0)(tt[0]!==_.x||tt[1]!==_.y)&&(nt.uniform2i(this.addr,_.x,_.y),tt[0]=_.x,tt[1]=_.y);else{if(arraysEqual(tt,_))return;nt.uniform2iv(this.addr,_),copyArray(tt,_)}}function setValueV3i(nt,_){const tt=this.cache;if(_.x!==void 0)(tt[0]!==_.x||tt[1]!==_.y||tt[2]!==_.z)&&(nt.uniform3i(this.addr,_.x,_.y,_.z),tt[0]=_.x,tt[1]=_.y,tt[2]=_.z);else{if(arraysEqual(tt,_))return;nt.uniform3iv(this.addr,_),copyArray(tt,_)}}function setValueV4i(nt,_){const tt=this.cache;if(_.x!==void 0)(tt[0]!==_.x||tt[1]!==_.y||tt[2]!==_.z||tt[3]!==_.w)&&(nt.uniform4i(this.addr,_.x,_.y,_.z,_.w),tt[0]=_.x,tt[1]=_.y,tt[2]=_.z,tt[3]=_.w);else{if(arraysEqual(tt,_))return;nt.uniform4iv(this.addr,_),copyArray(tt,_)}}function setValueV1ui(nt,_){const tt=this.cache;tt[0]!==_&&(nt.uniform1ui(this.addr,_),tt[0]=_)}function setValueV2ui(nt,_){const tt=this.cache;if(_.x!==void 0)(tt[0]!==_.x||tt[1]!==_.y)&&(nt.uniform2ui(this.addr,_.x,_.y),tt[0]=_.x,tt[1]=_.y);else{if(arraysEqual(tt,_))return;nt.uniform2uiv(this.addr,_),copyArray(tt,_)}}function setValueV3ui(nt,_){const tt=this.cache;if(_.x!==void 0)(tt[0]!==_.x||tt[1]!==_.y||tt[2]!==_.z)&&(nt.uniform3ui(this.addr,_.x,_.y,_.z),tt[0]=_.x,tt[1]=_.y,tt[2]=_.z);else{if(arraysEqual(tt,_))return;nt.uniform3uiv(this.addr,_),copyArray(tt,_)}}function setValueV4ui(nt,_){const tt=this.cache;if(_.x!==void 0)(tt[0]!==_.x||tt[1]!==_.y||tt[2]!==_.z||tt[3]!==_.w)&&(nt.uniform4ui(this.addr,_.x,_.y,_.z,_.w),tt[0]=_.x,tt[1]=_.y,tt[2]=_.z,tt[3]=_.w);else{if(arraysEqual(tt,_))return;nt.uniform4uiv(this.addr,_),copyArray(tt,_)}}function setValueT1(nt,_,tt){const ot=this.cache,st=tt.allocateTextureUnit();ot[0]!==st&&(nt.uniform1i(this.addr,st),ot[0]=st),tt.setTexture2D(_||emptyTexture,st)}function setValueT3D1(nt,_,tt){const ot=this.cache,st=tt.allocateTextureUnit();ot[0]!==st&&(nt.uniform1i(this.addr,st),ot[0]=st),tt.setTexture3D(_||empty3dTexture,st)}function setValueT6(nt,_,tt){const ot=this.cache,st=tt.allocateTextureUnit();ot[0]!==st&&(nt.uniform1i(this.addr,st),ot[0]=st),tt.setTextureCube(_||emptyCubeTexture,st)}function setValueT2DArray1(nt,_,tt){const ot=this.cache,st=tt.allocateTextureUnit();ot[0]!==st&&(nt.uniform1i(this.addr,st),ot[0]=st),tt.setTexture2DArray(_||emptyArrayTexture,st)}function getSingularSetter(nt){switch(nt){case 5126:return setValueV1f;case 35664:return setValueV2f;case 35665:return setValueV3f;case 35666:return setValueV4f;case 35674:return setValueM2;case 35675:return setValueM3;case 35676:return setValueM4;case 5124:case 35670:return setValueV1i;case 35667:case 35671:return setValueV2i;case 35668:case 35672:return setValueV3i;case 35669:case 35673:return setValueV4i;case 5125:return setValueV1ui;case 36294:return setValueV2ui;case 36295:return setValueV3ui;case 36296:return setValueV4ui;case 35678:case 36198:case 36298:case 36306:case 35682:return setValueT1;case 35679:case 36299:case 36307:return setValueT3D1;case 35680:case 36300:case 36308:case 36293:return setValueT6;case 36289:case 36303:case 36311:case 36292:return setValueT2DArray1}}function setValueV1fArray(nt,_){nt.uniform1fv(this.addr,_)}function setValueV2fArray(nt,_){const tt=flatten$1(_,this.size,2);nt.uniform2fv(this.addr,tt)}function setValueV3fArray(nt,_){const tt=flatten$1(_,this.size,3);nt.uniform3fv(this.addr,tt)}function setValueV4fArray(nt,_){const tt=flatten$1(_,this.size,4);nt.uniform4fv(this.addr,tt)}function setValueM2Array(nt,_){const tt=flatten$1(_,this.size,4);nt.uniformMatrix2fv(this.addr,!1,tt)}function setValueM3Array(nt,_){const tt=flatten$1(_,this.size,9);nt.uniformMatrix3fv(this.addr,!1,tt)}function setValueM4Array(nt,_){const tt=flatten$1(_,this.size,16);nt.uniformMatrix4fv(this.addr,!1,tt)}function setValueV1iArray(nt,_){nt.uniform1iv(this.addr,_)}function setValueV2iArray(nt,_){nt.uniform2iv(this.addr,_)}function setValueV3iArray(nt,_){nt.uniform3iv(this.addr,_)}function setValueV4iArray(nt,_){nt.uniform4iv(this.addr,_)}function setValueV1uiArray(nt,_){nt.uniform1uiv(this.addr,_)}function setValueV2uiArray(nt,_){nt.uniform2uiv(this.addr,_)}function setValueV3uiArray(nt,_){nt.uniform3uiv(this.addr,_)}function setValueV4uiArray(nt,_){nt.uniform4uiv(this.addr,_)}function setValueT1Array(nt,_,tt){const ot=this.cache,st=_.length,at=allocTexUnits(tt,st);arraysEqual(ot,at)||(nt.uniform1iv(this.addr,at),copyArray(ot,at));for(let lt=0;lt!==st;++lt)tt.setTexture2D(_[lt]||emptyTexture,at[lt])}function setValueT3DArray(nt,_,tt){const ot=this.cache,st=_.length,at=allocTexUnits(tt,st);arraysEqual(ot,at)||(nt.uniform1iv(this.addr,at),copyArray(ot,at));for(let lt=0;lt!==st;++lt)tt.setTexture3D(_[lt]||empty3dTexture,at[lt])}function setValueT6Array(nt,_,tt){const ot=this.cache,st=_.length,at=allocTexUnits(tt,st);arraysEqual(ot,at)||(nt.uniform1iv(this.addr,at),copyArray(ot,at));for(let lt=0;lt!==st;++lt)tt.setTextureCube(_[lt]||emptyCubeTexture,at[lt])}function setValueT2DArrayArray(nt,_,tt){const ot=this.cache,st=_.length,at=allocTexUnits(tt,st);arraysEqual(ot,at)||(nt.uniform1iv(this.addr,at),copyArray(ot,at));for(let lt=0;lt!==st;++lt)tt.setTexture2DArray(_[lt]||emptyArrayTexture,at[lt])}function getPureArraySetter(nt){switch(nt){case 5126:return setValueV1fArray;case 35664:return setValueV2fArray;case 35665:return setValueV3fArray;case 35666:return setValueV4fArray;case 35674:return setValueM2Array;case 35675:return setValueM3Array;case 35676:return setValueM4Array;case 5124:case 35670:return setValueV1iArray;case 35667:case 35671:return setValueV2iArray;case 35668:case 35672:return setValueV3iArray;case 35669:case 35673:return setValueV4iArray;case 5125:return setValueV1uiArray;case 36294:return setValueV2uiArray;case 36295:return setValueV3uiArray;case 36296:return setValueV4uiArray;case 35678:case 36198:case 36298:case 36306:case 35682:return setValueT1Array;case 35679:case 36299:case 36307:return setValueT3DArray;case 35680:case 36300:case 36308:case 36293:return setValueT6Array;case 36289:case 36303:case 36311:case 36292:return setValueT2DArrayArray}}class SingleUniform{constructor(_,tt,ot){this.id=_,this.addr=ot,this.cache=[],this.setValue=getSingularSetter(tt.type)}}class PureArrayUniform{constructor(_,tt,ot){this.id=_,this.addr=ot,this.cache=[],this.size=tt.size,this.setValue=getPureArraySetter(tt.type)}}class StructuredUniform{constructor(_){this.id=_,this.seq=[],this.map={}}setValue(_,tt,ot){const st=this.seq;for(let at=0,lt=st.length;at!==lt;++at){const dt=st[at];dt.setValue(_,tt[dt.id],ot)}}}const RePathPart=/(\w+)(\])?(\[|\.)?/g;function addUniform(nt,_){nt.seq.push(_),nt.map[_.id]=_}function parseUniform(nt,_,tt){const ot=nt.name,st=ot.length;for(RePathPart.lastIndex=0;;){const at=RePathPart.exec(ot),lt=RePathPart.lastIndex;let dt=at[1];const ht=at[2]==="]",ft=at[3];if(ht&&(dt=dt|0),ft===void 0||ft==="["&&lt+2===st){addUniform(tt,ft===void 0?new SingleUniform(dt,nt,_):new PureArrayUniform(dt,nt,_));break}else{let Et=tt.map[dt];Et===void 0&&(Et=new StructuredUniform(dt),addUniform(tt,Et)),tt=Et}}}class WebGLUniforms{constructor(_,tt){this.seq=[],this.map={};const ot=_.getProgramParameter(tt,_.ACTIVE_UNIFORMS);for(let st=0;st<ot;++st){const at=_.getActiveUniform(tt,st),lt=_.getUniformLocation(tt,at.name);parseUniform(at,lt,this)}}setValue(_,tt,ot,st){const at=this.map[tt];at!==void 0&&at.setValue(_,ot,st)}setOptional(_,tt,ot){const st=tt[ot];st!==void 0&&this.setValue(_,ot,st)}static upload(_,tt,ot,st){for(let at=0,lt=tt.length;at!==lt;++at){const dt=tt[at],ht=ot[dt.id];ht.needsUpdate!==!1&&dt.setValue(_,ht.value,st)}}static seqWithValue(_,tt){const ot=[];for(let st=0,at=_.length;st!==at;++st){const lt=_[st];lt.id in tt&&ot.push(lt)}return ot}}function WebGLShader(nt,_,tt){const ot=nt.createShader(_);return nt.shaderSource(ot,tt),nt.compileShader(ot),ot}let programIdCount=0;function handleSource(nt,_){const tt=nt.split(`
`),ot=[],st=Math.max(_-6,0),at=Math.min(_+6,tt.length);for(let lt=st;lt<at;lt++){const dt=lt+1;ot.push(`${dt===_?">":" "} ${dt}: ${tt[lt]}`)}return ot.join(`
`)}function getEncodingComponents(nt){switch(nt){case LinearSRGBColorSpace$1:return["Linear","( value )"];case SRGBColorSpace$1:return["sRGB","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported color space:",nt),["Linear","( value )"]}}function getShaderErrors(nt,_,tt){const ot=nt.getShaderParameter(_,nt.COMPILE_STATUS),st=nt.getShaderInfoLog(_).trim();if(ot&&st==="")return"";const at=/ERROR: 0:(\d+)/.exec(st);if(at){const lt=parseInt(at[1]);return tt.toUpperCase()+`

`+st+`

`+handleSource(nt.getShaderSource(_),lt)}else return st}function getTexelEncodingFunction(nt,_){const tt=getEncodingComponents(_);return"vec4 "+nt+"( vec4 value ) { return LinearTo"+tt[0]+tt[1]+"; }"}function getToneMappingFunction(nt,_){let tt;switch(_){case LinearToneMapping:tt="Linear";break;case ReinhardToneMapping:tt="Reinhard";break;case CineonToneMapping:tt="OptimizedCineon";break;case ACESFilmicToneMapping:tt="ACESFilmic";break;case CustomToneMapping:tt="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",_),tt="Linear"}return"vec3 "+nt+"( vec3 color ) { return "+tt+"ToneMapping( color ); }"}function generateExtensions(nt){return[nt.extensionDerivatives||nt.envMapCubeUVHeight||nt.bumpMap||nt.normalMapTangentSpace||nt.clearcoatNormalMap||nt.flatShading||nt.shaderID==="physical"?"#extension GL_OES_standard_derivatives : enable":"",(nt.extensionFragDepth||nt.logarithmicDepthBuffer)&&nt.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",nt.extensionDrawBuffers&&nt.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(nt.extensionShaderTextureLOD||nt.envMap||nt.transmission)&&nt.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(filterEmptyLine).join(`
`)}function generateDefines(nt){const _=[];for(const tt in nt){const ot=nt[tt];ot!==!1&&_.push("#define "+tt+" "+ot)}return _.join(`
`)}function fetchAttributeLocations(nt,_){const tt={},ot=nt.getProgramParameter(_,nt.ACTIVE_ATTRIBUTES);for(let st=0;st<ot;st++){const at=nt.getActiveAttrib(_,st),lt=at.name;let dt=1;at.type===nt.FLOAT_MAT2&&(dt=2),at.type===nt.FLOAT_MAT3&&(dt=3),at.type===nt.FLOAT_MAT4&&(dt=4),tt[lt]={type:at.type,location:nt.getAttribLocation(_,lt),locationSize:dt}}return tt}function filterEmptyLine(nt){return nt!==""}function replaceLightNums(nt,_){const tt=_.numSpotLightShadows+_.numSpotLightMaps-_.numSpotLightShadowsWithMaps;return nt.replace(/NUM_DIR_LIGHTS/g,_.numDirLights).replace(/NUM_SPOT_LIGHTS/g,_.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,_.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,tt).replace(/NUM_RECT_AREA_LIGHTS/g,_.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,_.numPointLights).replace(/NUM_HEMI_LIGHTS/g,_.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,_.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,_.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,_.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,_.numPointLightShadows)}function replaceClippingPlaneNums(nt,_){return nt.replace(/NUM_CLIPPING_PLANES/g,_.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,_.numClippingPlanes-_.numClipIntersection)}const includePattern=/^[ \t]*#include +<([\w\d./]+)>/gm;function resolveIncludes(nt){return nt.replace(includePattern,includeReplacer)}function includeReplacer(nt,_){const tt=ShaderChunk[_];if(tt===void 0)throw new Error("Can not resolve #include <"+_+">");return resolveIncludes(tt)}const unrollLoopPattern=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function unrollLoops(nt){return nt.replace(unrollLoopPattern,loopReplacer)}function loopReplacer(nt,_,tt,ot){let st="";for(let at=parseInt(_);at<parseInt(tt);at++)st+=ot.replace(/\[\s*i\s*\]/g,"[ "+at+" ]").replace(/UNROLLED_LOOP_INDEX/g,at);return st}function generatePrecision(nt){let _="precision "+nt.precision+` float;
precision `+nt.precision+" int;";return nt.precision==="highp"?_+=`
#define HIGH_PRECISION`:nt.precision==="mediump"?_+=`
#define MEDIUM_PRECISION`:nt.precision==="lowp"&&(_+=`
#define LOW_PRECISION`),_}function generateShadowMapTypeDefine(nt){let _="SHADOWMAP_TYPE_BASIC";return nt.shadowMapType===PCFShadowMap?_="SHADOWMAP_TYPE_PCF":nt.shadowMapType===PCFSoftShadowMap?_="SHADOWMAP_TYPE_PCF_SOFT":nt.shadowMapType===VSMShadowMap&&(_="SHADOWMAP_TYPE_VSM"),_}function generateEnvMapTypeDefine(nt){let _="ENVMAP_TYPE_CUBE";if(nt.envMap)switch(nt.envMapMode){case CubeReflectionMapping:case CubeRefractionMapping:_="ENVMAP_TYPE_CUBE";break;case CubeUVReflectionMapping:_="ENVMAP_TYPE_CUBE_UV";break}return _}function generateEnvMapModeDefine(nt){let _="ENVMAP_MODE_REFLECTION";if(nt.envMap)switch(nt.envMapMode){case CubeRefractionMapping:_="ENVMAP_MODE_REFRACTION";break}return _}function generateEnvMapBlendingDefine(nt){let _="ENVMAP_BLENDING_NONE";if(nt.envMap)switch(nt.combine){case MultiplyOperation:_="ENVMAP_BLENDING_MULTIPLY";break;case MixOperation:_="ENVMAP_BLENDING_MIX";break;case AddOperation:_="ENVMAP_BLENDING_ADD";break}return _}function generateCubeUVSize(nt){const _=nt.envMapCubeUVHeight;if(_===null)return null;const tt=Math.log2(_)-2,ot=1/_;return{texelWidth:1/(3*Math.max(Math.pow(2,tt),7*16)),texelHeight:ot,maxMip:tt}}function WebGLProgram(nt,_,tt,ot){const st=nt.getContext(),at=tt.defines;let lt=tt.vertexShader,dt=tt.fragmentShader;const ht=generateShadowMapTypeDefine(tt),ft=generateEnvMapTypeDefine(tt),gt=generateEnvMapModeDefine(tt),Et=generateEnvMapBlendingDefine(tt),yt=generateCubeUVSize(tt),Ct=tt.isWebGL2?"":generateExtensions(tt),wt=generateDefines(at),It=st.createProgram();let Pt,Rt,xt=tt.glslVersion?"#version "+tt.glslVersion+`
`:"";tt.isRawShaderMaterial?(Pt=["#define SHADER_TYPE "+tt.shaderType,"#define SHADER_NAME "+tt.shaderName,wt].filter(filterEmptyLine).join(`
`),Pt.length>0&&(Pt+=`
`),Rt=[Ct,"#define SHADER_TYPE "+tt.shaderType,"#define SHADER_NAME "+tt.shaderName,wt].filter(filterEmptyLine).join(`
`),Rt.length>0&&(Rt+=`
`)):(Pt=[generatePrecision(tt),"#define SHADER_TYPE "+tt.shaderType,"#define SHADER_NAME "+tt.shaderName,wt,tt.instancing?"#define USE_INSTANCING":"",tt.instancingColor?"#define USE_INSTANCING_COLOR":"",tt.useFog&&tt.fog?"#define USE_FOG":"",tt.useFog&&tt.fogExp2?"#define FOG_EXP2":"",tt.map?"#define USE_MAP":"",tt.envMap?"#define USE_ENVMAP":"",tt.envMap?"#define "+gt:"",tt.lightMap?"#define USE_LIGHTMAP":"",tt.aoMap?"#define USE_AOMAP":"",tt.bumpMap?"#define USE_BUMPMAP":"",tt.normalMap?"#define USE_NORMALMAP":"",tt.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",tt.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",tt.displacementMap?"#define USE_DISPLACEMENTMAP":"",tt.emissiveMap?"#define USE_EMISSIVEMAP":"",tt.anisotropyMap?"#define USE_ANISOTROPYMAP":"",tt.clearcoatMap?"#define USE_CLEARCOATMAP":"",tt.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",tt.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",tt.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",tt.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",tt.specularMap?"#define USE_SPECULARMAP":"",tt.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",tt.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",tt.roughnessMap?"#define USE_ROUGHNESSMAP":"",tt.metalnessMap?"#define USE_METALNESSMAP":"",tt.alphaMap?"#define USE_ALPHAMAP":"",tt.transmission?"#define USE_TRANSMISSION":"",tt.transmissionMap?"#define USE_TRANSMISSIONMAP":"",tt.thicknessMap?"#define USE_THICKNESSMAP":"",tt.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",tt.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",tt.mapUv?"#define MAP_UV "+tt.mapUv:"",tt.alphaMapUv?"#define ALPHAMAP_UV "+tt.alphaMapUv:"",tt.lightMapUv?"#define LIGHTMAP_UV "+tt.lightMapUv:"",tt.aoMapUv?"#define AOMAP_UV "+tt.aoMapUv:"",tt.emissiveMapUv?"#define EMISSIVEMAP_UV "+tt.emissiveMapUv:"",tt.bumpMapUv?"#define BUMPMAP_UV "+tt.bumpMapUv:"",tt.normalMapUv?"#define NORMALMAP_UV "+tt.normalMapUv:"",tt.displacementMapUv?"#define DISPLACEMENTMAP_UV "+tt.displacementMapUv:"",tt.metalnessMapUv?"#define METALNESSMAP_UV "+tt.metalnessMapUv:"",tt.roughnessMapUv?"#define ROUGHNESSMAP_UV "+tt.roughnessMapUv:"",tt.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+tt.anisotropyMapUv:"",tt.clearcoatMapUv?"#define CLEARCOATMAP_UV "+tt.clearcoatMapUv:"",tt.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+tt.clearcoatNormalMapUv:"",tt.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+tt.clearcoatRoughnessMapUv:"",tt.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+tt.iridescenceMapUv:"",tt.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+tt.iridescenceThicknessMapUv:"",tt.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+tt.sheenColorMapUv:"",tt.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+tt.sheenRoughnessMapUv:"",tt.specularMapUv?"#define SPECULARMAP_UV "+tt.specularMapUv:"",tt.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+tt.specularColorMapUv:"",tt.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+tt.specularIntensityMapUv:"",tt.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+tt.transmissionMapUv:"",tt.thicknessMapUv?"#define THICKNESSMAP_UV "+tt.thicknessMapUv:"",tt.vertexTangents?"#define USE_TANGENT":"",tt.vertexColors?"#define USE_COLOR":"",tt.vertexAlphas?"#define USE_COLOR_ALPHA":"",tt.vertexUv1s?"#define USE_UV1":"",tt.vertexUv2s?"#define USE_UV2":"",tt.vertexUv3s?"#define USE_UV3":"",tt.pointsUvs?"#define USE_POINTS_UV":"",tt.flatShading?"#define FLAT_SHADED":"",tt.skinning?"#define USE_SKINNING":"",tt.morphTargets?"#define USE_MORPHTARGETS":"",tt.morphNormals&&tt.flatShading===!1?"#define USE_MORPHNORMALS":"",tt.morphColors&&tt.isWebGL2?"#define USE_MORPHCOLORS":"",tt.morphTargetsCount>0&&tt.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",tt.morphTargetsCount>0&&tt.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+tt.morphTextureStride:"",tt.morphTargetsCount>0&&tt.isWebGL2?"#define MORPHTARGETS_COUNT "+tt.morphTargetsCount:"",tt.doubleSided?"#define DOUBLE_SIDED":"",tt.flipSided?"#define FLIP_SIDED":"",tt.shadowMapEnabled?"#define USE_SHADOWMAP":"",tt.shadowMapEnabled?"#define "+ht:"",tt.sizeAttenuation?"#define USE_SIZEATTENUATION":"",tt.useLegacyLights?"#define LEGACY_LIGHTS":"",tt.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",tt.logarithmicDepthBuffer&&tt.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","	attribute vec2 uv1;","#endif","#ifdef USE_UV2","	attribute vec2 uv2;","#endif","#ifdef USE_UV3","	attribute vec2 uv3;","#endif","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","	attribute vec3 morphTarget0;","	attribute vec3 morphTarget1;","	attribute vec3 morphTarget2;","	attribute vec3 morphTarget3;","	#ifdef USE_MORPHNORMALS","		attribute vec3 morphNormal0;","		attribute vec3 morphNormal1;","		attribute vec3 morphNormal2;","		attribute vec3 morphNormal3;","	#else","		attribute vec3 morphTarget4;","		attribute vec3 morphTarget5;","		attribute vec3 morphTarget6;","		attribute vec3 morphTarget7;","	#endif","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(filterEmptyLine).join(`
`),Rt=[Ct,generatePrecision(tt),"#define SHADER_TYPE "+tt.shaderType,"#define SHADER_NAME "+tt.shaderName,wt,tt.useFog&&tt.fog?"#define USE_FOG":"",tt.useFog&&tt.fogExp2?"#define FOG_EXP2":"",tt.map?"#define USE_MAP":"",tt.matcap?"#define USE_MATCAP":"",tt.envMap?"#define USE_ENVMAP":"",tt.envMap?"#define "+ft:"",tt.envMap?"#define "+gt:"",tt.envMap?"#define "+Et:"",yt?"#define CUBEUV_TEXEL_WIDTH "+yt.texelWidth:"",yt?"#define CUBEUV_TEXEL_HEIGHT "+yt.texelHeight:"",yt?"#define CUBEUV_MAX_MIP "+yt.maxMip+".0":"",tt.lightMap?"#define USE_LIGHTMAP":"",tt.aoMap?"#define USE_AOMAP":"",tt.bumpMap?"#define USE_BUMPMAP":"",tt.normalMap?"#define USE_NORMALMAP":"",tt.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",tt.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",tt.emissiveMap?"#define USE_EMISSIVEMAP":"",tt.anisotropy?"#define USE_ANISOTROPY":"",tt.anisotropyMap?"#define USE_ANISOTROPYMAP":"",tt.clearcoat?"#define USE_CLEARCOAT":"",tt.clearcoatMap?"#define USE_CLEARCOATMAP":"",tt.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",tt.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",tt.iridescence?"#define USE_IRIDESCENCE":"",tt.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",tt.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",tt.specularMap?"#define USE_SPECULARMAP":"",tt.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",tt.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",tt.roughnessMap?"#define USE_ROUGHNESSMAP":"",tt.metalnessMap?"#define USE_METALNESSMAP":"",tt.alphaMap?"#define USE_ALPHAMAP":"",tt.alphaTest?"#define USE_ALPHATEST":"",tt.sheen?"#define USE_SHEEN":"",tt.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",tt.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",tt.transmission?"#define USE_TRANSMISSION":"",tt.transmissionMap?"#define USE_TRANSMISSIONMAP":"",tt.thicknessMap?"#define USE_THICKNESSMAP":"",tt.vertexTangents?"#define USE_TANGENT":"",tt.vertexColors||tt.instancingColor?"#define USE_COLOR":"",tt.vertexAlphas?"#define USE_COLOR_ALPHA":"",tt.vertexUv1s?"#define USE_UV1":"",tt.vertexUv2s?"#define USE_UV2":"",tt.vertexUv3s?"#define USE_UV3":"",tt.pointsUvs?"#define USE_POINTS_UV":"",tt.gradientMap?"#define USE_GRADIENTMAP":"",tt.flatShading?"#define FLAT_SHADED":"",tt.doubleSided?"#define DOUBLE_SIDED":"",tt.flipSided?"#define FLIP_SIDED":"",tt.shadowMapEnabled?"#define USE_SHADOWMAP":"",tt.shadowMapEnabled?"#define "+ht:"",tt.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",tt.useLegacyLights?"#define LEGACY_LIGHTS":"",tt.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",tt.logarithmicDepthBuffer&&tt.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",tt.toneMapping!==NoToneMapping?"#define TONE_MAPPING":"",tt.toneMapping!==NoToneMapping?ShaderChunk.tonemapping_pars_fragment:"",tt.toneMapping!==NoToneMapping?getToneMappingFunction("toneMapping",tt.toneMapping):"",tt.dithering?"#define DITHERING":"",tt.opaque?"#define OPAQUE":"",ShaderChunk.encodings_pars_fragment,getTexelEncodingFunction("linearToOutputTexel",tt.outputColorSpace),tt.useDepthPacking?"#define DEPTH_PACKING "+tt.depthPacking:"",`
`].filter(filterEmptyLine).join(`
`)),lt=resolveIncludes(lt),lt=replaceLightNums(lt,tt),lt=replaceClippingPlaneNums(lt,tt),dt=resolveIncludes(dt),dt=replaceLightNums(dt,tt),dt=replaceClippingPlaneNums(dt,tt),lt=unrollLoops(lt),dt=unrollLoops(dt),tt.isWebGL2&&tt.isRawShaderMaterial!==!0&&(xt=`#version 300 es
`,Pt=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+Pt,Rt=["#define varying in",tt.glslVersion===GLSL3?"":"layout(location = 0) out highp vec4 pc_fragColor;",tt.glslVersion===GLSL3?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+Rt);const Nt=xt+Pt+lt,kt=xt+Rt+dt,Vt=WebGLShader(st,st.VERTEX_SHADER,Nt),Ft=WebGLShader(st,st.FRAGMENT_SHADER,kt);if(st.attachShader(It,Vt),st.attachShader(It,Ft),tt.index0AttributeName!==void 0?st.bindAttribLocation(It,0,tt.index0AttributeName):tt.morphTargets===!0&&st.bindAttribLocation(It,0,"position"),st.linkProgram(It),nt.debug.checkShaderErrors){const Kt=st.getProgramInfoLog(It).trim(),qt=st.getShaderInfoLog(Vt).trim(),pn=st.getShaderInfoLog(Ft).trim();let an=!0,fn=!0;if(st.getProgramParameter(It,st.LINK_STATUS)===!1)if(an=!1,typeof nt.debug.onShaderError=="function")nt.debug.onShaderError(st,It,Vt,Ft);else{const dn=getShaderErrors(st,Vt,"vertex"),Cn=getShaderErrors(st,Ft,"fragment");console.error("THREE.WebGLProgram: Shader Error "+st.getError()+" - VALIDATE_STATUS "+st.getProgramParameter(It,st.VALIDATE_STATUS)+`

Program Info Log: `+Kt+`
`+dn+`
`+Cn)}else Kt!==""?console.warn("THREE.WebGLProgram: Program Info Log:",Kt):(qt===""||pn==="")&&(fn=!1);fn&&(this.diagnostics={runnable:an,programLog:Kt,vertexShader:{log:qt,prefix:Pt},fragmentShader:{log:pn,prefix:Rt}})}st.deleteShader(Vt),st.deleteShader(Ft);let zt;this.getUniforms=function(){return zt===void 0&&(zt=new WebGLUniforms(st,It)),zt};let Yt;return this.getAttributes=function(){return Yt===void 0&&(Yt=fetchAttributeLocations(st,It)),Yt},this.destroy=function(){ot.releaseStatesOfProgram(this),st.deleteProgram(It),this.program=void 0},this.type=tt.shaderType,this.name=tt.shaderName,this.id=programIdCount++,this.cacheKey=_,this.usedTimes=1,this.program=It,this.vertexShader=Vt,this.fragmentShader=Ft,this}let _id=0;class WebGLShaderCache{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(_){const tt=_.vertexShader,ot=_.fragmentShader,st=this._getShaderStage(tt),at=this._getShaderStage(ot),lt=this._getShaderCacheForMaterial(_);return lt.has(st)===!1&&(lt.add(st),st.usedTimes++),lt.has(at)===!1&&(lt.add(at),at.usedTimes++),this}remove(_){const tt=this.materialCache.get(_);for(const ot of tt)ot.usedTimes--,ot.usedTimes===0&&this.shaderCache.delete(ot.code);return this.materialCache.delete(_),this}getVertexShaderID(_){return this._getShaderStage(_.vertexShader).id}getFragmentShaderID(_){return this._getShaderStage(_.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(_){const tt=this.materialCache;let ot=tt.get(_);return ot===void 0&&(ot=new Set,tt.set(_,ot)),ot}_getShaderStage(_){const tt=this.shaderCache;let ot=tt.get(_);return ot===void 0&&(ot=new WebGLShaderStage(_),tt.set(_,ot)),ot}}class WebGLShaderStage{constructor(_){this.id=_id++,this.code=_,this.usedTimes=0}}function WebGLPrograms(nt,_,tt,ot,st,at,lt){const dt=new Layers,ht=new WebGLShaderCache,ft=[],gt=st.isWebGL2,Et=st.logarithmicDepthBuffer,yt=st.vertexTextures;let Ct=st.precision;const wt={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function It(Kt){return Kt===0?"uv":`uv${Kt}`}function Pt(Kt,qt,pn,an,fn){const dn=an.fog,Cn=fn.geometry,On=Kt.isMeshStandardMaterial?an.environment:null,Pn=(Kt.isMeshStandardMaterial?tt:_).get(Kt.envMap||On),yn=Pn&&Pn.mapping===CubeUVReflectionMapping?Pn.image.height:null,An=wt[Kt.type];Kt.precision!==null&&(Ct=st.getMaxPrecision(Kt.precision),Ct!==Kt.precision&&console.warn("THREE.WebGLProgram.getParameters:",Kt.precision,"not supported, using",Ct,"instead."));const Sn=Cn.morphAttributes.position||Cn.morphAttributes.normal||Cn.morphAttributes.color,gn=Sn!==void 0?Sn.length:0;let _n=0;Cn.morphAttributes.position!==void 0&&(_n=1),Cn.morphAttributes.normal!==void 0&&(_n=2),Cn.morphAttributes.color!==void 0&&(_n=3);let Rn,bn,jn,kn;if(An){const Jo=ShaderLib[An];Rn=Jo.vertexShader,bn=Jo.fragmentShader}else Rn=Kt.vertexShader,bn=Kt.fragmentShader,ht.update(Kt),jn=ht.getVertexShaderID(Kt),kn=ht.getFragmentShaderID(Kt);const Gn=nt.getRenderTarget(),Vn=fn.isInstancedMesh===!0,qn=!!Kt.map,Tr=!!Kt.matcap,Mn=!!Pn,Zt=!!Kt.aoMap,wn=!!Kt.lightMap,xn=!!Kt.bumpMap,Hn=!!Kt.normalMap,Bn=!!Kt.displacementMap,cr=!!Kt.emissiveMap,Wn=!!Kt.metalnessMap,rr=!!Kt.roughnessMap,sr=Kt.anisotropy>0,ir=Kt.clearcoat>0,kr=Kt.iridescence>0,un=Kt.sheen>0,sn=Kt.transmission>0,Kn=sr&&!!Kt.anisotropyMap,Sr=ir&&!!Kt.clearcoatMap,lr=ir&&!!Kt.clearcoatNormalMap,vr=ir&&!!Kt.clearcoatRoughnessMap,Fr=kr&&!!Kt.iridescenceMap,Gr=kr&&!!Kt.iridescenceThicknessMap,dr=un&&!!Kt.sheenColorMap,Hr=un&&!!Kt.sheenRoughnessMap,zr=!!Kt.specularMap,Nr=!!Kt.specularColorMap,Or=!!Kt.specularIntensityMap,Ur=sn&&!!Kt.transmissionMap,Zr=sn&&!!Kt.thicknessMap,oo=!!Kt.gradientMap,zn=!!Kt.alphaMap,ar=Kt.alphaTest>0,pr=!!Kt.extensions,Wr=!!Cn.attributes.uv1,Qr=!!Cn.attributes.uv2,ko=!!Cn.attributes.uv3;return{isWebGL2:gt,shaderID:An,shaderType:Kt.type,shaderName:Kt.name,vertexShader:Rn,fragmentShader:bn,defines:Kt.defines,customVertexShaderID:jn,customFragmentShaderID:kn,isRawShaderMaterial:Kt.isRawShaderMaterial===!0,glslVersion:Kt.glslVersion,precision:Ct,instancing:Vn,instancingColor:Vn&&fn.instanceColor!==null,supportsVertexTextures:yt,outputColorSpace:Gn===null?nt.outputColorSpace:Gn.isXRRenderTarget===!0?Gn.texture.colorSpace:LinearSRGBColorSpace$1,map:qn,matcap:Tr,envMap:Mn,envMapMode:Mn&&Pn.mapping,envMapCubeUVHeight:yn,aoMap:Zt,lightMap:wn,bumpMap:xn,normalMap:Hn,displacementMap:yt&&Bn,emissiveMap:cr,normalMapObjectSpace:Hn&&Kt.normalMapType===ObjectSpaceNormalMap,normalMapTangentSpace:Hn&&Kt.normalMapType===TangentSpaceNormalMap,metalnessMap:Wn,roughnessMap:rr,anisotropy:sr,anisotropyMap:Kn,clearcoat:ir,clearcoatMap:Sr,clearcoatNormalMap:lr,clearcoatRoughnessMap:vr,iridescence:kr,iridescenceMap:Fr,iridescenceThicknessMap:Gr,sheen:un,sheenColorMap:dr,sheenRoughnessMap:Hr,specularMap:zr,specularColorMap:Nr,specularIntensityMap:Or,transmission:sn,transmissionMap:Ur,thicknessMap:Zr,gradientMap:oo,opaque:Kt.transparent===!1&&Kt.blending===NormalBlending,alphaMap:zn,alphaTest:ar,combine:Kt.combine,mapUv:qn&&It(Kt.map.channel),aoMapUv:Zt&&It(Kt.aoMap.channel),lightMapUv:wn&&It(Kt.lightMap.channel),bumpMapUv:xn&&It(Kt.bumpMap.channel),normalMapUv:Hn&&It(Kt.normalMap.channel),displacementMapUv:Bn&&It(Kt.displacementMap.channel),emissiveMapUv:cr&&It(Kt.emissiveMap.channel),metalnessMapUv:Wn&&It(Kt.metalnessMap.channel),roughnessMapUv:rr&&It(Kt.roughnessMap.channel),anisotropyMapUv:Kn&&It(Kt.anisotropyMap.channel),clearcoatMapUv:Sr&&It(Kt.clearcoatMap.channel),clearcoatNormalMapUv:lr&&It(Kt.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:vr&&It(Kt.clearcoatRoughnessMap.channel),iridescenceMapUv:Fr&&It(Kt.iridescenceMap.channel),iridescenceThicknessMapUv:Gr&&It(Kt.iridescenceThicknessMap.channel),sheenColorMapUv:dr&&It(Kt.sheenColorMap.channel),sheenRoughnessMapUv:Hr&&It(Kt.sheenRoughnessMap.channel),specularMapUv:zr&&It(Kt.specularMap.channel),specularColorMapUv:Nr&&It(Kt.specularColorMap.channel),specularIntensityMapUv:Or&&It(Kt.specularIntensityMap.channel),transmissionMapUv:Ur&&It(Kt.transmissionMap.channel),thicknessMapUv:Zr&&It(Kt.thicknessMap.channel),alphaMapUv:zn&&It(Kt.alphaMap.channel),vertexTangents:!!Cn.attributes.tangent&&(Hn||sr),vertexColors:Kt.vertexColors,vertexAlphas:Kt.vertexColors===!0&&!!Cn.attributes.color&&Cn.attributes.color.itemSize===4,vertexUv1s:Wr,vertexUv2s:Qr,vertexUv3s:ko,pointsUvs:fn.isPoints===!0&&!!Cn.attributes.uv&&(qn||zn),fog:!!dn,useFog:Kt.fog===!0,fogExp2:dn&&dn.isFogExp2,flatShading:Kt.flatShading===!0,sizeAttenuation:Kt.sizeAttenuation===!0,logarithmicDepthBuffer:Et,skinning:fn.isSkinnedMesh===!0,morphTargets:Cn.morphAttributes.position!==void 0,morphNormals:Cn.morphAttributes.normal!==void 0,morphColors:Cn.morphAttributes.color!==void 0,morphTargetsCount:gn,morphTextureStride:_n,numDirLights:qt.directional.length,numPointLights:qt.point.length,numSpotLights:qt.spot.length,numSpotLightMaps:qt.spotLightMap.length,numRectAreaLights:qt.rectArea.length,numHemiLights:qt.hemi.length,numDirLightShadows:qt.directionalShadowMap.length,numPointLightShadows:qt.pointShadowMap.length,numSpotLightShadows:qt.spotShadowMap.length,numSpotLightShadowsWithMaps:qt.numSpotLightShadowsWithMaps,numClippingPlanes:lt.numPlanes,numClipIntersection:lt.numIntersection,dithering:Kt.dithering,shadowMapEnabled:nt.shadowMap.enabled&&pn.length>0,shadowMapType:nt.shadowMap.type,toneMapping:Kt.toneMapped?nt.toneMapping:NoToneMapping,useLegacyLights:nt.useLegacyLights,premultipliedAlpha:Kt.premultipliedAlpha,doubleSided:Kt.side===DoubleSide,flipSided:Kt.side===BackSide,useDepthPacking:Kt.depthPacking>=0,depthPacking:Kt.depthPacking||0,index0AttributeName:Kt.index0AttributeName,extensionDerivatives:pr&&Kt.extensions.derivatives===!0,extensionFragDepth:pr&&Kt.extensions.fragDepth===!0,extensionDrawBuffers:pr&&Kt.extensions.drawBuffers===!0,extensionShaderTextureLOD:pr&&Kt.extensions.shaderTextureLOD===!0,rendererExtensionFragDepth:gt||ot.has("EXT_frag_depth"),rendererExtensionDrawBuffers:gt||ot.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:gt||ot.has("EXT_shader_texture_lod"),customProgramCacheKey:Kt.customProgramCacheKey()}}function Rt(Kt){const qt=[];if(Kt.shaderID?qt.push(Kt.shaderID):(qt.push(Kt.customVertexShaderID),qt.push(Kt.customFragmentShaderID)),Kt.defines!==void 0)for(const pn in Kt.defines)qt.push(pn),qt.push(Kt.defines[pn]);return Kt.isRawShaderMaterial===!1&&(xt(qt,Kt),Nt(qt,Kt),qt.push(nt.outputColorSpace)),qt.push(Kt.customProgramCacheKey),qt.join()}function xt(Kt,qt){Kt.push(qt.precision),Kt.push(qt.outputColorSpace),Kt.push(qt.envMapMode),Kt.push(qt.envMapCubeUVHeight),Kt.push(qt.mapUv),Kt.push(qt.alphaMapUv),Kt.push(qt.lightMapUv),Kt.push(qt.aoMapUv),Kt.push(qt.bumpMapUv),Kt.push(qt.normalMapUv),Kt.push(qt.displacementMapUv),Kt.push(qt.emissiveMapUv),Kt.push(qt.metalnessMapUv),Kt.push(qt.roughnessMapUv),Kt.push(qt.anisotropyMapUv),Kt.push(qt.clearcoatMapUv),Kt.push(qt.clearcoatNormalMapUv),Kt.push(qt.clearcoatRoughnessMapUv),Kt.push(qt.iridescenceMapUv),Kt.push(qt.iridescenceThicknessMapUv),Kt.push(qt.sheenColorMapUv),Kt.push(qt.sheenRoughnessMapUv),Kt.push(qt.specularMapUv),Kt.push(qt.specularColorMapUv),Kt.push(qt.specularIntensityMapUv),Kt.push(qt.transmissionMapUv),Kt.push(qt.thicknessMapUv),Kt.push(qt.combine),Kt.push(qt.fogExp2),Kt.push(qt.sizeAttenuation),Kt.push(qt.morphTargetsCount),Kt.push(qt.morphAttributeCount),Kt.push(qt.numDirLights),Kt.push(qt.numPointLights),Kt.push(qt.numSpotLights),Kt.push(qt.numSpotLightMaps),Kt.push(qt.numHemiLights),Kt.push(qt.numRectAreaLights),Kt.push(qt.numDirLightShadows),Kt.push(qt.numPointLightShadows),Kt.push(qt.numSpotLightShadows),Kt.push(qt.numSpotLightShadowsWithMaps),Kt.push(qt.shadowMapType),Kt.push(qt.toneMapping),Kt.push(qt.numClippingPlanes),Kt.push(qt.numClipIntersection),Kt.push(qt.depthPacking)}function Nt(Kt,qt){dt.disableAll(),qt.isWebGL2&&dt.enable(0),qt.supportsVertexTextures&&dt.enable(1),qt.instancing&&dt.enable(2),qt.instancingColor&&dt.enable(3),qt.matcap&&dt.enable(4),qt.envMap&&dt.enable(5),qt.normalMapObjectSpace&&dt.enable(6),qt.normalMapTangentSpace&&dt.enable(7),qt.clearcoat&&dt.enable(8),qt.iridescence&&dt.enable(9),qt.alphaTest&&dt.enable(10),qt.vertexColors&&dt.enable(11),qt.vertexAlphas&&dt.enable(12),qt.vertexUv1s&&dt.enable(13),qt.vertexUv2s&&dt.enable(14),qt.vertexUv3s&&dt.enable(15),qt.vertexTangents&&dt.enable(16),qt.anisotropy&&dt.enable(17),Kt.push(dt.mask),dt.disableAll(),qt.fog&&dt.enable(0),qt.useFog&&dt.enable(1),qt.flatShading&&dt.enable(2),qt.logarithmicDepthBuffer&&dt.enable(3),qt.skinning&&dt.enable(4),qt.morphTargets&&dt.enable(5),qt.morphNormals&&dt.enable(6),qt.morphColors&&dt.enable(7),qt.premultipliedAlpha&&dt.enable(8),qt.shadowMapEnabled&&dt.enable(9),qt.useLegacyLights&&dt.enable(10),qt.doubleSided&&dt.enable(11),qt.flipSided&&dt.enable(12),qt.useDepthPacking&&dt.enable(13),qt.dithering&&dt.enable(14),qt.transmission&&dt.enable(15),qt.sheen&&dt.enable(16),qt.opaque&&dt.enable(17),qt.pointsUvs&&dt.enable(18),Kt.push(dt.mask)}function kt(Kt){const qt=wt[Kt.type];let pn;if(qt){const an=ShaderLib[qt];pn=UniformsUtils.clone(an.uniforms)}else pn=Kt.uniforms;return pn}function Vt(Kt,qt){let pn;for(let an=0,fn=ft.length;an<fn;an++){const dn=ft[an];if(dn.cacheKey===qt){pn=dn,++pn.usedTimes;break}}return pn===void 0&&(pn=new WebGLProgram(nt,qt,Kt,at),ft.push(pn)),pn}function Ft(Kt){if(--Kt.usedTimes===0){const qt=ft.indexOf(Kt);ft[qt]=ft[ft.length-1],ft.pop(),Kt.destroy()}}function zt(Kt){ht.remove(Kt)}function Yt(){ht.dispose()}return{getParameters:Pt,getProgramCacheKey:Rt,getUniforms:kt,acquireProgram:Vt,releaseProgram:Ft,releaseShaderCache:zt,programs:ft,dispose:Yt}}function WebGLProperties(){let nt=new WeakMap;function _(at){let lt=nt.get(at);return lt===void 0&&(lt={},nt.set(at,lt)),lt}function tt(at){nt.delete(at)}function ot(at,lt,dt){nt.get(at)[lt]=dt}function st(){nt=new WeakMap}return{get:_,remove:tt,update:ot,dispose:st}}function painterSortStable(nt,_){return nt.groupOrder!==_.groupOrder?nt.groupOrder-_.groupOrder:nt.renderOrder!==_.renderOrder?nt.renderOrder-_.renderOrder:nt.material.id!==_.material.id?nt.material.id-_.material.id:nt.z!==_.z?nt.z-_.z:nt.id-_.id}function reversePainterSortStable(nt,_){return nt.groupOrder!==_.groupOrder?nt.groupOrder-_.groupOrder:nt.renderOrder!==_.renderOrder?nt.renderOrder-_.renderOrder:nt.z!==_.z?_.z-nt.z:nt.id-_.id}function WebGLRenderList(){const nt=[];let _=0;const tt=[],ot=[],st=[];function at(){_=0,tt.length=0,ot.length=0,st.length=0}function lt(Et,yt,Ct,wt,It,Pt){let Rt=nt[_];return Rt===void 0?(Rt={id:Et.id,object:Et,geometry:yt,material:Ct,groupOrder:wt,renderOrder:Et.renderOrder,z:It,group:Pt},nt[_]=Rt):(Rt.id=Et.id,Rt.object=Et,Rt.geometry=yt,Rt.material=Ct,Rt.groupOrder=wt,Rt.renderOrder=Et.renderOrder,Rt.z=It,Rt.group=Pt),_++,Rt}function dt(Et,yt,Ct,wt,It,Pt){const Rt=lt(Et,yt,Ct,wt,It,Pt);Ct.transmission>0?ot.push(Rt):Ct.transparent===!0?st.push(Rt):tt.push(Rt)}function ht(Et,yt,Ct,wt,It,Pt){const Rt=lt(Et,yt,Ct,wt,It,Pt);Ct.transmission>0?ot.unshift(Rt):Ct.transparent===!0?st.unshift(Rt):tt.unshift(Rt)}function ft(Et,yt){tt.length>1&&tt.sort(Et||painterSortStable),ot.length>1&&ot.sort(yt||reversePainterSortStable),st.length>1&&st.sort(yt||reversePainterSortStable)}function gt(){for(let Et=_,yt=nt.length;Et<yt;Et++){const Ct=nt[Et];if(Ct.id===null)break;Ct.id=null,Ct.object=null,Ct.geometry=null,Ct.material=null,Ct.group=null}}return{opaque:tt,transmissive:ot,transparent:st,init:at,push:dt,unshift:ht,finish:gt,sort:ft}}function WebGLRenderLists(){let nt=new WeakMap;function _(ot,st){const at=nt.get(ot);let lt;return at===void 0?(lt=new WebGLRenderList,nt.set(ot,[lt])):st>=at.length?(lt=new WebGLRenderList,at.push(lt)):lt=at[st],lt}function tt(){nt=new WeakMap}return{get:_,dispose:tt}}function UniformsCache(){const nt={};return{get:function(_){if(nt[_.id]!==void 0)return nt[_.id];let tt;switch(_.type){case"DirectionalLight":tt={direction:new Vector3,color:new Color$1};break;case"SpotLight":tt={position:new Vector3,direction:new Vector3,color:new Color$1,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":tt={position:new Vector3,color:new Color$1,distance:0,decay:0};break;case"HemisphereLight":tt={direction:new Vector3,skyColor:new Color$1,groundColor:new Color$1};break;case"RectAreaLight":tt={color:new Color$1,position:new Vector3,halfWidth:new Vector3,halfHeight:new Vector3};break}return nt[_.id]=tt,tt}}}function ShadowUniformsCache(){const nt={};return{get:function(_){if(nt[_.id]!==void 0)return nt[_.id];let tt;switch(_.type){case"DirectionalLight":tt={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Vector2};break;case"SpotLight":tt={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Vector2};break;case"PointLight":tt={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Vector2,shadowCameraNear:1,shadowCameraFar:1e3};break}return nt[_.id]=tt,tt}}}let nextVersion=0;function shadowCastingAndTexturingLightsFirst(nt,_){return(_.castShadow?2:0)-(nt.castShadow?2:0)+(_.map?1:0)-(nt.map?1:0)}function WebGLLights(nt,_){const tt=new UniformsCache,ot=ShadowUniformsCache(),st={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0};for(let gt=0;gt<9;gt++)st.probe.push(new Vector3);const at=new Vector3,lt=new Matrix4,dt=new Matrix4;function ht(gt,Et){let yt=0,Ct=0,wt=0;for(let pn=0;pn<9;pn++)st.probe[pn].set(0,0,0);let It=0,Pt=0,Rt=0,xt=0,Nt=0,kt=0,Vt=0,Ft=0,zt=0,Yt=0;gt.sort(shadowCastingAndTexturingLightsFirst);const Kt=Et===!0?Math.PI:1;for(let pn=0,an=gt.length;pn<an;pn++){const fn=gt[pn],dn=fn.color,Cn=fn.intensity,On=fn.distance,Pn=fn.shadow&&fn.shadow.map?fn.shadow.map.texture:null;if(fn.isAmbientLight)yt+=dn.r*Cn*Kt,Ct+=dn.g*Cn*Kt,wt+=dn.b*Cn*Kt;else if(fn.isLightProbe)for(let yn=0;yn<9;yn++)st.probe[yn].addScaledVector(fn.sh.coefficients[yn],Cn);else if(fn.isDirectionalLight){const yn=tt.get(fn);if(yn.color.copy(fn.color).multiplyScalar(fn.intensity*Kt),fn.castShadow){const An=fn.shadow,Sn=ot.get(fn);Sn.shadowBias=An.bias,Sn.shadowNormalBias=An.normalBias,Sn.shadowRadius=An.radius,Sn.shadowMapSize=An.mapSize,st.directionalShadow[It]=Sn,st.directionalShadowMap[It]=Pn,st.directionalShadowMatrix[It]=fn.shadow.matrix,kt++}st.directional[It]=yn,It++}else if(fn.isSpotLight){const yn=tt.get(fn);yn.position.setFromMatrixPosition(fn.matrixWorld),yn.color.copy(dn).multiplyScalar(Cn*Kt),yn.distance=On,yn.coneCos=Math.cos(fn.angle),yn.penumbraCos=Math.cos(fn.angle*(1-fn.penumbra)),yn.decay=fn.decay,st.spot[Rt]=yn;const An=fn.shadow;if(fn.map&&(st.spotLightMap[zt]=fn.map,zt++,An.updateMatrices(fn),fn.castShadow&&Yt++),st.spotLightMatrix[Rt]=An.matrix,fn.castShadow){const Sn=ot.get(fn);Sn.shadowBias=An.bias,Sn.shadowNormalBias=An.normalBias,Sn.shadowRadius=An.radius,Sn.shadowMapSize=An.mapSize,st.spotShadow[Rt]=Sn,st.spotShadowMap[Rt]=Pn,Ft++}Rt++}else if(fn.isRectAreaLight){const yn=tt.get(fn);yn.color.copy(dn).multiplyScalar(Cn),yn.halfWidth.set(fn.width*.5,0,0),yn.halfHeight.set(0,fn.height*.5,0),st.rectArea[xt]=yn,xt++}else if(fn.isPointLight){const yn=tt.get(fn);if(yn.color.copy(fn.color).multiplyScalar(fn.intensity*Kt),yn.distance=fn.distance,yn.decay=fn.decay,fn.castShadow){const An=fn.shadow,Sn=ot.get(fn);Sn.shadowBias=An.bias,Sn.shadowNormalBias=An.normalBias,Sn.shadowRadius=An.radius,Sn.shadowMapSize=An.mapSize,Sn.shadowCameraNear=An.camera.near,Sn.shadowCameraFar=An.camera.far,st.pointShadow[Pt]=Sn,st.pointShadowMap[Pt]=Pn,st.pointShadowMatrix[Pt]=fn.shadow.matrix,Vt++}st.point[Pt]=yn,Pt++}else if(fn.isHemisphereLight){const yn=tt.get(fn);yn.skyColor.copy(fn.color).multiplyScalar(Cn*Kt),yn.groundColor.copy(fn.groundColor).multiplyScalar(Cn*Kt),st.hemi[Nt]=yn,Nt++}}xt>0&&(_.isWebGL2||nt.has("OES_texture_float_linear")===!0?(st.rectAreaLTC1=UniformsLib.LTC_FLOAT_1,st.rectAreaLTC2=UniformsLib.LTC_FLOAT_2):nt.has("OES_texture_half_float_linear")===!0?(st.rectAreaLTC1=UniformsLib.LTC_HALF_1,st.rectAreaLTC2=UniformsLib.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),st.ambient[0]=yt,st.ambient[1]=Ct,st.ambient[2]=wt;const qt=st.hash;(qt.directionalLength!==It||qt.pointLength!==Pt||qt.spotLength!==Rt||qt.rectAreaLength!==xt||qt.hemiLength!==Nt||qt.numDirectionalShadows!==kt||qt.numPointShadows!==Vt||qt.numSpotShadows!==Ft||qt.numSpotMaps!==zt)&&(st.directional.length=It,st.spot.length=Rt,st.rectArea.length=xt,st.point.length=Pt,st.hemi.length=Nt,st.directionalShadow.length=kt,st.directionalShadowMap.length=kt,st.pointShadow.length=Vt,st.pointShadowMap.length=Vt,st.spotShadow.length=Ft,st.spotShadowMap.length=Ft,st.directionalShadowMatrix.length=kt,st.pointShadowMatrix.length=Vt,st.spotLightMatrix.length=Ft+zt-Yt,st.spotLightMap.length=zt,st.numSpotLightShadowsWithMaps=Yt,qt.directionalLength=It,qt.pointLength=Pt,qt.spotLength=Rt,qt.rectAreaLength=xt,qt.hemiLength=Nt,qt.numDirectionalShadows=kt,qt.numPointShadows=Vt,qt.numSpotShadows=Ft,qt.numSpotMaps=zt,st.version=nextVersion++)}function ft(gt,Et){let yt=0,Ct=0,wt=0,It=0,Pt=0;const Rt=Et.matrixWorldInverse;for(let xt=0,Nt=gt.length;xt<Nt;xt++){const kt=gt[xt];if(kt.isDirectionalLight){const Vt=st.directional[yt];Vt.direction.setFromMatrixPosition(kt.matrixWorld),at.setFromMatrixPosition(kt.target.matrixWorld),Vt.direction.sub(at),Vt.direction.transformDirection(Rt),yt++}else if(kt.isSpotLight){const Vt=st.spot[wt];Vt.position.setFromMatrixPosition(kt.matrixWorld),Vt.position.applyMatrix4(Rt),Vt.direction.setFromMatrixPosition(kt.matrixWorld),at.setFromMatrixPosition(kt.target.matrixWorld),Vt.direction.sub(at),Vt.direction.transformDirection(Rt),wt++}else if(kt.isRectAreaLight){const Vt=st.rectArea[It];Vt.position.setFromMatrixPosition(kt.matrixWorld),Vt.position.applyMatrix4(Rt),dt.identity(),lt.copy(kt.matrixWorld),lt.premultiply(Rt),dt.extractRotation(lt),Vt.halfWidth.set(kt.width*.5,0,0),Vt.halfHeight.set(0,kt.height*.5,0),Vt.halfWidth.applyMatrix4(dt),Vt.halfHeight.applyMatrix4(dt),It++}else if(kt.isPointLight){const Vt=st.point[Ct];Vt.position.setFromMatrixPosition(kt.matrixWorld),Vt.position.applyMatrix4(Rt),Ct++}else if(kt.isHemisphereLight){const Vt=st.hemi[Pt];Vt.direction.setFromMatrixPosition(kt.matrixWorld),Vt.direction.transformDirection(Rt),Pt++}}}return{setup:ht,setupView:ft,state:st}}function WebGLRenderState(nt,_){const tt=new WebGLLights(nt,_),ot=[],st=[];function at(){ot.length=0,st.length=0}function lt(Et){ot.push(Et)}function dt(Et){st.push(Et)}function ht(Et){tt.setup(ot,Et)}function ft(Et){tt.setupView(ot,Et)}return{init:at,state:{lightsArray:ot,shadowsArray:st,lights:tt},setupLights:ht,setupLightsView:ft,pushLight:lt,pushShadow:dt}}function WebGLRenderStates(nt,_){let tt=new WeakMap;function ot(at,lt=0){const dt=tt.get(at);let ht;return dt===void 0?(ht=new WebGLRenderState(nt,_),tt.set(at,[ht])):lt>=dt.length?(ht=new WebGLRenderState(nt,_),dt.push(ht)):ht=dt[lt],ht}function st(){tt=new WeakMap}return{get:ot,dispose:st}}class MeshDepthMaterial extends Material{constructor(_){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=BasicDepthPacking,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(_)}copy(_){return super.copy(_),this.depthPacking=_.depthPacking,this.map=_.map,this.alphaMap=_.alphaMap,this.displacementMap=_.displacementMap,this.displacementScale=_.displacementScale,this.displacementBias=_.displacementBias,this.wireframe=_.wireframe,this.wireframeLinewidth=_.wireframeLinewidth,this}}class MeshDistanceMaterial extends Material{constructor(_){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(_)}copy(_){return super.copy(_),this.map=_.map,this.alphaMap=_.alphaMap,this.displacementMap=_.displacementMap,this.displacementScale=_.displacementScale,this.displacementBias=_.displacementBias,this}}const vertex=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,fragment=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`;function WebGLShadowMap(nt,_,tt){let ot=new Frustum;const st=new Vector2,at=new Vector2,lt=new Vector4,dt=new MeshDepthMaterial({depthPacking:RGBADepthPacking}),ht=new MeshDistanceMaterial,ft={},gt=tt.maxTextureSize,Et={[FrontSide]:BackSide,[BackSide]:FrontSide,[DoubleSide]:DoubleSide},yt=new ShaderMaterial({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new Vector2},radius:{value:4}},vertexShader:vertex,fragmentShader:fragment}),Ct=yt.clone();Ct.defines.HORIZONTAL_PASS=1;const wt=new BufferGeometry;wt.setAttribute("position",new BufferAttribute(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const It=new Mesh(wt,yt),Pt=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=PCFShadowMap;let Rt=this.type;this.render=function(Vt,Ft,zt){if(Pt.enabled===!1||Pt.autoUpdate===!1&&Pt.needsUpdate===!1||Vt.length===0)return;const Yt=nt.getRenderTarget(),Kt=nt.getActiveCubeFace(),qt=nt.getActiveMipmapLevel(),pn=nt.state;pn.setBlending(NoBlending),pn.buffers.color.setClear(1,1,1,1),pn.buffers.depth.setTest(!0),pn.setScissorTest(!1);const an=Rt!==VSMShadowMap&&this.type===VSMShadowMap,fn=Rt===VSMShadowMap&&this.type!==VSMShadowMap;for(let dn=0,Cn=Vt.length;dn<Cn;dn++){const On=Vt[dn],Pn=On.shadow;if(Pn===void 0){console.warn("THREE.WebGLShadowMap:",On,"has no shadow.");continue}if(Pn.autoUpdate===!1&&Pn.needsUpdate===!1)continue;st.copy(Pn.mapSize);const yn=Pn.getFrameExtents();if(st.multiply(yn),at.copy(Pn.mapSize),(st.x>gt||st.y>gt)&&(st.x>gt&&(at.x=Math.floor(gt/yn.x),st.x=at.x*yn.x,Pn.mapSize.x=at.x),st.y>gt&&(at.y=Math.floor(gt/yn.y),st.y=at.y*yn.y,Pn.mapSize.y=at.y)),Pn.map===null||an===!0||fn===!0){const Sn=this.type!==VSMShadowMap?{minFilter:NearestFilter,magFilter:NearestFilter}:{};Pn.map!==null&&Pn.map.dispose(),Pn.map=new WebGLRenderTarget(st.x,st.y,Sn),Pn.map.texture.name=On.name+".shadowMap",Pn.camera.updateProjectionMatrix()}nt.setRenderTarget(Pn.map),nt.clear();const An=Pn.getViewportCount();for(let Sn=0;Sn<An;Sn++){const gn=Pn.getViewport(Sn);lt.set(at.x*gn.x,at.y*gn.y,at.x*gn.z,at.y*gn.w),pn.viewport(lt),Pn.updateMatrices(On,Sn),ot=Pn.getFrustum(),kt(Ft,zt,Pn.camera,On,this.type)}Pn.isPointLightShadow!==!0&&this.type===VSMShadowMap&&xt(Pn,zt),Pn.needsUpdate=!1}Rt=this.type,Pt.needsUpdate=!1,nt.setRenderTarget(Yt,Kt,qt)};function xt(Vt,Ft){const zt=_.update(It);yt.defines.VSM_SAMPLES!==Vt.blurSamples&&(yt.defines.VSM_SAMPLES=Vt.blurSamples,Ct.defines.VSM_SAMPLES=Vt.blurSamples,yt.needsUpdate=!0,Ct.needsUpdate=!0),Vt.mapPass===null&&(Vt.mapPass=new WebGLRenderTarget(st.x,st.y)),yt.uniforms.shadow_pass.value=Vt.map.texture,yt.uniforms.resolution.value=Vt.mapSize,yt.uniforms.radius.value=Vt.radius,nt.setRenderTarget(Vt.mapPass),nt.clear(),nt.renderBufferDirect(Ft,null,zt,yt,It,null),Ct.uniforms.shadow_pass.value=Vt.mapPass.texture,Ct.uniforms.resolution.value=Vt.mapSize,Ct.uniforms.radius.value=Vt.radius,nt.setRenderTarget(Vt.map),nt.clear(),nt.renderBufferDirect(Ft,null,zt,Ct,It,null)}function Nt(Vt,Ft,zt,Yt){let Kt=null;const qt=zt.isPointLight===!0?Vt.customDistanceMaterial:Vt.customDepthMaterial;if(qt!==void 0)Kt=qt;else if(Kt=zt.isPointLight===!0?ht:dt,nt.localClippingEnabled&&Ft.clipShadows===!0&&Array.isArray(Ft.clippingPlanes)&&Ft.clippingPlanes.length!==0||Ft.displacementMap&&Ft.displacementScale!==0||Ft.alphaMap&&Ft.alphaTest>0||Ft.map&&Ft.alphaTest>0){const pn=Kt.uuid,an=Ft.uuid;let fn=ft[pn];fn===void 0&&(fn={},ft[pn]=fn);let dn=fn[an];dn===void 0&&(dn=Kt.clone(),fn[an]=dn),Kt=dn}if(Kt.visible=Ft.visible,Kt.wireframe=Ft.wireframe,Yt===VSMShadowMap?Kt.side=Ft.shadowSide!==null?Ft.shadowSide:Ft.side:Kt.side=Ft.shadowSide!==null?Ft.shadowSide:Et[Ft.side],Kt.alphaMap=Ft.alphaMap,Kt.alphaTest=Ft.alphaTest,Kt.map=Ft.map,Kt.clipShadows=Ft.clipShadows,Kt.clippingPlanes=Ft.clippingPlanes,Kt.clipIntersection=Ft.clipIntersection,Kt.displacementMap=Ft.displacementMap,Kt.displacementScale=Ft.displacementScale,Kt.displacementBias=Ft.displacementBias,Kt.wireframeLinewidth=Ft.wireframeLinewidth,Kt.linewidth=Ft.linewidth,zt.isPointLight===!0&&Kt.isMeshDistanceMaterial===!0){const pn=nt.properties.get(Kt);pn.light=zt}return Kt}function kt(Vt,Ft,zt,Yt,Kt){if(Vt.visible===!1)return;if(Vt.layers.test(Ft.layers)&&(Vt.isMesh||Vt.isLine||Vt.isPoints)&&(Vt.castShadow||Vt.receiveShadow&&Kt===VSMShadowMap)&&(!Vt.frustumCulled||ot.intersectsObject(Vt))){Vt.modelViewMatrix.multiplyMatrices(zt.matrixWorldInverse,Vt.matrixWorld);const an=_.update(Vt),fn=Vt.material;if(Array.isArray(fn)){const dn=an.groups;for(let Cn=0,On=dn.length;Cn<On;Cn++){const Pn=dn[Cn],yn=fn[Pn.materialIndex];if(yn&&yn.visible){const An=Nt(Vt,yn,Yt,Kt);nt.renderBufferDirect(zt,null,an,An,Vt,Pn)}}}else if(fn.visible){const dn=Nt(Vt,fn,Yt,Kt);nt.renderBufferDirect(zt,null,an,dn,Vt,null)}}const pn=Vt.children;for(let an=0,fn=pn.length;an<fn;an++)kt(pn[an],Ft,zt,Yt,Kt)}}function WebGLState(nt,_,tt){const ot=tt.isWebGL2;function st(){let zn=!1;const ar=new Vector4;let pr=null;const Wr=new Vector4(0,0,0,0);return{setMask:function(Qr){pr!==Qr&&!zn&&(nt.colorMask(Qr,Qr,Qr,Qr),pr=Qr)},setLocked:function(Qr){zn=Qr},setClear:function(Qr,ko,os,Jo,ws){ws===!0&&(Qr*=Jo,ko*=Jo,os*=Jo),ar.set(Qr,ko,os,Jo),Wr.equals(ar)===!1&&(nt.clearColor(Qr,ko,os,Jo),Wr.copy(ar))},reset:function(){zn=!1,pr=null,Wr.set(-1,0,0,0)}}}function at(){let zn=!1,ar=null,pr=null,Wr=null;return{setTest:function(Qr){Qr?Gn(nt.DEPTH_TEST):Vn(nt.DEPTH_TEST)},setMask:function(Qr){ar!==Qr&&!zn&&(nt.depthMask(Qr),ar=Qr)},setFunc:function(Qr){if(pr!==Qr){switch(Qr){case NeverDepth:nt.depthFunc(nt.NEVER);break;case AlwaysDepth:nt.depthFunc(nt.ALWAYS);break;case LessDepth:nt.depthFunc(nt.LESS);break;case LessEqualDepth:nt.depthFunc(nt.LEQUAL);break;case EqualDepth:nt.depthFunc(nt.EQUAL);break;case GreaterEqualDepth:nt.depthFunc(nt.GEQUAL);break;case GreaterDepth:nt.depthFunc(nt.GREATER);break;case NotEqualDepth:nt.depthFunc(nt.NOTEQUAL);break;default:nt.depthFunc(nt.LEQUAL)}pr=Qr}},setLocked:function(Qr){zn=Qr},setClear:function(Qr){Wr!==Qr&&(nt.clearDepth(Qr),Wr=Qr)},reset:function(){zn=!1,ar=null,pr=null,Wr=null}}}function lt(){let zn=!1,ar=null,pr=null,Wr=null,Qr=null,ko=null,os=null,Jo=null,ws=null;return{setTest:function(Ms){zn||(Ms?Gn(nt.STENCIL_TEST):Vn(nt.STENCIL_TEST))},setMask:function(Ms){ar!==Ms&&!zn&&(nt.stencilMask(Ms),ar=Ms)},setFunc:function(Ms,ys,bo){(pr!==Ms||Wr!==ys||Qr!==bo)&&(nt.stencilFunc(Ms,ys,bo),pr=Ms,Wr=ys,Qr=bo)},setOp:function(Ms,ys,bo){(ko!==Ms||os!==ys||Jo!==bo)&&(nt.stencilOp(Ms,ys,bo),ko=Ms,os=ys,Jo=bo)},setLocked:function(Ms){zn=Ms},setClear:function(Ms){ws!==Ms&&(nt.clearStencil(Ms),ws=Ms)},reset:function(){zn=!1,ar=null,pr=null,Wr=null,Qr=null,ko=null,os=null,Jo=null,ws=null}}}const dt=new st,ht=new at,ft=new lt,gt=new WeakMap,Et=new WeakMap;let yt={},Ct={},wt=new WeakMap,It=[],Pt=null,Rt=!1,xt=null,Nt=null,kt=null,Vt=null,Ft=null,zt=null,Yt=null,Kt=!1,qt=null,pn=null,an=null,fn=null,dn=null;const Cn=nt.getParameter(nt.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let On=!1,Pn=0;const yn=nt.getParameter(nt.VERSION);yn.indexOf("WebGL")!==-1?(Pn=parseFloat(/^WebGL (\d)/.exec(yn)[1]),On=Pn>=1):yn.indexOf("OpenGL ES")!==-1&&(Pn=parseFloat(/^OpenGL ES (\d)/.exec(yn)[1]),On=Pn>=2);let An=null,Sn={};const gn=nt.getParameter(nt.SCISSOR_BOX),_n=nt.getParameter(nt.VIEWPORT),Rn=new Vector4().fromArray(gn),bn=new Vector4().fromArray(_n);function jn(zn,ar,pr,Wr){const Qr=new Uint8Array(4),ko=nt.createTexture();nt.bindTexture(zn,ko),nt.texParameteri(zn,nt.TEXTURE_MIN_FILTER,nt.NEAREST),nt.texParameteri(zn,nt.TEXTURE_MAG_FILTER,nt.NEAREST);for(let os=0;os<pr;os++)ot&&(zn===nt.TEXTURE_3D||zn===nt.TEXTURE_2D_ARRAY)?nt.texImage3D(ar,0,nt.RGBA,1,1,Wr,0,nt.RGBA,nt.UNSIGNED_BYTE,Qr):nt.texImage2D(ar+os,0,nt.RGBA,1,1,0,nt.RGBA,nt.UNSIGNED_BYTE,Qr);return ko}const kn={};kn[nt.TEXTURE_2D]=jn(nt.TEXTURE_2D,nt.TEXTURE_2D,1),kn[nt.TEXTURE_CUBE_MAP]=jn(nt.TEXTURE_CUBE_MAP,nt.TEXTURE_CUBE_MAP_POSITIVE_X,6),ot&&(kn[nt.TEXTURE_2D_ARRAY]=jn(nt.TEXTURE_2D_ARRAY,nt.TEXTURE_2D_ARRAY,1,1),kn[nt.TEXTURE_3D]=jn(nt.TEXTURE_3D,nt.TEXTURE_3D,1,1)),dt.setClear(0,0,0,1),ht.setClear(1),ft.setClear(0),Gn(nt.DEPTH_TEST),ht.setFunc(LessEqualDepth),Bn(!1),cr(CullFaceBack),Gn(nt.CULL_FACE),xn(NoBlending);function Gn(zn){yt[zn]!==!0&&(nt.enable(zn),yt[zn]=!0)}function Vn(zn){yt[zn]!==!1&&(nt.disable(zn),yt[zn]=!1)}function qn(zn,ar){return Ct[zn]!==ar?(nt.bindFramebuffer(zn,ar),Ct[zn]=ar,ot&&(zn===nt.DRAW_FRAMEBUFFER&&(Ct[nt.FRAMEBUFFER]=ar),zn===nt.FRAMEBUFFER&&(Ct[nt.DRAW_FRAMEBUFFER]=ar)),!0):!1}function Tr(zn,ar){let pr=It,Wr=!1;if(zn)if(pr=wt.get(ar),pr===void 0&&(pr=[],wt.set(ar,pr)),zn.isWebGLMultipleRenderTargets){const Qr=zn.texture;if(pr.length!==Qr.length||pr[0]!==nt.COLOR_ATTACHMENT0){for(let ko=0,os=Qr.length;ko<os;ko++)pr[ko]=nt.COLOR_ATTACHMENT0+ko;pr.length=Qr.length,Wr=!0}}else pr[0]!==nt.COLOR_ATTACHMENT0&&(pr[0]=nt.COLOR_ATTACHMENT0,Wr=!0);else pr[0]!==nt.BACK&&(pr[0]=nt.BACK,Wr=!0);Wr&&(tt.isWebGL2?nt.drawBuffers(pr):_.get("WEBGL_draw_buffers").drawBuffersWEBGL(pr))}function Mn(zn){return Pt!==zn?(nt.useProgram(zn),Pt=zn,!0):!1}const Zt={[AddEquation]:nt.FUNC_ADD,[SubtractEquation]:nt.FUNC_SUBTRACT,[ReverseSubtractEquation]:nt.FUNC_REVERSE_SUBTRACT};if(ot)Zt[MinEquation]=nt.MIN,Zt[MaxEquation]=nt.MAX;else{const zn=_.get("EXT_blend_minmax");zn!==null&&(Zt[MinEquation]=zn.MIN_EXT,Zt[MaxEquation]=zn.MAX_EXT)}const wn={[ZeroFactor]:nt.ZERO,[OneFactor]:nt.ONE,[SrcColorFactor]:nt.SRC_COLOR,[SrcAlphaFactor]:nt.SRC_ALPHA,[SrcAlphaSaturateFactor]:nt.SRC_ALPHA_SATURATE,[DstColorFactor]:nt.DST_COLOR,[DstAlphaFactor]:nt.DST_ALPHA,[OneMinusSrcColorFactor]:nt.ONE_MINUS_SRC_COLOR,[OneMinusSrcAlphaFactor]:nt.ONE_MINUS_SRC_ALPHA,[OneMinusDstColorFactor]:nt.ONE_MINUS_DST_COLOR,[OneMinusDstAlphaFactor]:nt.ONE_MINUS_DST_ALPHA};function xn(zn,ar,pr,Wr,Qr,ko,os,Jo){if(zn===NoBlending){Rt===!0&&(Vn(nt.BLEND),Rt=!1);return}if(Rt===!1&&(Gn(nt.BLEND),Rt=!0),zn!==CustomBlending){if(zn!==xt||Jo!==Kt){if((Nt!==AddEquation||Ft!==AddEquation)&&(nt.blendEquation(nt.FUNC_ADD),Nt=AddEquation,Ft=AddEquation),Jo)switch(zn){case NormalBlending:nt.blendFuncSeparate(nt.ONE,nt.ONE_MINUS_SRC_ALPHA,nt.ONE,nt.ONE_MINUS_SRC_ALPHA);break;case AdditiveBlending:nt.blendFunc(nt.ONE,nt.ONE);break;case SubtractiveBlending:nt.blendFuncSeparate(nt.ZERO,nt.ONE_MINUS_SRC_COLOR,nt.ZERO,nt.ONE);break;case MultiplyBlending:nt.blendFuncSeparate(nt.ZERO,nt.SRC_COLOR,nt.ZERO,nt.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",zn);break}else switch(zn){case NormalBlending:nt.blendFuncSeparate(nt.SRC_ALPHA,nt.ONE_MINUS_SRC_ALPHA,nt.ONE,nt.ONE_MINUS_SRC_ALPHA);break;case AdditiveBlending:nt.blendFunc(nt.SRC_ALPHA,nt.ONE);break;case SubtractiveBlending:nt.blendFuncSeparate(nt.ZERO,nt.ONE_MINUS_SRC_COLOR,nt.ZERO,nt.ONE);break;case MultiplyBlending:nt.blendFunc(nt.ZERO,nt.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",zn);break}kt=null,Vt=null,zt=null,Yt=null,xt=zn,Kt=Jo}return}Qr=Qr||ar,ko=ko||pr,os=os||Wr,(ar!==Nt||Qr!==Ft)&&(nt.blendEquationSeparate(Zt[ar],Zt[Qr]),Nt=ar,Ft=Qr),(pr!==kt||Wr!==Vt||ko!==zt||os!==Yt)&&(nt.blendFuncSeparate(wn[pr],wn[Wr],wn[ko],wn[os]),kt=pr,Vt=Wr,zt=ko,Yt=os),xt=zn,Kt=!1}function Hn(zn,ar){zn.side===DoubleSide?Vn(nt.CULL_FACE):Gn(nt.CULL_FACE);let pr=zn.side===BackSide;ar&&(pr=!pr),Bn(pr),zn.blending===NormalBlending&&zn.transparent===!1?xn(NoBlending):xn(zn.blending,zn.blendEquation,zn.blendSrc,zn.blendDst,zn.blendEquationAlpha,zn.blendSrcAlpha,zn.blendDstAlpha,zn.premultipliedAlpha),ht.setFunc(zn.depthFunc),ht.setTest(zn.depthTest),ht.setMask(zn.depthWrite),dt.setMask(zn.colorWrite);const Wr=zn.stencilWrite;ft.setTest(Wr),Wr&&(ft.setMask(zn.stencilWriteMask),ft.setFunc(zn.stencilFunc,zn.stencilRef,zn.stencilFuncMask),ft.setOp(zn.stencilFail,zn.stencilZFail,zn.stencilZPass)),rr(zn.polygonOffset,zn.polygonOffsetFactor,zn.polygonOffsetUnits),zn.alphaToCoverage===!0?Gn(nt.SAMPLE_ALPHA_TO_COVERAGE):Vn(nt.SAMPLE_ALPHA_TO_COVERAGE)}function Bn(zn){qt!==zn&&(zn?nt.frontFace(nt.CW):nt.frontFace(nt.CCW),qt=zn)}function cr(zn){zn!==CullFaceNone?(Gn(nt.CULL_FACE),zn!==pn&&(zn===CullFaceBack?nt.cullFace(nt.BACK):zn===CullFaceFront?nt.cullFace(nt.FRONT):nt.cullFace(nt.FRONT_AND_BACK))):Vn(nt.CULL_FACE),pn=zn}function Wn(zn){zn!==an&&(On&&nt.lineWidth(zn),an=zn)}function rr(zn,ar,pr){zn?(Gn(nt.POLYGON_OFFSET_FILL),(fn!==ar||dn!==pr)&&(nt.polygonOffset(ar,pr),fn=ar,dn=pr)):Vn(nt.POLYGON_OFFSET_FILL)}function sr(zn){zn?Gn(nt.SCISSOR_TEST):Vn(nt.SCISSOR_TEST)}function ir(zn){zn===void 0&&(zn=nt.TEXTURE0+Cn-1),An!==zn&&(nt.activeTexture(zn),An=zn)}function kr(zn,ar,pr){pr===void 0&&(An===null?pr=nt.TEXTURE0+Cn-1:pr=An);let Wr=Sn[pr];Wr===void 0&&(Wr={type:void 0,texture:void 0},Sn[pr]=Wr),(Wr.type!==zn||Wr.texture!==ar)&&(An!==pr&&(nt.activeTexture(pr),An=pr),nt.bindTexture(zn,ar||kn[zn]),Wr.type=zn,Wr.texture=ar)}function un(){const zn=Sn[An];zn!==void 0&&zn.type!==void 0&&(nt.bindTexture(zn.type,null),zn.type=void 0,zn.texture=void 0)}function sn(){try{nt.compressedTexImage2D.apply(nt,arguments)}catch(zn){console.error("THREE.WebGLState:",zn)}}function Kn(){try{nt.compressedTexImage3D.apply(nt,arguments)}catch(zn){console.error("THREE.WebGLState:",zn)}}function Sr(){try{nt.texSubImage2D.apply(nt,arguments)}catch(zn){console.error("THREE.WebGLState:",zn)}}function lr(){try{nt.texSubImage3D.apply(nt,arguments)}catch(zn){console.error("THREE.WebGLState:",zn)}}function vr(){try{nt.compressedTexSubImage2D.apply(nt,arguments)}catch(zn){console.error("THREE.WebGLState:",zn)}}function Fr(){try{nt.compressedTexSubImage3D.apply(nt,arguments)}catch(zn){console.error("THREE.WebGLState:",zn)}}function Gr(){try{nt.texStorage2D.apply(nt,arguments)}catch(zn){console.error("THREE.WebGLState:",zn)}}function dr(){try{nt.texStorage3D.apply(nt,arguments)}catch(zn){console.error("THREE.WebGLState:",zn)}}function Hr(){try{nt.texImage2D.apply(nt,arguments)}catch(zn){console.error("THREE.WebGLState:",zn)}}function zr(){try{nt.texImage3D.apply(nt,arguments)}catch(zn){console.error("THREE.WebGLState:",zn)}}function Nr(zn){Rn.equals(zn)===!1&&(nt.scissor(zn.x,zn.y,zn.z,zn.w),Rn.copy(zn))}function Or(zn){bn.equals(zn)===!1&&(nt.viewport(zn.x,zn.y,zn.z,zn.w),bn.copy(zn))}function Ur(zn,ar){let pr=Et.get(ar);pr===void 0&&(pr=new WeakMap,Et.set(ar,pr));let Wr=pr.get(zn);Wr===void 0&&(Wr=nt.getUniformBlockIndex(ar,zn.name),pr.set(zn,Wr))}function Zr(zn,ar){const Wr=Et.get(ar).get(zn);gt.get(ar)!==Wr&&(nt.uniformBlockBinding(ar,Wr,zn.__bindingPointIndex),gt.set(ar,Wr))}function oo(){nt.disable(nt.BLEND),nt.disable(nt.CULL_FACE),nt.disable(nt.DEPTH_TEST),nt.disable(nt.POLYGON_OFFSET_FILL),nt.disable(nt.SCISSOR_TEST),nt.disable(nt.STENCIL_TEST),nt.disable(nt.SAMPLE_ALPHA_TO_COVERAGE),nt.blendEquation(nt.FUNC_ADD),nt.blendFunc(nt.ONE,nt.ZERO),nt.blendFuncSeparate(nt.ONE,nt.ZERO,nt.ONE,nt.ZERO),nt.colorMask(!0,!0,!0,!0),nt.clearColor(0,0,0,0),nt.depthMask(!0),nt.depthFunc(nt.LESS),nt.clearDepth(1),nt.stencilMask(4294967295),nt.stencilFunc(nt.ALWAYS,0,4294967295),nt.stencilOp(nt.KEEP,nt.KEEP,nt.KEEP),nt.clearStencil(0),nt.cullFace(nt.BACK),nt.frontFace(nt.CCW),nt.polygonOffset(0,0),nt.activeTexture(nt.TEXTURE0),nt.bindFramebuffer(nt.FRAMEBUFFER,null),ot===!0&&(nt.bindFramebuffer(nt.DRAW_FRAMEBUFFER,null),nt.bindFramebuffer(nt.READ_FRAMEBUFFER,null)),nt.useProgram(null),nt.lineWidth(1),nt.scissor(0,0,nt.canvas.width,nt.canvas.height),nt.viewport(0,0,nt.canvas.width,nt.canvas.height),yt={},An=null,Sn={},Ct={},wt=new WeakMap,It=[],Pt=null,Rt=!1,xt=null,Nt=null,kt=null,Vt=null,Ft=null,zt=null,Yt=null,Kt=!1,qt=null,pn=null,an=null,fn=null,dn=null,Rn.set(0,0,nt.canvas.width,nt.canvas.height),bn.set(0,0,nt.canvas.width,nt.canvas.height),dt.reset(),ht.reset(),ft.reset()}return{buffers:{color:dt,depth:ht,stencil:ft},enable:Gn,disable:Vn,bindFramebuffer:qn,drawBuffers:Tr,useProgram:Mn,setBlending:xn,setMaterial:Hn,setFlipSided:Bn,setCullFace:cr,setLineWidth:Wn,setPolygonOffset:rr,setScissorTest:sr,activeTexture:ir,bindTexture:kr,unbindTexture:un,compressedTexImage2D:sn,compressedTexImage3D:Kn,texImage2D:Hr,texImage3D:zr,updateUBOMapping:Ur,uniformBlockBinding:Zr,texStorage2D:Gr,texStorage3D:dr,texSubImage2D:Sr,texSubImage3D:lr,compressedTexSubImage2D:vr,compressedTexSubImage3D:Fr,scissor:Nr,viewport:Or,reset:oo}}function WebGLTextures(nt,_,tt,ot,st,at,lt){const dt=st.isWebGL2,ht=st.maxTextures,ft=st.maxCubemapSize,gt=st.maxTextureSize,Et=st.maxSamples,yt=_.has("WEBGL_multisampled_render_to_texture")?_.get("WEBGL_multisampled_render_to_texture"):null,Ct=typeof navigator>"u"?!1:/OculusBrowser/g.test(navigator.userAgent),wt=new WeakMap;let It;const Pt=new WeakMap;let Rt=!1;try{Rt=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function xt(un,sn){return Rt?new OffscreenCanvas(un,sn):createElementNS("canvas")}function Nt(un,sn,Kn,Sr){let lr=1;if((un.width>Sr||un.height>Sr)&&(lr=Sr/Math.max(un.width,un.height)),lr<1||sn===!0)if(typeof HTMLImageElement<"u"&&un instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&un instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&un instanceof ImageBitmap){const vr=sn?floorPowerOfTwo:Math.floor,Fr=vr(lr*un.width),Gr=vr(lr*un.height);It===void 0&&(It=xt(Fr,Gr));const dr=Kn?xt(Fr,Gr):It;return dr.width=Fr,dr.height=Gr,dr.getContext("2d").drawImage(un,0,0,Fr,Gr),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+un.width+"x"+un.height+") to ("+Fr+"x"+Gr+")."),dr}else return"data"in un&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+un.width+"x"+un.height+")."),un;return un}function kt(un){return isPowerOfTwo(un.width)&&isPowerOfTwo(un.height)}function Vt(un){return dt?!1:un.wrapS!==ClampToEdgeWrapping||un.wrapT!==ClampToEdgeWrapping||un.minFilter!==NearestFilter&&un.minFilter!==LinearFilter}function Ft(un,sn){return un.generateMipmaps&&sn&&un.minFilter!==NearestFilter&&un.minFilter!==LinearFilter}function zt(un){nt.generateMipmap(un)}function Yt(un,sn,Kn,Sr,lr=!1){if(dt===!1)return sn;if(un!==null){if(nt[un]!==void 0)return nt[un];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+un+"'")}let vr=sn;return sn===nt.RED&&(Kn===nt.FLOAT&&(vr=nt.R32F),Kn===nt.HALF_FLOAT&&(vr=nt.R16F),Kn===nt.UNSIGNED_BYTE&&(vr=nt.R8)),sn===nt.RG&&(Kn===nt.FLOAT&&(vr=nt.RG32F),Kn===nt.HALF_FLOAT&&(vr=nt.RG16F),Kn===nt.UNSIGNED_BYTE&&(vr=nt.RG8)),sn===nt.RGBA&&(Kn===nt.FLOAT&&(vr=nt.RGBA32F),Kn===nt.HALF_FLOAT&&(vr=nt.RGBA16F),Kn===nt.UNSIGNED_BYTE&&(vr=Sr===SRGBColorSpace$1&&lr===!1?nt.SRGB8_ALPHA8:nt.RGBA8),Kn===nt.UNSIGNED_SHORT_4_4_4_4&&(vr=nt.RGBA4),Kn===nt.UNSIGNED_SHORT_5_5_5_1&&(vr=nt.RGB5_A1)),(vr===nt.R16F||vr===nt.R32F||vr===nt.RG16F||vr===nt.RG32F||vr===nt.RGBA16F||vr===nt.RGBA32F)&&_.get("EXT_color_buffer_float"),vr}function Kt(un,sn,Kn){return Ft(un,Kn)===!0||un.isFramebufferTexture&&un.minFilter!==NearestFilter&&un.minFilter!==LinearFilter?Math.log2(Math.max(sn.width,sn.height))+1:un.mipmaps!==void 0&&un.mipmaps.length>0?un.mipmaps.length:un.isCompressedTexture&&Array.isArray(un.image)?sn.mipmaps.length:1}function qt(un){return un===NearestFilter||un===NearestMipmapNearestFilter||un===NearestMipmapLinearFilter?nt.NEAREST:nt.LINEAR}function pn(un){const sn=un.target;sn.removeEventListener("dispose",pn),fn(sn),sn.isVideoTexture&&wt.delete(sn)}function an(un){const sn=un.target;sn.removeEventListener("dispose",an),Cn(sn)}function fn(un){const sn=ot.get(un);if(sn.__webglInit===void 0)return;const Kn=un.source,Sr=Pt.get(Kn);if(Sr){const lr=Sr[sn.__cacheKey];lr.usedTimes--,lr.usedTimes===0&&dn(un),Object.keys(Sr).length===0&&Pt.delete(Kn)}ot.remove(un)}function dn(un){const sn=ot.get(un);nt.deleteTexture(sn.__webglTexture);const Kn=un.source,Sr=Pt.get(Kn);delete Sr[sn.__cacheKey],lt.memory.textures--}function Cn(un){const sn=un.texture,Kn=ot.get(un),Sr=ot.get(sn);if(Sr.__webglTexture!==void 0&&(nt.deleteTexture(Sr.__webglTexture),lt.memory.textures--),un.depthTexture&&un.depthTexture.dispose(),un.isWebGLCubeRenderTarget)for(let lr=0;lr<6;lr++)nt.deleteFramebuffer(Kn.__webglFramebuffer[lr]),Kn.__webglDepthbuffer&&nt.deleteRenderbuffer(Kn.__webglDepthbuffer[lr]);else{if(nt.deleteFramebuffer(Kn.__webglFramebuffer),Kn.__webglDepthbuffer&&nt.deleteRenderbuffer(Kn.__webglDepthbuffer),Kn.__webglMultisampledFramebuffer&&nt.deleteFramebuffer(Kn.__webglMultisampledFramebuffer),Kn.__webglColorRenderbuffer)for(let lr=0;lr<Kn.__webglColorRenderbuffer.length;lr++)Kn.__webglColorRenderbuffer[lr]&&nt.deleteRenderbuffer(Kn.__webglColorRenderbuffer[lr]);Kn.__webglDepthRenderbuffer&&nt.deleteRenderbuffer(Kn.__webglDepthRenderbuffer)}if(un.isWebGLMultipleRenderTargets)for(let lr=0,vr=sn.length;lr<vr;lr++){const Fr=ot.get(sn[lr]);Fr.__webglTexture&&(nt.deleteTexture(Fr.__webglTexture),lt.memory.textures--),ot.remove(sn[lr])}ot.remove(sn),ot.remove(un)}let On=0;function Pn(){On=0}function yn(){const un=On;return un>=ht&&console.warn("THREE.WebGLTextures: Trying to use "+un+" texture units while this GPU supports only "+ht),On+=1,un}function An(un){const sn=[];return sn.push(un.wrapS),sn.push(un.wrapT),sn.push(un.wrapR||0),sn.push(un.magFilter),sn.push(un.minFilter),sn.push(un.anisotropy),sn.push(un.internalFormat),sn.push(un.format),sn.push(un.type),sn.push(un.generateMipmaps),sn.push(un.premultiplyAlpha),sn.push(un.flipY),sn.push(un.unpackAlignment),sn.push(un.colorSpace),sn.join()}function Sn(un,sn){const Kn=ot.get(un);if(un.isVideoTexture&&ir(un),un.isRenderTargetTexture===!1&&un.version>0&&Kn.__version!==un.version){const Sr=un.image;if(Sr===null)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else if(Sr.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{qn(Kn,un,sn);return}}tt.bindTexture(nt.TEXTURE_2D,Kn.__webglTexture,nt.TEXTURE0+sn)}function gn(un,sn){const Kn=ot.get(un);if(un.version>0&&Kn.__version!==un.version){qn(Kn,un,sn);return}tt.bindTexture(nt.TEXTURE_2D_ARRAY,Kn.__webglTexture,nt.TEXTURE0+sn)}function _n(un,sn){const Kn=ot.get(un);if(un.version>0&&Kn.__version!==un.version){qn(Kn,un,sn);return}tt.bindTexture(nt.TEXTURE_3D,Kn.__webglTexture,nt.TEXTURE0+sn)}function Rn(un,sn){const Kn=ot.get(un);if(un.version>0&&Kn.__version!==un.version){Tr(Kn,un,sn);return}tt.bindTexture(nt.TEXTURE_CUBE_MAP,Kn.__webglTexture,nt.TEXTURE0+sn)}const bn={[RepeatWrapping]:nt.REPEAT,[ClampToEdgeWrapping]:nt.CLAMP_TO_EDGE,[MirroredRepeatWrapping]:nt.MIRRORED_REPEAT},jn={[NearestFilter]:nt.NEAREST,[NearestMipmapNearestFilter]:nt.NEAREST_MIPMAP_NEAREST,[NearestMipmapLinearFilter]:nt.NEAREST_MIPMAP_LINEAR,[LinearFilter]:nt.LINEAR,[LinearMipmapNearestFilter]:nt.LINEAR_MIPMAP_NEAREST,[LinearMipmapLinearFilter]:nt.LINEAR_MIPMAP_LINEAR},kn={[NeverCompare]:nt.NEVER,[AlwaysCompare]:nt.ALWAYS,[LessCompare]:nt.LESS,[LessEqualCompare]:nt.LEQUAL,[EqualCompare]:nt.EQUAL,[GreaterEqualCompare]:nt.GEQUAL,[GreaterCompare]:nt.GREATER,[NotEqualCompare]:nt.NOTEQUAL};function Gn(un,sn,Kn){if(Kn?(nt.texParameteri(un,nt.TEXTURE_WRAP_S,bn[sn.wrapS]),nt.texParameteri(un,nt.TEXTURE_WRAP_T,bn[sn.wrapT]),(un===nt.TEXTURE_3D||un===nt.TEXTURE_2D_ARRAY)&&nt.texParameteri(un,nt.TEXTURE_WRAP_R,bn[sn.wrapR]),nt.texParameteri(un,nt.TEXTURE_MAG_FILTER,jn[sn.magFilter]),nt.texParameteri(un,nt.TEXTURE_MIN_FILTER,jn[sn.minFilter])):(nt.texParameteri(un,nt.TEXTURE_WRAP_S,nt.CLAMP_TO_EDGE),nt.texParameteri(un,nt.TEXTURE_WRAP_T,nt.CLAMP_TO_EDGE),(un===nt.TEXTURE_3D||un===nt.TEXTURE_2D_ARRAY)&&nt.texParameteri(un,nt.TEXTURE_WRAP_R,nt.CLAMP_TO_EDGE),(sn.wrapS!==ClampToEdgeWrapping||sn.wrapT!==ClampToEdgeWrapping)&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),nt.texParameteri(un,nt.TEXTURE_MAG_FILTER,qt(sn.magFilter)),nt.texParameteri(un,nt.TEXTURE_MIN_FILTER,qt(sn.minFilter)),sn.minFilter!==NearestFilter&&sn.minFilter!==LinearFilter&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),sn.compareFunction&&(nt.texParameteri(un,nt.TEXTURE_COMPARE_MODE,nt.COMPARE_REF_TO_TEXTURE),nt.texParameteri(un,nt.TEXTURE_COMPARE_FUNC,kn[sn.compareFunction])),_.has("EXT_texture_filter_anisotropic")===!0){const Sr=_.get("EXT_texture_filter_anisotropic");if(sn.magFilter===NearestFilter||sn.minFilter!==NearestMipmapLinearFilter&&sn.minFilter!==LinearMipmapLinearFilter||sn.type===FloatType&&_.has("OES_texture_float_linear")===!1||dt===!1&&sn.type===HalfFloatType&&_.has("OES_texture_half_float_linear")===!1)return;(sn.anisotropy>1||ot.get(sn).__currentAnisotropy)&&(nt.texParameterf(un,Sr.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(sn.anisotropy,st.getMaxAnisotropy())),ot.get(sn).__currentAnisotropy=sn.anisotropy)}}function Vn(un,sn){let Kn=!1;un.__webglInit===void 0&&(un.__webglInit=!0,sn.addEventListener("dispose",pn));const Sr=sn.source;let lr=Pt.get(Sr);lr===void 0&&(lr={},Pt.set(Sr,lr));const vr=An(sn);if(vr!==un.__cacheKey){lr[vr]===void 0&&(lr[vr]={texture:nt.createTexture(),usedTimes:0},lt.memory.textures++,Kn=!0),lr[vr].usedTimes++;const Fr=lr[un.__cacheKey];Fr!==void 0&&(lr[un.__cacheKey].usedTimes--,Fr.usedTimes===0&&dn(sn)),un.__cacheKey=vr,un.__webglTexture=lr[vr].texture}return Kn}function qn(un,sn,Kn){let Sr=nt.TEXTURE_2D;(sn.isDataArrayTexture||sn.isCompressedArrayTexture)&&(Sr=nt.TEXTURE_2D_ARRAY),sn.isData3DTexture&&(Sr=nt.TEXTURE_3D);const lr=Vn(un,sn),vr=sn.source;tt.bindTexture(Sr,un.__webglTexture,nt.TEXTURE0+Kn);const Fr=ot.get(vr);if(vr.version!==Fr.__version||lr===!0){tt.activeTexture(nt.TEXTURE0+Kn),nt.pixelStorei(nt.UNPACK_FLIP_Y_WEBGL,sn.flipY),nt.pixelStorei(nt.UNPACK_PREMULTIPLY_ALPHA_WEBGL,sn.premultiplyAlpha),nt.pixelStorei(nt.UNPACK_ALIGNMENT,sn.unpackAlignment),nt.pixelStorei(nt.UNPACK_COLORSPACE_CONVERSION_WEBGL,nt.NONE);const Gr=Vt(sn)&&kt(sn.image)===!1;let dr=Nt(sn.image,Gr,!1,gt);dr=kr(sn,dr);const Hr=kt(dr)||dt,zr=at.convert(sn.format,sn.colorSpace);let Nr=at.convert(sn.type),Or=Yt(sn.internalFormat,zr,Nr,sn.colorSpace);Gn(Sr,sn,Hr);let Ur;const Zr=sn.mipmaps,oo=dt&&sn.isVideoTexture!==!0,zn=Fr.__version===void 0||lr===!0,ar=Kt(sn,dr,Hr);if(sn.isDepthTexture)Or=nt.DEPTH_COMPONENT,dt?sn.type===FloatType?Or=nt.DEPTH_COMPONENT32F:sn.type===UnsignedIntType?Or=nt.DEPTH_COMPONENT24:sn.type===UnsignedInt248Type?Or=nt.DEPTH24_STENCIL8:Or=nt.DEPTH_COMPONENT16:sn.type===FloatType&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),sn.format===DepthFormat&&Or===nt.DEPTH_COMPONENT&&sn.type!==UnsignedShortType&&sn.type!==UnsignedIntType&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),sn.type=UnsignedIntType,Nr=at.convert(sn.type)),sn.format===DepthStencilFormat&&Or===nt.DEPTH_COMPONENT&&(Or=nt.DEPTH_STENCIL,sn.type!==UnsignedInt248Type&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),sn.type=UnsignedInt248Type,Nr=at.convert(sn.type))),zn&&(oo?tt.texStorage2D(nt.TEXTURE_2D,1,Or,dr.width,dr.height):tt.texImage2D(nt.TEXTURE_2D,0,Or,dr.width,dr.height,0,zr,Nr,null));else if(sn.isDataTexture)if(Zr.length>0&&Hr){oo&&zn&&tt.texStorage2D(nt.TEXTURE_2D,ar,Or,Zr[0].width,Zr[0].height);for(let pr=0,Wr=Zr.length;pr<Wr;pr++)Ur=Zr[pr],oo?tt.texSubImage2D(nt.TEXTURE_2D,pr,0,0,Ur.width,Ur.height,zr,Nr,Ur.data):tt.texImage2D(nt.TEXTURE_2D,pr,Or,Ur.width,Ur.height,0,zr,Nr,Ur.data);sn.generateMipmaps=!1}else oo?(zn&&tt.texStorage2D(nt.TEXTURE_2D,ar,Or,dr.width,dr.height),tt.texSubImage2D(nt.TEXTURE_2D,0,0,0,dr.width,dr.height,zr,Nr,dr.data)):tt.texImage2D(nt.TEXTURE_2D,0,Or,dr.width,dr.height,0,zr,Nr,dr.data);else if(sn.isCompressedTexture)if(sn.isCompressedArrayTexture){oo&&zn&&tt.texStorage3D(nt.TEXTURE_2D_ARRAY,ar,Or,Zr[0].width,Zr[0].height,dr.depth);for(let pr=0,Wr=Zr.length;pr<Wr;pr++)Ur=Zr[pr],sn.format!==RGBAFormat?zr!==null?oo?tt.compressedTexSubImage3D(nt.TEXTURE_2D_ARRAY,pr,0,0,0,Ur.width,Ur.height,dr.depth,zr,Ur.data,0,0):tt.compressedTexImage3D(nt.TEXTURE_2D_ARRAY,pr,Or,Ur.width,Ur.height,dr.depth,0,Ur.data,0,0):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):oo?tt.texSubImage3D(nt.TEXTURE_2D_ARRAY,pr,0,0,0,Ur.width,Ur.height,dr.depth,zr,Nr,Ur.data):tt.texImage3D(nt.TEXTURE_2D_ARRAY,pr,Or,Ur.width,Ur.height,dr.depth,0,zr,Nr,Ur.data)}else{oo&&zn&&tt.texStorage2D(nt.TEXTURE_2D,ar,Or,Zr[0].width,Zr[0].height);for(let pr=0,Wr=Zr.length;pr<Wr;pr++)Ur=Zr[pr],sn.format!==RGBAFormat?zr!==null?oo?tt.compressedTexSubImage2D(nt.TEXTURE_2D,pr,0,0,Ur.width,Ur.height,zr,Ur.data):tt.compressedTexImage2D(nt.TEXTURE_2D,pr,Or,Ur.width,Ur.height,0,Ur.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):oo?tt.texSubImage2D(nt.TEXTURE_2D,pr,0,0,Ur.width,Ur.height,zr,Nr,Ur.data):tt.texImage2D(nt.TEXTURE_2D,pr,Or,Ur.width,Ur.height,0,zr,Nr,Ur.data)}else if(sn.isDataArrayTexture)oo?(zn&&tt.texStorage3D(nt.TEXTURE_2D_ARRAY,ar,Or,dr.width,dr.height,dr.depth),tt.texSubImage3D(nt.TEXTURE_2D_ARRAY,0,0,0,0,dr.width,dr.height,dr.depth,zr,Nr,dr.data)):tt.texImage3D(nt.TEXTURE_2D_ARRAY,0,Or,dr.width,dr.height,dr.depth,0,zr,Nr,dr.data);else if(sn.isData3DTexture)oo?(zn&&tt.texStorage3D(nt.TEXTURE_3D,ar,Or,dr.width,dr.height,dr.depth),tt.texSubImage3D(nt.TEXTURE_3D,0,0,0,0,dr.width,dr.height,dr.depth,zr,Nr,dr.data)):tt.texImage3D(nt.TEXTURE_3D,0,Or,dr.width,dr.height,dr.depth,0,zr,Nr,dr.data);else if(sn.isFramebufferTexture){if(zn)if(oo)tt.texStorage2D(nt.TEXTURE_2D,ar,Or,dr.width,dr.height);else{let pr=dr.width,Wr=dr.height;for(let Qr=0;Qr<ar;Qr++)tt.texImage2D(nt.TEXTURE_2D,Qr,Or,pr,Wr,0,zr,Nr,null),pr>>=1,Wr>>=1}}else if(Zr.length>0&&Hr){oo&&zn&&tt.texStorage2D(nt.TEXTURE_2D,ar,Or,Zr[0].width,Zr[0].height);for(let pr=0,Wr=Zr.length;pr<Wr;pr++)Ur=Zr[pr],oo?tt.texSubImage2D(nt.TEXTURE_2D,pr,0,0,zr,Nr,Ur):tt.texImage2D(nt.TEXTURE_2D,pr,Or,zr,Nr,Ur);sn.generateMipmaps=!1}else oo?(zn&&tt.texStorage2D(nt.TEXTURE_2D,ar,Or,dr.width,dr.height),tt.texSubImage2D(nt.TEXTURE_2D,0,0,0,zr,Nr,dr)):tt.texImage2D(nt.TEXTURE_2D,0,Or,zr,Nr,dr);Ft(sn,Hr)&&zt(Sr),Fr.__version=vr.version,sn.onUpdate&&sn.onUpdate(sn)}un.__version=sn.version}function Tr(un,sn,Kn){if(sn.image.length!==6)return;const Sr=Vn(un,sn),lr=sn.source;tt.bindTexture(nt.TEXTURE_CUBE_MAP,un.__webglTexture,nt.TEXTURE0+Kn);const vr=ot.get(lr);if(lr.version!==vr.__version||Sr===!0){tt.activeTexture(nt.TEXTURE0+Kn),nt.pixelStorei(nt.UNPACK_FLIP_Y_WEBGL,sn.flipY),nt.pixelStorei(nt.UNPACK_PREMULTIPLY_ALPHA_WEBGL,sn.premultiplyAlpha),nt.pixelStorei(nt.UNPACK_ALIGNMENT,sn.unpackAlignment),nt.pixelStorei(nt.UNPACK_COLORSPACE_CONVERSION_WEBGL,nt.NONE);const Fr=sn.isCompressedTexture||sn.image[0].isCompressedTexture,Gr=sn.image[0]&&sn.image[0].isDataTexture,dr=[];for(let pr=0;pr<6;pr++)!Fr&&!Gr?dr[pr]=Nt(sn.image[pr],!1,!0,ft):dr[pr]=Gr?sn.image[pr].image:sn.image[pr],dr[pr]=kr(sn,dr[pr]);const Hr=dr[0],zr=kt(Hr)||dt,Nr=at.convert(sn.format,sn.colorSpace),Or=at.convert(sn.type),Ur=Yt(sn.internalFormat,Nr,Or,sn.colorSpace),Zr=dt&&sn.isVideoTexture!==!0,oo=vr.__version===void 0||Sr===!0;let zn=Kt(sn,Hr,zr);Gn(nt.TEXTURE_CUBE_MAP,sn,zr);let ar;if(Fr){Zr&&oo&&tt.texStorage2D(nt.TEXTURE_CUBE_MAP,zn,Ur,Hr.width,Hr.height);for(let pr=0;pr<6;pr++){ar=dr[pr].mipmaps;for(let Wr=0;Wr<ar.length;Wr++){const Qr=ar[Wr];sn.format!==RGBAFormat?Nr!==null?Zr?tt.compressedTexSubImage2D(nt.TEXTURE_CUBE_MAP_POSITIVE_X+pr,Wr,0,0,Qr.width,Qr.height,Nr,Qr.data):tt.compressedTexImage2D(nt.TEXTURE_CUBE_MAP_POSITIVE_X+pr,Wr,Ur,Qr.width,Qr.height,0,Qr.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):Zr?tt.texSubImage2D(nt.TEXTURE_CUBE_MAP_POSITIVE_X+pr,Wr,0,0,Qr.width,Qr.height,Nr,Or,Qr.data):tt.texImage2D(nt.TEXTURE_CUBE_MAP_POSITIVE_X+pr,Wr,Ur,Qr.width,Qr.height,0,Nr,Or,Qr.data)}}}else{ar=sn.mipmaps,Zr&&oo&&(ar.length>0&&zn++,tt.texStorage2D(nt.TEXTURE_CUBE_MAP,zn,Ur,dr[0].width,dr[0].height));for(let pr=0;pr<6;pr++)if(Gr){Zr?tt.texSubImage2D(nt.TEXTURE_CUBE_MAP_POSITIVE_X+pr,0,0,0,dr[pr].width,dr[pr].height,Nr,Or,dr[pr].data):tt.texImage2D(nt.TEXTURE_CUBE_MAP_POSITIVE_X+pr,0,Ur,dr[pr].width,dr[pr].height,0,Nr,Or,dr[pr].data);for(let Wr=0;Wr<ar.length;Wr++){const ko=ar[Wr].image[pr].image;Zr?tt.texSubImage2D(nt.TEXTURE_CUBE_MAP_POSITIVE_X+pr,Wr+1,0,0,ko.width,ko.height,Nr,Or,ko.data):tt.texImage2D(nt.TEXTURE_CUBE_MAP_POSITIVE_X+pr,Wr+1,Ur,ko.width,ko.height,0,Nr,Or,ko.data)}}else{Zr?tt.texSubImage2D(nt.TEXTURE_CUBE_MAP_POSITIVE_X+pr,0,0,0,Nr,Or,dr[pr]):tt.texImage2D(nt.TEXTURE_CUBE_MAP_POSITIVE_X+pr,0,Ur,Nr,Or,dr[pr]);for(let Wr=0;Wr<ar.length;Wr++){const Qr=ar[Wr];Zr?tt.texSubImage2D(nt.TEXTURE_CUBE_MAP_POSITIVE_X+pr,Wr+1,0,0,Nr,Or,Qr.image[pr]):tt.texImage2D(nt.TEXTURE_CUBE_MAP_POSITIVE_X+pr,Wr+1,Ur,Nr,Or,Qr.image[pr])}}}Ft(sn,zr)&&zt(nt.TEXTURE_CUBE_MAP),vr.__version=lr.version,sn.onUpdate&&sn.onUpdate(sn)}un.__version=sn.version}function Mn(un,sn,Kn,Sr,lr){const vr=at.convert(Kn.format,Kn.colorSpace),Fr=at.convert(Kn.type),Gr=Yt(Kn.internalFormat,vr,Fr,Kn.colorSpace);ot.get(sn).__hasExternalTextures||(lr===nt.TEXTURE_3D||lr===nt.TEXTURE_2D_ARRAY?tt.texImage3D(lr,0,Gr,sn.width,sn.height,sn.depth,0,vr,Fr,null):tt.texImage2D(lr,0,Gr,sn.width,sn.height,0,vr,Fr,null)),tt.bindFramebuffer(nt.FRAMEBUFFER,un),sr(sn)?yt.framebufferTexture2DMultisampleEXT(nt.FRAMEBUFFER,Sr,lr,ot.get(Kn).__webglTexture,0,rr(sn)):(lr===nt.TEXTURE_2D||lr>=nt.TEXTURE_CUBE_MAP_POSITIVE_X&&lr<=nt.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&nt.framebufferTexture2D(nt.FRAMEBUFFER,Sr,lr,ot.get(Kn).__webglTexture,0),tt.bindFramebuffer(nt.FRAMEBUFFER,null)}function Zt(un,sn,Kn){if(nt.bindRenderbuffer(nt.RENDERBUFFER,un),sn.depthBuffer&&!sn.stencilBuffer){let Sr=nt.DEPTH_COMPONENT16;if(Kn||sr(sn)){const lr=sn.depthTexture;lr&&lr.isDepthTexture&&(lr.type===FloatType?Sr=nt.DEPTH_COMPONENT32F:lr.type===UnsignedIntType&&(Sr=nt.DEPTH_COMPONENT24));const vr=rr(sn);sr(sn)?yt.renderbufferStorageMultisampleEXT(nt.RENDERBUFFER,vr,Sr,sn.width,sn.height):nt.renderbufferStorageMultisample(nt.RENDERBUFFER,vr,Sr,sn.width,sn.height)}else nt.renderbufferStorage(nt.RENDERBUFFER,Sr,sn.width,sn.height);nt.framebufferRenderbuffer(nt.FRAMEBUFFER,nt.DEPTH_ATTACHMENT,nt.RENDERBUFFER,un)}else if(sn.depthBuffer&&sn.stencilBuffer){const Sr=rr(sn);Kn&&sr(sn)===!1?nt.renderbufferStorageMultisample(nt.RENDERBUFFER,Sr,nt.DEPTH24_STENCIL8,sn.width,sn.height):sr(sn)?yt.renderbufferStorageMultisampleEXT(nt.RENDERBUFFER,Sr,nt.DEPTH24_STENCIL8,sn.width,sn.height):nt.renderbufferStorage(nt.RENDERBUFFER,nt.DEPTH_STENCIL,sn.width,sn.height),nt.framebufferRenderbuffer(nt.FRAMEBUFFER,nt.DEPTH_STENCIL_ATTACHMENT,nt.RENDERBUFFER,un)}else{const Sr=sn.isWebGLMultipleRenderTargets===!0?sn.texture:[sn.texture];for(let lr=0;lr<Sr.length;lr++){const vr=Sr[lr],Fr=at.convert(vr.format,vr.colorSpace),Gr=at.convert(vr.type),dr=Yt(vr.internalFormat,Fr,Gr,vr.colorSpace),Hr=rr(sn);Kn&&sr(sn)===!1?nt.renderbufferStorageMultisample(nt.RENDERBUFFER,Hr,dr,sn.width,sn.height):sr(sn)?yt.renderbufferStorageMultisampleEXT(nt.RENDERBUFFER,Hr,dr,sn.width,sn.height):nt.renderbufferStorage(nt.RENDERBUFFER,dr,sn.width,sn.height)}}nt.bindRenderbuffer(nt.RENDERBUFFER,null)}function wn(un,sn){if(sn&&sn.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(tt.bindFramebuffer(nt.FRAMEBUFFER,un),!(sn.depthTexture&&sn.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");(!ot.get(sn.depthTexture).__webglTexture||sn.depthTexture.image.width!==sn.width||sn.depthTexture.image.height!==sn.height)&&(sn.depthTexture.image.width=sn.width,sn.depthTexture.image.height=sn.height,sn.depthTexture.needsUpdate=!0),Sn(sn.depthTexture,0);const Sr=ot.get(sn.depthTexture).__webglTexture,lr=rr(sn);if(sn.depthTexture.format===DepthFormat)sr(sn)?yt.framebufferTexture2DMultisampleEXT(nt.FRAMEBUFFER,nt.DEPTH_ATTACHMENT,nt.TEXTURE_2D,Sr,0,lr):nt.framebufferTexture2D(nt.FRAMEBUFFER,nt.DEPTH_ATTACHMENT,nt.TEXTURE_2D,Sr,0);else if(sn.depthTexture.format===DepthStencilFormat)sr(sn)?yt.framebufferTexture2DMultisampleEXT(nt.FRAMEBUFFER,nt.DEPTH_STENCIL_ATTACHMENT,nt.TEXTURE_2D,Sr,0,lr):nt.framebufferTexture2D(nt.FRAMEBUFFER,nt.DEPTH_STENCIL_ATTACHMENT,nt.TEXTURE_2D,Sr,0);else throw new Error("Unknown depthTexture format")}function xn(un){const sn=ot.get(un),Kn=un.isWebGLCubeRenderTarget===!0;if(un.depthTexture&&!sn.__autoAllocateDepthBuffer){if(Kn)throw new Error("target.depthTexture not supported in Cube render targets");wn(sn.__webglFramebuffer,un)}else if(Kn){sn.__webglDepthbuffer=[];for(let Sr=0;Sr<6;Sr++)tt.bindFramebuffer(nt.FRAMEBUFFER,sn.__webglFramebuffer[Sr]),sn.__webglDepthbuffer[Sr]=nt.createRenderbuffer(),Zt(sn.__webglDepthbuffer[Sr],un,!1)}else tt.bindFramebuffer(nt.FRAMEBUFFER,sn.__webglFramebuffer),sn.__webglDepthbuffer=nt.createRenderbuffer(),Zt(sn.__webglDepthbuffer,un,!1);tt.bindFramebuffer(nt.FRAMEBUFFER,null)}function Hn(un,sn,Kn){const Sr=ot.get(un);sn!==void 0&&Mn(Sr.__webglFramebuffer,un,un.texture,nt.COLOR_ATTACHMENT0,nt.TEXTURE_2D),Kn!==void 0&&xn(un)}function Bn(un){const sn=un.texture,Kn=ot.get(un),Sr=ot.get(sn);un.addEventListener("dispose",an),un.isWebGLMultipleRenderTargets!==!0&&(Sr.__webglTexture===void 0&&(Sr.__webglTexture=nt.createTexture()),Sr.__version=sn.version,lt.memory.textures++);const lr=un.isWebGLCubeRenderTarget===!0,vr=un.isWebGLMultipleRenderTargets===!0,Fr=kt(un)||dt;if(lr){Kn.__webglFramebuffer=[];for(let Gr=0;Gr<6;Gr++)Kn.__webglFramebuffer[Gr]=nt.createFramebuffer()}else{if(Kn.__webglFramebuffer=nt.createFramebuffer(),vr)if(st.drawBuffers){const Gr=un.texture;for(let dr=0,Hr=Gr.length;dr<Hr;dr++){const zr=ot.get(Gr[dr]);zr.__webglTexture===void 0&&(zr.__webglTexture=nt.createTexture(),lt.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");if(dt&&un.samples>0&&sr(un)===!1){const Gr=vr?sn:[sn];Kn.__webglMultisampledFramebuffer=nt.createFramebuffer(),Kn.__webglColorRenderbuffer=[],tt.bindFramebuffer(nt.FRAMEBUFFER,Kn.__webglMultisampledFramebuffer);for(let dr=0;dr<Gr.length;dr++){const Hr=Gr[dr];Kn.__webglColorRenderbuffer[dr]=nt.createRenderbuffer(),nt.bindRenderbuffer(nt.RENDERBUFFER,Kn.__webglColorRenderbuffer[dr]);const zr=at.convert(Hr.format,Hr.colorSpace),Nr=at.convert(Hr.type),Or=Yt(Hr.internalFormat,zr,Nr,Hr.colorSpace,un.isXRRenderTarget===!0),Ur=rr(un);nt.renderbufferStorageMultisample(nt.RENDERBUFFER,Ur,Or,un.width,un.height),nt.framebufferRenderbuffer(nt.FRAMEBUFFER,nt.COLOR_ATTACHMENT0+dr,nt.RENDERBUFFER,Kn.__webglColorRenderbuffer[dr])}nt.bindRenderbuffer(nt.RENDERBUFFER,null),un.depthBuffer&&(Kn.__webglDepthRenderbuffer=nt.createRenderbuffer(),Zt(Kn.__webglDepthRenderbuffer,un,!0)),tt.bindFramebuffer(nt.FRAMEBUFFER,null)}}if(lr){tt.bindTexture(nt.TEXTURE_CUBE_MAP,Sr.__webglTexture),Gn(nt.TEXTURE_CUBE_MAP,sn,Fr);for(let Gr=0;Gr<6;Gr++)Mn(Kn.__webglFramebuffer[Gr],un,sn,nt.COLOR_ATTACHMENT0,nt.TEXTURE_CUBE_MAP_POSITIVE_X+Gr);Ft(sn,Fr)&&zt(nt.TEXTURE_CUBE_MAP),tt.unbindTexture()}else if(vr){const Gr=un.texture;for(let dr=0,Hr=Gr.length;dr<Hr;dr++){const zr=Gr[dr],Nr=ot.get(zr);tt.bindTexture(nt.TEXTURE_2D,Nr.__webglTexture),Gn(nt.TEXTURE_2D,zr,Fr),Mn(Kn.__webglFramebuffer,un,zr,nt.COLOR_ATTACHMENT0+dr,nt.TEXTURE_2D),Ft(zr,Fr)&&zt(nt.TEXTURE_2D)}tt.unbindTexture()}else{let Gr=nt.TEXTURE_2D;(un.isWebGL3DRenderTarget||un.isWebGLArrayRenderTarget)&&(dt?Gr=un.isWebGL3DRenderTarget?nt.TEXTURE_3D:nt.TEXTURE_2D_ARRAY:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")),tt.bindTexture(Gr,Sr.__webglTexture),Gn(Gr,sn,Fr),Mn(Kn.__webglFramebuffer,un,sn,nt.COLOR_ATTACHMENT0,Gr),Ft(sn,Fr)&&zt(Gr),tt.unbindTexture()}un.depthBuffer&&xn(un)}function cr(un){const sn=kt(un)||dt,Kn=un.isWebGLMultipleRenderTargets===!0?un.texture:[un.texture];for(let Sr=0,lr=Kn.length;Sr<lr;Sr++){const vr=Kn[Sr];if(Ft(vr,sn)){const Fr=un.isWebGLCubeRenderTarget?nt.TEXTURE_CUBE_MAP:nt.TEXTURE_2D,Gr=ot.get(vr).__webglTexture;tt.bindTexture(Fr,Gr),zt(Fr),tt.unbindTexture()}}}function Wn(un){if(dt&&un.samples>0&&sr(un)===!1){const sn=un.isWebGLMultipleRenderTargets?un.texture:[un.texture],Kn=un.width,Sr=un.height;let lr=nt.COLOR_BUFFER_BIT;const vr=[],Fr=un.stencilBuffer?nt.DEPTH_STENCIL_ATTACHMENT:nt.DEPTH_ATTACHMENT,Gr=ot.get(un),dr=un.isWebGLMultipleRenderTargets===!0;if(dr)for(let Hr=0;Hr<sn.length;Hr++)tt.bindFramebuffer(nt.FRAMEBUFFER,Gr.__webglMultisampledFramebuffer),nt.framebufferRenderbuffer(nt.FRAMEBUFFER,nt.COLOR_ATTACHMENT0+Hr,nt.RENDERBUFFER,null),tt.bindFramebuffer(nt.FRAMEBUFFER,Gr.__webglFramebuffer),nt.framebufferTexture2D(nt.DRAW_FRAMEBUFFER,nt.COLOR_ATTACHMENT0+Hr,nt.TEXTURE_2D,null,0);tt.bindFramebuffer(nt.READ_FRAMEBUFFER,Gr.__webglMultisampledFramebuffer),tt.bindFramebuffer(nt.DRAW_FRAMEBUFFER,Gr.__webglFramebuffer);for(let Hr=0;Hr<sn.length;Hr++){vr.push(nt.COLOR_ATTACHMENT0+Hr),un.depthBuffer&&vr.push(Fr);const zr=Gr.__ignoreDepthValues!==void 0?Gr.__ignoreDepthValues:!1;if(zr===!1&&(un.depthBuffer&&(lr|=nt.DEPTH_BUFFER_BIT),un.stencilBuffer&&(lr|=nt.STENCIL_BUFFER_BIT)),dr&&nt.framebufferRenderbuffer(nt.READ_FRAMEBUFFER,nt.COLOR_ATTACHMENT0,nt.RENDERBUFFER,Gr.__webglColorRenderbuffer[Hr]),zr===!0&&(nt.invalidateFramebuffer(nt.READ_FRAMEBUFFER,[Fr]),nt.invalidateFramebuffer(nt.DRAW_FRAMEBUFFER,[Fr])),dr){const Nr=ot.get(sn[Hr]).__webglTexture;nt.framebufferTexture2D(nt.DRAW_FRAMEBUFFER,nt.COLOR_ATTACHMENT0,nt.TEXTURE_2D,Nr,0)}nt.blitFramebuffer(0,0,Kn,Sr,0,0,Kn,Sr,lr,nt.NEAREST),Ct&&nt.invalidateFramebuffer(nt.READ_FRAMEBUFFER,vr)}if(tt.bindFramebuffer(nt.READ_FRAMEBUFFER,null),tt.bindFramebuffer(nt.DRAW_FRAMEBUFFER,null),dr)for(let Hr=0;Hr<sn.length;Hr++){tt.bindFramebuffer(nt.FRAMEBUFFER,Gr.__webglMultisampledFramebuffer),nt.framebufferRenderbuffer(nt.FRAMEBUFFER,nt.COLOR_ATTACHMENT0+Hr,nt.RENDERBUFFER,Gr.__webglColorRenderbuffer[Hr]);const zr=ot.get(sn[Hr]).__webglTexture;tt.bindFramebuffer(nt.FRAMEBUFFER,Gr.__webglFramebuffer),nt.framebufferTexture2D(nt.DRAW_FRAMEBUFFER,nt.COLOR_ATTACHMENT0+Hr,nt.TEXTURE_2D,zr,0)}tt.bindFramebuffer(nt.DRAW_FRAMEBUFFER,Gr.__webglMultisampledFramebuffer)}}function rr(un){return Math.min(Et,un.samples)}function sr(un){const sn=ot.get(un);return dt&&un.samples>0&&_.has("WEBGL_multisampled_render_to_texture")===!0&&sn.__useRenderToTexture!==!1}function ir(un){const sn=lt.render.frame;wt.get(un)!==sn&&(wt.set(un,sn),un.update())}function kr(un,sn){const Kn=un.colorSpace,Sr=un.format,lr=un.type;return un.isCompressedTexture===!0||un.format===_SRGBAFormat||Kn!==LinearSRGBColorSpace$1&&Kn!==NoColorSpace&&(Kn===SRGBColorSpace$1?dt===!1?_.has("EXT_sRGB")===!0&&Sr===RGBAFormat?(un.format=_SRGBAFormat,un.minFilter=LinearFilter,un.generateMipmaps=!1):sn=ImageUtils.sRGBToLinear(sn):(Sr!==RGBAFormat||lr!==UnsignedByteType)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture color space:",Kn)),sn}this.allocateTextureUnit=yn,this.resetTextureUnits=Pn,this.setTexture2D=Sn,this.setTexture2DArray=gn,this.setTexture3D=_n,this.setTextureCube=Rn,this.rebindTextures=Hn,this.setupRenderTarget=Bn,this.updateRenderTargetMipmap=cr,this.updateMultisampleRenderTarget=Wn,this.setupDepthRenderbuffer=xn,this.setupFrameBufferTexture=Mn,this.useMultisampledRTT=sr}function WebGLUtils(nt,_,tt){const ot=tt.isWebGL2;function st(at,lt=NoColorSpace){let dt;if(at===UnsignedByteType)return nt.UNSIGNED_BYTE;if(at===UnsignedShort4444Type)return nt.UNSIGNED_SHORT_4_4_4_4;if(at===UnsignedShort5551Type)return nt.UNSIGNED_SHORT_5_5_5_1;if(at===ByteType)return nt.BYTE;if(at===ShortType)return nt.SHORT;if(at===UnsignedShortType)return nt.UNSIGNED_SHORT;if(at===IntType)return nt.INT;if(at===UnsignedIntType)return nt.UNSIGNED_INT;if(at===FloatType)return nt.FLOAT;if(at===HalfFloatType)return ot?nt.HALF_FLOAT:(dt=_.get("OES_texture_half_float"),dt!==null?dt.HALF_FLOAT_OES:null);if(at===AlphaFormat)return nt.ALPHA;if(at===RGBAFormat)return nt.RGBA;if(at===LuminanceFormat)return nt.LUMINANCE;if(at===LuminanceAlphaFormat)return nt.LUMINANCE_ALPHA;if(at===DepthFormat)return nt.DEPTH_COMPONENT;if(at===DepthStencilFormat)return nt.DEPTH_STENCIL;if(at===_SRGBAFormat)return dt=_.get("EXT_sRGB"),dt!==null?dt.SRGB_ALPHA_EXT:null;if(at===RedFormat)return nt.RED;if(at===RedIntegerFormat)return nt.RED_INTEGER;if(at===RGFormat)return nt.RG;if(at===RGIntegerFormat)return nt.RG_INTEGER;if(at===RGBAIntegerFormat)return nt.RGBA_INTEGER;if(at===RGB_S3TC_DXT1_Format||at===RGBA_S3TC_DXT1_Format||at===RGBA_S3TC_DXT3_Format||at===RGBA_S3TC_DXT5_Format)if(lt===SRGBColorSpace$1)if(dt=_.get("WEBGL_compressed_texture_s3tc_srgb"),dt!==null){if(at===RGB_S3TC_DXT1_Format)return dt.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(at===RGBA_S3TC_DXT1_Format)return dt.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(at===RGBA_S3TC_DXT3_Format)return dt.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(at===RGBA_S3TC_DXT5_Format)return dt.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(dt=_.get("WEBGL_compressed_texture_s3tc"),dt!==null){if(at===RGB_S3TC_DXT1_Format)return dt.COMPRESSED_RGB_S3TC_DXT1_EXT;if(at===RGBA_S3TC_DXT1_Format)return dt.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(at===RGBA_S3TC_DXT3_Format)return dt.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(at===RGBA_S3TC_DXT5_Format)return dt.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(at===RGB_PVRTC_4BPPV1_Format||at===RGB_PVRTC_2BPPV1_Format||at===RGBA_PVRTC_4BPPV1_Format||at===RGBA_PVRTC_2BPPV1_Format)if(dt=_.get("WEBGL_compressed_texture_pvrtc"),dt!==null){if(at===RGB_PVRTC_4BPPV1_Format)return dt.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(at===RGB_PVRTC_2BPPV1_Format)return dt.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(at===RGBA_PVRTC_4BPPV1_Format)return dt.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(at===RGBA_PVRTC_2BPPV1_Format)return dt.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(at===RGB_ETC1_Format)return dt=_.get("WEBGL_compressed_texture_etc1"),dt!==null?dt.COMPRESSED_RGB_ETC1_WEBGL:null;if(at===RGB_ETC2_Format||at===RGBA_ETC2_EAC_Format)if(dt=_.get("WEBGL_compressed_texture_etc"),dt!==null){if(at===RGB_ETC2_Format)return lt===SRGBColorSpace$1?dt.COMPRESSED_SRGB8_ETC2:dt.COMPRESSED_RGB8_ETC2;if(at===RGBA_ETC2_EAC_Format)return lt===SRGBColorSpace$1?dt.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:dt.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(at===RGBA_ASTC_4x4_Format||at===RGBA_ASTC_5x4_Format||at===RGBA_ASTC_5x5_Format||at===RGBA_ASTC_6x5_Format||at===RGBA_ASTC_6x6_Format||at===RGBA_ASTC_8x5_Format||at===RGBA_ASTC_8x6_Format||at===RGBA_ASTC_8x8_Format||at===RGBA_ASTC_10x5_Format||at===RGBA_ASTC_10x6_Format||at===RGBA_ASTC_10x8_Format||at===RGBA_ASTC_10x10_Format||at===RGBA_ASTC_12x10_Format||at===RGBA_ASTC_12x12_Format)if(dt=_.get("WEBGL_compressed_texture_astc"),dt!==null){if(at===RGBA_ASTC_4x4_Format)return lt===SRGBColorSpace$1?dt.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:dt.COMPRESSED_RGBA_ASTC_4x4_KHR;if(at===RGBA_ASTC_5x4_Format)return lt===SRGBColorSpace$1?dt.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:dt.COMPRESSED_RGBA_ASTC_5x4_KHR;if(at===RGBA_ASTC_5x5_Format)return lt===SRGBColorSpace$1?dt.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:dt.COMPRESSED_RGBA_ASTC_5x5_KHR;if(at===RGBA_ASTC_6x5_Format)return lt===SRGBColorSpace$1?dt.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:dt.COMPRESSED_RGBA_ASTC_6x5_KHR;if(at===RGBA_ASTC_6x6_Format)return lt===SRGBColorSpace$1?dt.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:dt.COMPRESSED_RGBA_ASTC_6x6_KHR;if(at===RGBA_ASTC_8x5_Format)return lt===SRGBColorSpace$1?dt.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:dt.COMPRESSED_RGBA_ASTC_8x5_KHR;if(at===RGBA_ASTC_8x6_Format)return lt===SRGBColorSpace$1?dt.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:dt.COMPRESSED_RGBA_ASTC_8x6_KHR;if(at===RGBA_ASTC_8x8_Format)return lt===SRGBColorSpace$1?dt.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:dt.COMPRESSED_RGBA_ASTC_8x8_KHR;if(at===RGBA_ASTC_10x5_Format)return lt===SRGBColorSpace$1?dt.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:dt.COMPRESSED_RGBA_ASTC_10x5_KHR;if(at===RGBA_ASTC_10x6_Format)return lt===SRGBColorSpace$1?dt.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:dt.COMPRESSED_RGBA_ASTC_10x6_KHR;if(at===RGBA_ASTC_10x8_Format)return lt===SRGBColorSpace$1?dt.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:dt.COMPRESSED_RGBA_ASTC_10x8_KHR;if(at===RGBA_ASTC_10x10_Format)return lt===SRGBColorSpace$1?dt.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:dt.COMPRESSED_RGBA_ASTC_10x10_KHR;if(at===RGBA_ASTC_12x10_Format)return lt===SRGBColorSpace$1?dt.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:dt.COMPRESSED_RGBA_ASTC_12x10_KHR;if(at===RGBA_ASTC_12x12_Format)return lt===SRGBColorSpace$1?dt.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:dt.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(at===RGBA_BPTC_Format)if(dt=_.get("EXT_texture_compression_bptc"),dt!==null){if(at===RGBA_BPTC_Format)return lt===SRGBColorSpace$1?dt.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:dt.COMPRESSED_RGBA_BPTC_UNORM_EXT}else return null;if(at===RED_RGTC1_Format||at===SIGNED_RED_RGTC1_Format||at===RED_GREEN_RGTC2_Format||at===SIGNED_RED_GREEN_RGTC2_Format)if(dt=_.get("EXT_texture_compression_rgtc"),dt!==null){if(at===RGBA_BPTC_Format)return dt.COMPRESSED_RED_RGTC1_EXT;if(at===SIGNED_RED_RGTC1_Format)return dt.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(at===RED_GREEN_RGTC2_Format)return dt.COMPRESSED_RED_GREEN_RGTC2_EXT;if(at===SIGNED_RED_GREEN_RGTC2_Format)return dt.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return at===UnsignedInt248Type?ot?nt.UNSIGNED_INT_24_8:(dt=_.get("WEBGL_depth_texture"),dt!==null?dt.UNSIGNED_INT_24_8_WEBGL:null):nt[at]!==void 0?nt[at]:null}return{convert:st}}class ArrayCamera extends PerspectiveCamera{constructor(_=[]){super(),this.isArrayCamera=!0,this.cameras=_}}class Group extends Object3D{constructor(){super(),this.isGroup=!0,this.type="Group"}}const _moveEvent={type:"move"};class WebXRController{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new Group,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new Group,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new Vector3,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new Vector3),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new Group,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new Vector3,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new Vector3),this._grip}dispatchEvent(_){return this._targetRay!==null&&this._targetRay.dispatchEvent(_),this._grip!==null&&this._grip.dispatchEvent(_),this._hand!==null&&this._hand.dispatchEvent(_),this}connect(_){if(_&&_.hand){const tt=this._hand;if(tt)for(const ot of _.hand.values())this._getHandJoint(tt,ot)}return this.dispatchEvent({type:"connected",data:_}),this}disconnect(_){return this.dispatchEvent({type:"disconnected",data:_}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(_,tt,ot){let st=null,at=null,lt=null;const dt=this._targetRay,ht=this._grip,ft=this._hand;if(_&&tt.session.visibilityState!=="visible-blurred"){if(ft&&_.hand){lt=!0;for(const It of _.hand.values()){const Pt=tt.getJointPose(It,ot),Rt=this._getHandJoint(ft,It);Pt!==null&&(Rt.matrix.fromArray(Pt.transform.matrix),Rt.matrix.decompose(Rt.position,Rt.rotation,Rt.scale),Rt.matrixWorldNeedsUpdate=!0,Rt.jointRadius=Pt.radius),Rt.visible=Pt!==null}const gt=ft.joints["index-finger-tip"],Et=ft.joints["thumb-tip"],yt=gt.position.distanceTo(Et.position),Ct=.02,wt=.005;ft.inputState.pinching&&yt>Ct+wt?(ft.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:_.handedness,target:this})):!ft.inputState.pinching&&yt<=Ct-wt&&(ft.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:_.handedness,target:this}))}else ht!==null&&_.gripSpace&&(at=tt.getPose(_.gripSpace,ot),at!==null&&(ht.matrix.fromArray(at.transform.matrix),ht.matrix.decompose(ht.position,ht.rotation,ht.scale),ht.matrixWorldNeedsUpdate=!0,at.linearVelocity?(ht.hasLinearVelocity=!0,ht.linearVelocity.copy(at.linearVelocity)):ht.hasLinearVelocity=!1,at.angularVelocity?(ht.hasAngularVelocity=!0,ht.angularVelocity.copy(at.angularVelocity)):ht.hasAngularVelocity=!1));dt!==null&&(st=tt.getPose(_.targetRaySpace,ot),st===null&&at!==null&&(st=at),st!==null&&(dt.matrix.fromArray(st.transform.matrix),dt.matrix.decompose(dt.position,dt.rotation,dt.scale),dt.matrixWorldNeedsUpdate=!0,st.linearVelocity?(dt.hasLinearVelocity=!0,dt.linearVelocity.copy(st.linearVelocity)):dt.hasLinearVelocity=!1,st.angularVelocity?(dt.hasAngularVelocity=!0,dt.angularVelocity.copy(st.angularVelocity)):dt.hasAngularVelocity=!1,this.dispatchEvent(_moveEvent)))}return dt!==null&&(dt.visible=st!==null),ht!==null&&(ht.visible=at!==null),ft!==null&&(ft.visible=lt!==null),this}_getHandJoint(_,tt){if(_.joints[tt.jointName]===void 0){const ot=new Group;ot.matrixAutoUpdate=!1,ot.visible=!1,_.joints[tt.jointName]=ot,_.add(ot)}return _.joints[tt.jointName]}}class DepthTexture extends Texture{constructor(_,tt,ot,st,at,lt,dt,ht,ft,gt){if(gt=gt!==void 0?gt:DepthFormat,gt!==DepthFormat&&gt!==DepthStencilFormat)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");ot===void 0&&gt===DepthFormat&&(ot=UnsignedIntType),ot===void 0&&gt===DepthStencilFormat&&(ot=UnsignedInt248Type),super(null,st,at,lt,dt,ht,gt,ot,ft),this.isDepthTexture=!0,this.image={width:_,height:tt},this.magFilter=dt!==void 0?dt:NearestFilter,this.minFilter=ht!==void 0?ht:NearestFilter,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(_){return super.copy(_),this.compareFunction=_.compareFunction,this}toJSON(_){const tt=super.toJSON(_);return this.compareFunction!==null&&(tt.compareFunction=this.compareFunction),tt}}class WebXRManager extends EventDispatcher$1{constructor(_,tt){super();const ot=this;let st=null,at=1,lt=null,dt="local-floor",ht=1,ft=null,gt=null,Et=null,yt=null,Ct=null,wt=null;const It=tt.getContextAttributes();let Pt=null,Rt=null;const xt=[],Nt=[];let kt=null;const Vt=new PerspectiveCamera;Vt.layers.enable(1),Vt.viewport=new Vector4;const Ft=new PerspectiveCamera;Ft.layers.enable(2),Ft.viewport=new Vector4;const zt=[Vt,Ft],Yt=new ArrayCamera;Yt.layers.enable(1),Yt.layers.enable(2);let Kt=null,qt=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getCamera=function(){},this.setUserCamera=function(_n){kt=_n},this.getController=function(_n){let Rn=xt[_n];return Rn===void 0&&(Rn=new WebXRController,xt[_n]=Rn),Rn.getTargetRaySpace()},this.getControllerGrip=function(_n){let Rn=xt[_n];return Rn===void 0&&(Rn=new WebXRController,xt[_n]=Rn),Rn.getGripSpace()},this.getHand=function(_n){let Rn=xt[_n];return Rn===void 0&&(Rn=new WebXRController,xt[_n]=Rn),Rn.getHandSpace()};function pn(_n){const Rn=Nt.indexOf(_n.inputSource);if(Rn===-1)return;const bn=xt[Rn];bn!==void 0&&(bn.update(_n.inputSource,_n.frame,ft||lt),bn.dispatchEvent({type:_n.type,data:_n.inputSource}))}function an(){st.removeEventListener("select",pn),st.removeEventListener("selectstart",pn),st.removeEventListener("selectend",pn),st.removeEventListener("squeeze",pn),st.removeEventListener("squeezestart",pn),st.removeEventListener("squeezeend",pn),st.removeEventListener("end",an),st.removeEventListener("inputsourceschange",fn);for(let _n=0;_n<xt.length;_n++){const Rn=Nt[_n];Rn!==null&&(Nt[_n]=null,xt[_n].disconnect(Rn))}Kt=null,qt=null,_.setRenderTarget(Pt),Ct=null,yt=null,Et=null,st=null,Rt=null,gn.stop(),ot.isPresenting=!1,ot.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(_n){at=_n,ot.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(_n){dt=_n,ot.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return ft||lt},this.setReferenceSpace=function(_n){ft=_n},this.getBaseLayer=function(){return yt!==null?yt:Ct},this.getBinding=function(){return Et},this.getFrame=function(){return wt},this.getSession=function(){return st},this.setSession=async function(_n){if(st=_n,st!==null){if(Pt=_.getRenderTarget(),st.addEventListener("select",pn),st.addEventListener("selectstart",pn),st.addEventListener("selectend",pn),st.addEventListener("squeeze",pn),st.addEventListener("squeezestart",pn),st.addEventListener("squeezeend",pn),st.addEventListener("end",an),st.addEventListener("inputsourceschange",fn),It.xrCompatible!==!0&&await tt.makeXRCompatible(),st.renderState.layers===void 0||_.capabilities.isWebGL2===!1){const Rn={antialias:st.renderState.layers===void 0?It.antialias:!0,alpha:!0,depth:It.depth,stencil:It.stencil,framebufferScaleFactor:at};Ct=new XRWebGLLayer(st,tt,Rn),st.updateRenderState({baseLayer:Ct}),Rt=new WebGLRenderTarget(Ct.framebufferWidth,Ct.framebufferHeight,{format:RGBAFormat,type:UnsignedByteType,colorSpace:_.outputColorSpace,stencilBuffer:It.stencil})}else{let Rn=null,bn=null,jn=null;It.depth&&(jn=It.stencil?tt.DEPTH24_STENCIL8:tt.DEPTH_COMPONENT24,Rn=It.stencil?DepthStencilFormat:DepthFormat,bn=It.stencil?UnsignedInt248Type:UnsignedIntType);const kn={colorFormat:tt.RGBA8,depthFormat:jn,scaleFactor:at};Et=new XRWebGLBinding(st,tt),yt=Et.createProjectionLayer(kn),st.updateRenderState({layers:[yt]}),Rt=new WebGLRenderTarget(yt.textureWidth,yt.textureHeight,{format:RGBAFormat,type:UnsignedByteType,depthTexture:new DepthTexture(yt.textureWidth,yt.textureHeight,bn,void 0,void 0,void 0,void 0,void 0,void 0,Rn),stencilBuffer:It.stencil,colorSpace:_.outputColorSpace,samples:It.antialias?4:0});const Gn=_.properties.get(Rt);Gn.__ignoreDepthValues=yt.ignoreDepthValues}Rt.isXRRenderTarget=!0,this.setFoveation(ht),ft=null,lt=await st.requestReferenceSpace(dt),gn.setContext(st),gn.start(),ot.isPresenting=!0,ot.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(st!==null)return st.environmentBlendMode};function fn(_n){for(let Rn=0;Rn<_n.removed.length;Rn++){const bn=_n.removed[Rn],jn=Nt.indexOf(bn);jn>=0&&(Nt[jn]=null,xt[jn].disconnect(bn))}for(let Rn=0;Rn<_n.added.length;Rn++){const bn=_n.added[Rn];let jn=Nt.indexOf(bn);if(jn===-1){for(let Gn=0;Gn<xt.length;Gn++)if(Gn>=Nt.length){Nt.push(bn),jn=Gn;break}else if(Nt[Gn]===null){Nt[Gn]=bn,jn=Gn;break}if(jn===-1)break}const kn=xt[jn];kn&&kn.connect(bn)}}const dn=new Vector3,Cn=new Vector3;function On(_n,Rn,bn){dn.setFromMatrixPosition(Rn.matrixWorld),Cn.setFromMatrixPosition(bn.matrixWorld);const jn=dn.distanceTo(Cn),kn=Rn.projectionMatrix.elements,Gn=bn.projectionMatrix.elements,Vn=kn[14]/(kn[10]-1),qn=kn[14]/(kn[10]+1),Tr=(kn[9]+1)/kn[5],Mn=(kn[9]-1)/kn[5],Zt=(kn[8]-1)/kn[0],wn=(Gn[8]+1)/Gn[0],xn=Vn*Zt,Hn=Vn*wn,Bn=jn/(-Zt+wn),cr=Bn*-Zt;Rn.matrixWorld.decompose(_n.position,_n.quaternion,_n.scale),_n.translateX(cr),_n.translateZ(Bn),_n.matrixWorld.compose(_n.position,_n.quaternion,_n.scale),_n.matrixWorldInverse.copy(_n.matrixWorld).invert();const Wn=Vn+Bn,rr=qn+Bn,sr=xn-cr,ir=Hn+(jn-cr),kr=Tr*qn/rr*Wn,un=Mn*qn/rr*Wn;_n.projectionMatrix.makePerspective(sr,ir,kr,un,Wn,rr),_n.projectionMatrixInverse.copy(_n.projectionMatrix).invert()}function Pn(_n,Rn){Rn===null?_n.matrixWorld.copy(_n.matrix):_n.matrixWorld.multiplyMatrices(Rn.matrixWorld,_n.matrix),_n.matrixWorldInverse.copy(_n.matrixWorld).invert()}this.updateCameraXR=function(_n){if(st===null)return _n;kt&&(_n=kt),Yt.near=Ft.near=Vt.near=_n.near,Yt.far=Ft.far=Vt.far=_n.far,(Kt!==Yt.near||qt!==Yt.far)&&(st.updateRenderState({depthNear:Yt.near,depthFar:Yt.far}),Kt=Yt.near,qt=Yt.far);const Rn=_n.parent,bn=Yt.cameras;Pn(Yt,Rn);for(let jn=0;jn<bn.length;jn++)Pn(bn[jn],Rn);return bn.length===2?On(Yt,Vt,Ft):Yt.projectionMatrix.copy(Vt.projectionMatrix),kt&&yn(Yt,Rn),Yt};function yn(_n,Rn){const bn=kt;Rn===null?bn.matrix.copy(_n.matrixWorld):(bn.matrix.copy(Rn.matrixWorld),bn.matrix.invert(),bn.matrix.multiply(_n.matrixWorld)),bn.matrix.decompose(bn.position,bn.quaternion,bn.scale),bn.updateMatrixWorld(!0);const jn=bn.children;for(let kn=0,Gn=jn.length;kn<Gn;kn++)jn[kn].updateMatrixWorld(!0);bn.projectionMatrix.copy(_n.projectionMatrix),bn.projectionMatrixInverse.copy(_n.projectionMatrixInverse),bn.isPerspectiveCamera&&(bn.fov=RAD2DEG*2*Math.atan(1/bn.projectionMatrix.elements[5]),bn.zoom=1)}this.getFoveation=function(){if(!(yt===null&&Ct===null))return ht},this.setFoveation=function(_n){ht=_n,yt!==null&&(yt.fixedFoveation=_n),Ct!==null&&Ct.fixedFoveation!==void 0&&(Ct.fixedFoveation=_n)};let An=null;function Sn(_n,Rn){if(gt=Rn.getViewerPose(ft||lt),wt=Rn,gt!==null){const bn=gt.views;Ct!==null&&(_.setRenderTargetFramebuffer(Rt,Ct.framebuffer),_.setRenderTarget(Rt));let jn=!1;bn.length!==Yt.cameras.length&&(Yt.cameras.length=0,jn=!0);for(let kn=0;kn<bn.length;kn++){const Gn=bn[kn];let Vn=null;if(Ct!==null)Vn=Ct.getViewport(Gn);else{const Tr=Et.getViewSubImage(yt,Gn);Vn=Tr.viewport,kn===0&&(_.setRenderTargetTextures(Rt,Tr.colorTexture,yt.ignoreDepthValues?void 0:Tr.depthStencilTexture),_.setRenderTarget(Rt))}let qn=zt[kn];qn===void 0&&(qn=new PerspectiveCamera,qn.layers.enable(kn),qn.viewport=new Vector4,zt[kn]=qn),qn.matrix.fromArray(Gn.transform.matrix),qn.matrix.decompose(qn.position,qn.quaternion,qn.scale),qn.projectionMatrix.fromArray(Gn.projectionMatrix),qn.projectionMatrixInverse.copy(qn.projectionMatrix).invert(),qn.viewport.set(Vn.x,Vn.y,Vn.width,Vn.height),kn===0&&(Yt.matrix.copy(qn.matrix),Yt.matrix.decompose(Yt.position,Yt.quaternion,Yt.scale)),jn===!0&&Yt.cameras.push(qn)}}for(let bn=0;bn<xt.length;bn++){const jn=Nt[bn],kn=xt[bn];jn!==null&&kn!==void 0&&kn.update(jn,Rn,ft||lt)}An&&An(_n,Rn),Rn.detectedPlanes&&ot.dispatchEvent({type:"planesdetected",data:Rn}),wt=null}const gn=new WebGLAnimation;gn.setAnimationLoop(Sn),this.setAnimationLoop=function(_n){An=_n},this.dispose=function(){}}}function WebGLMaterials(nt,_){function tt(Pt,Rt){Pt.matrixAutoUpdate===!0&&Pt.updateMatrix(),Rt.value.copy(Pt.matrix)}function ot(Pt,Rt){Rt.color.getRGB(Pt.fogColor.value,getUnlitUniformColorSpace(nt)),Rt.isFog?(Pt.fogNear.value=Rt.near,Pt.fogFar.value=Rt.far):Rt.isFogExp2&&(Pt.fogDensity.value=Rt.density)}function st(Pt,Rt,xt,Nt,kt){Rt.isMeshBasicMaterial||Rt.isMeshLambertMaterial?at(Pt,Rt):Rt.isMeshToonMaterial?(at(Pt,Rt),Et(Pt,Rt)):Rt.isMeshPhongMaterial?(at(Pt,Rt),gt(Pt,Rt)):Rt.isMeshStandardMaterial?(at(Pt,Rt),yt(Pt,Rt),Rt.isMeshPhysicalMaterial&&Ct(Pt,Rt,kt)):Rt.isMeshMatcapMaterial?(at(Pt,Rt),wt(Pt,Rt)):Rt.isMeshDepthMaterial?at(Pt,Rt):Rt.isMeshDistanceMaterial?(at(Pt,Rt),It(Pt,Rt)):Rt.isMeshNormalMaterial?at(Pt,Rt):Rt.isLineBasicMaterial?(lt(Pt,Rt),Rt.isLineDashedMaterial&&dt(Pt,Rt)):Rt.isPointsMaterial?ht(Pt,Rt,xt,Nt):Rt.isSpriteMaterial?ft(Pt,Rt):Rt.isShadowMaterial?(Pt.color.value.copy(Rt.color),Pt.opacity.value=Rt.opacity):Rt.isShaderMaterial&&(Rt.uniformsNeedUpdate=!1)}function at(Pt,Rt){Pt.opacity.value=Rt.opacity,Rt.color&&Pt.diffuse.value.copy(Rt.color),Rt.emissive&&Pt.emissive.value.copy(Rt.emissive).multiplyScalar(Rt.emissiveIntensity),Rt.map&&(Pt.map.value=Rt.map,tt(Rt.map,Pt.mapTransform)),Rt.alphaMap&&(Pt.alphaMap.value=Rt.alphaMap,tt(Rt.alphaMap,Pt.alphaMapTransform)),Rt.bumpMap&&(Pt.bumpMap.value=Rt.bumpMap,tt(Rt.bumpMap,Pt.bumpMapTransform),Pt.bumpScale.value=Rt.bumpScale,Rt.side===BackSide&&(Pt.bumpScale.value*=-1)),Rt.normalMap&&(Pt.normalMap.value=Rt.normalMap,tt(Rt.normalMap,Pt.normalMapTransform),Pt.normalScale.value.copy(Rt.normalScale),Rt.side===BackSide&&Pt.normalScale.value.negate()),Rt.displacementMap&&(Pt.displacementMap.value=Rt.displacementMap,tt(Rt.displacementMap,Pt.displacementMapTransform),Pt.displacementScale.value=Rt.displacementScale,Pt.displacementBias.value=Rt.displacementBias),Rt.emissiveMap&&(Pt.emissiveMap.value=Rt.emissiveMap,tt(Rt.emissiveMap,Pt.emissiveMapTransform)),Rt.specularMap&&(Pt.specularMap.value=Rt.specularMap,tt(Rt.specularMap,Pt.specularMapTransform)),Rt.alphaTest>0&&(Pt.alphaTest.value=Rt.alphaTest);const xt=_.get(Rt).envMap;if(xt&&(Pt.envMap.value=xt,Pt.flipEnvMap.value=xt.isCubeTexture&&xt.isRenderTargetTexture===!1?-1:1,Pt.reflectivity.value=Rt.reflectivity,Pt.ior.value=Rt.ior,Pt.refractionRatio.value=Rt.refractionRatio),Rt.lightMap){Pt.lightMap.value=Rt.lightMap;const Nt=nt.useLegacyLights===!0?Math.PI:1;Pt.lightMapIntensity.value=Rt.lightMapIntensity*Nt,tt(Rt.lightMap,Pt.lightMapTransform)}Rt.aoMap&&(Pt.aoMap.value=Rt.aoMap,Pt.aoMapIntensity.value=Rt.aoMapIntensity,tt(Rt.aoMap,Pt.aoMapTransform))}function lt(Pt,Rt){Pt.diffuse.value.copy(Rt.color),Pt.opacity.value=Rt.opacity,Rt.map&&(Pt.map.value=Rt.map,tt(Rt.map,Pt.mapTransform))}function dt(Pt,Rt){Pt.dashSize.value=Rt.dashSize,Pt.totalSize.value=Rt.dashSize+Rt.gapSize,Pt.scale.value=Rt.scale}function ht(Pt,Rt,xt,Nt){Pt.diffuse.value.copy(Rt.color),Pt.opacity.value=Rt.opacity,Pt.size.value=Rt.size*xt,Pt.scale.value=Nt*.5,Rt.map&&(Pt.map.value=Rt.map,tt(Rt.map,Pt.uvTransform)),Rt.alphaMap&&(Pt.alphaMap.value=Rt.alphaMap,tt(Rt.alphaMap,Pt.alphaMapTransform)),Rt.alphaTest>0&&(Pt.alphaTest.value=Rt.alphaTest)}function ft(Pt,Rt){Pt.diffuse.value.copy(Rt.color),Pt.opacity.value=Rt.opacity,Pt.rotation.value=Rt.rotation,Rt.map&&(Pt.map.value=Rt.map,tt(Rt.map,Pt.mapTransform)),Rt.alphaMap&&(Pt.alphaMap.value=Rt.alphaMap,tt(Rt.alphaMap,Pt.alphaMapTransform)),Rt.alphaTest>0&&(Pt.alphaTest.value=Rt.alphaTest)}function gt(Pt,Rt){Pt.specular.value.copy(Rt.specular),Pt.shininess.value=Math.max(Rt.shininess,1e-4)}function Et(Pt,Rt){Rt.gradientMap&&(Pt.gradientMap.value=Rt.gradientMap)}function yt(Pt,Rt){Pt.metalness.value=Rt.metalness,Rt.metalnessMap&&(Pt.metalnessMap.value=Rt.metalnessMap,tt(Rt.metalnessMap,Pt.metalnessMapTransform)),Pt.roughness.value=Rt.roughness,Rt.roughnessMap&&(Pt.roughnessMap.value=Rt.roughnessMap,tt(Rt.roughnessMap,Pt.roughnessMapTransform)),_.get(Rt).envMap&&(Pt.envMapIntensity.value=Rt.envMapIntensity)}function Ct(Pt,Rt,xt){Pt.ior.value=Rt.ior,Rt.sheen>0&&(Pt.sheenColor.value.copy(Rt.sheenColor).multiplyScalar(Rt.sheen),Pt.sheenRoughness.value=Rt.sheenRoughness,Rt.sheenColorMap&&(Pt.sheenColorMap.value=Rt.sheenColorMap,tt(Rt.sheenColorMap,Pt.sheenColorMapTransform)),Rt.sheenRoughnessMap&&(Pt.sheenRoughnessMap.value=Rt.sheenRoughnessMap,tt(Rt.sheenRoughnessMap,Pt.sheenRoughnessMapTransform))),Rt.clearcoat>0&&(Pt.clearcoat.value=Rt.clearcoat,Pt.clearcoatRoughness.value=Rt.clearcoatRoughness,Rt.clearcoatMap&&(Pt.clearcoatMap.value=Rt.clearcoatMap,tt(Rt.clearcoatMap,Pt.clearcoatMapTransform)),Rt.clearcoatRoughnessMap&&(Pt.clearcoatRoughnessMap.value=Rt.clearcoatRoughnessMap,tt(Rt.clearcoatRoughnessMap,Pt.clearcoatRoughnessMapTransform)),Rt.clearcoatNormalMap&&(Pt.clearcoatNormalMap.value=Rt.clearcoatNormalMap,tt(Rt.clearcoatNormalMap,Pt.clearcoatNormalMapTransform),Pt.clearcoatNormalScale.value.copy(Rt.clearcoatNormalScale),Rt.side===BackSide&&Pt.clearcoatNormalScale.value.negate())),Rt.iridescence>0&&(Pt.iridescence.value=Rt.iridescence,Pt.iridescenceIOR.value=Rt.iridescenceIOR,Pt.iridescenceThicknessMinimum.value=Rt.iridescenceThicknessRange[0],Pt.iridescenceThicknessMaximum.value=Rt.iridescenceThicknessRange[1],Rt.iridescenceMap&&(Pt.iridescenceMap.value=Rt.iridescenceMap,tt(Rt.iridescenceMap,Pt.iridescenceMapTransform)),Rt.iridescenceThicknessMap&&(Pt.iridescenceThicknessMap.value=Rt.iridescenceThicknessMap,tt(Rt.iridescenceThicknessMap,Pt.iridescenceThicknessMapTransform))),Rt.transmission>0&&(Pt.transmission.value=Rt.transmission,Pt.transmissionSamplerMap.value=xt.texture,Pt.transmissionSamplerSize.value.set(xt.width,xt.height),Rt.transmissionMap&&(Pt.transmissionMap.value=Rt.transmissionMap,tt(Rt.transmissionMap,Pt.transmissionMapTransform)),Pt.thickness.value=Rt.thickness,Rt.thicknessMap&&(Pt.thicknessMap.value=Rt.thicknessMap,tt(Rt.thicknessMap,Pt.thicknessMapTransform)),Pt.attenuationDistance.value=Rt.attenuationDistance,Pt.attenuationColor.value.copy(Rt.attenuationColor)),Rt.anisotropy>0&&(Pt.anisotropyVector.value.set(Rt.anisotropy*Math.cos(Rt.anisotropyRotation),Rt.anisotropy*Math.sin(Rt.anisotropyRotation)),Rt.anisotropyMap&&(Pt.anisotropyMap.value=Rt.anisotropyMap,tt(Rt.anisotropyMap,Pt.anisotropyMapTransform))),Pt.specularIntensity.value=Rt.specularIntensity,Pt.specularColor.value.copy(Rt.specularColor),Rt.specularColorMap&&(Pt.specularColorMap.value=Rt.specularColorMap,tt(Rt.specularColorMap,Pt.specularColorMapTransform)),Rt.specularIntensityMap&&(Pt.specularIntensityMap.value=Rt.specularIntensityMap,tt(Rt.specularIntensityMap,Pt.specularIntensityMapTransform))}function wt(Pt,Rt){Rt.matcap&&(Pt.matcap.value=Rt.matcap)}function It(Pt,Rt){const xt=_.get(Rt).light;Pt.referencePosition.value.setFromMatrixPosition(xt.matrixWorld),Pt.nearDistance.value=xt.shadow.camera.near,Pt.farDistance.value=xt.shadow.camera.far}return{refreshFogUniforms:ot,refreshMaterialUniforms:st}}function WebGLUniformsGroups(nt,_,tt,ot){let st={},at={},lt=[];const dt=tt.isWebGL2?nt.getParameter(nt.MAX_UNIFORM_BUFFER_BINDINGS):0;function ht(xt,Nt){const kt=Nt.program;ot.uniformBlockBinding(xt,kt)}function ft(xt,Nt){let kt=st[xt.id];kt===void 0&&(wt(xt),kt=gt(xt),st[xt.id]=kt,xt.addEventListener("dispose",Pt));const Vt=Nt.program;ot.updateUBOMapping(xt,Vt);const Ft=_.render.frame;at[xt.id]!==Ft&&(yt(xt),at[xt.id]=Ft)}function gt(xt){const Nt=Et();xt.__bindingPointIndex=Nt;const kt=nt.createBuffer(),Vt=xt.__size,Ft=xt.usage;return nt.bindBuffer(nt.UNIFORM_BUFFER,kt),nt.bufferData(nt.UNIFORM_BUFFER,Vt,Ft),nt.bindBuffer(nt.UNIFORM_BUFFER,null),nt.bindBufferBase(nt.UNIFORM_BUFFER,Nt,kt),kt}function Et(){for(let xt=0;xt<dt;xt++)if(lt.indexOf(xt)===-1)return lt.push(xt),xt;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}function yt(xt){const Nt=st[xt.id],kt=xt.uniforms,Vt=xt.__cache;nt.bindBuffer(nt.UNIFORM_BUFFER,Nt);for(let Ft=0,zt=kt.length;Ft<zt;Ft++){const Yt=kt[Ft];if(Ct(Yt,Ft,Vt)===!0){const Kt=Yt.__offset,qt=Array.isArray(Yt.value)?Yt.value:[Yt.value];let pn=0;for(let an=0;an<qt.length;an++){const fn=qt[an],dn=It(fn);typeof fn=="number"?(Yt.__data[0]=fn,nt.bufferSubData(nt.UNIFORM_BUFFER,Kt+pn,Yt.__data)):fn.isMatrix3?(Yt.__data[0]=fn.elements[0],Yt.__data[1]=fn.elements[1],Yt.__data[2]=fn.elements[2],Yt.__data[3]=fn.elements[0],Yt.__data[4]=fn.elements[3],Yt.__data[5]=fn.elements[4],Yt.__data[6]=fn.elements[5],Yt.__data[7]=fn.elements[0],Yt.__data[8]=fn.elements[6],Yt.__data[9]=fn.elements[7],Yt.__data[10]=fn.elements[8],Yt.__data[11]=fn.elements[0]):(fn.toArray(Yt.__data,pn),pn+=dn.storage/Float32Array.BYTES_PER_ELEMENT)}nt.bufferSubData(nt.UNIFORM_BUFFER,Kt,Yt.__data)}}nt.bindBuffer(nt.UNIFORM_BUFFER,null)}function Ct(xt,Nt,kt){const Vt=xt.value;if(kt[Nt]===void 0){if(typeof Vt=="number")kt[Nt]=Vt;else{const Ft=Array.isArray(Vt)?Vt:[Vt],zt=[];for(let Yt=0;Yt<Ft.length;Yt++)zt.push(Ft[Yt].clone());kt[Nt]=zt}return!0}else if(typeof Vt=="number"){if(kt[Nt]!==Vt)return kt[Nt]=Vt,!0}else{const Ft=Array.isArray(kt[Nt])?kt[Nt]:[kt[Nt]],zt=Array.isArray(Vt)?Vt:[Vt];for(let Yt=0;Yt<Ft.length;Yt++){const Kt=Ft[Yt];if(Kt.equals(zt[Yt])===!1)return Kt.copy(zt[Yt]),!0}}return!1}function wt(xt){const Nt=xt.uniforms;let kt=0;const Vt=16;let Ft=0;for(let zt=0,Yt=Nt.length;zt<Yt;zt++){const Kt=Nt[zt],qt={boundary:0,storage:0},pn=Array.isArray(Kt.value)?Kt.value:[Kt.value];for(let an=0,fn=pn.length;an<fn;an++){const dn=pn[an],Cn=It(dn);qt.boundary+=Cn.boundary,qt.storage+=Cn.storage}if(Kt.__data=new Float32Array(qt.storage/Float32Array.BYTES_PER_ELEMENT),Kt.__offset=kt,zt>0){Ft=kt%Vt;const an=Vt-Ft;Ft!==0&&an-qt.boundary<0&&(kt+=Vt-Ft,Kt.__offset=kt)}kt+=qt.storage}return Ft=kt%Vt,Ft>0&&(kt+=Vt-Ft),xt.__size=kt,xt.__cache={},this}function It(xt){const Nt={boundary:0,storage:0};return typeof xt=="number"?(Nt.boundary=4,Nt.storage=4):xt.isVector2?(Nt.boundary=8,Nt.storage=8):xt.isVector3||xt.isColor?(Nt.boundary=16,Nt.storage=12):xt.isVector4?(Nt.boundary=16,Nt.storage=16):xt.isMatrix3?(Nt.boundary=48,Nt.storage=48):xt.isMatrix4?(Nt.boundary=64,Nt.storage=64):xt.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",xt),Nt}function Pt(xt){const Nt=xt.target;Nt.removeEventListener("dispose",Pt);const kt=lt.indexOf(Nt.__bindingPointIndex);lt.splice(kt,1),nt.deleteBuffer(st[Nt.id]),delete st[Nt.id],delete at[Nt.id]}function Rt(){for(const xt in st)nt.deleteBuffer(st[xt]);lt=[],st={},at={}}return{bind:ht,update:ft,dispose:Rt}}function createCanvasElement(){const nt=createElementNS("canvas");return nt.style.display="block",nt}class WebGLRenderer{constructor(_={}){const{canvas:tt=createCanvasElement(),context:ot=null,depth:st=!0,stencil:at=!0,alpha:lt=!1,antialias:dt=!1,premultipliedAlpha:ht=!0,preserveDrawingBuffer:ft=!1,powerPreference:gt="default",failIfMajorPerformanceCaveat:Et=!1}=_;this.isWebGLRenderer=!0;let yt;ot!==null?yt=ot.getContextAttributes().alpha:yt=lt;const Ct=new Uint32Array(4),wt=new Int32Array(4);let It=null,Pt=null;const Rt=[],xt=[];this.domElement=tt,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.outputColorSpace=SRGBColorSpace$1,this.useLegacyLights=!0,this.toneMapping=NoToneMapping,this.toneMappingExposure=1;const Nt=this;let kt=!1,Vt=0,Ft=0,zt=null,Yt=-1,Kt=null;const qt=new Vector4,pn=new Vector4;let an=null;const fn=new Color$1(0);let dn=0,Cn=tt.width,On=tt.height,Pn=1,yn=null,An=null;const Sn=new Vector4(0,0,Cn,On),gn=new Vector4(0,0,Cn,On);let _n=!1;const Rn=new Frustum;let bn=!1,jn=!1,kn=null;const Gn=new Matrix4,Vn=new Vector2,qn=new Vector3,Tr={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function Mn(){return zt===null?Pn:1}let Zt=ot;function wn(Xt,mn){for(let Nn=0;Nn<Xt.length;Nn++){const In=Xt[Nn],Un=tt.getContext(In,mn);if(Un!==null)return Un}return null}try{const Xt={alpha:!0,depth:st,stencil:at,antialias:dt,premultipliedAlpha:ht,preserveDrawingBuffer:ft,powerPreference:gt,failIfMajorPerformanceCaveat:Et};if("setAttribute"in tt&&tt.setAttribute("data-engine",`three.js r${REVISION}`),tt.addEventListener("webglcontextlost",ar,!1),tt.addEventListener("webglcontextrestored",pr,!1),tt.addEventListener("webglcontextcreationerror",Wr,!1),Zt===null){const mn=["webgl2","webgl","experimental-webgl"];if(Nt.isWebGL1Renderer===!0&&mn.shift(),Zt=wn(mn,Xt),Zt===null)throw wn(mn)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}Zt instanceof WebGLRenderingContext&&console.warn("THREE.WebGLRenderer: WebGL 1 support was deprecated in r153 and will be removed in r163."),Zt.getShaderPrecisionFormat===void 0&&(Zt.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(Xt){throw console.error("THREE.WebGLRenderer: "+Xt.message),Xt}let xn,Hn,Bn,cr,Wn,rr,sr,ir,kr,un,sn,Kn,Sr,lr,vr,Fr,Gr,dr,Hr,zr,Nr,Or,Ur,Zr;function oo(){xn=new WebGLExtensions(Zt),Hn=new WebGLCapabilities(Zt,xn,_),xn.init(Hn),Or=new WebGLUtils(Zt,xn,Hn),Bn=new WebGLState(Zt,xn,Hn),cr=new WebGLInfo(Zt),Wn=new WebGLProperties,rr=new WebGLTextures(Zt,xn,Bn,Wn,Hn,Or,cr),sr=new WebGLCubeMaps(Nt),ir=new WebGLCubeUVMaps(Nt),kr=new WebGLAttributes(Zt,Hn),Ur=new WebGLBindingStates(Zt,xn,kr,Hn),un=new WebGLGeometries(Zt,kr,cr,Ur),sn=new WebGLObjects(Zt,un,kr,cr),Hr=new WebGLMorphtargets(Zt,Hn,rr),Fr=new WebGLClipping(Wn),Kn=new WebGLPrograms(Nt,sr,ir,xn,Hn,Ur,Fr),Sr=new WebGLMaterials(Nt,Wn),lr=new WebGLRenderLists,vr=new WebGLRenderStates(xn,Hn),dr=new WebGLBackground(Nt,sr,ir,Bn,sn,yt,ht),Gr=new WebGLShadowMap(Nt,sn,Hn),Zr=new WebGLUniformsGroups(Zt,cr,Hn,Bn),zr=new WebGLBufferRenderer(Zt,xn,cr,Hn),Nr=new WebGLIndexedBufferRenderer(Zt,xn,cr,Hn),cr.programs=Kn.programs,Nt.capabilities=Hn,Nt.extensions=xn,Nt.properties=Wn,Nt.renderLists=lr,Nt.shadowMap=Gr,Nt.state=Bn,Nt.info=cr}oo();const zn=new WebXRManager(Nt,Zt);this.xr=zn,this.getContext=function(){return Zt},this.getContextAttributes=function(){return Zt.getContextAttributes()},this.forceContextLoss=function(){const Xt=xn.get("WEBGL_lose_context");Xt&&Xt.loseContext()},this.forceContextRestore=function(){const Xt=xn.get("WEBGL_lose_context");Xt&&Xt.restoreContext()},this.getPixelRatio=function(){return Pn},this.setPixelRatio=function(Xt){Xt!==void 0&&(Pn=Xt,this.setSize(Cn,On,!1))},this.getSize=function(Xt){return Xt.set(Cn,On)},this.setSize=function(Xt,mn,Nn=!0){if(zn.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}Cn=Xt,On=mn,tt.width=Math.floor(Xt*Pn),tt.height=Math.floor(mn*Pn),Nn===!0&&(tt.style.width=Xt+"px",tt.style.height=mn+"px"),this.setViewport(0,0,Xt,mn)},this.getDrawingBufferSize=function(Xt){return Xt.set(Cn*Pn,On*Pn).floor()},this.setDrawingBufferSize=function(Xt,mn,Nn){Cn=Xt,On=mn,Pn=Nn,tt.width=Math.floor(Xt*Nn),tt.height=Math.floor(mn*Nn),this.setViewport(0,0,Xt,mn)},this.getCurrentViewport=function(Xt){return Xt.copy(qt)},this.getViewport=function(Xt){return Xt.copy(Sn)},this.setViewport=function(Xt,mn,Nn,In){Xt.isVector4?Sn.set(Xt.x,Xt.y,Xt.z,Xt.w):Sn.set(Xt,mn,Nn,In),Bn.viewport(qt.copy(Sn).multiplyScalar(Pn).floor())},this.getScissor=function(Xt){return Xt.copy(gn)},this.setScissor=function(Xt,mn,Nn,In){Xt.isVector4?gn.set(Xt.x,Xt.y,Xt.z,Xt.w):gn.set(Xt,mn,Nn,In),Bn.scissor(pn.copy(gn).multiplyScalar(Pn).floor())},this.getScissorTest=function(){return _n},this.setScissorTest=function(Xt){Bn.setScissorTest(_n=Xt)},this.setOpaqueSort=function(Xt){yn=Xt},this.setTransparentSort=function(Xt){An=Xt},this.getClearColor=function(Xt){return Xt.copy(dr.getClearColor())},this.setClearColor=function(){dr.setClearColor.apply(dr,arguments)},this.getClearAlpha=function(){return dr.getClearAlpha()},this.setClearAlpha=function(){dr.setClearAlpha.apply(dr,arguments)},this.clear=function(Xt=!0,mn=!0,Nn=!0){let In=0;if(Xt){let Un=!1;if(zt!==null){const mr=zt.texture.format;Un=mr===RGBAIntegerFormat||mr===RGIntegerFormat||mr===RedIntegerFormat}if(Un){const mr=zt.texture.type,gr=mr===UnsignedByteType||mr===UnsignedIntType||mr===UnsignedShortType||mr===UnsignedInt248Type||mr===UnsignedShort4444Type||mr===UnsignedShort5551Type,br=dr.getClearColor(),Rr=dr.getClearAlpha(),wr=br.r,tr=br.g,to=br.b,$r=Wn.get(zt).__webglFramebuffer;gr?(Ct[0]=wr,Ct[1]=tr,Ct[2]=to,Ct[3]=Rr,Zt.clearBufferuiv(Zt.COLOR,$r,Ct)):(wt[0]=wr,wt[1]=tr,wt[2]=to,wt[3]=Rr,Zt.clearBufferiv(Zt.COLOR,$r,wt))}else In|=Zt.COLOR_BUFFER_BIT}mn&&(In|=Zt.DEPTH_BUFFER_BIT),Nn&&(In|=Zt.STENCIL_BUFFER_BIT),Zt.clear(In)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){tt.removeEventListener("webglcontextlost",ar,!1),tt.removeEventListener("webglcontextrestored",pr,!1),tt.removeEventListener("webglcontextcreationerror",Wr,!1),lr.dispose(),vr.dispose(),Wn.dispose(),sr.dispose(),ir.dispose(),sn.dispose(),Ur.dispose(),Zr.dispose(),Kn.dispose(),zn.dispose(),zn.removeEventListener("sessionstart",Ms),zn.removeEventListener("sessionend",ys),kn&&(kn.dispose(),kn=null),bo.stop()};function ar(Xt){Xt.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),kt=!0}function pr(){console.log("THREE.WebGLRenderer: Context Restored."),kt=!1;const Xt=cr.autoReset,mn=Gr.enabled,Nn=Gr.autoUpdate,In=Gr.needsUpdate,Un=Gr.type;oo(),cr.autoReset=Xt,Gr.enabled=mn,Gr.autoUpdate=Nn,Gr.needsUpdate=In,Gr.type=Un}function Wr(Xt){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",Xt.statusMessage)}function Qr(Xt){const mn=Xt.target;mn.removeEventListener("dispose",Qr),ko(mn)}function ko(Xt){os(Xt),Wn.remove(Xt)}function os(Xt){const mn=Wn.get(Xt).programs;mn!==void 0&&(mn.forEach(function(Nn){Kn.releaseProgram(Nn)}),Xt.isShaderMaterial&&Kn.releaseShaderCache(Xt))}this.renderBufferDirect=function(Xt,mn,Nn,In,Un,mr){mn===null&&(mn=Tr);const gr=Un.isMesh&&Un.matrixWorld.determinant()<0,br=wl(Xt,mn,Nn,In,Un);Bn.setMaterial(In,gr);let Rr=Nn.index,wr=1;In.wireframe===!0&&(Rr=un.getWireframeAttribute(Nn),wr=2);const tr=Nn.drawRange,to=Nn.attributes.position;let $r=tr.start*wr,Yr=(tr.start+tr.count)*wr;mr!==null&&($r=Math.max($r,mr.start*wr),Yr=Math.min(Yr,(mr.start+mr.count)*wr)),Rr!==null?($r=Math.max($r,0),Yr=Math.min(Yr,Rr.count)):to!=null&&($r=Math.max($r,0),Yr=Math.min(Yr,to.count));const _o=Yr-$r;if(_o<0||_o===1/0)return;Ur.setup(Un,In,br,Nn,Rr);let Ro,yo=zr;if(Rr!==null&&(Ro=kr.get(Rr),yo=Nr,yo.setIndex(Ro)),Un.isMesh)In.wireframe===!0?(Bn.setLineWidth(In.wireframeLinewidth*Mn()),yo.setMode(Zt.LINES)):yo.setMode(Zt.TRIANGLES);else if(Un.isLine){let eo=In.linewidth;eo===void 0&&(eo=1),Bn.setLineWidth(eo*Mn()),Un.isLineSegments?yo.setMode(Zt.LINES):Un.isLineLoop?yo.setMode(Zt.LINE_LOOP):yo.setMode(Zt.LINE_STRIP)}else Un.isPoints?yo.setMode(Zt.POINTS):Un.isSprite&&yo.setMode(Zt.TRIANGLES);if(Un.isInstancedMesh)yo.renderInstances($r,_o,Un.count);else if(Nn.isInstancedBufferGeometry){const eo=Nn._maxInstanceCount!==void 0?Nn._maxInstanceCount:1/0,Io=Math.min(Nn.instanceCount,eo);yo.renderInstances($r,_o,Io)}else yo.render($r,_o)},this.compile=function(Xt,mn){function Nn(In,Un,mr){In.transparent===!0&&In.side===DoubleSide&&In.forceSinglePass===!1?(In.side=BackSide,In.needsUpdate=!0,Is(In,Un,mr),In.side=FrontSide,In.needsUpdate=!0,Is(In,Un,mr),In.side=DoubleSide):Is(In,Un,mr)}Pt=vr.get(Xt),Pt.init(),xt.push(Pt),Xt.traverseVisible(function(In){In.isLight&&In.layers.test(mn.layers)&&(Pt.pushLight(In),In.castShadow&&Pt.pushShadow(In))}),Pt.setupLights(Nt.useLegacyLights),Xt.traverse(function(In){const Un=In.material;if(Un)if(Array.isArray(Un))for(let mr=0;mr<Un.length;mr++){const gr=Un[mr];Nn(gr,Xt,In)}else Nn(Un,Xt,In)}),xt.pop(),Pt=null};let Jo=null;function ws(Xt){Jo&&Jo(Xt)}function Ms(){bo.stop()}function ys(){bo.start()}const bo=new WebGLAnimation;bo.setAnimationLoop(ws),typeof self<"u"&&bo.setContext(self),this.setAnimationLoop=function(Xt){Jo=Xt,zn.setAnimationLoop(Xt),Xt===null?bo.stop():bo.start()},zn.addEventListener("sessionstart",Ms),zn.addEventListener("sessionend",ys),this.render=function(Xt,mn){if(mn!==void 0&&mn.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(kt===!0)return;Xt.matrixWorldAutoUpdate===!0&&Xt.updateMatrixWorld(),mn.parent===null&&mn.matrixWorldAutoUpdate===!0&&mn.updateMatrixWorld(),zn.enabled===!0&&zn.isPresenting===!0&&(mn=zn.updateCameraXR(mn)),Xt.isScene===!0&&Xt.onBeforeRender(Nt,Xt,mn,zt),Pt=vr.get(Xt,xt.length),Pt.init(),xt.push(Pt),Gn.multiplyMatrices(mn.projectionMatrix,mn.matrixWorldInverse),Rn.setFromProjectionMatrix(Gn),jn=this.localClippingEnabled,bn=Fr.init(this.clippingPlanes,jn),It=lr.get(Xt,Rt.length),It.init(),Rt.push(It),mu(Xt,mn,0,Nt.sortObjects),It.finish(),Nt.sortObjects===!0&&It.sort(yn,An),bn===!0&&Fr.beginShadows();const Nn=Pt.state.shadowsArray;if(Gr.render(Nn,Xt,mn),bn===!0&&Fr.endShadows(),this.info.autoReset===!0&&this.info.reset(),this.info.render.frame++,dr.render(It,Xt),Pt.setupLights(Nt.useLegacyLights),mn.isArrayCamera){const In=mn.cameras;for(let Un=0,mr=In.length;Un<mr;Un++){const gr=In[Un];Xl(It,Xt,gr,gr.viewport)}}else Xl(It,Xt,mn);zt!==null&&(rr.updateMultisampleRenderTarget(zt),rr.updateRenderTargetMipmap(zt)),Xt.isScene===!0&&Xt.onAfterRender(Nt,Xt,mn),Ur.resetDefaultState(),Yt=-1,Kt=null,xt.pop(),xt.length>0?Pt=xt[xt.length-1]:Pt=null,Rt.pop(),Rt.length>0?It=Rt[Rt.length-1]:It=null};function mu(Xt,mn,Nn,In){if(Xt.visible===!1)return;if(Xt.layers.test(mn.layers)){if(Xt.isGroup)Nn=Xt.renderOrder;else if(Xt.isLOD)Xt.autoUpdate===!0&&Xt.update(mn);else if(Xt.isLight)Pt.pushLight(Xt),Xt.castShadow&&Pt.pushShadow(Xt);else if(Xt.isSprite){if(!Xt.frustumCulled||Rn.intersectsSprite(Xt)){In&&qn.setFromMatrixPosition(Xt.matrixWorld).applyMatrix4(Gn);const gr=sn.update(Xt),br=Xt.material;br.visible&&It.push(Xt,gr,br,Nn,qn.z,null)}}else if((Xt.isMesh||Xt.isLine||Xt.isPoints)&&(!Xt.frustumCulled||Rn.intersectsObject(Xt))){Xt.isSkinnedMesh&&Xt.skeleton.frame!==cr.render.frame&&(Xt.skeleton.update(),Xt.skeleton.frame=cr.render.frame);const gr=sn.update(Xt),br=Xt.material;if(In&&(Xt.boundingSphere!==void 0?(Xt.boundingSphere===null&&Xt.computeBoundingSphere(),qn.copy(Xt.boundingSphere.center)):(gr.boundingSphere===null&&gr.computeBoundingSphere(),qn.copy(gr.boundingSphere.center)),qn.applyMatrix4(Xt.matrixWorld).applyMatrix4(Gn)),Array.isArray(br)){const Rr=gr.groups;for(let wr=0,tr=Rr.length;wr<tr;wr++){const to=Rr[wr],$r=br[to.materialIndex];$r&&$r.visible&&It.push(Xt,gr,$r,Nn,qn.z,to)}}else br.visible&&It.push(Xt,gr,br,Nn,qn.z,null)}}const mr=Xt.children;for(let gr=0,br=mr.length;gr<br;gr++)mu(mr[gr],mn,Nn,In)}function Xl(Xt,mn,Nn,In){const Un=Xt.opaque,mr=Xt.transmissive,gr=Xt.transparent;Pt.setupLightsView(Nn),bn===!0&&Fr.setGlobalState(Nt.clippingPlanes,Nn),mr.length>0&&ss(Un,mr,mn,Nn),In&&Bn.viewport(qt.copy(In)),Un.length>0&&js(Un,mn,Nn),mr.length>0&&js(mr,mn,Nn),gr.length>0&&js(gr,mn,Nn),Bn.buffers.depth.setTest(!0),Bn.buffers.depth.setMask(!0),Bn.buffers.color.setMask(!0),Bn.setPolygonOffset(!1)}function ss(Xt,mn,Nn,In){const Un=Hn.isWebGL2;kn===null&&(kn=new WebGLRenderTarget(1,1,{generateMipmaps:!0,type:xn.has("EXT_color_buffer_half_float")?HalfFloatType:UnsignedByteType,minFilter:LinearMipmapLinearFilter,samples:Un&&dt===!0?4:0})),Nt.getDrawingBufferSize(Vn),Un?kn.setSize(Vn.x,Vn.y):kn.setSize(floorPowerOfTwo(Vn.x),floorPowerOfTwo(Vn.y));const mr=Nt.getRenderTarget();Nt.setRenderTarget(kn),Nt.getClearColor(fn),dn=Nt.getClearAlpha(),dn<1&&Nt.setClearColor(16777215,.5),Nt.clear();const gr=Nt.toneMapping;Nt.toneMapping=NoToneMapping,js(Xt,Nn,In),rr.updateMultisampleRenderTarget(kn),rr.updateRenderTargetMipmap(kn);let br=!1;for(let Rr=0,wr=mn.length;Rr<wr;Rr++){const tr=mn[Rr],to=tr.object,$r=tr.geometry,Yr=tr.material,_o=tr.group;if(Yr.side===DoubleSide&&to.layers.test(In.layers)){const Ro=Yr.side;Yr.side=BackSide,Yr.needsUpdate=!0,_l(to,Nn,In,$r,Yr,_o),Yr.side=Ro,Yr.needsUpdate=!0,br=!0}}br===!0&&(rr.updateMultisampleRenderTarget(kn),rr.updateRenderTargetMipmap(kn)),Nt.setRenderTarget(mr),Nt.setClearColor(fn,dn),Nt.toneMapping=gr}function js(Xt,mn,Nn){const In=mn.isScene===!0?mn.overrideMaterial:null;for(let Un=0,mr=Xt.length;Un<mr;Un++){const gr=Xt[Un],br=gr.object,Rr=gr.geometry,wr=In===null?gr.material:In,tr=gr.group;br.layers.test(Nn.layers)&&_l(br,mn,Nn,Rr,wr,tr)}}function _l(Xt,mn,Nn,In,Un,mr){Xt.onBeforeRender(Nt,mn,Nn,In,Un,mr),Xt.modelViewMatrix.multiplyMatrices(Nn.matrixWorldInverse,Xt.matrixWorld),Xt.normalMatrix.getNormalMatrix(Xt.modelViewMatrix),Un.onBeforeRender(Nt,mn,Nn,In,Xt,mr),Un.transparent===!0&&Un.side===DoubleSide&&Un.forceSinglePass===!1?(Un.side=BackSide,Un.needsUpdate=!0,Nt.renderBufferDirect(Nn,mn,In,Un,Xt,mr),Un.side=FrontSide,Un.needsUpdate=!0,Nt.renderBufferDirect(Nn,mn,In,Un,Xt,mr),Un.side=DoubleSide):Nt.renderBufferDirect(Nn,mn,In,Un,Xt,mr),Xt.onAfterRender(Nt,mn,Nn,In,Un,mr)}function Is(Xt,mn,Nn){mn.isScene!==!0&&(mn=Tr);const In=Wn.get(Xt),Un=Pt.state.lights,mr=Pt.state.shadowsArray,gr=Un.state.version,br=Kn.getParameters(Xt,Un.state,mr,mn,Nn),Rr=Kn.getProgramCacheKey(br);let wr=In.programs;In.environment=Xt.isMeshStandardMaterial?mn.environment:null,In.fog=mn.fog,In.envMap=(Xt.isMeshStandardMaterial?ir:sr).get(Xt.envMap||In.environment),wr===void 0&&(Xt.addEventListener("dispose",Qr),wr=new Map,In.programs=wr);let tr=wr.get(Rr);if(tr!==void 0){if(In.currentProgram===tr&&In.lightsStateVersion===gr)return vo(Xt,br),tr}else br.uniforms=Kn.getUniforms(Xt),Xt.onBuild(Nn,br,Nt),Xt.onBeforeCompile(br,Nt),tr=Kn.acquireProgram(br,Rr),wr.set(Rr,tr),In.uniforms=br.uniforms;const to=In.uniforms;(!Xt.isShaderMaterial&&!Xt.isRawShaderMaterial||Xt.clipping===!0)&&(to.clippingPlanes=Fr.uniform),vo(Xt,br),In.needsLights=cn(Xt),In.lightsStateVersion=gr,In.needsLights&&(to.ambientLightColor.value=Un.state.ambient,to.lightProbe.value=Un.state.probe,to.directionalLights.value=Un.state.directional,to.directionalLightShadows.value=Un.state.directionalShadow,to.spotLights.value=Un.state.spot,to.spotLightShadows.value=Un.state.spotShadow,to.rectAreaLights.value=Un.state.rectArea,to.ltc_1.value=Un.state.rectAreaLTC1,to.ltc_2.value=Un.state.rectAreaLTC2,to.pointLights.value=Un.state.point,to.pointLightShadows.value=Un.state.pointShadow,to.hemisphereLights.value=Un.state.hemi,to.directionalShadowMap.value=Un.state.directionalShadowMap,to.directionalShadowMatrix.value=Un.state.directionalShadowMatrix,to.spotShadowMap.value=Un.state.spotShadowMap,to.spotLightMatrix.value=Un.state.spotLightMatrix,to.spotLightMap.value=Un.state.spotLightMap,to.pointShadowMap.value=Un.state.pointShadowMap,to.pointShadowMatrix.value=Un.state.pointShadowMatrix);const $r=tr.getUniforms(),Yr=WebGLUniforms.seqWithValue($r.seq,to);return In.currentProgram=tr,In.uniformsList=Yr,tr}function vo(Xt,mn){const Nn=Wn.get(Xt);Nn.outputColorSpace=mn.outputColorSpace,Nn.instancing=mn.instancing,Nn.skinning=mn.skinning,Nn.morphTargets=mn.morphTargets,Nn.morphNormals=mn.morphNormals,Nn.morphColors=mn.morphColors,Nn.morphTargetsCount=mn.morphTargetsCount,Nn.numClippingPlanes=mn.numClippingPlanes,Nn.numIntersection=mn.numClipIntersection,Nn.vertexAlphas=mn.vertexAlphas,Nn.vertexTangents=mn.vertexTangents,Nn.toneMapping=mn.toneMapping}function wl(Xt,mn,Nn,In,Un){mn.isScene!==!0&&(mn=Tr),rr.resetTextureUnits();const mr=mn.fog,gr=In.isMeshStandardMaterial?mn.environment:null,br=zt===null?Nt.outputColorSpace:zt.isXRRenderTarget===!0?zt.texture.colorSpace:LinearSRGBColorSpace$1,Rr=(In.isMeshStandardMaterial?ir:sr).get(In.envMap||gr),wr=In.vertexColors===!0&&!!Nn.attributes.color&&Nn.attributes.color.itemSize===4,tr=!!Nn.attributes.tangent&&(!!In.normalMap||In.anisotropy>0),to=!!Nn.morphAttributes.position,$r=!!Nn.morphAttributes.normal,Yr=!!Nn.morphAttributes.color,_o=In.toneMapped?Nt.toneMapping:NoToneMapping,Ro=Nn.morphAttributes.position||Nn.morphAttributes.normal||Nn.morphAttributes.color,yo=Ro!==void 0?Ro.length:0,eo=Wn.get(In),Io=Pt.state.lights;if(bn===!0&&(jn===!0||Xt!==Kt)){const $o=Xt===Kt&&In.id===Yt;Fr.setState(In,Xt,$o)}let fo=!1;In.version===eo.__version?(eo.needsLights&&eo.lightsStateVersion!==Io.state.version||eo.outputColorSpace!==br||Un.isInstancedMesh&&eo.instancing===!1||!Un.isInstancedMesh&&eo.instancing===!0||Un.isSkinnedMesh&&eo.skinning===!1||!Un.isSkinnedMesh&&eo.skinning===!0||eo.envMap!==Rr||In.fog===!0&&eo.fog!==mr||eo.numClippingPlanes!==void 0&&(eo.numClippingPlanes!==Fr.numPlanes||eo.numIntersection!==Fr.numIntersection)||eo.vertexAlphas!==wr||eo.vertexTangents!==tr||eo.morphTargets!==to||eo.morphNormals!==$r||eo.morphColors!==Yr||eo.toneMapping!==_o||Hn.isWebGL2===!0&&eo.morphTargetsCount!==yo)&&(fo=!0):(fo=!0,eo.__version=In.version);let Go=eo.currentProgram;fo===!0&&(Go=Is(In,mn,Un));let Ps=!1,Uo=!1,_s=!1;const as=Go.getUniforms(),ks=eo.uniforms;if(Bn.useProgram(Go.program)&&(Ps=!0,Uo=!0,_s=!0),In.id!==Yt&&(Yt=In.id,Uo=!0),Ps||Kt!==Xt){if(as.setValue(Zt,"projectionMatrix",Xt.projectionMatrix),Hn.logarithmicDepthBuffer&&as.setValue(Zt,"logDepthBufFC",2/(Math.log(Xt.far+1)/Math.LN2)),Kt!==Xt&&(Kt=Xt,Uo=!0,_s=!0),In.isShaderMaterial||In.isMeshPhongMaterial||In.isMeshToonMaterial||In.isMeshStandardMaterial||In.envMap){const $o=as.map.cameraPosition;$o!==void 0&&$o.setValue(Zt,qn.setFromMatrixPosition(Xt.matrixWorld))}(In.isMeshPhongMaterial||In.isMeshToonMaterial||In.isMeshLambertMaterial||In.isMeshBasicMaterial||In.isMeshStandardMaterial||In.isShaderMaterial)&&as.setValue(Zt,"isOrthographic",Xt.isOrthographicCamera===!0),(In.isMeshPhongMaterial||In.isMeshToonMaterial||In.isMeshLambertMaterial||In.isMeshBasicMaterial||In.isMeshStandardMaterial||In.isShaderMaterial||In.isShadowMaterial||Un.isSkinnedMesh)&&as.setValue(Zt,"viewMatrix",Xt.matrixWorldInverse)}if(Un.isSkinnedMesh){as.setOptional(Zt,Un,"bindMatrix"),as.setOptional(Zt,Un,"bindMatrixInverse");const $o=Un.skeleton;$o&&(Hn.floatVertexTextures?($o.boneTexture===null&&$o.computeBoneTexture(),as.setValue(Zt,"boneTexture",$o.boneTexture,rr),as.setValue(Zt,"boneTextureSize",$o.boneTextureSize)):console.warn("THREE.WebGLRenderer: SkinnedMesh can only be used with WebGL 2. With WebGL 1 OES_texture_float and vertex textures support is required."))}const xo=Nn.morphAttributes;if((xo.position!==void 0||xo.normal!==void 0||xo.color!==void 0&&Hn.isWebGL2===!0)&&Hr.update(Un,Nn,Go),(Uo||eo.receiveShadow!==Un.receiveShadow)&&(eo.receiveShadow=Un.receiveShadow,as.setValue(Zt,"receiveShadow",Un.receiveShadow)),In.isMeshGouraudMaterial&&In.envMap!==null&&(ks.envMap.value=Rr,ks.flipEnvMap.value=Rr.isCubeTexture&&Rr.isRenderTargetTexture===!1?-1:1),Uo&&(as.setValue(Zt,"toneMappingExposure",Nt.toneMappingExposure),eo.needsLights&&ju(ks,_s),mr&&In.fog===!0&&Sr.refreshFogUniforms(ks,mr),Sr.refreshMaterialUniforms(ks,In,Pn,On,kn),WebGLUniforms.upload(Zt,eo.uniformsList,ks,rr)),In.isShaderMaterial&&In.uniformsNeedUpdate===!0&&(WebGLUniforms.upload(Zt,eo.uniformsList,ks,rr),In.uniformsNeedUpdate=!1),In.isSpriteMaterial&&as.setValue(Zt,"center",Un.center),as.setValue(Zt,"modelViewMatrix",Un.modelViewMatrix),as.setValue(Zt,"normalMatrix",Un.normalMatrix),as.setValue(Zt,"modelMatrix",Un.matrixWorld),In.isShaderMaterial||In.isRawShaderMaterial){const $o=In.uniformsGroups;for(let Xs=0,As=$o.length;Xs<As;Xs++)if(Hn.isWebGL2){const zo=$o[Xs];Zr.update(zo,Go),Zr.bind(zo,Go)}else console.warn("THREE.WebGLRenderer: Uniform Buffer Objects can only be used with WebGL 2.")}return Go}function ju(Xt,mn){Xt.ambientLightColor.needsUpdate=mn,Xt.lightProbe.needsUpdate=mn,Xt.directionalLights.needsUpdate=mn,Xt.directionalLightShadows.needsUpdate=mn,Xt.pointLights.needsUpdate=mn,Xt.pointLightShadows.needsUpdate=mn,Xt.spotLights.needsUpdate=mn,Xt.spotLightShadows.needsUpdate=mn,Xt.rectAreaLights.needsUpdate=mn,Xt.hemisphereLights.needsUpdate=mn}function cn(Xt){return Xt.isMeshLambertMaterial||Xt.isMeshToonMaterial||Xt.isMeshPhongMaterial||Xt.isMeshStandardMaterial||Xt.isShadowMaterial||Xt.isShaderMaterial&&Xt.lights===!0}this.getActiveCubeFace=function(){return Vt},this.getActiveMipmapLevel=function(){return Ft},this.getRenderTarget=function(){return zt},this.setRenderTargetTextures=function(Xt,mn,Nn){Wn.get(Xt.texture).__webglTexture=mn,Wn.get(Xt.depthTexture).__webglTexture=Nn;const In=Wn.get(Xt);In.__hasExternalTextures=!0,In.__hasExternalTextures&&(In.__autoAllocateDepthBuffer=Nn===void 0,In.__autoAllocateDepthBuffer||xn.has("WEBGL_multisampled_render_to_texture")===!0&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),In.__useRenderToTexture=!1))},this.setRenderTargetFramebuffer=function(Xt,mn){const Nn=Wn.get(Xt);Nn.__webglFramebuffer=mn,Nn.__useDefaultFramebuffer=mn===void 0},this.setRenderTarget=function(Xt,mn=0,Nn=0){zt=Xt,Vt=mn,Ft=Nn;let In=!0,Un=null,mr=!1,gr=!1;if(Xt){const Rr=Wn.get(Xt);Rr.__useDefaultFramebuffer!==void 0?(Bn.bindFramebuffer(Zt.FRAMEBUFFER,null),In=!1):Rr.__webglFramebuffer===void 0?rr.setupRenderTarget(Xt):Rr.__hasExternalTextures&&rr.rebindTextures(Xt,Wn.get(Xt.texture).__webglTexture,Wn.get(Xt.depthTexture).__webglTexture);const wr=Xt.texture;(wr.isData3DTexture||wr.isDataArrayTexture||wr.isCompressedArrayTexture)&&(gr=!0);const tr=Wn.get(Xt).__webglFramebuffer;Xt.isWebGLCubeRenderTarget?(Un=tr[mn],mr=!0):Hn.isWebGL2&&Xt.samples>0&&rr.useMultisampledRTT(Xt)===!1?Un=Wn.get(Xt).__webglMultisampledFramebuffer:Un=tr,qt.copy(Xt.viewport),pn.copy(Xt.scissor),an=Xt.scissorTest}else qt.copy(Sn).multiplyScalar(Pn).floor(),pn.copy(gn).multiplyScalar(Pn).floor(),an=_n;if(Bn.bindFramebuffer(Zt.FRAMEBUFFER,Un)&&Hn.drawBuffers&&In&&Bn.drawBuffers(Xt,Un),Bn.viewport(qt),Bn.scissor(pn),Bn.setScissorTest(an),mr){const Rr=Wn.get(Xt.texture);Zt.framebufferTexture2D(Zt.FRAMEBUFFER,Zt.COLOR_ATTACHMENT0,Zt.TEXTURE_CUBE_MAP_POSITIVE_X+mn,Rr.__webglTexture,Nn)}else if(gr){const Rr=Wn.get(Xt.texture),wr=mn||0;Zt.framebufferTextureLayer(Zt.FRAMEBUFFER,Zt.COLOR_ATTACHMENT0,Rr.__webglTexture,Nn||0,wr)}Yt=-1},this.readRenderTargetPixels=function(Xt,mn,Nn,In,Un,mr,gr){if(!(Xt&&Xt.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let br=Wn.get(Xt).__webglFramebuffer;if(Xt.isWebGLCubeRenderTarget&&gr!==void 0&&(br=br[gr]),br){Bn.bindFramebuffer(Zt.FRAMEBUFFER,br);try{const Rr=Xt.texture,wr=Rr.format,tr=Rr.type;if(wr!==RGBAFormat&&Or.convert(wr)!==Zt.getParameter(Zt.IMPLEMENTATION_COLOR_READ_FORMAT)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}const to=tr===HalfFloatType&&(xn.has("EXT_color_buffer_half_float")||Hn.isWebGL2&&xn.has("EXT_color_buffer_float"));if(tr!==UnsignedByteType&&Or.convert(tr)!==Zt.getParameter(Zt.IMPLEMENTATION_COLOR_READ_TYPE)&&!(tr===FloatType&&(Hn.isWebGL2||xn.has("OES_texture_float")||xn.has("WEBGL_color_buffer_float")))&&!to){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}mn>=0&&mn<=Xt.width-In&&Nn>=0&&Nn<=Xt.height-Un&&Zt.readPixels(mn,Nn,In,Un,Or.convert(wr),Or.convert(tr),mr)}finally{const Rr=zt!==null?Wn.get(zt).__webglFramebuffer:null;Bn.bindFramebuffer(Zt.FRAMEBUFFER,Rr)}}},this.copyFramebufferToTexture=function(Xt,mn,Nn=0){const In=Math.pow(2,-Nn),Un=Math.floor(mn.image.width*In),mr=Math.floor(mn.image.height*In);rr.setTexture2D(mn,0),Zt.copyTexSubImage2D(Zt.TEXTURE_2D,Nn,0,0,Xt.x,Xt.y,Un,mr),Bn.unbindTexture()},this.copyTextureToTexture=function(Xt,mn,Nn,In=0){const Un=mn.image.width,mr=mn.image.height,gr=Or.convert(Nn.format),br=Or.convert(Nn.type);rr.setTexture2D(Nn,0),Zt.pixelStorei(Zt.UNPACK_FLIP_Y_WEBGL,Nn.flipY),Zt.pixelStorei(Zt.UNPACK_PREMULTIPLY_ALPHA_WEBGL,Nn.premultiplyAlpha),Zt.pixelStorei(Zt.UNPACK_ALIGNMENT,Nn.unpackAlignment),mn.isDataTexture?Zt.texSubImage2D(Zt.TEXTURE_2D,In,Xt.x,Xt.y,Un,mr,gr,br,mn.image.data):mn.isCompressedTexture?Zt.compressedTexSubImage2D(Zt.TEXTURE_2D,In,Xt.x,Xt.y,mn.mipmaps[0].width,mn.mipmaps[0].height,gr,mn.mipmaps[0].data):Zt.texSubImage2D(Zt.TEXTURE_2D,In,Xt.x,Xt.y,gr,br,mn.image),In===0&&Nn.generateMipmaps&&Zt.generateMipmap(Zt.TEXTURE_2D),Bn.unbindTexture()},this.copyTextureToTexture3D=function(Xt,mn,Nn,In,Un=0){if(Nt.isWebGL1Renderer){console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");return}const mr=Xt.max.x-Xt.min.x+1,gr=Xt.max.y-Xt.min.y+1,br=Xt.max.z-Xt.min.z+1,Rr=Or.convert(In.format),wr=Or.convert(In.type);let tr;if(In.isData3DTexture)rr.setTexture3D(In,0),tr=Zt.TEXTURE_3D;else if(In.isDataArrayTexture)rr.setTexture2DArray(In,0),tr=Zt.TEXTURE_2D_ARRAY;else{console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");return}Zt.pixelStorei(Zt.UNPACK_FLIP_Y_WEBGL,In.flipY),Zt.pixelStorei(Zt.UNPACK_PREMULTIPLY_ALPHA_WEBGL,In.premultiplyAlpha),Zt.pixelStorei(Zt.UNPACK_ALIGNMENT,In.unpackAlignment);const to=Zt.getParameter(Zt.UNPACK_ROW_LENGTH),$r=Zt.getParameter(Zt.UNPACK_IMAGE_HEIGHT),Yr=Zt.getParameter(Zt.UNPACK_SKIP_PIXELS),_o=Zt.getParameter(Zt.UNPACK_SKIP_ROWS),Ro=Zt.getParameter(Zt.UNPACK_SKIP_IMAGES),yo=Nn.isCompressedTexture?Nn.mipmaps[0]:Nn.image;Zt.pixelStorei(Zt.UNPACK_ROW_LENGTH,yo.width),Zt.pixelStorei(Zt.UNPACK_IMAGE_HEIGHT,yo.height),Zt.pixelStorei(Zt.UNPACK_SKIP_PIXELS,Xt.min.x),Zt.pixelStorei(Zt.UNPACK_SKIP_ROWS,Xt.min.y),Zt.pixelStorei(Zt.UNPACK_SKIP_IMAGES,Xt.min.z),Nn.isDataTexture||Nn.isData3DTexture?Zt.texSubImage3D(tr,Un,mn.x,mn.y,mn.z,mr,gr,br,Rr,wr,yo.data):Nn.isCompressedArrayTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),Zt.compressedTexSubImage3D(tr,Un,mn.x,mn.y,mn.z,mr,gr,br,Rr,yo.data)):Zt.texSubImage3D(tr,Un,mn.x,mn.y,mn.z,mr,gr,br,Rr,wr,yo),Zt.pixelStorei(Zt.UNPACK_ROW_LENGTH,to),Zt.pixelStorei(Zt.UNPACK_IMAGE_HEIGHT,$r),Zt.pixelStorei(Zt.UNPACK_SKIP_PIXELS,Yr),Zt.pixelStorei(Zt.UNPACK_SKIP_ROWS,_o),Zt.pixelStorei(Zt.UNPACK_SKIP_IMAGES,Ro),Un===0&&In.generateMipmaps&&Zt.generateMipmap(tr),Bn.unbindTexture()},this.initTexture=function(Xt){Xt.isCubeTexture?rr.setTextureCube(Xt,0):Xt.isData3DTexture?rr.setTexture3D(Xt,0):Xt.isDataArrayTexture||Xt.isCompressedArrayTexture?rr.setTexture2DArray(Xt,0):rr.setTexture2D(Xt,0),Bn.unbindTexture()},this.resetState=function(){Vt=0,Ft=0,zt=null,Bn.reset(),Ur.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return WebGLCoordinateSystem}get physicallyCorrectLights(){return console.warn("THREE.WebGLRenderer: the property .physicallyCorrectLights has been removed. Set renderer.useLegacyLights instead."),!this.useLegacyLights}set physicallyCorrectLights(_){console.warn("THREE.WebGLRenderer: the property .physicallyCorrectLights has been removed. Set renderer.useLegacyLights instead."),this.useLegacyLights=!_}get outputEncoding(){return console.warn("THREE.WebGLRenderer: Property .outputEncoding has been removed. Use .outputColorSpace instead."),this.outputColorSpace===SRGBColorSpace$1?sRGBEncoding$1:LinearEncoding$1}set outputEncoding(_){console.warn("THREE.WebGLRenderer: Property .outputEncoding has been removed. Use .outputColorSpace instead."),this.outputColorSpace=_===sRGBEncoding$1?SRGBColorSpace$1:LinearSRGBColorSpace$1}}class WebGL1Renderer extends WebGLRenderer{}WebGL1Renderer.prototype.isWebGL1Renderer=!0;class FogExp2{constructor(_,tt=25e-5){this.isFogExp2=!0,this.name="",this.color=new Color$1(_),this.density=tt}clone(){return new FogExp2(this.color,this.density)}toJSON(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}}}class Fog{constructor(_,tt=1,ot=1e3){this.isFog=!0,this.name="",this.color=new Color$1(_),this.near=tt,this.far=ot}clone(){return new Fog(this.color,this.near,this.far)}toJSON(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}}class Scene extends Object3D{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(_,tt){return super.copy(_,tt),_.background!==null&&(this.background=_.background.clone()),_.environment!==null&&(this.environment=_.environment.clone()),_.fog!==null&&(this.fog=_.fog.clone()),this.backgroundBlurriness=_.backgroundBlurriness,this.backgroundIntensity=_.backgroundIntensity,_.overrideMaterial!==null&&(this.overrideMaterial=_.overrideMaterial.clone()),this.matrixAutoUpdate=_.matrixAutoUpdate,this}toJSON(_){const tt=super.toJSON(_);return this.fog!==null&&(tt.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(tt.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(tt.object.backgroundIntensity=this.backgroundIntensity),tt}get autoUpdate(){return console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."),this.matrixWorldAutoUpdate}set autoUpdate(_){console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."),this.matrixWorldAutoUpdate=_}}class InterleavedBuffer{constructor(_,tt){this.isInterleavedBuffer=!0,this.array=_,this.stride=tt,this.count=_!==void 0?_.length/tt:0,this.usage=StaticDrawUsage,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=generateUUID$1()}onUploadCallback(){}set needsUpdate(_){_===!0&&this.version++}setUsage(_){return this.usage=_,this}copy(_){return this.array=new _.array.constructor(_.array),this.count=_.count,this.stride=_.stride,this.usage=_.usage,this}copyAt(_,tt,ot){_*=this.stride,ot*=tt.stride;for(let st=0,at=this.stride;st<at;st++)this.array[_+st]=tt.array[ot+st];return this}set(_,tt=0){return this.array.set(_,tt),this}clone(_){_.arrayBuffers===void 0&&(_.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=generateUUID$1()),_.arrayBuffers[this.array.buffer._uuid]===void 0&&(_.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const tt=new this.array.constructor(_.arrayBuffers[this.array.buffer._uuid]),ot=new this.constructor(tt,this.stride);return ot.setUsage(this.usage),ot}onUpload(_){return this.onUploadCallback=_,this}toJSON(_){return _.arrayBuffers===void 0&&(_.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=generateUUID$1()),_.arrayBuffers[this.array.buffer._uuid]===void 0&&(_.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const _vector$5=new Vector3;class InterleavedBufferAttribute{constructor(_,tt,ot,st=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=_,this.itemSize=tt,this.offset=ot,this.normalized=st}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(_){this.data.needsUpdate=_}applyMatrix4(_){for(let tt=0,ot=this.data.count;tt<ot;tt++)_vector$5.fromBufferAttribute(this,tt),_vector$5.applyMatrix4(_),this.setXYZ(tt,_vector$5.x,_vector$5.y,_vector$5.z);return this}applyNormalMatrix(_){for(let tt=0,ot=this.count;tt<ot;tt++)_vector$5.fromBufferAttribute(this,tt),_vector$5.applyNormalMatrix(_),this.setXYZ(tt,_vector$5.x,_vector$5.y,_vector$5.z);return this}transformDirection(_){for(let tt=0,ot=this.count;tt<ot;tt++)_vector$5.fromBufferAttribute(this,tt),_vector$5.transformDirection(_),this.setXYZ(tt,_vector$5.x,_vector$5.y,_vector$5.z);return this}setX(_,tt){return this.normalized&&(tt=normalize$5(tt,this.array)),this.data.array[_*this.data.stride+this.offset]=tt,this}setY(_,tt){return this.normalized&&(tt=normalize$5(tt,this.array)),this.data.array[_*this.data.stride+this.offset+1]=tt,this}setZ(_,tt){return this.normalized&&(tt=normalize$5(tt,this.array)),this.data.array[_*this.data.stride+this.offset+2]=tt,this}setW(_,tt){return this.normalized&&(tt=normalize$5(tt,this.array)),this.data.array[_*this.data.stride+this.offset+3]=tt,this}getX(_){let tt=this.data.array[_*this.data.stride+this.offset];return this.normalized&&(tt=denormalize(tt,this.array)),tt}getY(_){let tt=this.data.array[_*this.data.stride+this.offset+1];return this.normalized&&(tt=denormalize(tt,this.array)),tt}getZ(_){let tt=this.data.array[_*this.data.stride+this.offset+2];return this.normalized&&(tt=denormalize(tt,this.array)),tt}getW(_){let tt=this.data.array[_*this.data.stride+this.offset+3];return this.normalized&&(tt=denormalize(tt,this.array)),tt}setXY(_,tt,ot){return _=_*this.data.stride+this.offset,this.normalized&&(tt=normalize$5(tt,this.array),ot=normalize$5(ot,this.array)),this.data.array[_+0]=tt,this.data.array[_+1]=ot,this}setXYZ(_,tt,ot,st){return _=_*this.data.stride+this.offset,this.normalized&&(tt=normalize$5(tt,this.array),ot=normalize$5(ot,this.array),st=normalize$5(st,this.array)),this.data.array[_+0]=tt,this.data.array[_+1]=ot,this.data.array[_+2]=st,this}setXYZW(_,tt,ot,st,at){return _=_*this.data.stride+this.offset,this.normalized&&(tt=normalize$5(tt,this.array),ot=normalize$5(ot,this.array),st=normalize$5(st,this.array),at=normalize$5(at,this.array)),this.data.array[_+0]=tt,this.data.array[_+1]=ot,this.data.array[_+2]=st,this.data.array[_+3]=at,this}clone(_){if(_===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const tt=[];for(let ot=0;ot<this.count;ot++){const st=ot*this.data.stride+this.offset;for(let at=0;at<this.itemSize;at++)tt.push(this.data.array[st+at])}return new BufferAttribute(new this.array.constructor(tt),this.itemSize,this.normalized)}else return _.interleavedBuffers===void 0&&(_.interleavedBuffers={}),_.interleavedBuffers[this.data.uuid]===void 0&&(_.interleavedBuffers[this.data.uuid]=this.data.clone(_)),new InterleavedBufferAttribute(_.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(_){if(_===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const tt=[];for(let ot=0;ot<this.count;ot++){const st=ot*this.data.stride+this.offset;for(let at=0;at<this.itemSize;at++)tt.push(this.data.array[st+at])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:tt,normalized:this.normalized}}else return _.interleavedBuffers===void 0&&(_.interleavedBuffers={}),_.interleavedBuffers[this.data.uuid]===void 0&&(_.interleavedBuffers[this.data.uuid]=this.data.toJSON(_)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}class SpriteMaterial extends Material{constructor(_){super(),this.isSpriteMaterial=!0,this.type="SpriteMaterial",this.color=new Color$1(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(_)}copy(_){return super.copy(_),this.color.copy(_.color),this.map=_.map,this.alphaMap=_.alphaMap,this.rotation=_.rotation,this.sizeAttenuation=_.sizeAttenuation,this.fog=_.fog,this}}let _geometry;const _intersectPoint=new Vector3,_worldScale=new Vector3,_mvPosition=new Vector3,_alignedPosition=new Vector2,_rotatedPosition=new Vector2,_viewWorldMatrix=new Matrix4,_vA=new Vector3,_vB=new Vector3,_vC=new Vector3,_uvA=new Vector2,_uvB=new Vector2,_uvC=new Vector2;class Sprite extends Object3D{constructor(_){if(super(),this.isSprite=!0,this.type="Sprite",_geometry===void 0){_geometry=new BufferGeometry;const tt=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),ot=new InterleavedBuffer(tt,5);_geometry.setIndex([0,1,2,0,2,3]),_geometry.setAttribute("position",new InterleavedBufferAttribute(ot,3,0,!1)),_geometry.setAttribute("uv",new InterleavedBufferAttribute(ot,2,3,!1))}this.geometry=_geometry,this.material=_!==void 0?_:new SpriteMaterial,this.center=new Vector2(.5,.5)}raycast(_,tt){_.camera===null&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),_worldScale.setFromMatrixScale(this.matrixWorld),_viewWorldMatrix.copy(_.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(_.camera.matrixWorldInverse,this.matrixWorld),_mvPosition.setFromMatrixPosition(this.modelViewMatrix),_.camera.isPerspectiveCamera&&this.material.sizeAttenuation===!1&&_worldScale.multiplyScalar(-_mvPosition.z);const ot=this.material.rotation;let st,at;ot!==0&&(at=Math.cos(ot),st=Math.sin(ot));const lt=this.center;transformVertex(_vA.set(-.5,-.5,0),_mvPosition,lt,_worldScale,st,at),transformVertex(_vB.set(.5,-.5,0),_mvPosition,lt,_worldScale,st,at),transformVertex(_vC.set(.5,.5,0),_mvPosition,lt,_worldScale,st,at),_uvA.set(0,0),_uvB.set(1,0),_uvC.set(1,1);let dt=_.ray.intersectTriangle(_vA,_vB,_vC,!1,_intersectPoint);if(dt===null&&(transformVertex(_vB.set(-.5,.5,0),_mvPosition,lt,_worldScale,st,at),_uvB.set(0,1),dt=_.ray.intersectTriangle(_vA,_vC,_vB,!1,_intersectPoint),dt===null))return;const ht=_.ray.origin.distanceTo(_intersectPoint);ht<_.near||ht>_.far||tt.push({distance:ht,point:_intersectPoint.clone(),uv:Triangle.getInterpolation(_intersectPoint,_vA,_vB,_vC,_uvA,_uvB,_uvC,new Vector2),face:null,object:this})}copy(_,tt){return super.copy(_,tt),_.center!==void 0&&this.center.copy(_.center),this.material=_.material,this}}function transformVertex(nt,_,tt,ot,st,at){_alignedPosition.subVectors(nt,tt).addScalar(.5).multiply(ot),st!==void 0?(_rotatedPosition.x=at*_alignedPosition.x-st*_alignedPosition.y,_rotatedPosition.y=st*_alignedPosition.x+at*_alignedPosition.y):_rotatedPosition.copy(_alignedPosition),nt.copy(_),nt.x+=_rotatedPosition.x,nt.y+=_rotatedPosition.y,nt.applyMatrix4(_viewWorldMatrix)}const _v1$2=new Vector3,_v2$1=new Vector3;class LOD extends Object3D{constructor(){super(),this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]},isLOD:{value:!0}}),this.autoUpdate=!0}copy(_){super.copy(_,!1);const tt=_.levels;for(let ot=0,st=tt.length;ot<st;ot++){const at=tt[ot];this.addLevel(at.object.clone(),at.distance,at.hysteresis)}return this.autoUpdate=_.autoUpdate,this}addLevel(_,tt=0,ot=0){tt=Math.abs(tt);const st=this.levels;let at;for(at=0;at<st.length&&!(tt<st[at].distance);at++);return st.splice(at,0,{distance:tt,hysteresis:ot,object:_}),this.add(_),this}getCurrentLevel(){return this._currentLevel}getObjectForDistance(_){const tt=this.levels;if(tt.length>0){let ot,st;for(ot=1,st=tt.length;ot<st;ot++){let at=tt[ot].distance;if(tt[ot].object.visible&&(at-=at*tt[ot].hysteresis),_<at)break}return tt[ot-1].object}return null}raycast(_,tt){if(this.levels.length>0){_v1$2.setFromMatrixPosition(this.matrixWorld);const st=_.ray.origin.distanceTo(_v1$2);this.getObjectForDistance(st).raycast(_,tt)}}update(_){const tt=this.levels;if(tt.length>1){_v1$2.setFromMatrixPosition(_.matrixWorld),_v2$1.setFromMatrixPosition(this.matrixWorld);const ot=_v1$2.distanceTo(_v2$1)/_.zoom;tt[0].object.visible=!0;let st,at;for(st=1,at=tt.length;st<at;st++){let lt=tt[st].distance;if(tt[st].object.visible&&(lt-=lt*tt[st].hysteresis),ot>=lt)tt[st-1].object.visible=!1,tt[st].object.visible=!0;else break}for(this._currentLevel=st-1;st<at;st++)tt[st].object.visible=!1}}toJSON(_){const tt=super.toJSON(_);this.autoUpdate===!1&&(tt.object.autoUpdate=!1),tt.object.levels=[];const ot=this.levels;for(let st=0,at=ot.length;st<at;st++){const lt=ot[st];tt.object.levels.push({object:lt.object.uuid,distance:lt.distance,hysteresis:lt.hysteresis})}return tt}}const _basePosition=new Vector3,_skinIndex=new Vector4,_skinWeight=new Vector4,_vector3=new Vector3,_matrix4=new Matrix4,_vertex=new Vector3,_sphere$3=new Sphere,_inverseMatrix$2=new Matrix4,_ray$2=new Ray;class SkinnedMesh extends Mesh{constructor(_,tt){super(_,tt),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new Matrix4,this.bindMatrixInverse=new Matrix4,this.boundingBox=null,this.boundingSphere=null}computeBoundingBox(){const _=this.geometry;this.boundingBox===null&&(this.boundingBox=new Box3),this.boundingBox.makeEmpty();const tt=_.getAttribute("position");for(let ot=0;ot<tt.count;ot++)_vertex.fromBufferAttribute(tt,ot),this.applyBoneTransform(ot,_vertex),this.boundingBox.expandByPoint(_vertex)}computeBoundingSphere(){const _=this.geometry;this.boundingSphere===null&&(this.boundingSphere=new Sphere),this.boundingSphere.makeEmpty();const tt=_.getAttribute("position");for(let ot=0;ot<tt.count;ot++)_vertex.fromBufferAttribute(tt,ot),this.applyBoneTransform(ot,_vertex),this.boundingSphere.expandByPoint(_vertex)}copy(_,tt){return super.copy(_,tt),this.bindMode=_.bindMode,this.bindMatrix.copy(_.bindMatrix),this.bindMatrixInverse.copy(_.bindMatrixInverse),this.skeleton=_.skeleton,_.boundingBox!==null&&(this.boundingBox=_.boundingBox.clone()),_.boundingSphere!==null&&(this.boundingSphere=_.boundingSphere.clone()),this}raycast(_,tt){const ot=this.material,st=this.matrixWorld;ot!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),_sphere$3.copy(this.boundingSphere),_sphere$3.applyMatrix4(st),_.ray.intersectsSphere(_sphere$3)!==!1&&(_inverseMatrix$2.copy(st).invert(),_ray$2.copy(_.ray).applyMatrix4(_inverseMatrix$2),!(this.boundingBox!==null&&_ray$2.intersectsBox(this.boundingBox)===!1)&&this._computeIntersections(_,tt,_ray$2)))}getVertexPosition(_,tt){return super.getVertexPosition(_,tt),this.applyBoneTransform(_,tt),tt}bind(_,tt){this.skeleton=_,tt===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),tt=this.matrixWorld),this.bindMatrix.copy(tt),this.bindMatrixInverse.copy(tt).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const _=new Vector4,tt=this.geometry.attributes.skinWeight;for(let ot=0,st=tt.count;ot<st;ot++){_.fromBufferAttribute(tt,ot);const at=1/_.manhattanLength();at!==1/0?_.multiplyScalar(at):_.set(1,0,0,0),tt.setXYZW(ot,_.x,_.y,_.z,_.w)}}updateMatrixWorld(_){super.updateMatrixWorld(_),this.bindMode==="attached"?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode==="detached"?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}applyBoneTransform(_,tt){const ot=this.skeleton,st=this.geometry;_skinIndex.fromBufferAttribute(st.attributes.skinIndex,_),_skinWeight.fromBufferAttribute(st.attributes.skinWeight,_),_basePosition.copy(tt).applyMatrix4(this.bindMatrix),tt.set(0,0,0);for(let at=0;at<4;at++){const lt=_skinWeight.getComponent(at);if(lt!==0){const dt=_skinIndex.getComponent(at);_matrix4.multiplyMatrices(ot.bones[dt].matrixWorld,ot.boneInverses[dt]),tt.addScaledVector(_vector3.copy(_basePosition).applyMatrix4(_matrix4),lt)}}return tt.applyMatrix4(this.bindMatrixInverse)}boneTransform(_,tt){return console.warn("THREE.SkinnedMesh: .boneTransform() was renamed to .applyBoneTransform() in r151."),this.applyBoneTransform(_,tt)}}class Bone extends Object3D{constructor(){super(),this.isBone=!0,this.type="Bone"}}class DataTexture extends Texture{constructor(_=null,tt=1,ot=1,st,at,lt,dt,ht,ft=NearestFilter,gt=NearestFilter,Et,yt){super(null,lt,dt,ht,ft,gt,st,at,Et,yt),this.isDataTexture=!0,this.image={data:_,width:tt,height:ot},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}const _offsetMatrix=new Matrix4,_identityMatrix$1=new Matrix4;class Skeleton{constructor(_=[],tt=[]){this.uuid=generateUUID$1(),this.bones=_.slice(0),this.boneInverses=tt,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.frame=-1,this.init()}init(){const _=this.bones,tt=this.boneInverses;if(this.boneMatrices=new Float32Array(_.length*16),tt.length===0)this.calculateInverses();else if(_.length!==tt.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let ot=0,st=this.bones.length;ot<st;ot++)this.boneInverses.push(new Matrix4)}}calculateInverses(){this.boneInverses.length=0;for(let _=0,tt=this.bones.length;_<tt;_++){const ot=new Matrix4;this.bones[_]&&ot.copy(this.bones[_].matrixWorld).invert(),this.boneInverses.push(ot)}}pose(){for(let _=0,tt=this.bones.length;_<tt;_++){const ot=this.bones[_];ot&&ot.matrixWorld.copy(this.boneInverses[_]).invert()}for(let _=0,tt=this.bones.length;_<tt;_++){const ot=this.bones[_];ot&&(ot.parent&&ot.parent.isBone?(ot.matrix.copy(ot.parent.matrixWorld).invert(),ot.matrix.multiply(ot.matrixWorld)):ot.matrix.copy(ot.matrixWorld),ot.matrix.decompose(ot.position,ot.quaternion,ot.scale))}}update(){const _=this.bones,tt=this.boneInverses,ot=this.boneMatrices,st=this.boneTexture;for(let at=0,lt=_.length;at<lt;at++){const dt=_[at]?_[at].matrixWorld:_identityMatrix$1;_offsetMatrix.multiplyMatrices(dt,tt[at]),_offsetMatrix.toArray(ot,at*16)}st!==null&&(st.needsUpdate=!0)}clone(){return new Skeleton(this.bones,this.boneInverses)}computeBoneTexture(){let _=Math.sqrt(this.bones.length*4);_=ceilPowerOfTwo(_),_=Math.max(_,4);const tt=new Float32Array(_*_*4);tt.set(this.boneMatrices);const ot=new DataTexture(tt,_,_,RGBAFormat,FloatType);return ot.needsUpdate=!0,this.boneMatrices=tt,this.boneTexture=ot,this.boneTextureSize=_,this}getBoneByName(_){for(let tt=0,ot=this.bones.length;tt<ot;tt++){const st=this.bones[tt];if(st.name===_)return st}}dispose(){this.boneTexture!==null&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(_,tt){this.uuid=_.uuid;for(let ot=0,st=_.bones.length;ot<st;ot++){const at=_.bones[ot];let lt=tt[at];lt===void 0&&(console.warn("THREE.Skeleton: No bone found with UUID:",at),lt=new Bone),this.bones.push(lt),this.boneInverses.push(new Matrix4().fromArray(_.boneInverses[ot]))}return this.init(),this}toJSON(){const _={metadata:{version:4.6,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};_.uuid=this.uuid;const tt=this.bones,ot=this.boneInverses;for(let st=0,at=tt.length;st<at;st++){const lt=tt[st];_.bones.push(lt.uuid);const dt=ot[st];_.boneInverses.push(dt.toArray())}return _}}class InstancedBufferAttribute extends BufferAttribute{constructor(_,tt,ot,st=1){super(_,tt,ot),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=st}copy(_){return super.copy(_),this.meshPerAttribute=_.meshPerAttribute,this}toJSON(){const _=super.toJSON();return _.meshPerAttribute=this.meshPerAttribute,_.isInstancedBufferAttribute=!0,_}}const _instanceLocalMatrix=new Matrix4,_instanceWorldMatrix=new Matrix4,_instanceIntersects=[],_box3=new Box3,_identity=new Matrix4,_mesh=new Mesh,_sphere$2=new Sphere;class InstancedMesh extends Mesh{constructor(_,tt,ot){super(_,tt),this.isInstancedMesh=!0,this.instanceMatrix=new InstancedBufferAttribute(new Float32Array(ot*16),16),this.instanceColor=null,this.count=ot,this.boundingBox=null,this.boundingSphere=null;for(let st=0;st<ot;st++)this.setMatrixAt(st,_identity)}computeBoundingBox(){const _=this.geometry,tt=this.count;this.boundingBox===null&&(this.boundingBox=new Box3),_.boundingBox===null&&_.computeBoundingBox(),this.boundingBox.makeEmpty();for(let ot=0;ot<tt;ot++)this.getMatrixAt(ot,_instanceLocalMatrix),_box3.copy(_.boundingBox).applyMatrix4(_instanceLocalMatrix),this.boundingBox.union(_box3)}computeBoundingSphere(){const _=this.geometry,tt=this.count;this.boundingSphere===null&&(this.boundingSphere=new Sphere),_.boundingSphere===null&&_.computeBoundingSphere(),this.boundingSphere.makeEmpty();for(let ot=0;ot<tt;ot++)this.getMatrixAt(ot,_instanceLocalMatrix),_sphere$2.copy(_.boundingSphere).applyMatrix4(_instanceLocalMatrix),this.boundingSphere.union(_sphere$2)}copy(_,tt){return super.copy(_,tt),this.instanceMatrix.copy(_.instanceMatrix),_.instanceColor!==null&&(this.instanceColor=_.instanceColor.clone()),this.count=_.count,_.boundingBox!==null&&(this.boundingBox=_.boundingBox.clone()),_.boundingSphere!==null&&(this.boundingSphere=_.boundingSphere.clone()),this}getColorAt(_,tt){tt.fromArray(this.instanceColor.array,_*3)}getMatrixAt(_,tt){tt.fromArray(this.instanceMatrix.array,_*16)}raycast(_,tt){const ot=this.matrixWorld,st=this.count;if(_mesh.geometry=this.geometry,_mesh.material=this.material,_mesh.material!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),_sphere$2.copy(this.boundingSphere),_sphere$2.applyMatrix4(ot),_.ray.intersectsSphere(_sphere$2)!==!1))for(let at=0;at<st;at++){this.getMatrixAt(at,_instanceLocalMatrix),_instanceWorldMatrix.multiplyMatrices(ot,_instanceLocalMatrix),_mesh.matrixWorld=_instanceWorldMatrix,_mesh.raycast(_,_instanceIntersects);for(let lt=0,dt=_instanceIntersects.length;lt<dt;lt++){const ht=_instanceIntersects[lt];ht.instanceId=at,ht.object=this,tt.push(ht)}_instanceIntersects.length=0}}setColorAt(_,tt){this.instanceColor===null&&(this.instanceColor=new InstancedBufferAttribute(new Float32Array(this.instanceMatrix.count*3),3)),tt.toArray(this.instanceColor.array,_*3)}setMatrixAt(_,tt){tt.toArray(this.instanceMatrix.array,_*16)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}}class LineBasicMaterial extends Material{constructor(_){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new Color$1(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(_)}copy(_){return super.copy(_),this.color.copy(_.color),this.map=_.map,this.linewidth=_.linewidth,this.linecap=_.linecap,this.linejoin=_.linejoin,this.fog=_.fog,this}}const _start$1=new Vector3,_end$1=new Vector3,_inverseMatrix$1=new Matrix4,_ray$1=new Ray,_sphere$1=new Sphere;class Line extends Object3D{constructor(_=new BufferGeometry,tt=new LineBasicMaterial){super(),this.isLine=!0,this.type="Line",this.geometry=_,this.material=tt,this.updateMorphTargets()}copy(_,tt){return super.copy(_,tt),this.material=_.material,this.geometry=_.geometry,this}computeLineDistances(){const _=this.geometry;if(_.index===null){const tt=_.attributes.position,ot=[0];for(let st=1,at=tt.count;st<at;st++)_start$1.fromBufferAttribute(tt,st-1),_end$1.fromBufferAttribute(tt,st),ot[st]=ot[st-1],ot[st]+=_start$1.distanceTo(_end$1);_.setAttribute("lineDistance",new Float32BufferAttribute(ot,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(_,tt){const ot=this.geometry,st=this.matrixWorld,at=_.params.Line.threshold,lt=ot.drawRange;if(ot.boundingSphere===null&&ot.computeBoundingSphere(),_sphere$1.copy(ot.boundingSphere),_sphere$1.applyMatrix4(st),_sphere$1.radius+=at,_.ray.intersectsSphere(_sphere$1)===!1)return;_inverseMatrix$1.copy(st).invert(),_ray$1.copy(_.ray).applyMatrix4(_inverseMatrix$1);const dt=at/((this.scale.x+this.scale.y+this.scale.z)/3),ht=dt*dt,ft=new Vector3,gt=new Vector3,Et=new Vector3,yt=new Vector3,Ct=this.isLineSegments?2:1,wt=ot.index,Pt=ot.attributes.position;if(wt!==null){const Rt=Math.max(0,lt.start),xt=Math.min(wt.count,lt.start+lt.count);for(let Nt=Rt,kt=xt-1;Nt<kt;Nt+=Ct){const Vt=wt.getX(Nt),Ft=wt.getX(Nt+1);if(ft.fromBufferAttribute(Pt,Vt),gt.fromBufferAttribute(Pt,Ft),_ray$1.distanceSqToSegment(ft,gt,yt,Et)>ht)continue;yt.applyMatrix4(this.matrixWorld);const Yt=_.ray.origin.distanceTo(yt);Yt<_.near||Yt>_.far||tt.push({distance:Yt,point:Et.clone().applyMatrix4(this.matrixWorld),index:Nt,face:null,faceIndex:null,object:this})}}else{const Rt=Math.max(0,lt.start),xt=Math.min(Pt.count,lt.start+lt.count);for(let Nt=Rt,kt=xt-1;Nt<kt;Nt+=Ct){if(ft.fromBufferAttribute(Pt,Nt),gt.fromBufferAttribute(Pt,Nt+1),_ray$1.distanceSqToSegment(ft,gt,yt,Et)>ht)continue;yt.applyMatrix4(this.matrixWorld);const Ft=_.ray.origin.distanceTo(yt);Ft<_.near||Ft>_.far||tt.push({distance:Ft,point:Et.clone().applyMatrix4(this.matrixWorld),index:Nt,face:null,faceIndex:null,object:this})}}}updateMorphTargets(){const tt=this.geometry.morphAttributes,ot=Object.keys(tt);if(ot.length>0){const st=tt[ot[0]];if(st!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let at=0,lt=st.length;at<lt;at++){const dt=st[at].name||String(at);this.morphTargetInfluences.push(0),this.morphTargetDictionary[dt]=at}}}}}const _start=new Vector3,_end=new Vector3;class LineSegments extends Line{constructor(_,tt){super(_,tt),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const _=this.geometry;if(_.index===null){const tt=_.attributes.position,ot=[];for(let st=0,at=tt.count;st<at;st+=2)_start.fromBufferAttribute(tt,st),_end.fromBufferAttribute(tt,st+1),ot[st]=st===0?0:ot[st-1],ot[st+1]=ot[st]+_start.distanceTo(_end);_.setAttribute("lineDistance",new Float32BufferAttribute(ot,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class LineLoop extends Line{constructor(_,tt){super(_,tt),this.isLineLoop=!0,this.type="LineLoop"}}class PointsMaterial extends Material{constructor(_){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new Color$1(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(_)}copy(_){return super.copy(_),this.color.copy(_.color),this.map=_.map,this.alphaMap=_.alphaMap,this.size=_.size,this.sizeAttenuation=_.sizeAttenuation,this.fog=_.fog,this}}const _inverseMatrix=new Matrix4,_ray=new Ray,_sphere$6=new Sphere,_position$2=new Vector3;class Points extends Object3D{constructor(_=new BufferGeometry,tt=new PointsMaterial){super(),this.isPoints=!0,this.type="Points",this.geometry=_,this.material=tt,this.updateMorphTargets()}copy(_,tt){return super.copy(_,tt),this.material=_.material,this.geometry=_.geometry,this}raycast(_,tt){const ot=this.geometry,st=this.matrixWorld,at=_.params.Points.threshold,lt=ot.drawRange;if(ot.boundingSphere===null&&ot.computeBoundingSphere(),_sphere$6.copy(ot.boundingSphere),_sphere$6.applyMatrix4(st),_sphere$6.radius+=at,_.ray.intersectsSphere(_sphere$6)===!1)return;_inverseMatrix.copy(st).invert(),_ray.copy(_.ray).applyMatrix4(_inverseMatrix);const dt=at/((this.scale.x+this.scale.y+this.scale.z)/3),ht=dt*dt,ft=ot.index,Et=ot.attributes.position;if(ft!==null){const yt=Math.max(0,lt.start),Ct=Math.min(ft.count,lt.start+lt.count);for(let wt=yt,It=Ct;wt<It;wt++){const Pt=ft.getX(wt);_position$2.fromBufferAttribute(Et,Pt),testPoint(_position$2,Pt,ht,st,_,tt,this)}}else{const yt=Math.max(0,lt.start),Ct=Math.min(Et.count,lt.start+lt.count);for(let wt=yt,It=Ct;wt<It;wt++)_position$2.fromBufferAttribute(Et,wt),testPoint(_position$2,wt,ht,st,_,tt,this)}}updateMorphTargets(){const tt=this.geometry.morphAttributes,ot=Object.keys(tt);if(ot.length>0){const st=tt[ot[0]];if(st!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let at=0,lt=st.length;at<lt;at++){const dt=st[at].name||String(at);this.morphTargetInfluences.push(0),this.morphTargetDictionary[dt]=at}}}}}function testPoint(nt,_,tt,ot,st,at,lt){const dt=_ray.distanceSqToPoint(nt);if(dt<tt){const ht=new Vector3;_ray.closestPointToPoint(nt,ht),ht.applyMatrix4(ot);const ft=st.ray.origin.distanceTo(ht);if(ft<st.near||ft>st.far)return;at.push({distance:ft,distanceToRay:Math.sqrt(dt),point:ht,index:_,face:null,object:lt})}}class VideoTexture extends Texture{constructor(_,tt,ot,st,at,lt,dt,ht,ft){super(_,tt,ot,st,at,lt,dt,ht,ft),this.isVideoTexture=!0,this.minFilter=lt!==void 0?lt:LinearFilter,this.magFilter=at!==void 0?at:LinearFilter,this.generateMipmaps=!1;const gt=this;function Et(){gt.needsUpdate=!0,_.requestVideoFrameCallback(Et)}"requestVideoFrameCallback"in _&&_.requestVideoFrameCallback(Et)}clone(){return new this.constructor(this.image).copy(this)}update(){const _=this.image;"requestVideoFrameCallback"in _===!1&&_.readyState>=_.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}class FramebufferTexture extends Texture{constructor(_,tt){super({width:_,height:tt}),this.isFramebufferTexture=!0,this.magFilter=NearestFilter,this.minFilter=NearestFilter,this.generateMipmaps=!1,this.needsUpdate=!0}}class CompressedTexture extends Texture{constructor(_,tt,ot,st,at,lt,dt,ht,ft,gt,Et,yt){super(null,lt,dt,ht,ft,gt,st,at,Et,yt),this.isCompressedTexture=!0,this.image={width:tt,height:ot},this.mipmaps=_,this.flipY=!1,this.generateMipmaps=!1}}class CompressedArrayTexture extends CompressedTexture{constructor(_,tt,ot,st,at,lt){super(_,tt,ot,at,lt),this.isCompressedArrayTexture=!0,this.image.depth=st,this.wrapR=ClampToEdgeWrapping}}class CanvasTexture extends Texture{constructor(_,tt,ot,st,at,lt,dt,ht,ft){super(_,tt,ot,st,at,lt,dt,ht,ft),this.isCanvasTexture=!0,this.needsUpdate=!0}}class Curve{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(_,tt){const ot=this.getUtoTmapping(_);return this.getPoint(ot,tt)}getPoints(_=5){const tt=[];for(let ot=0;ot<=_;ot++)tt.push(this.getPoint(ot/_));return tt}getSpacedPoints(_=5){const tt=[];for(let ot=0;ot<=_;ot++)tt.push(this.getPointAt(ot/_));return tt}getLength(){const _=this.getLengths();return _[_.length-1]}getLengths(_=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===_+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const tt=[];let ot,st=this.getPoint(0),at=0;tt.push(0);for(let lt=1;lt<=_;lt++)ot=this.getPoint(lt/_),at+=ot.distanceTo(st),tt.push(at),st=ot;return this.cacheArcLengths=tt,tt}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(_,tt){const ot=this.getLengths();let st=0;const at=ot.length;let lt;tt?lt=tt:lt=_*ot[at-1];let dt=0,ht=at-1,ft;for(;dt<=ht;)if(st=Math.floor(dt+(ht-dt)/2),ft=ot[st]-lt,ft<0)dt=st+1;else if(ft>0)ht=st-1;else{ht=st;break}if(st=ht,ot[st]===lt)return st/(at-1);const gt=ot[st],yt=ot[st+1]-gt,Ct=(lt-gt)/yt;return(st+Ct)/(at-1)}getTangent(_,tt){let st=_-1e-4,at=_+1e-4;st<0&&(st=0),at>1&&(at=1);const lt=this.getPoint(st),dt=this.getPoint(at),ht=tt||(lt.isVector2?new Vector2:new Vector3);return ht.copy(dt).sub(lt).normalize(),ht}getTangentAt(_,tt){const ot=this.getUtoTmapping(_);return this.getTangent(ot,tt)}computeFrenetFrames(_,tt){const ot=new Vector3,st=[],at=[],lt=[],dt=new Vector3,ht=new Matrix4;for(let Ct=0;Ct<=_;Ct++){const wt=Ct/_;st[Ct]=this.getTangentAt(wt,new Vector3)}at[0]=new Vector3,lt[0]=new Vector3;let ft=Number.MAX_VALUE;const gt=Math.abs(st[0].x),Et=Math.abs(st[0].y),yt=Math.abs(st[0].z);gt<=ft&&(ft=gt,ot.set(1,0,0)),Et<=ft&&(ft=Et,ot.set(0,1,0)),yt<=ft&&ot.set(0,0,1),dt.crossVectors(st[0],ot).normalize(),at[0].crossVectors(st[0],dt),lt[0].crossVectors(st[0],at[0]);for(let Ct=1;Ct<=_;Ct++){if(at[Ct]=at[Ct-1].clone(),lt[Ct]=lt[Ct-1].clone(),dt.crossVectors(st[Ct-1],st[Ct]),dt.length()>Number.EPSILON){dt.normalize();const wt=Math.acos(clamp$3(st[Ct-1].dot(st[Ct]),-1,1));at[Ct].applyMatrix4(ht.makeRotationAxis(dt,wt))}lt[Ct].crossVectors(st[Ct],at[Ct])}if(tt===!0){let Ct=Math.acos(clamp$3(at[0].dot(at[_]),-1,1));Ct/=_,st[0].dot(dt.crossVectors(at[0],at[_]))>0&&(Ct=-Ct);for(let wt=1;wt<=_;wt++)at[wt].applyMatrix4(ht.makeRotationAxis(st[wt],Ct*wt)),lt[wt].crossVectors(st[wt],at[wt])}return{tangents:st,normals:at,binormals:lt}}clone(){return new this.constructor().copy(this)}copy(_){return this.arcLengthDivisions=_.arcLengthDivisions,this}toJSON(){const _={metadata:{version:4.6,type:"Curve",generator:"Curve.toJSON"}};return _.arcLengthDivisions=this.arcLengthDivisions,_.type=this.type,_}fromJSON(_){return this.arcLengthDivisions=_.arcLengthDivisions,this}}class EllipseCurve extends Curve{constructor(_=0,tt=0,ot=1,st=1,at=0,lt=Math.PI*2,dt=!1,ht=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=_,this.aY=tt,this.xRadius=ot,this.yRadius=st,this.aStartAngle=at,this.aEndAngle=lt,this.aClockwise=dt,this.aRotation=ht}getPoint(_,tt){const ot=tt||new Vector2,st=Math.PI*2;let at=this.aEndAngle-this.aStartAngle;const lt=Math.abs(at)<Number.EPSILON;for(;at<0;)at+=st;for(;at>st;)at-=st;at<Number.EPSILON&&(lt?at=0:at=st),this.aClockwise===!0&&!lt&&(at===st?at=-st:at=at-st);const dt=this.aStartAngle+_*at;let ht=this.aX+this.xRadius*Math.cos(dt),ft=this.aY+this.yRadius*Math.sin(dt);if(this.aRotation!==0){const gt=Math.cos(this.aRotation),Et=Math.sin(this.aRotation),yt=ht-this.aX,Ct=ft-this.aY;ht=yt*gt-Ct*Et+this.aX,ft=yt*Et+Ct*gt+this.aY}return ot.set(ht,ft)}copy(_){return super.copy(_),this.aX=_.aX,this.aY=_.aY,this.xRadius=_.xRadius,this.yRadius=_.yRadius,this.aStartAngle=_.aStartAngle,this.aEndAngle=_.aEndAngle,this.aClockwise=_.aClockwise,this.aRotation=_.aRotation,this}toJSON(){const _=super.toJSON();return _.aX=this.aX,_.aY=this.aY,_.xRadius=this.xRadius,_.yRadius=this.yRadius,_.aStartAngle=this.aStartAngle,_.aEndAngle=this.aEndAngle,_.aClockwise=this.aClockwise,_.aRotation=this.aRotation,_}fromJSON(_){return super.fromJSON(_),this.aX=_.aX,this.aY=_.aY,this.xRadius=_.xRadius,this.yRadius=_.yRadius,this.aStartAngle=_.aStartAngle,this.aEndAngle=_.aEndAngle,this.aClockwise=_.aClockwise,this.aRotation=_.aRotation,this}}class ArcCurve extends EllipseCurve{constructor(_,tt,ot,st,at,lt){super(_,tt,ot,ot,st,at,lt),this.isArcCurve=!0,this.type="ArcCurve"}}function CubicPoly(){let nt=0,_=0,tt=0,ot=0;function st(at,lt,dt,ht){nt=at,_=dt,tt=-3*at+3*lt-2*dt-ht,ot=2*at-2*lt+dt+ht}return{initCatmullRom:function(at,lt,dt,ht,ft){st(lt,dt,ft*(dt-at),ft*(ht-lt))},initNonuniformCatmullRom:function(at,lt,dt,ht,ft,gt,Et){let yt=(lt-at)/ft-(dt-at)/(ft+gt)+(dt-lt)/gt,Ct=(dt-lt)/gt-(ht-lt)/(gt+Et)+(ht-dt)/Et;yt*=gt,Ct*=gt,st(lt,dt,yt,Ct)},calc:function(at){const lt=at*at,dt=lt*at;return nt+_*at+tt*lt+ot*dt}}}const tmp=new Vector3,px=new CubicPoly,py=new CubicPoly,pz=new CubicPoly;class CatmullRomCurve3 extends Curve{constructor(_=[],tt=!1,ot="centripetal",st=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=_,this.closed=tt,this.curveType=ot,this.tension=st}getPoint(_,tt=new Vector3){const ot=tt,st=this.points,at=st.length,lt=(at-(this.closed?0:1))*_;let dt=Math.floor(lt),ht=lt-dt;this.closed?dt+=dt>0?0:(Math.floor(Math.abs(dt)/at)+1)*at:ht===0&&dt===at-1&&(dt=at-2,ht=1);let ft,gt;this.closed||dt>0?ft=st[(dt-1)%at]:(tmp.subVectors(st[0],st[1]).add(st[0]),ft=tmp);const Et=st[dt%at],yt=st[(dt+1)%at];if(this.closed||dt+2<at?gt=st[(dt+2)%at]:(tmp.subVectors(st[at-1],st[at-2]).add(st[at-1]),gt=tmp),this.curveType==="centripetal"||this.curveType==="chordal"){const Ct=this.curveType==="chordal"?.5:.25;let wt=Math.pow(ft.distanceToSquared(Et),Ct),It=Math.pow(Et.distanceToSquared(yt),Ct),Pt=Math.pow(yt.distanceToSquared(gt),Ct);It<1e-4&&(It=1),wt<1e-4&&(wt=It),Pt<1e-4&&(Pt=It),px.initNonuniformCatmullRom(ft.x,Et.x,yt.x,gt.x,wt,It,Pt),py.initNonuniformCatmullRom(ft.y,Et.y,yt.y,gt.y,wt,It,Pt),pz.initNonuniformCatmullRom(ft.z,Et.z,yt.z,gt.z,wt,It,Pt)}else this.curveType==="catmullrom"&&(px.initCatmullRom(ft.x,Et.x,yt.x,gt.x,this.tension),py.initCatmullRom(ft.y,Et.y,yt.y,gt.y,this.tension),pz.initCatmullRom(ft.z,Et.z,yt.z,gt.z,this.tension));return ot.set(px.calc(ht),py.calc(ht),pz.calc(ht)),ot}copy(_){super.copy(_),this.points=[];for(let tt=0,ot=_.points.length;tt<ot;tt++){const st=_.points[tt];this.points.push(st.clone())}return this.closed=_.closed,this.curveType=_.curveType,this.tension=_.tension,this}toJSON(){const _=super.toJSON();_.points=[];for(let tt=0,ot=this.points.length;tt<ot;tt++){const st=this.points[tt];_.points.push(st.toArray())}return _.closed=this.closed,_.curveType=this.curveType,_.tension=this.tension,_}fromJSON(_){super.fromJSON(_),this.points=[];for(let tt=0,ot=_.points.length;tt<ot;tt++){const st=_.points[tt];this.points.push(new Vector3().fromArray(st))}return this.closed=_.closed,this.curveType=_.curveType,this.tension=_.tension,this}}function CatmullRom(nt,_,tt,ot,st){const at=(ot-_)*.5,lt=(st-tt)*.5,dt=nt*nt,ht=nt*dt;return(2*tt-2*ot+at+lt)*ht+(-3*tt+3*ot-2*at-lt)*dt+at*nt+tt}function QuadraticBezierP0(nt,_){const tt=1-nt;return tt*tt*_}function QuadraticBezierP1(nt,_){return 2*(1-nt)*nt*_}function QuadraticBezierP2(nt,_){return nt*nt*_}function QuadraticBezier(nt,_,tt,ot){return QuadraticBezierP0(nt,_)+QuadraticBezierP1(nt,tt)+QuadraticBezierP2(nt,ot)}function CubicBezierP0(nt,_){const tt=1-nt;return tt*tt*tt*_}function CubicBezierP1(nt,_){const tt=1-nt;return 3*tt*tt*nt*_}function CubicBezierP2(nt,_){return 3*(1-nt)*nt*nt*_}function CubicBezierP3(nt,_){return nt*nt*nt*_}function CubicBezier(nt,_,tt,ot,st){return CubicBezierP0(nt,_)+CubicBezierP1(nt,tt)+CubicBezierP2(nt,ot)+CubicBezierP3(nt,st)}class CubicBezierCurve extends Curve{constructor(_=new Vector2,tt=new Vector2,ot=new Vector2,st=new Vector2){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=_,this.v1=tt,this.v2=ot,this.v3=st}getPoint(_,tt=new Vector2){const ot=tt,st=this.v0,at=this.v1,lt=this.v2,dt=this.v3;return ot.set(CubicBezier(_,st.x,at.x,lt.x,dt.x),CubicBezier(_,st.y,at.y,lt.y,dt.y)),ot}copy(_){return super.copy(_),this.v0.copy(_.v0),this.v1.copy(_.v1),this.v2.copy(_.v2),this.v3.copy(_.v3),this}toJSON(){const _=super.toJSON();return _.v0=this.v0.toArray(),_.v1=this.v1.toArray(),_.v2=this.v2.toArray(),_.v3=this.v3.toArray(),_}fromJSON(_){return super.fromJSON(_),this.v0.fromArray(_.v0),this.v1.fromArray(_.v1),this.v2.fromArray(_.v2),this.v3.fromArray(_.v3),this}}class CubicBezierCurve3 extends Curve{constructor(_=new Vector3,tt=new Vector3,ot=new Vector3,st=new Vector3){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=_,this.v1=tt,this.v2=ot,this.v3=st}getPoint(_,tt=new Vector3){const ot=tt,st=this.v0,at=this.v1,lt=this.v2,dt=this.v3;return ot.set(CubicBezier(_,st.x,at.x,lt.x,dt.x),CubicBezier(_,st.y,at.y,lt.y,dt.y),CubicBezier(_,st.z,at.z,lt.z,dt.z)),ot}copy(_){return super.copy(_),this.v0.copy(_.v0),this.v1.copy(_.v1),this.v2.copy(_.v2),this.v3.copy(_.v3),this}toJSON(){const _=super.toJSON();return _.v0=this.v0.toArray(),_.v1=this.v1.toArray(),_.v2=this.v2.toArray(),_.v3=this.v3.toArray(),_}fromJSON(_){return super.fromJSON(_),this.v0.fromArray(_.v0),this.v1.fromArray(_.v1),this.v2.fromArray(_.v2),this.v3.fromArray(_.v3),this}}class LineCurve extends Curve{constructor(_=new Vector2,tt=new Vector2){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=_,this.v2=tt}getPoint(_,tt=new Vector2){const ot=tt;return _===1?ot.copy(this.v2):(ot.copy(this.v2).sub(this.v1),ot.multiplyScalar(_).add(this.v1)),ot}getPointAt(_,tt){return this.getPoint(_,tt)}getTangent(_,tt=new Vector2){return tt.subVectors(this.v2,this.v1).normalize()}getTangentAt(_,tt){return this.getTangent(_,tt)}copy(_){return super.copy(_),this.v1.copy(_.v1),this.v2.copy(_.v2),this}toJSON(){const _=super.toJSON();return _.v1=this.v1.toArray(),_.v2=this.v2.toArray(),_}fromJSON(_){return super.fromJSON(_),this.v1.fromArray(_.v1),this.v2.fromArray(_.v2),this}}class LineCurve3 extends Curve{constructor(_=new Vector3,tt=new Vector3){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=_,this.v2=tt}getPoint(_,tt=new Vector3){const ot=tt;return _===1?ot.copy(this.v2):(ot.copy(this.v2).sub(this.v1),ot.multiplyScalar(_).add(this.v1)),ot}getPointAt(_,tt){return this.getPoint(_,tt)}getTangent(_,tt=new Vector3){return tt.subVectors(this.v2,this.v1).normalize()}getTangentAt(_,tt){return this.getTangent(_,tt)}copy(_){return super.copy(_),this.v1.copy(_.v1),this.v2.copy(_.v2),this}toJSON(){const _=super.toJSON();return _.v1=this.v1.toArray(),_.v2=this.v2.toArray(),_}fromJSON(_){return super.fromJSON(_),this.v1.fromArray(_.v1),this.v2.fromArray(_.v2),this}}class QuadraticBezierCurve extends Curve{constructor(_=new Vector2,tt=new Vector2,ot=new Vector2){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=_,this.v1=tt,this.v2=ot}getPoint(_,tt=new Vector2){const ot=tt,st=this.v0,at=this.v1,lt=this.v2;return ot.set(QuadraticBezier(_,st.x,at.x,lt.x),QuadraticBezier(_,st.y,at.y,lt.y)),ot}copy(_){return super.copy(_),this.v0.copy(_.v0),this.v1.copy(_.v1),this.v2.copy(_.v2),this}toJSON(){const _=super.toJSON();return _.v0=this.v0.toArray(),_.v1=this.v1.toArray(),_.v2=this.v2.toArray(),_}fromJSON(_){return super.fromJSON(_),this.v0.fromArray(_.v0),this.v1.fromArray(_.v1),this.v2.fromArray(_.v2),this}}class QuadraticBezierCurve3 extends Curve{constructor(_=new Vector3,tt=new Vector3,ot=new Vector3){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=_,this.v1=tt,this.v2=ot}getPoint(_,tt=new Vector3){const ot=tt,st=this.v0,at=this.v1,lt=this.v2;return ot.set(QuadraticBezier(_,st.x,at.x,lt.x),QuadraticBezier(_,st.y,at.y,lt.y),QuadraticBezier(_,st.z,at.z,lt.z)),ot}copy(_){return super.copy(_),this.v0.copy(_.v0),this.v1.copy(_.v1),this.v2.copy(_.v2),this}toJSON(){const _=super.toJSON();return _.v0=this.v0.toArray(),_.v1=this.v1.toArray(),_.v2=this.v2.toArray(),_}fromJSON(_){return super.fromJSON(_),this.v0.fromArray(_.v0),this.v1.fromArray(_.v1),this.v2.fromArray(_.v2),this}}class SplineCurve extends Curve{constructor(_=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=_}getPoint(_,tt=new Vector2){const ot=tt,st=this.points,at=(st.length-1)*_,lt=Math.floor(at),dt=at-lt,ht=st[lt===0?lt:lt-1],ft=st[lt],gt=st[lt>st.length-2?st.length-1:lt+1],Et=st[lt>st.length-3?st.length-1:lt+2];return ot.set(CatmullRom(dt,ht.x,ft.x,gt.x,Et.x),CatmullRom(dt,ht.y,ft.y,gt.y,Et.y)),ot}copy(_){super.copy(_),this.points=[];for(let tt=0,ot=_.points.length;tt<ot;tt++){const st=_.points[tt];this.points.push(st.clone())}return this}toJSON(){const _=super.toJSON();_.points=[];for(let tt=0,ot=this.points.length;tt<ot;tt++){const st=this.points[tt];_.points.push(st.toArray())}return _}fromJSON(_){super.fromJSON(_),this.points=[];for(let tt=0,ot=_.points.length;tt<ot;tt++){const st=_.points[tt];this.points.push(new Vector2().fromArray(st))}return this}}var Curves=Object.freeze({__proto__:null,ArcCurve,CatmullRomCurve3,CubicBezierCurve,CubicBezierCurve3,EllipseCurve,LineCurve,LineCurve3,QuadraticBezierCurve,QuadraticBezierCurve3,SplineCurve});class CurvePath extends Curve{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(_){this.curves.push(_)}closePath(){const _=this.curves[0].getPoint(0),tt=this.curves[this.curves.length-1].getPoint(1);_.equals(tt)||this.curves.push(new LineCurve(tt,_))}getPoint(_,tt){const ot=_*this.getLength(),st=this.getCurveLengths();let at=0;for(;at<st.length;){if(st[at]>=ot){const lt=st[at]-ot,dt=this.curves[at],ht=dt.getLength(),ft=ht===0?0:1-lt/ht;return dt.getPointAt(ft,tt)}at++}return null}getLength(){const _=this.getCurveLengths();return _[_.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const _=[];let tt=0;for(let ot=0,st=this.curves.length;ot<st;ot++)tt+=this.curves[ot].getLength(),_.push(tt);return this.cacheLengths=_,_}getSpacedPoints(_=40){const tt=[];for(let ot=0;ot<=_;ot++)tt.push(this.getPoint(ot/_));return this.autoClose&&tt.push(tt[0]),tt}getPoints(_=12){const tt=[];let ot;for(let st=0,at=this.curves;st<at.length;st++){const lt=at[st],dt=lt.isEllipseCurve?_*2:lt.isLineCurve||lt.isLineCurve3?1:lt.isSplineCurve?_*lt.points.length:_,ht=lt.getPoints(dt);for(let ft=0;ft<ht.length;ft++){const gt=ht[ft];ot&&ot.equals(gt)||(tt.push(gt),ot=gt)}}return this.autoClose&&tt.length>1&&!tt[tt.length-1].equals(tt[0])&&tt.push(tt[0]),tt}copy(_){super.copy(_),this.curves=[];for(let tt=0,ot=_.curves.length;tt<ot;tt++){const st=_.curves[tt];this.curves.push(st.clone())}return this.autoClose=_.autoClose,this}toJSON(){const _=super.toJSON();_.autoClose=this.autoClose,_.curves=[];for(let tt=0,ot=this.curves.length;tt<ot;tt++){const st=this.curves[tt];_.curves.push(st.toJSON())}return _}fromJSON(_){super.fromJSON(_),this.autoClose=_.autoClose,this.curves=[];for(let tt=0,ot=_.curves.length;tt<ot;tt++){const st=_.curves[tt];this.curves.push(new Curves[st.type]().fromJSON(st))}return this}}class Path extends CurvePath{constructor(_){super(),this.type="Path",this.currentPoint=new Vector2,_&&this.setFromPoints(_)}setFromPoints(_){this.moveTo(_[0].x,_[0].y);for(let tt=1,ot=_.length;tt<ot;tt++)this.lineTo(_[tt].x,_[tt].y);return this}moveTo(_,tt){return this.currentPoint.set(_,tt),this}lineTo(_,tt){const ot=new LineCurve(this.currentPoint.clone(),new Vector2(_,tt));return this.curves.push(ot),this.currentPoint.set(_,tt),this}quadraticCurveTo(_,tt,ot,st){const at=new QuadraticBezierCurve(this.currentPoint.clone(),new Vector2(_,tt),new Vector2(ot,st));return this.curves.push(at),this.currentPoint.set(ot,st),this}bezierCurveTo(_,tt,ot,st,at,lt){const dt=new CubicBezierCurve(this.currentPoint.clone(),new Vector2(_,tt),new Vector2(ot,st),new Vector2(at,lt));return this.curves.push(dt),this.currentPoint.set(at,lt),this}splineThru(_){const tt=[this.currentPoint.clone()].concat(_),ot=new SplineCurve(tt);return this.curves.push(ot),this.currentPoint.copy(_[_.length-1]),this}arc(_,tt,ot,st,at,lt){const dt=this.currentPoint.x,ht=this.currentPoint.y;return this.absarc(_+dt,tt+ht,ot,st,at,lt),this}absarc(_,tt,ot,st,at,lt){return this.absellipse(_,tt,ot,ot,st,at,lt),this}ellipse(_,tt,ot,st,at,lt,dt,ht){const ft=this.currentPoint.x,gt=this.currentPoint.y;return this.absellipse(_+ft,tt+gt,ot,st,at,lt,dt,ht),this}absellipse(_,tt,ot,st,at,lt,dt,ht){const ft=new EllipseCurve(_,tt,ot,st,at,lt,dt,ht);if(this.curves.length>0){const Et=ft.getPoint(0);Et.equals(this.currentPoint)||this.lineTo(Et.x,Et.y)}this.curves.push(ft);const gt=ft.getPoint(1);return this.currentPoint.copy(gt),this}copy(_){return super.copy(_),this.currentPoint.copy(_.currentPoint),this}toJSON(){const _=super.toJSON();return _.currentPoint=this.currentPoint.toArray(),_}fromJSON(_){return super.fromJSON(_),this.currentPoint.fromArray(_.currentPoint),this}}class LatheGeometry extends BufferGeometry{constructor(_=[new Vector2(0,-.5),new Vector2(.5,0),new Vector2(0,.5)],tt=12,ot=0,st=Math.PI*2){super(),this.type="LatheGeometry",this.parameters={points:_,segments:tt,phiStart:ot,phiLength:st},tt=Math.floor(tt),st=clamp$3(st,0,Math.PI*2);const at=[],lt=[],dt=[],ht=[],ft=[],gt=1/tt,Et=new Vector3,yt=new Vector2,Ct=new Vector3,wt=new Vector3,It=new Vector3;let Pt=0,Rt=0;for(let xt=0;xt<=_.length-1;xt++)switch(xt){case 0:Pt=_[xt+1].x-_[xt].x,Rt=_[xt+1].y-_[xt].y,Ct.x=Rt*1,Ct.y=-Pt,Ct.z=Rt*0,It.copy(Ct),Ct.normalize(),ht.push(Ct.x,Ct.y,Ct.z);break;case _.length-1:ht.push(It.x,It.y,It.z);break;default:Pt=_[xt+1].x-_[xt].x,Rt=_[xt+1].y-_[xt].y,Ct.x=Rt*1,Ct.y=-Pt,Ct.z=Rt*0,wt.copy(Ct),Ct.x+=It.x,Ct.y+=It.y,Ct.z+=It.z,Ct.normalize(),ht.push(Ct.x,Ct.y,Ct.z),It.copy(wt)}for(let xt=0;xt<=tt;xt++){const Nt=ot+xt*gt*st,kt=Math.sin(Nt),Vt=Math.cos(Nt);for(let Ft=0;Ft<=_.length-1;Ft++){Et.x=_[Ft].x*kt,Et.y=_[Ft].y,Et.z=_[Ft].x*Vt,lt.push(Et.x,Et.y,Et.z),yt.x=xt/tt,yt.y=Ft/(_.length-1),dt.push(yt.x,yt.y);const zt=ht[3*Ft+0]*kt,Yt=ht[3*Ft+1],Kt=ht[3*Ft+0]*Vt;ft.push(zt,Yt,Kt)}}for(let xt=0;xt<tt;xt++)for(let Nt=0;Nt<_.length-1;Nt++){const kt=Nt+xt*_.length,Vt=kt,Ft=kt+_.length,zt=kt+_.length+1,Yt=kt+1;at.push(Vt,Ft,Yt),at.push(zt,Yt,Ft)}this.setIndex(at),this.setAttribute("position",new Float32BufferAttribute(lt,3)),this.setAttribute("uv",new Float32BufferAttribute(dt,2)),this.setAttribute("normal",new Float32BufferAttribute(ft,3))}copy(_){return super.copy(_),this.parameters=Object.assign({},_.parameters),this}static fromJSON(_){return new LatheGeometry(_.points,_.segments,_.phiStart,_.phiLength)}}class CapsuleGeometry extends LatheGeometry{constructor(_=1,tt=1,ot=4,st=8){const at=new Path;at.absarc(0,-tt/2,_,Math.PI*1.5,0),at.absarc(0,tt/2,_,0,Math.PI*.5),super(at.getPoints(ot),st),this.type="CapsuleGeometry",this.parameters={radius:_,height:tt,capSegments:ot,radialSegments:st}}static fromJSON(_){return new CapsuleGeometry(_.radius,_.length,_.capSegments,_.radialSegments)}}class CircleGeometry extends BufferGeometry{constructor(_=1,tt=32,ot=0,st=Math.PI*2){super(),this.type="CircleGeometry",this.parameters={radius:_,segments:tt,thetaStart:ot,thetaLength:st},tt=Math.max(3,tt);const at=[],lt=[],dt=[],ht=[],ft=new Vector3,gt=new Vector2;lt.push(0,0,0),dt.push(0,0,1),ht.push(.5,.5);for(let Et=0,yt=3;Et<=tt;Et++,yt+=3){const Ct=ot+Et/tt*st;ft.x=_*Math.cos(Ct),ft.y=_*Math.sin(Ct),lt.push(ft.x,ft.y,ft.z),dt.push(0,0,1),gt.x=(lt[yt]/_+1)/2,gt.y=(lt[yt+1]/_+1)/2,ht.push(gt.x,gt.y)}for(let Et=1;Et<=tt;Et++)at.push(Et,Et+1,0);this.setIndex(at),this.setAttribute("position",new Float32BufferAttribute(lt,3)),this.setAttribute("normal",new Float32BufferAttribute(dt,3)),this.setAttribute("uv",new Float32BufferAttribute(ht,2))}copy(_){return super.copy(_),this.parameters=Object.assign({},_.parameters),this}static fromJSON(_){return new CircleGeometry(_.radius,_.segments,_.thetaStart,_.thetaLength)}}class CylinderGeometry extends BufferGeometry{constructor(_=1,tt=1,ot=1,st=32,at=1,lt=!1,dt=0,ht=Math.PI*2){super(),this.type="CylinderGeometry",this.parameters={radiusTop:_,radiusBottom:tt,height:ot,radialSegments:st,heightSegments:at,openEnded:lt,thetaStart:dt,thetaLength:ht};const ft=this;st=Math.floor(st),at=Math.floor(at);const gt=[],Et=[],yt=[],Ct=[];let wt=0;const It=[],Pt=ot/2;let Rt=0;xt(),lt===!1&&(_>0&&Nt(!0),tt>0&&Nt(!1)),this.setIndex(gt),this.setAttribute("position",new Float32BufferAttribute(Et,3)),this.setAttribute("normal",new Float32BufferAttribute(yt,3)),this.setAttribute("uv",new Float32BufferAttribute(Ct,2));function xt(){const kt=new Vector3,Vt=new Vector3;let Ft=0;const zt=(tt-_)/ot;for(let Yt=0;Yt<=at;Yt++){const Kt=[],qt=Yt/at,pn=qt*(tt-_)+_;for(let an=0;an<=st;an++){const fn=an/st,dn=fn*ht+dt,Cn=Math.sin(dn),On=Math.cos(dn);Vt.x=pn*Cn,Vt.y=-qt*ot+Pt,Vt.z=pn*On,Et.push(Vt.x,Vt.y,Vt.z),kt.set(Cn,zt,On).normalize(),yt.push(kt.x,kt.y,kt.z),Ct.push(fn,1-qt),Kt.push(wt++)}It.push(Kt)}for(let Yt=0;Yt<st;Yt++)for(let Kt=0;Kt<at;Kt++){const qt=It[Kt][Yt],pn=It[Kt+1][Yt],an=It[Kt+1][Yt+1],fn=It[Kt][Yt+1];gt.push(qt,pn,fn),gt.push(pn,an,fn),Ft+=6}ft.addGroup(Rt,Ft,0),Rt+=Ft}function Nt(kt){const Vt=wt,Ft=new Vector2,zt=new Vector3;let Yt=0;const Kt=kt===!0?_:tt,qt=kt===!0?1:-1;for(let an=1;an<=st;an++)Et.push(0,Pt*qt,0),yt.push(0,qt,0),Ct.push(.5,.5),wt++;const pn=wt;for(let an=0;an<=st;an++){const dn=an/st*ht+dt,Cn=Math.cos(dn),On=Math.sin(dn);zt.x=Kt*On,zt.y=Pt*qt,zt.z=Kt*Cn,Et.push(zt.x,zt.y,zt.z),yt.push(0,qt,0),Ft.x=Cn*.5+.5,Ft.y=On*.5*qt+.5,Ct.push(Ft.x,Ft.y),wt++}for(let an=0;an<st;an++){const fn=Vt+an,dn=pn+an;kt===!0?gt.push(dn,dn+1,fn):gt.push(dn+1,dn,fn),Yt+=3}ft.addGroup(Rt,Yt,kt===!0?1:2),Rt+=Yt}}copy(_){return super.copy(_),this.parameters=Object.assign({},_.parameters),this}static fromJSON(_){return new CylinderGeometry(_.radiusTop,_.radiusBottom,_.height,_.radialSegments,_.heightSegments,_.openEnded,_.thetaStart,_.thetaLength)}}class ConeGeometry extends CylinderGeometry{constructor(_=1,tt=1,ot=32,st=1,at=!1,lt=0,dt=Math.PI*2){super(0,_,tt,ot,st,at,lt,dt),this.type="ConeGeometry",this.parameters={radius:_,height:tt,radialSegments:ot,heightSegments:st,openEnded:at,thetaStart:lt,thetaLength:dt}}static fromJSON(_){return new ConeGeometry(_.radius,_.height,_.radialSegments,_.heightSegments,_.openEnded,_.thetaStart,_.thetaLength)}}class PolyhedronGeometry extends BufferGeometry{constructor(_=[],tt=[],ot=1,st=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:_,indices:tt,radius:ot,detail:st};const at=[],lt=[];dt(st),ft(ot),gt(),this.setAttribute("position",new Float32BufferAttribute(at,3)),this.setAttribute("normal",new Float32BufferAttribute(at.slice(),3)),this.setAttribute("uv",new Float32BufferAttribute(lt,2)),st===0?this.computeVertexNormals():this.normalizeNormals();function dt(xt){const Nt=new Vector3,kt=new Vector3,Vt=new Vector3;for(let Ft=0;Ft<tt.length;Ft+=3)Ct(tt[Ft+0],Nt),Ct(tt[Ft+1],kt),Ct(tt[Ft+2],Vt),ht(Nt,kt,Vt,xt)}function ht(xt,Nt,kt,Vt){const Ft=Vt+1,zt=[];for(let Yt=0;Yt<=Ft;Yt++){zt[Yt]=[];const Kt=xt.clone().lerp(kt,Yt/Ft),qt=Nt.clone().lerp(kt,Yt/Ft),pn=Ft-Yt;for(let an=0;an<=pn;an++)an===0&&Yt===Ft?zt[Yt][an]=Kt:zt[Yt][an]=Kt.clone().lerp(qt,an/pn)}for(let Yt=0;Yt<Ft;Yt++)for(let Kt=0;Kt<2*(Ft-Yt)-1;Kt++){const qt=Math.floor(Kt/2);Kt%2===0?(yt(zt[Yt][qt+1]),yt(zt[Yt+1][qt]),yt(zt[Yt][qt])):(yt(zt[Yt][qt+1]),yt(zt[Yt+1][qt+1]),yt(zt[Yt+1][qt]))}}function ft(xt){const Nt=new Vector3;for(let kt=0;kt<at.length;kt+=3)Nt.x=at[kt+0],Nt.y=at[kt+1],Nt.z=at[kt+2],Nt.normalize().multiplyScalar(xt),at[kt+0]=Nt.x,at[kt+1]=Nt.y,at[kt+2]=Nt.z}function gt(){const xt=new Vector3;for(let Nt=0;Nt<at.length;Nt+=3){xt.x=at[Nt+0],xt.y=at[Nt+1],xt.z=at[Nt+2];const kt=Pt(xt)/2/Math.PI+.5,Vt=Rt(xt)/Math.PI+.5;lt.push(kt,1-Vt)}wt(),Et()}function Et(){for(let xt=0;xt<lt.length;xt+=6){const Nt=lt[xt+0],kt=lt[xt+2],Vt=lt[xt+4],Ft=Math.max(Nt,kt,Vt),zt=Math.min(Nt,kt,Vt);Ft>.9&&zt<.1&&(Nt<.2&&(lt[xt+0]+=1),kt<.2&&(lt[xt+2]+=1),Vt<.2&&(lt[xt+4]+=1))}}function yt(xt){at.push(xt.x,xt.y,xt.z)}function Ct(xt,Nt){const kt=xt*3;Nt.x=_[kt+0],Nt.y=_[kt+1],Nt.z=_[kt+2]}function wt(){const xt=new Vector3,Nt=new Vector3,kt=new Vector3,Vt=new Vector3,Ft=new Vector2,zt=new Vector2,Yt=new Vector2;for(let Kt=0,qt=0;Kt<at.length;Kt+=9,qt+=6){xt.set(at[Kt+0],at[Kt+1],at[Kt+2]),Nt.set(at[Kt+3],at[Kt+4],at[Kt+5]),kt.set(at[Kt+6],at[Kt+7],at[Kt+8]),Ft.set(lt[qt+0],lt[qt+1]),zt.set(lt[qt+2],lt[qt+3]),Yt.set(lt[qt+4],lt[qt+5]),Vt.copy(xt).add(Nt).add(kt).divideScalar(3);const pn=Pt(Vt);It(Ft,qt+0,xt,pn),It(zt,qt+2,Nt,pn),It(Yt,qt+4,kt,pn)}}function It(xt,Nt,kt,Vt){Vt<0&&xt.x===1&&(lt[Nt]=xt.x-1),kt.x===0&&kt.z===0&&(lt[Nt]=Vt/2/Math.PI+.5)}function Pt(xt){return Math.atan2(xt.z,-xt.x)}function Rt(xt){return Math.atan2(-xt.y,Math.sqrt(xt.x*xt.x+xt.z*xt.z))}}copy(_){return super.copy(_),this.parameters=Object.assign({},_.parameters),this}static fromJSON(_){return new PolyhedronGeometry(_.vertices,_.indices,_.radius,_.details)}}class DodecahedronGeometry extends PolyhedronGeometry{constructor(_=1,tt=0){const ot=(1+Math.sqrt(5))/2,st=1/ot,at=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-st,-ot,0,-st,ot,0,st,-ot,0,st,ot,-st,-ot,0,-st,ot,0,st,-ot,0,st,ot,0,-ot,0,-st,ot,0,-st,-ot,0,st,ot,0,st],lt=[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9];super(at,lt,_,tt),this.type="DodecahedronGeometry",this.parameters={radius:_,detail:tt}}static fromJSON(_){return new DodecahedronGeometry(_.radius,_.detail)}}const _v0=new Vector3,_v1$1=new Vector3,_normal=new Vector3,_triangle=new Triangle;class EdgesGeometry extends BufferGeometry{constructor(_=null,tt=1){if(super(),this.type="EdgesGeometry",this.parameters={geometry:_,thresholdAngle:tt},_!==null){const st=Math.pow(10,4),at=Math.cos(DEG2RAD$1*tt),lt=_.getIndex(),dt=_.getAttribute("position"),ht=lt?lt.count:dt.count,ft=[0,0,0],gt=["a","b","c"],Et=new Array(3),yt={},Ct=[];for(let wt=0;wt<ht;wt+=3){lt?(ft[0]=lt.getX(wt),ft[1]=lt.getX(wt+1),ft[2]=lt.getX(wt+2)):(ft[0]=wt,ft[1]=wt+1,ft[2]=wt+2);const{a:It,b:Pt,c:Rt}=_triangle;if(It.fromBufferAttribute(dt,ft[0]),Pt.fromBufferAttribute(dt,ft[1]),Rt.fromBufferAttribute(dt,ft[2]),_triangle.getNormal(_normal),Et[0]=`${Math.round(It.x*st)},${Math.round(It.y*st)},${Math.round(It.z*st)}`,Et[1]=`${Math.round(Pt.x*st)},${Math.round(Pt.y*st)},${Math.round(Pt.z*st)}`,Et[2]=`${Math.round(Rt.x*st)},${Math.round(Rt.y*st)},${Math.round(Rt.z*st)}`,!(Et[0]===Et[1]||Et[1]===Et[2]||Et[2]===Et[0]))for(let xt=0;xt<3;xt++){const Nt=(xt+1)%3,kt=Et[xt],Vt=Et[Nt],Ft=_triangle[gt[xt]],zt=_triangle[gt[Nt]],Yt=`${kt}_${Vt}`,Kt=`${Vt}_${kt}`;Kt in yt&&yt[Kt]?(_normal.dot(yt[Kt].normal)<=at&&(Ct.push(Ft.x,Ft.y,Ft.z),Ct.push(zt.x,zt.y,zt.z)),yt[Kt]=null):Yt in yt||(yt[Yt]={index0:ft[xt],index1:ft[Nt],normal:_normal.clone()})}}for(const wt in yt)if(yt[wt]){const{index0:It,index1:Pt}=yt[wt];_v0.fromBufferAttribute(dt,It),_v1$1.fromBufferAttribute(dt,Pt),Ct.push(_v0.x,_v0.y,_v0.z),Ct.push(_v1$1.x,_v1$1.y,_v1$1.z)}this.setAttribute("position",new Float32BufferAttribute(Ct,3))}}copy(_){return super.copy(_),this.parameters=Object.assign({},_.parameters),this}}class Shape extends Path{constructor(_){super(_),this.uuid=generateUUID$1(),this.type="Shape",this.holes=[]}getPointsHoles(_){const tt=[];for(let ot=0,st=this.holes.length;ot<st;ot++)tt[ot]=this.holes[ot].getPoints(_);return tt}extractPoints(_){return{shape:this.getPoints(_),holes:this.getPointsHoles(_)}}copy(_){super.copy(_),this.holes=[];for(let tt=0,ot=_.holes.length;tt<ot;tt++){const st=_.holes[tt];this.holes.push(st.clone())}return this}toJSON(){const _=super.toJSON();_.uuid=this.uuid,_.holes=[];for(let tt=0,ot=this.holes.length;tt<ot;tt++){const st=this.holes[tt];_.holes.push(st.toJSON())}return _}fromJSON(_){super.fromJSON(_),this.uuid=_.uuid,this.holes=[];for(let tt=0,ot=_.holes.length;tt<ot;tt++){const st=_.holes[tt];this.holes.push(new Path().fromJSON(st))}return this}}const Earcut={triangulate:function(nt,_,tt=2){const ot=_&&_.length,st=ot?_[0]*tt:nt.length;let at=linkedList(nt,0,st,tt,!0);const lt=[];if(!at||at.next===at.prev)return lt;let dt,ht,ft,gt,Et,yt,Ct;if(ot&&(at=eliminateHoles(nt,_,at,tt)),nt.length>80*tt){dt=ft=nt[0],ht=gt=nt[1];for(let wt=tt;wt<st;wt+=tt)Et=nt[wt],yt=nt[wt+1],Et<dt&&(dt=Et),yt<ht&&(ht=yt),Et>ft&&(ft=Et),yt>gt&&(gt=yt);Ct=Math.max(ft-dt,gt-ht),Ct=Ct!==0?32767/Ct:0}return earcutLinked(at,lt,tt,dt,ht,Ct,0),lt}};function linkedList(nt,_,tt,ot,st){let at,lt;if(st===signedArea(nt,_,tt,ot)>0)for(at=_;at<tt;at+=ot)lt=insertNode(at,nt[at],nt[at+1],lt);else for(at=tt-ot;at>=_;at-=ot)lt=insertNode(at,nt[at],nt[at+1],lt);return lt&&equals(lt,lt.next)&&(removeNode(lt),lt=lt.next),lt}function filterPoints(nt,_){if(!nt)return nt;_||(_=nt);let tt=nt,ot;do if(ot=!1,!tt.steiner&&(equals(tt,tt.next)||area(tt.prev,tt,tt.next)===0)){if(removeNode(tt),tt=_=tt.prev,tt===tt.next)break;ot=!0}else tt=tt.next;while(ot||tt!==_);return _}function earcutLinked(nt,_,tt,ot,st,at,lt){if(!nt)return;!lt&&at&&indexCurve(nt,ot,st,at);let dt=nt,ht,ft;for(;nt.prev!==nt.next;){if(ht=nt.prev,ft=nt.next,at?isEarHashed(nt,ot,st,at):isEar(nt)){_.push(ht.i/tt|0),_.push(nt.i/tt|0),_.push(ft.i/tt|0),removeNode(nt),nt=ft.next,dt=ft.next;continue}if(nt=ft,nt===dt){lt?lt===1?(nt=cureLocalIntersections(filterPoints(nt),_,tt),earcutLinked(nt,_,tt,ot,st,at,2)):lt===2&&splitEarcut(nt,_,tt,ot,st,at):earcutLinked(filterPoints(nt),_,tt,ot,st,at,1);break}}}function isEar(nt){const _=nt.prev,tt=nt,ot=nt.next;if(area(_,tt,ot)>=0)return!1;const st=_.x,at=tt.x,lt=ot.x,dt=_.y,ht=tt.y,ft=ot.y,gt=st<at?st<lt?st:lt:at<lt?at:lt,Et=dt<ht?dt<ft?dt:ft:ht<ft?ht:ft,yt=st>at?st>lt?st:lt:at>lt?at:lt,Ct=dt>ht?dt>ft?dt:ft:ht>ft?ht:ft;let wt=ot.next;for(;wt!==_;){if(wt.x>=gt&&wt.x<=yt&&wt.y>=Et&&wt.y<=Ct&&pointInTriangle(st,dt,at,ht,lt,ft,wt.x,wt.y)&&area(wt.prev,wt,wt.next)>=0)return!1;wt=wt.next}return!0}function isEarHashed(nt,_,tt,ot){const st=nt.prev,at=nt,lt=nt.next;if(area(st,at,lt)>=0)return!1;const dt=st.x,ht=at.x,ft=lt.x,gt=st.y,Et=at.y,yt=lt.y,Ct=dt<ht?dt<ft?dt:ft:ht<ft?ht:ft,wt=gt<Et?gt<yt?gt:yt:Et<yt?Et:yt,It=dt>ht?dt>ft?dt:ft:ht>ft?ht:ft,Pt=gt>Et?gt>yt?gt:yt:Et>yt?Et:yt,Rt=zOrder(Ct,wt,_,tt,ot),xt=zOrder(It,Pt,_,tt,ot);let Nt=nt.prevZ,kt=nt.nextZ;for(;Nt&&Nt.z>=Rt&&kt&&kt.z<=xt;){if(Nt.x>=Ct&&Nt.x<=It&&Nt.y>=wt&&Nt.y<=Pt&&Nt!==st&&Nt!==lt&&pointInTriangle(dt,gt,ht,Et,ft,yt,Nt.x,Nt.y)&&area(Nt.prev,Nt,Nt.next)>=0||(Nt=Nt.prevZ,kt.x>=Ct&&kt.x<=It&&kt.y>=wt&&kt.y<=Pt&&kt!==st&&kt!==lt&&pointInTriangle(dt,gt,ht,Et,ft,yt,kt.x,kt.y)&&area(kt.prev,kt,kt.next)>=0))return!1;kt=kt.nextZ}for(;Nt&&Nt.z>=Rt;){if(Nt.x>=Ct&&Nt.x<=It&&Nt.y>=wt&&Nt.y<=Pt&&Nt!==st&&Nt!==lt&&pointInTriangle(dt,gt,ht,Et,ft,yt,Nt.x,Nt.y)&&area(Nt.prev,Nt,Nt.next)>=0)return!1;Nt=Nt.prevZ}for(;kt&&kt.z<=xt;){if(kt.x>=Ct&&kt.x<=It&&kt.y>=wt&&kt.y<=Pt&&kt!==st&&kt!==lt&&pointInTriangle(dt,gt,ht,Et,ft,yt,kt.x,kt.y)&&area(kt.prev,kt,kt.next)>=0)return!1;kt=kt.nextZ}return!0}function cureLocalIntersections(nt,_,tt){let ot=nt;do{const st=ot.prev,at=ot.next.next;!equals(st,at)&&intersects(st,ot,ot.next,at)&&locallyInside(st,at)&&locallyInside(at,st)&&(_.push(st.i/tt|0),_.push(ot.i/tt|0),_.push(at.i/tt|0),removeNode(ot),removeNode(ot.next),ot=nt=at),ot=ot.next}while(ot!==nt);return filterPoints(ot)}function splitEarcut(nt,_,tt,ot,st,at){let lt=nt;do{let dt=lt.next.next;for(;dt!==lt.prev;){if(lt.i!==dt.i&&isValidDiagonal(lt,dt)){let ht=splitPolygon(lt,dt);lt=filterPoints(lt,lt.next),ht=filterPoints(ht,ht.next),earcutLinked(lt,_,tt,ot,st,at,0),earcutLinked(ht,_,tt,ot,st,at,0);return}dt=dt.next}lt=lt.next}while(lt!==nt)}function eliminateHoles(nt,_,tt,ot){const st=[];let at,lt,dt,ht,ft;for(at=0,lt=_.length;at<lt;at++)dt=_[at]*ot,ht=at<lt-1?_[at+1]*ot:nt.length,ft=linkedList(nt,dt,ht,ot,!1),ft===ft.next&&(ft.steiner=!0),st.push(getLeftmost(ft));for(st.sort(compareX),at=0;at<st.length;at++)tt=eliminateHole(st[at],tt);return tt}function compareX(nt,_){return nt.x-_.x}function eliminateHole(nt,_){const tt=findHoleBridge(nt,_);if(!tt)return _;const ot=splitPolygon(tt,nt);return filterPoints(ot,ot.next),filterPoints(tt,tt.next)}function findHoleBridge(nt,_){let tt=_,ot=-1/0,st;const at=nt.x,lt=nt.y;do{if(lt<=tt.y&&lt>=tt.next.y&&tt.next.y!==tt.y){const yt=tt.x+(lt-tt.y)*(tt.next.x-tt.x)/(tt.next.y-tt.y);if(yt<=at&&yt>ot&&(ot=yt,st=tt.x<tt.next.x?tt:tt.next,yt===at))return st}tt=tt.next}while(tt!==_);if(!st)return null;const dt=st,ht=st.x,ft=st.y;let gt=1/0,Et;tt=st;do at>=tt.x&&tt.x>=ht&&at!==tt.x&&pointInTriangle(lt<ft?at:ot,lt,ht,ft,lt<ft?ot:at,lt,tt.x,tt.y)&&(Et=Math.abs(lt-tt.y)/(at-tt.x),locallyInside(tt,nt)&&(Et<gt||Et===gt&&(tt.x>st.x||tt.x===st.x&&sectorContainsSector(st,tt)))&&(st=tt,gt=Et)),tt=tt.next;while(tt!==dt);return st}function sectorContainsSector(nt,_){return area(nt.prev,nt,_.prev)<0&&area(_.next,nt,nt.next)<0}function indexCurve(nt,_,tt,ot){let st=nt;do st.z===0&&(st.z=zOrder(st.x,st.y,_,tt,ot)),st.prevZ=st.prev,st.nextZ=st.next,st=st.next;while(st!==nt);st.prevZ.nextZ=null,st.prevZ=null,sortLinked(st)}function sortLinked(nt){let _,tt,ot,st,at,lt,dt,ht,ft=1;do{for(tt=nt,nt=null,at=null,lt=0;tt;){for(lt++,ot=tt,dt=0,_=0;_<ft&&(dt++,ot=ot.nextZ,!!ot);_++);for(ht=ft;dt>0||ht>0&&ot;)dt!==0&&(ht===0||!ot||tt.z<=ot.z)?(st=tt,tt=tt.nextZ,dt--):(st=ot,ot=ot.nextZ,ht--),at?at.nextZ=st:nt=st,st.prevZ=at,at=st;tt=ot}at.nextZ=null,ft*=2}while(lt>1);return nt}function zOrder(nt,_,tt,ot,st){return nt=(nt-tt)*st|0,_=(_-ot)*st|0,nt=(nt|nt<<8)&16711935,nt=(nt|nt<<4)&252645135,nt=(nt|nt<<2)&858993459,nt=(nt|nt<<1)&1431655765,_=(_|_<<8)&16711935,_=(_|_<<4)&252645135,_=(_|_<<2)&858993459,_=(_|_<<1)&1431655765,nt|_<<1}function getLeftmost(nt){let _=nt,tt=nt;do(_.x<tt.x||_.x===tt.x&&_.y<tt.y)&&(tt=_),_=_.next;while(_!==nt);return tt}function pointInTriangle(nt,_,tt,ot,st,at,lt,dt){return(st-lt)*(_-dt)>=(nt-lt)*(at-dt)&&(nt-lt)*(ot-dt)>=(tt-lt)*(_-dt)&&(tt-lt)*(at-dt)>=(st-lt)*(ot-dt)}function isValidDiagonal(nt,_){return nt.next.i!==_.i&&nt.prev.i!==_.i&&!intersectsPolygon(nt,_)&&(locallyInside(nt,_)&&locallyInside(_,nt)&&middleInside(nt,_)&&(area(nt.prev,nt,_.prev)||area(nt,_.prev,_))||equals(nt,_)&&area(nt.prev,nt,nt.next)>0&&area(_.prev,_,_.next)>0)}function area(nt,_,tt){return(_.y-nt.y)*(tt.x-_.x)-(_.x-nt.x)*(tt.y-_.y)}function equals(nt,_){return nt.x===_.x&&nt.y===_.y}function intersects(nt,_,tt,ot){const st=sign(area(nt,_,tt)),at=sign(area(nt,_,ot)),lt=sign(area(tt,ot,nt)),dt=sign(area(tt,ot,_));return!!(st!==at&&lt!==dt||st===0&&onSegment(nt,tt,_)||at===0&&onSegment(nt,ot,_)||lt===0&&onSegment(tt,nt,ot)||dt===0&&onSegment(tt,_,ot))}function onSegment(nt,_,tt){return _.x<=Math.max(nt.x,tt.x)&&_.x>=Math.min(nt.x,tt.x)&&_.y<=Math.max(nt.y,tt.y)&&_.y>=Math.min(nt.y,tt.y)}function sign(nt){return nt>0?1:nt<0?-1:0}function intersectsPolygon(nt,_){let tt=nt;do{if(tt.i!==nt.i&&tt.next.i!==nt.i&&tt.i!==_.i&&tt.next.i!==_.i&&intersects(tt,tt.next,nt,_))return!0;tt=tt.next}while(tt!==nt);return!1}function locallyInside(nt,_){return area(nt.prev,nt,nt.next)<0?area(nt,_,nt.next)>=0&&area(nt,nt.prev,_)>=0:area(nt,_,nt.prev)<0||area(nt,nt.next,_)<0}function middleInside(nt,_){let tt=nt,ot=!1;const st=(nt.x+_.x)/2,at=(nt.y+_.y)/2;do tt.y>at!=tt.next.y>at&&tt.next.y!==tt.y&&st<(tt.next.x-tt.x)*(at-tt.y)/(tt.next.y-tt.y)+tt.x&&(ot=!ot),tt=tt.next;while(tt!==nt);return ot}function splitPolygon(nt,_){const tt=new Node(nt.i,nt.x,nt.y),ot=new Node(_.i,_.x,_.y),st=nt.next,at=_.prev;return nt.next=_,_.prev=nt,tt.next=st,st.prev=tt,ot.next=tt,tt.prev=ot,at.next=ot,ot.prev=at,ot}function insertNode(nt,_,tt,ot){const st=new Node(nt,_,tt);return ot?(st.next=ot.next,st.prev=ot,ot.next.prev=st,ot.next=st):(st.prev=st,st.next=st),st}function removeNode(nt){nt.next.prev=nt.prev,nt.prev.next=nt.next,nt.prevZ&&(nt.prevZ.nextZ=nt.nextZ),nt.nextZ&&(nt.nextZ.prevZ=nt.prevZ)}function Node(nt,_,tt){this.i=nt,this.x=_,this.y=tt,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function signedArea(nt,_,tt,ot){let st=0;for(let at=_,lt=tt-ot;at<tt;at+=ot)st+=(nt[lt]-nt[at])*(nt[at+1]+nt[lt+1]),lt=at;return st}class ShapeUtils{static area(_){const tt=_.length;let ot=0;for(let st=tt-1,at=0;at<tt;st=at++)ot+=_[st].x*_[at].y-_[at].x*_[st].y;return ot*.5}static isClockWise(_){return ShapeUtils.area(_)<0}static triangulateShape(_,tt){const ot=[],st=[],at=[];removeDupEndPts(_),addContour(ot,_);let lt=_.length;tt.forEach(removeDupEndPts);for(let ht=0;ht<tt.length;ht++)st.push(lt),lt+=tt[ht].length,addContour(ot,tt[ht]);const dt=Earcut.triangulate(ot,st);for(let ht=0;ht<dt.length;ht+=3)at.push(dt.slice(ht,ht+3));return at}}function removeDupEndPts(nt){const _=nt.length;_>2&&nt[_-1].equals(nt[0])&&nt.pop()}function addContour(nt,_){for(let tt=0;tt<_.length;tt++)nt.push(_[tt].x),nt.push(_[tt].y)}class ExtrudeGeometry extends BufferGeometry{constructor(_=new Shape([new Vector2(.5,.5),new Vector2(-.5,.5),new Vector2(-.5,-.5),new Vector2(.5,-.5)]),tt={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:_,options:tt},_=Array.isArray(_)?_:[_];const ot=this,st=[],at=[];for(let dt=0,ht=_.length;dt<ht;dt++){const ft=_[dt];lt(ft)}this.setAttribute("position",new Float32BufferAttribute(st,3)),this.setAttribute("uv",new Float32BufferAttribute(at,2)),this.computeVertexNormals();function lt(dt){const ht=[],ft=tt.curveSegments!==void 0?tt.curveSegments:12,gt=tt.steps!==void 0?tt.steps:1,Et=tt.depth!==void 0?tt.depth:1;let yt=tt.bevelEnabled!==void 0?tt.bevelEnabled:!0,Ct=tt.bevelThickness!==void 0?tt.bevelThickness:.2,wt=tt.bevelSize!==void 0?tt.bevelSize:Ct-.1,It=tt.bevelOffset!==void 0?tt.bevelOffset:0,Pt=tt.bevelSegments!==void 0?tt.bevelSegments:3;const Rt=tt.extrudePath,xt=tt.UVGenerator!==void 0?tt.UVGenerator:WorldUVGenerator;let Nt,kt=!1,Vt,Ft,zt,Yt;Rt&&(Nt=Rt.getSpacedPoints(gt),kt=!0,yt=!1,Vt=Rt.computeFrenetFrames(gt,!1),Ft=new Vector3,zt=new Vector3,Yt=new Vector3),yt||(Pt=0,Ct=0,wt=0,It=0);const Kt=dt.extractPoints(ft);let qt=Kt.shape;const pn=Kt.holes;if(!ShapeUtils.isClockWise(qt)){qt=qt.reverse();for(let Zt=0,wn=pn.length;Zt<wn;Zt++){const xn=pn[Zt];ShapeUtils.isClockWise(xn)&&(pn[Zt]=xn.reverse())}}const fn=ShapeUtils.triangulateShape(qt,pn),dn=qt;for(let Zt=0,wn=pn.length;Zt<wn;Zt++){const xn=pn[Zt];qt=qt.concat(xn)}function Cn(Zt,wn,xn){return wn||console.error("THREE.ExtrudeGeometry: vec does not exist"),Zt.clone().addScaledVector(wn,xn)}const On=qt.length,Pn=fn.length;function yn(Zt,wn,xn){let Hn,Bn,cr;const Wn=Zt.x-wn.x,rr=Zt.y-wn.y,sr=xn.x-Zt.x,ir=xn.y-Zt.y,kr=Wn*Wn+rr*rr,un=Wn*ir-rr*sr;if(Math.abs(un)>Number.EPSILON){const sn=Math.sqrt(kr),Kn=Math.sqrt(sr*sr+ir*ir),Sr=wn.x-rr/sn,lr=wn.y+Wn/sn,vr=xn.x-ir/Kn,Fr=xn.y+sr/Kn,Gr=((vr-Sr)*ir-(Fr-lr)*sr)/(Wn*ir-rr*sr);Hn=Sr+Wn*Gr-Zt.x,Bn=lr+rr*Gr-Zt.y;const dr=Hn*Hn+Bn*Bn;if(dr<=2)return new Vector2(Hn,Bn);cr=Math.sqrt(dr/2)}else{let sn=!1;Wn>Number.EPSILON?sr>Number.EPSILON&&(sn=!0):Wn<-Number.EPSILON?sr<-Number.EPSILON&&(sn=!0):Math.sign(rr)===Math.sign(ir)&&(sn=!0),sn?(Hn=-rr,Bn=Wn,cr=Math.sqrt(kr)):(Hn=Wn,Bn=rr,cr=Math.sqrt(kr/2))}return new Vector2(Hn/cr,Bn/cr)}const An=[];for(let Zt=0,wn=dn.length,xn=wn-1,Hn=Zt+1;Zt<wn;Zt++,xn++,Hn++)xn===wn&&(xn=0),Hn===wn&&(Hn=0),An[Zt]=yn(dn[Zt],dn[xn],dn[Hn]);const Sn=[];let gn,_n=An.concat();for(let Zt=0,wn=pn.length;Zt<wn;Zt++){const xn=pn[Zt];gn=[];for(let Hn=0,Bn=xn.length,cr=Bn-1,Wn=Hn+1;Hn<Bn;Hn++,cr++,Wn++)cr===Bn&&(cr=0),Wn===Bn&&(Wn=0),gn[Hn]=yn(xn[Hn],xn[cr],xn[Wn]);Sn.push(gn),_n=_n.concat(gn)}for(let Zt=0;Zt<Pt;Zt++){const wn=Zt/Pt,xn=Ct*Math.cos(wn*Math.PI/2),Hn=wt*Math.sin(wn*Math.PI/2)+It;for(let Bn=0,cr=dn.length;Bn<cr;Bn++){const Wn=Cn(dn[Bn],An[Bn],Hn);Gn(Wn.x,Wn.y,-xn)}for(let Bn=0,cr=pn.length;Bn<cr;Bn++){const Wn=pn[Bn];gn=Sn[Bn];for(let rr=0,sr=Wn.length;rr<sr;rr++){const ir=Cn(Wn[rr],gn[rr],Hn);Gn(ir.x,ir.y,-xn)}}}const Rn=wt+It;for(let Zt=0;Zt<On;Zt++){const wn=yt?Cn(qt[Zt],_n[Zt],Rn):qt[Zt];kt?(zt.copy(Vt.normals[0]).multiplyScalar(wn.x),Ft.copy(Vt.binormals[0]).multiplyScalar(wn.y),Yt.copy(Nt[0]).add(zt).add(Ft),Gn(Yt.x,Yt.y,Yt.z)):Gn(wn.x,wn.y,0)}for(let Zt=1;Zt<=gt;Zt++)for(let wn=0;wn<On;wn++){const xn=yt?Cn(qt[wn],_n[wn],Rn):qt[wn];kt?(zt.copy(Vt.normals[Zt]).multiplyScalar(xn.x),Ft.copy(Vt.binormals[Zt]).multiplyScalar(xn.y),Yt.copy(Nt[Zt]).add(zt).add(Ft),Gn(Yt.x,Yt.y,Yt.z)):Gn(xn.x,xn.y,Et/gt*Zt)}for(let Zt=Pt-1;Zt>=0;Zt--){const wn=Zt/Pt,xn=Ct*Math.cos(wn*Math.PI/2),Hn=wt*Math.sin(wn*Math.PI/2)+It;for(let Bn=0,cr=dn.length;Bn<cr;Bn++){const Wn=Cn(dn[Bn],An[Bn],Hn);Gn(Wn.x,Wn.y,Et+xn)}for(let Bn=0,cr=pn.length;Bn<cr;Bn++){const Wn=pn[Bn];gn=Sn[Bn];for(let rr=0,sr=Wn.length;rr<sr;rr++){const ir=Cn(Wn[rr],gn[rr],Hn);kt?Gn(ir.x,ir.y+Nt[gt-1].y,Nt[gt-1].x+xn):Gn(ir.x,ir.y,Et+xn)}}}bn(),jn();function bn(){const Zt=st.length/3;if(yt){let wn=0,xn=On*wn;for(let Hn=0;Hn<Pn;Hn++){const Bn=fn[Hn];Vn(Bn[2]+xn,Bn[1]+xn,Bn[0]+xn)}wn=gt+Pt*2,xn=On*wn;for(let Hn=0;Hn<Pn;Hn++){const Bn=fn[Hn];Vn(Bn[0]+xn,Bn[1]+xn,Bn[2]+xn)}}else{for(let wn=0;wn<Pn;wn++){const xn=fn[wn];Vn(xn[2],xn[1],xn[0])}for(let wn=0;wn<Pn;wn++){const xn=fn[wn];Vn(xn[0]+On*gt,xn[1]+On*gt,xn[2]+On*gt)}}ot.addGroup(Zt,st.length/3-Zt,0)}function jn(){const Zt=st.length/3;let wn=0;kn(dn,wn),wn+=dn.length;for(let xn=0,Hn=pn.length;xn<Hn;xn++){const Bn=pn[xn];kn(Bn,wn),wn+=Bn.length}ot.addGroup(Zt,st.length/3-Zt,1)}function kn(Zt,wn){let xn=Zt.length;for(;--xn>=0;){const Hn=xn;let Bn=xn-1;Bn<0&&(Bn=Zt.length-1);for(let cr=0,Wn=gt+Pt*2;cr<Wn;cr++){const rr=On*cr,sr=On*(cr+1),ir=wn+Hn+rr,kr=wn+Bn+rr,un=wn+Bn+sr,sn=wn+Hn+sr;qn(ir,kr,un,sn)}}}function Gn(Zt,wn,xn){ht.push(Zt),ht.push(wn),ht.push(xn)}function Vn(Zt,wn,xn){Tr(Zt),Tr(wn),Tr(xn);const Hn=st.length/3,Bn=xt.generateTopUV(ot,st,Hn-3,Hn-2,Hn-1);Mn(Bn[0]),Mn(Bn[1]),Mn(Bn[2])}function qn(Zt,wn,xn,Hn){Tr(Zt),Tr(wn),Tr(Hn),Tr(wn),Tr(xn),Tr(Hn);const Bn=st.length/3,cr=xt.generateSideWallUV(ot,st,Bn-6,Bn-3,Bn-2,Bn-1);Mn(cr[0]),Mn(cr[1]),Mn(cr[3]),Mn(cr[1]),Mn(cr[2]),Mn(cr[3])}function Tr(Zt){st.push(ht[Zt*3+0]),st.push(ht[Zt*3+1]),st.push(ht[Zt*3+2])}function Mn(Zt){at.push(Zt.x),at.push(Zt.y)}}}copy(_){return super.copy(_),this.parameters=Object.assign({},_.parameters),this}toJSON(){const _=super.toJSON(),tt=this.parameters.shapes,ot=this.parameters.options;return toJSON$1(tt,ot,_)}static fromJSON(_,tt){const ot=[];for(let at=0,lt=_.shapes.length;at<lt;at++){const dt=tt[_.shapes[at]];ot.push(dt)}const st=_.options.extrudePath;return st!==void 0&&(_.options.extrudePath=new Curves[st.type]().fromJSON(st)),new ExtrudeGeometry(ot,_.options)}}const WorldUVGenerator={generateTopUV:function(nt,_,tt,ot,st){const at=_[tt*3],lt=_[tt*3+1],dt=_[ot*3],ht=_[ot*3+1],ft=_[st*3],gt=_[st*3+1];return[new Vector2(at,lt),new Vector2(dt,ht),new Vector2(ft,gt)]},generateSideWallUV:function(nt,_,tt,ot,st,at){const lt=_[tt*3],dt=_[tt*3+1],ht=_[tt*3+2],ft=_[ot*3],gt=_[ot*3+1],Et=_[ot*3+2],yt=_[st*3],Ct=_[st*3+1],wt=_[st*3+2],It=_[at*3],Pt=_[at*3+1],Rt=_[at*3+2];return Math.abs(dt-gt)<Math.abs(lt-ft)?[new Vector2(lt,1-ht),new Vector2(ft,1-Et),new Vector2(yt,1-wt),new Vector2(It,1-Rt)]:[new Vector2(dt,1-ht),new Vector2(gt,1-Et),new Vector2(Ct,1-wt),new Vector2(Pt,1-Rt)]}};function toJSON$1(nt,_,tt){if(tt.shapes=[],Array.isArray(nt))for(let ot=0,st=nt.length;ot<st;ot++){const at=nt[ot];tt.shapes.push(at.uuid)}else tt.shapes.push(nt.uuid);return tt.options=Object.assign({},_),_.extrudePath!==void 0&&(tt.options.extrudePath=_.extrudePath.toJSON()),tt}class IcosahedronGeometry extends PolyhedronGeometry{constructor(_=1,tt=0){const ot=(1+Math.sqrt(5))/2,st=[-1,ot,0,1,ot,0,-1,-ot,0,1,-ot,0,0,-1,ot,0,1,ot,0,-1,-ot,0,1,-ot,ot,0,-1,ot,0,1,-ot,0,-1,-ot,0,1],at=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1];super(st,at,_,tt),this.type="IcosahedronGeometry",this.parameters={radius:_,detail:tt}}static fromJSON(_){return new IcosahedronGeometry(_.radius,_.detail)}}class OctahedronGeometry extends PolyhedronGeometry{constructor(_=1,tt=0){const ot=[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],st=[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2];super(ot,st,_,tt),this.type="OctahedronGeometry",this.parameters={radius:_,detail:tt}}static fromJSON(_){return new OctahedronGeometry(_.radius,_.detail)}}class RingGeometry extends BufferGeometry{constructor(_=.5,tt=1,ot=32,st=1,at=0,lt=Math.PI*2){super(),this.type="RingGeometry",this.parameters={innerRadius:_,outerRadius:tt,thetaSegments:ot,phiSegments:st,thetaStart:at,thetaLength:lt},ot=Math.max(3,ot),st=Math.max(1,st);const dt=[],ht=[],ft=[],gt=[];let Et=_;const yt=(tt-_)/st,Ct=new Vector3,wt=new Vector2;for(let It=0;It<=st;It++){for(let Pt=0;Pt<=ot;Pt++){const Rt=at+Pt/ot*lt;Ct.x=Et*Math.cos(Rt),Ct.y=Et*Math.sin(Rt),ht.push(Ct.x,Ct.y,Ct.z),ft.push(0,0,1),wt.x=(Ct.x/tt+1)/2,wt.y=(Ct.y/tt+1)/2,gt.push(wt.x,wt.y)}Et+=yt}for(let It=0;It<st;It++){const Pt=It*(ot+1);for(let Rt=0;Rt<ot;Rt++){const xt=Rt+Pt,Nt=xt,kt=xt+ot+1,Vt=xt+ot+2,Ft=xt+1;dt.push(Nt,kt,Ft),dt.push(kt,Vt,Ft)}}this.setIndex(dt),this.setAttribute("position",new Float32BufferAttribute(ht,3)),this.setAttribute("normal",new Float32BufferAttribute(ft,3)),this.setAttribute("uv",new Float32BufferAttribute(gt,2))}copy(_){return super.copy(_),this.parameters=Object.assign({},_.parameters),this}static fromJSON(_){return new RingGeometry(_.innerRadius,_.outerRadius,_.thetaSegments,_.phiSegments,_.thetaStart,_.thetaLength)}}class ShapeGeometry extends BufferGeometry{constructor(_=new Shape([new Vector2(0,.5),new Vector2(-.5,-.5),new Vector2(.5,-.5)]),tt=12){super(),this.type="ShapeGeometry",this.parameters={shapes:_,curveSegments:tt};const ot=[],st=[],at=[],lt=[];let dt=0,ht=0;if(Array.isArray(_)===!1)ft(_);else for(let gt=0;gt<_.length;gt++)ft(_[gt]),this.addGroup(dt,ht,gt),dt+=ht,ht=0;this.setIndex(ot),this.setAttribute("position",new Float32BufferAttribute(st,3)),this.setAttribute("normal",new Float32BufferAttribute(at,3)),this.setAttribute("uv",new Float32BufferAttribute(lt,2));function ft(gt){const Et=st.length/3,yt=gt.extractPoints(tt);let Ct=yt.shape;const wt=yt.holes;ShapeUtils.isClockWise(Ct)===!1&&(Ct=Ct.reverse());for(let Pt=0,Rt=wt.length;Pt<Rt;Pt++){const xt=wt[Pt];ShapeUtils.isClockWise(xt)===!0&&(wt[Pt]=xt.reverse())}const It=ShapeUtils.triangulateShape(Ct,wt);for(let Pt=0,Rt=wt.length;Pt<Rt;Pt++){const xt=wt[Pt];Ct=Ct.concat(xt)}for(let Pt=0,Rt=Ct.length;Pt<Rt;Pt++){const xt=Ct[Pt];st.push(xt.x,xt.y,0),at.push(0,0,1),lt.push(xt.x,xt.y)}for(let Pt=0,Rt=It.length;Pt<Rt;Pt++){const xt=It[Pt],Nt=xt[0]+Et,kt=xt[1]+Et,Vt=xt[2]+Et;ot.push(Nt,kt,Vt),ht+=3}}}copy(_){return super.copy(_),this.parameters=Object.assign({},_.parameters),this}toJSON(){const _=super.toJSON(),tt=this.parameters.shapes;return toJSON(tt,_)}static fromJSON(_,tt){const ot=[];for(let st=0,at=_.shapes.length;st<at;st++){const lt=tt[_.shapes[st]];ot.push(lt)}return new ShapeGeometry(ot,_.curveSegments)}}function toJSON(nt,_){if(_.shapes=[],Array.isArray(nt))for(let tt=0,ot=nt.length;tt<ot;tt++){const st=nt[tt];_.shapes.push(st.uuid)}else _.shapes.push(nt.uuid);return _}class SphereGeometry extends BufferGeometry{constructor(_=1,tt=32,ot=16,st=0,at=Math.PI*2,lt=0,dt=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:_,widthSegments:tt,heightSegments:ot,phiStart:st,phiLength:at,thetaStart:lt,thetaLength:dt},tt=Math.max(3,Math.floor(tt)),ot=Math.max(2,Math.floor(ot));const ht=Math.min(lt+dt,Math.PI);let ft=0;const gt=[],Et=new Vector3,yt=new Vector3,Ct=[],wt=[],It=[],Pt=[];for(let Rt=0;Rt<=ot;Rt++){const xt=[],Nt=Rt/ot;let kt=0;Rt===0&&lt===0?kt=.5/tt:Rt===ot&&ht===Math.PI&&(kt=-.5/tt);for(let Vt=0;Vt<=tt;Vt++){const Ft=Vt/tt;Et.x=-_*Math.cos(st+Ft*at)*Math.sin(lt+Nt*dt),Et.y=_*Math.cos(lt+Nt*dt),Et.z=_*Math.sin(st+Ft*at)*Math.sin(lt+Nt*dt),wt.push(Et.x,Et.y,Et.z),yt.copy(Et).normalize(),It.push(yt.x,yt.y,yt.z),Pt.push(Ft+kt,1-Nt),xt.push(ft++)}gt.push(xt)}for(let Rt=0;Rt<ot;Rt++)for(let xt=0;xt<tt;xt++){const Nt=gt[Rt][xt+1],kt=gt[Rt][xt],Vt=gt[Rt+1][xt],Ft=gt[Rt+1][xt+1];(Rt!==0||lt>0)&&Ct.push(Nt,kt,Ft),(Rt!==ot-1||ht<Math.PI)&&Ct.push(kt,Vt,Ft)}this.setIndex(Ct),this.setAttribute("position",new Float32BufferAttribute(wt,3)),this.setAttribute("normal",new Float32BufferAttribute(It,3)),this.setAttribute("uv",new Float32BufferAttribute(Pt,2))}copy(_){return super.copy(_),this.parameters=Object.assign({},_.parameters),this}static fromJSON(_){return new SphereGeometry(_.radius,_.widthSegments,_.heightSegments,_.phiStart,_.phiLength,_.thetaStart,_.thetaLength)}}class TetrahedronGeometry extends PolyhedronGeometry{constructor(_=1,tt=0){const ot=[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],st=[2,1,0,0,3,2,1,3,0,2,3,1];super(ot,st,_,tt),this.type="TetrahedronGeometry",this.parameters={radius:_,detail:tt}}static fromJSON(_){return new TetrahedronGeometry(_.radius,_.detail)}}class TorusGeometry extends BufferGeometry{constructor(_=1,tt=.4,ot=12,st=48,at=Math.PI*2){super(),this.type="TorusGeometry",this.parameters={radius:_,tube:tt,radialSegments:ot,tubularSegments:st,arc:at},ot=Math.floor(ot),st=Math.floor(st);const lt=[],dt=[],ht=[],ft=[],gt=new Vector3,Et=new Vector3,yt=new Vector3;for(let Ct=0;Ct<=ot;Ct++)for(let wt=0;wt<=st;wt++){const It=wt/st*at,Pt=Ct/ot*Math.PI*2;Et.x=(_+tt*Math.cos(Pt))*Math.cos(It),Et.y=(_+tt*Math.cos(Pt))*Math.sin(It),Et.z=tt*Math.sin(Pt),dt.push(Et.x,Et.y,Et.z),gt.x=_*Math.cos(It),gt.y=_*Math.sin(It),yt.subVectors(Et,gt).normalize(),ht.push(yt.x,yt.y,yt.z),ft.push(wt/st),ft.push(Ct/ot)}for(let Ct=1;Ct<=ot;Ct++)for(let wt=1;wt<=st;wt++){const It=(st+1)*Ct+wt-1,Pt=(st+1)*(Ct-1)+wt-1,Rt=(st+1)*(Ct-1)+wt,xt=(st+1)*Ct+wt;lt.push(It,Pt,xt),lt.push(Pt,Rt,xt)}this.setIndex(lt),this.setAttribute("position",new Float32BufferAttribute(dt,3)),this.setAttribute("normal",new Float32BufferAttribute(ht,3)),this.setAttribute("uv",new Float32BufferAttribute(ft,2))}copy(_){return super.copy(_),this.parameters=Object.assign({},_.parameters),this}static fromJSON(_){return new TorusGeometry(_.radius,_.tube,_.radialSegments,_.tubularSegments,_.arc)}}class TorusKnotGeometry extends BufferGeometry{constructor(_=1,tt=.4,ot=64,st=8,at=2,lt=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:_,tube:tt,tubularSegments:ot,radialSegments:st,p:at,q:lt},ot=Math.floor(ot),st=Math.floor(st);const dt=[],ht=[],ft=[],gt=[],Et=new Vector3,yt=new Vector3,Ct=new Vector3,wt=new Vector3,It=new Vector3,Pt=new Vector3,Rt=new Vector3;for(let Nt=0;Nt<=ot;++Nt){const kt=Nt/ot*at*Math.PI*2;xt(kt,at,lt,_,Ct),xt(kt+.01,at,lt,_,wt),Pt.subVectors(wt,Ct),Rt.addVectors(wt,Ct),It.crossVectors(Pt,Rt),Rt.crossVectors(It,Pt),It.normalize(),Rt.normalize();for(let Vt=0;Vt<=st;++Vt){const Ft=Vt/st*Math.PI*2,zt=-tt*Math.cos(Ft),Yt=tt*Math.sin(Ft);Et.x=Ct.x+(zt*Rt.x+Yt*It.x),Et.y=Ct.y+(zt*Rt.y+Yt*It.y),Et.z=Ct.z+(zt*Rt.z+Yt*It.z),ht.push(Et.x,Et.y,Et.z),yt.subVectors(Et,Ct).normalize(),ft.push(yt.x,yt.y,yt.z),gt.push(Nt/ot),gt.push(Vt/st)}}for(let Nt=1;Nt<=ot;Nt++)for(let kt=1;kt<=st;kt++){const Vt=(st+1)*(Nt-1)+(kt-1),Ft=(st+1)*Nt+(kt-1),zt=(st+1)*Nt+kt,Yt=(st+1)*(Nt-1)+kt;dt.push(Vt,Ft,Yt),dt.push(Ft,zt,Yt)}this.setIndex(dt),this.setAttribute("position",new Float32BufferAttribute(ht,3)),this.setAttribute("normal",new Float32BufferAttribute(ft,3)),this.setAttribute("uv",new Float32BufferAttribute(gt,2));function xt(Nt,kt,Vt,Ft,zt){const Yt=Math.cos(Nt),Kt=Math.sin(Nt),qt=Vt/kt*Nt,pn=Math.cos(qt);zt.x=Ft*(2+pn)*.5*Yt,zt.y=Ft*(2+pn)*Kt*.5,zt.z=Ft*Math.sin(qt)*.5}}copy(_){return super.copy(_),this.parameters=Object.assign({},_.parameters),this}static fromJSON(_){return new TorusKnotGeometry(_.radius,_.tube,_.tubularSegments,_.radialSegments,_.p,_.q)}}class TubeGeometry extends BufferGeometry{constructor(_=new QuadraticBezierCurve3(new Vector3(-1,-1,0),new Vector3(-1,1,0),new Vector3(1,1,0)),tt=64,ot=1,st=8,at=!1){super(),this.type="TubeGeometry",this.parameters={path:_,tubularSegments:tt,radius:ot,radialSegments:st,closed:at};const lt=_.computeFrenetFrames(tt,at);this.tangents=lt.tangents,this.normals=lt.normals,this.binormals=lt.binormals;const dt=new Vector3,ht=new Vector3,ft=new Vector2;let gt=new Vector3;const Et=[],yt=[],Ct=[],wt=[];It(),this.setIndex(wt),this.setAttribute("position",new Float32BufferAttribute(Et,3)),this.setAttribute("normal",new Float32BufferAttribute(yt,3)),this.setAttribute("uv",new Float32BufferAttribute(Ct,2));function It(){for(let Nt=0;Nt<tt;Nt++)Pt(Nt);Pt(at===!1?tt:0),xt(),Rt()}function Pt(Nt){gt=_.getPointAt(Nt/tt,gt);const kt=lt.normals[Nt],Vt=lt.binormals[Nt];for(let Ft=0;Ft<=st;Ft++){const zt=Ft/st*Math.PI*2,Yt=Math.sin(zt),Kt=-Math.cos(zt);ht.x=Kt*kt.x+Yt*Vt.x,ht.y=Kt*kt.y+Yt*Vt.y,ht.z=Kt*kt.z+Yt*Vt.z,ht.normalize(),yt.push(ht.x,ht.y,ht.z),dt.x=gt.x+ot*ht.x,dt.y=gt.y+ot*ht.y,dt.z=gt.z+ot*ht.z,Et.push(dt.x,dt.y,dt.z)}}function Rt(){for(let Nt=1;Nt<=tt;Nt++)for(let kt=1;kt<=st;kt++){const Vt=(st+1)*(Nt-1)+(kt-1),Ft=(st+1)*Nt+(kt-1),zt=(st+1)*Nt+kt,Yt=(st+1)*(Nt-1)+kt;wt.push(Vt,Ft,Yt),wt.push(Ft,zt,Yt)}}function xt(){for(let Nt=0;Nt<=tt;Nt++)for(let kt=0;kt<=st;kt++)ft.x=Nt/tt,ft.y=kt/st,Ct.push(ft.x,ft.y)}}copy(_){return super.copy(_),this.parameters=Object.assign({},_.parameters),this}toJSON(){const _=super.toJSON();return _.path=this.parameters.path.toJSON(),_}static fromJSON(_){return new TubeGeometry(new Curves[_.path.type]().fromJSON(_.path),_.tubularSegments,_.radius,_.radialSegments,_.closed)}}class WireframeGeometry extends BufferGeometry{constructor(_=null){if(super(),this.type="WireframeGeometry",this.parameters={geometry:_},_!==null){const tt=[],ot=new Set,st=new Vector3,at=new Vector3;if(_.index!==null){const lt=_.attributes.position,dt=_.index;let ht=_.groups;ht.length===0&&(ht=[{start:0,count:dt.count,materialIndex:0}]);for(let ft=0,gt=ht.length;ft<gt;++ft){const Et=ht[ft],yt=Et.start,Ct=Et.count;for(let wt=yt,It=yt+Ct;wt<It;wt+=3)for(let Pt=0;Pt<3;Pt++){const Rt=dt.getX(wt+Pt),xt=dt.getX(wt+(Pt+1)%3);st.fromBufferAttribute(lt,Rt),at.fromBufferAttribute(lt,xt),isUniqueEdge(st,at,ot)===!0&&(tt.push(st.x,st.y,st.z),tt.push(at.x,at.y,at.z))}}}else{const lt=_.attributes.position;for(let dt=0,ht=lt.count/3;dt<ht;dt++)for(let ft=0;ft<3;ft++){const gt=3*dt+ft,Et=3*dt+(ft+1)%3;st.fromBufferAttribute(lt,gt),at.fromBufferAttribute(lt,Et),isUniqueEdge(st,at,ot)===!0&&(tt.push(st.x,st.y,st.z),tt.push(at.x,at.y,at.z))}}this.setAttribute("position",new Float32BufferAttribute(tt,3))}}copy(_){return super.copy(_),this.parameters=Object.assign({},_.parameters),this}}function isUniqueEdge(nt,_,tt){const ot=`${nt.x},${nt.y},${nt.z}-${_.x},${_.y},${_.z}`,st=`${_.x},${_.y},${_.z}-${nt.x},${nt.y},${nt.z}`;return tt.has(ot)===!0||tt.has(st)===!0?!1:(tt.add(ot),tt.add(st),!0)}var Geometries=Object.freeze({__proto__:null,BoxGeometry,CapsuleGeometry,CircleGeometry,ConeGeometry,CylinderGeometry,DodecahedronGeometry,EdgesGeometry,ExtrudeGeometry,IcosahedronGeometry,LatheGeometry,OctahedronGeometry,PlaneGeometry,PolyhedronGeometry,RingGeometry,ShapeGeometry,SphereGeometry,TetrahedronGeometry,TorusGeometry,TorusKnotGeometry,TubeGeometry,WireframeGeometry});class ShadowMaterial extends Material{constructor(_){super(),this.isShadowMaterial=!0,this.type="ShadowMaterial",this.color=new Color$1(0),this.transparent=!0,this.fog=!0,this.setValues(_)}copy(_){return super.copy(_),this.color.copy(_.color),this.fog=_.fog,this}}class RawShaderMaterial extends ShaderMaterial{constructor(_){super(_),this.isRawShaderMaterial=!0,this.type="RawShaderMaterial"}}class MeshStandardMaterial extends Material{constructor(_){super(),this.isMeshStandardMaterial=!0,this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new Color$1(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Color$1(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=TangentSpaceNormalMap,this.normalScale=new Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(_)}copy(_){return super.copy(_),this.defines={STANDARD:""},this.color.copy(_.color),this.roughness=_.roughness,this.metalness=_.metalness,this.map=_.map,this.lightMap=_.lightMap,this.lightMapIntensity=_.lightMapIntensity,this.aoMap=_.aoMap,this.aoMapIntensity=_.aoMapIntensity,this.emissive.copy(_.emissive),this.emissiveMap=_.emissiveMap,this.emissiveIntensity=_.emissiveIntensity,this.bumpMap=_.bumpMap,this.bumpScale=_.bumpScale,this.normalMap=_.normalMap,this.normalMapType=_.normalMapType,this.normalScale.copy(_.normalScale),this.displacementMap=_.displacementMap,this.displacementScale=_.displacementScale,this.displacementBias=_.displacementBias,this.roughnessMap=_.roughnessMap,this.metalnessMap=_.metalnessMap,this.alphaMap=_.alphaMap,this.envMap=_.envMap,this.envMapIntensity=_.envMapIntensity,this.wireframe=_.wireframe,this.wireframeLinewidth=_.wireframeLinewidth,this.wireframeLinecap=_.wireframeLinecap,this.wireframeLinejoin=_.wireframeLinejoin,this.flatShading=_.flatShading,this.fog=_.fog,this}}class MeshPhysicalMaterial extends MeshStandardMaterial{constructor(_){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.anisotropyRotation=0,this.anisotropyMap=null,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new Vector2(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return clamp$3(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(tt){this.ior=(1+.4*tt)/(1-.4*tt)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new Color$1(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new Color$1(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new Color$1(1,1,1),this.specularColorMap=null,this._anisotropy=0,this._clearcoat=0,this._iridescence=0,this._sheen=0,this._transmission=0,this.setValues(_)}get anisotropy(){return this._anisotropy}set anisotropy(_){this._anisotropy>0!=_>0&&this.version++,this._anisotropy=_}get clearcoat(){return this._clearcoat}set clearcoat(_){this._clearcoat>0!=_>0&&this.version++,this._clearcoat=_}get iridescence(){return this._iridescence}set iridescence(_){this._iridescence>0!=_>0&&this.version++,this._iridescence=_}get sheen(){return this._sheen}set sheen(_){this._sheen>0!=_>0&&this.version++,this._sheen=_}get transmission(){return this._transmission}set transmission(_){this._transmission>0!=_>0&&this.version++,this._transmission=_}copy(_){return super.copy(_),this.defines={STANDARD:"",PHYSICAL:""},this.anisotropy=_.anisotropy,this.anisotropyRotation=_.anisotropyRotation,this.anisotropyMap=_.anisotropyMap,this.clearcoat=_.clearcoat,this.clearcoatMap=_.clearcoatMap,this.clearcoatRoughness=_.clearcoatRoughness,this.clearcoatRoughnessMap=_.clearcoatRoughnessMap,this.clearcoatNormalMap=_.clearcoatNormalMap,this.clearcoatNormalScale.copy(_.clearcoatNormalScale),this.ior=_.ior,this.iridescence=_.iridescence,this.iridescenceMap=_.iridescenceMap,this.iridescenceIOR=_.iridescenceIOR,this.iridescenceThicknessRange=[..._.iridescenceThicknessRange],this.iridescenceThicknessMap=_.iridescenceThicknessMap,this.sheen=_.sheen,this.sheenColor.copy(_.sheenColor),this.sheenColorMap=_.sheenColorMap,this.sheenRoughness=_.sheenRoughness,this.sheenRoughnessMap=_.sheenRoughnessMap,this.transmission=_.transmission,this.transmissionMap=_.transmissionMap,this.thickness=_.thickness,this.thicknessMap=_.thicknessMap,this.attenuationDistance=_.attenuationDistance,this.attenuationColor.copy(_.attenuationColor),this.specularIntensity=_.specularIntensity,this.specularIntensityMap=_.specularIntensityMap,this.specularColor.copy(_.specularColor),this.specularColorMap=_.specularColorMap,this}}class MeshPhongMaterial extends Material{constructor(_){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new Color$1(16777215),this.specular=new Color$1(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Color$1(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=TangentSpaceNormalMap,this.normalScale=new Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(_)}copy(_){return super.copy(_),this.color.copy(_.color),this.specular.copy(_.specular),this.shininess=_.shininess,this.map=_.map,this.lightMap=_.lightMap,this.lightMapIntensity=_.lightMapIntensity,this.aoMap=_.aoMap,this.aoMapIntensity=_.aoMapIntensity,this.emissive.copy(_.emissive),this.emissiveMap=_.emissiveMap,this.emissiveIntensity=_.emissiveIntensity,this.bumpMap=_.bumpMap,this.bumpScale=_.bumpScale,this.normalMap=_.normalMap,this.normalMapType=_.normalMapType,this.normalScale.copy(_.normalScale),this.displacementMap=_.displacementMap,this.displacementScale=_.displacementScale,this.displacementBias=_.displacementBias,this.specularMap=_.specularMap,this.alphaMap=_.alphaMap,this.envMap=_.envMap,this.combine=_.combine,this.reflectivity=_.reflectivity,this.refractionRatio=_.refractionRatio,this.wireframe=_.wireframe,this.wireframeLinewidth=_.wireframeLinewidth,this.wireframeLinecap=_.wireframeLinecap,this.wireframeLinejoin=_.wireframeLinejoin,this.flatShading=_.flatShading,this.fog=_.fog,this}}class MeshToonMaterial extends Material{constructor(_){super(),this.isMeshToonMaterial=!0,this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new Color$1(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Color$1(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=TangentSpaceNormalMap,this.normalScale=new Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(_)}copy(_){return super.copy(_),this.color.copy(_.color),this.map=_.map,this.gradientMap=_.gradientMap,this.lightMap=_.lightMap,this.lightMapIntensity=_.lightMapIntensity,this.aoMap=_.aoMap,this.aoMapIntensity=_.aoMapIntensity,this.emissive.copy(_.emissive),this.emissiveMap=_.emissiveMap,this.emissiveIntensity=_.emissiveIntensity,this.bumpMap=_.bumpMap,this.bumpScale=_.bumpScale,this.normalMap=_.normalMap,this.normalMapType=_.normalMapType,this.normalScale.copy(_.normalScale),this.displacementMap=_.displacementMap,this.displacementScale=_.displacementScale,this.displacementBias=_.displacementBias,this.alphaMap=_.alphaMap,this.wireframe=_.wireframe,this.wireframeLinewidth=_.wireframeLinewidth,this.wireframeLinecap=_.wireframeLinecap,this.wireframeLinejoin=_.wireframeLinejoin,this.fog=_.fog,this}}class MeshNormalMaterial extends Material{constructor(_){super(),this.isMeshNormalMaterial=!0,this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=TangentSpaceNormalMap,this.normalScale=new Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(_)}copy(_){return super.copy(_),this.bumpMap=_.bumpMap,this.bumpScale=_.bumpScale,this.normalMap=_.normalMap,this.normalMapType=_.normalMapType,this.normalScale.copy(_.normalScale),this.displacementMap=_.displacementMap,this.displacementScale=_.displacementScale,this.displacementBias=_.displacementBias,this.wireframe=_.wireframe,this.wireframeLinewidth=_.wireframeLinewidth,this.flatShading=_.flatShading,this}}class MeshLambertMaterial extends Material{constructor(_){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new Color$1(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Color$1(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=TangentSpaceNormalMap,this.normalScale=new Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(_)}copy(_){return super.copy(_),this.color.copy(_.color),this.map=_.map,this.lightMap=_.lightMap,this.lightMapIntensity=_.lightMapIntensity,this.aoMap=_.aoMap,this.aoMapIntensity=_.aoMapIntensity,this.emissive.copy(_.emissive),this.emissiveMap=_.emissiveMap,this.emissiveIntensity=_.emissiveIntensity,this.bumpMap=_.bumpMap,this.bumpScale=_.bumpScale,this.normalMap=_.normalMap,this.normalMapType=_.normalMapType,this.normalScale.copy(_.normalScale),this.displacementMap=_.displacementMap,this.displacementScale=_.displacementScale,this.displacementBias=_.displacementBias,this.specularMap=_.specularMap,this.alphaMap=_.alphaMap,this.envMap=_.envMap,this.combine=_.combine,this.reflectivity=_.reflectivity,this.refractionRatio=_.refractionRatio,this.wireframe=_.wireframe,this.wireframeLinewidth=_.wireframeLinewidth,this.wireframeLinecap=_.wireframeLinecap,this.wireframeLinejoin=_.wireframeLinejoin,this.flatShading=_.flatShading,this.fog=_.fog,this}}class MeshMatcapMaterial extends Material{constructor(_){super(),this.isMeshMatcapMaterial=!0,this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new Color$1(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=TangentSpaceNormalMap,this.normalScale=new Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.fog=!0,this.setValues(_)}copy(_){return super.copy(_),this.defines={MATCAP:""},this.color.copy(_.color),this.matcap=_.matcap,this.map=_.map,this.bumpMap=_.bumpMap,this.bumpScale=_.bumpScale,this.normalMap=_.normalMap,this.normalMapType=_.normalMapType,this.normalScale.copy(_.normalScale),this.displacementMap=_.displacementMap,this.displacementScale=_.displacementScale,this.displacementBias=_.displacementBias,this.alphaMap=_.alphaMap,this.flatShading=_.flatShading,this.fog=_.fog,this}}class LineDashedMaterial extends LineBasicMaterial{constructor(_){super(),this.isLineDashedMaterial=!0,this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(_)}copy(_){return super.copy(_),this.scale=_.scale,this.dashSize=_.dashSize,this.gapSize=_.gapSize,this}}function arraySlice(nt,_,tt){return isTypedArray(nt)?new nt.constructor(nt.subarray(_,tt!==void 0?tt:nt.length)):nt.slice(_,tt)}function convertArray(nt,_,tt){return!nt||!tt&&nt.constructor===_?nt:typeof _.BYTES_PER_ELEMENT=="number"?new _(nt):Array.prototype.slice.call(nt)}function isTypedArray(nt){return ArrayBuffer.isView(nt)&&!(nt instanceof DataView)}function getKeyframeOrder(nt){function _(st,at){return nt[st]-nt[at]}const tt=nt.length,ot=new Array(tt);for(let st=0;st!==tt;++st)ot[st]=st;return ot.sort(_),ot}function sortedArray(nt,_,tt){const ot=nt.length,st=new nt.constructor(ot);for(let at=0,lt=0;lt!==ot;++at){const dt=tt[at]*_;for(let ht=0;ht!==_;++ht)st[lt++]=nt[dt+ht]}return st}function flattenJSON(nt,_,tt,ot){let st=1,at=nt[0];for(;at!==void 0&&at[ot]===void 0;)at=nt[st++];if(at===void 0)return;let lt=at[ot];if(lt!==void 0)if(Array.isArray(lt))do lt=at[ot],lt!==void 0&&(_.push(at.time),tt.push.apply(tt,lt)),at=nt[st++];while(at!==void 0);else if(lt.toArray!==void 0)do lt=at[ot],lt!==void 0&&(_.push(at.time),lt.toArray(tt,tt.length)),at=nt[st++];while(at!==void 0);else do lt=at[ot],lt!==void 0&&(_.push(at.time),tt.push(lt)),at=nt[st++];while(at!==void 0)}function subclip(nt,_,tt,ot,st=30){const at=nt.clone();at.name=_;const lt=[];for(let ht=0;ht<at.tracks.length;++ht){const ft=at.tracks[ht],gt=ft.getValueSize(),Et=[],yt=[];for(let Ct=0;Ct<ft.times.length;++Ct){const wt=ft.times[Ct]*st;if(!(wt<tt||wt>=ot)){Et.push(ft.times[Ct]);for(let It=0;It<gt;++It)yt.push(ft.values[Ct*gt+It])}}Et.length!==0&&(ft.times=convertArray(Et,ft.times.constructor),ft.values=convertArray(yt,ft.values.constructor),lt.push(ft))}at.tracks=lt;let dt=1/0;for(let ht=0;ht<at.tracks.length;++ht)dt>at.tracks[ht].times[0]&&(dt=at.tracks[ht].times[0]);for(let ht=0;ht<at.tracks.length;++ht)at.tracks[ht].shift(-1*dt);return at.resetDuration(),at}function makeClipAdditive(nt,_=0,tt=nt,ot=30){ot<=0&&(ot=30);const st=tt.tracks.length,at=_/ot;for(let lt=0;lt<st;++lt){const dt=tt.tracks[lt],ht=dt.ValueTypeName;if(ht==="bool"||ht==="string")continue;const ft=nt.tracks.find(function(Rt){return Rt.name===dt.name&&Rt.ValueTypeName===ht});if(ft===void 0)continue;let gt=0;const Et=dt.getValueSize();dt.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(gt=Et/3);let yt=0;const Ct=ft.getValueSize();ft.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(yt=Ct/3);const wt=dt.times.length-1;let It;if(at<=dt.times[0]){const Rt=gt,xt=Et-gt;It=arraySlice(dt.values,Rt,xt)}else if(at>=dt.times[wt]){const Rt=wt*Et+gt,xt=Rt+Et-gt;It=arraySlice(dt.values,Rt,xt)}else{const Rt=dt.createInterpolant(),xt=gt,Nt=Et-gt;Rt.evaluate(at),It=arraySlice(Rt.resultBuffer,xt,Nt)}ht==="quaternion"&&new Quaternion().fromArray(It).normalize().conjugate().toArray(It);const Pt=ft.times.length;for(let Rt=0;Rt<Pt;++Rt){const xt=Rt*Ct+yt;if(ht==="quaternion")Quaternion.multiplyQuaternionsFlat(ft.values,xt,It,0,ft.values,xt);else{const Nt=Ct-yt*2;for(let kt=0;kt<Nt;++kt)ft.values[xt+kt]-=It[kt]}}}return nt.blendMode=AdditiveAnimationBlendMode,nt}const AnimationUtils={arraySlice,convertArray,isTypedArray,getKeyframeOrder,sortedArray,flattenJSON,subclip,makeClipAdditive};class Interpolant{constructor(_,tt,ot,st){this.parameterPositions=_,this._cachedIndex=0,this.resultBuffer=st!==void 0?st:new tt.constructor(ot),this.sampleValues=tt,this.valueSize=ot,this.settings=null,this.DefaultSettings_={}}evaluate(_){const tt=this.parameterPositions;let ot=this._cachedIndex,st=tt[ot],at=tt[ot-1];e:{t:{let lt;n:{r:if(!(_<st)){for(let dt=ot+2;;){if(st===void 0){if(_<at)break r;return ot=tt.length,this._cachedIndex=ot,this.copySampleValue_(ot-1)}if(ot===dt)break;if(at=st,st=tt[++ot],_<st)break t}lt=tt.length;break n}if(!(_>=at)){const dt=tt[1];_<dt&&(ot=2,at=dt);for(let ht=ot-2;;){if(at===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(ot===ht)break;if(st=at,at=tt[--ot-1],_>=at)break t}lt=ot,ot=0;break n}break e}for(;ot<lt;){const dt=ot+lt>>>1;_<tt[dt]?lt=dt:ot=dt+1}if(st=tt[ot],at=tt[ot-1],at===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(st===void 0)return ot=tt.length,this._cachedIndex=ot,this.copySampleValue_(ot-1)}this._cachedIndex=ot,this.intervalChanged_(ot,at,st)}return this.interpolate_(ot,at,_,st)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(_){const tt=this.resultBuffer,ot=this.sampleValues,st=this.valueSize,at=_*st;for(let lt=0;lt!==st;++lt)tt[lt]=ot[at+lt];return tt}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class CubicInterpolant extends Interpolant{constructor(_,tt,ot,st){super(_,tt,ot,st),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:ZeroCurvatureEnding,endingEnd:ZeroCurvatureEnding}}intervalChanged_(_,tt,ot){const st=this.parameterPositions;let at=_-2,lt=_+1,dt=st[at],ht=st[lt];if(dt===void 0)switch(this.getSettings_().endingStart){case ZeroSlopeEnding:at=_,dt=2*tt-ot;break;case WrapAroundEnding:at=st.length-2,dt=tt+st[at]-st[at+1];break;default:at=_,dt=ot}if(ht===void 0)switch(this.getSettings_().endingEnd){case ZeroSlopeEnding:lt=_,ht=2*ot-tt;break;case WrapAroundEnding:lt=1,ht=ot+st[1]-st[0];break;default:lt=_-1,ht=tt}const ft=(ot-tt)*.5,gt=this.valueSize;this._weightPrev=ft/(tt-dt),this._weightNext=ft/(ht-ot),this._offsetPrev=at*gt,this._offsetNext=lt*gt}interpolate_(_,tt,ot,st){const at=this.resultBuffer,lt=this.sampleValues,dt=this.valueSize,ht=_*dt,ft=ht-dt,gt=this._offsetPrev,Et=this._offsetNext,yt=this._weightPrev,Ct=this._weightNext,wt=(ot-tt)/(st-tt),It=wt*wt,Pt=It*wt,Rt=-yt*Pt+2*yt*It-yt*wt,xt=(1+yt)*Pt+(-1.5-2*yt)*It+(-.5+yt)*wt+1,Nt=(-1-Ct)*Pt+(1.5+Ct)*It+.5*wt,kt=Ct*Pt-Ct*It;for(let Vt=0;Vt!==dt;++Vt)at[Vt]=Rt*lt[gt+Vt]+xt*lt[ft+Vt]+Nt*lt[ht+Vt]+kt*lt[Et+Vt];return at}}class LinearInterpolant extends Interpolant{constructor(_,tt,ot,st){super(_,tt,ot,st)}interpolate_(_,tt,ot,st){const at=this.resultBuffer,lt=this.sampleValues,dt=this.valueSize,ht=_*dt,ft=ht-dt,gt=(ot-tt)/(st-tt),Et=1-gt;for(let yt=0;yt!==dt;++yt)at[yt]=lt[ft+yt]*Et+lt[ht+yt]*gt;return at}}class DiscreteInterpolant extends Interpolant{constructor(_,tt,ot,st){super(_,tt,ot,st)}interpolate_(_){return this.copySampleValue_(_-1)}}class KeyframeTrack{constructor(_,tt,ot,st){if(_===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(tt===void 0||tt.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+_);this.name=_,this.times=convertArray(tt,this.TimeBufferType),this.values=convertArray(ot,this.ValueBufferType),this.setInterpolation(st||this.DefaultInterpolation)}static toJSON(_){const tt=_.constructor;let ot;if(tt.toJSON!==this.toJSON)ot=tt.toJSON(_);else{ot={name:_.name,times:convertArray(_.times,Array),values:convertArray(_.values,Array)};const st=_.getInterpolation();st!==_.DefaultInterpolation&&(ot.interpolation=st)}return ot.type=_.ValueTypeName,ot}InterpolantFactoryMethodDiscrete(_){return new DiscreteInterpolant(this.times,this.values,this.getValueSize(),_)}InterpolantFactoryMethodLinear(_){return new LinearInterpolant(this.times,this.values,this.getValueSize(),_)}InterpolantFactoryMethodSmooth(_){return new CubicInterpolant(this.times,this.values,this.getValueSize(),_)}setInterpolation(_){let tt;switch(_){case InterpolateDiscrete:tt=this.InterpolantFactoryMethodDiscrete;break;case InterpolateLinear:tt=this.InterpolantFactoryMethodLinear;break;case InterpolateSmooth:tt=this.InterpolantFactoryMethodSmooth;break}if(tt===void 0){const ot="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0)if(_!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw new Error(ot);return console.warn("THREE.KeyframeTrack:",ot),this}return this.createInterpolant=tt,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return InterpolateDiscrete;case this.InterpolantFactoryMethodLinear:return InterpolateLinear;case this.InterpolantFactoryMethodSmooth:return InterpolateSmooth}}getValueSize(){return this.values.length/this.times.length}shift(_){if(_!==0){const tt=this.times;for(let ot=0,st=tt.length;ot!==st;++ot)tt[ot]+=_}return this}scale(_){if(_!==1){const tt=this.times;for(let ot=0,st=tt.length;ot!==st;++ot)tt[ot]*=_}return this}trim(_,tt){const ot=this.times,st=ot.length;let at=0,lt=st-1;for(;at!==st&&ot[at]<_;)++at;for(;lt!==-1&&ot[lt]>tt;)--lt;if(++lt,at!==0||lt!==st){at>=lt&&(lt=Math.max(lt,1),at=lt-1);const dt=this.getValueSize();this.times=arraySlice(ot,at,lt),this.values=arraySlice(this.values,at*dt,lt*dt)}return this}validate(){let _=!0;const tt=this.getValueSize();tt-Math.floor(tt)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),_=!1);const ot=this.times,st=this.values,at=ot.length;at===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),_=!1);let lt=null;for(let dt=0;dt!==at;dt++){const ht=ot[dt];if(typeof ht=="number"&&isNaN(ht)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,dt,ht),_=!1;break}if(lt!==null&&lt>ht){console.error("THREE.KeyframeTrack: Out of order keys.",this,dt,ht,lt),_=!1;break}lt=ht}if(st!==void 0&&isTypedArray(st))for(let dt=0,ht=st.length;dt!==ht;++dt){const ft=st[dt];if(isNaN(ft)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,dt,ft),_=!1;break}}return _}optimize(){const _=arraySlice(this.times),tt=arraySlice(this.values),ot=this.getValueSize(),st=this.getInterpolation()===InterpolateSmooth,at=_.length-1;let lt=1;for(let dt=1;dt<at;++dt){let ht=!1;const ft=_[dt],gt=_[dt+1];if(ft!==gt&&(dt!==1||ft!==_[0]))if(st)ht=!0;else{const Et=dt*ot,yt=Et-ot,Ct=Et+ot;for(let wt=0;wt!==ot;++wt){const It=tt[Et+wt];if(It!==tt[yt+wt]||It!==tt[Ct+wt]){ht=!0;break}}}if(ht){if(dt!==lt){_[lt]=_[dt];const Et=dt*ot,yt=lt*ot;for(let Ct=0;Ct!==ot;++Ct)tt[yt+Ct]=tt[Et+Ct]}++lt}}if(at>0){_[lt]=_[at];for(let dt=at*ot,ht=lt*ot,ft=0;ft!==ot;++ft)tt[ht+ft]=tt[dt+ft];++lt}return lt!==_.length?(this.times=arraySlice(_,0,lt),this.values=arraySlice(tt,0,lt*ot)):(this.times=_,this.values=tt),this}clone(){const _=arraySlice(this.times,0),tt=arraySlice(this.values,0),ot=this.constructor,st=new ot(this.name,_,tt);return st.createInterpolant=this.createInterpolant,st}}KeyframeTrack.prototype.TimeBufferType=Float32Array;KeyframeTrack.prototype.ValueBufferType=Float32Array;KeyframeTrack.prototype.DefaultInterpolation=InterpolateLinear;class BooleanKeyframeTrack extends KeyframeTrack{}BooleanKeyframeTrack.prototype.ValueTypeName="bool";BooleanKeyframeTrack.prototype.ValueBufferType=Array;BooleanKeyframeTrack.prototype.DefaultInterpolation=InterpolateDiscrete;BooleanKeyframeTrack.prototype.InterpolantFactoryMethodLinear=void 0;BooleanKeyframeTrack.prototype.InterpolantFactoryMethodSmooth=void 0;class ColorKeyframeTrack extends KeyframeTrack{}ColorKeyframeTrack.prototype.ValueTypeName="color";class NumberKeyframeTrack extends KeyframeTrack{}NumberKeyframeTrack.prototype.ValueTypeName="number";class QuaternionLinearInterpolant extends Interpolant{constructor(_,tt,ot,st){super(_,tt,ot,st)}interpolate_(_,tt,ot,st){const at=this.resultBuffer,lt=this.sampleValues,dt=this.valueSize,ht=(ot-tt)/(st-tt);let ft=_*dt;for(let gt=ft+dt;ft!==gt;ft+=4)Quaternion.slerpFlat(at,0,lt,ft-dt,lt,ft,ht);return at}}class QuaternionKeyframeTrack extends KeyframeTrack{InterpolantFactoryMethodLinear(_){return new QuaternionLinearInterpolant(this.times,this.values,this.getValueSize(),_)}}QuaternionKeyframeTrack.prototype.ValueTypeName="quaternion";QuaternionKeyframeTrack.prototype.DefaultInterpolation=InterpolateLinear;QuaternionKeyframeTrack.prototype.InterpolantFactoryMethodSmooth=void 0;class StringKeyframeTrack extends KeyframeTrack{}StringKeyframeTrack.prototype.ValueTypeName="string";StringKeyframeTrack.prototype.ValueBufferType=Array;StringKeyframeTrack.prototype.DefaultInterpolation=InterpolateDiscrete;StringKeyframeTrack.prototype.InterpolantFactoryMethodLinear=void 0;StringKeyframeTrack.prototype.InterpolantFactoryMethodSmooth=void 0;class VectorKeyframeTrack extends KeyframeTrack{}VectorKeyframeTrack.prototype.ValueTypeName="vector";class AnimationClip{constructor(_,tt=-1,ot,st=NormalAnimationBlendMode){this.name=_,this.tracks=ot,this.duration=tt,this.blendMode=st,this.uuid=generateUUID$1(),this.duration<0&&this.resetDuration()}static parse(_){const tt=[],ot=_.tracks,st=1/(_.fps||1);for(let lt=0,dt=ot.length;lt!==dt;++lt)tt.push(parseKeyframeTrack(ot[lt]).scale(st));const at=new this(_.name,_.duration,tt,_.blendMode);return at.uuid=_.uuid,at}static toJSON(_){const tt=[],ot=_.tracks,st={name:_.name,duration:_.duration,tracks:tt,uuid:_.uuid,blendMode:_.blendMode};for(let at=0,lt=ot.length;at!==lt;++at)tt.push(KeyframeTrack.toJSON(ot[at]));return st}static CreateFromMorphTargetSequence(_,tt,ot,st){const at=tt.length,lt=[];for(let dt=0;dt<at;dt++){let ht=[],ft=[];ht.push((dt+at-1)%at,dt,(dt+1)%at),ft.push(0,1,0);const gt=getKeyframeOrder(ht);ht=sortedArray(ht,1,gt),ft=sortedArray(ft,1,gt),!st&&ht[0]===0&&(ht.push(at),ft.push(ft[0])),lt.push(new NumberKeyframeTrack(".morphTargetInfluences["+tt[dt].name+"]",ht,ft).scale(1/ot))}return new this(_,-1,lt)}static findByName(_,tt){let ot=_;if(!Array.isArray(_)){const st=_;ot=st.geometry&&st.geometry.animations||st.animations}for(let st=0;st<ot.length;st++)if(ot[st].name===tt)return ot[st];return null}static CreateClipsFromMorphTargetSequences(_,tt,ot){const st={},at=/^([\w-]*?)([\d]+)$/;for(let dt=0,ht=_.length;dt<ht;dt++){const ft=_[dt],gt=ft.name.match(at);if(gt&&gt.length>1){const Et=gt[1];let yt=st[Et];yt||(st[Et]=yt=[]),yt.push(ft)}}const lt=[];for(const dt in st)lt.push(this.CreateFromMorphTargetSequence(dt,st[dt],tt,ot));return lt}static parseAnimation(_,tt){if(!_)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const ot=function(Et,yt,Ct,wt,It){if(Ct.length!==0){const Pt=[],Rt=[];flattenJSON(Ct,Pt,Rt,wt),Pt.length!==0&&It.push(new Et(yt,Pt,Rt))}},st=[],at=_.name||"default",lt=_.fps||30,dt=_.blendMode;let ht=_.length||-1;const ft=_.hierarchy||[];for(let Et=0;Et<ft.length;Et++){const yt=ft[Et].keys;if(!(!yt||yt.length===0))if(yt[0].morphTargets){const Ct={};let wt;for(wt=0;wt<yt.length;wt++)if(yt[wt].morphTargets)for(let It=0;It<yt[wt].morphTargets.length;It++)Ct[yt[wt].morphTargets[It]]=-1;for(const It in Ct){const Pt=[],Rt=[];for(let xt=0;xt!==yt[wt].morphTargets.length;++xt){const Nt=yt[wt];Pt.push(Nt.time),Rt.push(Nt.morphTarget===It?1:0)}st.push(new NumberKeyframeTrack(".morphTargetInfluence["+It+"]",Pt,Rt))}ht=Ct.length*lt}else{const Ct=".bones["+tt[Et].name+"]";ot(VectorKeyframeTrack,Ct+".position",yt,"pos",st),ot(QuaternionKeyframeTrack,Ct+".quaternion",yt,"rot",st),ot(VectorKeyframeTrack,Ct+".scale",yt,"scl",st)}}return st.length===0?null:new this(at,ht,st,dt)}resetDuration(){const _=this.tracks;let tt=0;for(let ot=0,st=_.length;ot!==st;++ot){const at=this.tracks[ot];tt=Math.max(tt,at.times[at.times.length-1])}return this.duration=tt,this}trim(){for(let _=0;_<this.tracks.length;_++)this.tracks[_].trim(0,this.duration);return this}validate(){let _=!0;for(let tt=0;tt<this.tracks.length;tt++)_=_&&this.tracks[tt].validate();return _}optimize(){for(let _=0;_<this.tracks.length;_++)this.tracks[_].optimize();return this}clone(){const _=[];for(let tt=0;tt<this.tracks.length;tt++)_.push(this.tracks[tt].clone());return new this.constructor(this.name,this.duration,_,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function getTrackTypeForValueTypeName(nt){switch(nt.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return NumberKeyframeTrack;case"vector":case"vector2":case"vector3":case"vector4":return VectorKeyframeTrack;case"color":return ColorKeyframeTrack;case"quaternion":return QuaternionKeyframeTrack;case"bool":case"boolean":return BooleanKeyframeTrack;case"string":return StringKeyframeTrack}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+nt)}function parseKeyframeTrack(nt){if(nt.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const _=getTrackTypeForValueTypeName(nt.type);if(nt.times===void 0){const tt=[],ot=[];flattenJSON(nt.keys,tt,ot,"value"),nt.times=tt,nt.values=ot}return _.parse!==void 0?_.parse(nt):new _(nt.name,nt.times,nt.values,nt.interpolation)}const Cache={enabled:!1,files:{},add:function(nt,_){this.enabled!==!1&&(this.files[nt]=_)},get:function(nt){if(this.enabled!==!1)return this.files[nt]},remove:function(nt){delete this.files[nt]},clear:function(){this.files={}}};class LoadingManager{constructor(_,tt,ot){const st=this;let at=!1,lt=0,dt=0,ht;const ft=[];this.onStart=void 0,this.onLoad=_,this.onProgress=tt,this.onError=ot,this.itemStart=function(gt){dt++,at===!1&&st.onStart!==void 0&&st.onStart(gt,lt,dt),at=!0},this.itemEnd=function(gt){lt++,st.onProgress!==void 0&&st.onProgress(gt,lt,dt),lt===dt&&(at=!1,st.onLoad!==void 0&&st.onLoad())},this.itemError=function(gt){st.onError!==void 0&&st.onError(gt)},this.resolveURL=function(gt){return ht?ht(gt):gt},this.setURLModifier=function(gt){return ht=gt,this},this.addHandler=function(gt,Et){return ft.push(gt,Et),this},this.removeHandler=function(gt){const Et=ft.indexOf(gt);return Et!==-1&&ft.splice(Et,2),this},this.getHandler=function(gt){for(let Et=0,yt=ft.length;Et<yt;Et+=2){const Ct=ft[Et],wt=ft[Et+1];if(Ct.global&&(Ct.lastIndex=0),Ct.test(gt))return wt}return null}}}const DefaultLoadingManager=new LoadingManager;let Loader$1=class{constructor(_){this.manager=_!==void 0?_:DefaultLoadingManager,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(_,tt){const ot=this;return new Promise(function(st,at){ot.load(_,st,tt,at)})}parse(){}setCrossOrigin(_){return this.crossOrigin=_,this}setWithCredentials(_){return this.withCredentials=_,this}setPath(_){return this.path=_,this}setResourcePath(_){return this.resourcePath=_,this}setRequestHeader(_){return this.requestHeader=_,this}};const loading={};class HttpError extends Error{constructor(_,tt){super(_),this.response=tt}}class FileLoader extends Loader$1{constructor(_){super(_)}load(_,tt,ot,st){_===void 0&&(_=""),this.path!==void 0&&(_=this.path+_),_=this.manager.resolveURL(_);const at=Cache.get(_);if(at!==void 0)return this.manager.itemStart(_),setTimeout(()=>{tt&&tt(at),this.manager.itemEnd(_)},0),at;if(loading[_]!==void 0){loading[_].push({onLoad:tt,onProgress:ot,onError:st});return}loading[_]=[],loading[_].push({onLoad:tt,onProgress:ot,onError:st});const lt=new Request(_,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),dt=this.mimeType,ht=this.responseType;fetch(lt).then(ft=>{if(ft.status===200||ft.status===0){if(ft.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),typeof ReadableStream>"u"||ft.body===void 0||ft.body.getReader===void 0)return ft;const gt=loading[_],Et=ft.body.getReader(),yt=ft.headers.get("Content-Length")||ft.headers.get("X-File-Size"),Ct=yt?parseInt(yt):0,wt=Ct!==0;let It=0;const Pt=new ReadableStream({start(Rt){xt();function xt(){Et.read().then(({done:Nt,value:kt})=>{if(Nt)Rt.close();else{It+=kt.byteLength;const Vt=new ProgressEvent("progress",{lengthComputable:wt,loaded:It,total:Ct});for(let Ft=0,zt=gt.length;Ft<zt;Ft++){const Yt=gt[Ft];Yt.onProgress&&Yt.onProgress(Vt)}Rt.enqueue(kt),xt()}})}}});return new Response(Pt)}else throw new HttpError(`fetch for "${ft.url}" responded with ${ft.status}: ${ft.statusText}`,ft)}).then(ft=>{switch(ht){case"arraybuffer":return ft.arrayBuffer();case"blob":return ft.blob();case"document":return ft.text().then(gt=>new DOMParser().parseFromString(gt,dt));case"json":return ft.json();default:if(dt===void 0)return ft.text();{const Et=/charset="?([^;"\s]*)"?/i.exec(dt),yt=Et&&Et[1]?Et[1].toLowerCase():void 0,Ct=new TextDecoder(yt);return ft.arrayBuffer().then(wt=>Ct.decode(wt))}}}).then(ft=>{Cache.add(_,ft);const gt=loading[_];delete loading[_];for(let Et=0,yt=gt.length;Et<yt;Et++){const Ct=gt[Et];Ct.onLoad&&Ct.onLoad(ft)}}).catch(ft=>{const gt=loading[_];if(gt===void 0)throw this.manager.itemError(_),ft;delete loading[_];for(let Et=0,yt=gt.length;Et<yt;Et++){const Ct=gt[Et];Ct.onError&&Ct.onError(ft)}this.manager.itemError(_)}).finally(()=>{this.manager.itemEnd(_)}),this.manager.itemStart(_)}setResponseType(_){return this.responseType=_,this}setMimeType(_){return this.mimeType=_,this}}class AnimationLoader extends Loader$1{constructor(_){super(_)}load(_,tt,ot,st){const at=this,lt=new FileLoader(this.manager);lt.setPath(this.path),lt.setRequestHeader(this.requestHeader),lt.setWithCredentials(this.withCredentials),lt.load(_,function(dt){try{tt(at.parse(JSON.parse(dt)))}catch(ht){st?st(ht):console.error(ht),at.manager.itemError(_)}},ot,st)}parse(_){const tt=[];for(let ot=0;ot<_.length;ot++){const st=AnimationClip.parse(_[ot]);tt.push(st)}return tt}}class CompressedTextureLoader extends Loader$1{constructor(_){super(_)}load(_,tt,ot,st){const at=this,lt=[],dt=new CompressedTexture,ht=new FileLoader(this.manager);ht.setPath(this.path),ht.setResponseType("arraybuffer"),ht.setRequestHeader(this.requestHeader),ht.setWithCredentials(at.withCredentials);let ft=0;function gt(Et){ht.load(_[Et],function(yt){const Ct=at.parse(yt,!0);lt[Et]={width:Ct.width,height:Ct.height,format:Ct.format,mipmaps:Ct.mipmaps},ft+=1,ft===6&&(Ct.mipmapCount===1&&(dt.minFilter=LinearFilter),dt.image=lt,dt.format=Ct.format,dt.needsUpdate=!0,tt&&tt(dt))},ot,st)}if(Array.isArray(_))for(let Et=0,yt=_.length;Et<yt;++Et)gt(Et);else ht.load(_,function(Et){const yt=at.parse(Et,!0);if(yt.isCubemap){const Ct=yt.mipmaps.length/yt.mipmapCount;for(let wt=0;wt<Ct;wt++){lt[wt]={mipmaps:[]};for(let It=0;It<yt.mipmapCount;It++)lt[wt].mipmaps.push(yt.mipmaps[wt*yt.mipmapCount+It]),lt[wt].format=yt.format,lt[wt].width=yt.width,lt[wt].height=yt.height}dt.image=lt}else dt.image.width=yt.width,dt.image.height=yt.height,dt.mipmaps=yt.mipmaps;yt.mipmapCount===1&&(dt.minFilter=LinearFilter),dt.format=yt.format,dt.needsUpdate=!0,tt&&tt(dt)},ot,st);return dt}}class ImageLoader extends Loader$1{constructor(_){super(_)}load(_,tt,ot,st){this.path!==void 0&&(_=this.path+_),_=this.manager.resolveURL(_);const at=this,lt=Cache.get(_);if(lt!==void 0)return at.manager.itemStart(_),setTimeout(function(){tt&&tt(lt),at.manager.itemEnd(_)},0),lt;const dt=createElementNS("img");function ht(){gt(),Cache.add(_,this),tt&&tt(this),at.manager.itemEnd(_)}function ft(Et){gt(),st&&st(Et),at.manager.itemError(_),at.manager.itemEnd(_)}function gt(){dt.removeEventListener("load",ht,!1),dt.removeEventListener("error",ft,!1)}return dt.addEventListener("load",ht,!1),dt.addEventListener("error",ft,!1),_.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(dt.crossOrigin=this.crossOrigin),at.manager.itemStart(_),dt.src=_,dt}}class CubeTextureLoader extends Loader$1{constructor(_){super(_)}load(_,tt,ot,st){const at=new CubeTexture;at.colorSpace=SRGBColorSpace$1;const lt=new ImageLoader(this.manager);lt.setCrossOrigin(this.crossOrigin),lt.setPath(this.path);let dt=0;function ht(ft){lt.load(_[ft],function(gt){at.images[ft]=gt,dt++,dt===6&&(at.needsUpdate=!0,tt&&tt(at))},void 0,st)}for(let ft=0;ft<_.length;++ft)ht(ft);return at}}class DataTextureLoader extends Loader$1{constructor(_){super(_)}load(_,tt,ot,st){const at=this,lt=new DataTexture,dt=new FileLoader(this.manager);return dt.setResponseType("arraybuffer"),dt.setRequestHeader(this.requestHeader),dt.setPath(this.path),dt.setWithCredentials(at.withCredentials),dt.load(_,function(ht){const ft=at.parse(ht);ft&&(ft.image!==void 0?lt.image=ft.image:ft.data!==void 0&&(lt.image.width=ft.width,lt.image.height=ft.height,lt.image.data=ft.data),lt.wrapS=ft.wrapS!==void 0?ft.wrapS:ClampToEdgeWrapping,lt.wrapT=ft.wrapT!==void 0?ft.wrapT:ClampToEdgeWrapping,lt.magFilter=ft.magFilter!==void 0?ft.magFilter:LinearFilter,lt.minFilter=ft.minFilter!==void 0?ft.minFilter:LinearFilter,lt.anisotropy=ft.anisotropy!==void 0?ft.anisotropy:1,ft.colorSpace!==void 0?lt.colorSpace=ft.colorSpace:ft.encoding!==void 0&&(lt.encoding=ft.encoding),ft.flipY!==void 0&&(lt.flipY=ft.flipY),ft.format!==void 0&&(lt.format=ft.format),ft.type!==void 0&&(lt.type=ft.type),ft.mipmaps!==void 0&&(lt.mipmaps=ft.mipmaps,lt.minFilter=LinearMipmapLinearFilter),ft.mipmapCount===1&&(lt.minFilter=LinearFilter),ft.generateMipmaps!==void 0&&(lt.generateMipmaps=ft.generateMipmaps),lt.needsUpdate=!0,tt&&tt(lt,ft))},ot,st),lt}}class TextureLoader extends Loader$1{constructor(_){super(_)}load(_,tt,ot,st){const at=new Texture,lt=new ImageLoader(this.manager);return lt.setCrossOrigin(this.crossOrigin),lt.setPath(this.path),lt.load(_,function(dt){at.image=dt,at.needsUpdate=!0,tt!==void 0&&tt(at)},ot,st),at}}class Light extends Object3D{constructor(_,tt=1){super(),this.isLight=!0,this.type="Light",this.color=new Color$1(_),this.intensity=tt}dispose(){}copy(_,tt){return super.copy(_,tt),this.color.copy(_.color),this.intensity=_.intensity,this}toJSON(_){const tt=super.toJSON(_);return tt.object.color=this.color.getHex(),tt.object.intensity=this.intensity,this.groundColor!==void 0&&(tt.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(tt.object.distance=this.distance),this.angle!==void 0&&(tt.object.angle=this.angle),this.decay!==void 0&&(tt.object.decay=this.decay),this.penumbra!==void 0&&(tt.object.penumbra=this.penumbra),this.shadow!==void 0&&(tt.object.shadow=this.shadow.toJSON()),tt}}class HemisphereLight extends Light{constructor(_,tt,ot){super(_,ot),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(Object3D.DEFAULT_UP),this.updateMatrix(),this.groundColor=new Color$1(tt)}copy(_,tt){return super.copy(_,tt),this.groundColor.copy(_.groundColor),this}}const _projScreenMatrix$1=new Matrix4,_lightPositionWorld$1=new Vector3,_lookTarget$1=new Vector3;class LightShadow{constructor(_){this.camera=_,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new Vector2(512,512),this.map=null,this.mapPass=null,this.matrix=new Matrix4,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new Frustum,this._frameExtents=new Vector2(1,1),this._viewportCount=1,this._viewports=[new Vector4(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(_){const tt=this.camera,ot=this.matrix;_lightPositionWorld$1.setFromMatrixPosition(_.matrixWorld),tt.position.copy(_lightPositionWorld$1),_lookTarget$1.setFromMatrixPosition(_.target.matrixWorld),tt.lookAt(_lookTarget$1),tt.updateMatrixWorld(),_projScreenMatrix$1.multiplyMatrices(tt.projectionMatrix,tt.matrixWorldInverse),this._frustum.setFromProjectionMatrix(_projScreenMatrix$1),ot.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),ot.multiply(_projScreenMatrix$1)}getViewport(_){return this._viewports[_]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(_){return this.camera=_.camera.clone(),this.bias=_.bias,this.radius=_.radius,this.mapSize.copy(_.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const _={};return this.bias!==0&&(_.bias=this.bias),this.normalBias!==0&&(_.normalBias=this.normalBias),this.radius!==1&&(_.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(_.mapSize=this.mapSize.toArray()),_.camera=this.camera.toJSON(!1).object,delete _.camera.matrix,_}}class SpotLightShadow extends LightShadow{constructor(){super(new PerspectiveCamera(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(_){const tt=this.camera,ot=RAD2DEG*2*_.angle*this.focus,st=this.mapSize.width/this.mapSize.height,at=_.distance||tt.far;(ot!==tt.fov||st!==tt.aspect||at!==tt.far)&&(tt.fov=ot,tt.aspect=st,tt.far=at,tt.updateProjectionMatrix()),super.updateMatrices(_)}copy(_){return super.copy(_),this.focus=_.focus,this}}class SpotLight extends Light{constructor(_,tt,ot=0,st=Math.PI/3,at=0,lt=2){super(_,tt),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(Object3D.DEFAULT_UP),this.updateMatrix(),this.target=new Object3D,this.distance=ot,this.angle=st,this.penumbra=at,this.decay=lt,this.map=null,this.shadow=new SpotLightShadow}get power(){return this.intensity*Math.PI}set power(_){this.intensity=_/Math.PI}dispose(){this.shadow.dispose()}copy(_,tt){return super.copy(_,tt),this.distance=_.distance,this.angle=_.angle,this.penumbra=_.penumbra,this.decay=_.decay,this.target=_.target.clone(),this.shadow=_.shadow.clone(),this}}const _projScreenMatrix=new Matrix4,_lightPositionWorld=new Vector3,_lookTarget=new Vector3;class PointLightShadow extends LightShadow{constructor(){super(new PerspectiveCamera(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new Vector2(4,2),this._viewportCount=6,this._viewports=[new Vector4(2,1,1,1),new Vector4(0,1,1,1),new Vector4(3,1,1,1),new Vector4(1,1,1,1),new Vector4(3,0,1,1),new Vector4(1,0,1,1)],this._cubeDirections=[new Vector3(1,0,0),new Vector3(-1,0,0),new Vector3(0,0,1),new Vector3(0,0,-1),new Vector3(0,1,0),new Vector3(0,-1,0)],this._cubeUps=[new Vector3(0,1,0),new Vector3(0,1,0),new Vector3(0,1,0),new Vector3(0,1,0),new Vector3(0,0,1),new Vector3(0,0,-1)]}updateMatrices(_,tt=0){const ot=this.camera,st=this.matrix,at=_.distance||ot.far;at!==ot.far&&(ot.far=at,ot.updateProjectionMatrix()),_lightPositionWorld.setFromMatrixPosition(_.matrixWorld),ot.position.copy(_lightPositionWorld),_lookTarget.copy(ot.position),_lookTarget.add(this._cubeDirections[tt]),ot.up.copy(this._cubeUps[tt]),ot.lookAt(_lookTarget),ot.updateMatrixWorld(),st.makeTranslation(-_lightPositionWorld.x,-_lightPositionWorld.y,-_lightPositionWorld.z),_projScreenMatrix.multiplyMatrices(ot.projectionMatrix,ot.matrixWorldInverse),this._frustum.setFromProjectionMatrix(_projScreenMatrix)}}class PointLight extends Light{constructor(_,tt,ot=0,st=2){super(_,tt),this.isPointLight=!0,this.type="PointLight",this.distance=ot,this.decay=st,this.shadow=new PointLightShadow}get power(){return this.intensity*4*Math.PI}set power(_){this.intensity=_/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(_,tt){return super.copy(_,tt),this.distance=_.distance,this.decay=_.decay,this.shadow=_.shadow.clone(),this}}class DirectionalLightShadow extends LightShadow{constructor(){super(new OrthographicCamera(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class DirectionalLight extends Light{constructor(_,tt){super(_,tt),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(Object3D.DEFAULT_UP),this.updateMatrix(),this.target=new Object3D,this.shadow=new DirectionalLightShadow}dispose(){this.shadow.dispose()}copy(_){return super.copy(_),this.target=_.target.clone(),this.shadow=_.shadow.clone(),this}}class AmbientLight extends Light{constructor(_,tt){super(_,tt),this.isAmbientLight=!0,this.type="AmbientLight"}}class RectAreaLight extends Light{constructor(_,tt,ot=10,st=10){super(_,tt),this.isRectAreaLight=!0,this.type="RectAreaLight",this.width=ot,this.height=st}get power(){return this.intensity*this.width*this.height*Math.PI}set power(_){this.intensity=_/(this.width*this.height*Math.PI)}copy(_){return super.copy(_),this.width=_.width,this.height=_.height,this}toJSON(_){const tt=super.toJSON(_);return tt.object.width=this.width,tt.object.height=this.height,tt}}class SphericalHarmonics3{constructor(){this.isSphericalHarmonics3=!0,this.coefficients=[];for(let _=0;_<9;_++)this.coefficients.push(new Vector3)}set(_){for(let tt=0;tt<9;tt++)this.coefficients[tt].copy(_[tt]);return this}zero(){for(let _=0;_<9;_++)this.coefficients[_].set(0,0,0);return this}getAt(_,tt){const ot=_.x,st=_.y,at=_.z,lt=this.coefficients;return tt.copy(lt[0]).multiplyScalar(.282095),tt.addScaledVector(lt[1],.488603*st),tt.addScaledVector(lt[2],.488603*at),tt.addScaledVector(lt[3],.488603*ot),tt.addScaledVector(lt[4],1.092548*(ot*st)),tt.addScaledVector(lt[5],1.092548*(st*at)),tt.addScaledVector(lt[6],.315392*(3*at*at-1)),tt.addScaledVector(lt[7],1.092548*(ot*at)),tt.addScaledVector(lt[8],.546274*(ot*ot-st*st)),tt}getIrradianceAt(_,tt){const ot=_.x,st=_.y,at=_.z,lt=this.coefficients;return tt.copy(lt[0]).multiplyScalar(.886227),tt.addScaledVector(lt[1],2*.511664*st),tt.addScaledVector(lt[2],2*.511664*at),tt.addScaledVector(lt[3],2*.511664*ot),tt.addScaledVector(lt[4],2*.429043*ot*st),tt.addScaledVector(lt[5],2*.429043*st*at),tt.addScaledVector(lt[6],.743125*at*at-.247708),tt.addScaledVector(lt[7],2*.429043*ot*at),tt.addScaledVector(lt[8],.429043*(ot*ot-st*st)),tt}add(_){for(let tt=0;tt<9;tt++)this.coefficients[tt].add(_.coefficients[tt]);return this}addScaledSH(_,tt){for(let ot=0;ot<9;ot++)this.coefficients[ot].addScaledVector(_.coefficients[ot],tt);return this}scale(_){for(let tt=0;tt<9;tt++)this.coefficients[tt].multiplyScalar(_);return this}lerp(_,tt){for(let ot=0;ot<9;ot++)this.coefficients[ot].lerp(_.coefficients[ot],tt);return this}equals(_){for(let tt=0;tt<9;tt++)if(!this.coefficients[tt].equals(_.coefficients[tt]))return!1;return!0}copy(_){return this.set(_.coefficients)}clone(){return new this.constructor().copy(this)}fromArray(_,tt=0){const ot=this.coefficients;for(let st=0;st<9;st++)ot[st].fromArray(_,tt+st*3);return this}toArray(_=[],tt=0){const ot=this.coefficients;for(let st=0;st<9;st++)ot[st].toArray(_,tt+st*3);return _}static getBasisAt(_,tt){const ot=_.x,st=_.y,at=_.z;tt[0]=.282095,tt[1]=.488603*st,tt[2]=.488603*at,tt[3]=.488603*ot,tt[4]=1.092548*ot*st,tt[5]=1.092548*st*at,tt[6]=.315392*(3*at*at-1),tt[7]=1.092548*ot*at,tt[8]=.546274*(ot*ot-st*st)}}class LightProbe extends Light{constructor(_=new SphericalHarmonics3,tt=1){super(void 0,tt),this.isLightProbe=!0,this.sh=_}copy(_){return super.copy(_),this.sh.copy(_.sh),this}fromJSON(_){return this.intensity=_.intensity,this.sh.fromArray(_.sh),this}toJSON(_){const tt=super.toJSON(_);return tt.object.sh=this.sh.toArray(),tt}}class MaterialLoader extends Loader$1{constructor(_){super(_),this.textures={}}load(_,tt,ot,st){const at=this,lt=new FileLoader(at.manager);lt.setPath(at.path),lt.setRequestHeader(at.requestHeader),lt.setWithCredentials(at.withCredentials),lt.load(_,function(dt){try{tt(at.parse(JSON.parse(dt)))}catch(ht){st?st(ht):console.error(ht),at.manager.itemError(_)}},ot,st)}parse(_){const tt=this.textures;function ot(at){return tt[at]===void 0&&console.warn("THREE.MaterialLoader: Undefined texture",at),tt[at]}const st=MaterialLoader.createMaterialFromType(_.type);if(_.uuid!==void 0&&(st.uuid=_.uuid),_.name!==void 0&&(st.name=_.name),_.color!==void 0&&st.color!==void 0&&st.color.setHex(_.color),_.roughness!==void 0&&(st.roughness=_.roughness),_.metalness!==void 0&&(st.metalness=_.metalness),_.sheen!==void 0&&(st.sheen=_.sheen),_.sheenColor!==void 0&&(st.sheenColor=new Color$1().setHex(_.sheenColor)),_.sheenRoughness!==void 0&&(st.sheenRoughness=_.sheenRoughness),_.emissive!==void 0&&st.emissive!==void 0&&st.emissive.setHex(_.emissive),_.specular!==void 0&&st.specular!==void 0&&st.specular.setHex(_.specular),_.specularIntensity!==void 0&&(st.specularIntensity=_.specularIntensity),_.specularColor!==void 0&&st.specularColor!==void 0&&st.specularColor.setHex(_.specularColor),_.shininess!==void 0&&(st.shininess=_.shininess),_.clearcoat!==void 0&&(st.clearcoat=_.clearcoat),_.clearcoatRoughness!==void 0&&(st.clearcoatRoughness=_.clearcoatRoughness),_.iridescence!==void 0&&(st.iridescence=_.iridescence),_.iridescenceIOR!==void 0&&(st.iridescenceIOR=_.iridescenceIOR),_.iridescenceThicknessRange!==void 0&&(st.iridescenceThicknessRange=_.iridescenceThicknessRange),_.transmission!==void 0&&(st.transmission=_.transmission),_.thickness!==void 0&&(st.thickness=_.thickness),_.attenuationDistance!==void 0&&(st.attenuationDistance=_.attenuationDistance),_.attenuationColor!==void 0&&st.attenuationColor!==void 0&&st.attenuationColor.setHex(_.attenuationColor),_.anisotropy!==void 0&&(st.anisotropy=_.anisotropy),_.anisotropyRotation!==void 0&&(st.anisotropyRotation=_.anisotropyRotation),_.fog!==void 0&&(st.fog=_.fog),_.flatShading!==void 0&&(st.flatShading=_.flatShading),_.blending!==void 0&&(st.blending=_.blending),_.combine!==void 0&&(st.combine=_.combine),_.side!==void 0&&(st.side=_.side),_.shadowSide!==void 0&&(st.shadowSide=_.shadowSide),_.opacity!==void 0&&(st.opacity=_.opacity),_.transparent!==void 0&&(st.transparent=_.transparent),_.alphaTest!==void 0&&(st.alphaTest=_.alphaTest),_.depthTest!==void 0&&(st.depthTest=_.depthTest),_.depthWrite!==void 0&&(st.depthWrite=_.depthWrite),_.colorWrite!==void 0&&(st.colorWrite=_.colorWrite),_.stencilWrite!==void 0&&(st.stencilWrite=_.stencilWrite),_.stencilWriteMask!==void 0&&(st.stencilWriteMask=_.stencilWriteMask),_.stencilFunc!==void 0&&(st.stencilFunc=_.stencilFunc),_.stencilRef!==void 0&&(st.stencilRef=_.stencilRef),_.stencilFuncMask!==void 0&&(st.stencilFuncMask=_.stencilFuncMask),_.stencilFail!==void 0&&(st.stencilFail=_.stencilFail),_.stencilZFail!==void 0&&(st.stencilZFail=_.stencilZFail),_.stencilZPass!==void 0&&(st.stencilZPass=_.stencilZPass),_.wireframe!==void 0&&(st.wireframe=_.wireframe),_.wireframeLinewidth!==void 0&&(st.wireframeLinewidth=_.wireframeLinewidth),_.wireframeLinecap!==void 0&&(st.wireframeLinecap=_.wireframeLinecap),_.wireframeLinejoin!==void 0&&(st.wireframeLinejoin=_.wireframeLinejoin),_.rotation!==void 0&&(st.rotation=_.rotation),_.linewidth!==1&&(st.linewidth=_.linewidth),_.dashSize!==void 0&&(st.dashSize=_.dashSize),_.gapSize!==void 0&&(st.gapSize=_.gapSize),_.scale!==void 0&&(st.scale=_.scale),_.polygonOffset!==void 0&&(st.polygonOffset=_.polygonOffset),_.polygonOffsetFactor!==void 0&&(st.polygonOffsetFactor=_.polygonOffsetFactor),_.polygonOffsetUnits!==void 0&&(st.polygonOffsetUnits=_.polygonOffsetUnits),_.dithering!==void 0&&(st.dithering=_.dithering),_.alphaToCoverage!==void 0&&(st.alphaToCoverage=_.alphaToCoverage),_.premultipliedAlpha!==void 0&&(st.premultipliedAlpha=_.premultipliedAlpha),_.forceSinglePass!==void 0&&(st.forceSinglePass=_.forceSinglePass),_.visible!==void 0&&(st.visible=_.visible),_.toneMapped!==void 0&&(st.toneMapped=_.toneMapped),_.userData!==void 0&&(st.userData=_.userData),_.vertexColors!==void 0&&(typeof _.vertexColors=="number"?st.vertexColors=_.vertexColors>0:st.vertexColors=_.vertexColors),_.uniforms!==void 0)for(const at in _.uniforms){const lt=_.uniforms[at];switch(st.uniforms[at]={},lt.type){case"t":st.uniforms[at].value=ot(lt.value);break;case"c":st.uniforms[at].value=new Color$1().setHex(lt.value);break;case"v2":st.uniforms[at].value=new Vector2().fromArray(lt.value);break;case"v3":st.uniforms[at].value=new Vector3().fromArray(lt.value);break;case"v4":st.uniforms[at].value=new Vector4().fromArray(lt.value);break;case"m3":st.uniforms[at].value=new Matrix3().fromArray(lt.value);break;case"m4":st.uniforms[at].value=new Matrix4().fromArray(lt.value);break;default:st.uniforms[at].value=lt.value}}if(_.defines!==void 0&&(st.defines=_.defines),_.vertexShader!==void 0&&(st.vertexShader=_.vertexShader),_.fragmentShader!==void 0&&(st.fragmentShader=_.fragmentShader),_.glslVersion!==void 0&&(st.glslVersion=_.glslVersion),_.extensions!==void 0)for(const at in _.extensions)st.extensions[at]=_.extensions[at];if(_.lights!==void 0&&(st.lights=_.lights),_.clipping!==void 0&&(st.clipping=_.clipping),_.size!==void 0&&(st.size=_.size),_.sizeAttenuation!==void 0&&(st.sizeAttenuation=_.sizeAttenuation),_.map!==void 0&&(st.map=ot(_.map)),_.matcap!==void 0&&(st.matcap=ot(_.matcap)),_.alphaMap!==void 0&&(st.alphaMap=ot(_.alphaMap)),_.bumpMap!==void 0&&(st.bumpMap=ot(_.bumpMap)),_.bumpScale!==void 0&&(st.bumpScale=_.bumpScale),_.normalMap!==void 0&&(st.normalMap=ot(_.normalMap)),_.normalMapType!==void 0&&(st.normalMapType=_.normalMapType),_.normalScale!==void 0){let at=_.normalScale;Array.isArray(at)===!1&&(at=[at,at]),st.normalScale=new Vector2().fromArray(at)}return _.displacementMap!==void 0&&(st.displacementMap=ot(_.displacementMap)),_.displacementScale!==void 0&&(st.displacementScale=_.displacementScale),_.displacementBias!==void 0&&(st.displacementBias=_.displacementBias),_.roughnessMap!==void 0&&(st.roughnessMap=ot(_.roughnessMap)),_.metalnessMap!==void 0&&(st.metalnessMap=ot(_.metalnessMap)),_.emissiveMap!==void 0&&(st.emissiveMap=ot(_.emissiveMap)),_.emissiveIntensity!==void 0&&(st.emissiveIntensity=_.emissiveIntensity),_.specularMap!==void 0&&(st.specularMap=ot(_.specularMap)),_.specularIntensityMap!==void 0&&(st.specularIntensityMap=ot(_.specularIntensityMap)),_.specularColorMap!==void 0&&(st.specularColorMap=ot(_.specularColorMap)),_.envMap!==void 0&&(st.envMap=ot(_.envMap)),_.envMapIntensity!==void 0&&(st.envMapIntensity=_.envMapIntensity),_.reflectivity!==void 0&&(st.reflectivity=_.reflectivity),_.refractionRatio!==void 0&&(st.refractionRatio=_.refractionRatio),_.lightMap!==void 0&&(st.lightMap=ot(_.lightMap)),_.lightMapIntensity!==void 0&&(st.lightMapIntensity=_.lightMapIntensity),_.aoMap!==void 0&&(st.aoMap=ot(_.aoMap)),_.aoMapIntensity!==void 0&&(st.aoMapIntensity=_.aoMapIntensity),_.gradientMap!==void 0&&(st.gradientMap=ot(_.gradientMap)),_.clearcoatMap!==void 0&&(st.clearcoatMap=ot(_.clearcoatMap)),_.clearcoatRoughnessMap!==void 0&&(st.clearcoatRoughnessMap=ot(_.clearcoatRoughnessMap)),_.clearcoatNormalMap!==void 0&&(st.clearcoatNormalMap=ot(_.clearcoatNormalMap)),_.clearcoatNormalScale!==void 0&&(st.clearcoatNormalScale=new Vector2().fromArray(_.clearcoatNormalScale)),_.iridescenceMap!==void 0&&(st.iridescenceMap=ot(_.iridescenceMap)),_.iridescenceThicknessMap!==void 0&&(st.iridescenceThicknessMap=ot(_.iridescenceThicknessMap)),_.transmissionMap!==void 0&&(st.transmissionMap=ot(_.transmissionMap)),_.thicknessMap!==void 0&&(st.thicknessMap=ot(_.thicknessMap)),_.anisotropyMap!==void 0&&(st.anisotropyMap=ot(_.anisotropyMap)),_.sheenColorMap!==void 0&&(st.sheenColorMap=ot(_.sheenColorMap)),_.sheenRoughnessMap!==void 0&&(st.sheenRoughnessMap=ot(_.sheenRoughnessMap)),st}setTextures(_){return this.textures=_,this}static createMaterialFromType(_){const tt={ShadowMaterial,SpriteMaterial,RawShaderMaterial,ShaderMaterial,PointsMaterial,MeshPhysicalMaterial,MeshStandardMaterial,MeshPhongMaterial,MeshToonMaterial,MeshNormalMaterial,MeshLambertMaterial,MeshDepthMaterial,MeshDistanceMaterial,MeshBasicMaterial,MeshMatcapMaterial,LineDashedMaterial,LineBasicMaterial,Material};return new tt[_]}}class LoaderUtils{static decodeText(_){if(typeof TextDecoder<"u")return new TextDecoder().decode(_);let tt="";for(let ot=0,st=_.length;ot<st;ot++)tt+=String.fromCharCode(_[ot]);try{return decodeURIComponent(escape(tt))}catch{return tt}}static extractUrlBase(_){const tt=_.lastIndexOf("/");return tt===-1?"./":_.slice(0,tt+1)}static resolveURL(_,tt){return typeof _!="string"||_===""?"":(/^https?:\/\//i.test(tt)&&/^\//.test(_)&&(tt=tt.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(_)||/^data:.*,.*$/i.test(_)||/^blob:.*$/i.test(_)?_:tt+_)}}class InstancedBufferGeometry extends BufferGeometry{constructor(){super(),this.isInstancedBufferGeometry=!0,this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(_){return super.copy(_),this.instanceCount=_.instanceCount,this}toJSON(){const _=super.toJSON();return _.instanceCount=this.instanceCount,_.isInstancedBufferGeometry=!0,_}}class BufferGeometryLoader extends Loader$1{constructor(_){super(_)}load(_,tt,ot,st){const at=this,lt=new FileLoader(at.manager);lt.setPath(at.path),lt.setRequestHeader(at.requestHeader),lt.setWithCredentials(at.withCredentials),lt.load(_,function(dt){try{tt(at.parse(JSON.parse(dt)))}catch(ht){st?st(ht):console.error(ht),at.manager.itemError(_)}},ot,st)}parse(_){const tt={},ot={};function st(Ct,wt){if(tt[wt]!==void 0)return tt[wt];const Pt=Ct.interleavedBuffers[wt],Rt=at(Ct,Pt.buffer),xt=getTypedArray(Pt.type,Rt),Nt=new InterleavedBuffer(xt,Pt.stride);return Nt.uuid=Pt.uuid,tt[wt]=Nt,Nt}function at(Ct,wt){if(ot[wt]!==void 0)return ot[wt];const Pt=Ct.arrayBuffers[wt],Rt=new Uint32Array(Pt).buffer;return ot[wt]=Rt,Rt}const lt=_.isInstancedBufferGeometry?new InstancedBufferGeometry:new BufferGeometry,dt=_.data.index;if(dt!==void 0){const Ct=getTypedArray(dt.type,dt.array);lt.setIndex(new BufferAttribute(Ct,1))}const ht=_.data.attributes;for(const Ct in ht){const wt=ht[Ct];let It;if(wt.isInterleavedBufferAttribute){const Pt=st(_.data,wt.data);It=new InterleavedBufferAttribute(Pt,wt.itemSize,wt.offset,wt.normalized)}else{const Pt=getTypedArray(wt.type,wt.array),Rt=wt.isInstancedBufferAttribute?InstancedBufferAttribute:BufferAttribute;It=new Rt(Pt,wt.itemSize,wt.normalized)}wt.name!==void 0&&(It.name=wt.name),wt.usage!==void 0&&It.setUsage(wt.usage),wt.updateRange!==void 0&&(It.updateRange.offset=wt.updateRange.offset,It.updateRange.count=wt.updateRange.count),lt.setAttribute(Ct,It)}const ft=_.data.morphAttributes;if(ft)for(const Ct in ft){const wt=ft[Ct],It=[];for(let Pt=0,Rt=wt.length;Pt<Rt;Pt++){const xt=wt[Pt];let Nt;if(xt.isInterleavedBufferAttribute){const kt=st(_.data,xt.data);Nt=new InterleavedBufferAttribute(kt,xt.itemSize,xt.offset,xt.normalized)}else{const kt=getTypedArray(xt.type,xt.array);Nt=new BufferAttribute(kt,xt.itemSize,xt.normalized)}xt.name!==void 0&&(Nt.name=xt.name),It.push(Nt)}lt.morphAttributes[Ct]=It}_.data.morphTargetsRelative&&(lt.morphTargetsRelative=!0);const Et=_.data.groups||_.data.drawcalls||_.data.offsets;if(Et!==void 0)for(let Ct=0,wt=Et.length;Ct!==wt;++Ct){const It=Et[Ct];lt.addGroup(It.start,It.count,It.materialIndex)}const yt=_.data.boundingSphere;if(yt!==void 0){const Ct=new Vector3;yt.center!==void 0&&Ct.fromArray(yt.center),lt.boundingSphere=new Sphere(Ct,yt.radius)}return _.name&&(lt.name=_.name),_.userData&&(lt.userData=_.userData),lt}}class ObjectLoader extends Loader$1{constructor(_){super(_)}load(_,tt,ot,st){const at=this,lt=this.path===""?LoaderUtils.extractUrlBase(_):this.path;this.resourcePath=this.resourcePath||lt;const dt=new FileLoader(this.manager);dt.setPath(this.path),dt.setRequestHeader(this.requestHeader),dt.setWithCredentials(this.withCredentials),dt.load(_,function(ht){let ft=null;try{ft=JSON.parse(ht)}catch(Et){st!==void 0&&st(Et),console.error("THREE:ObjectLoader: Can't parse "+_+".",Et.message);return}const gt=ft.metadata;if(gt===void 0||gt.type===void 0||gt.type.toLowerCase()==="geometry"){st!==void 0&&st(new Error("THREE.ObjectLoader: Can't load "+_)),console.error("THREE.ObjectLoader: Can't load "+_);return}at.parse(ft,tt)},ot,st)}async loadAsync(_,tt){const ot=this,st=this.path===""?LoaderUtils.extractUrlBase(_):this.path;this.resourcePath=this.resourcePath||st;const at=new FileLoader(this.manager);at.setPath(this.path),at.setRequestHeader(this.requestHeader),at.setWithCredentials(this.withCredentials);const lt=await at.loadAsync(_,tt),dt=JSON.parse(lt),ht=dt.metadata;if(ht===void 0||ht.type===void 0||ht.type.toLowerCase()==="geometry")throw new Error("THREE.ObjectLoader: Can't load "+_);return await ot.parseAsync(dt)}parse(_,tt){const ot=this.parseAnimations(_.animations),st=this.parseShapes(_.shapes),at=this.parseGeometries(_.geometries,st),lt=this.parseImages(_.images,function(){tt!==void 0&&tt(ft)}),dt=this.parseTextures(_.textures,lt),ht=this.parseMaterials(_.materials,dt),ft=this.parseObject(_.object,at,ht,dt,ot),gt=this.parseSkeletons(_.skeletons,ft);if(this.bindSkeletons(ft,gt),tt!==void 0){let Et=!1;for(const yt in lt)if(lt[yt].data instanceof HTMLImageElement){Et=!0;break}Et===!1&&tt(ft)}return ft}async parseAsync(_){const tt=this.parseAnimations(_.animations),ot=this.parseShapes(_.shapes),st=this.parseGeometries(_.geometries,ot),at=await this.parseImagesAsync(_.images),lt=this.parseTextures(_.textures,at),dt=this.parseMaterials(_.materials,lt),ht=this.parseObject(_.object,st,dt,lt,tt),ft=this.parseSkeletons(_.skeletons,ht);return this.bindSkeletons(ht,ft),ht}parseShapes(_){const tt={};if(_!==void 0)for(let ot=0,st=_.length;ot<st;ot++){const at=new Shape().fromJSON(_[ot]);tt[at.uuid]=at}return tt}parseSkeletons(_,tt){const ot={},st={};if(tt.traverse(function(at){at.isBone&&(st[at.uuid]=at)}),_!==void 0)for(let at=0,lt=_.length;at<lt;at++){const dt=new Skeleton().fromJSON(_[at],st);ot[dt.uuid]=dt}return ot}parseGeometries(_,tt){const ot={};if(_!==void 0){const st=new BufferGeometryLoader;for(let at=0,lt=_.length;at<lt;at++){let dt;const ht=_[at];switch(ht.type){case"BufferGeometry":case"InstancedBufferGeometry":dt=st.parse(ht);break;default:ht.type in Geometries?dt=Geometries[ht.type].fromJSON(ht,tt):console.warn(`THREE.ObjectLoader: Unsupported geometry type "${ht.type}"`)}dt.uuid=ht.uuid,ht.name!==void 0&&(dt.name=ht.name),ht.userData!==void 0&&(dt.userData=ht.userData),ot[ht.uuid]=dt}}return ot}parseMaterials(_,tt){const ot={},st={};if(_!==void 0){const at=new MaterialLoader;at.setTextures(tt);for(let lt=0,dt=_.length;lt<dt;lt++){const ht=_[lt];ot[ht.uuid]===void 0&&(ot[ht.uuid]=at.parse(ht)),st[ht.uuid]=ot[ht.uuid]}}return st}parseAnimations(_){const tt={};if(_!==void 0)for(let ot=0;ot<_.length;ot++){const st=_[ot],at=AnimationClip.parse(st);tt[at.uuid]=at}return tt}parseImages(_,tt){const ot=this,st={};let at;function lt(ht){return ot.manager.itemStart(ht),at.load(ht,function(){ot.manager.itemEnd(ht)},void 0,function(){ot.manager.itemError(ht),ot.manager.itemEnd(ht)})}function dt(ht){if(typeof ht=="string"){const ft=ht,gt=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(ft)?ft:ot.resourcePath+ft;return lt(gt)}else return ht.data?{data:getTypedArray(ht.type,ht.data),width:ht.width,height:ht.height}:null}if(_!==void 0&&_.length>0){const ht=new LoadingManager(tt);at=new ImageLoader(ht),at.setCrossOrigin(this.crossOrigin);for(let ft=0,gt=_.length;ft<gt;ft++){const Et=_[ft],yt=Et.url;if(Array.isArray(yt)){const Ct=[];for(let wt=0,It=yt.length;wt<It;wt++){const Pt=yt[wt],Rt=dt(Pt);Rt!==null&&(Rt instanceof HTMLImageElement?Ct.push(Rt):Ct.push(new DataTexture(Rt.data,Rt.width,Rt.height)))}st[Et.uuid]=new Source(Ct)}else{const Ct=dt(Et.url);st[Et.uuid]=new Source(Ct)}}}return st}async parseImagesAsync(_){const tt=this,ot={};let st;async function at(lt){if(typeof lt=="string"){const dt=lt,ht=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(dt)?dt:tt.resourcePath+dt;return await st.loadAsync(ht)}else return lt.data?{data:getTypedArray(lt.type,lt.data),width:lt.width,height:lt.height}:null}if(_!==void 0&&_.length>0){st=new ImageLoader(this.manager),st.setCrossOrigin(this.crossOrigin);for(let lt=0,dt=_.length;lt<dt;lt++){const ht=_[lt],ft=ht.url;if(Array.isArray(ft)){const gt=[];for(let Et=0,yt=ft.length;Et<yt;Et++){const Ct=ft[Et],wt=await at(Ct);wt!==null&&(wt instanceof HTMLImageElement?gt.push(wt):gt.push(new DataTexture(wt.data,wt.width,wt.height)))}ot[ht.uuid]=new Source(gt)}else{const gt=await at(ht.url);ot[ht.uuid]=new Source(gt)}}}return ot}parseTextures(_,tt){function ot(at,lt){return typeof at=="number"?at:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",at),lt[at])}const st={};if(_!==void 0)for(let at=0,lt=_.length;at<lt;at++){const dt=_[at];dt.image===void 0&&console.warn('THREE.ObjectLoader: No "image" specified for',dt.uuid),tt[dt.image]===void 0&&console.warn("THREE.ObjectLoader: Undefined image",dt.image);const ht=tt[dt.image],ft=ht.data;let gt;Array.isArray(ft)?(gt=new CubeTexture,ft.length===6&&(gt.needsUpdate=!0)):(ft&&ft.data?gt=new DataTexture:gt=new Texture,ft&&(gt.needsUpdate=!0)),gt.source=ht,gt.uuid=dt.uuid,dt.name!==void 0&&(gt.name=dt.name),dt.mapping!==void 0&&(gt.mapping=ot(dt.mapping,TEXTURE_MAPPING)),dt.channel!==void 0&&(gt.channel=dt.channel),dt.offset!==void 0&&gt.offset.fromArray(dt.offset),dt.repeat!==void 0&&gt.repeat.fromArray(dt.repeat),dt.center!==void 0&&gt.center.fromArray(dt.center),dt.rotation!==void 0&&(gt.rotation=dt.rotation),dt.wrap!==void 0&&(gt.wrapS=ot(dt.wrap[0],TEXTURE_WRAPPING),gt.wrapT=ot(dt.wrap[1],TEXTURE_WRAPPING)),dt.format!==void 0&&(gt.format=dt.format),dt.internalFormat!==void 0&&(gt.internalFormat=dt.internalFormat),dt.type!==void 0&&(gt.type=dt.type),dt.colorSpace!==void 0&&(gt.colorSpace=dt.colorSpace),dt.encoding!==void 0&&(gt.encoding=dt.encoding),dt.minFilter!==void 0&&(gt.minFilter=ot(dt.minFilter,TEXTURE_FILTER)),dt.magFilter!==void 0&&(gt.magFilter=ot(dt.magFilter,TEXTURE_FILTER)),dt.anisotropy!==void 0&&(gt.anisotropy=dt.anisotropy),dt.flipY!==void 0&&(gt.flipY=dt.flipY),dt.generateMipmaps!==void 0&&(gt.generateMipmaps=dt.generateMipmaps),dt.premultiplyAlpha!==void 0&&(gt.premultiplyAlpha=dt.premultiplyAlpha),dt.unpackAlignment!==void 0&&(gt.unpackAlignment=dt.unpackAlignment),dt.compareFunction!==void 0&&(gt.compareFunction=dt.compareFunction),dt.userData!==void 0&&(gt.userData=dt.userData),st[dt.uuid]=gt}return st}parseObject(_,tt,ot,st,at){let lt;function dt(yt){return tt[yt]===void 0&&console.warn("THREE.ObjectLoader: Undefined geometry",yt),tt[yt]}function ht(yt){if(yt!==void 0){if(Array.isArray(yt)){const Ct=[];for(let wt=0,It=yt.length;wt<It;wt++){const Pt=yt[wt];ot[Pt]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",Pt),Ct.push(ot[Pt])}return Ct}return ot[yt]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",yt),ot[yt]}}function ft(yt){return st[yt]===void 0&&console.warn("THREE.ObjectLoader: Undefined texture",yt),st[yt]}let gt,Et;switch(_.type){case"Scene":lt=new Scene,_.background!==void 0&&(Number.isInteger(_.background)?lt.background=new Color$1(_.background):lt.background=ft(_.background)),_.environment!==void 0&&(lt.environment=ft(_.environment)),_.fog!==void 0&&(_.fog.type==="Fog"?lt.fog=new Fog(_.fog.color,_.fog.near,_.fog.far):_.fog.type==="FogExp2"&&(lt.fog=new FogExp2(_.fog.color,_.fog.density))),_.backgroundBlurriness!==void 0&&(lt.backgroundBlurriness=_.backgroundBlurriness),_.backgroundIntensity!==void 0&&(lt.backgroundIntensity=_.backgroundIntensity);break;case"PerspectiveCamera":lt=new PerspectiveCamera(_.fov,_.aspect,_.near,_.far),_.focus!==void 0&&(lt.focus=_.focus),_.zoom!==void 0&&(lt.zoom=_.zoom),_.filmGauge!==void 0&&(lt.filmGauge=_.filmGauge),_.filmOffset!==void 0&&(lt.filmOffset=_.filmOffset),_.view!==void 0&&(lt.view=Object.assign({},_.view));break;case"OrthographicCamera":lt=new OrthographicCamera(_.left,_.right,_.top,_.bottom,_.near,_.far),_.zoom!==void 0&&(lt.zoom=_.zoom),_.view!==void 0&&(lt.view=Object.assign({},_.view));break;case"AmbientLight":lt=new AmbientLight(_.color,_.intensity);break;case"DirectionalLight":lt=new DirectionalLight(_.color,_.intensity);break;case"PointLight":lt=new PointLight(_.color,_.intensity,_.distance,_.decay);break;case"RectAreaLight":lt=new RectAreaLight(_.color,_.intensity,_.width,_.height);break;case"SpotLight":lt=new SpotLight(_.color,_.intensity,_.distance,_.angle,_.penumbra,_.decay);break;case"HemisphereLight":lt=new HemisphereLight(_.color,_.groundColor,_.intensity);break;case"LightProbe":lt=new LightProbe().fromJSON(_);break;case"SkinnedMesh":gt=dt(_.geometry),Et=ht(_.material),lt=new SkinnedMesh(gt,Et),_.bindMode!==void 0&&(lt.bindMode=_.bindMode),_.bindMatrix!==void 0&&lt.bindMatrix.fromArray(_.bindMatrix),_.skeleton!==void 0&&(lt.skeleton=_.skeleton);break;case"Mesh":gt=dt(_.geometry),Et=ht(_.material),lt=new Mesh(gt,Et);break;case"InstancedMesh":gt=dt(_.geometry),Et=ht(_.material);const yt=_.count,Ct=_.instanceMatrix,wt=_.instanceColor;lt=new InstancedMesh(gt,Et,yt),lt.instanceMatrix=new InstancedBufferAttribute(new Float32Array(Ct.array),16),wt!==void 0&&(lt.instanceColor=new InstancedBufferAttribute(new Float32Array(wt.array),wt.itemSize));break;case"LOD":lt=new LOD;break;case"Line":lt=new Line(dt(_.geometry),ht(_.material));break;case"LineLoop":lt=new LineLoop(dt(_.geometry),ht(_.material));break;case"LineSegments":lt=new LineSegments(dt(_.geometry),ht(_.material));break;case"PointCloud":case"Points":lt=new Points(dt(_.geometry),ht(_.material));break;case"Sprite":lt=new Sprite(ht(_.material));break;case"Group":lt=new Group;break;case"Bone":lt=new Bone;break;default:lt=new Object3D}if(lt.uuid=_.uuid,_.name!==void 0&&(lt.name=_.name),_.matrix!==void 0?(lt.matrix.fromArray(_.matrix),_.matrixAutoUpdate!==void 0&&(lt.matrixAutoUpdate=_.matrixAutoUpdate),lt.matrixAutoUpdate&&lt.matrix.decompose(lt.position,lt.quaternion,lt.scale)):(_.position!==void 0&&lt.position.fromArray(_.position),_.rotation!==void 0&&lt.rotation.fromArray(_.rotation),_.quaternion!==void 0&&lt.quaternion.fromArray(_.quaternion),_.scale!==void 0&&lt.scale.fromArray(_.scale)),_.up!==void 0&&lt.up.fromArray(_.up),_.castShadow!==void 0&&(lt.castShadow=_.castShadow),_.receiveShadow!==void 0&&(lt.receiveShadow=_.receiveShadow),_.shadow&&(_.shadow.bias!==void 0&&(lt.shadow.bias=_.shadow.bias),_.shadow.normalBias!==void 0&&(lt.shadow.normalBias=_.shadow.normalBias),_.shadow.radius!==void 0&&(lt.shadow.radius=_.shadow.radius),_.shadow.mapSize!==void 0&&lt.shadow.mapSize.fromArray(_.shadow.mapSize),_.shadow.camera!==void 0&&(lt.shadow.camera=this.parseObject(_.shadow.camera))),_.visible!==void 0&&(lt.visible=_.visible),_.frustumCulled!==void 0&&(lt.frustumCulled=_.frustumCulled),_.renderOrder!==void 0&&(lt.renderOrder=_.renderOrder),_.userData!==void 0&&(lt.userData=_.userData),_.layers!==void 0&&(lt.layers.mask=_.layers),_.children!==void 0){const yt=_.children;for(let Ct=0;Ct<yt.length;Ct++)lt.add(this.parseObject(yt[Ct],tt,ot,st,at))}if(_.animations!==void 0){const yt=_.animations;for(let Ct=0;Ct<yt.length;Ct++){const wt=yt[Ct];lt.animations.push(at[wt])}}if(_.type==="LOD"){_.autoUpdate!==void 0&&(lt.autoUpdate=_.autoUpdate);const yt=_.levels;for(let Ct=0;Ct<yt.length;Ct++){const wt=yt[Ct],It=lt.getObjectByProperty("uuid",wt.object);It!==void 0&&lt.addLevel(It,wt.distance,wt.hysteresis)}}return lt}bindSkeletons(_,tt){Object.keys(tt).length!==0&&_.traverse(function(ot){if(ot.isSkinnedMesh===!0&&ot.skeleton!==void 0){const st=tt[ot.skeleton];st===void 0?console.warn("THREE.ObjectLoader: No skeleton found with UUID:",ot.skeleton):ot.bind(st,ot.bindMatrix)}})}}const TEXTURE_MAPPING={UVMapping,CubeReflectionMapping,CubeRefractionMapping,EquirectangularReflectionMapping,EquirectangularRefractionMapping,CubeUVReflectionMapping},TEXTURE_WRAPPING={RepeatWrapping,ClampToEdgeWrapping,MirroredRepeatWrapping},TEXTURE_FILTER={NearestFilter,NearestMipmapNearestFilter,NearestMipmapLinearFilter,LinearFilter,LinearMipmapNearestFilter,LinearMipmapLinearFilter};class ImageBitmapLoader extends Loader$1{constructor(_){super(_),this.isImageBitmapLoader=!0,typeof createImageBitmap>"u"&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch>"u"&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(_){return this.options=_,this}load(_,tt,ot,st){_===void 0&&(_=""),this.path!==void 0&&(_=this.path+_),_=this.manager.resolveURL(_);const at=this,lt=Cache.get(_);if(lt!==void 0)return at.manager.itemStart(_),setTimeout(function(){tt&&tt(lt),at.manager.itemEnd(_)},0),lt;const dt={};dt.credentials=this.crossOrigin==="anonymous"?"same-origin":"include",dt.headers=this.requestHeader,fetch(_,dt).then(function(ht){return ht.blob()}).then(function(ht){return createImageBitmap(ht,Object.assign(at.options,{colorSpaceConversion:"none"}))}).then(function(ht){Cache.add(_,ht),tt&&tt(ht),at.manager.itemEnd(_)}).catch(function(ht){st&&st(ht),at.manager.itemError(_),at.manager.itemEnd(_)}),at.manager.itemStart(_)}}let _context;class AudioContext{static getContext(){return _context===void 0&&(_context=new(window.AudioContext||window.webkitAudioContext)),_context}static setContext(_){_context=_}}class AudioLoader extends Loader$1{constructor(_){super(_)}load(_,tt,ot,st){const at=this,lt=new FileLoader(this.manager);lt.setResponseType("arraybuffer"),lt.setPath(this.path),lt.setRequestHeader(this.requestHeader),lt.setWithCredentials(this.withCredentials),lt.load(_,function(ht){try{const ft=ht.slice(0);AudioContext.getContext().decodeAudioData(ft,function(Et){tt(Et)},dt)}catch(ft){dt(ft)}},ot,st);function dt(ht){st?st(ht):console.error(ht),at.manager.itemError(_)}}}class HemisphereLightProbe extends LightProbe{constructor(_,tt,ot=1){super(void 0,ot),this.isHemisphereLightProbe=!0;const st=new Color$1().set(_),at=new Color$1().set(tt),lt=new Vector3(st.r,st.g,st.b),dt=new Vector3(at.r,at.g,at.b),ht=Math.sqrt(Math.PI),ft=ht*Math.sqrt(.75);this.sh.coefficients[0].copy(lt).add(dt).multiplyScalar(ht),this.sh.coefficients[1].copy(lt).sub(dt).multiplyScalar(ft)}}class AmbientLightProbe extends LightProbe{constructor(_,tt=1){super(void 0,tt),this.isAmbientLightProbe=!0;const ot=new Color$1().set(_);this.sh.coefficients[0].set(ot.r,ot.g,ot.b).multiplyScalar(2*Math.sqrt(Math.PI))}}const _eyeRight=new Matrix4,_eyeLeft=new Matrix4,_projectionMatrix=new Matrix4;class StereoCamera{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new PerspectiveCamera,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new PerspectiveCamera,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(_){const tt=this._cache;if(tt.focus!==_.focus||tt.fov!==_.fov||tt.aspect!==_.aspect*this.aspect||tt.near!==_.near||tt.far!==_.far||tt.zoom!==_.zoom||tt.eyeSep!==this.eyeSep){tt.focus=_.focus,tt.fov=_.fov,tt.aspect=_.aspect*this.aspect,tt.near=_.near,tt.far=_.far,tt.zoom=_.zoom,tt.eyeSep=this.eyeSep,_projectionMatrix.copy(_.projectionMatrix);const st=tt.eyeSep/2,at=st*tt.near/tt.focus,lt=tt.near*Math.tan(DEG2RAD$1*tt.fov*.5)/tt.zoom;let dt,ht;_eyeLeft.elements[12]=-st,_eyeRight.elements[12]=st,dt=-lt*tt.aspect+at,ht=lt*tt.aspect+at,_projectionMatrix.elements[0]=2*tt.near/(ht-dt),_projectionMatrix.elements[8]=(ht+dt)/(ht-dt),this.cameraL.projectionMatrix.copy(_projectionMatrix),dt=-lt*tt.aspect-at,ht=lt*tt.aspect-at,_projectionMatrix.elements[0]=2*tt.near/(ht-dt),_projectionMatrix.elements[8]=(ht+dt)/(ht-dt),this.cameraR.projectionMatrix.copy(_projectionMatrix)}this.cameraL.matrixWorld.copy(_.matrixWorld).multiply(_eyeLeft),this.cameraR.matrixWorld.copy(_.matrixWorld).multiply(_eyeRight)}}class Clock{constructor(_=!0){this.autoStart=_,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=now$2(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let _=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const tt=now$2();_=(tt-this.oldTime)/1e3,this.oldTime=tt,this.elapsedTime+=_}return _}}function now$2(){return(typeof performance>"u"?Date:performance).now()}const _position$1=new Vector3,_quaternion$1=new Quaternion,_scale$1=new Vector3,_orientation$1=new Vector3;class AudioListener extends Object3D{constructor(){super(),this.type="AudioListener",this.context=AudioContext.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new Clock}getInput(){return this.gain}removeFilter(){return this.filter!==null&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(_){return this.filter!==null?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=_,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(_){return this.gain.gain.setTargetAtTime(_,this.context.currentTime,.01),this}updateMatrixWorld(_){super.updateMatrixWorld(_);const tt=this.context.listener,ot=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(_position$1,_quaternion$1,_scale$1),_orientation$1.set(0,0,-1).applyQuaternion(_quaternion$1),tt.positionX){const st=this.context.currentTime+this.timeDelta;tt.positionX.linearRampToValueAtTime(_position$1.x,st),tt.positionY.linearRampToValueAtTime(_position$1.y,st),tt.positionZ.linearRampToValueAtTime(_position$1.z,st),tt.forwardX.linearRampToValueAtTime(_orientation$1.x,st),tt.forwardY.linearRampToValueAtTime(_orientation$1.y,st),tt.forwardZ.linearRampToValueAtTime(_orientation$1.z,st),tt.upX.linearRampToValueAtTime(ot.x,st),tt.upY.linearRampToValueAtTime(ot.y,st),tt.upZ.linearRampToValueAtTime(ot.z,st)}else tt.setPosition(_position$1.x,_position$1.y,_position$1.z),tt.setOrientation(_orientation$1.x,_orientation$1.y,_orientation$1.z,ot.x,ot.y,ot.z)}}let Audio$1=class extends Object3D{constructor(_){super(),this.type="Audio",this.listener=_,this.context=_.context,this.gain=this.context.createGain(),this.gain.connect(_.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(_){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=_,this.connect(),this}setMediaElementSource(_){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(_),this.connect(),this}setMediaStreamSource(_){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(_),this.connect(),this}setBuffer(_){return this.buffer=_,this.sourceType="buffer",this.autoplay&&this.play(),this}play(_=0){if(this.isPlaying===!0){console.warn("THREE.Audio: Audio is already playing.");return}if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}this._startedAt=this.context.currentTime+_;const tt=this.context.createBufferSource();return tt.buffer=this.buffer,tt.loop=this.loop,tt.loopStart=this.loopStart,tt.loopEnd=this.loopEnd,tt.onended=this.onEnded.bind(this),tt.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=tt,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.isPlaying===!0&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,this.loop===!0&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this}stop(){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this._progress=0,this.source!==null&&(this.source.stop(),this.source.onended=null),this.isPlaying=!1,this}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let _=1,tt=this.filters.length;_<tt;_++)this.filters[_-1].connect(this.filters[_]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let _=1,tt=this.filters.length;_<tt;_++)this.filters[_-1].disconnect(this.filters[_]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}getFilters(){return this.filters}setFilters(_){return _||(_=[]),this._connected===!0?(this.disconnect(),this.filters=_.slice(),this.connect()):this.filters=_.slice(),this}setDetune(_){if(this.detune=_,this.source.detune!==void 0)return this.isPlaying===!0&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(_){return this.setFilters(_?[_]:[])}setPlaybackRate(_){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.playbackRate=_,this.isPlaying===!0&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return this.hasPlaybackControl===!1?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(_){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.loop=_,this.isPlaying===!0&&(this.source.loop=this.loop),this}setLoopStart(_){return this.loopStart=_,this}setLoopEnd(_){return this.loopEnd=_,this}getVolume(){return this.gain.gain.value}setVolume(_){return this.gain.gain.setTargetAtTime(_,this.context.currentTime,.01),this}};const _position=new Vector3,_quaternion=new Quaternion,_scale=new Vector3,_orientation=new Vector3;class PositionalAudio extends Audio$1{constructor(_){super(_),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}connect(){super.connect(),this.panner.connect(this.gain)}disconnect(){super.disconnect(),this.panner.disconnect(this.gain)}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(_){return this.panner.refDistance=_,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(_){return this.panner.rolloffFactor=_,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(_){return this.panner.distanceModel=_,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(_){return this.panner.maxDistance=_,this}setDirectionalCone(_,tt,ot){return this.panner.coneInnerAngle=_,this.panner.coneOuterAngle=tt,this.panner.coneOuterGain=ot,this}updateMatrixWorld(_){if(super.updateMatrixWorld(_),this.hasPlaybackControl===!0&&this.isPlaying===!1)return;this.matrixWorld.decompose(_position,_quaternion,_scale),_orientation.set(0,0,1).applyQuaternion(_quaternion);const tt=this.panner;if(tt.positionX){const ot=this.context.currentTime+this.listener.timeDelta;tt.positionX.linearRampToValueAtTime(_position.x,ot),tt.positionY.linearRampToValueAtTime(_position.y,ot),tt.positionZ.linearRampToValueAtTime(_position.z,ot),tt.orientationX.linearRampToValueAtTime(_orientation.x,ot),tt.orientationY.linearRampToValueAtTime(_orientation.y,ot),tt.orientationZ.linearRampToValueAtTime(_orientation.z,ot)}else tt.setPosition(_position.x,_position.y,_position.z),tt.setOrientation(_orientation.x,_orientation.y,_orientation.z)}}class AudioAnalyser{constructor(_,tt=2048){this.analyser=_.context.createAnalyser(),this.analyser.fftSize=tt,this.data=new Uint8Array(this.analyser.frequencyBinCount),_.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let _=0;const tt=this.getFrequencyData();for(let ot=0;ot<tt.length;ot++)_+=tt[ot];return _/tt.length}}class PropertyMixer{constructor(_,tt,ot){this.binding=_,this.valueSize=ot;let st,at,lt;switch(tt){case"quaternion":st=this._slerp,at=this._slerpAdditive,lt=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(ot*6),this._workIndex=5;break;case"string":case"bool":st=this._select,at=this._select,lt=this._setAdditiveIdentityOther,this.buffer=new Array(ot*5);break;default:st=this._lerp,at=this._lerpAdditive,lt=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(ot*5)}this._mixBufferRegion=st,this._mixBufferRegionAdditive=at,this._setIdentity=lt,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(_,tt){const ot=this.buffer,st=this.valueSize,at=_*st+st;let lt=this.cumulativeWeight;if(lt===0){for(let dt=0;dt!==st;++dt)ot[at+dt]=ot[dt];lt=tt}else{lt+=tt;const dt=tt/lt;this._mixBufferRegion(ot,at,0,dt,st)}this.cumulativeWeight=lt}accumulateAdditive(_){const tt=this.buffer,ot=this.valueSize,st=ot*this._addIndex;this.cumulativeWeightAdditive===0&&this._setIdentity(),this._mixBufferRegionAdditive(tt,st,0,_,ot),this.cumulativeWeightAdditive+=_}apply(_){const tt=this.valueSize,ot=this.buffer,st=_*tt+tt,at=this.cumulativeWeight,lt=this.cumulativeWeightAdditive,dt=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,at<1){const ht=tt*this._origIndex;this._mixBufferRegion(ot,st,ht,1-at,tt)}lt>0&&this._mixBufferRegionAdditive(ot,st,this._addIndex*tt,1,tt);for(let ht=tt,ft=tt+tt;ht!==ft;++ht)if(ot[ht]!==ot[ht+tt]){dt.setValue(ot,st);break}}saveOriginalState(){const _=this.binding,tt=this.buffer,ot=this.valueSize,st=ot*this._origIndex;_.getValue(tt,st);for(let at=ot,lt=st;at!==lt;++at)tt[at]=tt[st+at%ot];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const _=this.valueSize*3;this.binding.setValue(this.buffer,_)}_setAdditiveIdentityNumeric(){const _=this._addIndex*this.valueSize,tt=_+this.valueSize;for(let ot=_;ot<tt;ot++)this.buffer[ot]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const _=this._origIndex*this.valueSize,tt=this._addIndex*this.valueSize;for(let ot=0;ot<this.valueSize;ot++)this.buffer[tt+ot]=this.buffer[_+ot]}_select(_,tt,ot,st,at){if(st>=.5)for(let lt=0;lt!==at;++lt)_[tt+lt]=_[ot+lt]}_slerp(_,tt,ot,st){Quaternion.slerpFlat(_,tt,_,tt,_,ot,st)}_slerpAdditive(_,tt,ot,st,at){const lt=this._workIndex*at;Quaternion.multiplyQuaternionsFlat(_,lt,_,tt,_,ot),Quaternion.slerpFlat(_,tt,_,tt,_,lt,st)}_lerp(_,tt,ot,st,at){const lt=1-st;for(let dt=0;dt!==at;++dt){const ht=tt+dt;_[ht]=_[ht]*lt+_[ot+dt]*st}}_lerpAdditive(_,tt,ot,st,at){for(let lt=0;lt!==at;++lt){const dt=tt+lt;_[dt]=_[dt]+_[ot+lt]*st}}}const _RESERVED_CHARS_RE="\\[\\]\\.:\\/",_reservedRe=new RegExp("["+_RESERVED_CHARS_RE+"]","g"),_wordChar="[^"+_RESERVED_CHARS_RE+"]",_wordCharOrDot="[^"+_RESERVED_CHARS_RE.replace("\\.","")+"]",_directoryRe=/((?:WC+[\/:])*)/.source.replace("WC",_wordChar),_nodeRe=/(WCOD+)?/.source.replace("WCOD",_wordCharOrDot),_objectRe=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",_wordChar),_propertyRe=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",_wordChar),_trackRe=new RegExp("^"+_directoryRe+_nodeRe+_objectRe+_propertyRe+"$"),_supportedObjectNames=["material","materials","bones","map"];class Composite{constructor(_,tt,ot){const st=ot||PropertyBinding.parseTrackName(tt);this._targetGroup=_,this._bindings=_.subscribe_(tt,st)}getValue(_,tt){this.bind();const ot=this._targetGroup.nCachedObjects_,st=this._bindings[ot];st!==void 0&&st.getValue(_,tt)}setValue(_,tt){const ot=this._bindings;for(let st=this._targetGroup.nCachedObjects_,at=ot.length;st!==at;++st)ot[st].setValue(_,tt)}bind(){const _=this._bindings;for(let tt=this._targetGroup.nCachedObjects_,ot=_.length;tt!==ot;++tt)_[tt].bind()}unbind(){const _=this._bindings;for(let tt=this._targetGroup.nCachedObjects_,ot=_.length;tt!==ot;++tt)_[tt].unbind()}}class PropertyBinding{constructor(_,tt,ot){this.path=tt,this.parsedPath=ot||PropertyBinding.parseTrackName(tt),this.node=PropertyBinding.findNode(_,this.parsedPath.nodeName),this.rootNode=_,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(_,tt,ot){return _&&_.isAnimationObjectGroup?new PropertyBinding.Composite(_,tt,ot):new PropertyBinding(_,tt,ot)}static sanitizeNodeName(_){return _.replace(/\s/g,"_").replace(_reservedRe,"")}static parseTrackName(_){const tt=_trackRe.exec(_);if(tt===null)throw new Error("PropertyBinding: Cannot parse trackName: "+_);const ot={nodeName:tt[2],objectName:tt[3],objectIndex:tt[4],propertyName:tt[5],propertyIndex:tt[6]},st=ot.nodeName&&ot.nodeName.lastIndexOf(".");if(st!==void 0&&st!==-1){const at=ot.nodeName.substring(st+1);_supportedObjectNames.indexOf(at)!==-1&&(ot.nodeName=ot.nodeName.substring(0,st),ot.objectName=at)}if(ot.propertyName===null||ot.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+_);return ot}static findNode(_,tt){if(tt===void 0||tt===""||tt==="."||tt===-1||tt===_.name||tt===_.uuid)return _;if(_.skeleton){const ot=_.skeleton.getBoneByName(tt);if(ot!==void 0)return ot}if(_.children){const ot=function(at){for(let lt=0;lt<at.length;lt++){const dt=at[lt];if(dt.name===tt||dt.uuid===tt)return dt;const ht=ot(dt.children);if(ht)return ht}return null},st=ot(_.children);if(st)return st}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(_,tt){_[tt]=this.targetObject[this.propertyName]}_getValue_array(_,tt){const ot=this.resolvedProperty;for(let st=0,at=ot.length;st!==at;++st)_[tt++]=ot[st]}_getValue_arrayElement(_,tt){_[tt]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(_,tt){this.resolvedProperty.toArray(_,tt)}_setValue_direct(_,tt){this.targetObject[this.propertyName]=_[tt]}_setValue_direct_setNeedsUpdate(_,tt){this.targetObject[this.propertyName]=_[tt],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(_,tt){this.targetObject[this.propertyName]=_[tt],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(_,tt){const ot=this.resolvedProperty;for(let st=0,at=ot.length;st!==at;++st)ot[st]=_[tt++]}_setValue_array_setNeedsUpdate(_,tt){const ot=this.resolvedProperty;for(let st=0,at=ot.length;st!==at;++st)ot[st]=_[tt++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(_,tt){const ot=this.resolvedProperty;for(let st=0,at=ot.length;st!==at;++st)ot[st]=_[tt++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(_,tt){this.resolvedProperty[this.propertyIndex]=_[tt]}_setValue_arrayElement_setNeedsUpdate(_,tt){this.resolvedProperty[this.propertyIndex]=_[tt],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(_,tt){this.resolvedProperty[this.propertyIndex]=_[tt],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(_,tt){this.resolvedProperty.fromArray(_,tt)}_setValue_fromArray_setNeedsUpdate(_,tt){this.resolvedProperty.fromArray(_,tt),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(_,tt){this.resolvedProperty.fromArray(_,tt),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(_,tt){this.bind(),this.getValue(_,tt)}_setValue_unbound(_,tt){this.bind(),this.setValue(_,tt)}bind(){let _=this.node;const tt=this.parsedPath,ot=tt.objectName,st=tt.propertyName;let at=tt.propertyIndex;if(_||(_=PropertyBinding.findNode(this.rootNode,tt.nodeName),this.node=_),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!_){console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");return}if(ot){let ft=tt.objectIndex;switch(ot){case"materials":if(!_.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!_.material.materials){console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}_=_.material.materials;break;case"bones":if(!_.skeleton){console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}_=_.skeleton.bones;for(let gt=0;gt<_.length;gt++)if(_[gt].name===ft){ft=gt;break}break;case"map":if("map"in _){_=_.map;break}if(!_.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!_.material.map){console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);return}_=_.material.map;break;default:if(_[ot]===void 0){console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);return}_=_[ot]}if(ft!==void 0){if(_[ft]===void 0){console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,_);return}_=_[ft]}}const lt=_[st];if(lt===void 0){const ft=tt.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+ft+"."+st+" but it wasn't found.",_);return}let dt=this.Versioning.None;this.targetObject=_,_.needsUpdate!==void 0?dt=this.Versioning.NeedsUpdate:_.matrixWorldNeedsUpdate!==void 0&&(dt=this.Versioning.MatrixWorldNeedsUpdate);let ht=this.BindingType.Direct;if(at!==void 0){if(st==="morphTargetInfluences"){if(!_.geometry){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(!_.geometry.morphAttributes){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}_.morphTargetDictionary[at]!==void 0&&(at=_.morphTargetDictionary[at])}ht=this.BindingType.ArrayElement,this.resolvedProperty=lt,this.propertyIndex=at}else lt.fromArray!==void 0&&lt.toArray!==void 0?(ht=this.BindingType.HasFromToArray,this.resolvedProperty=lt):Array.isArray(lt)?(ht=this.BindingType.EntireArray,this.resolvedProperty=lt):this.propertyName=st;this.getValue=this.GetterByBindingType[ht],this.setValue=this.SetterByBindingTypeAndVersioning[ht][dt]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}PropertyBinding.Composite=Composite;PropertyBinding.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3};PropertyBinding.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2};PropertyBinding.prototype.GetterByBindingType=[PropertyBinding.prototype._getValue_direct,PropertyBinding.prototype._getValue_array,PropertyBinding.prototype._getValue_arrayElement,PropertyBinding.prototype._getValue_toArray];PropertyBinding.prototype.SetterByBindingTypeAndVersioning=[[PropertyBinding.prototype._setValue_direct,PropertyBinding.prototype._setValue_direct_setNeedsUpdate,PropertyBinding.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[PropertyBinding.prototype._setValue_array,PropertyBinding.prototype._setValue_array_setNeedsUpdate,PropertyBinding.prototype._setValue_array_setMatrixWorldNeedsUpdate],[PropertyBinding.prototype._setValue_arrayElement,PropertyBinding.prototype._setValue_arrayElement_setNeedsUpdate,PropertyBinding.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[PropertyBinding.prototype._setValue_fromArray,PropertyBinding.prototype._setValue_fromArray_setNeedsUpdate,PropertyBinding.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class AnimationObjectGroup{constructor(){this.isAnimationObjectGroup=!0,this.uuid=generateUUID$1(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const _={};this._indicesByUUID=_;for(let ot=0,st=arguments.length;ot!==st;++ot)_[arguments[ot].uuid]=ot;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const tt=this;this.stats={objects:{get total(){return tt._objects.length},get inUse(){return this.total-tt.nCachedObjects_}},get bindingsPerObject(){return tt._bindings.length}}}add(){const _=this._objects,tt=this._indicesByUUID,ot=this._paths,st=this._parsedPaths,at=this._bindings,lt=at.length;let dt,ht=_.length,ft=this.nCachedObjects_;for(let gt=0,Et=arguments.length;gt!==Et;++gt){const yt=arguments[gt],Ct=yt.uuid;let wt=tt[Ct];if(wt===void 0){wt=ht++,tt[Ct]=wt,_.push(yt);for(let It=0,Pt=lt;It!==Pt;++It)at[It].push(new PropertyBinding(yt,ot[It],st[It]))}else if(wt<ft){dt=_[wt];const It=--ft,Pt=_[It];tt[Pt.uuid]=wt,_[wt]=Pt,tt[Ct]=It,_[It]=yt;for(let Rt=0,xt=lt;Rt!==xt;++Rt){const Nt=at[Rt],kt=Nt[It];let Vt=Nt[wt];Nt[wt]=kt,Vt===void 0&&(Vt=new PropertyBinding(yt,ot[Rt],st[Rt])),Nt[It]=Vt}}else _[wt]!==dt&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=ft}remove(){const _=this._objects,tt=this._indicesByUUID,ot=this._bindings,st=ot.length;let at=this.nCachedObjects_;for(let lt=0,dt=arguments.length;lt!==dt;++lt){const ht=arguments[lt],ft=ht.uuid,gt=tt[ft];if(gt!==void 0&&gt>=at){const Et=at++,yt=_[Et];tt[yt.uuid]=gt,_[gt]=yt,tt[ft]=Et,_[Et]=ht;for(let Ct=0,wt=st;Ct!==wt;++Ct){const It=ot[Ct],Pt=It[Et],Rt=It[gt];It[gt]=Pt,It[Et]=Rt}}}this.nCachedObjects_=at}uncache(){const _=this._objects,tt=this._indicesByUUID,ot=this._bindings,st=ot.length;let at=this.nCachedObjects_,lt=_.length;for(let dt=0,ht=arguments.length;dt!==ht;++dt){const ft=arguments[dt],gt=ft.uuid,Et=tt[gt];if(Et!==void 0)if(delete tt[gt],Et<at){const yt=--at,Ct=_[yt],wt=--lt,It=_[wt];tt[Ct.uuid]=Et,_[Et]=Ct,tt[It.uuid]=yt,_[yt]=It,_.pop();for(let Pt=0,Rt=st;Pt!==Rt;++Pt){const xt=ot[Pt],Nt=xt[yt],kt=xt[wt];xt[Et]=Nt,xt[yt]=kt,xt.pop()}}else{const yt=--lt,Ct=_[yt];yt>0&&(tt[Ct.uuid]=Et),_[Et]=Ct,_.pop();for(let wt=0,It=st;wt!==It;++wt){const Pt=ot[wt];Pt[Et]=Pt[yt],Pt.pop()}}}this.nCachedObjects_=at}subscribe_(_,tt){const ot=this._bindingsIndicesByPath;let st=ot[_];const at=this._bindings;if(st!==void 0)return at[st];const lt=this._paths,dt=this._parsedPaths,ht=this._objects,ft=ht.length,gt=this.nCachedObjects_,Et=new Array(ft);st=at.length,ot[_]=st,lt.push(_),dt.push(tt),at.push(Et);for(let yt=gt,Ct=ht.length;yt!==Ct;++yt){const wt=ht[yt];Et[yt]=new PropertyBinding(wt,_,tt)}return Et}unsubscribe_(_){const tt=this._bindingsIndicesByPath,ot=tt[_];if(ot!==void 0){const st=this._paths,at=this._parsedPaths,lt=this._bindings,dt=lt.length-1,ht=lt[dt],ft=_[dt];tt[ft]=ot,lt[ot]=ht,lt.pop(),at[ot]=at[dt],at.pop(),st[ot]=st[dt],st.pop()}}}class AnimationAction{constructor(_,tt,ot=null,st=tt.blendMode){this._mixer=_,this._clip=tt,this._localRoot=ot,this.blendMode=st;const at=tt.tracks,lt=at.length,dt=new Array(lt),ht={endingStart:ZeroCurvatureEnding,endingEnd:ZeroCurvatureEnding};for(let ft=0;ft!==lt;++ft){const gt=at[ft].createInterpolant(null);dt[ft]=gt,gt.settings=ht}this._interpolantSettings=ht,this._interpolants=dt,this._propertyBindings=new Array(lt),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=LoopRepeat,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&this.timeScale!==0&&this._startTime===null&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(_){return this._startTime=_,this}setLoop(_,tt){return this.loop=_,this.repetitions=tt,this}setEffectiveWeight(_){return this.weight=_,this._effectiveWeight=this.enabled?_:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(_){return this._scheduleFading(_,0,1)}fadeOut(_){return this._scheduleFading(_,1,0)}crossFadeFrom(_,tt,ot){if(_.fadeOut(tt),this.fadeIn(tt),ot){const st=this._clip.duration,at=_._clip.duration,lt=at/st,dt=st/at;_.warp(1,lt,tt),this.warp(dt,1,tt)}return this}crossFadeTo(_,tt,ot){return _.crossFadeFrom(this,tt,ot)}stopFading(){const _=this._weightInterpolant;return _!==null&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(_)),this}setEffectiveTimeScale(_){return this.timeScale=_,this._effectiveTimeScale=this.paused?0:_,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(_){return this.timeScale=this._clip.duration/_,this.stopWarping()}syncWith(_){return this.time=_.time,this.timeScale=_.timeScale,this.stopWarping()}halt(_){return this.warp(this._effectiveTimeScale,0,_)}warp(_,tt,ot){const st=this._mixer,at=st.time,lt=this.timeScale;let dt=this._timeScaleInterpolant;dt===null&&(dt=st._lendControlInterpolant(),this._timeScaleInterpolant=dt);const ht=dt.parameterPositions,ft=dt.sampleValues;return ht[0]=at,ht[1]=at+ot,ft[0]=_/lt,ft[1]=tt/lt,this}stopWarping(){const _=this._timeScaleInterpolant;return _!==null&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(_)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(_,tt,ot,st){if(!this.enabled){this._updateWeight(_);return}const at=this._startTime;if(at!==null){const ht=(_-at)*ot;ht<0||ot===0?tt=0:(this._startTime=null,tt=ot*ht)}tt*=this._updateTimeScale(_);const lt=this._updateTime(tt),dt=this._updateWeight(_);if(dt>0){const ht=this._interpolants,ft=this._propertyBindings;switch(this.blendMode){case AdditiveAnimationBlendMode:for(let gt=0,Et=ht.length;gt!==Et;++gt)ht[gt].evaluate(lt),ft[gt].accumulateAdditive(dt);break;case NormalAnimationBlendMode:default:for(let gt=0,Et=ht.length;gt!==Et;++gt)ht[gt].evaluate(lt),ft[gt].accumulate(st,dt)}}}_updateWeight(_){let tt=0;if(this.enabled){tt=this.weight;const ot=this._weightInterpolant;if(ot!==null){const st=ot.evaluate(_)[0];tt*=st,_>ot.parameterPositions[1]&&(this.stopFading(),st===0&&(this.enabled=!1))}}return this._effectiveWeight=tt,tt}_updateTimeScale(_){let tt=0;if(!this.paused){tt=this.timeScale;const ot=this._timeScaleInterpolant;if(ot!==null){const st=ot.evaluate(_)[0];tt*=st,_>ot.parameterPositions[1]&&(this.stopWarping(),tt===0?this.paused=!0:this.timeScale=tt)}}return this._effectiveTimeScale=tt,tt}_updateTime(_){const tt=this._clip.duration,ot=this.loop;let st=this.time+_,at=this._loopCount;const lt=ot===LoopPingPong;if(_===0)return at===-1?st:lt&&(at&1)===1?tt-st:st;if(ot===LoopOnce){at===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(st>=tt)st=tt;else if(st<0)st=0;else{this.time=st;break e}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=st,this._mixer.dispatchEvent({type:"finished",action:this,direction:_<0?-1:1})}}else{if(at===-1&&(_>=0?(at=0,this._setEndings(!0,this.repetitions===0,lt)):this._setEndings(this.repetitions===0,!0,lt)),st>=tt||st<0){const dt=Math.floor(st/tt);st-=tt*dt,at+=Math.abs(dt);const ht=this.repetitions-at;if(ht<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,st=_>0?tt:0,this.time=st,this._mixer.dispatchEvent({type:"finished",action:this,direction:_>0?1:-1});else{if(ht===1){const ft=_<0;this._setEndings(ft,!ft,lt)}else this._setEndings(!1,!1,lt);this._loopCount=at,this.time=st,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:dt})}}else this.time=st;if(lt&&(at&1)===1)return tt-st}return st}_setEndings(_,tt,ot){const st=this._interpolantSettings;ot?(st.endingStart=ZeroSlopeEnding,st.endingEnd=ZeroSlopeEnding):(_?st.endingStart=this.zeroSlopeAtStart?ZeroSlopeEnding:ZeroCurvatureEnding:st.endingStart=WrapAroundEnding,tt?st.endingEnd=this.zeroSlopeAtEnd?ZeroSlopeEnding:ZeroCurvatureEnding:st.endingEnd=WrapAroundEnding)}_scheduleFading(_,tt,ot){const st=this._mixer,at=st.time;let lt=this._weightInterpolant;lt===null&&(lt=st._lendControlInterpolant(),this._weightInterpolant=lt);const dt=lt.parameterPositions,ht=lt.sampleValues;return dt[0]=at,ht[0]=tt,dt[1]=at+_,ht[1]=ot,this}}const _controlInterpolantsResultBuffer=new Float32Array(1);class AnimationMixer extends EventDispatcher$1{constructor(_){super(),this._root=_,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(_,tt){const ot=_._localRoot||this._root,st=_._clip.tracks,at=st.length,lt=_._propertyBindings,dt=_._interpolants,ht=ot.uuid,ft=this._bindingsByRootAndName;let gt=ft[ht];gt===void 0&&(gt={},ft[ht]=gt);for(let Et=0;Et!==at;++Et){const yt=st[Et],Ct=yt.name;let wt=gt[Ct];if(wt!==void 0)++wt.referenceCount,lt[Et]=wt;else{if(wt=lt[Et],wt!==void 0){wt._cacheIndex===null&&(++wt.referenceCount,this._addInactiveBinding(wt,ht,Ct));continue}const It=tt&&tt._propertyBindings[Et].binding.parsedPath;wt=new PropertyMixer(PropertyBinding.create(ot,Ct,It),yt.ValueTypeName,yt.getValueSize()),++wt.referenceCount,this._addInactiveBinding(wt,ht,Ct),lt[Et]=wt}dt[Et].resultBuffer=wt.buffer}}_activateAction(_){if(!this._isActiveAction(_)){if(_._cacheIndex===null){const ot=(_._localRoot||this._root).uuid,st=_._clip.uuid,at=this._actionsByClip[st];this._bindAction(_,at&&at.knownActions[0]),this._addInactiveAction(_,st,ot)}const tt=_._propertyBindings;for(let ot=0,st=tt.length;ot!==st;++ot){const at=tt[ot];at.useCount++===0&&(this._lendBinding(at),at.saveOriginalState())}this._lendAction(_)}}_deactivateAction(_){if(this._isActiveAction(_)){const tt=_._propertyBindings;for(let ot=0,st=tt.length;ot!==st;++ot){const at=tt[ot];--at.useCount===0&&(at.restoreOriginalState(),this._takeBackBinding(at))}this._takeBackAction(_)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const _=this;this.stats={actions:{get total(){return _._actions.length},get inUse(){return _._nActiveActions}},bindings:{get total(){return _._bindings.length},get inUse(){return _._nActiveBindings}},controlInterpolants:{get total(){return _._controlInterpolants.length},get inUse(){return _._nActiveControlInterpolants}}}}_isActiveAction(_){const tt=_._cacheIndex;return tt!==null&&tt<this._nActiveActions}_addInactiveAction(_,tt,ot){const st=this._actions,at=this._actionsByClip;let lt=at[tt];if(lt===void 0)lt={knownActions:[_],actionByRoot:{}},_._byClipCacheIndex=0,at[tt]=lt;else{const dt=lt.knownActions;_._byClipCacheIndex=dt.length,dt.push(_)}_._cacheIndex=st.length,st.push(_),lt.actionByRoot[ot]=_}_removeInactiveAction(_){const tt=this._actions,ot=tt[tt.length-1],st=_._cacheIndex;ot._cacheIndex=st,tt[st]=ot,tt.pop(),_._cacheIndex=null;const at=_._clip.uuid,lt=this._actionsByClip,dt=lt[at],ht=dt.knownActions,ft=ht[ht.length-1],gt=_._byClipCacheIndex;ft._byClipCacheIndex=gt,ht[gt]=ft,ht.pop(),_._byClipCacheIndex=null;const Et=dt.actionByRoot,yt=(_._localRoot||this._root).uuid;delete Et[yt],ht.length===0&&delete lt[at],this._removeInactiveBindingsForAction(_)}_removeInactiveBindingsForAction(_){const tt=_._propertyBindings;for(let ot=0,st=tt.length;ot!==st;++ot){const at=tt[ot];--at.referenceCount===0&&this._removeInactiveBinding(at)}}_lendAction(_){const tt=this._actions,ot=_._cacheIndex,st=this._nActiveActions++,at=tt[st];_._cacheIndex=st,tt[st]=_,at._cacheIndex=ot,tt[ot]=at}_takeBackAction(_){const tt=this._actions,ot=_._cacheIndex,st=--this._nActiveActions,at=tt[st];_._cacheIndex=st,tt[st]=_,at._cacheIndex=ot,tt[ot]=at}_addInactiveBinding(_,tt,ot){const st=this._bindingsByRootAndName,at=this._bindings;let lt=st[tt];lt===void 0&&(lt={},st[tt]=lt),lt[ot]=_,_._cacheIndex=at.length,at.push(_)}_removeInactiveBinding(_){const tt=this._bindings,ot=_.binding,st=ot.rootNode.uuid,at=ot.path,lt=this._bindingsByRootAndName,dt=lt[st],ht=tt[tt.length-1],ft=_._cacheIndex;ht._cacheIndex=ft,tt[ft]=ht,tt.pop(),delete dt[at],Object.keys(dt).length===0&&delete lt[st]}_lendBinding(_){const tt=this._bindings,ot=_._cacheIndex,st=this._nActiveBindings++,at=tt[st];_._cacheIndex=st,tt[st]=_,at._cacheIndex=ot,tt[ot]=at}_takeBackBinding(_){const tt=this._bindings,ot=_._cacheIndex,st=--this._nActiveBindings,at=tt[st];_._cacheIndex=st,tt[st]=_,at._cacheIndex=ot,tt[ot]=at}_lendControlInterpolant(){const _=this._controlInterpolants,tt=this._nActiveControlInterpolants++;let ot=_[tt];return ot===void 0&&(ot=new LinearInterpolant(new Float32Array(2),new Float32Array(2),1,_controlInterpolantsResultBuffer),ot.__cacheIndex=tt,_[tt]=ot),ot}_takeBackControlInterpolant(_){const tt=this._controlInterpolants,ot=_.__cacheIndex,st=--this._nActiveControlInterpolants,at=tt[st];_.__cacheIndex=st,tt[st]=_,at.__cacheIndex=ot,tt[ot]=at}clipAction(_,tt,ot){const st=tt||this._root,at=st.uuid;let lt=typeof _=="string"?AnimationClip.findByName(st,_):_;const dt=lt!==null?lt.uuid:_,ht=this._actionsByClip[dt];let ft=null;if(ot===void 0&&(lt!==null?ot=lt.blendMode:ot=NormalAnimationBlendMode),ht!==void 0){const Et=ht.actionByRoot[at];if(Et!==void 0&&Et.blendMode===ot)return Et;ft=ht.knownActions[0],lt===null&&(lt=ft._clip)}if(lt===null)return null;const gt=new AnimationAction(this,lt,tt,ot);return this._bindAction(gt,ft),this._addInactiveAction(gt,dt,at),gt}existingAction(_,tt){const ot=tt||this._root,st=ot.uuid,at=typeof _=="string"?AnimationClip.findByName(ot,_):_,lt=at?at.uuid:_,dt=this._actionsByClip[lt];return dt!==void 0&&dt.actionByRoot[st]||null}stopAllAction(){const _=this._actions,tt=this._nActiveActions;for(let ot=tt-1;ot>=0;--ot)_[ot].stop();return this}update(_){_*=this.timeScale;const tt=this._actions,ot=this._nActiveActions,st=this.time+=_,at=Math.sign(_),lt=this._accuIndex^=1;for(let ft=0;ft!==ot;++ft)tt[ft]._update(st,_,at,lt);const dt=this._bindings,ht=this._nActiveBindings;for(let ft=0;ft!==ht;++ft)dt[ft].apply(lt);return this}setTime(_){this.time=0;for(let tt=0;tt<this._actions.length;tt++)this._actions[tt].time=0;return this.update(_)}getRoot(){return this._root}uncacheClip(_){const tt=this._actions,ot=_.uuid,st=this._actionsByClip,at=st[ot];if(at!==void 0){const lt=at.knownActions;for(let dt=0,ht=lt.length;dt!==ht;++dt){const ft=lt[dt];this._deactivateAction(ft);const gt=ft._cacheIndex,Et=tt[tt.length-1];ft._cacheIndex=null,ft._byClipCacheIndex=null,Et._cacheIndex=gt,tt[gt]=Et,tt.pop(),this._removeInactiveBindingsForAction(ft)}delete st[ot]}}uncacheRoot(_){const tt=_.uuid,ot=this._actionsByClip;for(const lt in ot){const dt=ot[lt].actionByRoot,ht=dt[tt];ht!==void 0&&(this._deactivateAction(ht),this._removeInactiveAction(ht))}const st=this._bindingsByRootAndName,at=st[tt];if(at!==void 0)for(const lt in at){const dt=at[lt];dt.restoreOriginalState(),this._removeInactiveBinding(dt)}}uncacheAction(_,tt){const ot=this.existingAction(_,tt);ot!==null&&(this._deactivateAction(ot),this._removeInactiveAction(ot))}}class Uniform{constructor(_){this.value=_}clone(){return new Uniform(this.value.clone===void 0?this.value:this.value.clone())}}let id=0;class UniformsGroup extends EventDispatcher$1{constructor(){super(),this.isUniformsGroup=!0,Object.defineProperty(this,"id",{value:id++}),this.name="",this.usage=StaticDrawUsage,this.uniforms=[]}add(_){return this.uniforms.push(_),this}remove(_){const tt=this.uniforms.indexOf(_);return tt!==-1&&this.uniforms.splice(tt,1),this}setName(_){return this.name=_,this}setUsage(_){return this.usage=_,this}dispose(){return this.dispatchEvent({type:"dispose"}),this}copy(_){this.name=_.name,this.usage=_.usage;const tt=_.uniforms;this.uniforms.length=0;for(let ot=0,st=tt.length;ot<st;ot++)this.uniforms.push(tt[ot].clone());return this}clone(){return new this.constructor().copy(this)}}class InstancedInterleavedBuffer extends InterleavedBuffer{constructor(_,tt,ot=1){super(_,tt),this.isInstancedInterleavedBuffer=!0,this.meshPerAttribute=ot}copy(_){return super.copy(_),this.meshPerAttribute=_.meshPerAttribute,this}clone(_){const tt=super.clone(_);return tt.meshPerAttribute=this.meshPerAttribute,tt}toJSON(_){const tt=super.toJSON(_);return tt.isInstancedInterleavedBuffer=!0,tt.meshPerAttribute=this.meshPerAttribute,tt}}class GLBufferAttribute{constructor(_,tt,ot,st,at){this.isGLBufferAttribute=!0,this.name="",this.buffer=_,this.type=tt,this.itemSize=ot,this.elementSize=st,this.count=at,this.version=0}set needsUpdate(_){_===!0&&this.version++}setBuffer(_){return this.buffer=_,this}setType(_,tt){return this.type=_,this.elementSize=tt,this}setItemSize(_){return this.itemSize=_,this}setCount(_){return this.count=_,this}}class Raycaster{constructor(_,tt,ot=0,st=1/0){this.ray=new Ray(_,tt),this.near=ot,this.far=st,this.camera=null,this.layers=new Layers,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(_,tt){this.ray.set(_,tt)}setFromCamera(_,tt){tt.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(tt.matrixWorld),this.ray.direction.set(_.x,_.y,.5).unproject(tt).sub(this.ray.origin).normalize(),this.camera=tt):tt.isOrthographicCamera?(this.ray.origin.set(_.x,_.y,(tt.near+tt.far)/(tt.near-tt.far)).unproject(tt),this.ray.direction.set(0,0,-1).transformDirection(tt.matrixWorld),this.camera=tt):console.error("THREE.Raycaster: Unsupported camera type: "+tt.type)}intersectObject(_,tt=!0,ot=[]){return intersectObject(_,this,ot,tt),ot.sort(ascSort),ot}intersectObjects(_,tt=!0,ot=[]){for(let st=0,at=_.length;st<at;st++)intersectObject(_[st],this,ot,tt);return ot.sort(ascSort),ot}}function ascSort(nt,_){return nt.distance-_.distance}function intersectObject(nt,_,tt,ot){if(nt.layers.test(_.layers)&&nt.raycast(_,tt),ot===!0){const st=nt.children;for(let at=0,lt=st.length;at<lt;at++)intersectObject(st[at],_,tt,!0)}}class Spherical{constructor(_=1,tt=0,ot=0){return this.radius=_,this.phi=tt,this.theta=ot,this}set(_,tt,ot){return this.radius=_,this.phi=tt,this.theta=ot,this}copy(_){return this.radius=_.radius,this.phi=_.phi,this.theta=_.theta,this}makeSafe(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}setFromVector3(_){return this.setFromCartesianCoords(_.x,_.y,_.z)}setFromCartesianCoords(_,tt,ot){return this.radius=Math.sqrt(_*_+tt*tt+ot*ot),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(_,ot),this.phi=Math.acos(clamp$3(tt/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}}class Cylindrical{constructor(_=1,tt=0,ot=0){return this.radius=_,this.theta=tt,this.y=ot,this}set(_,tt,ot){return this.radius=_,this.theta=tt,this.y=ot,this}copy(_){return this.radius=_.radius,this.theta=_.theta,this.y=_.y,this}setFromVector3(_){return this.setFromCartesianCoords(_.x,_.y,_.z)}setFromCartesianCoords(_,tt,ot){return this.radius=Math.sqrt(_*_+ot*ot),this.theta=Math.atan2(_,ot),this.y=tt,this}clone(){return new this.constructor().copy(this)}}const _vector$4=new Vector2;class Box2{constructor(_=new Vector2(1/0,1/0),tt=new Vector2(-1/0,-1/0)){this.isBox2=!0,this.min=_,this.max=tt}set(_,tt){return this.min.copy(_),this.max.copy(tt),this}setFromPoints(_){this.makeEmpty();for(let tt=0,ot=_.length;tt<ot;tt++)this.expandByPoint(_[tt]);return this}setFromCenterAndSize(_,tt){const ot=_vector$4.copy(tt).multiplyScalar(.5);return this.min.copy(_).sub(ot),this.max.copy(_).add(ot),this}clone(){return new this.constructor().copy(this)}copy(_){return this.min.copy(_.min),this.max.copy(_.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(_){return this.isEmpty()?_.set(0,0):_.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(_){return this.isEmpty()?_.set(0,0):_.subVectors(this.max,this.min)}expandByPoint(_){return this.min.min(_),this.max.max(_),this}expandByVector(_){return this.min.sub(_),this.max.add(_),this}expandByScalar(_){return this.min.addScalar(-_),this.max.addScalar(_),this}containsPoint(_){return!(_.x<this.min.x||_.x>this.max.x||_.y<this.min.y||_.y>this.max.y)}containsBox(_){return this.min.x<=_.min.x&&_.max.x<=this.max.x&&this.min.y<=_.min.y&&_.max.y<=this.max.y}getParameter(_,tt){return tt.set((_.x-this.min.x)/(this.max.x-this.min.x),(_.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(_){return!(_.max.x<this.min.x||_.min.x>this.max.x||_.max.y<this.min.y||_.min.y>this.max.y)}clampPoint(_,tt){return tt.copy(_).clamp(this.min,this.max)}distanceToPoint(_){return this.clampPoint(_,_vector$4).distanceTo(_)}intersect(_){return this.min.max(_.min),this.max.min(_.max),this.isEmpty()&&this.makeEmpty(),this}union(_){return this.min.min(_.min),this.max.max(_.max),this}translate(_){return this.min.add(_),this.max.add(_),this}equals(_){return _.min.equals(this.min)&&_.max.equals(this.max)}}const _startP=new Vector3,_startEnd=new Vector3;class Line3{constructor(_=new Vector3,tt=new Vector3){this.start=_,this.end=tt}set(_,tt){return this.start.copy(_),this.end.copy(tt),this}copy(_){return this.start.copy(_.start),this.end.copy(_.end),this}getCenter(_){return _.addVectors(this.start,this.end).multiplyScalar(.5)}delta(_){return _.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(_,tt){return this.delta(tt).multiplyScalar(_).add(this.start)}closestPointToPointParameter(_,tt){_startP.subVectors(_,this.start),_startEnd.subVectors(this.end,this.start);const ot=_startEnd.dot(_startEnd);let at=_startEnd.dot(_startP)/ot;return tt&&(at=clamp$3(at,0,1)),at}closestPointToPoint(_,tt,ot){const st=this.closestPointToPointParameter(_,tt);return this.delta(ot).multiplyScalar(st).add(this.start)}applyMatrix4(_){return this.start.applyMatrix4(_),this.end.applyMatrix4(_),this}equals(_){return _.start.equals(this.start)&&_.end.equals(this.end)}clone(){return new this.constructor().copy(this)}}const _vector$3=new Vector3;class SpotLightHelper extends Object3D{constructor(_,tt){super(),this.light=_,this.matrix=_.matrixWorld,this.matrixAutoUpdate=!1,this.color=tt,this.type="SpotLightHelper";const ot=new BufferGeometry,st=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let lt=0,dt=1,ht=32;lt<ht;lt++,dt++){const ft=lt/ht*Math.PI*2,gt=dt/ht*Math.PI*2;st.push(Math.cos(ft),Math.sin(ft),1,Math.cos(gt),Math.sin(gt),1)}ot.setAttribute("position",new Float32BufferAttribute(st,3));const at=new LineBasicMaterial({fog:!1,toneMapped:!1});this.cone=new LineSegments(ot,at),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1);const _=this.light.distance?this.light.distance:1e3,tt=_*Math.tan(this.light.angle);this.cone.scale.set(tt,tt,_),_vector$3.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(_vector$3),this.color!==void 0?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}const _vector$2=new Vector3,_boneMatrix=new Matrix4,_matrixWorldInv=new Matrix4;class SkeletonHelper extends LineSegments{constructor(_){const tt=getBoneList(_),ot=new BufferGeometry,st=[],at=[],lt=new Color$1(0,0,1),dt=new Color$1(0,1,0);for(let ft=0;ft<tt.length;ft++){const gt=tt[ft];gt.parent&&gt.parent.isBone&&(st.push(0,0,0),st.push(0,0,0),at.push(lt.r,lt.g,lt.b),at.push(dt.r,dt.g,dt.b))}ot.setAttribute("position",new Float32BufferAttribute(st,3)),ot.setAttribute("color",new Float32BufferAttribute(at,3));const ht=new LineBasicMaterial({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0});super(ot,ht),this.isSkeletonHelper=!0,this.type="SkeletonHelper",this.root=_,this.bones=tt,this.matrix=_.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(_){const tt=this.bones,ot=this.geometry,st=ot.getAttribute("position");_matrixWorldInv.copy(this.root.matrixWorld).invert();for(let at=0,lt=0;at<tt.length;at++){const dt=tt[at];dt.parent&&dt.parent.isBone&&(_boneMatrix.multiplyMatrices(_matrixWorldInv,dt.matrixWorld),_vector$2.setFromMatrixPosition(_boneMatrix),st.setXYZ(lt,_vector$2.x,_vector$2.y,_vector$2.z),_boneMatrix.multiplyMatrices(_matrixWorldInv,dt.parent.matrixWorld),_vector$2.setFromMatrixPosition(_boneMatrix),st.setXYZ(lt+1,_vector$2.x,_vector$2.y,_vector$2.z),lt+=2)}ot.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(_)}dispose(){this.geometry.dispose(),this.material.dispose()}}function getBoneList(nt){const _=[];nt.isBone===!0&&_.push(nt);for(let tt=0;tt<nt.children.length;tt++)_.push.apply(_,getBoneList(nt.children[tt]));return _}class PointLightHelper extends Mesh{constructor(_,tt,ot){const st=new SphereGeometry(tt,4,2),at=new MeshBasicMaterial({wireframe:!0,fog:!1,toneMapped:!1});super(st,at),this.light=_,this.color=ot,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.color!==void 0?this.material.color.set(this.color):this.material.color.copy(this.light.color)}}const _vector$1=new Vector3,_color1=new Color$1,_color2=new Color$1;class HemisphereLightHelper extends Object3D{constructor(_,tt,ot){super(),this.light=_,this.matrix=_.matrixWorld,this.matrixAutoUpdate=!1,this.color=ot,this.type="HemisphereLightHelper";const st=new OctahedronGeometry(tt);st.rotateY(Math.PI*.5),this.material=new MeshBasicMaterial({wireframe:!0,fog:!1,toneMapped:!1}),this.color===void 0&&(this.material.vertexColors=!0);const at=st.getAttribute("position"),lt=new Float32Array(at.count*3);st.setAttribute("color",new BufferAttribute(lt,3)),this.add(new Mesh(st,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){const _=this.children[0];if(this.color!==void 0)this.material.color.set(this.color);else{const tt=_.geometry.getAttribute("color");_color1.copy(this.light.color),_color2.copy(this.light.groundColor);for(let ot=0,st=tt.count;ot<st;ot++){const at=ot<st/2?_color1:_color2;tt.setXYZ(ot,at.r,at.g,at.b)}tt.needsUpdate=!0}this.light.updateWorldMatrix(!0,!1),_.lookAt(_vector$1.setFromMatrixPosition(this.light.matrixWorld).negate())}}class GridHelper extends LineSegments{constructor(_=10,tt=10,ot=4473924,st=8947848){ot=new Color$1(ot),st=new Color$1(st);const at=tt/2,lt=_/tt,dt=_/2,ht=[],ft=[];for(let yt=0,Ct=0,wt=-dt;yt<=tt;yt++,wt+=lt){ht.push(-dt,0,wt,dt,0,wt),ht.push(wt,0,-dt,wt,0,dt);const It=yt===at?ot:st;It.toArray(ft,Ct),Ct+=3,It.toArray(ft,Ct),Ct+=3,It.toArray(ft,Ct),Ct+=3,It.toArray(ft,Ct),Ct+=3}const gt=new BufferGeometry;gt.setAttribute("position",new Float32BufferAttribute(ht,3)),gt.setAttribute("color",new Float32BufferAttribute(ft,3));const Et=new LineBasicMaterial({vertexColors:!0,toneMapped:!1});super(gt,Et),this.type="GridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}class PolarGridHelper extends LineSegments{constructor(_=10,tt=16,ot=8,st=64,at=4473924,lt=8947848){at=new Color$1(at),lt=new Color$1(lt);const dt=[],ht=[];if(tt>1)for(let Et=0;Et<tt;Et++){const yt=Et/tt*(Math.PI*2),Ct=Math.sin(yt)*_,wt=Math.cos(yt)*_;dt.push(0,0,0),dt.push(Ct,0,wt);const It=Et&1?at:lt;ht.push(It.r,It.g,It.b),ht.push(It.r,It.g,It.b)}for(let Et=0;Et<ot;Et++){const yt=Et&1?at:lt,Ct=_-_/ot*Et;for(let wt=0;wt<st;wt++){let It=wt/st*(Math.PI*2),Pt=Math.sin(It)*Ct,Rt=Math.cos(It)*Ct;dt.push(Pt,0,Rt),ht.push(yt.r,yt.g,yt.b),It=(wt+1)/st*(Math.PI*2),Pt=Math.sin(It)*Ct,Rt=Math.cos(It)*Ct,dt.push(Pt,0,Rt),ht.push(yt.r,yt.g,yt.b)}}const ft=new BufferGeometry;ft.setAttribute("position",new Float32BufferAttribute(dt,3)),ft.setAttribute("color",new Float32BufferAttribute(ht,3));const gt=new LineBasicMaterial({vertexColors:!0,toneMapped:!1});super(ft,gt),this.type="PolarGridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}const _v1=new Vector3,_v2$5=new Vector3,_v3=new Vector3;class DirectionalLightHelper extends Object3D{constructor(_,tt,ot){super(),this.light=_,this.matrix=_.matrixWorld,this.matrixAutoUpdate=!1,this.color=ot,this.type="DirectionalLightHelper",tt===void 0&&(tt=1);let st=new BufferGeometry;st.setAttribute("position",new Float32BufferAttribute([-tt,tt,0,tt,tt,0,tt,-tt,0,-tt,-tt,0,-tt,tt,0],3));const at=new LineBasicMaterial({fog:!1,toneMapped:!1});this.lightPlane=new Line(st,at),this.add(this.lightPlane),st=new BufferGeometry,st.setAttribute("position",new Float32BufferAttribute([0,0,0,0,0,1],3)),this.targetLine=new Line(st,at),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),_v1.setFromMatrixPosition(this.light.matrixWorld),_v2$5.setFromMatrixPosition(this.light.target.matrixWorld),_v3.subVectors(_v2$5,_v1),this.lightPlane.lookAt(_v2$5),this.color!==void 0?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(_v2$5),this.targetLine.scale.z=_v3.length()}}const _vector=new Vector3,_camera=new Camera;class CameraHelper extends LineSegments{constructor(_){const tt=new BufferGeometry,ot=new LineBasicMaterial({color:16777215,vertexColors:!0,toneMapped:!1}),st=[],at=[],lt={};dt("n1","n2"),dt("n2","n4"),dt("n4","n3"),dt("n3","n1"),dt("f1","f2"),dt("f2","f4"),dt("f4","f3"),dt("f3","f1"),dt("n1","f1"),dt("n2","f2"),dt("n3","f3"),dt("n4","f4"),dt("p","n1"),dt("p","n2"),dt("p","n3"),dt("p","n4"),dt("u1","u2"),dt("u2","u3"),dt("u3","u1"),dt("c","t"),dt("p","c"),dt("cn1","cn2"),dt("cn3","cn4"),dt("cf1","cf2"),dt("cf3","cf4");function dt(wt,It){ht(wt),ht(It)}function ht(wt){st.push(0,0,0),at.push(0,0,0),lt[wt]===void 0&&(lt[wt]=[]),lt[wt].push(st.length/3-1)}tt.setAttribute("position",new Float32BufferAttribute(st,3)),tt.setAttribute("color",new Float32BufferAttribute(at,3)),super(tt,ot),this.type="CameraHelper",this.camera=_,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=_.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=lt,this.update();const ft=new Color$1(16755200),gt=new Color$1(16711680),Et=new Color$1(43775),yt=new Color$1(16777215),Ct=new Color$1(3355443);this.setColors(ft,gt,Et,yt,Ct)}setColors(_,tt,ot,st,at){const dt=this.geometry.getAttribute("color");dt.setXYZ(0,_.r,_.g,_.b),dt.setXYZ(1,_.r,_.g,_.b),dt.setXYZ(2,_.r,_.g,_.b),dt.setXYZ(3,_.r,_.g,_.b),dt.setXYZ(4,_.r,_.g,_.b),dt.setXYZ(5,_.r,_.g,_.b),dt.setXYZ(6,_.r,_.g,_.b),dt.setXYZ(7,_.r,_.g,_.b),dt.setXYZ(8,_.r,_.g,_.b),dt.setXYZ(9,_.r,_.g,_.b),dt.setXYZ(10,_.r,_.g,_.b),dt.setXYZ(11,_.r,_.g,_.b),dt.setXYZ(12,_.r,_.g,_.b),dt.setXYZ(13,_.r,_.g,_.b),dt.setXYZ(14,_.r,_.g,_.b),dt.setXYZ(15,_.r,_.g,_.b),dt.setXYZ(16,_.r,_.g,_.b),dt.setXYZ(17,_.r,_.g,_.b),dt.setXYZ(18,_.r,_.g,_.b),dt.setXYZ(19,_.r,_.g,_.b),dt.setXYZ(20,_.r,_.g,_.b),dt.setXYZ(21,_.r,_.g,_.b),dt.setXYZ(22,_.r,_.g,_.b),dt.setXYZ(23,_.r,_.g,_.b),dt.setXYZ(24,tt.r,tt.g,tt.b),dt.setXYZ(25,tt.r,tt.g,tt.b),dt.setXYZ(26,tt.r,tt.g,tt.b),dt.setXYZ(27,tt.r,tt.g,tt.b),dt.setXYZ(28,tt.r,tt.g,tt.b),dt.setXYZ(29,tt.r,tt.g,tt.b),dt.setXYZ(30,tt.r,tt.g,tt.b),dt.setXYZ(31,tt.r,tt.g,tt.b),dt.setXYZ(32,ot.r,ot.g,ot.b),dt.setXYZ(33,ot.r,ot.g,ot.b),dt.setXYZ(34,ot.r,ot.g,ot.b),dt.setXYZ(35,ot.r,ot.g,ot.b),dt.setXYZ(36,ot.r,ot.g,ot.b),dt.setXYZ(37,ot.r,ot.g,ot.b),dt.setXYZ(38,st.r,st.g,st.b),dt.setXYZ(39,st.r,st.g,st.b),dt.setXYZ(40,at.r,at.g,at.b),dt.setXYZ(41,at.r,at.g,at.b),dt.setXYZ(42,at.r,at.g,at.b),dt.setXYZ(43,at.r,at.g,at.b),dt.setXYZ(44,at.r,at.g,at.b),dt.setXYZ(45,at.r,at.g,at.b),dt.setXYZ(46,at.r,at.g,at.b),dt.setXYZ(47,at.r,at.g,at.b),dt.setXYZ(48,at.r,at.g,at.b),dt.setXYZ(49,at.r,at.g,at.b),dt.needsUpdate=!0}update(){const _=this.geometry,tt=this.pointMap,ot=1,st=1;_camera.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),setPoint("c",tt,_,_camera,0,0,-1),setPoint("t",tt,_,_camera,0,0,1),setPoint("n1",tt,_,_camera,-ot,-st,-1),setPoint("n2",tt,_,_camera,ot,-st,-1),setPoint("n3",tt,_,_camera,-ot,st,-1),setPoint("n4",tt,_,_camera,ot,st,-1),setPoint("f1",tt,_,_camera,-ot,-st,1),setPoint("f2",tt,_,_camera,ot,-st,1),setPoint("f3",tt,_,_camera,-ot,st,1),setPoint("f4",tt,_,_camera,ot,st,1),setPoint("u1",tt,_,_camera,ot*.7,st*1.1,-1),setPoint("u2",tt,_,_camera,-ot*.7,st*1.1,-1),setPoint("u3",tt,_,_camera,0,st*2,-1),setPoint("cf1",tt,_,_camera,-ot,0,1),setPoint("cf2",tt,_,_camera,ot,0,1),setPoint("cf3",tt,_,_camera,0,-st,1),setPoint("cf4",tt,_,_camera,0,st,1),setPoint("cn1",tt,_,_camera,-ot,0,-1),setPoint("cn2",tt,_,_camera,ot,0,-1),setPoint("cn3",tt,_,_camera,0,-st,-1),setPoint("cn4",tt,_,_camera,0,st,-1),_.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}}function setPoint(nt,_,tt,ot,st,at,lt){_vector.set(st,at,lt).unproject(ot);const dt=_[nt];if(dt!==void 0){const ht=tt.getAttribute("position");for(let ft=0,gt=dt.length;ft<gt;ft++)ht.setXYZ(dt[ft],_vector.x,_vector.y,_vector.z)}}const _box=new Box3;class BoxHelper extends LineSegments{constructor(_,tt=16776960){const ot=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),st=new Float32Array(8*3),at=new BufferGeometry;at.setIndex(new BufferAttribute(ot,1)),at.setAttribute("position",new BufferAttribute(st,3)),super(at,new LineBasicMaterial({color:tt,toneMapped:!1})),this.object=_,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(_){if(_!==void 0&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),this.object!==void 0&&_box.setFromObject(this.object),_box.isEmpty())return;const tt=_box.min,ot=_box.max,st=this.geometry.attributes.position,at=st.array;at[0]=ot.x,at[1]=ot.y,at[2]=ot.z,at[3]=tt.x,at[4]=ot.y,at[5]=ot.z,at[6]=tt.x,at[7]=tt.y,at[8]=ot.z,at[9]=ot.x,at[10]=tt.y,at[11]=ot.z,at[12]=ot.x,at[13]=ot.y,at[14]=tt.z,at[15]=tt.x,at[16]=ot.y,at[17]=tt.z,at[18]=tt.x,at[19]=tt.y,at[20]=tt.z,at[21]=ot.x,at[22]=tt.y,at[23]=tt.z,st.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(_){return this.object=_,this.update(),this}copy(_,tt){return super.copy(_,tt),this.object=_.object,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class Box3Helper extends LineSegments{constructor(_,tt=16776960){const ot=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),st=[1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],at=new BufferGeometry;at.setIndex(new BufferAttribute(ot,1)),at.setAttribute("position",new Float32BufferAttribute(st,3)),super(at,new LineBasicMaterial({color:tt,toneMapped:!1})),this.box=_,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(_){const tt=this.box;tt.isEmpty()||(tt.getCenter(this.position),tt.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(_))}dispose(){this.geometry.dispose(),this.material.dispose()}}class PlaneHelper extends Line{constructor(_,tt=1,ot=16776960){const st=ot,at=[1,-1,0,-1,1,0,-1,-1,0,1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0],lt=new BufferGeometry;lt.setAttribute("position",new Float32BufferAttribute(at,3)),lt.computeBoundingSphere(),super(lt,new LineBasicMaterial({color:st,toneMapped:!1})),this.type="PlaneHelper",this.plane=_,this.size=tt;const dt=[1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0],ht=new BufferGeometry;ht.setAttribute("position",new Float32BufferAttribute(dt,3)),ht.computeBoundingSphere(),this.add(new Mesh(ht,new MeshBasicMaterial({color:st,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(_){this.position.set(0,0,0),this.scale.set(.5*this.size,.5*this.size,1),this.lookAt(this.plane.normal),this.translateZ(-this.plane.constant),super.updateMatrixWorld(_)}dispose(){this.geometry.dispose(),this.material.dispose(),this.children[0].geometry.dispose(),this.children[0].material.dispose()}}const _axis=new Vector3;let _lineGeometry,_coneGeometry;class ArrowHelper extends Object3D{constructor(_=new Vector3(0,0,1),tt=new Vector3(0,0,0),ot=1,st=16776960,at=ot*.2,lt=at*.2){super(),this.type="ArrowHelper",_lineGeometry===void 0&&(_lineGeometry=new BufferGeometry,_lineGeometry.setAttribute("position",new Float32BufferAttribute([0,0,0,0,1,0],3)),_coneGeometry=new CylinderGeometry(0,.5,1,5,1),_coneGeometry.translate(0,-.5,0)),this.position.copy(tt),this.line=new Line(_lineGeometry,new LineBasicMaterial({color:st,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new Mesh(_coneGeometry,new MeshBasicMaterial({color:st,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(_),this.setLength(ot,at,lt)}setDirection(_){if(_.y>.99999)this.quaternion.set(0,0,0,1);else if(_.y<-.99999)this.quaternion.set(1,0,0,0);else{_axis.set(_.z,0,-_.x).normalize();const tt=Math.acos(_.y);this.quaternion.setFromAxisAngle(_axis,tt)}}setLength(_,tt=_*.2,ot=tt*.2){this.line.scale.set(1,Math.max(1e-4,_-tt),1),this.line.updateMatrix(),this.cone.scale.set(ot,tt,ot),this.cone.position.y=_,this.cone.updateMatrix()}setColor(_){this.line.material.color.set(_),this.cone.material.color.set(_)}copy(_){return super.copy(_,!1),this.line.copy(_.line),this.cone.copy(_.cone),this}dispose(){this.line.geometry.dispose(),this.line.material.dispose(),this.cone.geometry.dispose(),this.cone.material.dispose()}}class AxesHelper extends LineSegments{constructor(_=1){const tt=[0,0,0,_,0,0,0,0,0,0,_,0,0,0,0,0,0,_],ot=[1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],st=new BufferGeometry;st.setAttribute("position",new Float32BufferAttribute(tt,3)),st.setAttribute("color",new Float32BufferAttribute(ot,3));const at=new LineBasicMaterial({vertexColors:!0,toneMapped:!1});super(st,at),this.type="AxesHelper"}setColors(_,tt,ot){const st=new Color$1,at=this.geometry.attributes.color.array;return st.set(_),st.toArray(at,0),st.toArray(at,3),st.set(tt),st.toArray(at,6),st.toArray(at,9),st.set(ot),st.toArray(at,12),st.toArray(at,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class ShapePath{constructor(){this.type="ShapePath",this.color=new Color$1,this.subPaths=[],this.currentPath=null}moveTo(_,tt){return this.currentPath=new Path,this.subPaths.push(this.currentPath),this.currentPath.moveTo(_,tt),this}lineTo(_,tt){return this.currentPath.lineTo(_,tt),this}quadraticCurveTo(_,tt,ot,st){return this.currentPath.quadraticCurveTo(_,tt,ot,st),this}bezierCurveTo(_,tt,ot,st,at,lt){return this.currentPath.bezierCurveTo(_,tt,ot,st,at,lt),this}splineThru(_){return this.currentPath.splineThru(_),this}toShapes(_){function tt(Rt){const xt=[];for(let Nt=0,kt=Rt.length;Nt<kt;Nt++){const Vt=Rt[Nt],Ft=new Shape;Ft.curves=Vt.curves,xt.push(Ft)}return xt}function ot(Rt,xt){const Nt=xt.length;let kt=!1;for(let Vt=Nt-1,Ft=0;Ft<Nt;Vt=Ft++){let zt=xt[Vt],Yt=xt[Ft],Kt=Yt.x-zt.x,qt=Yt.y-zt.y;if(Math.abs(qt)>Number.EPSILON){if(qt<0&&(zt=xt[Ft],Kt=-Kt,Yt=xt[Vt],qt=-qt),Rt.y<zt.y||Rt.y>Yt.y)continue;if(Rt.y===zt.y){if(Rt.x===zt.x)return!0}else{const pn=qt*(Rt.x-zt.x)-Kt*(Rt.y-zt.y);if(pn===0)return!0;if(pn<0)continue;kt=!kt}}else{if(Rt.y!==zt.y)continue;if(Yt.x<=Rt.x&&Rt.x<=zt.x||zt.x<=Rt.x&&Rt.x<=Yt.x)return!0}}return kt}const st=ShapeUtils.isClockWise,at=this.subPaths;if(at.length===0)return[];let lt,dt,ht;const ft=[];if(at.length===1)return dt=at[0],ht=new Shape,ht.curves=dt.curves,ft.push(ht),ft;let gt=!st(at[0].getPoints());gt=_?!gt:gt;const Et=[],yt=[];let Ct=[],wt=0,It;yt[wt]=void 0,Ct[wt]=[];for(let Rt=0,xt=at.length;Rt<xt;Rt++)dt=at[Rt],It=dt.getPoints(),lt=st(It),lt=_?!lt:lt,lt?(!gt&&yt[wt]&&wt++,yt[wt]={s:new Shape,p:It},yt[wt].s.curves=dt.curves,gt&&wt++,Ct[wt]=[]):Ct[wt].push({h:dt,p:It[0]});if(!yt[0])return tt(at);if(yt.length>1){let Rt=!1,xt=0;for(let Nt=0,kt=yt.length;Nt<kt;Nt++)Et[Nt]=[];for(let Nt=0,kt=yt.length;Nt<kt;Nt++){const Vt=Ct[Nt];for(let Ft=0;Ft<Vt.length;Ft++){const zt=Vt[Ft];let Yt=!0;for(let Kt=0;Kt<yt.length;Kt++)ot(zt.p,yt[Kt].p)&&(Nt!==Kt&&xt++,Yt?(Yt=!1,Et[Kt].push(zt)):Rt=!0);Yt&&Et[Nt].push(zt)}}xt>0&&Rt===!1&&(Ct=Et)}let Pt;for(let Rt=0,xt=yt.length;Rt<xt;Rt++){ht=yt[Rt].s,ft.push(ht),Pt=Ct[Rt];for(let Nt=0,kt=Pt.length;Nt<kt;Nt++)ht.holes.push(Pt[Nt].h)}return ft}}class BoxBufferGeometry extends BoxGeometry{constructor(_,tt,ot,st,at,lt){console.warn("THREE.BoxBufferGeometry has been renamed to THREE.BoxGeometry."),super(_,tt,ot,st,at,lt)}}class CapsuleBufferGeometry extends CapsuleGeometry{constructor(_,tt,ot,st){console.warn("THREE.CapsuleBufferGeometry has been renamed to THREE.CapsuleGeometry."),super(_,tt,ot,st)}}class CircleBufferGeometry extends CircleGeometry{constructor(_,tt,ot,st){console.warn("THREE.CircleBufferGeometry has been renamed to THREE.CircleGeometry."),super(_,tt,ot,st)}}class ConeBufferGeometry extends ConeGeometry{constructor(_,tt,ot,st,at,lt,dt){console.warn("THREE.ConeBufferGeometry has been renamed to THREE.ConeGeometry."),super(_,tt,ot,st,at,lt,dt)}}class CylinderBufferGeometry extends CylinderGeometry{constructor(_,tt,ot,st,at,lt,dt,ht){console.warn("THREE.CylinderBufferGeometry has been renamed to THREE.CylinderGeometry."),super(_,tt,ot,st,at,lt,dt,ht)}}class DodecahedronBufferGeometry extends DodecahedronGeometry{constructor(_,tt){console.warn("THREE.DodecahedronBufferGeometry has been renamed to THREE.DodecahedronGeometry."),super(_,tt)}}class ExtrudeBufferGeometry extends ExtrudeGeometry{constructor(_,tt){console.warn("THREE.ExtrudeBufferGeometry has been renamed to THREE.ExtrudeGeometry."),super(_,tt)}}class IcosahedronBufferGeometry extends IcosahedronGeometry{constructor(_,tt){console.warn("THREE.IcosahedronBufferGeometry has been renamed to THREE.IcosahedronGeometry."),super(_,tt)}}class LatheBufferGeometry extends LatheGeometry{constructor(_,tt,ot,st){console.warn("THREE.LatheBufferGeometry has been renamed to THREE.LatheGeometry."),super(_,tt,ot,st)}}class OctahedronBufferGeometry extends OctahedronGeometry{constructor(_,tt){console.warn("THREE.OctahedronBufferGeometry has been renamed to THREE.OctahedronGeometry."),super(_,tt)}}class PlaneBufferGeometry extends PlaneGeometry{constructor(_,tt,ot,st){console.warn("THREE.PlaneBufferGeometry has been renamed to THREE.PlaneGeometry."),super(_,tt,ot,st)}}class PolyhedronBufferGeometry extends PolyhedronGeometry{constructor(_,tt,ot,st){console.warn("THREE.PolyhedronBufferGeometry has been renamed to THREE.PolyhedronGeometry."),super(_,tt,ot,st)}}class RingBufferGeometry extends RingGeometry{constructor(_,tt,ot,st,at,lt){console.warn("THREE.RingBufferGeometry has been renamed to THREE.RingGeometry."),super(_,tt,ot,st,at,lt)}}class ShapeBufferGeometry extends ShapeGeometry{constructor(_,tt){console.warn("THREE.ShapeBufferGeometry has been renamed to THREE.ShapeGeometry."),super(_,tt)}}class SphereBufferGeometry extends SphereGeometry{constructor(_,tt,ot,st,at,lt,dt){console.warn("THREE.SphereBufferGeometry has been renamed to THREE.SphereGeometry."),super(_,tt,ot,st,at,lt,dt)}}class TetrahedronBufferGeometry extends TetrahedronGeometry{constructor(_,tt){console.warn("THREE.TetrahedronBufferGeometry has been renamed to THREE.TetrahedronGeometry."),super(_,tt)}}class TorusBufferGeometry extends TorusGeometry{constructor(_,tt,ot,st,at){console.warn("THREE.TorusBufferGeometry has been renamed to THREE.TorusGeometry."),super(_,tt,ot,st,at)}}class TorusKnotBufferGeometry extends TorusKnotGeometry{constructor(_,tt,ot,st,at,lt){console.warn("THREE.TorusKnotBufferGeometry has been renamed to THREE.TorusKnotGeometry."),super(_,tt,ot,st,at,lt)}}class TubeBufferGeometry extends TubeGeometry{constructor(_,tt,ot,st,at){console.warn("THREE.TubeBufferGeometry has been renamed to THREE.TubeGeometry."),super(_,tt,ot,st,at)}}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:REVISION}}));typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=REVISION);const THREE$1=Object.freeze(Object.defineProperty({__proto__:null,ACESFilmicToneMapping,AddEquation,AddOperation,AdditiveAnimationBlendMode,AdditiveBlending,AlphaFormat,AlwaysCompare,AlwaysDepth,AlwaysStencilFunc,AmbientLight,AmbientLightProbe,AnimationAction,AnimationClip,AnimationLoader,AnimationMixer,AnimationObjectGroup,AnimationUtils,ArcCurve,ArrayCamera,ArrowHelper,Audio:Audio$1,AudioAnalyser,AudioContext,AudioListener,AudioLoader,AxesHelper,BackSide,BasicDepthPacking,BasicShadowMap,Bone,BooleanKeyframeTrack,Box2,Box3,Box3Helper,BoxBufferGeometry,BoxGeometry,BoxHelper,BufferAttribute,BufferGeometry,BufferGeometryLoader,ByteType,Cache,Camera,CameraHelper,CanvasTexture,CapsuleBufferGeometry,CapsuleGeometry,CatmullRomCurve3,CineonToneMapping,CircleBufferGeometry,CircleGeometry,ClampToEdgeWrapping,Clock,Color:Color$1,ColorKeyframeTrack,ColorManagement,CompressedArrayTexture,CompressedTexture,CompressedTextureLoader,ConeBufferGeometry,ConeGeometry,CubeCamera,CubeReflectionMapping,CubeRefractionMapping,CubeTexture,CubeTextureLoader,CubeUVReflectionMapping,CubicBezierCurve,CubicBezierCurve3,CubicInterpolant,CullFaceBack,CullFaceFront,CullFaceFrontBack,CullFaceNone,Curve,CurvePath,CustomBlending,CustomToneMapping,CylinderBufferGeometry,CylinderGeometry,Cylindrical,Data3DTexture,DataArrayTexture,DataTexture,DataTextureLoader,DataUtils,DecrementStencilOp,DecrementWrapStencilOp,DefaultLoadingManager,DepthFormat,DepthStencilFormat,DepthTexture,DirectionalLight,DirectionalLightHelper,DiscreteInterpolant,DisplayP3ColorSpace,DodecahedronBufferGeometry,DodecahedronGeometry,DoubleSide,DstAlphaFactor,DstColorFactor,DynamicCopyUsage,DynamicDrawUsage,DynamicReadUsage,EdgesGeometry,EllipseCurve,EqualCompare,EqualDepth,EqualStencilFunc,EquirectangularReflectionMapping,EquirectangularRefractionMapping,Euler,EventDispatcher:EventDispatcher$1,ExtrudeBufferGeometry,ExtrudeGeometry,FileLoader,Float16BufferAttribute,Float32BufferAttribute,Float64BufferAttribute,FloatType,Fog,FogExp2,FramebufferTexture,FrontSide,Frustum,GLBufferAttribute,GLSL1,GLSL3,GreaterCompare,GreaterDepth,GreaterEqualCompare,GreaterEqualDepth,GreaterEqualStencilFunc,GreaterStencilFunc,GridHelper,Group,HalfFloatType,HemisphereLight,HemisphereLightHelper,HemisphereLightProbe,IcosahedronBufferGeometry,IcosahedronGeometry,ImageBitmapLoader,ImageLoader,ImageUtils,IncrementStencilOp,IncrementWrapStencilOp,InstancedBufferAttribute,InstancedBufferGeometry,InstancedInterleavedBuffer,InstancedMesh,Int16BufferAttribute,Int32BufferAttribute,Int8BufferAttribute,IntType,InterleavedBuffer,InterleavedBufferAttribute,Interpolant,InterpolateDiscrete,InterpolateLinear,InterpolateSmooth,InvertStencilOp,KeepStencilOp,KeyframeTrack,LOD,LatheBufferGeometry,LatheGeometry,Layers,LessCompare,LessDepth,LessEqualCompare,LessEqualDepth,LessEqualStencilFunc,LessStencilFunc,Light,LightProbe,Line,Line3,LineBasicMaterial,LineCurve,LineCurve3,LineDashedMaterial,LineLoop,LineSegments,LinearEncoding:LinearEncoding$1,LinearFilter,LinearInterpolant,LinearMipMapLinearFilter,LinearMipMapNearestFilter,LinearMipmapLinearFilter,LinearMipmapNearestFilter,LinearSRGBColorSpace:LinearSRGBColorSpace$1,LinearToneMapping,Loader:Loader$1,LoaderUtils,LoadingManager,LoopOnce,LoopPingPong,LoopRepeat,LuminanceAlphaFormat,LuminanceFormat,MOUSE,Material,MaterialLoader,MathUtils,Matrix3,Matrix4,MaxEquation,Mesh,MeshBasicMaterial,MeshDepthMaterial,MeshDistanceMaterial,MeshLambertMaterial,MeshMatcapMaterial,MeshNormalMaterial,MeshPhongMaterial,MeshPhysicalMaterial,MeshStandardMaterial,MeshToonMaterial,MinEquation,MirroredRepeatWrapping,MixOperation,MultiplyBlending,MultiplyOperation,NearestFilter,NearestMipMapLinearFilter,NearestMipMapNearestFilter,NearestMipmapLinearFilter,NearestMipmapNearestFilter,NeverCompare,NeverDepth,NeverStencilFunc,NoBlending,NoColorSpace,NoToneMapping,NormalAnimationBlendMode,NormalBlending,NotEqualCompare,NotEqualDepth,NotEqualStencilFunc,NumberKeyframeTrack,Object3D,ObjectLoader,ObjectSpaceNormalMap,OctahedronBufferGeometry,OctahedronGeometry,OneFactor,OneMinusDstAlphaFactor,OneMinusDstColorFactor,OneMinusSrcAlphaFactor,OneMinusSrcColorFactor,OrthographicCamera,PCFShadowMap,PCFSoftShadowMap,PMREMGenerator,Path,PerspectiveCamera,Plane,PlaneBufferGeometry,PlaneGeometry,PlaneHelper,PointLight,PointLightHelper,Points,PointsMaterial,PolarGridHelper,PolyhedronBufferGeometry,PolyhedronGeometry,PositionalAudio,PropertyBinding,PropertyMixer,QuadraticBezierCurve,QuadraticBezierCurve3,Quaternion,QuaternionKeyframeTrack,QuaternionLinearInterpolant,RED_GREEN_RGTC2_Format,RED_RGTC1_Format,REVISION,RGBADepthPacking,RGBAFormat,RGBAIntegerFormat,RGBA_ASTC_10x10_Format,RGBA_ASTC_10x5_Format,RGBA_ASTC_10x6_Format,RGBA_ASTC_10x8_Format,RGBA_ASTC_12x10_Format,RGBA_ASTC_12x12_Format,RGBA_ASTC_4x4_Format,RGBA_ASTC_5x4_Format,RGBA_ASTC_5x5_Format,RGBA_ASTC_6x5_Format,RGBA_ASTC_6x6_Format,RGBA_ASTC_8x5_Format,RGBA_ASTC_8x6_Format,RGBA_ASTC_8x8_Format,RGBA_BPTC_Format,RGBA_ETC2_EAC_Format,RGBA_PVRTC_2BPPV1_Format,RGBA_PVRTC_4BPPV1_Format,RGBA_S3TC_DXT1_Format,RGBA_S3TC_DXT3_Format,RGBA_S3TC_DXT5_Format,RGB_ETC1_Format,RGB_ETC2_Format,RGB_PVRTC_2BPPV1_Format,RGB_PVRTC_4BPPV1_Format,RGB_S3TC_DXT1_Format,RGFormat,RGIntegerFormat,RawShaderMaterial,Ray,Raycaster,RectAreaLight,RedFormat,RedIntegerFormat,ReinhardToneMapping,RepeatWrapping,ReplaceStencilOp,ReverseSubtractEquation,RingBufferGeometry,RingGeometry,SIGNED_RED_GREEN_RGTC2_Format,SIGNED_RED_RGTC1_Format,SRGBColorSpace:SRGBColorSpace$1,Scene,ShaderChunk,ShaderLib,ShaderMaterial,ShadowMaterial,Shape,ShapeBufferGeometry,ShapeGeometry,ShapePath,ShapeUtils,ShortType,Skeleton,SkeletonHelper,SkinnedMesh,Source,Sphere,SphereBufferGeometry,SphereGeometry,Spherical,SphericalHarmonics3,SplineCurve,SpotLight,SpotLightHelper,Sprite,SpriteMaterial,SrcAlphaFactor,SrcAlphaSaturateFactor,SrcColorFactor,StaticCopyUsage,StaticDrawUsage,StaticReadUsage,StereoCamera,StreamCopyUsage,StreamDrawUsage,StreamReadUsage,StringKeyframeTrack,SubtractEquation,SubtractiveBlending,TOUCH,TangentSpaceNormalMap,TetrahedronBufferGeometry,TetrahedronGeometry,Texture,TextureLoader,TorusBufferGeometry,TorusGeometry,TorusKnotBufferGeometry,TorusKnotGeometry,Triangle,TriangleFanDrawMode,TriangleStripDrawMode,TrianglesDrawMode,TubeBufferGeometry,TubeGeometry,TwoPassDoubleSide,UVMapping,Uint16BufferAttribute,Uint32BufferAttribute,Uint8BufferAttribute,Uint8ClampedBufferAttribute,Uniform,UniformsGroup,UniformsLib,UniformsUtils,UnsignedByteType,UnsignedInt248Type,UnsignedIntType,UnsignedShort4444Type,UnsignedShort5551Type,UnsignedShortType,VSMShadowMap,Vector2,Vector3,Vector4,VectorKeyframeTrack,VideoTexture,WebGL1Renderer,WebGL3DRenderTarget,WebGLArrayRenderTarget,WebGLCoordinateSystem,WebGLCubeRenderTarget,WebGLMultipleRenderTargets,WebGLRenderTarget,WebGLRenderer,WebGLUtils,WebGPUCoordinateSystem,WireframeGeometry,WrapAroundEnding,ZeroCurvatureEnding,ZeroFactor,ZeroSlopeEnding,ZeroStencilOp,_SRGBAFormat,sRGBEncoding:sRGBEncoding$1},Symbol.toStringTag,{value:"Module"}));var constants={exports:{}},reactReconcilerConstants_production_min={};/**
 * @license React
 * react-reconciler-constants.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */reactReconcilerConstants_production_min.ConcurrentRoot=1;reactReconcilerConstants_production_min.ContinuousEventPriority=4;reactReconcilerConstants_production_min.DefaultEventPriority=16;reactReconcilerConstants_production_min.DiscreteEventPriority=1;reactReconcilerConstants_production_min.IdleEventPriority=536870912;reactReconcilerConstants_production_min.LegacyRoot=0;constants.exports=reactReconcilerConstants_production_min;var constantsExports=constants.exports;function createStore$1(nt){let _;const tt=new Set,ot=(ft,gt)=>{const Et=typeof ft=="function"?ft(_):ft;if(Et!==_){const yt=_;_=gt?Et:Object.assign({},_,Et),tt.forEach(Ct=>Ct(_,yt))}},st=()=>_,at=(ft,gt=st,Et=Object.is)=>{console.warn("[DEPRECATED] Please use `subscribeWithSelector` middleware");let yt=gt(_);function Ct(){const wt=gt(_);if(!Et(yt,wt)){const It=yt;ft(yt=wt,It)}}return tt.add(Ct),()=>tt.delete(Ct)},ht={setState:ot,getState:st,subscribe:(ft,gt,Et)=>gt||Et?at(ft,gt,Et):(tt.add(ft),()=>tt.delete(ft)),destroy:()=>tt.clear()};return _=nt(ot,st,ht),ht}const isSSR=typeof window>"u"||!window.navigator||/ServerSideRendering|^Deno\//.test(window.navigator.userAgent),useIsomorphicLayoutEffect$1=isSSR?reactExports.useEffect:reactExports.useLayoutEffect;function create$2(nt){const _=typeof nt=="function"?createStore$1(nt):nt,tt=(ot=_.getState,st=Object.is)=>{const[,at]=reactExports.useReducer(Pt=>Pt+1,0),lt=_.getState(),dt=reactExports.useRef(lt),ht=reactExports.useRef(ot),ft=reactExports.useRef(st),gt=reactExports.useRef(!1),Et=reactExports.useRef();Et.current===void 0&&(Et.current=ot(lt));let yt,Ct=!1;(dt.current!==lt||ht.current!==ot||ft.current!==st||gt.current)&&(yt=ot(lt),Ct=!st(Et.current,yt)),useIsomorphicLayoutEffect$1(()=>{Ct&&(Et.current=yt),dt.current=lt,ht.current=ot,ft.current=st,gt.current=!1});const wt=reactExports.useRef(lt);useIsomorphicLayoutEffect$1(()=>{const Pt=()=>{try{const xt=_.getState(),Nt=ht.current(xt);ft.current(Et.current,Nt)||(dt.current=xt,Et.current=Nt,at())}catch{gt.current=!0,at()}},Rt=_.subscribe(Pt);return _.getState()!==wt.current&&Pt(),Rt},[]);const It=Ct?yt:Et.current;return reactExports.useDebugValue(It),It};return Object.assign(tt,_),tt[Symbol.iterator]=function(){console.warn("[useStore, api] = create() is deprecated and will be removed in v4");const ot=[tt,_];return{next(){const st=ot.length<=0;return{value:ot.shift(),done:st}}}},tt}var reactReconciler={exports:{}},scheduler={exports:{}},scheduler_production_min={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(nt){function _(yn,An){var Sn=yn.length;yn.push(An);e:for(;0<Sn;){var gn=Sn-1>>>1,_n=yn[gn];if(0<st(_n,An))yn[gn]=An,yn[Sn]=_n,Sn=gn;else break e}}function tt(yn){return yn.length===0?null:yn[0]}function ot(yn){if(yn.length===0)return null;var An=yn[0],Sn=yn.pop();if(Sn!==An){yn[0]=Sn;e:for(var gn=0,_n=yn.length,Rn=_n>>>1;gn<Rn;){var bn=2*(gn+1)-1,jn=yn[bn],kn=bn+1,Gn=yn[kn];if(0>st(jn,Sn))kn<_n&&0>st(Gn,jn)?(yn[gn]=Gn,yn[kn]=Sn,gn=kn):(yn[gn]=jn,yn[bn]=Sn,gn=bn);else if(kn<_n&&0>st(Gn,Sn))yn[gn]=Gn,yn[kn]=Sn,gn=kn;else break e}}return An}function st(yn,An){var Sn=yn.sortIndex-An.sortIndex;return Sn!==0?Sn:yn.id-An.id}if(typeof performance=="object"&&typeof performance.now=="function"){var at=performance;nt.unstable_now=function(){return at.now()}}else{var lt=Date,dt=lt.now();nt.unstable_now=function(){return lt.now()-dt}}var ht=[],ft=[],gt=1,Et=null,yt=3,Ct=!1,wt=!1,It=!1,Pt=typeof setTimeout=="function"?setTimeout:null,Rt=typeof clearTimeout=="function"?clearTimeout:null,xt=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function Nt(yn){for(var An=tt(ft);An!==null;){if(An.callback===null)ot(ft);else if(An.startTime<=yn)ot(ft),An.sortIndex=An.expirationTime,_(ht,An);else break;An=tt(ft)}}function kt(yn){if(It=!1,Nt(yn),!wt)if(tt(ht)!==null)wt=!0,On(Vt);else{var An=tt(ft);An!==null&&Pn(kt,An.startTime-yn)}}function Vt(yn,An){wt=!1,It&&(It=!1,Rt(Yt),Yt=-1),Ct=!0;var Sn=yt;try{for(Nt(An),Et=tt(ht);Et!==null&&(!(Et.expirationTime>An)||yn&&!pn());){var gn=Et.callback;if(typeof gn=="function"){Et.callback=null,yt=Et.priorityLevel;var _n=gn(Et.expirationTime<=An);An=nt.unstable_now(),typeof _n=="function"?Et.callback=_n:Et===tt(ht)&&ot(ht),Nt(An)}else ot(ht);Et=tt(ht)}if(Et!==null)var Rn=!0;else{var bn=tt(ft);bn!==null&&Pn(kt,bn.startTime-An),Rn=!1}return Rn}finally{Et=null,yt=Sn,Ct=!1}}var Ft=!1,zt=null,Yt=-1,Kt=5,qt=-1;function pn(){return!(nt.unstable_now()-qt<Kt)}function an(){if(zt!==null){var yn=nt.unstable_now();qt=yn;var An=!0;try{An=zt(!0,yn)}finally{An?fn():(Ft=!1,zt=null)}}else Ft=!1}var fn;if(typeof xt=="function")fn=function(){xt(an)};else if(typeof MessageChannel<"u"){var dn=new MessageChannel,Cn=dn.port2;dn.port1.onmessage=an,fn=function(){Cn.postMessage(null)}}else fn=function(){Pt(an,0)};function On(yn){zt=yn,Ft||(Ft=!0,fn())}function Pn(yn,An){Yt=Pt(function(){yn(nt.unstable_now())},An)}nt.unstable_IdlePriority=5,nt.unstable_ImmediatePriority=1,nt.unstable_LowPriority=4,nt.unstable_NormalPriority=3,nt.unstable_Profiling=null,nt.unstable_UserBlockingPriority=2,nt.unstable_cancelCallback=function(yn){yn.callback=null},nt.unstable_continueExecution=function(){wt||Ct||(wt=!0,On(Vt))},nt.unstable_forceFrameRate=function(yn){0>yn||125<yn?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Kt=0<yn?Math.floor(1e3/yn):5},nt.unstable_getCurrentPriorityLevel=function(){return yt},nt.unstable_getFirstCallbackNode=function(){return tt(ht)},nt.unstable_next=function(yn){switch(yt){case 1:case 2:case 3:var An=3;break;default:An=yt}var Sn=yt;yt=An;try{return yn()}finally{yt=Sn}},nt.unstable_pauseExecution=function(){},nt.unstable_requestPaint=function(){},nt.unstable_runWithPriority=function(yn,An){switch(yn){case 1:case 2:case 3:case 4:case 5:break;default:yn=3}var Sn=yt;yt=yn;try{return An()}finally{yt=Sn}},nt.unstable_scheduleCallback=function(yn,An,Sn){var gn=nt.unstable_now();switch(typeof Sn=="object"&&Sn!==null?(Sn=Sn.delay,Sn=typeof Sn=="number"&&0<Sn?gn+Sn:gn):Sn=gn,yn){case 1:var _n=-1;break;case 2:_n=250;break;case 5:_n=1073741823;break;case 4:_n=1e4;break;default:_n=5e3}return _n=Sn+_n,yn={id:gt++,callback:An,priorityLevel:yn,startTime:Sn,expirationTime:_n,sortIndex:-1},Sn>gn?(yn.sortIndex=Sn,_(ft,yn),tt(ht)===null&&yn===tt(ft)&&(It?(Rt(Yt),Yt=-1):It=!0,Pn(kt,Sn-gn))):(yn.sortIndex=_n,_(ht,yn),wt||Ct||(wt=!0,On(Vt))),yn},nt.unstable_shouldYield=pn,nt.unstable_wrapCallback=function(yn){var An=yt;return function(){var Sn=yt;yt=An;try{return yn.apply(this,arguments)}finally{yt=Sn}}}})(scheduler_production_min);scheduler.exports=scheduler_production_min;var schedulerExports=scheduler.exports;/**
 * @license React
 * react-reconciler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var reactReconciler_production_min=function(_){var tt={},ot=reactExports,st=schedulerExports,at=Object.assign;function lt(St){for(var At="https://reactjs.org/docs/error-decoder.html?invariant="+St,Lt=1;Lt<arguments.length;Lt++)At+="&args[]="+encodeURIComponent(arguments[Lt]);return"Minified React error #"+St+"; visit "+At+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var dt=ot.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,ht=Symbol.for("react.element"),ft=Symbol.for("react.portal"),gt=Symbol.for("react.fragment"),Et=Symbol.for("react.strict_mode"),yt=Symbol.for("react.profiler"),Ct=Symbol.for("react.provider"),wt=Symbol.for("react.context"),It=Symbol.for("react.forward_ref"),Pt=Symbol.for("react.suspense"),Rt=Symbol.for("react.suspense_list"),xt=Symbol.for("react.memo"),Nt=Symbol.for("react.lazy"),kt=Symbol.for("react.offscreen"),Vt=Symbol.iterator;function Ft(St){return St===null||typeof St!="object"?null:(St=Vt&&St[Vt]||St["@@iterator"],typeof St=="function"?St:null)}function zt(St){if(St==null)return null;if(typeof St=="function")return St.displayName||St.name||null;if(typeof St=="string")return St;switch(St){case gt:return"Fragment";case ft:return"Portal";case yt:return"Profiler";case Et:return"StrictMode";case Pt:return"Suspense";case Rt:return"SuspenseList"}if(typeof St=="object")switch(St.$$typeof){case wt:return(St.displayName||"Context")+".Consumer";case Ct:return(St._context.displayName||"Context")+".Provider";case It:var At=St.render;return St=St.displayName,St||(St=At.displayName||At.name||"",St=St!==""?"ForwardRef("+St+")":"ForwardRef"),St;case xt:return At=St.displayName||null,At!==null?At:zt(St.type)||"Memo";case Nt:At=St._payload,St=St._init;try{return zt(St(At))}catch{}}return null}function Yt(St){var At=St.type;switch(St.tag){case 24:return"Cache";case 9:return(At.displayName||"Context")+".Consumer";case 10:return(At._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return St=At.render,St=St.displayName||St.name||"",At.displayName||(St!==""?"ForwardRef("+St+")":"ForwardRef");case 7:return"Fragment";case 5:return At;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return zt(At);case 8:return At===Et?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof At=="function")return At.displayName||At.name||null;if(typeof At=="string")return At}return null}function Kt(St){var At=St,Lt=St;if(St.alternate)for(;At.return;)At=At.return;else{St=At;do At=St,At.flags&4098&&(Lt=At.return),St=At.return;while(St)}return At.tag===3?Lt:null}function qt(St){if(Kt(St)!==St)throw Error(lt(188))}function pn(St){var At=St.alternate;if(!At){if(At=Kt(St),At===null)throw Error(lt(188));return At!==St?null:St}for(var Lt=St,Bt=At;;){var Wt=Lt.return;if(Wt===null)break;var nn=Wt.alternate;if(nn===null){if(Bt=Wt.return,Bt!==null){Lt=Bt;continue}break}if(Wt.child===nn.child){for(nn=Wt.child;nn;){if(nn===Lt)return qt(Wt),St;if(nn===Bt)return qt(Wt),At;nn=nn.sibling}throw Error(lt(188))}if(Lt.return!==Bt.return)Lt=Wt,Bt=nn;else{for(var Dn=!1,Zn=Wt.child;Zn;){if(Zn===Lt){Dn=!0,Lt=Wt,Bt=nn;break}if(Zn===Bt){Dn=!0,Bt=Wt,Lt=nn;break}Zn=Zn.sibling}if(!Dn){for(Zn=nn.child;Zn;){if(Zn===Lt){Dn=!0,Lt=nn,Bt=Wt;break}if(Zn===Bt){Dn=!0,Bt=nn,Lt=Wt;break}Zn=Zn.sibling}if(!Dn)throw Error(lt(189))}}if(Lt.alternate!==Bt)throw Error(lt(190))}if(Lt.tag!==3)throw Error(lt(188));return Lt.stateNode.current===Lt?St:At}function an(St){return St=pn(St),St!==null?fn(St):null}function fn(St){if(St.tag===5||St.tag===6)return St;for(St=St.child;St!==null;){var At=fn(St);if(At!==null)return At;St=St.sibling}return null}function dn(St){if(St.tag===5||St.tag===6)return St;for(St=St.child;St!==null;){if(St.tag!==4){var At=dn(St);if(At!==null)return At}St=St.sibling}return null}var Cn=Array.isArray,On=_.getPublicInstance,Pn=_.getRootHostContext,yn=_.getChildHostContext,An=_.prepareForCommit,Sn=_.resetAfterCommit,gn=_.createInstance,_n=_.appendInitialChild,Rn=_.finalizeInitialChildren,bn=_.prepareUpdate,jn=_.shouldSetTextContent,kn=_.createTextInstance,Gn=_.scheduleTimeout,Vn=_.cancelTimeout,qn=_.noTimeout,Tr=_.isPrimaryRenderer,Mn=_.supportsMutation,Zt=_.supportsPersistence,wn=_.supportsHydration,xn=_.getInstanceFromNode,Hn=_.preparePortalMount,Bn=_.getCurrentEventPriority,cr=_.detachDeletedInstance,Wn=_.supportsMicrotasks,rr=_.scheduleMicrotask,sr=_.supportsTestSelectors,ir=_.findFiberRoot,kr=_.getBoundingRect,un=_.getTextContent,sn=_.isHiddenSubtree,Kn=_.matchAccessibilityRole,Sr=_.setFocusIfFocusable,lr=_.setupIntersectionObserver,vr=_.appendChild,Fr=_.appendChildToContainer,Gr=_.commitTextUpdate,dr=_.commitMount,Hr=_.commitUpdate,zr=_.insertBefore,Nr=_.insertInContainerBefore,Or=_.removeChild,Ur=_.removeChildFromContainer,Zr=_.resetTextContent,oo=_.hideInstance,zn=_.hideTextInstance,ar=_.unhideInstance,pr=_.unhideTextInstance,Wr=_.clearContainer,Qr=_.cloneInstance,ko=_.createContainerChildSet,os=_.appendChildToContainerChildSet,Jo=_.finalizeContainerChildren,ws=_.replaceContainerChildren,Ms=_.cloneHiddenInstance,ys=_.cloneHiddenTextInstance,bo=_.canHydrateInstance,mu=_.canHydrateTextInstance,Xl=_.canHydrateSuspenseInstance,ss=_.isSuspenseInstancePending,js=_.isSuspenseInstanceFallback,_l=_.registerSuspenseInstanceRetry,Is=_.getNextHydratableSibling,vo=_.getFirstHydratableChild,wl=_.getFirstHydratableChildWithinContainer,ju=_.getFirstHydratableChildWithinSuspenseInstance,cn=_.hydrateInstance,Xt=_.hydrateTextInstance,mn=_.hydrateSuspenseInstance,Nn=_.getNextHydratableInstanceAfterSuspenseInstance,In=_.commitHydratedContainer,Un=_.commitHydratedSuspenseInstance,mr=_.clearSuspenseBoundary,gr=_.clearSuspenseBoundaryFromContainer,br=_.shouldDeleteUnhydratedTailInstances,Rr=_.didNotMatchHydratedContainerTextInstance,wr=_.didNotMatchHydratedTextInstance,tr;function to(St){if(tr===void 0)try{throw Error()}catch(Lt){var At=Lt.stack.trim().match(/\n( *(at )?)/);tr=At&&At[1]||""}return`
`+tr+St}var $r=!1;function Yr(St,At){if(!St||$r)return"";$r=!0;var Lt=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(At)if(At=function(){throw Error()},Object.defineProperty(At.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(At,[])}catch(Kr){var Bt=Kr}Reflect.construct(St,[],At)}else{try{At.call()}catch(Kr){Bt=Kr}St.call(At.prototype)}else{try{throw Error()}catch(Kr){Bt=Kr}St()}}catch(Kr){if(Kr&&Bt&&typeof Kr.stack=="string"){for(var Wt=Kr.stack.split(`
`),nn=Bt.stack.split(`
`),Dn=Wt.length-1,Zn=nn.length-1;1<=Dn&&0<=Zn&&Wt[Dn]!==nn[Zn];)Zn--;for(;1<=Dn&&0<=Zn;Dn--,Zn--)if(Wt[Dn]!==nn[Zn]){if(Dn!==1||Zn!==1)do if(Dn--,Zn--,0>Zn||Wt[Dn]!==nn[Zn]){var xr=`
`+Wt[Dn].replace(" at new "," at ");return St.displayName&&xr.includes("<anonymous>")&&(xr=xr.replace("<anonymous>",St.displayName)),xr}while(1<=Dn&&0<=Zn);break}}}finally{$r=!1,Error.prepareStackTrace=Lt}return(St=St?St.displayName||St.name:"")?to(St):""}var _o=Object.prototype.hasOwnProperty,Ro=[],yo=-1;function eo(St){return{current:St}}function Io(St){0>yo||(St.current=Ro[yo],Ro[yo]=null,yo--)}function fo(St,At){yo++,Ro[yo]=St.current,St.current=At}var Go={},Ps=eo(Go),Uo=eo(!1),_s=Go;function as(St,At){var Lt=St.type.contextTypes;if(!Lt)return Go;var Bt=St.stateNode;if(Bt&&Bt.__reactInternalMemoizedUnmaskedChildContext===At)return Bt.__reactInternalMemoizedMaskedChildContext;var Wt={},nn;for(nn in Lt)Wt[nn]=At[nn];return Bt&&(St=St.stateNode,St.__reactInternalMemoizedUnmaskedChildContext=At,St.__reactInternalMemoizedMaskedChildContext=Wt),Wt}function ks(St){return St=St.childContextTypes,St!=null}function xo(){Io(Uo),Io(Ps)}function $o(St,At,Lt){if(Ps.current!==Go)throw Error(lt(168));fo(Ps,At),fo(Uo,Lt)}function Xs(St,At,Lt){var Bt=St.stateNode;if(At=At.childContextTypes,typeof Bt.getChildContext!="function")return Lt;Bt=Bt.getChildContext();for(var Wt in Bt)if(!(Wt in At))throw Error(lt(108,Yt(St)||"Unknown",Wt));return at({},Lt,Bt)}function As(St){return St=(St=St.stateNode)&&St.__reactInternalMemoizedMergedChildContext||Go,_s=Ps.current,fo(Ps,St),fo(Uo,Uo.current),!0}function zo(St,At,Lt){var Bt=St.stateNode;if(!Bt)throw Error(lt(169));Lt?(St=Xs(St,At,_s),Bt.__reactInternalMemoizedMergedChildContext=St,Io(Uo),Io(Ps),fo(Ps,St)):Io(Uo),fo(Uo,Lt)}var ba=Math.clz32?Math.clz32:dp,_d=Math.log,Vl=Math.LN2;function dp(St){return St>>>=0,St===0?32:31-(_d(St)/Vl|0)|0}var Lm=64,zp=4194304;function cm(St){switch(St&-St){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return St&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return St&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return St}}function km(St,At){var Lt=St.pendingLanes;if(Lt===0)return 0;var Bt=0,Wt=St.suspendedLanes,nn=St.pingedLanes,Dn=Lt&268435455;if(Dn!==0){var Zn=Dn&~Wt;Zn!==0?Bt=cm(Zn):(nn&=Dn,nn!==0&&(Bt=cm(nn)))}else Dn=Lt&~Wt,Dn!==0?Bt=cm(Dn):nn!==0&&(Bt=cm(nn));if(Bt===0)return 0;if(At!==0&&At!==Bt&&!(At&Wt)&&(Wt=Bt&-Bt,nn=At&-At,Wt>=nn||Wt===16&&(nn&4194240)!==0))return At;if(Bt&4&&(Bt|=Lt&16),At=St.entangledLanes,At!==0)for(St=St.entanglements,At&=Bt;0<At;)Lt=31-ba(At),Wt=1<<Lt,Bt|=St[Lt],At&=~Wt;return Bt}function G0(St,At){switch(St){case 1:case 2:case 4:return At+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return At+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function K_(St,At){for(var Lt=St.suspendedLanes,Bt=St.pingedLanes,Wt=St.expirationTimes,nn=St.pendingLanes;0<nn;){var Dn=31-ba(nn),Zn=1<<Dn,xr=Wt[Dn];xr===-1?(!(Zn&Lt)||Zn&Bt)&&(Wt[Dn]=G0(Zn,At)):xr<=At&&(St.expiredLanes|=Zn),nn&=~Zn}}function Um(St){return St=St.pendingLanes&-1073741825,St!==0?St:St&1073741824?1073741824:0}function Y_(St){for(var At=[],Lt=0;31>Lt;Lt++)At.push(St);return At}function lm(St,At,Lt){St.pendingLanes|=At,At!==536870912&&(St.suspendedLanes=0,St.pingedLanes=0),St=St.eventTimes,At=31-ba(At),St[At]=Lt}function f_(St,At){var Lt=St.pendingLanes&~At;St.pendingLanes=At,St.suspendedLanes=0,St.pingedLanes=0,St.expiredLanes&=At,St.mutableReadLanes&=At,St.entangledLanes&=At,At=St.entanglements;var Bt=St.eventTimes;for(St=St.expirationTimes;0<Lt;){var Wt=31-ba(Lt),nn=1<<Wt;At[Wt]=0,Bt[Wt]=-1,St[Wt]=-1,Lt&=~nn}}function um(St,At){var Lt=St.entangledLanes|=At;for(St=St.entanglements;Lt;){var Bt=31-ba(Lt),Wt=1<<Bt;Wt&At|St[Bt]&At&&(St[Bt]|=At),Lt&=~Wt}}var Es=0;function Av(St){return St&=-St,1<St?4<St?St&268435455?16:536870912:4:1}var Bm=st.unstable_scheduleCallback,AE=st.unstable_cancelCallback,Cv=st.unstable_shouldYield,bv=st.unstable_requestPaint,Il=st.unstable_now,X_=st.unstable_ImmediatePriority,$0=st.unstable_UserBlockingPriority,su=st.unstable_NormalPriority,Rv=st.unstable_IdlePriority,q_=null,hp=null;function wv(St){if(hp&&typeof hp.onCommitFiberRoot=="function")try{hp.onCommitFiberRoot(q_,St,void 0,(St.current.flags&128)===128)}catch{}}function Iv(St,At){return St===At&&(St!==0||1/St===1/At)||St!==St&&At!==At}var pp=typeof Object.is=="function"?Object.is:Iv,zu=null,dm=!1,au=!1;function Mu(St){zu===null?zu=[St]:zu.push(St)}function CE(St){dm=!0,Mu(St)}function _h(){if(!au&&zu!==null){au=!0;var St=0,At=Es;try{var Lt=zu;for(Es=1;St<Lt.length;St++){var Bt=Lt[St];do Bt=Bt(!0);while(Bt!==null)}zu=null,dm=!1}catch(Wt){throw zu!==null&&(zu=zu.slice(St+1)),Bm(X_,_h),Wt}finally{Es=At,au=!1}}return null}var J_=dt.ReactCurrentBatchConfig;function Z_(St,At){if(pp(St,At))return!0;if(typeof St!="object"||St===null||typeof At!="object"||At===null)return!1;var Lt=Object.keys(St),Bt=Object.keys(At);if(Lt.length!==Bt.length)return!1;for(Bt=0;Bt<Lt.length;Bt++){var Wt=Lt[Bt];if(!_o.call(At,Wt)||!pp(St[Wt],At[Wt]))return!1}return!0}function Gl(St){switch(St.tag){case 5:return to(St.type);case 16:return to("Lazy");case 13:return to("Suspense");case 19:return to("SuspenseList");case 0:case 2:case 15:return St=Yr(St.type,!1),St;case 11:return St=Yr(St.type.render,!1),St;case 1:return St=Yr(St.type,!0),St;default:return""}}function Wu(St,At){if(St&&St.defaultProps){At=at({},At),St=St.defaultProps;for(var Lt in St)At[Lt]===void 0&&(At[Lt]=St[Lt]);return At}return At}var gu=eo(null),bE=null,ep=null,Fm=null;function RE(){Fm=ep=bE=null}function wE(St,At,Lt){Tr?(fo(gu,At._currentValue),At._currentValue=Lt):(fo(gu,At._currentValue2),At._currentValue2=Lt)}function _u(St){var At=gu.current;Io(gu),Tr?St._currentValue=At:St._currentValue2=At}function Cu(St,At,Lt){for(;St!==null;){var Bt=St.alternate;if((St.childLanes&At)!==At?(St.childLanes|=At,Bt!==null&&(Bt.childLanes|=At)):Bt!==null&&(Bt.childLanes&At)!==At&&(Bt.childLanes|=At),St===Lt)break;St=St.return}}function xl(St,At){bE=St,Fm=ep=null,St=St.dependencies,St!==null&&St.firstContext!==null&&(St.lanes&At&&(Lu=!0),St.firstContext=null)}function Ol(St){var At=Tr?St._currentValue:St._currentValue2;if(Fm!==St)if(St={context:St,memoizedValue:At,next:null},ep===null){if(bE===null)throw Error(lt(308));ep=St,bE.dependencies={lanes:0,firstContext:St}}else ep=ep.next=St;return At}var fp=null,m_=!1;function Vm(St){St.updateQueue={baseState:St.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function IE(St,At){St=St.updateQueue,At.updateQueue===St&&(At.updateQueue={baseState:St.baseState,firstBaseUpdate:St.firstBaseUpdate,lastBaseUpdate:St.lastBaseUpdate,shared:St.shared,effects:St.effects})}function Gm(St,At){return{eventTime:St,lane:At,tag:0,payload:null,callback:null,next:null}}function g_(St,At){var Lt=St.updateQueue;Lt!==null&&(Lt=Lt.shared,Jl!==null&&St.mode&1&&!(hs&2)?(St=Lt.interleaved,St===null?(At.next=At,fp===null?fp=[Lt]:fp.push(Lt)):(At.next=St.next,St.next=At),Lt.interleaved=At):(St=Lt.pending,St===null?At.next=At:(At.next=St.next,St.next=At),Lt.pending=At))}function H0(St,At,Lt){if(At=At.updateQueue,At!==null&&(At=At.shared,(Lt&4194240)!==0)){var Bt=At.lanes;Bt&=St.pendingLanes,Lt|=Bt,At.lanes=Lt,um(St,Lt)}}function oC(St,At){var Lt=St.updateQueue,Bt=St.alternate;if(Bt!==null&&(Bt=Bt.updateQueue,Lt===Bt)){var Wt=null,nn=null;if(Lt=Lt.firstBaseUpdate,Lt!==null){do{var Dn={eventTime:Lt.eventTime,lane:Lt.lane,tag:Lt.tag,payload:Lt.payload,callback:Lt.callback,next:null};nn===null?Wt=nn=Dn:nn=nn.next=Dn,Lt=Lt.next}while(Lt!==null);nn===null?Wt=nn=At:nn=nn.next=At}else Wt=nn=At;Lt={baseState:Bt.baseState,firstBaseUpdate:Wt,lastBaseUpdate:nn,shared:Bt.shared,effects:Bt.effects},St.updateQueue=Lt;return}St=Lt.lastBaseUpdate,St===null?Lt.firstBaseUpdate=At:St.next=At,Lt.lastBaseUpdate=At}function j0(St,At,Lt,Bt){var Wt=St.updateQueue;m_=!1;var nn=Wt.firstBaseUpdate,Dn=Wt.lastBaseUpdate,Zn=Wt.shared.pending;if(Zn!==null){Wt.shared.pending=null;var xr=Zn,Kr=xr.next;xr.next=null,Dn===null?nn=Kr:Dn.next=Kr,Dn=xr;var mo=St.alternate;mo!==null&&(mo=mo.updateQueue,Zn=mo.lastBaseUpdate,Zn!==Dn&&(Zn===null?mo.firstBaseUpdate=Kr:Zn.next=Kr,mo.lastBaseUpdate=xr))}if(nn!==null){var Zo=Wt.baseState;Dn=0,mo=Kr=xr=null,Zn=nn;do{var Mo=Zn.lane,Zs=Zn.eventTime;if((Bt&Mo)===Mo){mo!==null&&(mo=mo.next={eventTime:Zs,lane:0,tag:Zn.tag,payload:Zn.payload,callback:Zn.callback,next:null});e:{var To=St,Uu=Zn;switch(Mo=At,Zs=Lt,Uu.tag){case 1:if(To=Uu.payload,typeof To=="function"){Zo=To.call(Zs,Zo,Mo);break e}Zo=To;break e;case 3:To.flags=To.flags&-65537|128;case 0:if(To=Uu.payload,Mo=typeof To=="function"?To.call(Zs,Zo,Mo):To,Mo==null)break e;Zo=at({},Zo,Mo);break e;case 2:m_=!0}}Zn.callback!==null&&Zn.lane!==0&&(St.flags|=64,Mo=Wt.effects,Mo===null?Wt.effects=[Zn]:Mo.push(Zn))}else Zs={eventTime:Zs,lane:Mo,tag:Zn.tag,payload:Zn.payload,callback:Zn.callback,next:null},mo===null?(Kr=mo=Zs,xr=Zo):mo=mo.next=Zs,Dn|=Mo;if(Zn=Zn.next,Zn===null){if(Zn=Wt.shared.pending,Zn===null)break;Mo=Zn,Zn=Mo.next,Mo.next=null,Wt.lastBaseUpdate=Mo,Wt.shared.pending=null}}while(1);if(mo===null&&(xr=Zo),Wt.baseState=xr,Wt.firstBaseUpdate=Kr,Wt.lastBaseUpdate=mo,At=Wt.shared.interleaved,At!==null){Wt=At;do Dn|=Wt.lane,Wt=Wt.next;while(Wt!==At)}else nn===null&&(Wt.shared.lanes=0);HE|=Dn,St.lanes=Dn,St.memoizedState=Zo}}function Q_(St,At,Lt){if(St=At.effects,At.effects=null,St!==null)for(At=0;At<St.length;At++){var Bt=St[At],Wt=Bt.callback;if(Wt!==null){if(Bt.callback=null,Bt=Lt,typeof Wt!="function")throw Error(lt(191,Wt));Wt.call(Bt)}}}var sC=new ot.Component().refs;function __(St,At,Lt,Bt){At=St.memoizedState,Lt=Lt(Bt,At),Lt=Lt==null?At:at({},At,Lt),St.memoizedState=Lt,St.lanes===0&&(St.updateQueue.baseState=Lt)}var xv={isMounted:function(St){return(St=St._reactInternals)?Kt(St)===St:!1},enqueueSetState:function(St,At,Lt){St=St._reactInternals;var Bt=yu(),Wt=zm(St),nn=Gm(Bt,Wt);nn.payload=At,Lt!=null&&(nn.callback=Lt),g_(St,nn),At=ku(St,Wt,Bt),At!==null&&H0(At,St,Wt)},enqueueReplaceState:function(St,At,Lt){St=St._reactInternals;var Bt=yu(),Wt=zm(St),nn=Gm(Bt,Wt);nn.tag=1,nn.payload=At,Lt!=null&&(nn.callback=Lt),g_(St,nn),At=ku(St,Wt,Bt),At!==null&&H0(At,St,Wt)},enqueueForceUpdate:function(St,At){St=St._reactInternals;var Lt=yu(),Bt=zm(St),Wt=Gm(Lt,Bt);Wt.tag=2,At!=null&&(Wt.callback=At),g_(St,Wt),At=ku(St,Bt,Lt),At!==null&&H0(At,St,Bt)}};function aC(St,At,Lt,Bt,Wt,nn,Dn){return St=St.stateNode,typeof St.shouldComponentUpdate=="function"?St.shouldComponentUpdate(Bt,nn,Dn):At.prototype&&At.prototype.isPureReactComponent?!Z_(Lt,Bt)||!Z_(Wt,nn):!0}function Ko(St,At,Lt){var Bt=!1,Wt=Go,nn=At.contextType;return typeof nn=="object"&&nn!==null?nn=Ol(nn):(Wt=ks(At)?_s:Ps.current,Bt=At.contextTypes,nn=(Bt=Bt!=null)?as(St,Wt):Go),At=new At(Lt,nn),St.memoizedState=At.state!==null&&At.state!==void 0?At.state:null,At.updater=xv,St.stateNode=At,At._reactInternals=St,Bt&&(St=St.stateNode,St.__reactInternalMemoizedUnmaskedChildContext=Wt,St.__reactInternalMemoizedMaskedChildContext=nn),At}function cC(St,At,Lt,Bt){St=At.state,typeof At.componentWillReceiveProps=="function"&&At.componentWillReceiveProps(Lt,Bt),typeof At.UNSAFE_componentWillReceiveProps=="function"&&At.UNSAFE_componentWillReceiveProps(Lt,Bt),At.state!==St&&xv.enqueueReplaceState(At,At.state,null)}function eT(St,At,Lt,Bt){var Wt=St.stateNode;Wt.props=Lt,Wt.state=St.memoizedState,Wt.refs=sC,Vm(St);var nn=At.contextType;typeof nn=="object"&&nn!==null?Wt.context=Ol(nn):(nn=ks(At)?_s:Ps.current,Wt.context=as(St,nn)),Wt.state=St.memoizedState,nn=At.getDerivedStateFromProps,typeof nn=="function"&&(__(St,At,nn,Lt),Wt.state=St.memoizedState),typeof At.getDerivedStateFromProps=="function"||typeof Wt.getSnapshotBeforeUpdate=="function"||typeof Wt.UNSAFE_componentWillMount!="function"&&typeof Wt.componentWillMount!="function"||(At=Wt.state,typeof Wt.componentWillMount=="function"&&Wt.componentWillMount(),typeof Wt.UNSAFE_componentWillMount=="function"&&Wt.UNSAFE_componentWillMount(),At!==Wt.state&&xv.enqueueReplaceState(Wt,Wt.state,null),j0(St,Lt,Wt,Bt),Wt.state=St.memoizedState),typeof Wt.componentDidMount=="function"&&(St.flags|=4194308)}var xE=[],OE=0,ME=null,z0=0,Rp=[],wp=0,$m=null,Hm=1,jm="";function E_(St,At){xE[OE++]=z0,xE[OE++]=ME,ME=St,z0=At}function lC(St,At,Lt){Rp[wp++]=Hm,Rp[wp++]=jm,Rp[wp++]=$m,$m=St;var Bt=Hm;St=jm;var Wt=32-ba(Bt)-1;Bt&=~(1<<Wt),Lt+=1;var nn=32-ba(At)+Wt;if(30<nn){var Dn=Wt-Wt%5;nn=(Bt&(1<<Dn)-1).toString(32),Bt>>=Dn,Wt-=Dn,Hm=1<<32-ba(At)+Wt|Lt<<Wt|Bt,jm=nn+St}else Hm=1<<nn|Lt<<Wt|Bt,jm=St}function hm(St){St.return!==null&&(E_(St,1),lC(St,1,0))}function tT(St){for(;St===ME;)ME=xE[--OE],xE[OE]=null,z0=xE[--OE],xE[OE]=null;for(;St===$m;)$m=Rp[--wp],Rp[wp]=null,jm=Rp[--wp],Rp[wp]=null,Hm=Rp[--wp],Rp[wp]=null}var mp=null,gp=null,El=!1,eE=!1,Wp=null;function uC(St,At){var Lt=vp(5,null,null,0);Lt.elementType="DELETED",Lt.stateNode=At,Lt.return=St,At=St.deletions,At===null?(St.deletions=[Lt],St.flags|=16):At.push(Lt)}function dC(St,At){switch(St.tag){case 5:return At=bo(At,St.type,St.pendingProps),At!==null?(St.stateNode=At,mp=St,gp=vo(At),!0):!1;case 6:return At=mu(At,St.pendingProps),At!==null?(St.stateNode=At,mp=St,gp=null,!0):!1;case 13:if(At=Xl(At),At!==null){var Lt=$m!==null?{id:Hm,overflow:jm}:null;return St.memoizedState={dehydrated:At,treeContext:Lt,retryLane:1073741824},Lt=vp(18,null,null,0),Lt.stateNode=At,Lt.return=St,St.child=Lt,mp=St,gp=null,!0}return!1;default:return!1}}function tp(St){return(St.mode&1)!==0&&(St.flags&128)===0}function nT(St){if(El){var At=gp;if(At){var Lt=At;if(!dC(St,At)){if(tp(St))throw Error(lt(418));At=Is(Lt);var Bt=mp;At&&dC(St,At)?uC(Bt,Lt):(St.flags=St.flags&-4097|2,El=!1,mp=St)}}else{if(tp(St))throw Error(lt(418));St.flags=St.flags&-4097|2,El=!1,mp=St}}}function hC(St){for(St=St.return;St!==null&&St.tag!==5&&St.tag!==3&&St.tag!==13;)St=St.return;mp=St}function Ov(St){if(!wn||St!==mp)return!1;if(!El)return hC(St),El=!0,!1;if(St.tag!==3&&(St.tag!==5||br(St.type)&&!jn(St.type,St.memoizedProps))){var At=gp;if(At){if(tp(St)){for(St=gp;St;)St=Is(St);throw Error(lt(418))}for(;At;)uC(St,At),At=Is(At)}}if(hC(St),St.tag===13){if(!wn)throw Error(lt(316));if(St=St.memoizedState,St=St!==null?St.dehydrated:null,!St)throw Error(lt(317));gp=Nn(St)}else gp=mp?Is(St.stateNode):null;return!0}function PE(){wn&&(gp=mp=null,eE=El=!1)}function W0(St){Wp===null?Wp=[St]:Wp.push(St)}function Mv(St,At,Lt){if(St=Lt.ref,St!==null&&typeof St!="function"&&typeof St!="object"){if(Lt._owner){if(Lt=Lt._owner,Lt){if(Lt.tag!==1)throw Error(lt(309));var Bt=Lt.stateNode}if(!Bt)throw Error(lt(147,St));var Wt=Bt,nn=""+St;return At!==null&&At.ref!==null&&typeof At.ref=="function"&&At.ref._stringRef===nn?At.ref:(At=function(Dn){var Zn=Wt.refs;Zn===sC&&(Zn=Wt.refs={}),Dn===null?delete Zn[nn]:Zn[nn]=Dn},At._stringRef=nn,At)}if(typeof St!="string")throw Error(lt(284));if(!Lt._owner)throw Error(lt(290,St))}return St}function K0(St,At){throw St=Object.prototype.toString.call(At),Error(lt(31,St==="[object Object]"?"object with keys {"+Object.keys(At).join(", ")+"}":St))}function rT(St){var At=St._init;return At(St._payload)}function Y0(St){function At(yr,er){if(St){var Ar=yr.deletions;Ar===null?(yr.deletions=[er],yr.flags|=16):Ar.push(er)}}function Lt(yr,er){if(!St)return null;for(;er!==null;)At(yr,er),er=er.sibling;return null}function Bt(yr,er){for(yr=new Map;er!==null;)er.key!==null?yr.set(er.key,er):yr.set(er.index,er),er=er.sibling;return yr}function Wt(yr,er){return yr=Ru(yr,er),yr.index=0,yr.sibling=null,yr}function nn(yr,er,Ar){return yr.index=Ar,St?(Ar=yr.alternate,Ar!==null?(Ar=Ar.index,Ar<er?(yr.flags|=2,er):Ar):(yr.flags|=2,er)):(yr.flags|=1048576,er)}function Dn(yr){return St&&yr.alternate===null&&(yr.flags|=2),yr}function Zn(yr,er,Ar,ao){return er===null||er.tag!==6?(er=Fy(Ar,yr.mode,ao),er.return=yr,er):(er=Wt(er,Ar),er.return=yr,er)}function xr(yr,er,Ar,ao){var So=Ar.type;return So===gt?mo(yr,er,Ar.props.children,ao,Ar.key):er!==null&&(er.elementType===So||typeof So=="object"&&So!==null&&So.$$typeof===Nt&&rT(So)===er.type)?(ao=Wt(er,Ar.props),ao.ref=Mv(yr,er,Ar),ao.return=yr,ao):(ao=Km(Ar.type,Ar.key,Ar.props,null,yr.mode,ao),ao.ref=Mv(yr,er,Ar),ao.return=yr,ao)}function Kr(yr,er,Ar,ao){return er===null||er.tag!==4||er.stateNode.containerInfo!==Ar.containerInfo||er.stateNode.implementation!==Ar.implementation?(er=Ym(Ar,yr.mode,ao),er.return=yr,er):(er=Wt(er,Ar.children||[]),er.return=yr,er)}function mo(yr,er,Ar,ao,So){return er===null||er.tag!==7?(er=yp(Ar,yr.mode,ao,So),er.return=yr,er):(er=Wt(er,Ar),er.return=yr,er)}function Zo(yr,er,Ar){if(typeof er=="string"&&er!==""||typeof er=="number")return er=Fy(""+er,yr.mode,Ar),er.return=yr,er;if(typeof er=="object"&&er!==null){switch(er.$$typeof){case ht:return Ar=Km(er.type,er.key,er.props,null,yr.mode,Ar),Ar.ref=Mv(yr,null,er),Ar.return=yr,Ar;case ft:return er=Ym(er,yr.mode,Ar),er.return=yr,er;case Nt:var ao=er._init;return Zo(yr,ao(er._payload),Ar)}if(Cn(er)||Ft(er))return er=yp(er,yr.mode,Ar,null),er.return=yr,er;K0(yr,er)}return null}function Mo(yr,er,Ar,ao){var So=er!==null?er.key:null;if(typeof Ar=="string"&&Ar!==""||typeof Ar=="number")return So!==null?null:Zn(yr,er,""+Ar,ao);if(typeof Ar=="object"&&Ar!==null){switch(Ar.$$typeof){case ht:return Ar.key===So?xr(yr,er,Ar,ao):null;case ft:return Ar.key===So?Kr(yr,er,Ar,ao):null;case Nt:return So=Ar._init,Mo(yr,er,So(Ar._payload),ao)}if(Cn(Ar)||Ft(Ar))return So!==null?null:mo(yr,er,Ar,ao,null);K0(yr,Ar)}return null}function Zs(yr,er,Ar,ao,So){if(typeof ao=="string"&&ao!==""||typeof ao=="number")return yr=yr.get(Ar)||null,Zn(er,yr,""+ao,So);if(typeof ao=="object"&&ao!==null){switch(ao.$$typeof){case ht:return yr=yr.get(ao.key===null?Ar:ao.key)||null,xr(er,yr,ao,So);case ft:return yr=yr.get(ao.key===null?Ar:ao.key)||null,Kr(er,yr,ao,So);case Nt:var cs=ao._init;return Zs(yr,er,Ar,cs(ao._payload),So)}if(Cn(ao)||Ft(ao))return yr=yr.get(Ar)||null,mo(er,yr,ao,So,null);K0(er,ao)}return null}function To(yr,er,Ar,ao){for(var So=null,cs=null,Qo=er,Us=er=0,eu=null;Qo!==null&&Us<Ar.length;Us++){Qo.index>Us?(eu=Qo,Qo=null):eu=Qo.sibling;var Bs=Mo(yr,Qo,Ar[Us],ao);if(Bs===null){Qo===null&&(Qo=eu);break}St&&Qo&&Bs.alternate===null&&At(yr,Qo),er=nn(Bs,er,Us),cs===null?So=Bs:cs.sibling=Bs,cs=Bs,Qo=eu}if(Us===Ar.length)return Lt(yr,Qo),El&&E_(yr,Us),So;if(Qo===null){for(;Us<Ar.length;Us++)Qo=Zo(yr,Ar[Us],ao),Qo!==null&&(er=nn(Qo,er,Us),cs===null?So=Qo:cs.sibling=Qo,cs=Qo);return El&&E_(yr,Us),So}for(Qo=Bt(yr,Qo);Us<Ar.length;Us++)eu=Zs(Qo,yr,Us,Ar[Us],ao),eu!==null&&(St&&eu.alternate!==null&&Qo.delete(eu.key===null?Us:eu.key),er=nn(eu,er,Us),cs===null?So=eu:cs.sibling=eu,cs=eu);return St&&Qo.forEach(function(R_){return At(yr,R_)}),El&&E_(yr,Us),So}function Uu(yr,er,Ar,ao){var So=Ft(Ar);if(typeof So!="function")throw Error(lt(150));if(Ar=So.call(Ar),Ar==null)throw Error(lt(151));for(var cs=So=null,Qo=er,Us=er=0,eu=null,Bs=Ar.next();Qo!==null&&!Bs.done;Us++,Bs=Ar.next()){Qo.index>Us?(eu=Qo,Qo=null):eu=Qo.sibling;var R_=Mo(yr,Qo,Bs.value,ao);if(R_===null){Qo===null&&(Qo=eu);break}St&&Qo&&R_.alternate===null&&At(yr,Qo),er=nn(R_,er,Us),cs===null?So=R_:cs.sibling=R_,cs=R_,Qo=eu}if(Bs.done)return Lt(yr,Qo),El&&E_(yr,Us),So;if(Qo===null){for(;!Bs.done;Us++,Bs=Ar.next())Bs=Zo(yr,Bs.value,ao),Bs!==null&&(er=nn(Bs,er,Us),cs===null?So=Bs:cs.sibling=Bs,cs=Bs);return El&&E_(yr,Us),So}for(Qo=Bt(yr,Qo);!Bs.done;Us++,Bs=Ar.next())Bs=Zs(Qo,yr,Us,Bs.value,ao),Bs!==null&&(St&&Bs.alternate!==null&&Qo.delete(Bs.key===null?Us:Bs.key),er=nn(Bs,er,Us),cs===null?So=Bs:cs.sibling=Bs,cs=Bs);return St&&Qo.forEach(function(X1){return At(yr,X1)}),El&&E_(yr,Us),So}function Mp(yr,er,Ar,ao){if(typeof Ar=="object"&&Ar!==null&&Ar.type===gt&&Ar.key===null&&(Ar=Ar.props.children),typeof Ar=="object"&&Ar!==null){switch(Ar.$$typeof){case ht:e:{for(var So=Ar.key,cs=er;cs!==null;){if(cs.key===So){if(So=Ar.type,So===gt){if(cs.tag===7){Lt(yr,cs.sibling),er=Wt(cs,Ar.props.children),er.return=yr,yr=er;break e}}else if(cs.elementType===So||typeof So=="object"&&So!==null&&So.$$typeof===Nt&&rT(So)===cs.type){Lt(yr,cs.sibling),er=Wt(cs,Ar.props),er.ref=Mv(yr,cs,Ar),er.return=yr,yr=er;break e}Lt(yr,cs);break}else At(yr,cs);cs=cs.sibling}Ar.type===gt?(er=yp(Ar.props.children,yr.mode,ao,Ar.key),er.return=yr,yr=er):(ao=Km(Ar.type,Ar.key,Ar.props,null,yr.mode,ao),ao.ref=Mv(yr,er,Ar),ao.return=yr,yr=ao)}return Dn(yr);case ft:e:{for(cs=Ar.key;er!==null;){if(er.key===cs)if(er.tag===4&&er.stateNode.containerInfo===Ar.containerInfo&&er.stateNode.implementation===Ar.implementation){Lt(yr,er.sibling),er=Wt(er,Ar.children||[]),er.return=yr,yr=er;break e}else{Lt(yr,er);break}else At(yr,er);er=er.sibling}er=Ym(Ar,yr.mode,ao),er.return=yr,yr=er}return Dn(yr);case Nt:return cs=Ar._init,Mp(yr,er,cs(Ar._payload),ao)}if(Cn(Ar))return To(yr,er,Ar,ao);if(Ft(Ar))return Uu(yr,er,Ar,ao);K0(yr,Ar)}return typeof Ar=="string"&&Ar!==""||typeof Ar=="number"?(Ar=""+Ar,er!==null&&er.tag===6?(Lt(yr,er.sibling),er=Wt(er,Ar),er.return=yr,yr=er):(Lt(yr,er),er=Fy(Ar,yr.mode,ao),er.return=yr,yr=er),Dn(yr)):Lt(yr,er)}return Mp}var NE=Y0(!0),pC=Y0(!1),v_={},Ip=eo(v_),Pv=eo(v_),DE=eo(v_);function bu(St){if(St===v_)throw Error(lt(174));return St}function iT(St,At){fo(DE,At),fo(Pv,St),fo(Ip,v_),St=Pn(At),Io(Ip),fo(Ip,St)}function LE(){Io(Ip),Io(Pv),Io(DE)}function Ku(St){var At=bu(DE.current),Lt=bu(Ip.current);At=yn(Lt,St.type,At),Lt!==At&&(fo(Pv,St),fo(Ip,At))}function oT(St){Pv.current===St&&(Io(Ip),Io(Pv))}var Ml=eo(0);function X0(St){for(var At=St;At!==null;){if(At.tag===13){var Lt=At.memoizedState;if(Lt!==null&&(Lt=Lt.dehydrated,Lt===null||ss(Lt)||js(Lt)))return At}else if(At.tag===19&&At.memoizedProps.revealOrder!==void 0){if(At.flags&128)return At}else if(At.child!==null){At.child.return=At,At=At.child;continue}if(At===St)break;for(;At.sibling===null;){if(At.return===null||At.return===St)return null;At=At.return}At.sibling.return=At.return,At=At.sibling}return null}var sT=[];function q0(){for(var St=0;St<sT.length;St++){var At=sT[St];Tr?At._workInProgressVersionPrimary=null:At._workInProgressVersionSecondary=null}sT.length=0}var J0=dt.ReactCurrentDispatcher,xp=dt.ReactCurrentBatchConfig,kE=0,Pl=null,Pu=null,Eu=null,UE=!1,tE=!1,Nv=0,Er=0;function Nu(){throw Error(lt(321))}function aT(St,At){if(At===null)return!1;for(var Lt=0;Lt<At.length&&Lt<St.length;Lt++)if(!pp(St[Lt],At[Lt]))return!1;return!0}function cT(St,At,Lt,Bt,Wt,nn){if(kE=nn,Pl=At,At.memoizedState=null,At.updateQueue=null,At.lanes=0,J0.current=St===null||St.memoizedState===null?AC:oy,St=Lt(Bt,Wt),tE){nn=0;do{if(tE=!1,Nv=0,25<=nn)throw Error(lt(301));nn+=1,Eu=Pu=null,At.updateQueue=null,J0.current=D1,St=Lt(Bt,Wt)}while(tE)}if(J0.current=iy,At=Pu!==null&&Pu.next!==null,kE=0,Eu=Pu=Pl=null,UE=!1,At)throw Error(lt(300));return St}function lT(){var St=Nv!==0;return Nv=0,St}function pm(){var St={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Eu===null?Pl.memoizedState=Eu=St:Eu=Eu.next=St,Eu}function Kp(){if(Pu===null){var St=Pl.alternate;St=St!==null?St.memoizedState:null}else St=Pu.next;var At=Eu===null?Pl.memoizedState:Eu.next;if(At!==null)Eu=At,Pu=St;else{if(St===null)throw Error(lt(310));Pu=St,St={memoizedState:Pu.memoizedState,baseState:Pu.baseState,baseQueue:Pu.baseQueue,queue:Pu.queue,next:null},Eu===null?Pl.memoizedState=Eu=St:Eu=Eu.next=St}return Eu}function y_(St,At){return typeof At=="function"?At(St):At}function Z0(St){var At=Kp(),Lt=At.queue;if(Lt===null)throw Error(lt(311));Lt.lastRenderedReducer=St;var Bt=Pu,Wt=Bt.baseQueue,nn=Lt.pending;if(nn!==null){if(Wt!==null){var Dn=Wt.next;Wt.next=nn.next,nn.next=Dn}Bt.baseQueue=Wt=nn,Lt.pending=null}if(Wt!==null){nn=Wt.next,Bt=Bt.baseState;var Zn=Dn=null,xr=null,Kr=nn;do{var mo=Kr.lane;if((kE&mo)===mo)xr!==null&&(xr=xr.next={lane:0,action:Kr.action,hasEagerState:Kr.hasEagerState,eagerState:Kr.eagerState,next:null}),Bt=Kr.hasEagerState?Kr.eagerState:St(Bt,Kr.action);else{var Zo={lane:mo,action:Kr.action,hasEagerState:Kr.hasEagerState,eagerState:Kr.eagerState,next:null};xr===null?(Zn=xr=Zo,Dn=Bt):xr=xr.next=Zo,Pl.lanes|=mo,HE|=mo}Kr=Kr.next}while(Kr!==null&&Kr!==nn);xr===null?Dn=Bt:xr.next=Zn,pp(Bt,At.memoizedState)||(Lu=!0),At.memoizedState=Bt,At.baseState=Dn,At.baseQueue=xr,Lt.lastRenderedState=Bt}if(St=Lt.interleaved,St!==null){Wt=St;do nn=Wt.lane,Pl.lanes|=nn,HE|=nn,Wt=Wt.next;while(Wt!==St)}else Wt===null&&(Lt.lanes=0);return[At.memoizedState,Lt.dispatch]}function Q0(St){var At=Kp(),Lt=At.queue;if(Lt===null)throw Error(lt(311));Lt.lastRenderedReducer=St;var Bt=Lt.dispatch,Wt=Lt.pending,nn=At.memoizedState;if(Wt!==null){Lt.pending=null;var Dn=Wt=Wt.next;do nn=St(nn,Dn.action),Dn=Dn.next;while(Dn!==Wt);pp(nn,At.memoizedState)||(Lu=!0),At.memoizedState=nn,At.baseQueue===null&&(At.baseState=nn),Lt.lastRenderedState=nn}return[nn,Bt]}function Dv(){}function BE(St,At){var Lt=Pl,Bt=Kp(),Wt=At(),nn=!pp(Bt.memoizedState,Wt);if(nn&&(Bt.memoizedState=Wt,Lu=!0),Bt=Bt.queue,Bv(Lv.bind(null,Lt,Bt,St),[St]),Bt.getSnapshot!==At||nn||Eu!==null&&Eu.memoizedState.tag&1){if(Lt.flags|=2048,kv(9,mC.bind(null,Lt,Bt,Wt,At),void 0,null),Jl===null)throw Error(lt(349));kE&30||fC(Lt,At,Wt)}return Wt}function fC(St,At,Lt){St.flags|=16384,St={getSnapshot:At,value:Lt},At=Pl.updateQueue,At===null?(At={lastEffect:null,stores:null},Pl.updateQueue=At,At.stores=[St]):(Lt=At.stores,Lt===null?At.stores=[St]:Lt.push(St))}function mC(St,At,Lt,Bt){At.value=Lt,At.getSnapshot=Bt,ey(At)&&ku(St,1,-1)}function Lv(St,At,Lt){return Lt(function(){ey(At)&&ku(St,1,-1)})}function ey(St){var At=St.getSnapshot;St=St.value;try{var Lt=At();return!pp(St,Lt)}catch{return!0}}function FE(St){var At=pm();return typeof St=="function"&&(St=St()),At.memoizedState=At.baseState=St,St={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:y_,lastRenderedState:St},At.queue=St,St=St.dispatch=N1.bind(null,Pl,St),[At.memoizedState,St]}function kv(St,At,Lt,Bt){return St={tag:St,create:At,destroy:Lt,deps:Bt,next:null},At=Pl.updateQueue,At===null?(At={lastEffect:null,stores:null},Pl.updateQueue=At,At.lastEffect=St.next=St):(Lt=At.lastEffect,Lt===null?At.lastEffect=St.next=St:(Bt=Lt.next,Lt.next=St,St.next=Bt,At.lastEffect=St)),St}function gC(){return Kp().memoizedState}function ty(St,At,Lt,Bt){var Wt=pm();Pl.flags|=St,Wt.memoizedState=kv(1|At,Lt,void 0,Bt===void 0?null:Bt)}function ny(St,At,Lt,Bt){var Wt=Kp();Bt=Bt===void 0?null:Bt;var nn=void 0;if(Pu!==null){var Dn=Pu.memoizedState;if(nn=Dn.destroy,Bt!==null&&aT(Bt,Dn.deps)){Wt.memoizedState=kv(At,Lt,nn,Bt);return}}Pl.flags|=St,Wt.memoizedState=kv(1|At,Lt,nn,Bt)}function Uv(St,At){return ty(8390656,8,St,At)}function Bv(St,At){return ny(2048,8,St,At)}function uT(St,At){return ny(4,2,St,At)}function _p(St,At){return ny(4,4,St,At)}function _C(St,At){if(typeof At=="function")return St=St(),At(St),function(){At(null)};if(At!=null)return St=St(),At.current=St,function(){At.current=null}}function VE(St,At,Lt){return Lt=Lt!=null?Lt.concat([St]):null,ny(4,4,_C.bind(null,At,St),Lt)}function dT(){}function EC(St,At){var Lt=Kp();At=At===void 0?null:At;var Bt=Lt.memoizedState;return Bt!==null&&At!==null&&aT(At,Bt[1])?Bt[0]:(Lt.memoizedState=[St,At],St)}function vC(St,At){var Lt=Kp();At=At===void 0?null:At;var Bt=Lt.memoizedState;return Bt!==null&&At!==null&&aT(At,Bt[1])?Bt[0]:(St=St(),Lt.memoizedState=[St,At],St)}function yC(St,At){var Lt=Es;Es=Lt!==0&&4>Lt?Lt:4,St(!0);var Bt=xp.transition;xp.transition={};try{St(!1),At()}finally{Es=Lt,xp.transition=Bt}}function SC(){return Kp().memoizedState}function P1(St,At,Lt){var Bt=zm(St);Lt={lane:Bt,action:Lt,hasEagerState:!1,eagerState:null,next:null},ry(St)?TC(At,Lt):(hT(St,At,Lt),Lt=yu(),St=ku(St,Bt,Lt),St!==null&&pT(St,At,Bt))}function N1(St,At,Lt){var Bt=zm(St),Wt={lane:Bt,action:Lt,hasEagerState:!1,eagerState:null,next:null};if(ry(St))TC(At,Wt);else{hT(St,At,Wt);var nn=St.alternate;if(St.lanes===0&&(nn===null||nn.lanes===0)&&(nn=At.lastRenderedReducer,nn!==null))try{var Dn=At.lastRenderedState,Zn=nn(Dn,Lt);if(Wt.hasEagerState=!0,Wt.eagerState=Zn,pp(Zn,Dn))return}catch{}finally{}Lt=yu(),St=ku(St,Bt,Lt),St!==null&&pT(St,At,Bt)}}function ry(St){var At=St.alternate;return St===Pl||At!==null&&At===Pl}function TC(St,At){tE=UE=!0;var Lt=St.pending;Lt===null?At.next=At:(At.next=Lt.next,Lt.next=At),St.pending=At}function hT(St,At,Lt){Jl!==null&&St.mode&1&&!(hs&2)?(St=At.interleaved,St===null?(Lt.next=Lt,fp===null?fp=[At]:fp.push(At)):(Lt.next=St.next,St.next=Lt),At.interleaved=Lt):(St=At.pending,St===null?Lt.next=Lt:(Lt.next=St.next,St.next=Lt),At.pending=Lt)}function pT(St,At,Lt){if(Lt&4194240){var Bt=At.lanes;Bt&=St.pendingLanes,Lt|=Bt,At.lanes=Lt,um(St,Lt)}}var iy={readContext:Ol,useCallback:Nu,useContext:Nu,useEffect:Nu,useImperativeHandle:Nu,useInsertionEffect:Nu,useLayoutEffect:Nu,useMemo:Nu,useReducer:Nu,useRef:Nu,useState:Nu,useDebugValue:Nu,useDeferredValue:Nu,useTransition:Nu,useMutableSource:Nu,useSyncExternalStore:Nu,useId:Nu,unstable_isNewReconciler:!1},AC={readContext:Ol,useCallback:function(St,At){return pm().memoizedState=[St,At===void 0?null:At],St},useContext:Ol,useEffect:Uv,useImperativeHandle:function(St,At,Lt){return Lt=Lt!=null?Lt.concat([St]):null,ty(4194308,4,_C.bind(null,At,St),Lt)},useLayoutEffect:function(St,At){return ty(4194308,4,St,At)},useInsertionEffect:function(St,At){return ty(4,2,St,At)},useMemo:function(St,At){var Lt=pm();return At=At===void 0?null:At,St=St(),Lt.memoizedState=[St,At],St},useReducer:function(St,At,Lt){var Bt=pm();return At=Lt!==void 0?Lt(At):At,Bt.memoizedState=Bt.baseState=At,St={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:St,lastRenderedState:At},Bt.queue=St,St=St.dispatch=P1.bind(null,Pl,St),[Bt.memoizedState,St]},useRef:function(St){var At=pm();return St={current:St},At.memoizedState=St},useState:FE,useDebugValue:dT,useDeferredValue:function(St){var At=FE(St),Lt=At[0],Bt=At[1];return Uv(function(){var Wt=xp.transition;xp.transition={};try{Bt(St)}finally{xp.transition=Wt}},[St]),Lt},useTransition:function(){var St=FE(!1),At=St[0];return St=yC.bind(null,St[1]),pm().memoizedState=St,[At,St]},useMutableSource:function(){},useSyncExternalStore:function(St,At,Lt){var Bt=Pl,Wt=pm();if(El){if(Lt===void 0)throw Error(lt(407));Lt=Lt()}else{if(Lt=At(),Jl===null)throw Error(lt(349));kE&30||fC(Bt,At,Lt)}Wt.memoizedState=Lt;var nn={value:Lt,getSnapshot:At};return Wt.queue=nn,Uv(Lv.bind(null,Bt,nn,St),[St]),Bt.flags|=2048,kv(9,mC.bind(null,Bt,nn,Lt,At),void 0,null),Lt},useId:function(){var St=pm(),At=Jl.identifierPrefix;if(El){var Lt=jm,Bt=Hm;Lt=(Bt&~(1<<32-ba(Bt)-1)).toString(32)+Lt,At=":"+At+"R"+Lt,Lt=Nv++,0<Lt&&(At+="H"+Lt.toString(32)),At+=":"}else Lt=Er++,At=":"+At+"r"+Lt.toString(32)+":";return St.memoizedState=At},unstable_isNewReconciler:!1},oy={readContext:Ol,useCallback:EC,useContext:Ol,useEffect:Bv,useImperativeHandle:VE,useInsertionEffect:uT,useLayoutEffect:_p,useMemo:vC,useReducer:Z0,useRef:gC,useState:function(){return Z0(y_)},useDebugValue:dT,useDeferredValue:function(St){var At=Z0(y_),Lt=At[0],Bt=At[1];return Bv(function(){var Wt=xp.transition;xp.transition={};try{Bt(St)}finally{xp.transition=Wt}},[St]),Lt},useTransition:function(){var St=Z0(y_)[0],At=Kp().memoizedState;return[St,At]},useMutableSource:Dv,useSyncExternalStore:BE,useId:SC,unstable_isNewReconciler:!1},D1={readContext:Ol,useCallback:EC,useContext:Ol,useEffect:Bv,useImperativeHandle:VE,useInsertionEffect:uT,useLayoutEffect:_p,useMemo:vC,useReducer:Q0,useRef:gC,useState:function(){return Q0(y_)},useDebugValue:dT,useDeferredValue:function(St){var At=Q0(y_),Lt=At[0],Bt=At[1];return Bv(function(){var Wt=xp.transition;xp.transition={};try{Bt(St)}finally{xp.transition=Wt}},[St]),Lt},useTransition:function(){var St=Q0(y_)[0],At=Kp().memoizedState;return[St,At]},useMutableSource:Dv,useSyncExternalStore:BE,useId:SC,unstable_isNewReconciler:!1};function fT(St,At){try{var Lt="",Bt=At;do Lt+=Gl(Bt),Bt=Bt.return;while(Bt);var Wt=Lt}catch(nn){Wt=`
Error generating stack: `+nn.message+`
`+nn.stack}return{value:St,source:At,stack:Wt}}function mT(St,At){try{console.error(At.value)}catch(Lt){setTimeout(function(){throw Lt})}}var L1=typeof WeakMap=="function"?WeakMap:Map;function CC(St,At,Lt){Lt=Gm(-1,Lt),Lt.tag=3,Lt.payload={element:null};var Bt=At.value;return Lt.callback=function(){Oy||(Oy=!0,OT=Bt),mT(St,At)},Lt}function gT(St,At,Lt){Lt=Gm(-1,Lt),Lt.tag=3;var Bt=St.type.getDerivedStateFromError;if(typeof Bt=="function"){var Wt=At.value;Lt.payload=function(){return Bt(Wt)},Lt.callback=function(){mT(St,At)}}var nn=St.stateNode;return nn!==null&&typeof nn.componentDidCatch=="function"&&(Lt.callback=function(){mT(St,At),typeof Bt!="function"&&(A_===null?A_=new Set([this]):A_.add(this));var Dn=At.stack;this.componentDidCatch(At.value,{componentStack:Dn!==null?Dn:""})}),Lt}function sy(St,At,Lt){var Bt=St.pingCache;if(Bt===null){Bt=St.pingCache=new L1;var Wt=new Set;Bt.set(At,Wt)}else Wt=Bt.get(At),Wt===void 0&&(Wt=new Set,Bt.set(At,Wt));Wt.has(Lt)||(Wt.add(Lt),St=YC.bind(null,St,At,Lt),At.then(St,St))}function bC(St){do{var At;if((At=St.tag===13)&&(At=St.memoizedState,At=At!==null?At.dehydrated!==null:!0),At)return St;St=St.return}while(St!==null);return null}function ay(St,At,Lt,Bt,Wt){return St.mode&1?(St.flags|=65536,St.lanes=Wt,St):(St===At?St.flags|=65536:(St.flags|=128,Lt.flags|=131072,Lt.flags&=-52805,Lt.tag===1&&(Lt.alternate===null?Lt.tag=17:(At=Gm(-1,1),At.tag=2,g_(Lt,At))),Lt.lanes|=1),St)}function fm(St){St.flags|=4}function RC(St,At){if(St!==null&&St.child===At.child)return!0;if(At.flags&16)return!1;for(St=At.child;St!==null;){if(St.flags&12854||St.subtreeFlags&12854)return!1;St=St.sibling}return!0}var Fv,Vv,cy,ly;if(Mn)Fv=function(St,At){for(var Lt=At.child;Lt!==null;){if(Lt.tag===5||Lt.tag===6)_n(St,Lt.stateNode);else if(Lt.tag!==4&&Lt.child!==null){Lt.child.return=Lt,Lt=Lt.child;continue}if(Lt===At)break;for(;Lt.sibling===null;){if(Lt.return===null||Lt.return===At)return;Lt=Lt.return}Lt.sibling.return=Lt.return,Lt=Lt.sibling}},Vv=function(){},cy=function(St,At,Lt,Bt,Wt){if(St=St.memoizedProps,St!==Bt){var nn=At.stateNode,Dn=bu(Ip.current);Lt=bn(nn,Lt,St,Bt,Wt,Dn),(At.updateQueue=Lt)&&fm(At)}},ly=function(St,At,Lt,Bt){Lt!==Bt&&fm(At)};else if(Zt){Fv=function(St,At,Lt,Bt){for(var Wt=At.child;Wt!==null;){if(Wt.tag===5){var nn=Wt.stateNode;Lt&&Bt&&(nn=Ms(nn,Wt.type,Wt.memoizedProps,Wt)),_n(St,nn)}else if(Wt.tag===6)nn=Wt.stateNode,Lt&&Bt&&(nn=ys(nn,Wt.memoizedProps,Wt)),_n(St,nn);else if(Wt.tag!==4){if(Wt.tag===22&&Wt.memoizedState!==null)nn=Wt.child,nn!==null&&(nn.return=Wt),Fv(St,Wt,!0,!0);else if(Wt.child!==null){Wt.child.return=Wt,Wt=Wt.child;continue}}if(Wt===At)break;for(;Wt.sibling===null;){if(Wt.return===null||Wt.return===At)return;Wt=Wt.return}Wt.sibling.return=Wt.return,Wt=Wt.sibling}};var wC=function(St,At,Lt,Bt){for(var Wt=At.child;Wt!==null;){if(Wt.tag===5){var nn=Wt.stateNode;Lt&&Bt&&(nn=Ms(nn,Wt.type,Wt.memoizedProps,Wt)),os(St,nn)}else if(Wt.tag===6)nn=Wt.stateNode,Lt&&Bt&&(nn=ys(nn,Wt.memoizedProps,Wt)),os(St,nn);else if(Wt.tag!==4){if(Wt.tag===22&&Wt.memoizedState!==null)nn=Wt.child,nn!==null&&(nn.return=Wt),wC(St,Wt,!0,!0);else if(Wt.child!==null){Wt.child.return=Wt,Wt=Wt.child;continue}}if(Wt===At)break;for(;Wt.sibling===null;){if(Wt.return===null||Wt.return===At)return;Wt=Wt.return}Wt.sibling.return=Wt.return,Wt=Wt.sibling}};Vv=function(St,At){var Lt=At.stateNode;if(!RC(St,At)){St=Lt.containerInfo;var Bt=ko(St);wC(Bt,At,!1,!1),Lt.pendingChildren=Bt,fm(At),Jo(St,Bt)}},cy=function(St,At,Lt,Bt,Wt){var nn=St.stateNode,Dn=St.memoizedProps;if((St=RC(St,At))&&Dn===Bt)At.stateNode=nn;else{var Zn=At.stateNode,xr=bu(Ip.current),Kr=null;Dn!==Bt&&(Kr=bn(Zn,Lt,Dn,Bt,Wt,xr)),St&&Kr===null?At.stateNode=nn:(nn=Qr(nn,Kr,Lt,Dn,Bt,At,St,Zn),Rn(nn,Lt,Bt,Wt,xr)&&fm(At),At.stateNode=nn,St?fm(At):Fv(nn,At,!1,!1))}},ly=function(St,At,Lt,Bt){Lt!==Bt?(St=bu(DE.current),Lt=bu(Ip.current),At.stateNode=kn(Bt,St,Lt,At),fm(At)):At.stateNode=St.stateNode}}else Vv=function(){},cy=function(){},ly=function(){};function Gv(St,At){if(!El)switch(St.tailMode){case"hidden":At=St.tail;for(var Lt=null;At!==null;)At.alternate!==null&&(Lt=At),At=At.sibling;Lt===null?St.tail=null:Lt.sibling=null;break;case"collapsed":Lt=St.tail;for(var Bt=null;Lt!==null;)Lt.alternate!==null&&(Bt=Lt),Lt=Lt.sibling;Bt===null?At||St.tail===null?St.tail=null:St.tail.sibling=null:Bt.sibling=null}}function Du(St){var At=St.alternate!==null&&St.alternate.child===St.child,Lt=0,Bt=0;if(At)for(var Wt=St.child;Wt!==null;)Lt|=Wt.lanes|Wt.childLanes,Bt|=Wt.subtreeFlags&14680064,Bt|=Wt.flags&14680064,Wt.return=St,Wt=Wt.sibling;else for(Wt=St.child;Wt!==null;)Lt|=Wt.lanes|Wt.childLanes,Bt|=Wt.subtreeFlags,Bt|=Wt.flags,Wt.return=St,Wt=Wt.sibling;return St.subtreeFlags|=Bt,St.childLanes=Lt,At}function k1(St,At,Lt){var Bt=At.pendingProps;switch(tT(At),At.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Du(At),null;case 1:return ks(At.type)&&xo(),Du(At),null;case 3:return Bt=At.stateNode,LE(),Io(Uo),Io(Ps),q0(),Bt.pendingContext&&(Bt.context=Bt.pendingContext,Bt.pendingContext=null),(St===null||St.child===null)&&(Ov(At)?fm(At):St===null||St.memoizedState.isDehydrated&&!(At.flags&256)||(At.flags|=1024,Wp!==null&&(zE(Wp),Wp=null))),Vv(St,At),Du(At),null;case 5:oT(At),Lt=bu(DE.current);var Wt=At.type;if(St!==null&&At.stateNode!=null)cy(St,At,Wt,Bt,Lt),St.ref!==At.ref&&(At.flags|=512,At.flags|=2097152);else{if(!Bt){if(At.stateNode===null)throw Error(lt(166));return Du(At),null}if(St=bu(Ip.current),Ov(At)){if(!wn)throw Error(lt(175));St=cn(At.stateNode,At.type,At.memoizedProps,Lt,St,At,!eE),At.updateQueue=St,St!==null&&fm(At)}else{var nn=gn(Wt,Bt,Lt,St,At);Fv(nn,At,!1,!1),At.stateNode=nn,Rn(nn,Wt,Bt,Lt,St)&&fm(At)}At.ref!==null&&(At.flags|=512,At.flags|=2097152)}return Du(At),null;case 6:if(St&&At.stateNode!=null)ly(St,At,St.memoizedProps,Bt);else{if(typeof Bt!="string"&&At.stateNode===null)throw Error(lt(166));if(St=bu(DE.current),Lt=bu(Ip.current),Ov(At)){if(!wn)throw Error(lt(176));if(St=At.stateNode,Bt=At.memoizedProps,(Lt=Xt(St,Bt,At,!eE))&&(Wt=mp,Wt!==null))switch(nn=(Wt.mode&1)!==0,Wt.tag){case 3:Rr(Wt.stateNode.containerInfo,St,Bt,nn);break;case 5:wr(Wt.type,Wt.memoizedProps,Wt.stateNode,St,Bt,nn)}Lt&&fm(At)}else At.stateNode=kn(Bt,St,Lt,At)}return Du(At),null;case 13:if(Io(Ml),Bt=At.memoizedState,El&&gp!==null&&At.mode&1&&!(At.flags&128)){for(St=gp;St;)St=Is(St);return PE(),At.flags|=98560,At}if(Bt!==null&&Bt.dehydrated!==null){if(Bt=Ov(At),St===null){if(!Bt)throw Error(lt(318));if(!wn)throw Error(lt(344));if(St=At.memoizedState,St=St!==null?St.dehydrated:null,!St)throw Error(lt(317));mn(St,At)}else PE(),!(At.flags&128)&&(At.memoizedState=null),At.flags|=4;return Du(At),null}return Wp!==null&&(zE(Wp),Wp=null),At.flags&128?(At.lanes=Lt,At):(Bt=Bt!==null,Lt=!1,St===null?Ov(At):Lt=St.memoizedState!==null,Bt&&!Lt&&(At.child.flags|=8192,At.mode&1&&(St===null||Ml.current&1?cu===0&&(cu=3):DT())),At.updateQueue!==null&&(At.flags|=4),Du(At),null);case 4:return LE(),Vv(St,At),St===null&&Hn(At.stateNode.containerInfo),Du(At),null;case 10:return _u(At.type._context),Du(At),null;case 17:return ks(At.type)&&xo(),Du(At),null;case 19:if(Io(Ml),Wt=At.memoizedState,Wt===null)return Du(At),null;if(Bt=(At.flags&128)!==0,nn=Wt.rendering,nn===null)if(Bt)Gv(Wt,!1);else{if(cu!==0||St!==null&&St.flags&128)for(St=At.child;St!==null;){if(nn=X0(St),nn!==null){for(At.flags|=128,Gv(Wt,!1),St=nn.updateQueue,St!==null&&(At.updateQueue=St,At.flags|=4),At.subtreeFlags=0,St=Lt,Bt=At.child;Bt!==null;)Lt=Bt,Wt=St,Lt.flags&=14680066,nn=Lt.alternate,nn===null?(Lt.childLanes=0,Lt.lanes=Wt,Lt.child=null,Lt.subtreeFlags=0,Lt.memoizedProps=null,Lt.memoizedState=null,Lt.updateQueue=null,Lt.dependencies=null,Lt.stateNode=null):(Lt.childLanes=nn.childLanes,Lt.lanes=nn.lanes,Lt.child=nn.child,Lt.subtreeFlags=0,Lt.deletions=null,Lt.memoizedProps=nn.memoizedProps,Lt.memoizedState=nn.memoizedState,Lt.updateQueue=nn.updateQueue,Lt.type=nn.type,Wt=nn.dependencies,Lt.dependencies=Wt===null?null:{lanes:Wt.lanes,firstContext:Wt.firstContext}),Bt=Bt.sibling;return fo(Ml,Ml.current&1|2),At.child}St=St.sibling}Wt.tail!==null&&Il()>xy&&(At.flags|=128,Bt=!0,Gv(Wt,!1),At.lanes=4194304)}else{if(!Bt)if(St=X0(nn),St!==null){if(At.flags|=128,Bt=!0,St=St.updateQueue,St!==null&&(At.updateQueue=St,At.flags|=4),Gv(Wt,!0),Wt.tail===null&&Wt.tailMode==="hidden"&&!nn.alternate&&!El)return Du(At),null}else 2*Il()-Wt.renderingStartTime>xy&&Lt!==1073741824&&(At.flags|=128,Bt=!0,Gv(Wt,!1),At.lanes=4194304);Wt.isBackwards?(nn.sibling=At.child,At.child=nn):(St=Wt.last,St!==null?St.sibling=nn:At.child=nn,Wt.last=nn)}return Wt.tail!==null?(At=Wt.tail,Wt.rendering=At,Wt.tail=At.sibling,Wt.renderingStartTime=Il(),At.sibling=null,St=Ml.current,fo(Ml,Bt?St&1|2:St&1),At):(Du(At),null);case 22:case 23:return NT(),Bt=At.memoizedState!==null,St!==null&&St.memoizedState!==null!==Bt&&(At.flags|=8192),Bt&&At.mode&1?Ep&1073741824&&(Du(At),Mn&&At.subtreeFlags&6&&(At.flags|=8192)):Du(At),null;case 24:return null;case 25:return null}throw Error(lt(156,At.tag))}var U1=dt.ReactCurrentOwner,Lu=!1;function vu(St,At,Lt,Bt){At.child=St===null?pC(At,null,Lt,Bt):NE(At,St.child,Lt,Bt)}function uy(St,At,Lt,Bt,Wt){Lt=Lt.render;var nn=At.ref;return xl(At,Wt),Bt=cT(St,At,Lt,Bt,nn,Wt),Lt=lT(),St!==null&&!Lu?(At.updateQueue=St.updateQueue,At.flags&=-2053,St.lanes&=~Wt,Yp(St,At,Wt)):(El&&Lt&&hm(At),At.flags|=1,vu(St,At,Bt,Wt),At.child)}function IC(St,At,Lt,Bt,Wt){if(St===null){var nn=Lt.type;return typeof nn=="function"&&!n0(nn)&&nn.defaultProps===void 0&&Lt.compare===null&&Lt.defaultProps===void 0?(At.tag=15,At.type=nn,xC(St,At,nn,Bt,Wt)):(St=Km(Lt.type,null,Bt,At,At.mode,Wt),St.ref=At.ref,St.return=At,At.child=St)}if(nn=St.child,!(St.lanes&Wt)){var Dn=nn.memoizedProps;if(Lt=Lt.compare,Lt=Lt!==null?Lt:Z_,Lt(Dn,Bt)&&St.ref===At.ref)return Yp(St,At,Wt)}return At.flags|=1,St=Ru(nn,Bt),St.ref=At.ref,St.return=At,At.child=St}function xC(St,At,Lt,Bt,Wt){if(St!==null&&Z_(St.memoizedProps,Bt)&&St.ref===At.ref)if(Lu=!1,(St.lanes&Wt)!==0)St.flags&131072&&(Lu=!0);else return At.lanes=St.lanes,Yp(St,At,Wt);return dy(St,At,Lt,Bt,Wt)}function OC(St,At,Lt){var Bt=At.pendingProps,Wt=Bt.children,nn=St!==null?St.memoizedState:null;if(Bt.mode==="hidden")if(!(At.mode&1))At.memoizedState={baseLanes:0,cachePool:null},fo($E,Ep),Ep|=Lt;else if(Lt&1073741824)At.memoizedState={baseLanes:0,cachePool:null},Bt=nn!==null?nn.baseLanes:Lt,fo($E,Ep),Ep|=Bt;else return St=nn!==null?nn.baseLanes|Lt:Lt,At.lanes=At.childLanes=1073741824,At.memoizedState={baseLanes:St,cachePool:null},At.updateQueue=null,fo($E,Ep),Ep|=St,null;else nn!==null?(Bt=nn.baseLanes|Lt,At.memoizedState=null):Bt=Lt,fo($E,Ep),Ep|=Bt;return vu(St,At,Wt,Lt),At.child}function _T(St,At){var Lt=At.ref;(St===null&&Lt!==null||St!==null&&St.ref!==Lt)&&(At.flags|=512,At.flags|=2097152)}function dy(St,At,Lt,Bt,Wt){var nn=ks(Lt)?_s:Ps.current;return nn=as(At,nn),xl(At,Wt),Lt=cT(St,At,Lt,Bt,nn,Wt),Bt=lT(),St!==null&&!Lu?(At.updateQueue=St.updateQueue,At.flags&=-2053,St.lanes&=~Wt,Yp(St,At,Wt)):(El&&Bt&&hm(At),At.flags|=1,vu(St,At,Lt,Wt),At.child)}function hy(St,At,Lt,Bt,Wt){if(ks(Lt)){var nn=!0;As(At)}else nn=!1;if(xl(At,Wt),At.stateNode===null)St!==null&&(St.alternate=null,At.alternate=null,At.flags|=2),Ko(At,Lt,Bt),eT(At,Lt,Bt,Wt),Bt=!0;else if(St===null){var Dn=At.stateNode,Zn=At.memoizedProps;Dn.props=Zn;var xr=Dn.context,Kr=Lt.contextType;typeof Kr=="object"&&Kr!==null?Kr=Ol(Kr):(Kr=ks(Lt)?_s:Ps.current,Kr=as(At,Kr));var mo=Lt.getDerivedStateFromProps,Zo=typeof mo=="function"||typeof Dn.getSnapshotBeforeUpdate=="function";Zo||typeof Dn.UNSAFE_componentWillReceiveProps!="function"&&typeof Dn.componentWillReceiveProps!="function"||(Zn!==Bt||xr!==Kr)&&cC(At,Dn,Bt,Kr),m_=!1;var Mo=At.memoizedState;Dn.state=Mo,j0(At,Bt,Dn,Wt),xr=At.memoizedState,Zn!==Bt||Mo!==xr||Uo.current||m_?(typeof mo=="function"&&(__(At,Lt,mo,Bt),xr=At.memoizedState),(Zn=m_||aC(At,Lt,Zn,Bt,Mo,xr,Kr))?(Zo||typeof Dn.UNSAFE_componentWillMount!="function"&&typeof Dn.componentWillMount!="function"||(typeof Dn.componentWillMount=="function"&&Dn.componentWillMount(),typeof Dn.UNSAFE_componentWillMount=="function"&&Dn.UNSAFE_componentWillMount()),typeof Dn.componentDidMount=="function"&&(At.flags|=4194308)):(typeof Dn.componentDidMount=="function"&&(At.flags|=4194308),At.memoizedProps=Bt,At.memoizedState=xr),Dn.props=Bt,Dn.state=xr,Dn.context=Kr,Bt=Zn):(typeof Dn.componentDidMount=="function"&&(At.flags|=4194308),Bt=!1)}else{Dn=At.stateNode,IE(St,At),Zn=At.memoizedProps,Kr=At.type===At.elementType?Zn:Wu(At.type,Zn),Dn.props=Kr,Zo=At.pendingProps,Mo=Dn.context,xr=Lt.contextType,typeof xr=="object"&&xr!==null?xr=Ol(xr):(xr=ks(Lt)?_s:Ps.current,xr=as(At,xr));var Zs=Lt.getDerivedStateFromProps;(mo=typeof Zs=="function"||typeof Dn.getSnapshotBeforeUpdate=="function")||typeof Dn.UNSAFE_componentWillReceiveProps!="function"&&typeof Dn.componentWillReceiveProps!="function"||(Zn!==Zo||Mo!==xr)&&cC(At,Dn,Bt,xr),m_=!1,Mo=At.memoizedState,Dn.state=Mo,j0(At,Bt,Dn,Wt);var To=At.memoizedState;Zn!==Zo||Mo!==To||Uo.current||m_?(typeof Zs=="function"&&(__(At,Lt,Zs,Bt),To=At.memoizedState),(Kr=m_||aC(At,Lt,Kr,Bt,Mo,To,xr)||!1)?(mo||typeof Dn.UNSAFE_componentWillUpdate!="function"&&typeof Dn.componentWillUpdate!="function"||(typeof Dn.componentWillUpdate=="function"&&Dn.componentWillUpdate(Bt,To,xr),typeof Dn.UNSAFE_componentWillUpdate=="function"&&Dn.UNSAFE_componentWillUpdate(Bt,To,xr)),typeof Dn.componentDidUpdate=="function"&&(At.flags|=4),typeof Dn.getSnapshotBeforeUpdate=="function"&&(At.flags|=1024)):(typeof Dn.componentDidUpdate!="function"||Zn===St.memoizedProps&&Mo===St.memoizedState||(At.flags|=4),typeof Dn.getSnapshotBeforeUpdate!="function"||Zn===St.memoizedProps&&Mo===St.memoizedState||(At.flags|=1024),At.memoizedProps=Bt,At.memoizedState=To),Dn.props=Bt,Dn.state=To,Dn.context=xr,Bt=Kr):(typeof Dn.componentDidUpdate!="function"||Zn===St.memoizedProps&&Mo===St.memoizedState||(At.flags|=4),typeof Dn.getSnapshotBeforeUpdate!="function"||Zn===St.memoizedProps&&Mo===St.memoizedState||(At.flags|=1024),Bt=!1)}return ET(St,At,Lt,Bt,nn,Wt)}function ET(St,At,Lt,Bt,Wt,nn){_T(St,At);var Dn=(At.flags&128)!==0;if(!Bt&&!Dn)return Wt&&zo(At,Lt,!1),Yp(St,At,nn);Bt=At.stateNode,U1.current=At;var Zn=Dn&&typeof Lt.getDerivedStateFromError!="function"?null:Bt.render();return At.flags|=1,St!==null&&Dn?(At.child=NE(At,St.child,null,nn),At.child=NE(At,null,Zn,nn)):vu(St,At,Zn,nn),At.memoizedState=Bt.state,Wt&&zo(At,Lt,!0),At.child}function MC(St){var At=St.stateNode;At.pendingContext?$o(St,At.pendingContext,At.pendingContext!==At.context):At.context&&$o(St,At.context,!1),iT(St,At.containerInfo)}function GE(St,At,Lt,Bt,Wt){return PE(),W0(Wt),At.flags|=256,vu(St,At,Lt,Bt),At.child}var fy={dehydrated:null,treeContext:null,retryLane:0};function my(St){return{baseLanes:St,cachePool:null}}function PC(St,At,Lt){var Bt=At.pendingProps,Wt=Ml.current,nn=!1,Dn=(At.flags&128)!==0,Zn;if((Zn=Dn)||(Zn=St!==null&&St.memoizedState===null?!1:(Wt&2)!==0),Zn?(nn=!0,At.flags&=-129):(St===null||St.memoizedState!==null)&&(Wt|=1),fo(Ml,Wt&1),St===null)return nT(At),St=At.memoizedState,St!==null&&(St=St.dehydrated,St!==null)?(At.mode&1?js(St)?At.lanes=8:At.lanes=1073741824:At.lanes=1,null):(Wt=Bt.children,St=Bt.fallback,nn?(Bt=At.mode,nn=At.child,Wt={mode:"hidden",children:Wt},!(Bt&1)&&nn!==null?(nn.childLanes=0,nn.pendingProps=Wt):nn=r0(Wt,Bt,0,null),St=yp(St,Bt,Lt,null),nn.return=At,St.return=At,nn.sibling=St,At.child=nn,At.child.memoizedState=my(Lt),At.memoizedState=fy,St):vT(At,Wt));if(Wt=St.memoizedState,Wt!==null){if(Zn=Wt.dehydrated,Zn!==null){if(Dn)return At.flags&256?(At.flags&=-257,$v(St,At,Lt,Error(lt(422)))):At.memoizedState!==null?(At.child=St.child,At.flags|=128,null):(nn=Bt.fallback,Wt=At.mode,Bt=r0({mode:"visible",children:Bt.children},Wt,0,null),nn=yp(nn,Wt,Lt,null),nn.flags|=2,Bt.return=At,nn.return=At,Bt.sibling=nn,At.child=Bt,At.mode&1&&NE(At,St.child,null,Lt),At.child.memoizedState=my(Lt),At.memoizedState=fy,nn);if(!(At.mode&1))At=$v(St,At,Lt,null);else if(js(Zn))At=$v(St,At,Lt,Error(lt(419)));else if(Bt=(Lt&St.childLanes)!==0,Lu||Bt){if(Bt=Jl,Bt!==null){switch(Lt&-Lt){case 4:nn=2;break;case 16:nn=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:nn=32;break;case 536870912:nn=268435456;break;default:nn=0}Bt=nn&(Bt.suspendedLanes|Lt)?0:nn,Bt!==0&&Bt!==Wt.retryLane&&(Wt.retryLane=Bt,ku(St,Bt,-1))}DT(),At=$v(St,At,Lt,Error(lt(421)))}else ss(Zn)?(At.flags|=128,At.child=St.child,At=z1.bind(null,St),_l(Zn,At),At=null):(Lt=Wt.treeContext,wn&&(gp=ju(Zn),mp=At,El=!0,Wp=null,eE=!1,Lt!==null&&(Rp[wp++]=Hm,Rp[wp++]=jm,Rp[wp++]=$m,Hm=Lt.id,jm=Lt.overflow,$m=At)),At=vT(At,At.pendingProps.children),At.flags|=4096);return At}return nn?(Bt=DC(St,At,Bt.children,Bt.fallback,Lt),nn=At.child,Wt=St.child.memoizedState,nn.memoizedState=Wt===null?my(Lt):{baseLanes:Wt.baseLanes|Lt,cachePool:null},nn.childLanes=St.childLanes&~Lt,At.memoizedState=fy,Bt):(Lt=NC(St,At,Bt.children,Lt),At.memoizedState=null,Lt)}return nn?(Bt=DC(St,At,Bt.children,Bt.fallback,Lt),nn=At.child,Wt=St.child.memoizedState,nn.memoizedState=Wt===null?my(Lt):{baseLanes:Wt.baseLanes|Lt,cachePool:null},nn.childLanes=St.childLanes&~Lt,At.memoizedState=fy,Bt):(Lt=NC(St,At,Bt.children,Lt),At.memoizedState=null,Lt)}function vT(St,At){return At=r0({mode:"visible",children:At},St.mode,0,null),At.return=St,St.child=At}function NC(St,At,Lt,Bt){var Wt=St.child;return St=Wt.sibling,Lt=Ru(Wt,{mode:"visible",children:Lt}),!(At.mode&1)&&(Lt.lanes=Bt),Lt.return=At,Lt.sibling=null,St!==null&&(Bt=At.deletions,Bt===null?(At.deletions=[St],At.flags|=16):Bt.push(St)),At.child=Lt}function DC(St,At,Lt,Bt,Wt){var nn=At.mode;St=St.child;var Dn=St.sibling,Zn={mode:"hidden",children:Lt};return!(nn&1)&&At.child!==St?(Lt=At.child,Lt.childLanes=0,Lt.pendingProps=Zn,At.deletions=null):(Lt=Ru(St,Zn),Lt.subtreeFlags=St.subtreeFlags&14680064),Dn!==null?Bt=Ru(Dn,Bt):(Bt=yp(Bt,nn,Wt,null),Bt.flags|=2),Bt.return=At,Lt.return=At,Lt.sibling=Bt,At.child=Lt,Bt}function $v(St,At,Lt,Bt){return Bt!==null&&W0(Bt),NE(At,St.child,null,Lt),St=vT(At,At.pendingProps.children),St.flags|=2,At.memoizedState=null,St}function LC(St,At,Lt){St.lanes|=At;var Bt=St.alternate;Bt!==null&&(Bt.lanes|=At),Cu(St.return,At,Lt)}function yT(St,At,Lt,Bt,Wt){var nn=St.memoizedState;nn===null?St.memoizedState={isBackwards:At,rendering:null,renderingStartTime:0,last:Bt,tail:Lt,tailMode:Wt}:(nn.isBackwards=At,nn.rendering=null,nn.renderingStartTime=0,nn.last=Bt,nn.tail=Lt,nn.tailMode=Wt)}function kC(St,At,Lt){var Bt=At.pendingProps,Wt=Bt.revealOrder,nn=Bt.tail;if(vu(St,At,Bt.children,Lt),Bt=Ml.current,Bt&2)Bt=Bt&1|2,At.flags|=128;else{if(St!==null&&St.flags&128)e:for(St=At.child;St!==null;){if(St.tag===13)St.memoizedState!==null&&LC(St,Lt,At);else if(St.tag===19)LC(St,Lt,At);else if(St.child!==null){St.child.return=St,St=St.child;continue}if(St===At)break e;for(;St.sibling===null;){if(St.return===null||St.return===At)break e;St=St.return}St.sibling.return=St.return,St=St.sibling}Bt&=1}if(fo(Ml,Bt),!(At.mode&1))At.memoizedState=null;else switch(Wt){case"forwards":for(Lt=At.child,Wt=null;Lt!==null;)St=Lt.alternate,St!==null&&X0(St)===null&&(Wt=Lt),Lt=Lt.sibling;Lt=Wt,Lt===null?(Wt=At.child,At.child=null):(Wt=Lt.sibling,Lt.sibling=null),yT(At,!1,Wt,Lt,nn);break;case"backwards":for(Lt=null,Wt=At.child,At.child=null;Wt!==null;){if(St=Wt.alternate,St!==null&&X0(St)===null){At.child=Wt;break}St=Wt.sibling,Wt.sibling=Lt,Lt=Wt,Wt=St}yT(At,!0,Lt,null,nn);break;case"together":yT(At,!1,null,null,void 0);break;default:At.memoizedState=null}return At.child}function Yp(St,At,Lt){if(St!==null&&(At.dependencies=St.dependencies),HE|=At.lanes,!(Lt&At.childLanes))return null;if(St!==null&&At.child!==St.child)throw Error(lt(153));if(At.child!==null){for(St=At.child,Lt=Ru(St,St.pendingProps),At.child=Lt,Lt.return=At;St.sibling!==null;)St=St.sibling,Lt=Lt.sibling=Ru(St,St.pendingProps),Lt.return=At;Lt.sibling=null}return At.child}function B1(St,At,Lt){switch(At.tag){case 3:MC(At),PE();break;case 5:Ku(At);break;case 1:ks(At.type)&&As(At);break;case 4:iT(At,At.stateNode.containerInfo);break;case 10:wE(At,At.type._context,At.memoizedProps.value);break;case 13:var Bt=At.memoizedState;if(Bt!==null)return Bt.dehydrated!==null?(fo(Ml,Ml.current&1),At.flags|=128,null):Lt&At.child.childLanes?PC(St,At,Lt):(fo(Ml,Ml.current&1),St=Yp(St,At,Lt),St!==null?St.sibling:null);fo(Ml,Ml.current&1);break;case 19:if(Bt=(Lt&At.childLanes)!==0,St.flags&128){if(Bt)return kC(St,At,Lt);At.flags|=128}var Wt=At.memoizedState;if(Wt!==null&&(Wt.rendering=null,Wt.tail=null,Wt.lastEffect=null),fo(Ml,Ml.current),Bt)break;return null;case 22:case 23:return At.lanes=0,OC(St,At,Lt)}return Yp(St,At,Lt)}function F1(St,At){switch(tT(At),At.tag){case 1:return ks(At.type)&&xo(),St=At.flags,St&65536?(At.flags=St&-65537|128,At):null;case 3:return LE(),Io(Uo),Io(Ps),q0(),St=At.flags,St&65536&&!(St&128)?(At.flags=St&-65537|128,At):null;case 5:return oT(At),null;case 13:if(Io(Ml),St=At.memoizedState,St!==null&&St.dehydrated!==null){if(At.alternate===null)throw Error(lt(340));PE()}return St=At.flags,St&65536?(At.flags=St&-65537|128,At):null;case 19:return Io(Ml),null;case 4:return LE(),null;case 10:return _u(At.type._context),null;case 22:case 23:return NT(),null;case 24:return null;default:return null}}var nE=!1,rE=!1,V1=typeof WeakSet=="function"?WeakSet:Set,ro=null;function gy(St,At){var Lt=St.ref;if(Lt!==null)if(typeof Lt=="function")try{Lt(null)}catch(Bt){rp(St,At,Bt)}else Lt.current=null}function ST(St,At,Lt){try{Lt()}catch(Bt){rp(St,At,Bt)}}var UC=!1;function Ey(St,At){for(An(St.containerInfo),ro=At;ro!==null;)if(St=ro,At=St.child,(St.subtreeFlags&1028)!==0&&At!==null)At.return=St,ro=At;else for(;ro!==null;){St=ro;try{var Lt=St.alternate;if(St.flags&1024)switch(St.tag){case 0:case 11:case 15:break;case 1:if(Lt!==null){var Bt=Lt.memoizedProps,Wt=Lt.memoizedState,nn=St.stateNode,Dn=nn.getSnapshotBeforeUpdate(St.elementType===St.type?Bt:Wu(St.type,Bt),Wt);nn.__reactInternalSnapshotBeforeUpdate=Dn}break;case 3:Mn&&Wr(St.stateNode.containerInfo);break;case 5:case 6:case 4:case 17:break;default:throw Error(lt(163))}}catch(Zn){rp(St,St.return,Zn)}if(At=St.sibling,At!==null){At.return=St.return,ro=At;break}ro=St.return}return Lt=UC,UC=!1,Lt}function S_(St,At,Lt){var Bt=At.updateQueue;if(Bt=Bt!==null?Bt.lastEffect:null,Bt!==null){var Wt=Bt=Bt.next;do{if((Wt.tag&St)===St){var nn=Wt.destroy;Wt.destroy=void 0,nn!==void 0&&ST(At,Lt,nn)}Wt=Wt.next}while(Wt!==Bt)}}function Hv(St,At){if(At=At.updateQueue,At=At!==null?At.lastEffect:null,At!==null){var Lt=At=At.next;do{if((Lt.tag&St)===St){var Bt=Lt.create;Lt.destroy=Bt()}Lt=Lt.next}while(Lt!==At)}}function TT(St){var At=St.ref;if(At!==null){var Lt=St.stateNode;switch(St.tag){case 5:St=On(Lt);break;default:St=Lt}typeof At=="function"?At(St):At.current=St}}function AT(St,At,Lt){if(hp&&typeof hp.onCommitFiberUnmount=="function")try{hp.onCommitFiberUnmount(q_,At)}catch{}switch(At.tag){case 0:case 11:case 14:case 15:if(St=At.updateQueue,St!==null&&(St=St.lastEffect,St!==null)){var Bt=St=St.next;do{var Wt=Bt,nn=Wt.destroy;Wt=Wt.tag,nn!==void 0&&(Wt&2||Wt&4)&&ST(At,Lt,nn),Bt=Bt.next}while(Bt!==St)}break;case 1:if(gy(At,Lt),St=At.stateNode,typeof St.componentWillUnmount=="function")try{St.props=At.memoizedProps,St.state=At.memoizedState,St.componentWillUnmount()}catch(Dn){rp(At,Lt,Dn)}break;case 5:gy(At,Lt);break;case 4:Mn?CT(St,At,Lt):Zt&&Zt&&(At=At.stateNode.containerInfo,Lt=ko(At),ws(At,Lt))}}function BC(St,At,Lt){for(var Bt=At;;)if(AT(St,Bt,Lt),Bt.child===null||Mn&&Bt.tag===4){if(Bt===At)break;for(;Bt.sibling===null;){if(Bt.return===null||Bt.return===At)return;Bt=Bt.return}Bt.sibling.return=Bt.return,Bt=Bt.sibling}else Bt.child.return=Bt,Bt=Bt.child}function FC(St){var At=St.alternate;At!==null&&(St.alternate=null,FC(At)),St.child=null,St.deletions=null,St.sibling=null,St.tag===5&&(At=St.stateNode,At!==null&&cr(At)),St.stateNode=null,St.return=null,St.dependencies=null,St.memoizedProps=null,St.memoizedState=null,St.pendingProps=null,St.stateNode=null,St.updateQueue=null}function VC(St){return St.tag===5||St.tag===3||St.tag===4}function vy(St){e:for(;;){for(;St.sibling===null;){if(St.return===null||VC(St.return))return null;St=St.return}for(St.sibling.return=St.return,St=St.sibling;St.tag!==5&&St.tag!==6&&St.tag!==18;){if(St.flags&2||St.child===null||St.tag===4)continue e;St.child.return=St,St=St.child}if(!(St.flags&2))return St.stateNode}}function yy(St){if(Mn){e:{for(var At=St.return;At!==null;){if(VC(At))break e;At=At.return}throw Error(lt(160))}var Lt=At;switch(Lt.tag){case 5:At=Lt.stateNode,Lt.flags&32&&(Zr(At),Lt.flags&=-33),Lt=vy(St),jv(St,Lt,At);break;case 3:case 4:At=Lt.stateNode.containerInfo,Lt=vy(St),Sy(St,Lt,At);break;default:throw Error(lt(161))}}}function Sy(St,At,Lt){var Bt=St.tag;if(Bt===5||Bt===6)St=St.stateNode,At?Nr(Lt,St,At):Fr(Lt,St);else if(Bt!==4&&(St=St.child,St!==null))for(Sy(St,At,Lt),St=St.sibling;St!==null;)Sy(St,At,Lt),St=St.sibling}function jv(St,At,Lt){var Bt=St.tag;if(Bt===5||Bt===6)St=St.stateNode,At?zr(Lt,St,At):vr(Lt,St);else if(Bt!==4&&(St=St.child,St!==null))for(jv(St,At,Lt),St=St.sibling;St!==null;)jv(St,At,Lt),St=St.sibling}function CT(St,At,Lt){for(var Bt=At,Wt=!1,nn,Dn;;){if(!Wt){Wt=Bt.return;e:for(;;){if(Wt===null)throw Error(lt(160));switch(nn=Wt.stateNode,Wt.tag){case 5:Dn=!1;break e;case 3:nn=nn.containerInfo,Dn=!0;break e;case 4:nn=nn.containerInfo,Dn=!0;break e}Wt=Wt.return}Wt=!0}if(Bt.tag===5||Bt.tag===6)BC(St,Bt,Lt),Dn?Ur(nn,Bt.stateNode):Or(nn,Bt.stateNode);else if(Bt.tag===18)Dn?gr(nn,Bt.stateNode):mr(nn,Bt.stateNode);else if(Bt.tag===4){if(Bt.child!==null){nn=Bt.stateNode.containerInfo,Dn=!0,Bt.child.return=Bt,Bt=Bt.child;continue}}else if(AT(St,Bt,Lt),Bt.child!==null){Bt.child.return=Bt,Bt=Bt.child;continue}if(Bt===At)break;for(;Bt.sibling===null;){if(Bt.return===null||Bt.return===At)return;Bt=Bt.return,Bt.tag===4&&(Wt=!1)}Bt.sibling.return=Bt.return,Bt=Bt.sibling}}function Ty(St,At){if(Mn){switch(At.tag){case 0:case 11:case 14:case 15:S_(3,At,At.return),Hv(3,At),S_(5,At,At.return);return;case 1:return;case 5:var Lt=At.stateNode;if(Lt!=null){var Bt=At.memoizedProps;St=St!==null?St.memoizedProps:Bt;var Wt=At.type,nn=At.updateQueue;At.updateQueue=null,nn!==null&&Hr(Lt,nn,Wt,St,Bt,At)}return;case 6:if(At.stateNode===null)throw Error(lt(162));Lt=At.memoizedProps,Gr(At.stateNode,St!==null?St.memoizedProps:Lt,Lt);return;case 3:wn&&St!==null&&St.memoizedState.isDehydrated&&In(At.stateNode.containerInfo);return;case 12:return;case 13:iE(At);return;case 19:iE(At);return;case 17:return}throw Error(lt(163))}switch(At.tag){case 0:case 11:case 14:case 15:S_(3,At,At.return),Hv(3,At),S_(5,At,At.return);return;case 12:return;case 13:iE(At);return;case 19:iE(At);return;case 3:wn&&St!==null&&St.memoizedState.isDehydrated&&In(At.stateNode.containerInfo);break;case 22:case 23:return}e:if(Zt){switch(At.tag){case 1:case 5:case 6:break e;case 3:case 4:At=At.stateNode,ws(At.containerInfo,At.pendingChildren);break e}throw Error(lt(163))}}function iE(St){var At=St.updateQueue;if(At!==null){St.updateQueue=null;var Lt=St.stateNode;Lt===null&&(Lt=St.stateNode=new V1),At.forEach(function(Bt){var Wt=kT.bind(null,St,Bt);Lt.has(Bt)||(Lt.add(Bt),Bt.then(Wt,Wt))})}}function zv(St,At){for(ro=At;ro!==null;){At=ro;var Lt=At.deletions;if(Lt!==null)for(var Bt=0;Bt<Lt.length;Bt++){var Wt=Lt[Bt];try{var nn=St;Mn?CT(nn,Wt,At):BC(nn,Wt,At);var Dn=Wt.alternate;Dn!==null&&(Dn.return=null),Wt.return=null}catch(So){rp(Wt,At,So)}}if(Lt=At.child,At.subtreeFlags&12854&&Lt!==null)Lt.return=At,ro=Lt;else for(;ro!==null;){At=ro;try{var Zn=At.flags;if(Zn&32&&Mn&&Zr(At.stateNode),Zn&512){var xr=At.alternate;if(xr!==null){var Kr=xr.ref;Kr!==null&&(typeof Kr=="function"?Kr(null):Kr.current=null)}}if(Zn&8192)switch(At.tag){case 13:if(At.memoizedState!==null){var mo=At.alternate;(mo===null||mo.memoizedState===null)&&(xT=Il())}break;case 22:var Zo=At.memoizedState!==null,Mo=At.alternate,Zs=Mo!==null&&Mo.memoizedState!==null;if(Lt=At,Mn){e:if(Bt=Lt,Wt=Zo,nn=null,Mn)for(var To=Bt;;){if(To.tag===5){if(nn===null){nn=To;var Uu=To.stateNode;Wt?oo(Uu):ar(To.stateNode,To.memoizedProps)}}else if(To.tag===6){if(nn===null){var Mp=To.stateNode;Wt?zn(Mp):pr(Mp,To.memoizedProps)}}else if((To.tag!==22&&To.tag!==23||To.memoizedState===null||To===Bt)&&To.child!==null){To.child.return=To,To=To.child;continue}if(To===Bt)break;for(;To.sibling===null;){if(To.return===null||To.return===Bt)break e;nn===To&&(nn=null),To=To.return}nn===To&&(nn=null),To.sibling.return=To.return,To=To.sibling}}if(Zo&&!Zs&&Lt.mode&1){ro=Lt;for(var yr=Lt.child;yr!==null;){for(Lt=ro=yr;ro!==null;){Bt=ro;var er=Bt.child;switch(Bt.tag){case 0:case 11:case 14:case 15:S_(4,Bt,Bt.return);break;case 1:gy(Bt,Bt.return);var Ar=Bt.stateNode;if(typeof Ar.componentWillUnmount=="function"){var ao=Bt.return;try{Ar.props=Bt.memoizedProps,Ar.state=Bt.memoizedState,Ar.componentWillUnmount()}catch(So){rp(Bt,ao,So)}}break;case 5:gy(Bt,Bt.return);break;case 22:if(Bt.memoizedState!==null){$C(Lt);continue}}er!==null?(er.return=Bt,ro=er):$C(Lt)}yr=yr.sibling}}}switch(Zn&4102){case 2:yy(At),At.flags&=-3;break;case 6:yy(At),At.flags&=-3,Ty(At.alternate,At);break;case 4096:At.flags&=-4097;break;case 4100:At.flags&=-4097,Ty(At.alternate,At);break;case 4:Ty(At.alternate,At)}}catch(So){rp(At,At.return,So)}if(Lt=At.sibling,Lt!==null){Lt.return=At.return,ro=Lt;break}ro=At.return}}}function G1(St,At,Lt){ro=St,GC(St)}function GC(St,At,Lt){for(var Bt=(St.mode&1)!==0;ro!==null;){var Wt=ro,nn=Wt.child;if(Wt.tag===22&&Bt){var Dn=Wt.memoizedState!==null||nE;if(!Dn){var Zn=Wt.alternate,xr=Zn!==null&&Zn.memoizedState!==null||rE;Zn=nE;var Kr=rE;if(nE=Dn,(rE=xr)&&!Kr)for(ro=Wt;ro!==null;)Dn=ro,xr=Dn.child,Dn.tag===22&&Dn.memoizedState!==null?HC(Wt):xr!==null?(xr.return=Dn,ro=xr):HC(Wt);for(;nn!==null;)ro=nn,GC(nn),nn=nn.sibling;ro=Wt,nE=Zn,rE=Kr}bT(St)}else Wt.subtreeFlags&8772&&nn!==null?(nn.return=Wt,ro=nn):bT(St)}}function bT(St){for(;ro!==null;){var At=ro;if(At.flags&8772){var Lt=At.alternate;try{if(At.flags&8772)switch(At.tag){case 0:case 11:case 15:rE||Hv(5,At);break;case 1:var Bt=At.stateNode;if(At.flags&4&&!rE)if(Lt===null)Bt.componentDidMount();else{var Wt=At.elementType===At.type?Lt.memoizedProps:Wu(At.type,Lt.memoizedProps);Bt.componentDidUpdate(Wt,Lt.memoizedState,Bt.__reactInternalSnapshotBeforeUpdate)}var nn=At.updateQueue;nn!==null&&Q_(At,nn,Bt);break;case 3:var Dn=At.updateQueue;if(Dn!==null){if(Lt=null,At.child!==null)switch(At.child.tag){case 5:Lt=On(At.child.stateNode);break;case 1:Lt=At.child.stateNode}Q_(At,Dn,Lt)}break;case 5:var Zn=At.stateNode;Lt===null&&At.flags&4&&dr(Zn,At.type,At.memoizedProps,At);break;case 6:break;case 4:break;case 12:break;case 13:if(wn&&At.memoizedState===null){var xr=At.alternate;if(xr!==null){var Kr=xr.memoizedState;if(Kr!==null){var mo=Kr.dehydrated;mo!==null&&Un(mo)}}}break;case 19:case 17:case 21:case 22:case 23:break;default:throw Error(lt(163))}rE||At.flags&512&&TT(At)}catch(Zo){rp(At,At.return,Zo)}}if(At===St){ro=null;break}if(Lt=At.sibling,Lt!==null){Lt.return=At.return,ro=Lt;break}ro=At.return}}function $C(St){for(;ro!==null;){var At=ro;if(At===St){ro=null;break}var Lt=At.sibling;if(Lt!==null){Lt.return=At.return,ro=Lt;break}ro=At.return}}function HC(St){for(;ro!==null;){var At=ro;try{switch(At.tag){case 0:case 11:case 15:var Lt=At.return;try{Hv(4,At)}catch(xr){rp(At,Lt,xr)}break;case 1:var Bt=At.stateNode;if(typeof Bt.componentDidMount=="function"){var Wt=At.return;try{Bt.componentDidMount()}catch(xr){rp(At,Wt,xr)}}var nn=At.return;try{TT(At)}catch(xr){rp(At,nn,xr)}break;case 5:var Dn=At.return;try{TT(At)}catch(xr){rp(At,Dn,xr)}}}catch(xr){rp(At,At.return,xr)}if(At===St){ro=null;break}var Zn=At.sibling;if(Zn!==null){Zn.return=At.return,ro=Zn;break}ro=At.return}}var Wv=0,Ay=1,Cy=2,by=3,Ry=4;if(typeof Symbol=="function"&&Symbol.for){var Kv=Symbol.for;Wv=Kv("selector.component"),Ay=Kv("selector.has_pseudo_class"),Cy=Kv("selector.role"),by=Kv("selector.test_id"),Ry=Kv("selector.text")}function RT(St){var At=xn(St);if(At!=null){if(typeof At.memoizedProps["data-testname"]!="string")throw Error(lt(364));return At}if(St=ir(St),St===null)throw Error(lt(362));return St.stateNode.current}function wy(St,At){switch(At.$$typeof){case Wv:if(St.type===At.value)return!0;break;case Ay:e:{At=At.value,St=[St,0];for(var Lt=0;Lt<St.length;){var Bt=St[Lt++],Wt=St[Lt++],nn=At[Wt];if(Bt.tag!==5||!sn(Bt)){for(;nn!=null&&wy(Bt,nn);)Wt++,nn=At[Wt];if(Wt===At.length){At=!0;break e}else for(Bt=Bt.child;Bt!==null;)St.push(Bt,Wt),Bt=Bt.sibling}}At=!1}return At;case Cy:if(St.tag===5&&Kn(St.stateNode,At.value))return!0;break;case Ry:if((St.tag===5||St.tag===6)&&(St=un(St),St!==null&&0<=St.indexOf(At.value)))return!0;break;case by:if(St.tag===5&&(St=St.memoizedProps["data-testname"],typeof St=="string"&&St.toLowerCase()===At.value.toLowerCase()))return!0;break;default:throw Error(lt(365))}return!1}function T_(St){switch(St.$$typeof){case Wv:return"<"+(zt(St.value)||"Unknown")+">";case Ay:return":has("+(T_(St)||"")+")";case Cy:return'[role="'+St.value+'"]';case Ry:return'"'+St.value+'"';case by:return'[data-testname="'+St.value+'"]';default:throw Error(lt(365))}}function jC(St,At){var Lt=[];St=[St,0];for(var Bt=0;Bt<St.length;){var Wt=St[Bt++],nn=St[Bt++],Dn=At[nn];if(Wt.tag!==5||!sn(Wt)){for(;Dn!=null&&wy(Wt,Dn);)nn++,Dn=At[nn];if(nn===At.length)Lt.push(Wt);else for(Wt=Wt.child;Wt!==null;)St.push(Wt,nn),Wt=Wt.sibling}}return Lt}function wT(St,At){if(!sr)throw Error(lt(363));St=RT(St),St=jC(St,At),At=[],St=Array.from(St);for(var Lt=0;Lt<St.length;){var Bt=St[Lt++];if(Bt.tag===5)sn(Bt)||At.push(Bt.stateNode);else for(Bt=Bt.child;Bt!==null;)St.push(Bt),Bt=Bt.sibling}return At}var $1=Math.ceil,Yv=dt.ReactCurrentDispatcher,IT=dt.ReactCurrentOwner,Ll=dt.ReactCurrentBatchConfig,hs=0,Jl=null,Zl=null,Ql=0,Ep=0,$E=eo(0),cu=0,Xv=null,HE=0,Iy=0,qv=0,Jv=null,Yu=null,xT=0,xy=1/0;function jE(){xy=Il()+500}var Oy=!1,OT=null,A_=null,My=!1,C_=null,Zv=0,Qv=0,MT=null,e0=-1,Py=0;function yu(){return hs&6?Il():e0!==-1?e0:e0=Il()}function zm(St){return St.mode&1?hs&2&&Ql!==0?Ql&-Ql:J_.transition!==null?(Py===0&&(St=Lm,Lm<<=1,!(Lm&4194240)&&(Lm=64),Py=St),Py):(St=Es,St!==0?St:Bn()):1}function ku(St,At,Lt){if(50<Qv)throw Qv=0,MT=null,Error(lt(185));var Bt=Ny(St,At);return Bt===null?null:(lm(Bt,At,Lt),(!(hs&2)||Bt!==Jl)&&(Bt===Jl&&(!(hs&2)&&(Iy|=At),cu===4&&Wm(Bt,Ql)),np(Bt,Lt),At===1&&hs===0&&!(St.mode&1)&&(jE(),dm&&_h())),Bt)}function Ny(St,At){St.lanes|=At;var Lt=St.alternate;for(Lt!==null&&(Lt.lanes|=At),Lt=St,St=St.return;St!==null;)St.childLanes|=At,Lt=St.alternate,Lt!==null&&(Lt.childLanes|=At),Lt=St,St=St.return;return Lt.tag===3?Lt.stateNode:null}function np(St,At){var Lt=St.callbackNode;K_(St,At);var Bt=km(St,St===Jl?Ql:0);if(Bt===0)Lt!==null&&AE(Lt),St.callbackNode=null,St.callbackPriority=0;else if(At=Bt&-Bt,St.callbackPriority!==At){if(Lt!=null&&AE(Lt),At===1)St.tag===0?CE(Dy.bind(null,St)):Mu(Dy.bind(null,St)),Wn?rr(function(){hs===0&&_h()}):Bm(X_,_h),Lt=null;else{switch(Av(Bt)){case 1:Lt=X_;break;case 4:Lt=$0;break;case 16:Lt=su;break;case 536870912:Lt=Rv;break;default:Lt=su}Lt=qC(Lt,zC.bind(null,St))}St.callbackPriority=At,St.callbackNode=Lt}}function zC(St,At){if(e0=-1,Py=0,hs&6)throw Error(lt(327));var Lt=St.callbackNode;if(aE()&&St.callbackNode!==Lt)return null;var Bt=km(St,St===Jl?Ql:0);if(Bt===0)return null;if(Bt&30||Bt&St.expiredLanes||At)At=sE(St,Bt);else{At=Bt;var Wt=hs;hs|=2;var nn=KC();(Jl!==St||Ql!==At)&&(jE(),oE(St,At));do try{WE();break}catch(Zn){WC(St,Zn)}while(1);RE(),Yv.current=nn,hs=Wt,Zl!==null?At=0:(Jl=null,Ql=0,At=cu)}if(At!==0){if(At===2&&(Wt=Um(St),Wt!==0&&(Bt=Wt,At=PT(St,Wt))),At===1)throw Lt=Xv,oE(St,0),Wm(St,Bt),np(St,Il()),Lt;if(At===6)Wm(St,Bt);else{if(Wt=St.current.alternate,!(Bt&30)&&!H1(Wt)&&(At=sE(St,Bt),At===2&&(nn=Um(St),nn!==0&&(Bt=nn,At=PT(St,nn))),At===1))throw Lt=Xv,oE(St,0),Wm(St,Bt),np(St,Il()),Lt;switch(St.finishedWork=Wt,St.finishedLanes=Bt,At){case 0:case 1:throw Error(lt(345));case 2:Xp(St,Yu);break;case 3:if(Wm(St,Bt),(Bt&130023424)===Bt&&(At=xT+500-Il(),10<At)){if(km(St,0)!==0)break;if(Wt=St.suspendedLanes,(Wt&Bt)!==Bt){yu(),St.pingedLanes|=St.suspendedLanes&Wt;break}St.timeoutHandle=Gn(Xp.bind(null,St,Yu),At);break}Xp(St,Yu);break;case 4:if(Wm(St,Bt),(Bt&4194240)===Bt)break;for(At=St.eventTimes,Wt=-1;0<Bt;){var Dn=31-ba(Bt);nn=1<<Dn,Dn=At[Dn],Dn>Wt&&(Wt=Dn),Bt&=~nn}if(Bt=Wt,Bt=Il()-Bt,Bt=(120>Bt?120:480>Bt?480:1080>Bt?1080:1920>Bt?1920:3e3>Bt?3e3:4320>Bt?4320:1960*$1(Bt/1960))-Bt,10<Bt){St.timeoutHandle=Gn(Xp.bind(null,St,Yu),Bt);break}Xp(St,Yu);break;case 5:Xp(St,Yu);break;default:throw Error(lt(329))}}}return np(St,Il()),St.callbackNode===Lt?zC.bind(null,St):null}function PT(St,At){var Lt=Jv;return St.current.memoizedState.isDehydrated&&(oE(St,At).flags|=256),St=sE(St,At),St!==2&&(At=Yu,Yu=Lt,At!==null&&zE(At)),St}function zE(St){Yu===null?Yu=St:Yu.push.apply(Yu,St)}function H1(St){for(var At=St;;){if(At.flags&16384){var Lt=At.updateQueue;if(Lt!==null&&(Lt=Lt.stores,Lt!==null))for(var Bt=0;Bt<Lt.length;Bt++){var Wt=Lt[Bt],nn=Wt.getSnapshot;Wt=Wt.value;try{if(!pp(nn(),Wt))return!1}catch{return!1}}}if(Lt=At.child,At.subtreeFlags&16384&&Lt!==null)Lt.return=At,At=Lt;else{if(At===St)break;for(;At.sibling===null;){if(At.return===null||At.return===St)return!0;At=At.return}At.sibling.return=At.return,At=At.sibling}}return!0}function Wm(St,At){for(At&=~qv,At&=~Iy,St.suspendedLanes|=At,St.pingedLanes&=~At,St=St.expirationTimes;0<At;){var Lt=31-ba(At),Bt=1<<Lt;St[Lt]=-1,At&=~Bt}}function Dy(St){if(hs&6)throw Error(lt(327));aE();var At=km(St,0);if(!(At&1))return np(St,Il()),null;var Lt=sE(St,At);if(St.tag!==0&&Lt===2){var Bt=Um(St);Bt!==0&&(At=Bt,Lt=PT(St,Bt))}if(Lt===1)throw Lt=Xv,oE(St,0),Wm(St,At),np(St,Il()),Lt;if(Lt===6)throw Error(lt(345));return St.finishedWork=St.current.alternate,St.finishedLanes=At,Xp(St,Yu),np(St,Il()),null}function Ly(St){C_!==null&&C_.tag===0&&!(hs&6)&&aE();var At=hs;hs|=1;var Lt=Ll.transition,Bt=Es;try{if(Ll.transition=null,Es=1,St)return St()}finally{Es=Bt,Ll.transition=Lt,hs=At,!(hs&6)&&_h()}}function NT(){Ep=$E.current,Io($E)}function oE(St,At){St.finishedWork=null,St.finishedLanes=0;var Lt=St.timeoutHandle;if(Lt!==qn&&(St.timeoutHandle=qn,Vn(Lt)),Zl!==null)for(Lt=Zl.return;Lt!==null;){var Bt=Lt;switch(tT(Bt),Bt.tag){case 1:Bt=Bt.type.childContextTypes,Bt!=null&&xo();break;case 3:LE(),Io(Uo),Io(Ps),q0();break;case 5:oT(Bt);break;case 4:LE();break;case 13:Io(Ml);break;case 19:Io(Ml);break;case 10:_u(Bt.type._context);break;case 22:case 23:NT()}Lt=Lt.return}if(Jl=St,Zl=St=Ru(St.current,null),Ql=Ep=At,cu=0,Xv=null,qv=Iy=HE=0,Yu=Jv=null,fp!==null){for(At=0;At<fp.length;At++)if(Lt=fp[At],Bt=Lt.interleaved,Bt!==null){Lt.interleaved=null;var Wt=Bt.next,nn=Lt.pending;if(nn!==null){var Dn=nn.next;nn.next=Wt,Bt.next=Dn}Lt.pending=Bt}fp=null}return St}function WC(St,At){do{var Lt=Zl;try{if(RE(),J0.current=iy,UE){for(var Bt=Pl.memoizedState;Bt!==null;){var Wt=Bt.queue;Wt!==null&&(Wt.pending=null),Bt=Bt.next}UE=!1}if(kE=0,Eu=Pu=Pl=null,tE=!1,Nv=0,IT.current=null,Lt===null||Lt.return===null){cu=1,Xv=At,Zl=null;break}e:{var nn=St,Dn=Lt.return,Zn=Lt,xr=At;if(At=Ql,Zn.flags|=32768,xr!==null&&typeof xr=="object"&&typeof xr.then=="function"){var Kr=xr,mo=Zn,Zo=mo.tag;if(!(mo.mode&1)&&(Zo===0||Zo===11||Zo===15)){var Mo=mo.alternate;Mo?(mo.updateQueue=Mo.updateQueue,mo.memoizedState=Mo.memoizedState,mo.lanes=Mo.lanes):(mo.updateQueue=null,mo.memoizedState=null)}var Zs=bC(Dn);if(Zs!==null){Zs.flags&=-257,ay(Zs,Dn,Zn,nn,At),Zs.mode&1&&sy(nn,Kr,At),At=Zs,xr=Kr;var To=At.updateQueue;if(To===null){var Uu=new Set;Uu.add(xr),At.updateQueue=Uu}else To.add(xr);break e}else{if(!(At&1)){sy(nn,Kr,At),DT();break e}xr=Error(lt(426))}}else if(El&&Zn.mode&1){var Mp=bC(Dn);if(Mp!==null){!(Mp.flags&65536)&&(Mp.flags|=256),ay(Mp,Dn,Zn,nn,At),W0(xr);break e}}nn=xr,cu!==4&&(cu=2),Jv===null?Jv=[nn]:Jv.push(nn),xr=fT(xr,Zn),Zn=Dn;do{switch(Zn.tag){case 3:Zn.flags|=65536,At&=-At,Zn.lanes|=At;var yr=CC(Zn,xr,At);oC(Zn,yr);break e;case 1:nn=xr;var er=Zn.type,Ar=Zn.stateNode;if(!(Zn.flags&128)&&(typeof er.getDerivedStateFromError=="function"||Ar!==null&&typeof Ar.componentDidCatch=="function"&&(A_===null||!A_.has(Ar)))){Zn.flags|=65536,At&=-At,Zn.lanes|=At;var ao=gT(Zn,nn,At);oC(Zn,ao);break e}}Zn=Zn.return}while(Zn!==null)}t0(Lt)}catch(So){At=So,Zl===Lt&&Lt!==null&&(Zl=Lt=Lt.return);continue}break}while(1)}function KC(){var St=Yv.current;return Yv.current=iy,St===null?iy:St}function DT(){(cu===0||cu===3||cu===2)&&(cu=4),Jl===null||!(HE&268435455)&&!(Iy&268435455)||Wm(Jl,Ql)}function sE(St,At){var Lt=hs;hs|=2;var Bt=KC();Jl===St&&Ql===At||oE(St,At);do try{j1();break}catch(Wt){WC(St,Wt)}while(1);if(RE(),hs=Lt,Yv.current=Bt,Zl!==null)throw Error(lt(261));return Jl=null,Ql=0,cu}function j1(){for(;Zl!==null;)ky(Zl)}function WE(){for(;Zl!==null&&!Cv();)ky(Zl)}function ky(St){var At=By(St.alternate,St,Ep);St.memoizedProps=St.pendingProps,At===null?t0(St):Zl=At,IT.current=null}function t0(St){var At=St;do{var Lt=At.alternate;if(St=At.return,At.flags&32768){if(Lt=F1(Lt,At),Lt!==null){Lt.flags&=32767,Zl=Lt;return}if(St!==null)St.flags|=32768,St.subtreeFlags=0,St.deletions=null;else{cu=6,Zl=null;return}}else if(Lt=k1(Lt,At,Ep),Lt!==null){Zl=Lt;return}if(At=At.sibling,At!==null){Zl=At;return}Zl=At=St}while(At!==null);cu===0&&(cu=5)}function Xp(St,At){var Lt=Es,Bt=Ll.transition;try{Ll.transition=null,Es=1,Uy(St,At,Lt)}finally{Ll.transition=Bt,Es=Lt}return null}function Uy(St,At,Lt){do aE();while(C_!==null);if(hs&6)throw Error(lt(327));var Bt=St.finishedWork,Wt=St.finishedLanes;if(Bt===null)return null;if(St.finishedWork=null,St.finishedLanes=0,Bt===St.current)throw Error(lt(177));St.callbackNode=null,St.callbackPriority=0;var nn=Bt.lanes|Bt.childLanes;if(f_(St,nn),St===Jl&&(Zl=Jl=null,Ql=0),!(Bt.subtreeFlags&2064)&&!(Bt.flags&2064)||My||(My=!0,qC(su,function(){return aE(),null})),nn=(Bt.flags&15990)!==0,Bt.subtreeFlags&15990||nn){nn=Ll.transition,Ll.transition=null;var Dn=Es;Es=1;var Zn=hs;hs|=4,IT.current=null,Ey(St,Bt),zv(St,Bt),Sn(St.containerInfo),St.current=Bt,G1(Bt),bv(),hs=Zn,Es=Dn,Ll.transition=nn}else St.current=Bt;if(My&&(My=!1,C_=St,Zv=Wt),nn=St.pendingLanes,nn===0&&(A_=null),wv(Bt.stateNode),np(St,Il()),At!==null)for(Lt=St.onRecoverableError,Bt=0;Bt<At.length;Bt++)Lt(At[Bt]);if(Oy)throw Oy=!1,St=OT,OT=null,St;return Zv&1&&St.tag!==0&&aE(),nn=St.pendingLanes,nn&1?St===MT?Qv++:(Qv=0,MT=St):Qv=0,_h(),null}function aE(){if(C_!==null){var St=Av(Zv),At=Ll.transition,Lt=Es;try{if(Ll.transition=null,Es=16>St?16:St,C_===null)var Bt=!1;else{if(St=C_,C_=null,Zv=0,hs&6)throw Error(lt(331));var Wt=hs;for(hs|=4,ro=St.current;ro!==null;){var nn=ro,Dn=nn.child;if(ro.flags&16){var Zn=nn.deletions;if(Zn!==null){for(var xr=0;xr<Zn.length;xr++){var Kr=Zn[xr];for(ro=Kr;ro!==null;){var mo=ro;switch(mo.tag){case 0:case 11:case 15:S_(8,mo,nn)}var Zo=mo.child;if(Zo!==null)Zo.return=mo,ro=Zo;else for(;ro!==null;){mo=ro;var Mo=mo.sibling,Zs=mo.return;if(FC(mo),mo===Kr){ro=null;break}if(Mo!==null){Mo.return=Zs,ro=Mo;break}ro=Zs}}}var To=nn.alternate;if(To!==null){var Uu=To.child;if(Uu!==null){To.child=null;do{var Mp=Uu.sibling;Uu.sibling=null,Uu=Mp}while(Uu!==null)}}ro=nn}}if(nn.subtreeFlags&2064&&Dn!==null)Dn.return=nn,ro=Dn;else e:for(;ro!==null;){if(nn=ro,nn.flags&2048)switch(nn.tag){case 0:case 11:case 15:S_(9,nn,nn.return)}var yr=nn.sibling;if(yr!==null){yr.return=nn.return,ro=yr;break e}ro=nn.return}}var er=St.current;for(ro=er;ro!==null;){Dn=ro;var Ar=Dn.child;if(Dn.subtreeFlags&2064&&Ar!==null)Ar.return=Dn,ro=Ar;else e:for(Dn=er;ro!==null;){if(Zn=ro,Zn.flags&2048)try{switch(Zn.tag){case 0:case 11:case 15:Hv(9,Zn)}}catch(So){rp(Zn,Zn.return,So)}if(Zn===Dn){ro=null;break e}var ao=Zn.sibling;if(ao!==null){ao.return=Zn.return,ro=ao;break e}ro=Zn.return}}if(hs=Wt,_h(),hp&&typeof hp.onPostCommitFiberRoot=="function")try{hp.onPostCommitFiberRoot(q_,St)}catch{}Bt=!0}return Bt}finally{Es=Lt,Ll.transition=At}}return!1}function LT(St,At,Lt){At=fT(Lt,At),At=CC(St,At,1),g_(St,At),At=yu(),St=Ny(St,1),St!==null&&(lm(St,1,At),np(St,At))}function rp(St,At,Lt){if(St.tag===3)LT(St,St,Lt);else for(;At!==null;){if(At.tag===3){LT(At,St,Lt);break}else if(At.tag===1){var Bt=At.stateNode;if(typeof At.type.getDerivedStateFromError=="function"||typeof Bt.componentDidCatch=="function"&&(A_===null||!A_.has(Bt))){St=fT(Lt,St),St=gT(At,St,1),g_(At,St),St=yu(),At=Ny(At,1),At!==null&&(lm(At,1,St),np(At,St));break}}At=At.return}}function YC(St,At,Lt){var Bt=St.pingCache;Bt!==null&&Bt.delete(At),At=yu(),St.pingedLanes|=St.suspendedLanes&Lt,Jl===St&&(Ql&Lt)===Lt&&(cu===4||cu===3&&(Ql&130023424)===Ql&&500>Il()-xT?oE(St,0):qv|=Lt),np(St,At)}function XC(St,At){At===0&&(St.mode&1?(At=zp,zp<<=1,!(zp&130023424)&&(zp=4194304)):At=1);var Lt=yu();St=Ny(St,At),St!==null&&(lm(St,At,Lt),np(St,Lt))}function z1(St){var At=St.memoizedState,Lt=0;At!==null&&(Lt=At.retryLane),XC(St,Lt)}function kT(St,At){var Lt=0;switch(St.tag){case 13:var Bt=St.stateNode,Wt=St.memoizedState;Wt!==null&&(Lt=Wt.retryLane);break;case 19:Bt=St.stateNode;break;default:throw Error(lt(314))}Bt!==null&&Bt.delete(At),XC(St,Lt)}var By;By=function(St,At,Lt){if(St!==null)if(St.memoizedProps!==At.pendingProps||Uo.current)Lu=!0;else{if(!(St.lanes&Lt)&&!(At.flags&128))return Lu=!1,B1(St,At,Lt);Lu=!!(St.flags&131072)}else Lu=!1,El&&At.flags&1048576&&lC(At,z0,At.index);switch(At.lanes=0,At.tag){case 2:var Bt=At.type;St!==null&&(St.alternate=null,At.alternate=null,At.flags|=2),St=At.pendingProps;var Wt=as(At,Ps.current);xl(At,Lt),Wt=cT(null,At,Bt,St,Wt,Lt);var nn=lT();return At.flags|=1,typeof Wt=="object"&&Wt!==null&&typeof Wt.render=="function"&&Wt.$$typeof===void 0?(At.tag=1,At.memoizedState=null,At.updateQueue=null,ks(Bt)?(nn=!0,As(At)):nn=!1,At.memoizedState=Wt.state!==null&&Wt.state!==void 0?Wt.state:null,Vm(At),Wt.updater=xv,At.stateNode=Wt,Wt._reactInternals=At,eT(At,Bt,St,Lt),At=ET(null,At,Bt,!0,nn,Lt)):(At.tag=0,El&&nn&&hm(At),vu(null,At,Wt,Lt),At=At.child),At;case 16:Bt=At.elementType;e:{switch(St!==null&&(St.alternate=null,At.alternate=null,At.flags|=2),St=At.pendingProps,Wt=Bt._init,Bt=Wt(Bt._payload),At.type=Bt,Wt=At.tag=K1(Bt),St=Wu(Bt,St),Wt){case 0:At=dy(null,At,Bt,St,Lt);break e;case 1:At=hy(null,At,Bt,St,Lt);break e;case 11:At=uy(null,At,Bt,St,Lt);break e;case 14:At=IC(null,At,Bt,Wu(Bt.type,St),Lt);break e}throw Error(lt(306,Bt,""))}return At;case 0:return Bt=At.type,Wt=At.pendingProps,Wt=At.elementType===Bt?Wt:Wu(Bt,Wt),dy(St,At,Bt,Wt,Lt);case 1:return Bt=At.type,Wt=At.pendingProps,Wt=At.elementType===Bt?Wt:Wu(Bt,Wt),hy(St,At,Bt,Wt,Lt);case 3:e:{if(MC(At),St===null)throw Error(lt(387));Bt=At.pendingProps,nn=At.memoizedState,Wt=nn.element,IE(St,At),j0(At,Bt,null,Lt);var Dn=At.memoizedState;if(Bt=Dn.element,wn&&nn.isDehydrated)if(nn={element:Bt,isDehydrated:!1,cache:Dn.cache,transitions:Dn.transitions},At.updateQueue.baseState=nn,At.memoizedState=nn,At.flags&256){Wt=Error(lt(423)),At=GE(St,At,Bt,Lt,Wt);break e}else if(Bt!==Wt){Wt=Error(lt(424)),At=GE(St,At,Bt,Lt,Wt);break e}else for(wn&&(gp=wl(At.stateNode.containerInfo),mp=At,El=!0,Wp=null,eE=!1),Lt=pC(At,null,Bt,Lt),At.child=Lt;Lt;)Lt.flags=Lt.flags&-3|4096,Lt=Lt.sibling;else{if(PE(),Bt===Wt){At=Yp(St,At,Lt);break e}vu(St,At,Bt,Lt)}At=At.child}return At;case 5:return Ku(At),St===null&&nT(At),Bt=At.type,Wt=At.pendingProps,nn=St!==null?St.memoizedProps:null,Dn=Wt.children,jn(Bt,Wt)?Dn=null:nn!==null&&jn(Bt,nn)&&(At.flags|=32),_T(St,At),vu(St,At,Dn,Lt),At.child;case 6:return St===null&&nT(At),null;case 13:return PC(St,At,Lt);case 4:return iT(At,At.stateNode.containerInfo),Bt=At.pendingProps,St===null?At.child=NE(At,null,Bt,Lt):vu(St,At,Bt,Lt),At.child;case 11:return Bt=At.type,Wt=At.pendingProps,Wt=At.elementType===Bt?Wt:Wu(Bt,Wt),uy(St,At,Bt,Wt,Lt);case 7:return vu(St,At,At.pendingProps,Lt),At.child;case 8:return vu(St,At,At.pendingProps.children,Lt),At.child;case 12:return vu(St,At,At.pendingProps.children,Lt),At.child;case 10:e:{if(Bt=At.type._context,Wt=At.pendingProps,nn=At.memoizedProps,Dn=Wt.value,wE(At,Bt,Dn),nn!==null)if(pp(nn.value,Dn)){if(nn.children===Wt.children&&!Uo.current){At=Yp(St,At,Lt);break e}}else for(nn=At.child,nn!==null&&(nn.return=At);nn!==null;){var Zn=nn.dependencies;if(Zn!==null){Dn=nn.child;for(var xr=Zn.firstContext;xr!==null;){if(xr.context===Bt){if(nn.tag===1){xr=Gm(-1,Lt&-Lt),xr.tag=2;var Kr=nn.updateQueue;if(Kr!==null){Kr=Kr.shared;var mo=Kr.pending;mo===null?xr.next=xr:(xr.next=mo.next,mo.next=xr),Kr.pending=xr}}nn.lanes|=Lt,xr=nn.alternate,xr!==null&&(xr.lanes|=Lt),Cu(nn.return,Lt,At),Zn.lanes|=Lt;break}xr=xr.next}}else if(nn.tag===10)Dn=nn.type===At.type?null:nn.child;else if(nn.tag===18){if(Dn=nn.return,Dn===null)throw Error(lt(341));Dn.lanes|=Lt,Zn=Dn.alternate,Zn!==null&&(Zn.lanes|=Lt),Cu(Dn,Lt,At),Dn=nn.sibling}else Dn=nn.child;if(Dn!==null)Dn.return=nn;else for(Dn=nn;Dn!==null;){if(Dn===At){Dn=null;break}if(nn=Dn.sibling,nn!==null){nn.return=Dn.return,Dn=nn;break}Dn=Dn.return}nn=Dn}vu(St,At,Wt.children,Lt),At=At.child}return At;case 9:return Wt=At.type,Bt=At.pendingProps.children,xl(At,Lt),Wt=Ol(Wt),Bt=Bt(Wt),At.flags|=1,vu(St,At,Bt,Lt),At.child;case 14:return Bt=At.type,Wt=Wu(Bt,At.pendingProps),Wt=Wu(Bt.type,Wt),IC(St,At,Bt,Wt,Lt);case 15:return xC(St,At,At.type,At.pendingProps,Lt);case 17:return Bt=At.type,Wt=At.pendingProps,Wt=At.elementType===Bt?Wt:Wu(Bt,Wt),St!==null&&(St.alternate=null,At.alternate=null,At.flags|=2),At.tag=1,ks(Bt)?(St=!0,As(At)):St=!1,xl(At,Lt),Ko(At,Bt,Wt),eT(At,Bt,Wt,Lt),ET(null,At,Bt,!0,St,Lt);case 19:return kC(St,At,Lt);case 22:return OC(St,At,Lt)}throw Error(lt(156,At.tag))};function qC(St,At){return Bm(St,At)}function W1(St,At,Lt,Bt){this.tag=St,this.key=Lt,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=At,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=Bt,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function vp(St,At,Lt,Bt){return new W1(St,At,Lt,Bt)}function n0(St){return St=St.prototype,!(!St||!St.isReactComponent)}function K1(St){if(typeof St=="function")return n0(St)?1:0;if(St!=null){if(St=St.$$typeof,St===It)return 11;if(St===xt)return 14}return 2}function Ru(St,At){var Lt=St.alternate;return Lt===null?(Lt=vp(St.tag,At,St.key,St.mode),Lt.elementType=St.elementType,Lt.type=St.type,Lt.stateNode=St.stateNode,Lt.alternate=St,St.alternate=Lt):(Lt.pendingProps=At,Lt.type=St.type,Lt.flags=0,Lt.subtreeFlags=0,Lt.deletions=null),Lt.flags=St.flags&14680064,Lt.childLanes=St.childLanes,Lt.lanes=St.lanes,Lt.child=St.child,Lt.memoizedProps=St.memoizedProps,Lt.memoizedState=St.memoizedState,Lt.updateQueue=St.updateQueue,At=St.dependencies,Lt.dependencies=At===null?null:{lanes:At.lanes,firstContext:At.firstContext},Lt.sibling=St.sibling,Lt.index=St.index,Lt.ref=St.ref,Lt}function Km(St,At,Lt,Bt,Wt,nn){var Dn=2;if(Bt=St,typeof St=="function")n0(St)&&(Dn=1);else if(typeof St=="string")Dn=5;else e:switch(St){case gt:return yp(Lt.children,Wt,nn,At);case Et:Dn=8,Wt|=8;break;case yt:return St=vp(12,Lt,At,Wt|2),St.elementType=yt,St.lanes=nn,St;case Pt:return St=vp(13,Lt,At,Wt),St.elementType=Pt,St.lanes=nn,St;case Rt:return St=vp(19,Lt,At,Wt),St.elementType=Rt,St.lanes=nn,St;case kt:return r0(Lt,Wt,nn,At);default:if(typeof St=="object"&&St!==null)switch(St.$$typeof){case Ct:Dn=10;break e;case wt:Dn=9;break e;case It:Dn=11;break e;case xt:Dn=14;break e;case Nt:Dn=16,Bt=null;break e}throw Error(lt(130,St==null?St:typeof St,""))}return At=vp(Dn,Lt,At,Wt),At.elementType=St,At.type=Bt,At.lanes=nn,At}function yp(St,At,Lt,Bt){return St=vp(7,St,Bt,At),St.lanes=Lt,St}function r0(St,At,Lt,Bt){return St=vp(22,St,Bt,At),St.elementType=kt,St.lanes=Lt,St.stateNode={},St}function Fy(St,At,Lt){return St=vp(6,St,null,At),St.lanes=Lt,St}function Ym(St,At,Lt){return At=vp(4,St.children!==null?St.children:[],St.key,At),At.lanes=Lt,At.stateNode={containerInfo:St.containerInfo,pendingChildren:null,implementation:St.implementation},At}function UT(St,At,Lt,Bt,Wt){this.tag=At,this.containerInfo=St,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=qn,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Y_(0),this.expirationTimes=Y_(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Y_(0),this.identifierPrefix=Bt,this.onRecoverableError=Wt,wn&&(this.mutableSourceEagerHydrationData=null)}function JC(St,At,Lt,Bt,Wt,nn,Dn,Zn,xr){return St=new UT(St,At,Lt,Zn,xr),At===1?(At=1,nn===!0&&(At|=8)):At=0,nn=vp(3,null,null,At),St.current=nn,nn.stateNode=St,nn.memoizedState={element:Bt,isDehydrated:Lt,cache:null,transitions:null},Vm(nn),St}function BT(St){if(!St)return Go;St=St._reactInternals;e:{if(Kt(St)!==St||St.tag!==1)throw Error(lt(170));var At=St;do{switch(At.tag){case 3:At=At.stateNode.context;break e;case 1:if(ks(At.type)){At=At.stateNode.__reactInternalMemoizedMergedChildContext;break e}}At=At.return}while(At!==null);throw Error(lt(171))}if(St.tag===1){var Lt=St.type;if(ks(Lt))return Xs(St,Lt,At)}return At}function ZC(St){var At=St._reactInternals;if(At===void 0)throw typeof St.render=="function"?Error(lt(188)):(St=Object.keys(St).join(","),Error(lt(268,St)));return St=an(At),St===null?null:St.stateNode}function Vy(St,At){if(St=St.memoizedState,St!==null&&St.dehydrated!==null){var Lt=St.retryLane;St.retryLane=Lt!==0&&Lt<At?Lt:At}}function Gy(St,At){Vy(St,At),(St=St.alternate)&&Vy(St,At)}function Y1(St){return St=an(St),St===null?null:St.stateNode}function b_(){return null}return tt.attemptContinuousHydration=function(St){if(St.tag===13){var At=yu();ku(St,134217728,At),Gy(St,134217728)}},tt.attemptHydrationAtCurrentPriority=function(St){if(St.tag===13){var At=yu(),Lt=zm(St);ku(St,Lt,At),Gy(St,Lt)}},tt.attemptSynchronousHydration=function(St){switch(St.tag){case 3:var At=St.stateNode;if(At.current.memoizedState.isDehydrated){var Lt=cm(At.pendingLanes);Lt!==0&&(um(At,Lt|1),np(At,Il()),!(hs&6)&&(jE(),_h()))}break;case 13:var Bt=yu();Ly(function(){return ku(St,1,Bt)}),Gy(St,1)}},tt.batchedUpdates=function(St,At){var Lt=hs;hs|=1;try{return St(At)}finally{hs=Lt,hs===0&&(jE(),dm&&_h())}},tt.createComponentSelector=function(St){return{$$typeof:Wv,value:St}},tt.createContainer=function(St,At,Lt,Bt,Wt,nn,Dn){return JC(St,At,!1,null,Lt,Bt,Wt,nn,Dn)},tt.createHasPseudoClassSelector=function(St){return{$$typeof:Ay,value:St}},tt.createHydrationContainer=function(St,At,Lt,Bt,Wt,nn,Dn,Zn,xr){return St=JC(Lt,Bt,!0,St,Wt,nn,Dn,Zn,xr),St.context=BT(null),Lt=St.current,Bt=yu(),Wt=zm(Lt),nn=Gm(Bt,Wt),nn.callback=At??null,g_(Lt,nn),St.current.lanes=Wt,lm(St,Wt,Bt),np(St,Bt),St},tt.createPortal=function(St,At,Lt){var Bt=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:ft,key:Bt==null?null:""+Bt,children:St,containerInfo:At,implementation:Lt}},tt.createRoleSelector=function(St){return{$$typeof:Cy,value:St}},tt.createTestNameSelector=function(St){return{$$typeof:by,value:St}},tt.createTextSelector=function(St){return{$$typeof:Ry,value:St}},tt.deferredUpdates=function(St){var At=Es,Lt=Ll.transition;try{return Ll.transition=null,Es=16,St()}finally{Es=At,Ll.transition=Lt}},tt.discreteUpdates=function(St,At,Lt,Bt,Wt){var nn=Es,Dn=Ll.transition;try{return Ll.transition=null,Es=1,St(At,Lt,Bt,Wt)}finally{Es=nn,Ll.transition=Dn,hs===0&&jE()}},tt.findAllNodes=wT,tt.findBoundingRects=function(St,At){if(!sr)throw Error(lt(363));At=wT(St,At),St=[];for(var Lt=0;Lt<At.length;Lt++)St.push(kr(At[Lt]));for(At=St.length-1;0<At;At--){Lt=St[At];for(var Bt=Lt.x,Wt=Bt+Lt.width,nn=Lt.y,Dn=nn+Lt.height,Zn=At-1;0<=Zn;Zn--)if(At!==Zn){var xr=St[Zn],Kr=xr.x,mo=Kr+xr.width,Zo=xr.y,Mo=Zo+xr.height;if(Bt>=Kr&&nn>=Zo&&Wt<=mo&&Dn<=Mo){St.splice(At,1);break}else if(Bt!==Kr||Lt.width!==xr.width||Mo<nn||Zo>Dn){if(!(nn!==Zo||Lt.height!==xr.height||mo<Bt||Kr>Wt)){Kr>Bt&&(xr.width+=Kr-Bt,xr.x=Bt),mo<Wt&&(xr.width=Wt-Kr),St.splice(At,1);break}}else{Zo>nn&&(xr.height+=Zo-nn,xr.y=nn),Mo<Dn&&(xr.height=Dn-Zo),St.splice(At,1);break}}}return St},tt.findHostInstance=ZC,tt.findHostInstanceWithNoPortals=function(St){return St=pn(St),St=St!==null?dn(St):null,St===null?null:St.stateNode},tt.findHostInstanceWithWarning=function(St){return ZC(St)},tt.flushControlled=function(St){var At=hs;hs|=1;var Lt=Ll.transition,Bt=Es;try{Ll.transition=null,Es=1,St()}finally{Es=Bt,Ll.transition=Lt,hs=At,hs===0&&(jE(),_h())}},tt.flushPassiveEffects=aE,tt.flushSync=Ly,tt.focusWithin=function(St,At){if(!sr)throw Error(lt(363));for(St=RT(St),At=jC(St,At),At=Array.from(At),St=0;St<At.length;){var Lt=At[St++];if(!sn(Lt)){if(Lt.tag===5&&Sr(Lt.stateNode))return!0;for(Lt=Lt.child;Lt!==null;)At.push(Lt),Lt=Lt.sibling}}return!1},tt.getCurrentUpdatePriority=function(){return Es},tt.getFindAllNodesFailureDescription=function(St,At){if(!sr)throw Error(lt(363));var Lt=0,Bt=[];St=[RT(St),0];for(var Wt=0;Wt<St.length;){var nn=St[Wt++],Dn=St[Wt++],Zn=At[Dn];if((nn.tag!==5||!sn(nn))&&(wy(nn,Zn)&&(Bt.push(T_(Zn)),Dn++,Dn>Lt&&(Lt=Dn)),Dn<At.length))for(nn=nn.child;nn!==null;)St.push(nn,Dn),nn=nn.sibling}if(Lt<At.length){for(St=[];Lt<At.length;Lt++)St.push(T_(At[Lt]));return`findAllNodes was able to match part of the selector:
  `+(Bt.join(" > ")+`

No matching component was found for:
  `)+St.join(" > ")}return null},tt.getPublicRootInstance=function(St){if(St=St.current,!St.child)return null;switch(St.child.tag){case 5:return On(St.child.stateNode);default:return St.child.stateNode}},tt.injectIntoDevTools=function(St){if(St={bundleType:St.bundleType,version:St.version,rendererPackageName:St.rendererPackageName,rendererConfig:St.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:dt.ReactCurrentDispatcher,findHostInstanceByFiber:Y1,findFiberByHostInstance:St.findFiberByHostInstance||b_,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.0.0-fc46dba67-20220329"},typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u")St=!1;else{var At=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(At.isDisabled||!At.supportsFiber)St=!0;else{try{q_=At.inject(St),hp=At}catch{}St=!!At.checkDCE}}return St},tt.isAlreadyRendering=function(){return!1},tt.observeVisibleRects=function(St,At,Lt,Bt){if(!sr)throw Error(lt(363));St=wT(St,At);var Wt=lr(St,Lt,Bt).disconnect;return{disconnect:function(){Wt()}}},tt.registerMutableSourceForHydration=function(St,At){var Lt=At._getVersion;Lt=Lt(At._source),St.mutableSourceEagerHydrationData==null?St.mutableSourceEagerHydrationData=[At,Lt]:St.mutableSourceEagerHydrationData.push(At,Lt)},tt.runWithPriority=function(St,At){var Lt=Es;try{return Es=St,At()}finally{Es=Lt}},tt.shouldError=function(){return null},tt.shouldSuspend=function(){return!1},tt.updateContainer=function(St,At,Lt,Bt){var Wt=At.current,nn=yu(),Dn=zm(Wt);return Lt=BT(Lt),At.context===null?At.context=Lt:At.pendingContext=Lt,At=Gm(nn,Dn),At.payload={element:St},Bt=Bt===void 0?null:Bt,Bt!==null&&(At.callback=Bt),g_(Wt,At),St=ku(Wt,Dn,nn),St!==null&&H0(St,Wt,Dn),Dn},tt};reactReconciler.exports=reactReconciler_production_min;var reactReconcilerExports=reactReconciler.exports;const Reconciler=getDefaultExportFromCjs(reactReconcilerExports),isPromise=nt=>typeof nt=="object"&&typeof nt.then=="function",globalCache=[];function shallowEqualArrays(nt,_,tt=(ot,st)=>ot===st){if(nt===_)return!0;if(!nt||!_)return!1;const ot=nt.length;if(_.length!==ot)return!1;for(let st=0;st<ot;st++)if(!tt(nt[st],_[st]))return!1;return!0}function query(nt,_=null,tt=!1,ot={}){_===null&&(_=[nt]);for(const at of globalCache)if(shallowEqualArrays(_,at.keys,at.equal)){if(tt)return;if(Object.prototype.hasOwnProperty.call(at,"error"))throw at.error;if(Object.prototype.hasOwnProperty.call(at,"response"))return ot.lifespan&&ot.lifespan>0&&(at.timeout&&clearTimeout(at.timeout),at.timeout=setTimeout(at.remove,ot.lifespan)),at.response;if(!tt)throw at.promise}const st={keys:_,equal:ot.equal,remove:()=>{const at=globalCache.indexOf(st);at!==-1&&globalCache.splice(at,1)},promise:(isPromise(nt)?nt:nt(..._)).then(at=>{st.response=at,ot.lifespan&&ot.lifespan>0&&(st.timeout=setTimeout(st.remove,ot.lifespan))}).catch(at=>st.error=at)};if(globalCache.push(st),!tt)throw st.promise}const suspend=(nt,_,tt)=>query(nt,_,!1,tt),preload=(nt,_,tt)=>void query(nt,_,!0,tt),clear=nt=>{if(nt===void 0||nt.length===0)globalCache.splice(0,globalCache.length);else{const _=globalCache.find(tt=>shallowEqualArrays(nt,tt.keys,tt.equal));_&&_.remove()}},catalogue={},extend$2=nt=>void Object.assign(catalogue,nt);function createRenderer(nt,_){function tt(gt,{args:Et=[],attach:yt,...Ct},wt){let It=`${gt[0].toUpperCase()}${gt.slice(1)}`,Pt;if(gt==="primitive"){if(Ct.object===void 0)throw new Error("R3F: Primitives without 'object' are invalid!");const Rt=Ct.object;Pt=prepare(Rt,{type:gt,root:wt,attach:yt,primitive:!0})}else{const Rt=catalogue[It];if(!Rt)throw new Error(`R3F: ${It} is not part of the THREE namespace! Did you forget to extend? See: https://docs.pmnd.rs/react-three-fiber/api/objects#using-3rd-party-objects-declaratively`);if(!Array.isArray(Et))throw new Error("R3F: The args prop must be an array!");Pt=prepare(new Rt(...Et),{type:gt,root:wt,attach:yt,memoizedProps:{args:Et}})}return Pt.__r3f.attach===void 0&&(Pt instanceof BufferGeometry?Pt.__r3f.attach="geometry":Pt instanceof Material&&(Pt.__r3f.attach="material")),It!=="inject"&&applyProps$1(Pt,Ct),Pt}function ot(gt,Et){let yt=!1;if(Et){var Ct,wt;(Ct=Et.__r3f)!=null&&Ct.attach?attach(gt,Et,Et.__r3f.attach):Et.isObject3D&&gt.isObject3D&&(gt.add(Et),yt=!0),yt||(wt=gt.__r3f)==null||wt.objects.push(Et),Et.__r3f||prepare(Et,{}),Et.__r3f.parent=gt,updateInstance(Et),invalidateInstance(Et)}}function st(gt,Et,yt){let Ct=!1;if(Et){var wt,It;if((wt=Et.__r3f)!=null&&wt.attach)attach(gt,Et,Et.__r3f.attach);else if(Et.isObject3D&&gt.isObject3D){Et.parent=gt,Et.dispatchEvent({type:"added"});const Pt=gt.children.filter(xt=>xt!==Et),Rt=Pt.indexOf(yt);gt.children=[...Pt.slice(0,Rt),Et,...Pt.slice(Rt)],Ct=!0}Ct||(It=gt.__r3f)==null||It.objects.push(Et),Et.__r3f||prepare(Et,{}),Et.__r3f.parent=gt,updateInstance(Et),invalidateInstance(Et)}}function at(gt,Et,yt=!1){gt&&[...gt].forEach(Ct=>lt(Et,Ct,yt))}function lt(gt,Et,yt){if(Et){var Ct,wt,It;if(Et.__r3f&&(Et.__r3f.parent=null),(Ct=gt.__r3f)!=null&&Ct.objects&&(gt.__r3f.objects=gt.__r3f.objects.filter(kt=>kt!==Et)),(wt=Et.__r3f)!=null&&wt.attach)detach(gt,Et,Et.__r3f.attach);else if(Et.isObject3D&&gt.isObject3D){var Pt;gt.remove(Et),(Pt=Et.__r3f)!=null&&Pt.root&&removeInteractivity(Et.__r3f.root,Et)}const xt=(It=Et.__r3f)==null?void 0:It.primitive,Nt=yt===void 0?Et.dispose!==null&&!xt:yt;if(!xt){var Rt;at((Rt=Et.__r3f)==null?void 0:Rt.objects,Et,Nt),at(Et.children,Et,Nt)}delete Et.__r3f,Nt&&Et.dispose&&Et.type!=="Scene"&&schedulerExports.unstable_scheduleCallback(schedulerExports.unstable_IdlePriority,()=>{try{Et.dispose()}catch{}}),invalidateInstance(gt)}}function dt(gt,Et,yt,Ct){var wt;const It=(wt=gt.__r3f)==null?void 0:wt.parent;if(!It)return;const Pt=tt(Et,yt,gt.__r3f.root);if(gt.children){for(const Rt of gt.children)Rt.__r3f&&ot(Pt,Rt);gt.children=gt.children.filter(Rt=>!Rt.__r3f)}gt.__r3f.objects.forEach(Rt=>ot(Pt,Rt)),gt.__r3f.objects=[],gt.__r3f.autoRemovedBeforeAppend||lt(It,gt),Pt.parent&&(Pt.__r3f.autoRemovedBeforeAppend=!0),ot(It,Pt),Pt.raycast&&Pt.__r3f.eventCount&&Pt.__r3f.root.getState().internal.interaction.push(Pt),[Ct,Ct.alternate].forEach(Rt=>{Rt!==null&&(Rt.stateNode=Pt,Rt.ref&&(typeof Rt.ref=="function"?Rt.ref(Pt):Rt.ref.current=Pt))})}const ht=()=>console.warn("Text is not allowed in the R3F tree! This could be stray whitespace or characters.");return{reconciler:Reconciler({createInstance:tt,removeChild:lt,appendChild:ot,appendInitialChild:ot,insertBefore:st,supportsMutation:!0,isPrimaryRenderer:!1,supportsPersistence:!1,supportsHydration:!1,noTimeout:-1,appendChildToContainer:(gt,Et)=>{if(!Et)return;const yt=gt.getState().scene;yt.__r3f&&(yt.__r3f.root=gt,ot(yt,Et))},removeChildFromContainer:(gt,Et)=>{Et&&lt(gt.getState().scene,Et)},insertInContainerBefore:(gt,Et,yt)=>{if(!Et||!yt)return;const Ct=gt.getState().scene;Ct.__r3f&&st(Ct,Et,yt)},getRootHostContext:()=>null,getChildHostContext:gt=>gt,finalizeInitialChildren(gt){var Et;return!!((Et=gt==null?void 0:gt.__r3f)!=null?Et:{}).handlers},prepareUpdate(gt,Et,yt,Ct){if(gt.__r3f.primitive&&Ct.object&&Ct.object!==gt)return[!0];{const{args:wt=[],children:It,...Pt}=Ct,{args:Rt=[],children:xt,...Nt}=yt;if(!Array.isArray(wt))throw new Error("R3F: the args prop must be an array!");if(wt.some((Vt,Ft)=>Vt!==Rt[Ft]))return[!0];const kt=diffProps(gt,Pt,Nt,!0);return kt.changes.length?[!1,kt]:null}},commitUpdate(gt,[Et,yt],Ct,wt,It,Pt){Et?dt(gt,Ct,It,Pt):applyProps$1(gt,yt)},commitMount(gt,Et,yt,Ct){var wt;const It=(wt=gt.__r3f)!=null?wt:{};gt.raycast&&It.handlers&&It.eventCount&&gt.__r3f.root.getState().internal.interaction.push(gt)},getPublicInstance:gt=>gt,prepareForCommit:()=>null,preparePortalMount:gt=>prepare(gt.getState().scene),resetAfterCommit:()=>{},shouldSetTextContent:()=>!1,clearContainer:()=>!1,hideInstance(gt){var Et;const{attach:yt,parent:Ct}=(Et=gt.__r3f)!=null?Et:{};yt&&Ct&&detach(Ct,gt,yt),gt.isObject3D&&(gt.visible=!1),invalidateInstance(gt)},unhideInstance(gt,Et){var yt;const{attach:Ct,parent:wt}=(yt=gt.__r3f)!=null?yt:{};Ct&&wt&&attach(wt,gt,Ct),(gt.isObject3D&&Et.visible==null||Et.visible)&&(gt.visible=!0),invalidateInstance(gt)},createTextInstance:ht,hideTextInstance:ht,unhideTextInstance:ht,getCurrentEventPriority:()=>_?_():constantsExports.DefaultEventPriority,beforeActiveInstanceBlur:()=>{},afterActiveInstanceBlur:()=>{},detachDeletedInstance:()=>{},now:typeof performance<"u"&&is.fun(performance.now)?performance.now:is.fun(Date.now)?Date.now:()=>0,scheduleTimeout:is.fun(setTimeout)?setTimeout:void 0,cancelTimeout:is.fun(clearTimeout)?clearTimeout:void 0}),applyProps:applyProps$1}}var _window$document,_window$navigator;const hasColorSpace$1=nt=>"colorSpace"in nt||"outputColorSpace"in nt,getColorManagement=()=>{var nt;return(nt=catalogue.ColorManagement)!=null?nt:null},isOrthographicCamera$1=nt=>nt&&nt.isOrthographicCamera,isRef$1=nt=>nt&&nt.hasOwnProperty("current"),useIsomorphicLayoutEffect=typeof window<"u"&&((_window$document=window.document)!=null&&_window$document.createElement||((_window$navigator=window.navigator)==null?void 0:_window$navigator.product)==="ReactNative")?reactExports.useLayoutEffect:reactExports.useEffect;function useMutableCallback(nt){const _=reactExports.useRef(nt);return useIsomorphicLayoutEffect(()=>void(_.current=nt),[nt]),_}function Block({set:nt}){return useIsomorphicLayoutEffect(()=>(nt(new Promise(()=>null)),()=>nt(!1)),[nt]),null}class ErrorBoundary extends reactExports.Component{constructor(..._){super(..._),this.state={error:!1}}componentDidCatch(_){this.props.set(_)}render(){return this.state.error?null:this.props.children}}ErrorBoundary.getDerivedStateFromError=()=>({error:!0});const DEFAULT="__default",DEFAULTS=new Map,isDiffSet=nt=>nt&&!!nt.memoized&&!!nt.changes;function calculateDpr(nt){var _;const tt=typeof window<"u"?(_=window.devicePixelRatio)!=null?_:2:1;return Array.isArray(nt)?Math.min(Math.max(nt[0],tt),nt[1]):nt}const getRootState=nt=>{var _;return(_=nt.__r3f)==null?void 0:_.root.getState()},is={obj:nt=>nt===Object(nt)&&!is.arr(nt)&&typeof nt!="function",fun:nt=>typeof nt=="function",str:nt=>typeof nt=="string",num:nt=>typeof nt=="number",boo:nt=>typeof nt=="boolean",und:nt=>nt===void 0,arr:nt=>Array.isArray(nt),equ(nt,_,{arrays:tt="shallow",objects:ot="reference",strict:st=!0}={}){if(typeof nt!=typeof _||!!nt!=!!_)return!1;if(is.str(nt)||is.num(nt))return nt===_;const at=is.obj(nt);if(at&&ot==="reference")return nt===_;const lt=is.arr(nt);if(lt&&tt==="reference")return nt===_;if((lt||at)&&nt===_)return!0;let dt;for(dt in nt)if(!(dt in _))return!1;if(at&&tt==="shallow"&&ot==="shallow"){for(dt in st?_:nt)if(!is.equ(nt[dt],_[dt],{strict:st,objects:"reference"}))return!1}else for(dt in st?_:nt)if(nt[dt]!==_[dt])return!1;if(is.und(dt)){if(lt&&nt.length===0&&_.length===0||at&&Object.keys(nt).length===0&&Object.keys(_).length===0)return!0;if(nt!==_)return!1}return!0}};function buildGraph(nt){const _={nodes:{},materials:{}};return nt&&nt.traverse(tt=>{tt.name&&(_.nodes[tt.name]=tt),tt.material&&!_.materials[tt.material.name]&&(_.materials[tt.material.name]=tt.material)}),_}function dispose(nt){nt.dispose&&nt.type!=="Scene"&&nt.dispose();for(const _ in nt)_.dispose==null||_.dispose(),delete nt[_]}function prepare(nt,_){const tt=nt;return(_!=null&&_.primitive||!tt.__r3f)&&(tt.__r3f={type:"",root:null,previousAttach:null,memoizedProps:{},eventCount:0,handlers:{},objects:[],parent:null,..._}),nt}function resolve(nt,_){let tt=nt;if(_.includes("-")){const ot=_.split("-"),st=ot.pop();return tt=ot.reduce((at,lt)=>at[lt],nt),{target:tt,key:st}}else return{target:tt,key:_}}const INDEX_REGEX=/-\d+$/;function attach(nt,_,tt){if(is.str(tt)){if(INDEX_REGEX.test(tt)){const at=tt.replace(INDEX_REGEX,""),{target:lt,key:dt}=resolve(nt,at);Array.isArray(lt[dt])||(lt[dt]=[])}const{target:ot,key:st}=resolve(nt,tt);_.__r3f.previousAttach=ot[st],ot[st]=_}else _.__r3f.previousAttach=tt(nt,_)}function detach(nt,_,tt){var ot,st;if(is.str(tt)){const{target:at,key:lt}=resolve(nt,tt),dt=_.__r3f.previousAttach;dt===void 0?delete at[lt]:at[lt]=dt}else(ot=_.__r3f)==null||ot.previousAttach==null||ot.previousAttach(nt,_);(st=_.__r3f)==null||delete st.previousAttach}function diffProps(nt,{children:_,key:tt,ref:ot,...st},{children:at,key:lt,ref:dt,...ht}={},ft=!1){var gt;const Et=(gt=nt==null?void 0:nt.__r3f)!=null?gt:{},yt=Object.entries(st),Ct=[];if(ft){const It=Object.keys(ht);for(let Pt=0;Pt<It.length;Pt++)st.hasOwnProperty(It[Pt])||yt.unshift([It[Pt],DEFAULT+"remove"])}yt.forEach(([It,Pt])=>{var Rt;if((Rt=nt.__r3f)!=null&&Rt.primitive&&It==="object"||is.equ(Pt,ht[It]))return;if(/^on(Pointer|Click|DoubleClick|ContextMenu|Wheel)/.test(It))return Ct.push([It,Pt,!0,[]]);let xt=[];It.includes("-")&&(xt=It.split("-")),Ct.push([It,Pt,!1,xt]);for(const Nt in st){const kt=st[Nt];Nt.startsWith(`${It}-`)&&Ct.push([Nt,kt,!1,Nt.split("-")])}});const wt={...st};return Et.memoizedProps&&Et.memoizedProps.args&&(wt.args=Et.memoizedProps.args),Et.memoizedProps&&Et.memoizedProps.attach&&(wt.attach=Et.memoizedProps.attach),{memoized:wt,changes:Ct}}function applyProps$1(nt,_){var tt,ot,st;const at=(tt=nt.__r3f)!=null?tt:{},lt=at.root,dt=(ot=lt==null||lt.getState==null?void 0:lt.getState())!=null?ot:{},{memoized:ht,changes:ft}=isDiffSet(_)?_:diffProps(nt,_),gt=at.eventCount;nt.__r3f&&(nt.__r3f.memoizedProps=ht);for(let yt=0;yt<ft.length;yt++){let[Ct,wt,It,Pt]=ft[yt];if(hasColorSpace$1(nt)){const kt="srgb",Vt="srgb-linear";Ct==="encoding"?(Ct="colorSpace",wt=wt===3001?kt:Vt):Ct==="outputEncoding"&&(Ct="outputColorSpace",wt=wt===3001?kt:Vt)}let Rt=nt,xt=Rt[Ct];if(Pt.length&&(xt=Pt.reduce((Nt,kt)=>Nt[kt],nt),!(xt&&xt.set))){const[Nt,...kt]=Pt.reverse();Rt=kt.reverse().reduce((Vt,Ft)=>Vt[Ft],nt),Ct=Nt}if(wt===DEFAULT+"remove")if(Rt.constructor){let Nt=DEFAULTS.get(Rt.constructor);Nt||(Nt=new Rt.constructor,DEFAULTS.set(Rt.constructor,Nt)),wt=Nt[Ct]}else wt=0;if(It)wt?at.handlers[Ct]=wt:delete at.handlers[Ct],at.eventCount=Object.keys(at.handlers).length;else if(xt&&xt.set&&(xt.copy||xt instanceof Layers)){if(Array.isArray(wt))xt.fromArray?xt.fromArray(wt):xt.set(...wt);else if(xt.copy&&wt&&wt.constructor&&xt.constructor===wt.constructor)xt.copy(wt);else if(wt!==void 0){const Nt=xt instanceof Color$1;!Nt&&xt.setScalar?xt.setScalar(wt):xt instanceof Layers&&wt instanceof Layers?xt.mask=wt.mask:xt.set(wt),!getColorManagement()&&!dt.linear&&Nt&&xt.convertSRGBToLinear()}}else if(Rt[Ct]=wt,Rt[Ct]instanceof Texture&&Rt[Ct].format===RGBAFormat&&Rt[Ct].type===UnsignedByteType){const Nt=Rt[Ct];hasColorSpace$1(Nt)&&hasColorSpace$1(dt.gl)?Nt.colorSpace=dt.gl.outputColorSpace:Nt.encoding=dt.gl.outputEncoding}invalidateInstance(nt)}if(at.parent&&dt.internal&&nt.raycast&&gt!==at.eventCount){const yt=dt.internal.interaction.indexOf(nt);yt>-1&&dt.internal.interaction.splice(yt,1),at.eventCount&&dt.internal.interaction.push(nt)}return!(ft.length===1&&ft[0][0]==="onUpdate")&&ft.length&&(st=nt.__r3f)!=null&&st.parent&&updateInstance(nt),nt}function invalidateInstance(nt){var _,tt;const ot=(_=nt.__r3f)==null||(tt=_.root)==null||tt.getState==null?void 0:tt.getState();ot&&ot.internal.frames===0&&ot.invalidate()}function updateInstance(nt){nt.onUpdate==null||nt.onUpdate(nt)}function updateCamera(nt,_){nt.manual||(isOrthographicCamera$1(nt)?(nt.left=_.width/-2,nt.right=_.width/2,nt.top=_.height/2,nt.bottom=_.height/-2):nt.aspect=_.width/_.height,nt.updateProjectionMatrix(),nt.updateMatrixWorld())}function makeId(nt){return(nt.eventObject||nt.object).uuid+"/"+nt.index+nt.instanceId}function getEventPriority(){var nt;const _=typeof self<"u"&&self||typeof window<"u"&&window;if(!_)return constantsExports.DefaultEventPriority;switch((nt=_.event)==null?void 0:nt.type){case"click":case"contextmenu":case"dblclick":case"pointercancel":case"pointerdown":case"pointerup":return constantsExports.DiscreteEventPriority;case"pointermove":case"pointerout":case"pointerover":case"pointerenter":case"pointerleave":case"wheel":return constantsExports.ContinuousEventPriority;default:return constantsExports.DefaultEventPriority}}function releaseInternalPointerCapture(nt,_,tt,ot){const st=tt.get(_);st&&(tt.delete(_),tt.size===0&&(nt.delete(ot),st.target.releasePointerCapture(ot)))}function removeInteractivity(nt,_){const{internal:tt}=nt.getState();tt.interaction=tt.interaction.filter(ot=>ot!==_),tt.initialHits=tt.initialHits.filter(ot=>ot!==_),tt.hovered.forEach((ot,st)=>{(ot.eventObject===_||ot.object===_)&&tt.hovered.delete(st)}),tt.capturedMap.forEach((ot,st)=>{releaseInternalPointerCapture(tt.capturedMap,_,ot,st)})}function createEvents(nt){function _(ht){const{internal:ft}=nt.getState(),gt=ht.offsetX-ft.initialClick[0],Et=ht.offsetY-ft.initialClick[1];return Math.round(Math.sqrt(gt*gt+Et*Et))}function tt(ht){return ht.filter(ft=>["Move","Over","Enter","Out","Leave"].some(gt=>{var Et;return(Et=ft.__r3f)==null?void 0:Et.handlers["onPointer"+gt]}))}function ot(ht,ft){const gt=nt.getState(),Et=new Set,yt=[],Ct=ft?ft(gt.internal.interaction):gt.internal.interaction;for(let Rt=0;Rt<Ct.length;Rt++){const xt=getRootState(Ct[Rt]);xt&&(xt.raycaster.camera=void 0)}gt.previousRoot||gt.events.compute==null||gt.events.compute(ht,gt);function wt(Rt){const xt=getRootState(Rt);if(!xt||!xt.events.enabled||xt.raycaster.camera===null)return[];if(xt.raycaster.camera===void 0){var Nt;xt.events.compute==null||xt.events.compute(ht,xt,(Nt=xt.previousRoot)==null?void 0:Nt.getState()),xt.raycaster.camera===void 0&&(xt.raycaster.camera=null)}return xt.raycaster.camera?xt.raycaster.intersectObject(Rt,!0):[]}let It=Ct.flatMap(wt).sort((Rt,xt)=>{const Nt=getRootState(Rt.object),kt=getRootState(xt.object);return!Nt||!kt?Rt.distance-xt.distance:kt.events.priority-Nt.events.priority||Rt.distance-xt.distance}).filter(Rt=>{const xt=makeId(Rt);return Et.has(xt)?!1:(Et.add(xt),!0)});gt.events.filter&&(It=gt.events.filter(It,gt));for(const Rt of It){let xt=Rt.object;for(;xt;){var Pt;(Pt=xt.__r3f)!=null&&Pt.eventCount&&yt.push({...Rt,eventObject:xt}),xt=xt.parent}}if("pointerId"in ht&&gt.internal.capturedMap.has(ht.pointerId))for(let Rt of gt.internal.capturedMap.get(ht.pointerId).values())Et.has(makeId(Rt.intersection))||yt.push(Rt.intersection);return yt}function st(ht,ft,gt,Et){const yt=nt.getState();if(ht.length){const Ct={stopped:!1};for(const wt of ht){const It=getRootState(wt.object)||yt,{raycaster:Pt,pointer:Rt,camera:xt,internal:Nt}=It,kt=new Vector3(Rt.x,Rt.y,0).unproject(xt),Vt=qt=>{var pn,an;return(pn=(an=Nt.capturedMap.get(qt))==null?void 0:an.has(wt.eventObject))!=null?pn:!1},Ft=qt=>{const pn={intersection:wt,target:ft.target};Nt.capturedMap.has(qt)?Nt.capturedMap.get(qt).set(wt.eventObject,pn):Nt.capturedMap.set(qt,new Map([[wt.eventObject,pn]])),ft.target.setPointerCapture(qt)},zt=qt=>{const pn=Nt.capturedMap.get(qt);pn&&releaseInternalPointerCapture(Nt.capturedMap,wt.eventObject,pn,qt)};let Yt={};for(let qt in ft){let pn=ft[qt];typeof pn!="function"&&(Yt[qt]=pn)}let Kt={...wt,...Yt,pointer:Rt,intersections:ht,stopped:Ct.stopped,delta:gt,unprojectedPoint:kt,ray:Pt.ray,camera:xt,stopPropagation(){const qt="pointerId"in ft&&Nt.capturedMap.get(ft.pointerId);if((!qt||qt.has(wt.eventObject))&&(Kt.stopped=Ct.stopped=!0,Nt.hovered.size&&Array.from(Nt.hovered.values()).find(pn=>pn.eventObject===wt.eventObject))){const pn=ht.slice(0,ht.indexOf(wt));at([...pn,wt])}},target:{hasPointerCapture:Vt,setPointerCapture:Ft,releasePointerCapture:zt},currentTarget:{hasPointerCapture:Vt,setPointerCapture:Ft,releasePointerCapture:zt},nativeEvent:ft};if(Et(Kt),Ct.stopped===!0)break}}return ht}function at(ht){const{internal:ft}=nt.getState();for(const gt of ft.hovered.values())if(!ht.length||!ht.find(Et=>Et.object===gt.object&&Et.index===gt.index&&Et.instanceId===gt.instanceId)){const yt=gt.eventObject.__r3f,Ct=yt==null?void 0:yt.handlers;if(ft.hovered.delete(makeId(gt)),yt!=null&&yt.eventCount){const wt={...gt,intersections:ht};Ct.onPointerOut==null||Ct.onPointerOut(wt),Ct.onPointerLeave==null||Ct.onPointerLeave(wt)}}}function lt(ht,ft){for(let gt=0;gt<ft.length;gt++){const Et=ft[gt].__r3f;Et==null||Et.handlers.onPointerMissed==null||Et.handlers.onPointerMissed(ht)}}function dt(ht){switch(ht){case"onPointerLeave":case"onPointerCancel":return()=>at([]);case"onLostPointerCapture":return ft=>{const{internal:gt}=nt.getState();"pointerId"in ft&&gt.capturedMap.has(ft.pointerId)&&requestAnimationFrame(()=>{gt.capturedMap.has(ft.pointerId)&&(gt.capturedMap.delete(ft.pointerId),at([]))})}}return function(gt){const{onPointerMissed:Et,internal:yt}=nt.getState();yt.lastEvent.current=gt;const Ct=ht==="onPointerMove",wt=ht==="onClick"||ht==="onContextMenu"||ht==="onDoubleClick",Pt=ot(gt,Ct?tt:void 0),Rt=wt?_(gt):0;ht==="onPointerDown"&&(yt.initialClick=[gt.offsetX,gt.offsetY],yt.initialHits=Pt.map(Nt=>Nt.eventObject)),wt&&!Pt.length&&Rt<=2&&(lt(gt,yt.interaction),Et&&Et(gt)),Ct&&at(Pt);function xt(Nt){const kt=Nt.eventObject,Vt=kt.__r3f,Ft=Vt==null?void 0:Vt.handlers;if(Vt!=null&&Vt.eventCount)if(Ct){if(Ft.onPointerOver||Ft.onPointerEnter||Ft.onPointerOut||Ft.onPointerLeave){const zt=makeId(Nt),Yt=yt.hovered.get(zt);Yt?Yt.stopped&&Nt.stopPropagation():(yt.hovered.set(zt,Nt),Ft.onPointerOver==null||Ft.onPointerOver(Nt),Ft.onPointerEnter==null||Ft.onPointerEnter(Nt))}Ft.onPointerMove==null||Ft.onPointerMove(Nt)}else{const zt=Ft[ht];zt?(!wt||yt.initialHits.includes(kt))&&(lt(gt,yt.interaction.filter(Yt=>!yt.initialHits.includes(Yt))),zt(Nt)):wt&&yt.initialHits.includes(kt)&&lt(gt,yt.interaction.filter(Yt=>!yt.initialHits.includes(Yt)))}}st(Pt,gt,Rt,xt)}}return{handlePointer:dt}}const privateKeys=["set","get","setSize","setFrameloop","setDpr","events","invalidate","advance","size","viewport"],isRenderer=nt=>!!(nt!=null&&nt.render),context=reactExports.createContext(null),createStore=(nt,_)=>{const tt=create$2((dt,ht)=>{const ft=new Vector3,gt=new Vector3,Et=new Vector3;function yt(Rt=ht().camera,xt=gt,Nt=ht().size){const{width:kt,height:Vt,top:Ft,left:zt}=Nt,Yt=kt/Vt;xt instanceof Vector3?Et.copy(xt):Et.set(...xt);const Kt=Rt.getWorldPosition(ft).distanceTo(Et);if(isOrthographicCamera$1(Rt))return{width:kt/Rt.zoom,height:Vt/Rt.zoom,top:Ft,left:zt,factor:1,distance:Kt,aspect:Yt};{const qt=Rt.fov*Math.PI/180,pn=2*Math.tan(qt/2)*Kt,an=pn*(kt/Vt);return{width:an,height:pn,top:Ft,left:zt,factor:kt/an,distance:Kt,aspect:Yt}}}let Ct;const wt=Rt=>dt(xt=>({performance:{...xt.performance,current:Rt}})),It=new Vector2;return{set:dt,get:ht,gl:null,camera:null,raycaster:null,events:{priority:1,enabled:!0,connected:!1},xr:null,scene:null,invalidate:(Rt=1)=>nt(ht(),Rt),advance:(Rt,xt)=>_(Rt,xt,ht()),legacy:!1,linear:!1,flat:!1,controls:null,clock:new Clock,pointer:It,mouse:It,frameloop:"always",onPointerMissed:void 0,performance:{current:1,min:.5,max:1,debounce:200,regress:()=>{const Rt=ht();Ct&&clearTimeout(Ct),Rt.performance.current!==Rt.performance.min&&wt(Rt.performance.min),Ct=setTimeout(()=>wt(ht().performance.max),Rt.performance.debounce)}},size:{width:0,height:0,top:0,left:0,updateStyle:!1},viewport:{initialDpr:0,dpr:0,width:0,height:0,top:0,left:0,aspect:0,distance:0,factor:0,getCurrentViewport:yt},setEvents:Rt=>dt(xt=>({...xt,events:{...xt.events,...Rt}})),setSize:(Rt,xt,Nt,kt,Vt)=>{const Ft=ht().camera,zt={width:Rt,height:xt,top:kt||0,left:Vt||0,updateStyle:Nt};dt(Yt=>({size:zt,viewport:{...Yt.viewport,...yt(Ft,gt,zt)}}))},setDpr:Rt=>dt(xt=>{const Nt=calculateDpr(Rt);return{viewport:{...xt.viewport,dpr:Nt,initialDpr:xt.viewport.initialDpr||Nt}}}),setFrameloop:(Rt="always")=>{const xt=ht().clock;xt.stop(),xt.elapsedTime=0,Rt!=="never"&&(xt.start(),xt.elapsedTime=0),dt(()=>({frameloop:Rt}))},previousRoot:void 0,internal:{active:!1,priority:0,frames:0,lastEvent:reactExports.createRef(),interaction:[],hovered:new Map,subscribers:[],initialClick:[0,0],initialHits:[],capturedMap:new Map,subscribe:(Rt,xt,Nt)=>{const kt=ht().internal;return kt.priority=kt.priority+(xt>0?1:0),kt.subscribers.push({ref:Rt,priority:xt,store:Nt}),kt.subscribers=kt.subscribers.sort((Vt,Ft)=>Vt.priority-Ft.priority),()=>{const Vt=ht().internal;Vt!=null&&Vt.subscribers&&(Vt.priority=Vt.priority-(xt>0?1:0),Vt.subscribers=Vt.subscribers.filter(Ft=>Ft.ref!==Rt))}}}}}),ot=tt.getState();let st=ot.size,at=ot.viewport.dpr,lt=ot.camera;return tt.subscribe(()=>{const{camera:dt,size:ht,viewport:ft,gl:gt,set:Et}=tt.getState();if(ht!==st||ft.dpr!==at){var yt;st=ht,at=ft.dpr,updateCamera(dt,ht),gt.setPixelRatio(ft.dpr);const Ct=(yt=ht.updateStyle)!=null?yt:typeof HTMLCanvasElement<"u"&&gt.domElement instanceof HTMLCanvasElement;gt.setSize(ht.width,ht.height,Ct)}dt!==lt&&(lt=dt,Et(Ct=>({viewport:{...Ct.viewport,...Ct.viewport.getCurrentViewport(dt)}})))}),tt.subscribe(dt=>nt(dt)),tt};let i$6,globalEffects=new Set,globalAfterEffects=new Set,globalTailEffects=new Set;function run(nt,_){if(nt.size)for(const{callback:tt}of nt.values())tt(_)}function flushGlobalEffects(nt,_){switch(nt){case"before":return run(globalEffects,_);case"after":return run(globalAfterEffects,_);case"tail":return run(globalTailEffects,_)}}let subscribers,subscription;function render$1(nt,_,tt){let ot=_.clock.getDelta();for(_.frameloop==="never"&&typeof nt=="number"&&(ot=nt-_.clock.elapsedTime,_.clock.oldTime=_.clock.elapsedTime,_.clock.elapsedTime=nt),subscribers=_.internal.subscribers,i$6=0;i$6<subscribers.length;i$6++)subscription=subscribers[i$6],subscription.ref.current(subscription.store.getState(),ot,tt);return!_.internal.priority&&_.gl.render&&_.gl.render(_.scene,_.camera),_.internal.frames=Math.max(0,_.internal.frames-1),_.frameloop==="always"?1:_.internal.frames}function createLoop(nt){let _=!1,tt,ot,st;function at(ht){ot=requestAnimationFrame(at),_=!0,tt=0,flushGlobalEffects("before",ht);for(const gt of nt.values()){var ft;st=gt.store.getState(),st.internal.active&&(st.frameloop==="always"||st.internal.frames>0)&&!((ft=st.gl.xr)!=null&&ft.isPresenting)&&(tt+=render$1(ht,st))}if(flushGlobalEffects("after",ht),tt===0)return flushGlobalEffects("tail",ht),_=!1,cancelAnimationFrame(ot)}function lt(ht,ft=1){var gt;if(!ht)return nt.forEach(Et=>lt(Et.store.getState()),ft);(gt=ht.gl.xr)!=null&&gt.isPresenting||!ht.internal.active||ht.frameloop==="never"||(ht.internal.frames=Math.min(60,ht.internal.frames+ft),_||(_=!0,requestAnimationFrame(at)))}function dt(ht,ft=!0,gt,Et){if(ft&&flushGlobalEffects("before",ht),gt)render$1(ht,gt,Et);else for(const yt of nt.values())render$1(ht,yt.store.getState());ft&&flushGlobalEffects("after",ht)}return{loop:at,invalidate:lt,advance:dt}}function useStore(){const nt=reactExports.useContext(context);if(!nt)throw new Error("R3F: Hooks can only be used within the Canvas component!");return nt}function useThree(nt=tt=>tt,_){return useStore()(nt,_)}function useFrame(nt,_=0){const tt=useStore(),ot=tt.getState().internal.subscribe,st=useMutableCallback(nt);return useIsomorphicLayoutEffect(()=>ot(st,_,tt),[_,ot,tt]),null}function loadingFn(nt,_){return function(tt,...ot){const st=new tt;return nt&&nt(st),Promise.all(ot.map(at=>new Promise((lt,dt)=>st.load(at,ht=>{ht.scene&&Object.assign(ht,buildGraph(ht.scene)),lt(ht)},_,ht=>dt(new Error(`Could not load ${at}: ${ht.message})`))))))}}function useLoader(nt,_,tt,ot){const st=Array.isArray(_)?_:[_],at=suspend(loadingFn(tt,ot),[nt,...st],{equal:is.equ});return Array.isArray(_)?at:at[0]}useLoader.preload=function(nt,_,tt){const ot=Array.isArray(_)?_:[_];return preload(loadingFn(tt),[nt,...ot])};useLoader.clear=function(nt,_){const tt=Array.isArray(_)?_:[_];return clear([nt,...tt])};const roots$1=new Map,{invalidate,advance}=createLoop(roots$1),{reconciler,applyProps}=createRenderer(roots$1,getEventPriority),shallowLoose={objects:"shallow",strict:!1},createRendererInstance=(nt,_)=>{const tt=typeof nt=="function"?nt(_):nt;return isRenderer(tt)?tt:new WebGLRenderer({powerPreference:"high-performance",canvas:_,antialias:!0,alpha:!0,...nt})};function computeInitialSize(nt,_){if(_)return _;if(typeof HTMLCanvasElement<"u"&&nt instanceof HTMLCanvasElement&&nt.parentElement){const{width:tt,height:ot,top:st,left:at}=nt.parentElement.getBoundingClientRect();return{width:tt,height:ot,top:st,left:at}}else if(typeof OffscreenCanvas<"u"&&nt instanceof OffscreenCanvas)return{width:nt.width,height:nt.height,top:0,left:0};return{width:0,height:0,top:0,left:0}}function createRoot(nt){const _=roots$1.get(nt),tt=_==null?void 0:_.fiber,ot=_==null?void 0:_.store;_&&console.warn("R3F.createRoot should only be called once!");const st=typeof reportError=="function"?reportError:console.error,at=ot||createStore(invalidate,advance),lt=tt||reconciler.createContainer(at,constantsExports.ConcurrentRoot,null,!1,null,"",st,null);_||roots$1.set(nt,{fiber:lt,store:at});let dt,ht=!1,ft;return{configure(gt={}){let{gl:Et,size:yt,scene:Ct,events:wt,onCreated:It,shadows:Pt=!1,linear:Rt=!1,flat:xt=!1,legacy:Nt=!1,orthographic:kt=!1,frameloop:Vt="always",dpr:Ft=[1,2],performance:zt,raycaster:Yt,camera:Kt,onPointerMissed:qt}=gt,pn=at.getState(),an=pn.gl;pn.gl||pn.set({gl:an=createRendererInstance(Et,nt)});let fn=pn.raycaster;fn||pn.set({raycaster:fn=new Raycaster});const{params:dn,...Cn}=Yt||{};if(is.equ(Cn,fn,shallowLoose)||applyProps(fn,{...Cn}),is.equ(dn,fn.params,shallowLoose)||applyProps(fn,{params:{...fn.params,...dn}}),!pn.camera||pn.camera===ft&&!is.equ(ft,Kt,shallowLoose)){ft=Kt;const gn=Kt instanceof Camera,_n=gn?Kt:kt?new OrthographicCamera(0,0,0,0,.1,1e3):new PerspectiveCamera(75,0,.1,1e3);gn||(_n.position.z=5,Kt&&applyProps(_n,Kt),!pn.camera&&!(Kt!=null&&Kt.rotation)&&_n.lookAt(0,0,0)),pn.set({camera:_n})}if(!pn.scene){let gn;Ct instanceof Scene?gn=Ct:(gn=new Scene,Ct&&applyProps(gn,Ct)),pn.set({scene:prepare(gn)})}if(!pn.xr){const gn=(bn,jn)=>{const kn=at.getState();kn.frameloop!=="never"&&advance(bn,!0,kn,jn)},_n=()=>{const bn=at.getState();bn.gl.xr.enabled=bn.gl.xr.isPresenting,bn.gl.xr.setAnimationLoop(bn.gl.xr.isPresenting?gn:null),bn.gl.xr.isPresenting||invalidate(bn)},Rn={connect(){const bn=at.getState().gl;bn.xr.addEventListener("sessionstart",_n),bn.xr.addEventListener("sessionend",_n)},disconnect(){const bn=at.getState().gl;bn.xr.removeEventListener("sessionstart",_n),bn.xr.removeEventListener("sessionend",_n)}};an.xr&&Rn.connect(),pn.set({xr:Rn})}if(an.shadowMap){const gn=an.shadowMap.enabled,_n=an.shadowMap.type;if(an.shadowMap.enabled=!!Pt,is.boo(Pt))an.shadowMap.type=PCFSoftShadowMap;else if(is.str(Pt)){var On;const Rn={basic:BasicShadowMap,percentage:PCFShadowMap,soft:PCFSoftShadowMap,variance:VSMShadowMap};an.shadowMap.type=(On=Rn[Pt])!=null?On:PCFSoftShadowMap}else is.obj(Pt)&&Object.assign(an.shadowMap,Pt);(gn!==an.shadowMap.enabled||_n!==an.shadowMap.type)&&(an.shadowMap.needsUpdate=!0)}const Pn=getColorManagement();Pn&&("enabled"in Pn?Pn.enabled=!Nt:"legacyMode"in Pn&&(Pn.legacyMode=Nt)),applyProps(an,{outputEncoding:Rt?3e3:3001,toneMapping:xt?NoToneMapping:ACESFilmicToneMapping}),pn.legacy!==Nt&&pn.set(()=>({legacy:Nt})),pn.linear!==Rt&&pn.set(()=>({linear:Rt})),pn.flat!==xt&&pn.set(()=>({flat:xt})),Et&&!is.fun(Et)&&!isRenderer(Et)&&!is.equ(Et,an,shallowLoose)&&applyProps(an,Et),wt&&!pn.events.handlers&&pn.set({events:wt(at)});const Sn=computeInitialSize(nt,yt);return is.equ(Sn,pn.size,shallowLoose)||pn.setSize(Sn.width,Sn.height,Sn.updateStyle,Sn.top,Sn.left),Ft&&pn.viewport.dpr!==calculateDpr(Ft)&&pn.setDpr(Ft),pn.frameloop!==Vt&&pn.setFrameloop(Vt),pn.onPointerMissed||pn.set({onPointerMissed:qt}),zt&&!is.equ(zt,pn.performance,shallowLoose)&&pn.set(gn=>({performance:{...gn.performance,...zt}})),dt=It,ht=!0,this},render(gt){return ht||this.configure(),reconciler.updateContainer(reactExports.createElement(Provider,{store:at,children:gt,onCreated:dt,rootElement:nt}),lt,null,()=>{}),at},unmount(){unmountComponentAtNode(nt)}}}function Provider({store:nt,children:_,onCreated:tt,rootElement:ot}){return useIsomorphicLayoutEffect(()=>{const st=nt.getState();st.set(at=>({internal:{...at.internal,active:!0}})),tt&&tt(st),nt.getState().events.connected||st.events.connect==null||st.events.connect(ot)},[]),reactExports.createElement(context.Provider,{value:nt},_)}function unmountComponentAtNode(nt,_){const tt=roots$1.get(nt),ot=tt==null?void 0:tt.fiber;if(ot){const st=tt==null?void 0:tt.store.getState();st&&(st.internal.active=!1),reconciler.updateContainer(null,ot,null,()=>{st&&setTimeout(()=>{try{var at,lt,dt,ht;st.events.disconnect==null||st.events.disconnect(),(at=st.gl)==null||(lt=at.renderLists)==null||lt.dispose==null||lt.dispose(),(dt=st.gl)==null||dt.forceContextLoss==null||dt.forceContextLoss(),(ht=st.gl)!=null&&ht.xr&&st.xr.disconnect(),dispose(st),roots$1.delete(nt),_&&_(nt)}catch{}},500)})}}function createPortal(nt,_,tt){return reactExports.createElement(Portal$1,{key:_.uuid,children:nt,container:_,state:tt})}function Portal$1({state:nt={},children:_,container:tt}){const{events:ot,size:st,...at}=nt,lt=useStore(),[dt]=reactExports.useState(()=>new Raycaster),[ht]=reactExports.useState(()=>new Vector2),ft=reactExports.useCallback((Et,yt)=>{const Ct={...Et};Object.keys(Et).forEach(It=>{(privateKeys.includes(It)||Et[It]!==yt[It]&&yt[It])&&delete Ct[It]});let wt;if(yt&&st){const It=yt.camera;wt=Et.viewport.getCurrentViewport(It,new Vector3,st),It!==Et.camera&&updateCamera(It,st)}return{...Ct,scene:tt,raycaster:dt,pointer:ht,mouse:ht,previousRoot:lt,events:{...Et.events,...yt==null?void 0:yt.events,...ot},size:{...Et.size,...st},viewport:{...Et.viewport,...wt},...at}},[nt]),[gt]=reactExports.useState(()=>{const Et=lt.getState();return create$2((Ct,wt)=>({...Et,scene:tt,raycaster:dt,pointer:ht,mouse:ht,previousRoot:lt,events:{...Et.events,...ot},size:{...Et.size,...st},...at,set:Ct,get:wt,setEvents:It=>Ct(Pt=>({...Pt,events:{...Pt.events,...It}}))}))});return reactExports.useEffect(()=>{const Et=lt.subscribe(yt=>gt.setState(Ct=>ft(yt,Ct)));return()=>{Et(),gt.destroy()}},[]),reactExports.useEffect(()=>{gt.setState(Et=>ft(lt.getState(),Et))},[ft]),reactExports.createElement(reactExports.Fragment,null,reconciler.createPortal(reactExports.createElement(context.Provider,{value:gt},_),gt,null))}reconciler.injectIntoDevTools({bundleType:0,rendererPackageName:"@react-three/fiber",version:reactExports.version});function g$5(nt,_){let tt;return(...ot)=>{window.clearTimeout(tt),tt=window.setTimeout(()=>nt(...ot),_)}}function j$2({debounce:nt,scroll:_,polyfill:tt,offsetSize:ot}={debounce:0,scroll:!1,offsetSize:!1}){const st=tt||(typeof window>"u"?class{}:window.ResizeObserver);if(!st)throw new Error("This browser does not support ResizeObserver out of the box. See: https://github.com/react-spring/react-use-measure/#resize-observer-polyfills");const[at,lt]=reactExports.useState({left:0,top:0,width:0,height:0,bottom:0,right:0,x:0,y:0}),dt=reactExports.useRef({element:null,scrollContainers:null,resizeObserver:null,lastBounds:at,orientationHandler:null}),ht=nt?typeof nt=="number"?nt:nt.scroll:null,ft=nt?typeof nt=="number"?nt:nt.resize:null,gt=reactExports.useRef(!1);reactExports.useEffect(()=>(gt.current=!0,()=>void(gt.current=!1)));const[Et,yt,Ct]=reactExports.useMemo(()=>{const Rt=()=>{if(!dt.current.element)return;const{left:xt,top:Nt,width:kt,height:Vt,bottom:Ft,right:zt,x:Yt,y:Kt}=dt.current.element.getBoundingClientRect(),qt={left:xt,top:Nt,width:kt,height:Vt,bottom:Ft,right:zt,x:Yt,y:Kt};dt.current.element instanceof HTMLElement&&ot&&(qt.height=dt.current.element.offsetHeight,qt.width=dt.current.element.offsetWidth),Object.freeze(qt),gt.current&&!D$3(dt.current.lastBounds,qt)&&lt(dt.current.lastBounds=qt)};return[Rt,ft?g$5(Rt,ft):Rt,ht?g$5(Rt,ht):Rt]},[lt,ot,ht,ft]);function wt(){dt.current.scrollContainers&&(dt.current.scrollContainers.forEach(Rt=>Rt.removeEventListener("scroll",Ct,!0)),dt.current.scrollContainers=null),dt.current.resizeObserver&&(dt.current.resizeObserver.disconnect(),dt.current.resizeObserver=null),dt.current.orientationHandler&&("orientation"in screen&&"removeEventListener"in screen.orientation?screen.orientation.removeEventListener("change",dt.current.orientationHandler):"onorientationchange"in window&&window.removeEventListener("orientationchange",dt.current.orientationHandler))}function It(){dt.current.element&&(dt.current.resizeObserver=new st(Ct),dt.current.resizeObserver.observe(dt.current.element),_&&dt.current.scrollContainers&&dt.current.scrollContainers.forEach(Rt=>Rt.addEventListener("scroll",Ct,{capture:!0,passive:!0})),dt.current.orientationHandler=()=>{Ct()},"orientation"in screen&&"addEventListener"in screen.orientation?screen.orientation.addEventListener("change",dt.current.orientationHandler):"onorientationchange"in window&&window.addEventListener("orientationchange",dt.current.orientationHandler))}const Pt=Rt=>{!Rt||Rt===dt.current.element||(wt(),dt.current.element=Rt,dt.current.scrollContainers=E$2(Rt),It())};return X(Ct,!!_),W$2(yt),reactExports.useEffect(()=>{wt(),It()},[_,Ct,yt]),reactExports.useEffect(()=>wt,[]),[Pt,at,Et]}function W$2(nt){reactExports.useEffect(()=>{const _=nt;return window.addEventListener("resize",_),()=>void window.removeEventListener("resize",_)},[nt])}function X(nt,_){reactExports.useEffect(()=>{if(_){const tt=nt;return window.addEventListener("scroll",tt,{capture:!0,passive:!0}),()=>void window.removeEventListener("scroll",tt,!0)}},[nt,_])}function E$2(nt){const _=[];if(!nt||nt===document.body)return _;const{overflow:tt,overflowX:ot,overflowY:st}=window.getComputedStyle(nt);return[tt,ot,st].some(at=>at==="auto"||at==="scroll")&&_.push(nt),[..._,...E$2(nt.parentElement)]}const k$4=["x","y","top","bottom","left","right","width","height"],D$3=(nt,_)=>k$4.every(tt=>nt[tt]===_[tt]);var __defProp=Object.defineProperty,__defProps=Object.defineProperties,__getOwnPropDescs=Object.getOwnPropertyDescriptors,__getOwnPropSymbols=Object.getOwnPropertySymbols,__hasOwnProp=Object.prototype.hasOwnProperty,__propIsEnum=Object.prototype.propertyIsEnumerable,__defNormalProp=(nt,_,tt)=>_ in nt?__defProp(nt,_,{enumerable:!0,configurable:!0,writable:!0,value:tt}):nt[_]=tt,__spreadValues=(nt,_)=>{for(var tt in _||(_={}))__hasOwnProp.call(_,tt)&&__defNormalProp(nt,tt,_[tt]);if(__getOwnPropSymbols)for(var tt of __getOwnPropSymbols(_))__propIsEnum.call(_,tt)&&__defNormalProp(nt,tt,_[tt]);return nt},__spreadProps=(nt,_)=>__defProps(nt,__getOwnPropDescs(_)),_a$2,_b$1;typeof window<"u"&&((_a$2=window.document)!=null&&_a$2.createElement||((_b$1=window.navigator)==null?void 0:_b$1.product)==="ReactNative")?reactExports.useLayoutEffect:reactExports.useEffect;function traverseFiber(nt,_,tt){if(!nt)return;if(tt(nt)===!0)return nt;let ot=_?nt.return:nt.child;for(;ot;){const st=traverseFiber(ot,_,tt);if(st)return st;ot=_?null:ot.sibling}}function wrapContext(nt){try{return Object.defineProperties(nt,{_currentRenderer:{get(){return null},set(){}},_currentRenderer2:{get(){return null},set(){}}})}catch{return nt}}const error=console.error;console.error=function(){const nt=[...arguments].join("");if(nt!=null&&nt.startsWith("Warning:")&&nt.includes("useContext")){console.error=error;return}return error.apply(this,arguments)};const FiberContext=wrapContext(reactExports.createContext(null));class FiberProvider extends reactExports.Component{render(){return reactExports.createElement(FiberContext.Provider,{value:this._reactInternals},this.props.children)}}function useFiber(){const nt=reactExports.useContext(FiberContext);if(nt===null)throw new Error("its-fine: useFiber must be called within a <FiberProvider />!");const _=reactExports.useId();return reactExports.useMemo(()=>{for(const ot of[nt,nt==null?void 0:nt.alternate]){if(!ot)continue;const st=traverseFiber(ot,!1,at=>{let lt=at.memoizedState;for(;lt;){if(lt.memoizedState===_)return!0;lt=lt.next}});if(st)return st}},[nt,_])}function useContextMap(){const nt=useFiber(),[_]=reactExports.useState(()=>new Map);_.clear();let tt=nt;for(;tt;){if(tt.type&&typeof tt.type=="object"){const st=tt.type._context===void 0&&tt.type.Provider===tt.type?tt.type:tt.type._context;st&&st!==FiberContext&&!_.has(st)&&_.set(st,reactExports.useContext(wrapContext(st)))}tt=tt.return}return _}function useContextBridge(){const nt=useContextMap();return reactExports.useMemo(()=>Array.from(nt.keys()).reduce((_,tt)=>ot=>reactExports.createElement(_,null,reactExports.createElement(tt.Provider,__spreadProps(__spreadValues({},ot),{value:nt.get(tt)}))),_=>reactExports.createElement(FiberProvider,__spreadValues({},_))),[nt])}const DOM_EVENTS={onClick:["click",!1],onContextMenu:["contextmenu",!1],onDoubleClick:["dblclick",!1],onWheel:["wheel",!0],onPointerDown:["pointerdown",!0],onPointerUp:["pointerup",!0],onPointerLeave:["pointerleave",!0],onPointerMove:["pointermove",!0],onPointerCancel:["pointercancel",!0],onLostPointerCapture:["lostpointercapture",!0]};function createPointerEvents(nt){const{handlePointer:_}=createEvents(nt);return{priority:1,enabled:!0,compute(tt,ot,st){ot.pointer.set(tt.offsetX/ot.size.width*2-1,-(tt.offsetY/ot.size.height)*2+1),ot.raycaster.setFromCamera(ot.pointer,ot.camera)},connected:void 0,handlers:Object.keys(DOM_EVENTS).reduce((tt,ot)=>({...tt,[ot]:_(ot)}),{}),update:()=>{var tt;const{events:ot,internal:st}=nt.getState();(tt=st.lastEvent)!=null&&tt.current&&ot.handlers&&ot.handlers.onPointerMove(st.lastEvent.current)},connect:tt=>{var ot;const{set:st,events:at}=nt.getState();at.disconnect==null||at.disconnect(),st(lt=>({events:{...lt.events,connected:tt}})),Object.entries((ot=at.handlers)!=null?ot:[]).forEach(([lt,dt])=>{const[ht,ft]=DOM_EVENTS[lt];tt.addEventListener(ht,dt,{passive:ft})})},disconnect:()=>{const{set:tt,events:ot}=nt.getState();if(ot.connected){var st;Object.entries((st=ot.handlers)!=null?st:[]).forEach(([at,lt])=>{if(ot&&ot.connected instanceof HTMLElement){const[dt]=DOM_EVENTS[at];ot.connected.removeEventListener(dt,lt)}}),tt(at=>({events:{...at.events,connected:void 0}}))}}}}const CanvasImpl=reactExports.forwardRef(function({children:_,fallback:tt,resize:ot,style:st,gl:at,events:lt=createPointerEvents,eventSource:dt,eventPrefix:ht,shadows:ft,linear:gt,flat:Et,legacy:yt,orthographic:Ct,frameloop:wt,dpr:It,performance:Pt,raycaster:Rt,camera:xt,onPointerMissed:Nt,onCreated:kt,...Vt},Ft){reactExports.useMemo(()=>extend$2(THREE$1),[]);const zt=useContextBridge(),[Yt,Kt]=j$2({scroll:!0,debounce:{scroll:50,resize:0},...ot}),qt=reactExports.useRef(null),pn=reactExports.useRef(null);reactExports.useImperativeHandle(Ft,()=>qt.current);const an=useMutableCallback(Nt),[fn,dn]=reactExports.useState(!1),[Cn,On]=reactExports.useState(!1);if(fn)throw fn;if(Cn)throw Cn;const Pn=reactExports.useRef(null);useIsomorphicLayoutEffect(()=>{const An=qt.current;Kt.width>0&&Kt.height>0&&An&&(Pn.current||(Pn.current=createRoot(An)),Pn.current.configure({gl:at,events:lt,shadows:ft,linear:gt,flat:Et,legacy:yt,orthographic:Ct,frameloop:wt,dpr:It,performance:Pt,raycaster:Rt,camera:xt,size:Kt,onPointerMissed:(...Sn)=>an.current==null?void 0:an.current(...Sn),onCreated:Sn=>{Sn.events.connect==null||Sn.events.connect(dt?isRef$1(dt)?dt.current:dt:pn.current),ht&&Sn.setEvents({compute:(gn,_n)=>{const Rn=gn[ht+"X"],bn=gn[ht+"Y"];_n.pointer.set(Rn/_n.size.width*2-1,-(bn/_n.size.height)*2+1),_n.raycaster.setFromCamera(_n.pointer,_n.camera)}}),kt==null||kt(Sn)}}),Pn.current.render(reactExports.createElement(zt,null,reactExports.createElement(ErrorBoundary,{set:On},reactExports.createElement(reactExports.Suspense,{fallback:reactExports.createElement(Block,{set:dn})},_)))))}),reactExports.useEffect(()=>{const An=qt.current;if(An)return()=>unmountComponentAtNode(An)},[]);const yn=dt?"none":"auto";return reactExports.createElement("div",_extends$1({ref:pn,style:{position:"relative",width:"100%",height:"100%",overflow:"hidden",pointerEvents:yn,...st}},Vt),reactExports.createElement("div",{ref:Yt,style:{width:"100%",height:"100%"}},reactExports.createElement("canvas",{ref:qt,style:{display:"block"}},tt)))}),Canvas$1=reactExports.forwardRef(function(_,tt){return reactExports.createElement(FiberProvider,null,reactExports.createElement(CanvasImpl,_extends$1({},_,{ref:tt})))});let saveLastTotalLoaded=0;const useProgress=create$2(nt=>(DefaultLoadingManager.onStart=(_,tt,ot)=>{nt({active:!0,item:_,loaded:tt,total:ot,progress:(tt-saveLastTotalLoaded)/(ot-saveLastTotalLoaded)*100})},DefaultLoadingManager.onLoad=()=>{nt({active:!1})},DefaultLoadingManager.onError=_=>nt(tt=>({errors:[...tt.errors,_]})),DefaultLoadingManager.onProgress=(_,tt,ot)=>{tt===ot&&(saveLastTotalLoaded=ot),nt({active:!0,item:_,loaded:tt,total:ot,progress:(tt-saveLastTotalLoaded)/(ot-saveLastTotalLoaded)*100||100})},{errors:[],active:!1,progress:0,item:"",loaded:0,total:0})),defaultDataInterpolation=nt=>`Loading ${nt.toFixed(2)}%`;function Loader({containerStyles:nt,innerStyles:_,barStyles:tt,dataStyles:ot,dataInterpolation:st=defaultDataInterpolation,initialState:at=lt=>lt}){const{active:lt,progress:dt}=useProgress(),ht=reactExports.useRef(0),ft=reactExports.useRef(0),gt=reactExports.useRef(null),[Et,yt]=reactExports.useState(at(lt));reactExports.useEffect(()=>{let wt;return lt!==Et&&(wt=setTimeout(()=>yt(lt),300)),()=>clearTimeout(wt)},[Et,lt]);const Ct=reactExports.useCallback(()=>{gt.current&&(ht.current+=(dt-ht.current)/2,(ht.current>.95*dt||dt===100)&&(ht.current=dt),gt.current.innerText=st(ht.current),ht.current<dt&&(ft.current=requestAnimationFrame(Ct)))},[st,dt]);return reactExports.useEffect(()=>(Ct(),()=>cancelAnimationFrame(ft.current)),[Ct]),Et?reactExports.createElement("div",{style:{...styles.container,opacity:lt?1:0,...nt}},reactExports.createElement("div",null,reactExports.createElement("div",{style:{...styles.inner,..._}},reactExports.createElement("div",{style:{...styles.bar,transform:`scaleX(${dt/100})`,...tt}}),reactExports.createElement("span",{ref:gt,style:{...styles.data,...ot}})))):null}const styles={container:{position:"absolute",top:0,left:0,width:"100%",height:"100%",background:"#171717",display:"flex",alignItems:"center",justifyContent:"center",transition:"opacity 300ms ease",zIndex:1e3},inner:{width:100,height:3,background:"#272727",textAlign:"center"},bar:{height:3,width:"100%",background:"white",transition:"transform 200ms",transformOrigin:"left center"},data:{display:"inline-block",position:"relative",fontVariantNumeric:"tabular-nums",marginTop:"0.8em",color:"#f0f0f0",fontSize:"0.6em",fontFamily:'-apple-system, BlinkMacSystemFont, "Inter", "Segoe UI", "Helvetica Neue", Helvetica, Arial, Roboto, Ubuntu, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"',whiteSpace:"nowrap"}};function clamp$2(nt,_,tt){return Math.max(_,Math.min(nt,tt))}const V$2={toVector(nt,_){return nt===void 0&&(nt=_),Array.isArray(nt)?nt:[nt,nt]},add(nt,_){return[nt[0]+_[0],nt[1]+_[1]]},sub(nt,_){return[nt[0]-_[0],nt[1]-_[1]]},addTo(nt,_){nt[0]+=_[0],nt[1]+=_[1]},subTo(nt,_){nt[0]-=_[0],nt[1]-=_[1]}};function rubberband(nt,_,tt){return _===0||Math.abs(_)===1/0?Math.pow(nt,tt*5):nt*_*tt/(_+tt*nt)}function rubberbandIfOutOfBounds(nt,_,tt,ot=.15){return ot===0?clamp$2(nt,_,tt):nt<_?-rubberband(_-nt,tt-_,ot)+_:nt>tt?+rubberband(nt-tt,tt-_,ot)+tt:nt}function computeRubberband(nt,[_,tt],[ot,st]){const[[at,lt],[dt,ht]]=nt;return[rubberbandIfOutOfBounds(_,at,lt,ot),rubberbandIfOutOfBounds(tt,dt,ht,st)]}function _toPrimitive(nt,_){if(typeof nt!="object"||nt===null)return nt;var tt=nt[Symbol.toPrimitive];if(tt!==void 0){var ot=tt.call(nt,_||"default");if(typeof ot!="object")return ot;throw new TypeError("@@toPrimitive must return a primitive value.")}return(_==="string"?String:Number)(nt)}function _toPropertyKey(nt){var _=_toPrimitive(nt,"string");return typeof _=="symbol"?_:String(_)}function _defineProperty$3(nt,_,tt){return _=_toPropertyKey(_),_ in nt?Object.defineProperty(nt,_,{value:tt,enumerable:!0,configurable:!0,writable:!0}):nt[_]=tt,nt}function ownKeys$3(nt,_){var tt=Object.keys(nt);if(Object.getOwnPropertySymbols){var ot=Object.getOwnPropertySymbols(nt);_&&(ot=ot.filter(function(st){return Object.getOwnPropertyDescriptor(nt,st).enumerable})),tt.push.apply(tt,ot)}return tt}function _objectSpread2$1(nt){for(var _=1;_<arguments.length;_++){var tt=arguments[_]!=null?arguments[_]:{};_%2?ownKeys$3(Object(tt),!0).forEach(function(ot){_defineProperty$3(nt,ot,tt[ot])}):Object.getOwnPropertyDescriptors?Object.defineProperties(nt,Object.getOwnPropertyDescriptors(tt)):ownKeys$3(Object(tt)).forEach(function(ot){Object.defineProperty(nt,ot,Object.getOwnPropertyDescriptor(tt,ot))})}return nt}const EVENT_TYPE_MAP={pointer:{start:"down",change:"move",end:"up"},mouse:{start:"down",change:"move",end:"up"},touch:{start:"start",change:"move",end:"end"},gesture:{start:"start",change:"change",end:"end"}};function capitalize(nt){return nt?nt[0].toUpperCase()+nt.slice(1):""}const actionsWithoutCaptureSupported=["enter","leave"];function hasCapture(nt=!1,_){return nt&&!actionsWithoutCaptureSupported.includes(_)}function toHandlerProp(nt,_="",tt=!1){const ot=EVENT_TYPE_MAP[nt],st=ot&&ot[_]||_;return"on"+capitalize(nt)+capitalize(st)+(hasCapture(tt,st)?"Capture":"")}const pointerCaptureEvents=["gotpointercapture","lostpointercapture"];function parseProp(nt){let _=nt.substring(2).toLowerCase();const tt=!!~_.indexOf("passive");tt&&(_=_.replace("passive",""));const ot=pointerCaptureEvents.includes(_)?"capturecapture":"capture",st=!!~_.indexOf(ot);return st&&(_=_.replace("capture","")),{device:_,capture:st,passive:tt}}function toDomEventType(nt,_=""){const tt=EVENT_TYPE_MAP[nt],ot=tt&&tt[_]||_;return nt+ot}function isTouch(nt){return"touches"in nt}function getPointerType(nt){return isTouch(nt)?"touch":"pointerType"in nt?nt.pointerType:"mouse"}function getCurrentTargetTouchList(nt){return Array.from(nt.touches).filter(_=>{var tt,ot;return _.target===nt.currentTarget||((tt=nt.currentTarget)===null||tt===void 0||(ot=tt.contains)===null||ot===void 0?void 0:ot.call(tt,_.target))})}function getTouchList(nt){return nt.type==="touchend"||nt.type==="touchcancel"?nt.changedTouches:nt.targetTouches}function getValueEvent(nt){return isTouch(nt)?getTouchList(nt)[0]:nt}function touchIds(nt){return getCurrentTargetTouchList(nt).map(_=>_.identifier)}function pointerId(nt){const _=getValueEvent(nt);return isTouch(nt)?_.identifier:_.pointerId}function pointerValues(nt){const _=getValueEvent(nt);return[_.clientX,_.clientY]}function getEventDetails(nt){const _={};if("buttons"in nt&&(_.buttons=nt.buttons),"shiftKey"in nt){const{shiftKey:tt,altKey:ot,metaKey:st,ctrlKey:at}=nt;Object.assign(_,{shiftKey:tt,altKey:ot,metaKey:st,ctrlKey:at})}return _}function call(nt,..._){return typeof nt=="function"?nt(..._):nt}function noop$2(){}function chain(...nt){return nt.length===0?noop$2:nt.length===1?nt[0]:function(){let _;for(const tt of nt)_=tt.apply(this,arguments)||_;return _}}function assignDefault(nt,_){return Object.assign({},_,nt||{})}const BEFORE_LAST_KINEMATICS_DELAY=32;class Engine{constructor(_,tt,ot){this.ctrl=_,this.args=tt,this.key=ot,this.state||(this.state={},this.computeValues([0,0]),this.computeInitial(),this.init&&this.init(),this.reset())}get state(){return this.ctrl.state[this.key]}set state(_){this.ctrl.state[this.key]=_}get shared(){return this.ctrl.state.shared}get eventStore(){return this.ctrl.gestureEventStores[this.key]}get timeoutStore(){return this.ctrl.gestureTimeoutStores[this.key]}get config(){return this.ctrl.config[this.key]}get sharedConfig(){return this.ctrl.config.shared}get handler(){return this.ctrl.handlers[this.key]}reset(){const{state:_,shared:tt,ingKey:ot,args:st}=this;tt[ot]=_._active=_.active=_._blocked=_._force=!1,_._step=[!1,!1],_.intentional=!1,_._movement=[0,0],_._distance=[0,0],_._direction=[0,0],_._delta=[0,0],_._bounds=[[-1/0,1/0],[-1/0,1/0]],_.args=st,_.axis=void 0,_.memo=void 0,_.elapsedTime=_.timeDelta=0,_.direction=[0,0],_.distance=[0,0],_.overflow=[0,0],_._movementBound=[!1,!1],_.velocity=[0,0],_.movement=[0,0],_.delta=[0,0],_.timeStamp=0}start(_){const tt=this.state,ot=this.config;tt._active||(this.reset(),this.computeInitial(),tt._active=!0,tt.target=_.target,tt.currentTarget=_.currentTarget,tt.lastOffset=ot.from?call(ot.from,tt):tt.offset,tt.offset=tt.lastOffset,tt.startTime=tt.timeStamp=_.timeStamp)}computeValues(_){const tt=this.state;tt._values=_,tt.values=this.config.transform(_)}computeInitial(){const _=this.state;_._initial=_._values,_.initial=_.values}compute(_){const{state:tt,config:ot,shared:st}=this;tt.args=this.args;let at=0;if(_&&(tt.event=_,ot.preventDefault&&_.cancelable&&tt.event.preventDefault(),tt.type=_.type,st.touches=this.ctrl.pointerIds.size||this.ctrl.touchIds.size,st.locked=!!document.pointerLockElement,Object.assign(st,getEventDetails(_)),st.down=st.pressed=st.buttons%2===1||st.touches>0,at=_.timeStamp-tt.timeStamp,tt.timeStamp=_.timeStamp,tt.elapsedTime=tt.timeStamp-tt.startTime),tt._active){const Ft=tt._delta.map(Math.abs);V$2.addTo(tt._distance,Ft)}this.axisIntent&&this.axisIntent(_);const[lt,dt]=tt._movement,[ht,ft]=ot.threshold,{_step:gt,values:Et}=tt;if(ot.hasCustomTransform?(gt[0]===!1&&(gt[0]=Math.abs(lt)>=ht&&Et[0]),gt[1]===!1&&(gt[1]=Math.abs(dt)>=ft&&Et[1])):(gt[0]===!1&&(gt[0]=Math.abs(lt)>=ht&&Math.sign(lt)*ht),gt[1]===!1&&(gt[1]=Math.abs(dt)>=ft&&Math.sign(dt)*ft)),tt.intentional=gt[0]!==!1||gt[1]!==!1,!tt.intentional)return;const yt=[0,0];if(ot.hasCustomTransform){const[Ft,zt]=Et;yt[0]=gt[0]!==!1?Ft-gt[0]:0,yt[1]=gt[1]!==!1?zt-gt[1]:0}else yt[0]=gt[0]!==!1?lt-gt[0]:0,yt[1]=gt[1]!==!1?dt-gt[1]:0;this.restrictToAxis&&!tt._blocked&&this.restrictToAxis(yt);const Ct=tt.offset,wt=tt._active&&!tt._blocked||tt.active;wt&&(tt.first=tt._active&&!tt.active,tt.last=!tt._active&&tt.active,tt.active=st[this.ingKey]=tt._active,_&&(tt.first&&("bounds"in ot&&(tt._bounds=call(ot.bounds,tt)),this.setup&&this.setup()),tt.movement=yt,this.computeOffset()));const[It,Pt]=tt.offset,[[Rt,xt],[Nt,kt]]=tt._bounds;tt.overflow=[It<Rt?-1:It>xt?1:0,Pt<Nt?-1:Pt>kt?1:0],tt._movementBound[0]=tt.overflow[0]?tt._movementBound[0]===!1?tt._movement[0]:tt._movementBound[0]:!1,tt._movementBound[1]=tt.overflow[1]?tt._movementBound[1]===!1?tt._movement[1]:tt._movementBound[1]:!1;const Vt=tt._active?ot.rubberband||[0,0]:[0,0];if(tt.offset=computeRubberband(tt._bounds,tt.offset,Vt),tt.delta=V$2.sub(tt.offset,Ct),this.computeMovement(),wt&&(!tt.last||at>BEFORE_LAST_KINEMATICS_DELAY)){tt.delta=V$2.sub(tt.offset,Ct);const Ft=tt.delta.map(Math.abs);V$2.addTo(tt.distance,Ft),tt.direction=tt.delta.map(Math.sign),tt._direction=tt._delta.map(Math.sign),!tt.first&&at>0&&(tt.velocity=[Ft[0]/at,Ft[1]/at],tt.timeDelta=at)}}emit(){const _=this.state,tt=this.shared,ot=this.config;if(_._active||this.clean(),(_._blocked||!_.intentional)&&!_._force&&!ot.triggerAllEvents)return;const st=this.handler(_objectSpread2$1(_objectSpread2$1(_objectSpread2$1({},tt),_),{},{[this.aliasKey]:_.values}));st!==void 0&&(_.memo=st)}clean(){this.eventStore.clean(),this.timeoutStore.clean()}}function selectAxis([nt,_],tt){const ot=Math.abs(nt),st=Math.abs(_);if(ot>st&&ot>tt)return"x";if(st>ot&&st>tt)return"y"}class CoordinatesEngine extends Engine{constructor(..._){super(..._),_defineProperty$3(this,"aliasKey","xy")}reset(){super.reset(),this.state.axis=void 0}init(){this.state.offset=[0,0],this.state.lastOffset=[0,0]}computeOffset(){this.state.offset=V$2.add(this.state.lastOffset,this.state.movement)}computeMovement(){this.state.movement=V$2.sub(this.state.offset,this.state.lastOffset)}axisIntent(_){const tt=this.state,ot=this.config;if(!tt.axis&&_){const st=typeof ot.axisThreshold=="object"?ot.axisThreshold[getPointerType(_)]:ot.axisThreshold;tt.axis=selectAxis(tt._movement,st)}tt._blocked=(ot.lockDirection||!!ot.axis)&&!tt.axis||!!ot.axis&&ot.axis!==tt.axis}restrictToAxis(_){if(this.config.axis||this.config.lockDirection)switch(this.state.axis){case"x":_[1]=0;break;case"y":_[0]=0;break}}}const identity=nt=>nt,DEFAULT_RUBBERBAND=.15,commonConfigResolver={enabled(nt=!0){return nt},eventOptions(nt,_,tt){return _objectSpread2$1(_objectSpread2$1({},tt.shared.eventOptions),nt)},preventDefault(nt=!1){return nt},triggerAllEvents(nt=!1){return nt},rubberband(nt=0){switch(nt){case!0:return[DEFAULT_RUBBERBAND,DEFAULT_RUBBERBAND];case!1:return[0,0];default:return V$2.toVector(nt)}},from(nt){if(typeof nt=="function")return nt;if(nt!=null)return V$2.toVector(nt)},transform(nt,_,tt){const ot=nt||tt.shared.transform;return this.hasCustomTransform=!!ot,ot||identity},threshold(nt){return V$2.toVector(nt,0)}},DEFAULT_AXIS_THRESHOLD=0,coordinatesConfigResolver=_objectSpread2$1(_objectSpread2$1({},commonConfigResolver),{},{axis(nt,_,{axis:tt}){if(this.lockDirection=tt==="lock",!this.lockDirection)return tt},axisThreshold(nt=DEFAULT_AXIS_THRESHOLD){return nt},bounds(nt={}){if(typeof nt=="function")return at=>coordinatesConfigResolver.bounds(nt(at));if("current"in nt)return()=>nt.current;if(typeof HTMLElement=="function"&&nt instanceof HTMLElement)return nt;const{left:_=-1/0,right:tt=1/0,top:ot=-1/0,bottom:st=1/0}=nt;return[[_,tt],[ot,st]]}}),KEYS_DELTA_MAP={ArrowRight:(nt,_=1)=>[nt*_,0],ArrowLeft:(nt,_=1)=>[-1*nt*_,0],ArrowUp:(nt,_=1)=>[0,-1*nt*_],ArrowDown:(nt,_=1)=>[0,nt*_]};class DragEngine extends CoordinatesEngine{constructor(..._){super(..._),_defineProperty$3(this,"ingKey","dragging")}reset(){super.reset();const _=this.state;_._pointerId=void 0,_._pointerActive=!1,_._keyboardActive=!1,_._preventScroll=!1,_._delayed=!1,_.swipe=[0,0],_.tap=!1,_.canceled=!1,_.cancel=this.cancel.bind(this)}setup(){const _=this.state;if(_._bounds instanceof HTMLElement){const tt=_._bounds.getBoundingClientRect(),ot=_.currentTarget.getBoundingClientRect(),st={left:tt.left-ot.left+_.offset[0],right:tt.right-ot.right+_.offset[0],top:tt.top-ot.top+_.offset[1],bottom:tt.bottom-ot.bottom+_.offset[1]};_._bounds=coordinatesConfigResolver.bounds(st)}}cancel(){const _=this.state;_.canceled||(_.canceled=!0,_._active=!1,setTimeout(()=>{this.compute(),this.emit()},0))}setActive(){this.state._active=this.state._pointerActive||this.state._keyboardActive}clean(){this.pointerClean(),this.state._pointerActive=!1,this.state._keyboardActive=!1,super.clean()}pointerDown(_){const tt=this.config,ot=this.state;if(_.buttons!=null&&(Array.isArray(tt.pointerButtons)?!tt.pointerButtons.includes(_.buttons):tt.pointerButtons!==-1&&tt.pointerButtons!==_.buttons))return;const st=this.ctrl.setEventIds(_);tt.pointerCapture&&_.target.setPointerCapture(_.pointerId),!(st&&st.size>1&&ot._pointerActive)&&(this.start(_),this.setupPointer(_),ot._pointerId=pointerId(_),ot._pointerActive=!0,this.computeValues(pointerValues(_)),this.computeInitial(),tt.preventScrollAxis&&getPointerType(_)!=="mouse"?(ot._active=!1,this.setupScrollPrevention(_)):tt.delay>0?(this.setupDelayTrigger(_),tt.triggerAllEvents&&(this.compute(_),this.emit())):this.startPointerDrag(_))}startPointerDrag(_){const tt=this.state;tt._active=!0,tt._preventScroll=!0,tt._delayed=!1,this.compute(_),this.emit()}pointerMove(_){const tt=this.state,ot=this.config;if(!tt._pointerActive)return;const st=pointerId(_);if(tt._pointerId!==void 0&&st!==tt._pointerId)return;const at=pointerValues(_);if(document.pointerLockElement===_.target?tt._delta=[_.movementX,_.movementY]:(tt._delta=V$2.sub(at,tt._values),this.computeValues(at)),V$2.addTo(tt._movement,tt._delta),this.compute(_),tt._delayed&&tt.intentional){this.timeoutStore.remove("dragDelay"),tt.active=!1,this.startPointerDrag(_);return}if(ot.preventScrollAxis&&!tt._preventScroll)if(tt.axis)if(tt.axis===ot.preventScrollAxis||ot.preventScrollAxis==="xy"){tt._active=!1,this.clean();return}else{this.timeoutStore.remove("startPointerDrag"),this.startPointerDrag(_);return}else return;this.emit()}pointerUp(_){this.ctrl.setEventIds(_);try{this.config.pointerCapture&&_.target.hasPointerCapture(_.pointerId)&&_.target.releasePointerCapture(_.pointerId)}catch{}const tt=this.state,ot=this.config;if(!tt._active||!tt._pointerActive)return;const st=pointerId(_);if(tt._pointerId!==void 0&&st!==tt._pointerId)return;this.state._pointerActive=!1,this.setActive(),this.compute(_);const[at,lt]=tt._distance;if(tt.tap=at<=ot.tapsThreshold&&lt<=ot.tapsThreshold,tt.tap&&ot.filterTaps)tt._force=!0;else{const[dt,ht]=tt._delta,[ft,gt]=tt._movement,[Et,yt]=ot.swipe.velocity,[Ct,wt]=ot.swipe.distance,It=ot.swipe.duration;if(tt.elapsedTime<It){const Pt=Math.abs(dt/tt.timeDelta),Rt=Math.abs(ht/tt.timeDelta);Pt>Et&&Math.abs(ft)>Ct&&(tt.swipe[0]=Math.sign(dt)),Rt>yt&&Math.abs(gt)>wt&&(tt.swipe[1]=Math.sign(ht))}}this.emit()}pointerClick(_){!this.state.tap&&_.detail>0&&(_.preventDefault(),_.stopPropagation())}setupPointer(_){const tt=this.config,ot=tt.device;tt.pointerLock&&_.currentTarget.requestPointerLock(),tt.pointerCapture||(this.eventStore.add(this.sharedConfig.window,ot,"change",this.pointerMove.bind(this)),this.eventStore.add(this.sharedConfig.window,ot,"end",this.pointerUp.bind(this)),this.eventStore.add(this.sharedConfig.window,ot,"cancel",this.pointerUp.bind(this)))}pointerClean(){this.config.pointerLock&&document.pointerLockElement===this.state.currentTarget&&document.exitPointerLock()}preventScroll(_){this.state._preventScroll&&_.cancelable&&_.preventDefault()}setupScrollPrevention(_){this.state._preventScroll=!1,persistEvent(_);const tt=this.eventStore.add(this.sharedConfig.window,"touch","change",this.preventScroll.bind(this),{passive:!1});this.eventStore.add(this.sharedConfig.window,"touch","end",tt),this.eventStore.add(this.sharedConfig.window,"touch","cancel",tt),this.timeoutStore.add("startPointerDrag",this.startPointerDrag.bind(this),this.config.preventScrollDelay,_)}setupDelayTrigger(_){this.state._delayed=!0,this.timeoutStore.add("dragDelay",()=>{this.state._step=[0,0],this.startPointerDrag(_)},this.config.delay)}keyDown(_){const tt=KEYS_DELTA_MAP[_.key];if(tt){const ot=this.state,st=_.shiftKey?10:_.altKey?.1:1;this.start(_),ot._delta=tt(this.config.keyboardDisplacement,st),ot._keyboardActive=!0,V$2.addTo(ot._movement,ot._delta),this.compute(_),this.emit()}}keyUp(_){_.key in KEYS_DELTA_MAP&&(this.state._keyboardActive=!1,this.setActive(),this.compute(_),this.emit())}bind(_){const tt=this.config.device;_(tt,"start",this.pointerDown.bind(this)),this.config.pointerCapture&&(_(tt,"change",this.pointerMove.bind(this)),_(tt,"end",this.pointerUp.bind(this)),_(tt,"cancel",this.pointerUp.bind(this)),_("lostPointerCapture","",this.pointerUp.bind(this))),this.config.keys&&(_("key","down",this.keyDown.bind(this)),_("key","up",this.keyUp.bind(this))),this.config.filterTaps&&_("click","",this.pointerClick.bind(this),{capture:!0,passive:!1})}}function persistEvent(nt){"persist"in nt&&typeof nt.persist=="function"&&nt.persist()}const isBrowser=typeof window<"u"&&window.document&&window.document.createElement;function supportsTouchEvents(){return isBrowser&&"ontouchstart"in window}function isTouchScreen(){return supportsTouchEvents()||isBrowser&&window.navigator.maxTouchPoints>1}function supportsPointerEvents(){return isBrowser&&"onpointerdown"in window}function supportsPointerLock(){return isBrowser&&"exitPointerLock"in window.document}function supportsGestureEvents(){try{return"constructor"in GestureEvent}catch{return!1}}const SUPPORT={isBrowser,gesture:supportsGestureEvents(),touch:supportsTouchEvents(),touchscreen:isTouchScreen(),pointer:supportsPointerEvents(),pointerLock:supportsPointerLock()},DEFAULT_PREVENT_SCROLL_DELAY=250,DEFAULT_DRAG_DELAY=180,DEFAULT_SWIPE_VELOCITY=.5,DEFAULT_SWIPE_DISTANCE=50,DEFAULT_SWIPE_DURATION=250,DEFAULT_KEYBOARD_DISPLACEMENT=10,DEFAULT_DRAG_AXIS_THRESHOLD={mouse:0,touch:0,pen:8},dragConfigResolver=_objectSpread2$1(_objectSpread2$1({},coordinatesConfigResolver),{},{device(nt,_,{pointer:{touch:tt=!1,lock:ot=!1,mouse:st=!1}={}}){return this.pointerLock=ot&&SUPPORT.pointerLock,SUPPORT.touch&&tt?"touch":this.pointerLock?"mouse":SUPPORT.pointer&&!st?"pointer":SUPPORT.touch?"touch":"mouse"},preventScrollAxis(nt,_,{preventScroll:tt}){if(this.preventScrollDelay=typeof tt=="number"?tt:tt||tt===void 0&&nt?DEFAULT_PREVENT_SCROLL_DELAY:void 0,!(!SUPPORT.touchscreen||tt===!1))return nt||(tt!==void 0?"y":void 0)},pointerCapture(nt,_,{pointer:{capture:tt=!0,buttons:ot=1,keys:st=!0}={}}){return this.pointerButtons=ot,this.keys=st,!this.pointerLock&&this.device==="pointer"&&tt},threshold(nt,_,{filterTaps:tt=!1,tapsThreshold:ot=3,axis:st=void 0}){const at=V$2.toVector(nt,tt?ot:st?1:0);return this.filterTaps=tt,this.tapsThreshold=ot,at},swipe({velocity:nt=DEFAULT_SWIPE_VELOCITY,distance:_=DEFAULT_SWIPE_DISTANCE,duration:tt=DEFAULT_SWIPE_DURATION}={}){return{velocity:this.transform(V$2.toVector(nt)),distance:this.transform(V$2.toVector(_)),duration:tt}},delay(nt=0){switch(nt){case!0:return DEFAULT_DRAG_DELAY;case!1:return 0;default:return nt}},axisThreshold(nt){return nt?_objectSpread2$1(_objectSpread2$1({},DEFAULT_DRAG_AXIS_THRESHOLD),nt):DEFAULT_DRAG_AXIS_THRESHOLD},keyboardDisplacement(nt=DEFAULT_KEYBOARD_DISPLACEMENT){return nt}});_objectSpread2$1(_objectSpread2$1({},commonConfigResolver),{},{device(nt,_,{shared:tt,pointer:{touch:ot=!1}={}}){if(tt.target&&!SUPPORT.touch&&SUPPORT.gesture)return"gesture";if(SUPPORT.touch&&ot)return"touch";if(SUPPORT.touchscreen){if(SUPPORT.pointer)return"pointer";if(SUPPORT.touch)return"touch"}},bounds(nt,_,{scaleBounds:tt={},angleBounds:ot={}}){const st=lt=>{const dt=assignDefault(call(tt,lt),{min:-1/0,max:1/0});return[dt.min,dt.max]},at=lt=>{const dt=assignDefault(call(ot,lt),{min:-1/0,max:1/0});return[dt.min,dt.max]};return typeof tt!="function"&&typeof ot!="function"?[st(),at()]:lt=>[st(lt),at(lt)]},threshold(nt,_,tt){return this.lockDirection=tt.axis==="lock",V$2.toVector(nt,this.lockDirection?[.1,3]:0)},modifierKey(nt){return nt===void 0?"ctrlKey":nt},pinchOnWheel(nt=!0){return nt}});_objectSpread2$1(_objectSpread2$1({},coordinatesConfigResolver),{},{mouseOnly:(nt=!0)=>nt});_objectSpread2$1(_objectSpread2$1({},coordinatesConfigResolver),{},{mouseOnly:(nt=!0)=>nt});const EngineMap=new Map,ConfigResolverMap=new Map;function registerAction(nt){EngineMap.set(nt.key,nt.engine),ConfigResolverMap.set(nt.key,nt.resolver)}const dragAction={key:"drag",engine:DragEngine,resolver:dragConfigResolver};function _objectWithoutPropertiesLoose$2(nt,_){if(nt==null)return{};var tt={},ot=Object.keys(nt),st,at;for(at=0;at<ot.length;at++)st=ot[at],!(_.indexOf(st)>=0)&&(tt[st]=nt[st]);return tt}function _objectWithoutProperties$2(nt,_){if(nt==null)return{};var tt=_objectWithoutPropertiesLoose$2(nt,_),ot,st;if(Object.getOwnPropertySymbols){var at=Object.getOwnPropertySymbols(nt);for(st=0;st<at.length;st++)ot=at[st],!(_.indexOf(ot)>=0)&&Object.prototype.propertyIsEnumerable.call(nt,ot)&&(tt[ot]=nt[ot])}return tt}const sharedConfigResolver={target(nt){if(nt)return()=>"current"in nt?nt.current:nt},enabled(nt=!0){return nt},window(nt=SUPPORT.isBrowser?window:void 0){return nt},eventOptions({passive:nt=!0,capture:_=!1}={}){return{passive:nt,capture:_}},transform(nt){return nt}},_excluded$c=["target","eventOptions","window","enabled","transform"];function resolveWith(nt={},_){const tt={};for(const[ot,st]of Object.entries(_))switch(typeof st){case"function":tt[ot]=st.call(tt,nt[ot],ot,nt);break;case"object":tt[ot]=resolveWith(nt[ot],st);break;case"boolean":st&&(tt[ot]=nt[ot]);break}return tt}function parse$2(nt,_,tt={}){const ot=nt,{target:st,eventOptions:at,window:lt,enabled:dt,transform:ht}=ot,ft=_objectWithoutProperties$2(ot,_excluded$c);if(tt.shared=resolveWith({target:st,eventOptions:at,window:lt,enabled:dt,transform:ht},sharedConfigResolver),_){const gt=ConfigResolverMap.get(_);tt[_]=resolveWith(_objectSpread2$1({shared:tt.shared},ft),gt)}else for(const gt in ft){const Et=ConfigResolverMap.get(gt);Et&&(tt[gt]=resolveWith(_objectSpread2$1({shared:tt.shared},ft[gt]),Et))}return tt}class EventStore{constructor(_,tt){_defineProperty$3(this,"_listeners",new Set),this._ctrl=_,this._gestureKey=tt}add(_,tt,ot,st,at){const lt=this._listeners,dt=toDomEventType(tt,ot),ht=this._gestureKey?this._ctrl.config[this._gestureKey].eventOptions:{},ft=_objectSpread2$1(_objectSpread2$1({},ht),at);_.addEventListener(dt,st,ft);const gt=()=>{_.removeEventListener(dt,st,ft),lt.delete(gt)};return lt.add(gt),gt}clean(){this._listeners.forEach(_=>_()),this._listeners.clear()}}class TimeoutStore{constructor(){_defineProperty$3(this,"_timeouts",new Map)}add(_,tt,ot=140,...st){this.remove(_),this._timeouts.set(_,window.setTimeout(tt,ot,...st))}remove(_){const tt=this._timeouts.get(_);tt&&window.clearTimeout(tt)}clean(){this._timeouts.forEach(_=>void window.clearTimeout(_)),this._timeouts.clear()}}class Controller{constructor(_){_defineProperty$3(this,"gestures",new Set),_defineProperty$3(this,"_targetEventStore",new EventStore(this)),_defineProperty$3(this,"gestureEventStores",{}),_defineProperty$3(this,"gestureTimeoutStores",{}),_defineProperty$3(this,"handlers",{}),_defineProperty$3(this,"config",{}),_defineProperty$3(this,"pointerIds",new Set),_defineProperty$3(this,"touchIds",new Set),_defineProperty$3(this,"state",{shared:{shiftKey:!1,metaKey:!1,ctrlKey:!1,altKey:!1}}),resolveGestures(this,_)}setEventIds(_){if(isTouch(_))return this.touchIds=new Set(touchIds(_)),this.touchIds;if("pointerId"in _)return _.type==="pointerup"||_.type==="pointercancel"?this.pointerIds.delete(_.pointerId):_.type==="pointerdown"&&this.pointerIds.add(_.pointerId),this.pointerIds}applyHandlers(_,tt){this.handlers=_,this.nativeHandlers=tt}applyConfig(_,tt){this.config=parse$2(_,tt,this.config)}clean(){this._targetEventStore.clean();for(const _ of this.gestures)this.gestureEventStores[_].clean(),this.gestureTimeoutStores[_].clean()}effect(){return this.config.shared.target&&this.bind(),()=>this._targetEventStore.clean()}bind(..._){const tt=this.config.shared,ot={};let st;if(!(tt.target&&(st=tt.target(),!st))){if(tt.enabled){for(const lt of this.gestures){const dt=this.config[lt],ht=bindToProps(ot,dt.eventOptions,!!st);if(dt.enabled){const ft=EngineMap.get(lt);new ft(this,_,lt).bind(ht)}}const at=bindToProps(ot,tt.eventOptions,!!st);for(const lt in this.nativeHandlers)at(lt,"",dt=>this.nativeHandlers[lt](_objectSpread2$1(_objectSpread2$1({},this.state.shared),{},{event:dt,args:_})),void 0,!0)}for(const at in ot)ot[at]=chain(...ot[at]);if(!st)return ot;for(const at in ot){const{device:lt,capture:dt,passive:ht}=parseProp(at);this._targetEventStore.add(st,lt,"",ot[at],{capture:dt,passive:ht})}}}}function setupGesture(nt,_){nt.gestures.add(_),nt.gestureEventStores[_]=new EventStore(nt,_),nt.gestureTimeoutStores[_]=new TimeoutStore}function resolveGestures(nt,_){_.drag&&setupGesture(nt,"drag"),_.wheel&&setupGesture(nt,"wheel"),_.scroll&&setupGesture(nt,"scroll"),_.move&&setupGesture(nt,"move"),_.pinch&&setupGesture(nt,"pinch"),_.hover&&setupGesture(nt,"hover")}const bindToProps=(nt,_,tt)=>(ot,st,at,lt={},dt=!1)=>{var ht,ft;const gt=(ht=lt.capture)!==null&&ht!==void 0?ht:_.capture,Et=(ft=lt.passive)!==null&&ft!==void 0?ft:_.passive;let yt=dt?ot:toHandlerProp(ot,st,gt);tt&&Et&&(yt+="Passive"),nt[yt]=nt[yt]||[],nt[yt].push(at)};function useRecognizers(nt,_={},tt,ot){const st=React.useMemo(()=>new Controller(nt),[]);if(st.applyHandlers(nt,ot),st.applyConfig(_,tt),React.useEffect(st.effect.bind(st)),React.useEffect(()=>st.clean.bind(st),[]),_.target===void 0)return st.bind.bind(st)}function useDrag$1(nt,_){return registerAction(dragAction),useRecognizers({drag:nt},_||{},"drag")}const subscribeWithSelector=nt=>(_,tt,ot)=>{const st=ot.subscribe;return ot.subscribe=(lt,dt,ht)=>{let ft=lt;if(dt){const gt=(ht==null?void 0:ht.equalityFn)||Object.is;let Et=lt(ot.getState());ft=yt=>{const Ct=lt(yt);if(!gt(Et,Ct)){const wt=Et;dt(Et=Ct,wt)}},ht!=null&&ht.fireImmediately&&dt(Et,Et)}return st(ft)},nt(_,tt,ot)},version=(()=>parseInt(REVISION.replace(/\D+/g,"")))();function toTrianglesDrawMode(nt,_){if(_===TrianglesDrawMode)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),nt;if(_===TriangleFanDrawMode||_===TriangleStripDrawMode){let tt=nt.getIndex();if(tt===null){const lt=[],dt=nt.getAttribute("position");if(dt!==void 0){for(let ht=0;ht<dt.count;ht++)lt.push(ht);nt.setIndex(lt),tt=nt.getIndex()}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),nt}const ot=tt.count-2,st=[];if(tt)if(_===TriangleFanDrawMode)for(let lt=1;lt<=ot;lt++)st.push(tt.getX(0)),st.push(tt.getX(lt)),st.push(tt.getX(lt+1));else for(let lt=0;lt<ot;lt++)lt%2===0?(st.push(tt.getX(lt)),st.push(tt.getX(lt+1)),st.push(tt.getX(lt+2))):(st.push(tt.getX(lt+2)),st.push(tt.getX(lt+1)),st.push(tt.getX(lt)));st.length/3!==ot&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const at=nt.clone();return at.setIndex(st),at.clearGroups(),at}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",_),nt}var u8=Uint8Array,u16=Uint16Array,u32=Uint32Array,fleb=new u8([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),fdeb=new u8([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),clim=new u8([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),freb=function(nt,_){for(var tt=new u16(31),ot=0;ot<31;++ot)tt[ot]=_+=1<<nt[ot-1];for(var st=new u32(tt[30]),ot=1;ot<30;++ot)for(var at=tt[ot];at<tt[ot+1];++at)st[at]=at-tt[ot]<<5|ot;return[tt,st]},_a$1=freb(fleb,2),fl=_a$1[0],revfl=_a$1[1];fl[28]=258,revfl[258]=28;var _b=freb(fdeb,0),fd=_b[0],rev=new u16(32768);for(var i$5=0;i$5<32768;++i$5){var x$4=(i$5&43690)>>>1|(i$5&21845)<<1;x$4=(x$4&52428)>>>2|(x$4&13107)<<2,x$4=(x$4&61680)>>>4|(x$4&3855)<<4,rev[i$5]=((x$4&65280)>>>8|(x$4&255)<<8)>>>1}var hMap=function(nt,_,tt){for(var ot=nt.length,st=0,at=new u16(_);st<ot;++st)++at[nt[st]-1];var lt=new u16(_);for(st=0;st<_;++st)lt[st]=lt[st-1]+at[st-1]<<1;var dt;if(tt){dt=new u16(1<<_);var ht=15-_;for(st=0;st<ot;++st)if(nt[st])for(var ft=st<<4|nt[st],gt=_-nt[st],Et=lt[nt[st]-1]++<<gt,yt=Et|(1<<gt)-1;Et<=yt;++Et)dt[rev[Et]>>>ht]=ft}else for(dt=new u16(ot),st=0;st<ot;++st)nt[st]&&(dt[st]=rev[lt[nt[st]-1]++]>>>15-nt[st]);return dt},flt=new u8(288);for(var i$5=0;i$5<144;++i$5)flt[i$5]=8;for(var i$5=144;i$5<256;++i$5)flt[i$5]=9;for(var i$5=256;i$5<280;++i$5)flt[i$5]=7;for(var i$5=280;i$5<288;++i$5)flt[i$5]=8;var fdt=new u8(32);for(var i$5=0;i$5<32;++i$5)fdt[i$5]=5;var flrm=hMap(flt,9,1),fdrm=hMap(fdt,5,1),max=function(nt){for(var _=nt[0],tt=1;tt<nt.length;++tt)nt[tt]>_&&(_=nt[tt]);return _},bits=function(nt,_,tt){var ot=_/8|0;return(nt[ot]|nt[ot+1]<<8)>>(_&7)&tt},bits16=function(nt,_){var tt=_/8|0;return(nt[tt]|nt[tt+1]<<8|nt[tt+2]<<16)>>(_&7)},shft=function(nt){return(nt/8|0)+(nt&7&&1)},slc=function(nt,_,tt){(_==null||_<0)&&(_=0),(tt==null||tt>nt.length)&&(tt=nt.length);var ot=new(nt instanceof u16?u16:nt instanceof u32?u32:u8)(tt-_);return ot.set(nt.subarray(_,tt)),ot},inflt=function(nt,_,tt){var ot=nt.length;if(!ot||tt&&!tt.l&&ot<5)return _||new u8(0);var st=!_||tt,at=!tt||tt.i;tt||(tt={}),_||(_=new u8(ot*3));var lt=function(kn){var Gn=_.length;if(kn>Gn){var Vn=new u8(Math.max(Gn*2,kn));Vn.set(_),_=Vn}},dt=tt.f||0,ht=tt.p||0,ft=tt.b||0,gt=tt.l,Et=tt.d,yt=tt.m,Ct=tt.n,wt=ot*8;do{if(!gt){tt.f=dt=bits(nt,ht,1);var It=bits(nt,ht+1,3);if(ht+=3,It)if(It==1)gt=flrm,Et=fdrm,yt=9,Ct=5;else if(It==2){var Nt=bits(nt,ht,31)+257,kt=bits(nt,ht+10,15)+4,Vt=Nt+bits(nt,ht+5,31)+1;ht+=14;for(var Ft=new u8(Vt),zt=new u8(19),Yt=0;Yt<kt;++Yt)zt[clim[Yt]]=bits(nt,ht+Yt*3,7);ht+=kt*3;for(var Kt=max(zt),qt=(1<<Kt)-1,pn=hMap(zt,Kt,1),Yt=0;Yt<Vt;){var an=pn[bits(nt,ht,qt)];ht+=an&15;var Pt=an>>>4;if(Pt<16)Ft[Yt++]=Pt;else{var fn=0,dn=0;for(Pt==16?(dn=3+bits(nt,ht,3),ht+=2,fn=Ft[Yt-1]):Pt==17?(dn=3+bits(nt,ht,7),ht+=3):Pt==18&&(dn=11+bits(nt,ht,127),ht+=7);dn--;)Ft[Yt++]=fn}}var Cn=Ft.subarray(0,Nt),On=Ft.subarray(Nt);yt=max(Cn),Ct=max(On),gt=hMap(Cn,yt,1),Et=hMap(On,Ct,1)}else throw"invalid block type";else{var Pt=shft(ht)+4,Rt=nt[Pt-4]|nt[Pt-3]<<8,xt=Pt+Rt;if(xt>ot){if(at)throw"unexpected EOF";break}st&&lt(ft+Rt),_.set(nt.subarray(Pt,xt),ft),tt.b=ft+=Rt,tt.p=ht=xt*8;continue}if(ht>wt){if(at)throw"unexpected EOF";break}}st&&lt(ft+131072);for(var Pn=(1<<yt)-1,yn=(1<<Ct)-1,An=ht;;An=ht){var fn=gt[bits16(nt,ht)&Pn],Sn=fn>>>4;if(ht+=fn&15,ht>wt){if(at)throw"unexpected EOF";break}if(!fn)throw"invalid length/literal";if(Sn<256)_[ft++]=Sn;else if(Sn==256){An=ht,gt=null;break}else{var gn=Sn-254;if(Sn>264){var Yt=Sn-257,_n=fleb[Yt];gn=bits(nt,ht,(1<<_n)-1)+fl[Yt],ht+=_n}var Rn=Et[bits16(nt,ht)&yn],bn=Rn>>>4;if(!Rn)throw"invalid distance";ht+=Rn&15;var On=fd[bn];if(bn>3){var _n=fdeb[bn];On+=bits16(nt,ht)&(1<<_n)-1,ht+=_n}if(ht>wt){if(at)throw"unexpected EOF";break}st&&lt(ft+131072);for(var jn=ft+gn;ft<jn;ft+=4)_[ft]=_[ft-On],_[ft+1]=_[ft+1-On],_[ft+2]=_[ft+2-On],_[ft+3]=_[ft+3-On];ft=jn}}tt.l=gt,tt.p=An,tt.b=ft,gt&&(dt=1,tt.m=yt,tt.d=Et,tt.n=Ct)}while(!dt);return ft==_.length?_:slc(_,0,ft)},et=new u8(0),zlv=function(nt){if((nt[0]&15)!=8||nt[0]>>>4>7||(nt[0]<<8|nt[1])%31)throw"invalid zlib data";if(nt[1]&32)throw"invalid zlib data: preset dictionaries not supported"};function unzlibSync(nt,_){return inflt((zlv(nt),nt.subarray(2,-4)),_)}var td=typeof TextDecoder<"u"&&new TextDecoder,tds=0;try{td.decode(et,{stream:!0}),tds=1}catch{}const isCubeTexture=nt=>nt&&nt.isCubeTexture;class GroundProjectedEnv extends Mesh{constructor(_,tt){var ot,st;const at=isCubeTexture(_),dt=((st=at?(ot=_.image[0])==null?void 0:ot.width:_.image.width)!=null?st:1024)/4,ht=Math.floor(Math.log2(dt)),ft=Math.pow(2,ht),gt=3*Math.max(ft,16*7),Et=4*ft,yt=[at?"#define ENVMAP_TYPE_CUBE":"",`#define CUBEUV_TEXEL_WIDTH ${1/gt}`,`#define CUBEUV_TEXEL_HEIGHT ${1/Et}`,`#define CUBEUV_MAX_MIP ${ht}.0`],Ct=`
        varying vec3 vWorldPosition;
        void main() 
        {
            vec4 worldPosition = ( modelMatrix * vec4( position, 1.0 ) );
            vWorldPosition = worldPosition.xyz;
            
            gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
        }
        `,wt=yt.join(`
`)+`
        #define ENVMAP_TYPE_CUBE_UV
        varying vec3 vWorldPosition;
        uniform float radius;
        uniform float height;
        uniform float angle;
        #ifdef ENVMAP_TYPE_CUBE
            uniform samplerCube map;
        #else
            uniform sampler2D map;
        #endif
        // From: https://www.shadertoy.com/view/4tsBD7
        float diskIntersectWithBackFaceCulling( vec3 ro, vec3 rd, vec3 c, vec3 n, float r ) 
        {
            float d = dot ( rd, n );
            
            if( d > 0.0 ) { return 1e6; }
            
            vec3  o = ro - c;
            float t = - dot( n, o ) / d;
            vec3  q = o + rd * t;
            
            return ( dot( q, q ) < r * r ) ? t : 1e6;
        }
        // From: https://www.iquilezles.org/www/articles/intersectors/intersectors.htm
        float sphereIntersect( vec3 ro, vec3 rd, vec3 ce, float ra ) 
        {
            vec3 oc = ro - ce;
            float b = dot( oc, rd );
            float c = dot( oc, oc ) - ra * ra;
            float h = b * b - c;
            
            if( h < 0.0 ) { return -1.0; }
            
            h = sqrt( h );
            
            return - b + h;
        }
        vec3 project() 
        {
            vec3 p = normalize( vWorldPosition );
            vec3 camPos = cameraPosition;
            camPos.y -= height;
            float intersection = sphereIntersect( camPos, p, vec3( 0.0 ), radius );
            if( intersection > 0.0 ) {
                
                vec3 h = vec3( 0.0, - height, 0.0 );
                float intersection2 = diskIntersectWithBackFaceCulling( camPos, p, h, vec3( 0.0, 1.0, 0.0 ), radius );
                p = ( camPos + min( intersection, intersection2 ) * p ) / radius;
            } else {
                p = vec3( 0.0, 1.0, 0.0 );
            }
            return p;
        }
        #include <common>
        #include <cube_uv_reflection_fragment>
        void main() 
        {
            vec3 projectedWorldPosition = project();
            
            #ifdef ENVMAP_TYPE_CUBE
                vec3 outcolor = textureCube( map, projectedWorldPosition ).rgb;
            #else
                vec3 direction = normalize( projectedWorldPosition );
                vec2 uv = equirectUv( direction );
                vec3 outcolor = texture2D( map, uv ).rgb;
            #endif
            gl_FragColor = vec4( outcolor, 1.0 );
            #include <tonemapping_fragment>
            #include <${version>=154?"colorspace_fragment":"encodings_fragment"}>
        }
        `,It={map:{value:_},height:{value:(tt==null?void 0:tt.height)||15},radius:{value:(tt==null?void 0:tt.radius)||100}},Pt=new IcosahedronGeometry(1,16),Rt=new ShaderMaterial({uniforms:It,fragmentShader:wt,vertexShader:Ct,side:DoubleSide});super(Pt,Rt)}set radius(_){this.material.uniforms.radius.value=_}get radius(){return this.material.uniforms.radius.value}set height(_){this.material.uniforms.height.value=_}get height(){return this.material.uniforms.height.value}}function decodeText(nt){if(typeof TextDecoder<"u")return new TextDecoder().decode(nt);let _="";for(let tt=0,ot=nt.length;tt<ot;tt++)_+=String.fromCharCode(nt[tt]);try{return decodeURIComponent(escape(_))}catch{return _}}const SRGBColorSpace="srgb",LinearSRGBColorSpace="srgb-linear",sRGBEncoding=3001,LinearEncoding=3e3;class GLTFLoader extends Loader$1{constructor(_){super(_),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(tt){return new GLTFMaterialsClearcoatExtension(tt)}),this.register(function(tt){return new GLTFMaterialsDispersionExtension(tt)}),this.register(function(tt){return new GLTFTextureBasisUExtension(tt)}),this.register(function(tt){return new GLTFTextureWebPExtension(tt)}),this.register(function(tt){return new GLTFTextureAVIFExtension(tt)}),this.register(function(tt){return new GLTFMaterialsSheenExtension(tt)}),this.register(function(tt){return new GLTFMaterialsTransmissionExtension(tt)}),this.register(function(tt){return new GLTFMaterialsVolumeExtension(tt)}),this.register(function(tt){return new GLTFMaterialsIorExtension(tt)}),this.register(function(tt){return new GLTFMaterialsEmissiveStrengthExtension(tt)}),this.register(function(tt){return new GLTFMaterialsSpecularExtension(tt)}),this.register(function(tt){return new GLTFMaterialsIridescenceExtension(tt)}),this.register(function(tt){return new GLTFMaterialsAnisotropyExtension(tt)}),this.register(function(tt){return new GLTFMaterialsBumpExtension(tt)}),this.register(function(tt){return new GLTFLightsExtension(tt)}),this.register(function(tt){return new GLTFMeshoptCompression(tt)}),this.register(function(tt){return new GLTFMeshGpuInstancing(tt)})}load(_,tt,ot,st){const at=this;let lt;if(this.resourcePath!=="")lt=this.resourcePath;else if(this.path!==""){const ft=LoaderUtils.extractUrlBase(_);lt=LoaderUtils.resolveURL(ft,this.path)}else lt=LoaderUtils.extractUrlBase(_);this.manager.itemStart(_);const dt=function(ft){st?st(ft):console.error(ft),at.manager.itemError(_),at.manager.itemEnd(_)},ht=new FileLoader(this.manager);ht.setPath(this.path),ht.setResponseType("arraybuffer"),ht.setRequestHeader(this.requestHeader),ht.setWithCredentials(this.withCredentials),ht.load(_,function(ft){try{at.parse(ft,lt,function(gt){tt(gt),at.manager.itemEnd(_)},dt)}catch(gt){dt(gt)}},ot,dt)}setDRACOLoader(_){return this.dracoLoader=_,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(_){return this.ktx2Loader=_,this}setMeshoptDecoder(_){return this.meshoptDecoder=_,this}register(_){return this.pluginCallbacks.indexOf(_)===-1&&this.pluginCallbacks.push(_),this}unregister(_){return this.pluginCallbacks.indexOf(_)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(_),1),this}parse(_,tt,ot,st){let at;const lt={},dt={};if(typeof _=="string")at=JSON.parse(_);else if(_ instanceof ArrayBuffer)if(decodeText(new Uint8Array(_.slice(0,4)))===BINARY_EXTENSION_HEADER_MAGIC){try{lt[EXTENSIONS.KHR_BINARY_GLTF]=new GLTFBinaryExtension(_)}catch(gt){st&&st(gt);return}at=JSON.parse(lt[EXTENSIONS.KHR_BINARY_GLTF].content)}else at=JSON.parse(decodeText(new Uint8Array(_)));else at=_;if(at.asset===void 0||at.asset.version[0]<2){st&&st(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}const ht=new GLTFParser(at,{path:tt||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});ht.fileLoader.setRequestHeader(this.requestHeader);for(let ft=0;ft<this.pluginCallbacks.length;ft++){const gt=this.pluginCallbacks[ft](ht);gt.name||console.error("THREE.GLTFLoader: Invalid plugin found: missing name"),dt[gt.name]=gt,lt[gt.name]=!0}if(at.extensionsUsed)for(let ft=0;ft<at.extensionsUsed.length;++ft){const gt=at.extensionsUsed[ft],Et=at.extensionsRequired||[];switch(gt){case EXTENSIONS.KHR_MATERIALS_UNLIT:lt[gt]=new GLTFMaterialsUnlitExtension;break;case EXTENSIONS.KHR_DRACO_MESH_COMPRESSION:lt[gt]=new GLTFDracoMeshCompressionExtension(at,this.dracoLoader);break;case EXTENSIONS.KHR_TEXTURE_TRANSFORM:lt[gt]=new GLTFTextureTransformExtension;break;case EXTENSIONS.KHR_MESH_QUANTIZATION:lt[gt]=new GLTFMeshQuantizationExtension;break;default:Et.indexOf(gt)>=0&&dt[gt]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+gt+'".')}}ht.setExtensions(lt),ht.setPlugins(dt),ht.parse(ot,st)}parseAsync(_,tt){const ot=this;return new Promise(function(st,at){ot.parse(_,tt,st,at)})}}function GLTFRegistry(){let nt={};return{get:function(_){return nt[_]},add:function(_,tt){nt[_]=tt},remove:function(_){delete nt[_]},removeAll:function(){nt={}}}}const EXTENSIONS={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_DISPERSION:"KHR_materials_dispersion",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_MATERIALS_BUMP:"EXT_materials_bump",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class GLTFLightsExtension{constructor(_){this.parser=_,this.name=EXTENSIONS.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const _=this.parser,tt=this.parser.json.nodes||[];for(let ot=0,st=tt.length;ot<st;ot++){const at=tt[ot];at.extensions&&at.extensions[this.name]&&at.extensions[this.name].light!==void 0&&_._addNodeRef(this.cache,at.extensions[this.name].light)}}_loadLight(_){const tt=this.parser,ot="light:"+_;let st=tt.cache.get(ot);if(st)return st;const at=tt.json,ht=((at.extensions&&at.extensions[this.name]||{}).lights||[])[_];let ft;const gt=new Color$1(16777215);ht.color!==void 0&&gt.setRGB(ht.color[0],ht.color[1],ht.color[2],LinearSRGBColorSpace);const Et=ht.range!==void 0?ht.range:0;switch(ht.type){case"directional":ft=new DirectionalLight(gt),ft.target.position.set(0,0,-1),ft.add(ft.target);break;case"point":ft=new PointLight(gt),ft.distance=Et;break;case"spot":ft=new SpotLight(gt),ft.distance=Et,ht.spot=ht.spot||{},ht.spot.innerConeAngle=ht.spot.innerConeAngle!==void 0?ht.spot.innerConeAngle:0,ht.spot.outerConeAngle=ht.spot.outerConeAngle!==void 0?ht.spot.outerConeAngle:Math.PI/4,ft.angle=ht.spot.outerConeAngle,ft.penumbra=1-ht.spot.innerConeAngle/ht.spot.outerConeAngle,ft.target.position.set(0,0,-1),ft.add(ft.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+ht.type)}return ft.position.set(0,0,0),ft.decay=2,assignExtrasToUserData(ft,ht),ht.intensity!==void 0&&(ft.intensity=ht.intensity),ft.name=tt.createUniqueName(ht.name||"light_"+_),st=Promise.resolve(ft),tt.cache.add(ot,st),st}getDependency(_,tt){if(_==="light")return this._loadLight(tt)}createNodeAttachment(_){const tt=this,ot=this.parser,at=ot.json.nodes[_],dt=(at.extensions&&at.extensions[this.name]||{}).light;return dt===void 0?null:this._loadLight(dt).then(function(ht){return ot._getNodeRef(tt.cache,dt,ht)})}}class GLTFMaterialsUnlitExtension{constructor(){this.name=EXTENSIONS.KHR_MATERIALS_UNLIT}getMaterialType(){return MeshBasicMaterial}extendParams(_,tt,ot){const st=[];_.color=new Color$1(1,1,1),_.opacity=1;const at=tt.pbrMetallicRoughness;if(at){if(Array.isArray(at.baseColorFactor)){const lt=at.baseColorFactor;_.color.setRGB(lt[0],lt[1],lt[2],LinearSRGBColorSpace),_.opacity=lt[3]}at.baseColorTexture!==void 0&&st.push(ot.assignTexture(_,"map",at.baseColorTexture,SRGBColorSpace))}return Promise.all(st)}}class GLTFMaterialsEmissiveStrengthExtension{constructor(_){this.parser=_,this.name=EXTENSIONS.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(_,tt){const st=this.parser.json.materials[_];if(!st.extensions||!st.extensions[this.name])return Promise.resolve();const at=st.extensions[this.name].emissiveStrength;return at!==void 0&&(tt.emissiveIntensity=at),Promise.resolve()}}class GLTFMaterialsClearcoatExtension{constructor(_){this.parser=_,this.name=EXTENSIONS.KHR_MATERIALS_CLEARCOAT}getMaterialType(_){const ot=this.parser.json.materials[_];return!ot.extensions||!ot.extensions[this.name]?null:MeshPhysicalMaterial}extendMaterialParams(_,tt){const ot=this.parser,st=ot.json.materials[_];if(!st.extensions||!st.extensions[this.name])return Promise.resolve();const at=[],lt=st.extensions[this.name];if(lt.clearcoatFactor!==void 0&&(tt.clearcoat=lt.clearcoatFactor),lt.clearcoatTexture!==void 0&&at.push(ot.assignTexture(tt,"clearcoatMap",lt.clearcoatTexture)),lt.clearcoatRoughnessFactor!==void 0&&(tt.clearcoatRoughness=lt.clearcoatRoughnessFactor),lt.clearcoatRoughnessTexture!==void 0&&at.push(ot.assignTexture(tt,"clearcoatRoughnessMap",lt.clearcoatRoughnessTexture)),lt.clearcoatNormalTexture!==void 0&&(at.push(ot.assignTexture(tt,"clearcoatNormalMap",lt.clearcoatNormalTexture)),lt.clearcoatNormalTexture.scale!==void 0)){const dt=lt.clearcoatNormalTexture.scale;tt.clearcoatNormalScale=new Vector2(dt,dt)}return Promise.all(at)}}class GLTFMaterialsDispersionExtension{constructor(_){this.parser=_,this.name=EXTENSIONS.KHR_MATERIALS_DISPERSION}getMaterialType(_){const ot=this.parser.json.materials[_];return!ot.extensions||!ot.extensions[this.name]?null:MeshPhysicalMaterial}extendMaterialParams(_,tt){const st=this.parser.json.materials[_];if(!st.extensions||!st.extensions[this.name])return Promise.resolve();const at=st.extensions[this.name];return tt.dispersion=at.dispersion!==void 0?at.dispersion:0,Promise.resolve()}}class GLTFMaterialsIridescenceExtension{constructor(_){this.parser=_,this.name=EXTENSIONS.KHR_MATERIALS_IRIDESCENCE}getMaterialType(_){const ot=this.parser.json.materials[_];return!ot.extensions||!ot.extensions[this.name]?null:MeshPhysicalMaterial}extendMaterialParams(_,tt){const ot=this.parser,st=ot.json.materials[_];if(!st.extensions||!st.extensions[this.name])return Promise.resolve();const at=[],lt=st.extensions[this.name];return lt.iridescenceFactor!==void 0&&(tt.iridescence=lt.iridescenceFactor),lt.iridescenceTexture!==void 0&&at.push(ot.assignTexture(tt,"iridescenceMap",lt.iridescenceTexture)),lt.iridescenceIor!==void 0&&(tt.iridescenceIOR=lt.iridescenceIor),tt.iridescenceThicknessRange===void 0&&(tt.iridescenceThicknessRange=[100,400]),lt.iridescenceThicknessMinimum!==void 0&&(tt.iridescenceThicknessRange[0]=lt.iridescenceThicknessMinimum),lt.iridescenceThicknessMaximum!==void 0&&(tt.iridescenceThicknessRange[1]=lt.iridescenceThicknessMaximum),lt.iridescenceThicknessTexture!==void 0&&at.push(ot.assignTexture(tt,"iridescenceThicknessMap",lt.iridescenceThicknessTexture)),Promise.all(at)}}class GLTFMaterialsSheenExtension{constructor(_){this.parser=_,this.name=EXTENSIONS.KHR_MATERIALS_SHEEN}getMaterialType(_){const ot=this.parser.json.materials[_];return!ot.extensions||!ot.extensions[this.name]?null:MeshPhysicalMaterial}extendMaterialParams(_,tt){const ot=this.parser,st=ot.json.materials[_];if(!st.extensions||!st.extensions[this.name])return Promise.resolve();const at=[];tt.sheenColor=new Color$1(0,0,0),tt.sheenRoughness=0,tt.sheen=1;const lt=st.extensions[this.name];if(lt.sheenColorFactor!==void 0){const dt=lt.sheenColorFactor;tt.sheenColor.setRGB(dt[0],dt[1],dt[2],LinearSRGBColorSpace)}return lt.sheenRoughnessFactor!==void 0&&(tt.sheenRoughness=lt.sheenRoughnessFactor),lt.sheenColorTexture!==void 0&&at.push(ot.assignTexture(tt,"sheenColorMap",lt.sheenColorTexture,SRGBColorSpace)),lt.sheenRoughnessTexture!==void 0&&at.push(ot.assignTexture(tt,"sheenRoughnessMap",lt.sheenRoughnessTexture)),Promise.all(at)}}class GLTFMaterialsTransmissionExtension{constructor(_){this.parser=_,this.name=EXTENSIONS.KHR_MATERIALS_TRANSMISSION}getMaterialType(_){const ot=this.parser.json.materials[_];return!ot.extensions||!ot.extensions[this.name]?null:MeshPhysicalMaterial}extendMaterialParams(_,tt){const ot=this.parser,st=ot.json.materials[_];if(!st.extensions||!st.extensions[this.name])return Promise.resolve();const at=[],lt=st.extensions[this.name];return lt.transmissionFactor!==void 0&&(tt.transmission=lt.transmissionFactor),lt.transmissionTexture!==void 0&&at.push(ot.assignTexture(tt,"transmissionMap",lt.transmissionTexture)),Promise.all(at)}}class GLTFMaterialsVolumeExtension{constructor(_){this.parser=_,this.name=EXTENSIONS.KHR_MATERIALS_VOLUME}getMaterialType(_){const ot=this.parser.json.materials[_];return!ot.extensions||!ot.extensions[this.name]?null:MeshPhysicalMaterial}extendMaterialParams(_,tt){const ot=this.parser,st=ot.json.materials[_];if(!st.extensions||!st.extensions[this.name])return Promise.resolve();const at=[],lt=st.extensions[this.name];tt.thickness=lt.thicknessFactor!==void 0?lt.thicknessFactor:0,lt.thicknessTexture!==void 0&&at.push(ot.assignTexture(tt,"thicknessMap",lt.thicknessTexture)),tt.attenuationDistance=lt.attenuationDistance||1/0;const dt=lt.attenuationColor||[1,1,1];return tt.attenuationColor=new Color$1().setRGB(dt[0],dt[1],dt[2],LinearSRGBColorSpace),Promise.all(at)}}class GLTFMaterialsIorExtension{constructor(_){this.parser=_,this.name=EXTENSIONS.KHR_MATERIALS_IOR}getMaterialType(_){const ot=this.parser.json.materials[_];return!ot.extensions||!ot.extensions[this.name]?null:MeshPhysicalMaterial}extendMaterialParams(_,tt){const st=this.parser.json.materials[_];if(!st.extensions||!st.extensions[this.name])return Promise.resolve();const at=st.extensions[this.name];return tt.ior=at.ior!==void 0?at.ior:1.5,Promise.resolve()}}class GLTFMaterialsSpecularExtension{constructor(_){this.parser=_,this.name=EXTENSIONS.KHR_MATERIALS_SPECULAR}getMaterialType(_){const ot=this.parser.json.materials[_];return!ot.extensions||!ot.extensions[this.name]?null:MeshPhysicalMaterial}extendMaterialParams(_,tt){const ot=this.parser,st=ot.json.materials[_];if(!st.extensions||!st.extensions[this.name])return Promise.resolve();const at=[],lt=st.extensions[this.name];tt.specularIntensity=lt.specularFactor!==void 0?lt.specularFactor:1,lt.specularTexture!==void 0&&at.push(ot.assignTexture(tt,"specularIntensityMap",lt.specularTexture));const dt=lt.specularColorFactor||[1,1,1];return tt.specularColor=new Color$1().setRGB(dt[0],dt[1],dt[2],LinearSRGBColorSpace),lt.specularColorTexture!==void 0&&at.push(ot.assignTexture(tt,"specularColorMap",lt.specularColorTexture,SRGBColorSpace)),Promise.all(at)}}class GLTFMaterialsBumpExtension{constructor(_){this.parser=_,this.name=EXTENSIONS.EXT_MATERIALS_BUMP}getMaterialType(_){const ot=this.parser.json.materials[_];return!ot.extensions||!ot.extensions[this.name]?null:MeshPhysicalMaterial}extendMaterialParams(_,tt){const ot=this.parser,st=ot.json.materials[_];if(!st.extensions||!st.extensions[this.name])return Promise.resolve();const at=[],lt=st.extensions[this.name];return tt.bumpScale=lt.bumpFactor!==void 0?lt.bumpFactor:1,lt.bumpTexture!==void 0&&at.push(ot.assignTexture(tt,"bumpMap",lt.bumpTexture)),Promise.all(at)}}class GLTFMaterialsAnisotropyExtension{constructor(_){this.parser=_,this.name=EXTENSIONS.KHR_MATERIALS_ANISOTROPY}getMaterialType(_){const ot=this.parser.json.materials[_];return!ot.extensions||!ot.extensions[this.name]?null:MeshPhysicalMaterial}extendMaterialParams(_,tt){const ot=this.parser,st=ot.json.materials[_];if(!st.extensions||!st.extensions[this.name])return Promise.resolve();const at=[],lt=st.extensions[this.name];return lt.anisotropyStrength!==void 0&&(tt.anisotropy=lt.anisotropyStrength),lt.anisotropyRotation!==void 0&&(tt.anisotropyRotation=lt.anisotropyRotation),lt.anisotropyTexture!==void 0&&at.push(ot.assignTexture(tt,"anisotropyMap",lt.anisotropyTexture)),Promise.all(at)}}class GLTFTextureBasisUExtension{constructor(_){this.parser=_,this.name=EXTENSIONS.KHR_TEXTURE_BASISU}loadTexture(_){const tt=this.parser,ot=tt.json,st=ot.textures[_];if(!st.extensions||!st.extensions[this.name])return null;const at=st.extensions[this.name],lt=tt.options.ktx2Loader;if(!lt){if(ot.extensionsRequired&&ot.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return tt.loadTextureImage(_,at.source,lt)}}class GLTFTextureWebPExtension{constructor(_){this.parser=_,this.name=EXTENSIONS.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(_){const tt=this.name,ot=this.parser,st=ot.json,at=st.textures[_];if(!at.extensions||!at.extensions[tt])return null;const lt=at.extensions[tt],dt=st.images[lt.source];let ht=ot.textureLoader;if(dt.uri){const ft=ot.options.manager.getHandler(dt.uri);ft!==null&&(ht=ft)}return this.detectSupport().then(function(ft){if(ft)return ot.loadTextureImage(_,lt.source,ht);if(st.extensionsRequired&&st.extensionsRequired.indexOf(tt)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return ot.loadTexture(_)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(_){const tt=new Image;tt.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",tt.onload=tt.onerror=function(){_(tt.height===1)}})),this.isSupported}}class GLTFTextureAVIFExtension{constructor(_){this.parser=_,this.name=EXTENSIONS.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(_){const tt=this.name,ot=this.parser,st=ot.json,at=st.textures[_];if(!at.extensions||!at.extensions[tt])return null;const lt=at.extensions[tt],dt=st.images[lt.source];let ht=ot.textureLoader;if(dt.uri){const ft=ot.options.manager.getHandler(dt.uri);ft!==null&&(ht=ft)}return this.detectSupport().then(function(ft){if(ft)return ot.loadTextureImage(_,lt.source,ht);if(st.extensionsRequired&&st.extensionsRequired.indexOf(tt)>=0)throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return ot.loadTexture(_)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(_){const tt=new Image;tt.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",tt.onload=tt.onerror=function(){_(tt.height===1)}})),this.isSupported}}class GLTFMeshoptCompression{constructor(_){this.name=EXTENSIONS.EXT_MESHOPT_COMPRESSION,this.parser=_}loadBufferView(_){const tt=this.parser.json,ot=tt.bufferViews[_];if(ot.extensions&&ot.extensions[this.name]){const st=ot.extensions[this.name],at=this.parser.getDependency("buffer",st.buffer),lt=this.parser.options.meshoptDecoder;if(!lt||!lt.supported){if(tt.extensionsRequired&&tt.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return at.then(function(dt){const ht=st.byteOffset||0,ft=st.byteLength||0,gt=st.count,Et=st.byteStride,yt=new Uint8Array(dt,ht,ft);return lt.decodeGltfBufferAsync?lt.decodeGltfBufferAsync(gt,Et,yt,st.mode,st.filter).then(function(Ct){return Ct.buffer}):lt.ready.then(function(){const Ct=new ArrayBuffer(gt*Et);return lt.decodeGltfBuffer(new Uint8Array(Ct),gt,Et,yt,st.mode,st.filter),Ct})})}else return null}}class GLTFMeshGpuInstancing{constructor(_){this.name=EXTENSIONS.EXT_MESH_GPU_INSTANCING,this.parser=_}createNodeMesh(_){const tt=this.parser.json,ot=tt.nodes[_];if(!ot.extensions||!ot.extensions[this.name]||ot.mesh===void 0)return null;const st=tt.meshes[ot.mesh];for(const ft of st.primitives)if(ft.mode!==WEBGL_CONSTANTS.TRIANGLES&&ft.mode!==WEBGL_CONSTANTS.TRIANGLE_STRIP&&ft.mode!==WEBGL_CONSTANTS.TRIANGLE_FAN&&ft.mode!==void 0)return null;const lt=ot.extensions[this.name].attributes,dt=[],ht={};for(const ft in lt)dt.push(this.parser.getDependency("accessor",lt[ft]).then(gt=>(ht[ft]=gt,ht[ft])));return dt.length<1?null:(dt.push(this.parser.createNodeMesh(_)),Promise.all(dt).then(ft=>{const gt=ft.pop(),Et=gt.isGroup?gt.children:[gt],yt=ft[0].count,Ct=[];for(const wt of Et){const It=new Matrix4,Pt=new Vector3,Rt=new Quaternion,xt=new Vector3(1,1,1),Nt=new InstancedMesh(wt.geometry,wt.material,yt);for(let kt=0;kt<yt;kt++)ht.TRANSLATION&&Pt.fromBufferAttribute(ht.TRANSLATION,kt),ht.ROTATION&&Rt.fromBufferAttribute(ht.ROTATION,kt),ht.SCALE&&xt.fromBufferAttribute(ht.SCALE,kt),Nt.setMatrixAt(kt,It.compose(Pt,Rt,xt));for(const kt in ht)if(kt==="_COLOR_0"){const Vt=ht[kt];Nt.instanceColor=new InstancedBufferAttribute(Vt.array,Vt.itemSize,Vt.normalized)}else kt!=="TRANSLATION"&&kt!=="ROTATION"&&kt!=="SCALE"&&wt.geometry.setAttribute(kt,ht[kt]);Object3D.prototype.copy.call(Nt,wt),this.parser.assignFinalMaterial(Nt),Ct.push(Nt)}return gt.isGroup?(gt.clear(),gt.add(...Ct),gt):Ct[0]}))}}const BINARY_EXTENSION_HEADER_MAGIC="glTF",BINARY_EXTENSION_HEADER_LENGTH=12,BINARY_EXTENSION_CHUNK_TYPES={JSON:1313821514,BIN:5130562};class GLTFBinaryExtension{constructor(_){this.name=EXTENSIONS.KHR_BINARY_GLTF,this.content=null,this.body=null;const tt=new DataView(_,0,BINARY_EXTENSION_HEADER_LENGTH);if(this.header={magic:decodeText(new Uint8Array(_.slice(0,4))),version:tt.getUint32(4,!0),length:tt.getUint32(8,!0)},this.header.magic!==BINARY_EXTENSION_HEADER_MAGIC)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const ot=this.header.length-BINARY_EXTENSION_HEADER_LENGTH,st=new DataView(_,BINARY_EXTENSION_HEADER_LENGTH);let at=0;for(;at<ot;){const lt=st.getUint32(at,!0);at+=4;const dt=st.getUint32(at,!0);if(at+=4,dt===BINARY_EXTENSION_CHUNK_TYPES.JSON){const ht=new Uint8Array(_,BINARY_EXTENSION_HEADER_LENGTH+at,lt);this.content=decodeText(ht)}else if(dt===BINARY_EXTENSION_CHUNK_TYPES.BIN){const ht=BINARY_EXTENSION_HEADER_LENGTH+at;this.body=_.slice(ht,ht+lt)}at+=lt}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class GLTFDracoMeshCompressionExtension{constructor(_,tt){if(!tt)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=EXTENSIONS.KHR_DRACO_MESH_COMPRESSION,this.json=_,this.dracoLoader=tt,this.dracoLoader.preload()}decodePrimitive(_,tt){const ot=this.json,st=this.dracoLoader,at=_.extensions[this.name].bufferView,lt=_.extensions[this.name].attributes,dt={},ht={},ft={};for(const gt in lt){const Et=ATTRIBUTES[gt]||gt.toLowerCase();dt[Et]=lt[gt]}for(const gt in _.attributes){const Et=ATTRIBUTES[gt]||gt.toLowerCase();if(lt[gt]!==void 0){const yt=ot.accessors[_.attributes[gt]],Ct=WEBGL_COMPONENT_TYPES[yt.componentType];ft[Et]=Ct.name,ht[Et]=yt.normalized===!0}}return tt.getDependency("bufferView",at).then(function(gt){return new Promise(function(Et,yt){st.decodeDracoFile(gt,function(Ct){for(const wt in Ct.attributes){const It=Ct.attributes[wt],Pt=ht[wt];Pt!==void 0&&(It.normalized=Pt)}Et(Ct)},dt,ft,LinearSRGBColorSpace,yt)})})}}class GLTFTextureTransformExtension{constructor(){this.name=EXTENSIONS.KHR_TEXTURE_TRANSFORM}extendTexture(_,tt){return(tt.texCoord===void 0||tt.texCoord===_.channel)&&tt.offset===void 0&&tt.rotation===void 0&&tt.scale===void 0||(_=_.clone(),tt.texCoord!==void 0&&(_.channel=tt.texCoord),tt.offset!==void 0&&_.offset.fromArray(tt.offset),tt.rotation!==void 0&&(_.rotation=tt.rotation),tt.scale!==void 0&&_.repeat.fromArray(tt.scale),_.needsUpdate=!0),_}}class GLTFMeshQuantizationExtension{constructor(){this.name=EXTENSIONS.KHR_MESH_QUANTIZATION}}class GLTFCubicSplineInterpolant extends Interpolant{constructor(_,tt,ot,st){super(_,tt,ot,st)}copySampleValue_(_){const tt=this.resultBuffer,ot=this.sampleValues,st=this.valueSize,at=_*st*3+st;for(let lt=0;lt!==st;lt++)tt[lt]=ot[at+lt];return tt}interpolate_(_,tt,ot,st){const at=this.resultBuffer,lt=this.sampleValues,dt=this.valueSize,ht=dt*2,ft=dt*3,gt=st-tt,Et=(ot-tt)/gt,yt=Et*Et,Ct=yt*Et,wt=_*ft,It=wt-ft,Pt=-2*Ct+3*yt,Rt=Ct-yt,xt=1-Pt,Nt=Rt-yt+Et;for(let kt=0;kt!==dt;kt++){const Vt=lt[It+kt+dt],Ft=lt[It+kt+ht]*gt,zt=lt[wt+kt+dt],Yt=lt[wt+kt]*gt;at[kt]=xt*Vt+Nt*Ft+Pt*zt+Rt*Yt}return at}}const _q=new Quaternion;class GLTFCubicSplineQuaternionInterpolant extends GLTFCubicSplineInterpolant{interpolate_(_,tt,ot,st){const at=super.interpolate_(_,tt,ot,st);return _q.fromArray(at).normalize().toArray(at),at}}const WEBGL_CONSTANTS={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},WEBGL_COMPONENT_TYPES={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},WEBGL_FILTERS={9728:NearestFilter,9729:LinearFilter,9984:NearestMipmapNearestFilter,9985:LinearMipmapNearestFilter,9986:NearestMipmapLinearFilter,9987:LinearMipmapLinearFilter},WEBGL_WRAPPINGS={33071:ClampToEdgeWrapping,33648:MirroredRepeatWrapping,10497:RepeatWrapping},WEBGL_TYPE_SIZES={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},ATTRIBUTES={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",...version>=152?{TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3"}:{TEXCOORD_0:"uv",TEXCOORD_1:"uv2"},COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},PATH_PROPERTIES={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},INTERPOLATION={CUBICSPLINE:void 0,LINEAR:InterpolateLinear,STEP:InterpolateDiscrete},ALPHA_MODES={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function createDefaultMaterial(nt){return nt.DefaultMaterial===void 0&&(nt.DefaultMaterial=new MeshStandardMaterial({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:FrontSide})),nt.DefaultMaterial}function addUnknownExtensionsToUserData(nt,_,tt){for(const ot in tt.extensions)nt[ot]===void 0&&(_.userData.gltfExtensions=_.userData.gltfExtensions||{},_.userData.gltfExtensions[ot]=tt.extensions[ot])}function assignExtrasToUserData(nt,_){_.extras!==void 0&&(typeof _.extras=="object"?Object.assign(nt.userData,_.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+_.extras))}function addMorphTargets(nt,_,tt){let ot=!1,st=!1,at=!1;for(let ft=0,gt=_.length;ft<gt;ft++){const Et=_[ft];if(Et.POSITION!==void 0&&(ot=!0),Et.NORMAL!==void 0&&(st=!0),Et.COLOR_0!==void 0&&(at=!0),ot&&st&&at)break}if(!ot&&!st&&!at)return Promise.resolve(nt);const lt=[],dt=[],ht=[];for(let ft=0,gt=_.length;ft<gt;ft++){const Et=_[ft];if(ot){const yt=Et.POSITION!==void 0?tt.getDependency("accessor",Et.POSITION):nt.attributes.position;lt.push(yt)}if(st){const yt=Et.NORMAL!==void 0?tt.getDependency("accessor",Et.NORMAL):nt.attributes.normal;dt.push(yt)}if(at){const yt=Et.COLOR_0!==void 0?tt.getDependency("accessor",Et.COLOR_0):nt.attributes.color;ht.push(yt)}}return Promise.all([Promise.all(lt),Promise.all(dt),Promise.all(ht)]).then(function(ft){const gt=ft[0],Et=ft[1],yt=ft[2];return ot&&(nt.morphAttributes.position=gt),st&&(nt.morphAttributes.normal=Et),at&&(nt.morphAttributes.color=yt),nt.morphTargetsRelative=!0,nt})}function updateMorphTargets(nt,_){if(nt.updateMorphTargets(),_.weights!==void 0)for(let tt=0,ot=_.weights.length;tt<ot;tt++)nt.morphTargetInfluences[tt]=_.weights[tt];if(_.extras&&Array.isArray(_.extras.targetNames)){const tt=_.extras.targetNames;if(nt.morphTargetInfluences.length===tt.length){nt.morphTargetDictionary={};for(let ot=0,st=tt.length;ot<st;ot++)nt.morphTargetDictionary[tt[ot]]=ot}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function createPrimitiveKey(nt){let _;const tt=nt.extensions&&nt.extensions[EXTENSIONS.KHR_DRACO_MESH_COMPRESSION];if(tt?_="draco:"+tt.bufferView+":"+tt.indices+":"+createAttributesKey(tt.attributes):_=nt.indices+":"+createAttributesKey(nt.attributes)+":"+nt.mode,nt.targets!==void 0)for(let ot=0,st=nt.targets.length;ot<st;ot++)_+=":"+createAttributesKey(nt.targets[ot]);return _}function createAttributesKey(nt){let _="";const tt=Object.keys(nt).sort();for(let ot=0,st=tt.length;ot<st;ot++)_+=tt[ot]+":"+nt[tt[ot]]+";";return _}function getNormalizedComponentScale(nt){switch(nt){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}function getImageURIMimeType(nt){return nt.search(/\.jpe?g($|\?)/i)>0||nt.search(/^data\:image\/jpeg/)===0?"image/jpeg":nt.search(/\.webp($|\?)/i)>0||nt.search(/^data\:image\/webp/)===0?"image/webp":"image/png"}const _identityMatrix=new Matrix4;class GLTFParser{constructor(_={},tt={}){this.json=_,this.extensions={},this.plugins={},this.options=tt,this.cache=new GLTFRegistry,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let ot=!1,st=!1,at=-1;typeof navigator<"u"&&typeof navigator.userAgent<"u"&&(ot=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)===!0,st=navigator.userAgent.indexOf("Firefox")>-1,at=st?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1),typeof createImageBitmap>"u"||ot||st&&at<98?this.textureLoader=new TextureLoader(this.options.manager):this.textureLoader=new ImageBitmapLoader(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new FileLoader(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(_){this.extensions=_}setPlugins(_){this.plugins=_}parse(_,tt){const ot=this,st=this.json,at=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(lt){return lt._markDefs&&lt._markDefs()}),Promise.all(this._invokeAll(function(lt){return lt.beforeRoot&&lt.beforeRoot()})).then(function(){return Promise.all([ot.getDependencies("scene"),ot.getDependencies("animation"),ot.getDependencies("camera")])}).then(function(lt){const dt={scene:lt[0][st.scene||0],scenes:lt[0],animations:lt[1],cameras:lt[2],asset:st.asset,parser:ot,userData:{}};return addUnknownExtensionsToUserData(at,dt,st),assignExtrasToUserData(dt,st),Promise.all(ot._invokeAll(function(ht){return ht.afterRoot&&ht.afterRoot(dt)})).then(function(){for(const ht of dt.scenes)ht.updateMatrixWorld();_(dt)})}).catch(tt)}_markDefs(){const _=this.json.nodes||[],tt=this.json.skins||[],ot=this.json.meshes||[];for(let st=0,at=tt.length;st<at;st++){const lt=tt[st].joints;for(let dt=0,ht=lt.length;dt<ht;dt++)_[lt[dt]].isBone=!0}for(let st=0,at=_.length;st<at;st++){const lt=_[st];lt.mesh!==void 0&&(this._addNodeRef(this.meshCache,lt.mesh),lt.skin!==void 0&&(ot[lt.mesh].isSkinnedMesh=!0)),lt.camera!==void 0&&this._addNodeRef(this.cameraCache,lt.camera)}}_addNodeRef(_,tt){tt!==void 0&&(_.refs[tt]===void 0&&(_.refs[tt]=_.uses[tt]=0),_.refs[tt]++)}_getNodeRef(_,tt,ot){if(_.refs[tt]<=1)return ot;const st=ot.clone(),at=(lt,dt)=>{const ht=this.associations.get(lt);ht!=null&&this.associations.set(dt,ht);for(const[ft,gt]of lt.children.entries())at(gt,dt.children[ft])};return at(ot,st),st.name+="_instance_"+_.uses[tt]++,st}_invokeOne(_){const tt=Object.values(this.plugins);tt.push(this);for(let ot=0;ot<tt.length;ot++){const st=_(tt[ot]);if(st)return st}return null}_invokeAll(_){const tt=Object.values(this.plugins);tt.unshift(this);const ot=[];for(let st=0;st<tt.length;st++){const at=_(tt[st]);at&&ot.push(at)}return ot}getDependency(_,tt){const ot=_+":"+tt;let st=this.cache.get(ot);if(!st){switch(_){case"scene":st=this.loadScene(tt);break;case"node":st=this._invokeOne(function(at){return at.loadNode&&at.loadNode(tt)});break;case"mesh":st=this._invokeOne(function(at){return at.loadMesh&&at.loadMesh(tt)});break;case"accessor":st=this.loadAccessor(tt);break;case"bufferView":st=this._invokeOne(function(at){return at.loadBufferView&&at.loadBufferView(tt)});break;case"buffer":st=this.loadBuffer(tt);break;case"material":st=this._invokeOne(function(at){return at.loadMaterial&&at.loadMaterial(tt)});break;case"texture":st=this._invokeOne(function(at){return at.loadTexture&&at.loadTexture(tt)});break;case"skin":st=this.loadSkin(tt);break;case"animation":st=this._invokeOne(function(at){return at.loadAnimation&&at.loadAnimation(tt)});break;case"camera":st=this.loadCamera(tt);break;default:if(st=this._invokeOne(function(at){return at!=this&&at.getDependency&&at.getDependency(_,tt)}),!st)throw new Error("Unknown type: "+_);break}this.cache.add(ot,st)}return st}getDependencies(_){let tt=this.cache.get(_);if(!tt){const ot=this,st=this.json[_+(_==="mesh"?"es":"s")]||[];tt=Promise.all(st.map(function(at,lt){return ot.getDependency(_,lt)})),this.cache.add(_,tt)}return tt}loadBuffer(_){const tt=this.json.buffers[_],ot=this.fileLoader;if(tt.type&&tt.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+tt.type+" buffer type is not supported.");if(tt.uri===void 0&&_===0)return Promise.resolve(this.extensions[EXTENSIONS.KHR_BINARY_GLTF].body);const st=this.options;return new Promise(function(at,lt){ot.load(LoaderUtils.resolveURL(tt.uri,st.path),at,void 0,function(){lt(new Error('THREE.GLTFLoader: Failed to load buffer "'+tt.uri+'".'))})})}loadBufferView(_){const tt=this.json.bufferViews[_];return this.getDependency("buffer",tt.buffer).then(function(ot){const st=tt.byteLength||0,at=tt.byteOffset||0;return ot.slice(at,at+st)})}loadAccessor(_){const tt=this,ot=this.json,st=this.json.accessors[_];if(st.bufferView===void 0&&st.sparse===void 0){const lt=WEBGL_TYPE_SIZES[st.type],dt=WEBGL_COMPONENT_TYPES[st.componentType],ht=st.normalized===!0,ft=new dt(st.count*lt);return Promise.resolve(new BufferAttribute(ft,lt,ht))}const at=[];return st.bufferView!==void 0?at.push(this.getDependency("bufferView",st.bufferView)):at.push(null),st.sparse!==void 0&&(at.push(this.getDependency("bufferView",st.sparse.indices.bufferView)),at.push(this.getDependency("bufferView",st.sparse.values.bufferView))),Promise.all(at).then(function(lt){const dt=lt[0],ht=WEBGL_TYPE_SIZES[st.type],ft=WEBGL_COMPONENT_TYPES[st.componentType],gt=ft.BYTES_PER_ELEMENT,Et=gt*ht,yt=st.byteOffset||0,Ct=st.bufferView!==void 0?ot.bufferViews[st.bufferView].byteStride:void 0,wt=st.normalized===!0;let It,Pt;if(Ct&&Ct!==Et){const Rt=Math.floor(yt/Ct),xt="InterleavedBuffer:"+st.bufferView+":"+st.componentType+":"+Rt+":"+st.count;let Nt=tt.cache.get(xt);Nt||(It=new ft(dt,Rt*Ct,st.count*Ct/gt),Nt=new InterleavedBuffer(It,Ct/gt),tt.cache.add(xt,Nt)),Pt=new InterleavedBufferAttribute(Nt,ht,yt%Ct/gt,wt)}else dt===null?It=new ft(st.count*ht):It=new ft(dt,yt,st.count*ht),Pt=new BufferAttribute(It,ht,wt);if(st.sparse!==void 0){const Rt=WEBGL_TYPE_SIZES.SCALAR,xt=WEBGL_COMPONENT_TYPES[st.sparse.indices.componentType],Nt=st.sparse.indices.byteOffset||0,kt=st.sparse.values.byteOffset||0,Vt=new xt(lt[1],Nt,st.sparse.count*Rt),Ft=new ft(lt[2],kt,st.sparse.count*ht);dt!==null&&(Pt=new BufferAttribute(Pt.array.slice(),Pt.itemSize,Pt.normalized));for(let zt=0,Yt=Vt.length;zt<Yt;zt++){const Kt=Vt[zt];if(Pt.setX(Kt,Ft[zt*ht]),ht>=2&&Pt.setY(Kt,Ft[zt*ht+1]),ht>=3&&Pt.setZ(Kt,Ft[zt*ht+2]),ht>=4&&Pt.setW(Kt,Ft[zt*ht+3]),ht>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return Pt})}loadTexture(_){const tt=this.json,ot=this.options,at=tt.textures[_].source,lt=tt.images[at];let dt=this.textureLoader;if(lt.uri){const ht=ot.manager.getHandler(lt.uri);ht!==null&&(dt=ht)}return this.loadTextureImage(_,at,dt)}loadTextureImage(_,tt,ot){const st=this,at=this.json,lt=at.textures[_],dt=at.images[tt],ht=(dt.uri||dt.bufferView)+":"+lt.sampler;if(this.textureCache[ht])return this.textureCache[ht];const ft=this.loadImageSource(tt,ot).then(function(gt){gt.flipY=!1,gt.name=lt.name||dt.name||"",gt.name===""&&typeof dt.uri=="string"&&dt.uri.startsWith("data:image/")===!1&&(gt.name=dt.uri);const yt=(at.samplers||{})[lt.sampler]||{};return gt.magFilter=WEBGL_FILTERS[yt.magFilter]||LinearFilter,gt.minFilter=WEBGL_FILTERS[yt.minFilter]||LinearMipmapLinearFilter,gt.wrapS=WEBGL_WRAPPINGS[yt.wrapS]||RepeatWrapping,gt.wrapT=WEBGL_WRAPPINGS[yt.wrapT]||RepeatWrapping,st.associations.set(gt,{textures:_}),gt}).catch(function(){return null});return this.textureCache[ht]=ft,ft}loadImageSource(_,tt){const ot=this,st=this.json,at=this.options;if(this.sourceCache[_]!==void 0)return this.sourceCache[_].then(Et=>Et.clone());const lt=st.images[_],dt=self.URL||self.webkitURL;let ht=lt.uri||"",ft=!1;if(lt.bufferView!==void 0)ht=ot.getDependency("bufferView",lt.bufferView).then(function(Et){ft=!0;const yt=new Blob([Et],{type:lt.mimeType});return ht=dt.createObjectURL(yt),ht});else if(lt.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+_+" is missing URI and bufferView");const gt=Promise.resolve(ht).then(function(Et){return new Promise(function(yt,Ct){let wt=yt;tt.isImageBitmapLoader===!0&&(wt=function(It){const Pt=new Texture(It);Pt.needsUpdate=!0,yt(Pt)}),tt.load(LoaderUtils.resolveURL(Et,at.path),wt,void 0,Ct)})}).then(function(Et){return ft===!0&&dt.revokeObjectURL(ht),assignExtrasToUserData(Et,lt),Et.userData.mimeType=lt.mimeType||getImageURIMimeType(lt.uri),Et}).catch(function(Et){throw console.error("THREE.GLTFLoader: Couldn't load texture",ht),Et});return this.sourceCache[_]=gt,gt}assignTexture(_,tt,ot,st){const at=this;return this.getDependency("texture",ot.index).then(function(lt){if(!lt)return null;if(ot.texCoord!==void 0&&ot.texCoord>0&&(lt=lt.clone(),lt.channel=ot.texCoord),at.extensions[EXTENSIONS.KHR_TEXTURE_TRANSFORM]){const dt=ot.extensions!==void 0?ot.extensions[EXTENSIONS.KHR_TEXTURE_TRANSFORM]:void 0;if(dt){const ht=at.associations.get(lt);lt=at.extensions[EXTENSIONS.KHR_TEXTURE_TRANSFORM].extendTexture(lt,dt),at.associations.set(lt,ht)}}return st!==void 0&&(typeof st=="number"&&(st=st===sRGBEncoding?SRGBColorSpace:LinearSRGBColorSpace),"colorSpace"in lt?lt.colorSpace=st:lt.encoding=st===SRGBColorSpace?sRGBEncoding:LinearEncoding),_[tt]=lt,lt})}assignFinalMaterial(_){const tt=_.geometry;let ot=_.material;const st=tt.attributes.tangent===void 0,at=tt.attributes.color!==void 0,lt=tt.attributes.normal===void 0;if(_.isPoints){const dt="PointsMaterial:"+ot.uuid;let ht=this.cache.get(dt);ht||(ht=new PointsMaterial,Material.prototype.copy.call(ht,ot),ht.color.copy(ot.color),ht.map=ot.map,ht.sizeAttenuation=!1,this.cache.add(dt,ht)),ot=ht}else if(_.isLine){const dt="LineBasicMaterial:"+ot.uuid;let ht=this.cache.get(dt);ht||(ht=new LineBasicMaterial,Material.prototype.copy.call(ht,ot),ht.color.copy(ot.color),ht.map=ot.map,this.cache.add(dt,ht)),ot=ht}if(st||at||lt){let dt="ClonedMaterial:"+ot.uuid+":";st&&(dt+="derivative-tangents:"),at&&(dt+="vertex-colors:"),lt&&(dt+="flat-shading:");let ht=this.cache.get(dt);ht||(ht=ot.clone(),at&&(ht.vertexColors=!0),lt&&(ht.flatShading=!0),st&&(ht.normalScale&&(ht.normalScale.y*=-1),ht.clearcoatNormalScale&&(ht.clearcoatNormalScale.y*=-1)),this.cache.add(dt,ht),this.associations.set(ht,this.associations.get(ot))),ot=ht}_.material=ot}getMaterialType(){return MeshStandardMaterial}loadMaterial(_){const tt=this,ot=this.json,st=this.extensions,at=ot.materials[_];let lt;const dt={},ht=at.extensions||{},ft=[];if(ht[EXTENSIONS.KHR_MATERIALS_UNLIT]){const Et=st[EXTENSIONS.KHR_MATERIALS_UNLIT];lt=Et.getMaterialType(),ft.push(Et.extendParams(dt,at,tt))}else{const Et=at.pbrMetallicRoughness||{};if(dt.color=new Color$1(1,1,1),dt.opacity=1,Array.isArray(Et.baseColorFactor)){const yt=Et.baseColorFactor;dt.color.setRGB(yt[0],yt[1],yt[2],LinearSRGBColorSpace),dt.opacity=yt[3]}Et.baseColorTexture!==void 0&&ft.push(tt.assignTexture(dt,"map",Et.baseColorTexture,SRGBColorSpace)),dt.metalness=Et.metallicFactor!==void 0?Et.metallicFactor:1,dt.roughness=Et.roughnessFactor!==void 0?Et.roughnessFactor:1,Et.metallicRoughnessTexture!==void 0&&(ft.push(tt.assignTexture(dt,"metalnessMap",Et.metallicRoughnessTexture)),ft.push(tt.assignTexture(dt,"roughnessMap",Et.metallicRoughnessTexture))),lt=this._invokeOne(function(yt){return yt.getMaterialType&&yt.getMaterialType(_)}),ft.push(Promise.all(this._invokeAll(function(yt){return yt.extendMaterialParams&&yt.extendMaterialParams(_,dt)})))}at.doubleSided===!0&&(dt.side=DoubleSide);const gt=at.alphaMode||ALPHA_MODES.OPAQUE;if(gt===ALPHA_MODES.BLEND?(dt.transparent=!0,dt.depthWrite=!1):(dt.transparent=!1,gt===ALPHA_MODES.MASK&&(dt.alphaTest=at.alphaCutoff!==void 0?at.alphaCutoff:.5)),at.normalTexture!==void 0&&lt!==MeshBasicMaterial&&(ft.push(tt.assignTexture(dt,"normalMap",at.normalTexture)),dt.normalScale=new Vector2(1,1),at.normalTexture.scale!==void 0)){const Et=at.normalTexture.scale;dt.normalScale.set(Et,Et)}if(at.occlusionTexture!==void 0&&lt!==MeshBasicMaterial&&(ft.push(tt.assignTexture(dt,"aoMap",at.occlusionTexture)),at.occlusionTexture.strength!==void 0&&(dt.aoMapIntensity=at.occlusionTexture.strength)),at.emissiveFactor!==void 0&&lt!==MeshBasicMaterial){const Et=at.emissiveFactor;dt.emissive=new Color$1().setRGB(Et[0],Et[1],Et[2],LinearSRGBColorSpace)}return at.emissiveTexture!==void 0&&lt!==MeshBasicMaterial&&ft.push(tt.assignTexture(dt,"emissiveMap",at.emissiveTexture,SRGBColorSpace)),Promise.all(ft).then(function(){const Et=new lt(dt);return at.name&&(Et.name=at.name),assignExtrasToUserData(Et,at),tt.associations.set(Et,{materials:_}),at.extensions&&addUnknownExtensionsToUserData(st,Et,at),Et})}createUniqueName(_){const tt=PropertyBinding.sanitizeNodeName(_||"");return tt in this.nodeNamesUsed?tt+"_"+ ++this.nodeNamesUsed[tt]:(this.nodeNamesUsed[tt]=0,tt)}loadGeometries(_){const tt=this,ot=this.extensions,st=this.primitiveCache;function at(dt){return ot[EXTENSIONS.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(dt,tt).then(function(ht){return addPrimitiveAttributes(ht,dt,tt)})}const lt=[];for(let dt=0,ht=_.length;dt<ht;dt++){const ft=_[dt],gt=createPrimitiveKey(ft),Et=st[gt];if(Et)lt.push(Et.promise);else{let yt;ft.extensions&&ft.extensions[EXTENSIONS.KHR_DRACO_MESH_COMPRESSION]?yt=at(ft):yt=addPrimitiveAttributes(new BufferGeometry,ft,tt),st[gt]={primitive:ft,promise:yt},lt.push(yt)}}return Promise.all(lt)}loadMesh(_){const tt=this,ot=this.json,st=this.extensions,at=ot.meshes[_],lt=at.primitives,dt=[];for(let ht=0,ft=lt.length;ht<ft;ht++){const gt=lt[ht].material===void 0?createDefaultMaterial(this.cache):this.getDependency("material",lt[ht].material);dt.push(gt)}return dt.push(tt.loadGeometries(lt)),Promise.all(dt).then(function(ht){const ft=ht.slice(0,ht.length-1),gt=ht[ht.length-1],Et=[];for(let Ct=0,wt=gt.length;Ct<wt;Ct++){const It=gt[Ct],Pt=lt[Ct];let Rt;const xt=ft[Ct];if(Pt.mode===WEBGL_CONSTANTS.TRIANGLES||Pt.mode===WEBGL_CONSTANTS.TRIANGLE_STRIP||Pt.mode===WEBGL_CONSTANTS.TRIANGLE_FAN||Pt.mode===void 0)Rt=at.isSkinnedMesh===!0?new SkinnedMesh(It,xt):new Mesh(It,xt),Rt.isSkinnedMesh===!0&&Rt.normalizeSkinWeights(),Pt.mode===WEBGL_CONSTANTS.TRIANGLE_STRIP?Rt.geometry=toTrianglesDrawMode(Rt.geometry,TriangleStripDrawMode):Pt.mode===WEBGL_CONSTANTS.TRIANGLE_FAN&&(Rt.geometry=toTrianglesDrawMode(Rt.geometry,TriangleFanDrawMode));else if(Pt.mode===WEBGL_CONSTANTS.LINES)Rt=new LineSegments(It,xt);else if(Pt.mode===WEBGL_CONSTANTS.LINE_STRIP)Rt=new Line(It,xt);else if(Pt.mode===WEBGL_CONSTANTS.LINE_LOOP)Rt=new LineLoop(It,xt);else if(Pt.mode===WEBGL_CONSTANTS.POINTS)Rt=new Points(It,xt);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+Pt.mode);Object.keys(Rt.geometry.morphAttributes).length>0&&updateMorphTargets(Rt,at),Rt.name=tt.createUniqueName(at.name||"mesh_"+_),assignExtrasToUserData(Rt,at),Pt.extensions&&addUnknownExtensionsToUserData(st,Rt,Pt),tt.assignFinalMaterial(Rt),Et.push(Rt)}for(let Ct=0,wt=Et.length;Ct<wt;Ct++)tt.associations.set(Et[Ct],{meshes:_,primitives:Ct});if(Et.length===1)return at.extensions&&addUnknownExtensionsToUserData(st,Et[0],at),Et[0];const yt=new Group;at.extensions&&addUnknownExtensionsToUserData(st,yt,at),tt.associations.set(yt,{meshes:_});for(let Ct=0,wt=Et.length;Ct<wt;Ct++)yt.add(Et[Ct]);return yt})}loadCamera(_){let tt;const ot=this.json.cameras[_],st=ot[ot.type];if(!st){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return ot.type==="perspective"?tt=new PerspectiveCamera(MathUtils.radToDeg(st.yfov),st.aspectRatio||1,st.znear||1,st.zfar||2e6):ot.type==="orthographic"&&(tt=new OrthographicCamera(-st.xmag,st.xmag,st.ymag,-st.ymag,st.znear,st.zfar)),ot.name&&(tt.name=this.createUniqueName(ot.name)),assignExtrasToUserData(tt,ot),Promise.resolve(tt)}loadSkin(_){const tt=this.json.skins[_],ot=[];for(let st=0,at=tt.joints.length;st<at;st++)ot.push(this._loadNodeShallow(tt.joints[st]));return tt.inverseBindMatrices!==void 0?ot.push(this.getDependency("accessor",tt.inverseBindMatrices)):ot.push(null),Promise.all(ot).then(function(st){const at=st.pop(),lt=st,dt=[],ht=[];for(let ft=0,gt=lt.length;ft<gt;ft++){const Et=lt[ft];if(Et){dt.push(Et);const yt=new Matrix4;at!==null&&yt.fromArray(at.array,ft*16),ht.push(yt)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',tt.joints[ft])}return new Skeleton(dt,ht)})}loadAnimation(_){const tt=this.json,ot=this,st=tt.animations[_],at=st.name?st.name:"animation_"+_,lt=[],dt=[],ht=[],ft=[],gt=[];for(let Et=0,yt=st.channels.length;Et<yt;Et++){const Ct=st.channels[Et],wt=st.samplers[Ct.sampler],It=Ct.target,Pt=It.node,Rt=st.parameters!==void 0?st.parameters[wt.input]:wt.input,xt=st.parameters!==void 0?st.parameters[wt.output]:wt.output;It.node!==void 0&&(lt.push(this.getDependency("node",Pt)),dt.push(this.getDependency("accessor",Rt)),ht.push(this.getDependency("accessor",xt)),ft.push(wt),gt.push(It))}return Promise.all([Promise.all(lt),Promise.all(dt),Promise.all(ht),Promise.all(ft),Promise.all(gt)]).then(function(Et){const yt=Et[0],Ct=Et[1],wt=Et[2],It=Et[3],Pt=Et[4],Rt=[];for(let xt=0,Nt=yt.length;xt<Nt;xt++){const kt=yt[xt],Vt=Ct[xt],Ft=wt[xt],zt=It[xt],Yt=Pt[xt];if(kt===void 0)continue;kt.updateMatrix&&kt.updateMatrix();const Kt=ot._createAnimationTracks(kt,Vt,Ft,zt,Yt);if(Kt)for(let qt=0;qt<Kt.length;qt++)Rt.push(Kt[qt])}return new AnimationClip(at,void 0,Rt)})}createNodeMesh(_){const tt=this.json,ot=this,st=tt.nodes[_];return st.mesh===void 0?null:ot.getDependency("mesh",st.mesh).then(function(at){const lt=ot._getNodeRef(ot.meshCache,st.mesh,at);return st.weights!==void 0&&lt.traverse(function(dt){if(dt.isMesh)for(let ht=0,ft=st.weights.length;ht<ft;ht++)dt.morphTargetInfluences[ht]=st.weights[ht]}),lt})}loadNode(_){const tt=this.json,ot=this,st=tt.nodes[_],at=ot._loadNodeShallow(_),lt=[],dt=st.children||[];for(let ft=0,gt=dt.length;ft<gt;ft++)lt.push(ot.getDependency("node",dt[ft]));const ht=st.skin===void 0?Promise.resolve(null):ot.getDependency("skin",st.skin);return Promise.all([at,Promise.all(lt),ht]).then(function(ft){const gt=ft[0],Et=ft[1],yt=ft[2];yt!==null&&gt.traverse(function(Ct){Ct.isSkinnedMesh&&Ct.bind(yt,_identityMatrix)});for(let Ct=0,wt=Et.length;Ct<wt;Ct++)gt.add(Et[Ct]);return gt})}_loadNodeShallow(_){const tt=this.json,ot=this.extensions,st=this;if(this.nodeCache[_]!==void 0)return this.nodeCache[_];const at=tt.nodes[_],lt=at.name?st.createUniqueName(at.name):"",dt=[],ht=st._invokeOne(function(ft){return ft.createNodeMesh&&ft.createNodeMesh(_)});return ht&&dt.push(ht),at.camera!==void 0&&dt.push(st.getDependency("camera",at.camera).then(function(ft){return st._getNodeRef(st.cameraCache,at.camera,ft)})),st._invokeAll(function(ft){return ft.createNodeAttachment&&ft.createNodeAttachment(_)}).forEach(function(ft){dt.push(ft)}),this.nodeCache[_]=Promise.all(dt).then(function(ft){let gt;if(at.isBone===!0?gt=new Bone:ft.length>1?gt=new Group:ft.length===1?gt=ft[0]:gt=new Object3D,gt!==ft[0])for(let Et=0,yt=ft.length;Et<yt;Et++)gt.add(ft[Et]);if(at.name&&(gt.userData.name=at.name,gt.name=lt),assignExtrasToUserData(gt,at),at.extensions&&addUnknownExtensionsToUserData(ot,gt,at),at.matrix!==void 0){const Et=new Matrix4;Et.fromArray(at.matrix),gt.applyMatrix4(Et)}else at.translation!==void 0&&gt.position.fromArray(at.translation),at.rotation!==void 0&&gt.quaternion.fromArray(at.rotation),at.scale!==void 0&&gt.scale.fromArray(at.scale);return st.associations.has(gt)||st.associations.set(gt,{}),st.associations.get(gt).nodes=_,gt}),this.nodeCache[_]}loadScene(_){const tt=this.extensions,ot=this.json.scenes[_],st=this,at=new Group;ot.name&&(at.name=st.createUniqueName(ot.name)),assignExtrasToUserData(at,ot),ot.extensions&&addUnknownExtensionsToUserData(tt,at,ot);const lt=ot.nodes||[],dt=[];for(let ht=0,ft=lt.length;ht<ft;ht++)dt.push(st.getDependency("node",lt[ht]));return Promise.all(dt).then(function(ht){for(let gt=0,Et=ht.length;gt<Et;gt++)at.add(ht[gt]);const ft=gt=>{const Et=new Map;for(const[yt,Ct]of st.associations)(yt instanceof Material||yt instanceof Texture)&&Et.set(yt,Ct);return gt.traverse(yt=>{const Ct=st.associations.get(yt);Ct!=null&&Et.set(yt,Ct)}),Et};return st.associations=ft(at),at})}_createAnimationTracks(_,tt,ot,st,at){const lt=[],dt=_.name?_.name:_.uuid,ht=[];PATH_PROPERTIES[at.path]===PATH_PROPERTIES.weights?_.traverse(function(yt){yt.morphTargetInfluences&&ht.push(yt.name?yt.name:yt.uuid)}):ht.push(dt);let ft;switch(PATH_PROPERTIES[at.path]){case PATH_PROPERTIES.weights:ft=NumberKeyframeTrack;break;case PATH_PROPERTIES.rotation:ft=QuaternionKeyframeTrack;break;case PATH_PROPERTIES.position:case PATH_PROPERTIES.scale:ft=VectorKeyframeTrack;break;default:switch(ot.itemSize){case 1:ft=NumberKeyframeTrack;break;case 2:case 3:default:ft=VectorKeyframeTrack;break}break}const gt=st.interpolation!==void 0?INTERPOLATION[st.interpolation]:InterpolateLinear,Et=this._getArrayFromAccessor(ot);for(let yt=0,Ct=ht.length;yt<Ct;yt++){const wt=new ft(ht[yt]+"."+PATH_PROPERTIES[at.path],tt.array,Et,gt);st.interpolation==="CUBICSPLINE"&&this._createCubicSplineTrackInterpolant(wt),lt.push(wt)}return lt}_getArrayFromAccessor(_){let tt=_.array;if(_.normalized){const ot=getNormalizedComponentScale(tt.constructor),st=new Float32Array(tt.length);for(let at=0,lt=tt.length;at<lt;at++)st[at]=tt[at]*ot;tt=st}return tt}_createCubicSplineTrackInterpolant(_){_.createInterpolant=function(ot){const st=this instanceof QuaternionKeyframeTrack?GLTFCubicSplineQuaternionInterpolant:GLTFCubicSplineInterpolant;return new st(this.times,this.values,this.getValueSize()/3,ot)},_.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0}}function computeBounds(nt,_,tt){const ot=_.attributes,st=new Box3;if(ot.POSITION!==void 0){const dt=tt.json.accessors[ot.POSITION],ht=dt.min,ft=dt.max;if(ht!==void 0&&ft!==void 0){if(st.set(new Vector3(ht[0],ht[1],ht[2]),new Vector3(ft[0],ft[1],ft[2])),dt.normalized){const gt=getNormalizedComponentScale(WEBGL_COMPONENT_TYPES[dt.componentType]);st.min.multiplyScalar(gt),st.max.multiplyScalar(gt)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;const at=_.targets;if(at!==void 0){const dt=new Vector3,ht=new Vector3;for(let ft=0,gt=at.length;ft<gt;ft++){const Et=at[ft];if(Et.POSITION!==void 0){const yt=tt.json.accessors[Et.POSITION],Ct=yt.min,wt=yt.max;if(Ct!==void 0&&wt!==void 0){if(ht.setX(Math.max(Math.abs(Ct[0]),Math.abs(wt[0]))),ht.setY(Math.max(Math.abs(Ct[1]),Math.abs(wt[1]))),ht.setZ(Math.max(Math.abs(Ct[2]),Math.abs(wt[2]))),yt.normalized){const It=getNormalizedComponentScale(WEBGL_COMPONENT_TYPES[yt.componentType]);ht.multiplyScalar(It)}dt.max(ht)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}st.expandByVector(dt)}nt.boundingBox=st;const lt=new Sphere;st.getCenter(lt.center),lt.radius=st.min.distanceTo(st.max)/2,nt.boundingSphere=lt}function addPrimitiveAttributes(nt,_,tt){const ot=_.attributes,st=[];function at(lt,dt){return tt.getDependency("accessor",lt).then(function(ht){nt.setAttribute(dt,ht)})}for(const lt in ot){const dt=ATTRIBUTES[lt]||lt.toLowerCase();dt in nt.attributes||st.push(at(ot[lt],dt))}if(_.indices!==void 0&&!nt.index){const lt=tt.getDependency("accessor",_.indices).then(function(dt){nt.setIndex(dt)});st.push(lt)}return assignExtrasToUserData(nt,_),computeBounds(nt,_,tt),Promise.all(st).then(function(){return _.targets!==void 0?addMorphTargets(nt,_.targets,tt):nt})}const HorizontalBlurShader={uniforms:{tDiffuse:{value:null},h:{value:1/512}},vertexShader:`
      varying vec2 vUv;

      void main() {

        vUv = uv;
        gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

      }
  `,fragmentShader:`
    uniform sampler2D tDiffuse;
    uniform float h;

    varying vec2 vUv;

    void main() {

    	vec4 sum = vec4( 0.0 );

    	sum += texture2D( tDiffuse, vec2( vUv.x - 4.0 * h, vUv.y ) ) * 0.051;
    	sum += texture2D( tDiffuse, vec2( vUv.x - 3.0 * h, vUv.y ) ) * 0.0918;
    	sum += texture2D( tDiffuse, vec2( vUv.x - 2.0 * h, vUv.y ) ) * 0.12245;
    	sum += texture2D( tDiffuse, vec2( vUv.x - 1.0 * h, vUv.y ) ) * 0.1531;
    	sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;
    	sum += texture2D( tDiffuse, vec2( vUv.x + 1.0 * h, vUv.y ) ) * 0.1531;
    	sum += texture2D( tDiffuse, vec2( vUv.x + 2.0 * h, vUv.y ) ) * 0.12245;
    	sum += texture2D( tDiffuse, vec2( vUv.x + 3.0 * h, vUv.y ) ) * 0.0918;
    	sum += texture2D( tDiffuse, vec2( vUv.x + 4.0 * h, vUv.y ) ) * 0.051;

    	gl_FragColor = sum;

    }
  `},VerticalBlurShader={uniforms:{tDiffuse:{value:null},v:{value:1/512}},vertexShader:`
    varying vec2 vUv;

    void main() {

      vUv = uv;
      gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

    }
  `,fragmentShader:`

  uniform sampler2D tDiffuse;
  uniform float v;

  varying vec2 vUv;

  void main() {

    vec4 sum = vec4( 0.0 );

    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 4.0 * v ) ) * 0.051;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 3.0 * v ) ) * 0.0918;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 2.0 * v ) ) * 0.12245;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 1.0 * v ) ) * 0.1531;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 1.0 * v ) ) * 0.1531;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 2.0 * v ) ) * 0.12245;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 3.0 * v ) ) * 0.0918;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 4.0 * v ) ) * 0.051;

    gl_FragColor = sum;

  }
  `};class RGBELoader extends DataTextureLoader{constructor(_){super(_),this.type=HalfFloatType}parse(_){const lt=function(Yt,Kt){switch(Yt){case 1:throw new Error("THREE.RGBELoader: Read Error: "+(Kt||""));case 2:throw new Error("THREE.RGBELoader: Write Error: "+(Kt||""));case 3:throw new Error("THREE.RGBELoader: Bad File Format: "+(Kt||""));default:case 4:throw new Error("THREE.RGBELoader: Memory Error: "+(Kt||""))}},gt=`
`,Et=function(Yt,Kt,qt){Kt=Kt||1024;let an=Yt.pos,fn=-1,dn=0,Cn="",On=String.fromCharCode.apply(null,new Uint16Array(Yt.subarray(an,an+128)));for(;0>(fn=On.indexOf(gt))&&dn<Kt&&an<Yt.byteLength;)Cn+=On,dn+=On.length,an+=128,On+=String.fromCharCode.apply(null,new Uint16Array(Yt.subarray(an,an+128)));return-1<fn?(qt!==!1&&(Yt.pos+=dn+fn+1),Cn+On.slice(0,fn)):!1},yt=function(Yt){const Kt=/^#\?(\S+)/,qt=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,pn=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,an=/^\s*FORMAT=(\S+)\s*$/,fn=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,dn={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};let Cn,On;for((Yt.pos>=Yt.byteLength||!(Cn=Et(Yt)))&&lt(1,"no header found"),(On=Cn.match(Kt))||lt(3,"bad initial token"),dn.valid|=1,dn.programtype=On[1],dn.string+=Cn+`
`;Cn=Et(Yt),Cn!==!1;){if(dn.string+=Cn+`
`,Cn.charAt(0)==="#"){dn.comments+=Cn+`
`;continue}if((On=Cn.match(qt))&&(dn.gamma=parseFloat(On[1])),(On=Cn.match(pn))&&(dn.exposure=parseFloat(On[1])),(On=Cn.match(an))&&(dn.valid|=2,dn.format=On[1]),(On=Cn.match(fn))&&(dn.valid|=4,dn.height=parseInt(On[1],10),dn.width=parseInt(On[2],10)),dn.valid&2&&dn.valid&4)break}return dn.valid&2||lt(3,"missing format specifier"),dn.valid&4||lt(3,"missing image size specifier"),dn},Ct=function(Yt,Kt,qt){const pn=Kt;if(pn<8||pn>32767||Yt[0]!==2||Yt[1]!==2||Yt[2]&128)return new Uint8Array(Yt);pn!==(Yt[2]<<8|Yt[3])&&lt(3,"wrong scanline width");const an=new Uint8Array(4*Kt*qt);an.length||lt(4,"unable to allocate buffer space");let fn=0,dn=0;const Cn=4*pn,On=new Uint8Array(4),Pn=new Uint8Array(Cn);let yn=qt;for(;yn>0&&dn<Yt.byteLength;){dn+4>Yt.byteLength&&lt(1),On[0]=Yt[dn++],On[1]=Yt[dn++],On[2]=Yt[dn++],On[3]=Yt[dn++],(On[0]!=2||On[1]!=2||(On[2]<<8|On[3])!=pn)&&lt(3,"bad rgbe scanline format");let An=0,Sn;for(;An<Cn&&dn<Yt.byteLength;){Sn=Yt[dn++];const _n=Sn>128;if(_n&&(Sn-=128),(Sn===0||An+Sn>Cn)&&lt(3,"bad scanline data"),_n){const Rn=Yt[dn++];for(let bn=0;bn<Sn;bn++)Pn[An++]=Rn}else Pn.set(Yt.subarray(dn,dn+Sn),An),An+=Sn,dn+=Sn}const gn=pn;for(let _n=0;_n<gn;_n++){let Rn=0;an[fn]=Pn[_n+Rn],Rn+=pn,an[fn+1]=Pn[_n+Rn],Rn+=pn,an[fn+2]=Pn[_n+Rn],Rn+=pn,an[fn+3]=Pn[_n+Rn],fn+=4}yn--}return an},wt=function(Yt,Kt,qt,pn){const an=Yt[Kt+3],fn=Math.pow(2,an-128)/255;qt[pn+0]=Yt[Kt+0]*fn,qt[pn+1]=Yt[Kt+1]*fn,qt[pn+2]=Yt[Kt+2]*fn,qt[pn+3]=1},It=function(Yt,Kt,qt,pn){const an=Yt[Kt+3],fn=Math.pow(2,an-128)/255;qt[pn+0]=DataUtils.toHalfFloat(Math.min(Yt[Kt+0]*fn,65504)),qt[pn+1]=DataUtils.toHalfFloat(Math.min(Yt[Kt+1]*fn,65504)),qt[pn+2]=DataUtils.toHalfFloat(Math.min(Yt[Kt+2]*fn,65504)),qt[pn+3]=DataUtils.toHalfFloat(1)},Pt=new Uint8Array(_);Pt.pos=0;const Rt=yt(Pt),xt=Rt.width,Nt=Rt.height,kt=Ct(Pt.subarray(Pt.pos),xt,Nt);let Vt,Ft,zt;switch(this.type){case FloatType:zt=kt.length/4;const Yt=new Float32Array(zt*4);for(let qt=0;qt<zt;qt++)wt(kt,qt*4,Yt,qt*4);Vt=Yt,Ft=FloatType;break;case HalfFloatType:zt=kt.length/4;const Kt=new Uint16Array(zt*4);for(let qt=0;qt<zt;qt++)It(kt,qt*4,Kt,qt*4);Vt=Kt,Ft=HalfFloatType;break;default:throw new Error("THREE.RGBELoader: Unsupported type: "+this.type)}return{width:xt,height:Nt,data:Vt,header:Rt.string,gamma:Rt.gamma,exposure:Rt.exposure,type:Ft}}setDataType(_){return this.type=_,this}load(_,tt,ot,st){function at(lt,dt){switch(lt.type){case FloatType:case HalfFloatType:"colorSpace"in lt?lt.colorSpace="srgb-linear":lt.encoding=3e3,lt.minFilter=LinearFilter,lt.magFilter=LinearFilter,lt.generateMipmaps=!1,lt.flipY=!0;break}tt&&tt(lt,dt)}return super.load(_,at,ot,st)}}const hasColorSpace=version>=152;class EXRLoader extends DataTextureLoader{constructor(_){super(_),this.type=HalfFloatType}parse(_){const Kt=Math.pow(2.7182818,2.2);function qt(cn,Xt){for(var mn=0,Nn=0;Nn<65536;++Nn)(Nn==0||cn[Nn>>3]&1<<(Nn&7))&&(Xt[mn++]=Nn);for(var In=mn-1;mn<65536;)Xt[mn++]=0;return In}function pn(cn){for(var Xt=0;Xt<16384;Xt++)cn[Xt]={},cn[Xt].len=0,cn[Xt].lit=0,cn[Xt].p=null}const an={l:0,c:0,lc:0};function fn(cn,Xt,mn,Nn,In){for(;mn<cn;)Xt=Xt<<8|Or(Nn,In),mn+=8;mn-=cn,an.l=Xt>>mn&(1<<cn)-1,an.c=Xt,an.lc=mn}const dn=new Array(59);function Cn(cn){for(var Xt=0;Xt<=58;++Xt)dn[Xt]=0;for(var Xt=0;Xt<65537;++Xt)dn[cn[Xt]]+=1;for(var mn=0,Xt=58;Xt>0;--Xt){var Nn=mn+dn[Xt]>>1;dn[Xt]=mn,mn=Nn}for(var Xt=0;Xt<65537;++Xt){var In=cn[Xt];In>0&&(cn[Xt]=In|dn[In]++<<6)}}function On(cn,Xt,mn,Nn,In,Un,mr){for(var gr=mn,br=0,Rr=0;In<=Un;In++){if(gr.value-mn.value>Nn)return!1;fn(6,br,Rr,cn,gr);var wr=an.l;if(br=an.c,Rr=an.lc,mr[In]=wr,wr==63){if(gr.value-mn.value>Nn)throw"Something wrong with hufUnpackEncTable";fn(8,br,Rr,cn,gr);var tr=an.l+6;if(br=an.c,Rr=an.lc,In+tr>Un+1)throw"Something wrong with hufUnpackEncTable";for(;tr--;)mr[In++]=0;In--}else if(wr>=59){var tr=wr-59+2;if(In+tr>Un+1)throw"Something wrong with hufUnpackEncTable";for(;tr--;)mr[In++]=0;In--}}Cn(mr)}function Pn(cn){return cn&63}function yn(cn){return cn>>6}function An(cn,Xt,mn,Nn){for(;Xt<=mn;Xt++){var In=yn(cn[Xt]),Un=Pn(cn[Xt]);if(In>>Un)throw"Invalid table entry";if(Un>14){var mr=Nn[In>>Un-14];if(mr.len)throw"Invalid table entry";if(mr.lit++,mr.p){var gr=mr.p;mr.p=new Array(mr.lit);for(var br=0;br<mr.lit-1;++br)mr.p[br]=gr[br]}else mr.p=new Array(1);mr.p[mr.lit-1]=Xt}else if(Un)for(var Rr=0,br=1<<14-Un;br>0;br--){var mr=Nn[(In<<14-Un)+Rr];if(mr.len||mr.p)throw"Invalid table entry";mr.len=Un,mr.lit=Xt,Rr++}}return!0}const Sn={c:0,lc:0};function gn(cn,Xt,mn,Nn){cn=cn<<8|Or(mn,Nn),Xt+=8,Sn.c=cn,Sn.lc=Xt}const _n={c:0,lc:0};function Rn(cn,Xt,mn,Nn,In,Un,mr,gr,br,Rr){if(cn==Xt){Nn<8&&(gn(mn,Nn,In,mr),mn=Sn.c,Nn=Sn.lc),Nn-=8;var wr=mn>>Nn,wr=new Uint8Array([wr])[0];if(br.value+wr>Rr)return!1;for(var tr=gr[br.value-1];wr-- >0;)gr[br.value++]=tr}else if(br.value<Rr)gr[br.value++]=cn;else return!1;_n.c=mn,_n.lc=Nn}function bn(cn){return cn&65535}function jn(cn){var Xt=bn(cn);return Xt>32767?Xt-65536:Xt}const kn={a:0,b:0};function Gn(cn,Xt){var mn=jn(cn),Nn=jn(Xt),In=Nn,Un=mn+(In&1)+(In>>1),mr=Un,gr=Un-In;kn.a=mr,kn.b=gr}function Vn(cn,Xt){var mn=bn(cn),Nn=bn(Xt),In=mn-(Nn>>1)&65535,Un=Nn+In-32768&65535;kn.a=Un,kn.b=In}function qn(cn,Xt,mn,Nn,In,Un,mr){for(var gr=mr<16384,br=mn>In?In:mn,Rr=1,wr;Rr<=br;)Rr<<=1;for(Rr>>=1,wr=Rr,Rr>>=1;Rr>=1;){for(var tr=0,to=tr+Un*(In-wr),$r=Un*Rr,Yr=Un*wr,_o=Nn*Rr,Ro=Nn*wr,yo,eo,Io,fo;tr<=to;tr+=Yr){for(var Go=tr,Ps=tr+Nn*(mn-wr);Go<=Ps;Go+=Ro){var Uo=Go+_o,_s=Go+$r,as=_s+_o;gr?(Gn(cn[Go+Xt],cn[_s+Xt]),yo=kn.a,Io=kn.b,Gn(cn[Uo+Xt],cn[as+Xt]),eo=kn.a,fo=kn.b,Gn(yo,eo),cn[Go+Xt]=kn.a,cn[Uo+Xt]=kn.b,Gn(Io,fo),cn[_s+Xt]=kn.a,cn[as+Xt]=kn.b):(Vn(cn[Go+Xt],cn[_s+Xt]),yo=kn.a,Io=kn.b,Vn(cn[Uo+Xt],cn[as+Xt]),eo=kn.a,fo=kn.b,Vn(yo,eo),cn[Go+Xt]=kn.a,cn[Uo+Xt]=kn.b,Vn(Io,fo),cn[_s+Xt]=kn.a,cn[as+Xt]=kn.b)}if(mn&Rr){var _s=Go+$r;gr?Gn(cn[Go+Xt],cn[_s+Xt]):Vn(cn[Go+Xt],cn[_s+Xt]),yo=kn.a,cn[_s+Xt]=kn.b,cn[Go+Xt]=yo}}if(In&Rr)for(var Go=tr,Ps=tr+Nn*(mn-wr);Go<=Ps;Go+=Ro){var Uo=Go+_o;gr?Gn(cn[Go+Xt],cn[Uo+Xt]):Vn(cn[Go+Xt],cn[Uo+Xt]),yo=kn.a,cn[Uo+Xt]=kn.b,cn[Go+Xt]=yo}wr=Rr,Rr>>=1}return tr}function Tr(cn,Xt,mn,Nn,In,Un,mr,gr,br,Rr){for(var wr=0,tr=0,to=gr,$r=Math.trunc(In.value+(Un+7)/8);In.value<$r;)for(gn(wr,tr,mn,In),wr=Sn.c,tr=Sn.lc;tr>=14;){var Yr=wr>>tr-14&16383,_o=Xt[Yr];if(_o.len)tr-=_o.len,Rn(_o.lit,mr,wr,tr,mn,Nn,In,br,Rr,to),wr=_n.c,tr=_n.lc;else{if(!_o.p)throw"hufDecode issues";var Ro;for(Ro=0;Ro<_o.lit;Ro++){for(var yo=Pn(cn[_o.p[Ro]]);tr<yo&&In.value<$r;)gn(wr,tr,mn,In),wr=Sn.c,tr=Sn.lc;if(tr>=yo&&yn(cn[_o.p[Ro]])==(wr>>tr-yo&(1<<yo)-1)){tr-=yo,Rn(_o.p[Ro],mr,wr,tr,mn,Nn,In,br,Rr,to),wr=_n.c,tr=_n.lc;break}}if(Ro==_o.lit)throw"hufDecode issues"}}var eo=8-Un&7;for(wr>>=eo,tr-=eo;tr>0;){var _o=Xt[wr<<14-tr&16383];if(_o.len)tr-=_o.len,Rn(_o.lit,mr,wr,tr,mn,Nn,In,br,Rr,to),wr=_n.c,tr=_n.lc;else throw"hufDecode issues"}return!0}function Mn(cn,Xt,mn,Nn,In,Un){var mr={value:0},gr=mn.value,br=Nr(Xt,mn),Rr=Nr(Xt,mn);mn.value+=4;var wr=Nr(Xt,mn);if(mn.value+=4,br<0||br>=65537||Rr<0||Rr>=65537)throw"Something wrong with HUF_ENCSIZE";var tr=new Array(65537),to=new Array(16384);pn(to);var $r=Nn-(mn.value-gr);if(On(cn,Xt,mn,$r,br,Rr,tr),wr>8*(Nn-(mn.value-gr)))throw"Something wrong with hufUncompress";An(tr,br,Rr,to),Tr(tr,to,cn,Xt,mn,wr,Rr,Un,In,mr)}function Zt(cn,Xt,mn){for(var Nn=0;Nn<mn;++Nn)Xt[Nn]=cn[Xt[Nn]]}function wn(cn){for(var Xt=1;Xt<cn.length;Xt++){var mn=cn[Xt-1]+cn[Xt]-128;cn[Xt]=mn}}function xn(cn,Xt){for(var mn=0,Nn=Math.floor((cn.length+1)/2),In=0,Un=cn.length-1;!(In>Un||(Xt[In++]=cn[mn++],In>Un));)Xt[In++]=cn[Nn++]}function Hn(cn){for(var Xt=cn.byteLength,mn=new Array,Nn=0,In=new DataView(cn);Xt>0;){var Un=In.getInt8(Nn++);if(Un<0){var mr=-Un;Xt-=mr+1;for(var gr=0;gr<mr;gr++)mn.push(In.getUint8(Nn++))}else{var mr=Un;Xt-=2;for(var br=In.getUint8(Nn++),gr=0;gr<mr+1;gr++)mn.push(br)}}return mn}function Bn(cn,Xt,mn,Nn,In,Un){var Uo=new DataView(Un.buffer),mr=mn[cn.idx[0]].width,gr=mn[cn.idx[0]].height,br=3,Rr=Math.floor(mr/8),wr=Math.ceil(mr/8),tr=Math.ceil(gr/8),to=mr-(wr-1)*8,$r=gr-(tr-1)*8,Yr={value:0},_o=new Array(br),Ro=new Array(br),yo=new Array(br),eo=new Array(br),Io=new Array(br);for(let $o=0;$o<br;++$o)Io[$o]=Xt[cn.idx[$o]],_o[$o]=$o<1?0:_o[$o-1]+wr*tr,Ro[$o]=new Float32Array(64),yo[$o]=new Uint16Array(64),eo[$o]=new Uint16Array(wr*64);for(let $o=0;$o<tr;++$o){var fo=8;$o==tr-1&&(fo=$r);var Go=8;for(let As=0;As<wr;++As){As==wr-1&&(Go=to);for(let zo=0;zo<br;++zo)yo[zo].fill(0),yo[zo][0]=In[_o[zo]++],cr(Yr,Nn,yo[zo]),Wn(yo[zo],Ro[zo]),rr(Ro[zo]);sr(Ro);for(let zo=0;zo<br;++zo)ir(Ro[zo],eo[zo],As*64)}let Xs=0;for(let As=0;As<br;++As){const zo=mn[cn.idx[As]].type;for(let ba=8*$o;ba<8*$o+fo;++ba){Xs=Io[As][ba];for(let _d=0;_d<Rr;++_d){const Vl=_d*64+(ba&7)*8;Uo.setUint16(Xs+0*2*zo,eo[As][Vl+0],!0),Uo.setUint16(Xs+1*2*zo,eo[As][Vl+1],!0),Uo.setUint16(Xs+2*2*zo,eo[As][Vl+2],!0),Uo.setUint16(Xs+3*2*zo,eo[As][Vl+3],!0),Uo.setUint16(Xs+4*2*zo,eo[As][Vl+4],!0),Uo.setUint16(Xs+5*2*zo,eo[As][Vl+5],!0),Uo.setUint16(Xs+6*2*zo,eo[As][Vl+6],!0),Uo.setUint16(Xs+7*2*zo,eo[As][Vl+7],!0),Xs+=8*2*zo}}if(Rr!=wr)for(let ba=8*$o;ba<8*$o+fo;++ba){const _d=Io[As][ba]+8*Rr*2*zo,Vl=Rr*64+(ba&7)*8;for(let dp=0;dp<Go;++dp)Uo.setUint16(_d+dp*2*zo,eo[As][Vl+dp],!0)}}}for(var Ps=new Uint16Array(mr),Uo=new DataView(Un.buffer),_s=0;_s<br;++_s){mn[cn.idx[_s]].decoded=!0;var as=mn[cn.idx[_s]].type;if(mn[_s].type==2)for(var ks=0;ks<gr;++ks){const $o=Io[_s][ks];for(var xo=0;xo<mr;++xo)Ps[xo]=Uo.getUint16($o+xo*2*as,!0);for(var xo=0;xo<mr;++xo)Uo.setFloat32($o+xo*2*as,ar(Ps[xo]),!0)}}}function cr(cn,Xt,mn){for(var Nn,In=1;In<64;)Nn=Xt[cn.value],Nn==65280?In=64:Nn>>8==255?In+=Nn&255:(mn[In]=Nn,In++),cn.value++}function Wn(cn,Xt){Xt[0]=ar(cn[0]),Xt[1]=ar(cn[1]),Xt[2]=ar(cn[5]),Xt[3]=ar(cn[6]),Xt[4]=ar(cn[14]),Xt[5]=ar(cn[15]),Xt[6]=ar(cn[27]),Xt[7]=ar(cn[28]),Xt[8]=ar(cn[2]),Xt[9]=ar(cn[4]),Xt[10]=ar(cn[7]),Xt[11]=ar(cn[13]),Xt[12]=ar(cn[16]),Xt[13]=ar(cn[26]),Xt[14]=ar(cn[29]),Xt[15]=ar(cn[42]),Xt[16]=ar(cn[3]),Xt[17]=ar(cn[8]),Xt[18]=ar(cn[12]),Xt[19]=ar(cn[17]),Xt[20]=ar(cn[25]),Xt[21]=ar(cn[30]),Xt[22]=ar(cn[41]),Xt[23]=ar(cn[43]),Xt[24]=ar(cn[9]),Xt[25]=ar(cn[11]),Xt[26]=ar(cn[18]),Xt[27]=ar(cn[24]),Xt[28]=ar(cn[31]),Xt[29]=ar(cn[40]),Xt[30]=ar(cn[44]),Xt[31]=ar(cn[53]),Xt[32]=ar(cn[10]),Xt[33]=ar(cn[19]),Xt[34]=ar(cn[23]),Xt[35]=ar(cn[32]),Xt[36]=ar(cn[39]),Xt[37]=ar(cn[45]),Xt[38]=ar(cn[52]),Xt[39]=ar(cn[54]),Xt[40]=ar(cn[20]),Xt[41]=ar(cn[22]),Xt[42]=ar(cn[33]),Xt[43]=ar(cn[38]),Xt[44]=ar(cn[46]),Xt[45]=ar(cn[51]),Xt[46]=ar(cn[55]),Xt[47]=ar(cn[60]),Xt[48]=ar(cn[21]),Xt[49]=ar(cn[34]),Xt[50]=ar(cn[37]),Xt[51]=ar(cn[47]),Xt[52]=ar(cn[50]),Xt[53]=ar(cn[56]),Xt[54]=ar(cn[59]),Xt[55]=ar(cn[61]),Xt[56]=ar(cn[35]),Xt[57]=ar(cn[36]),Xt[58]=ar(cn[48]),Xt[59]=ar(cn[49]),Xt[60]=ar(cn[57]),Xt[61]=ar(cn[58]),Xt[62]=ar(cn[62]),Xt[63]=ar(cn[63])}function rr(cn){const Xt=.5*Math.cos(.7853975),mn=.5*Math.cos(3.14159/16),Nn=.5*Math.cos(3.14159/8),In=.5*Math.cos(3*3.14159/16),Un=.5*Math.cos(5*3.14159/16),mr=.5*Math.cos(3*3.14159/8),gr=.5*Math.cos(7*3.14159/16);for(var br=new Array(4),Rr=new Array(4),wr=new Array(4),tr=new Array(4),to=0;to<8;++to){var $r=to*8;br[0]=Nn*cn[$r+2],br[1]=mr*cn[$r+2],br[2]=Nn*cn[$r+6],br[3]=mr*cn[$r+6],Rr[0]=mn*cn[$r+1]+In*cn[$r+3]+Un*cn[$r+5]+gr*cn[$r+7],Rr[1]=In*cn[$r+1]-gr*cn[$r+3]-mn*cn[$r+5]-Un*cn[$r+7],Rr[2]=Un*cn[$r+1]-mn*cn[$r+3]+gr*cn[$r+5]+In*cn[$r+7],Rr[3]=gr*cn[$r+1]-Un*cn[$r+3]+In*cn[$r+5]-mn*cn[$r+7],wr[0]=Xt*(cn[$r+0]+cn[$r+4]),wr[3]=Xt*(cn[$r+0]-cn[$r+4]),wr[1]=br[0]+br[3],wr[2]=br[1]-br[2],tr[0]=wr[0]+wr[1],tr[1]=wr[3]+wr[2],tr[2]=wr[3]-wr[2],tr[3]=wr[0]-wr[1],cn[$r+0]=tr[0]+Rr[0],cn[$r+1]=tr[1]+Rr[1],cn[$r+2]=tr[2]+Rr[2],cn[$r+3]=tr[3]+Rr[3],cn[$r+4]=tr[3]-Rr[3],cn[$r+5]=tr[2]-Rr[2],cn[$r+6]=tr[1]-Rr[1],cn[$r+7]=tr[0]-Rr[0]}for(var Yr=0;Yr<8;++Yr)br[0]=Nn*cn[16+Yr],br[1]=mr*cn[16+Yr],br[2]=Nn*cn[48+Yr],br[3]=mr*cn[48+Yr],Rr[0]=mn*cn[8+Yr]+In*cn[24+Yr]+Un*cn[40+Yr]+gr*cn[56+Yr],Rr[1]=In*cn[8+Yr]-gr*cn[24+Yr]-mn*cn[40+Yr]-Un*cn[56+Yr],Rr[2]=Un*cn[8+Yr]-mn*cn[24+Yr]+gr*cn[40+Yr]+In*cn[56+Yr],Rr[3]=gr*cn[8+Yr]-Un*cn[24+Yr]+In*cn[40+Yr]-mn*cn[56+Yr],wr[0]=Xt*(cn[Yr]+cn[32+Yr]),wr[3]=Xt*(cn[Yr]-cn[32+Yr]),wr[1]=br[0]+br[3],wr[2]=br[1]-br[2],tr[0]=wr[0]+wr[1],tr[1]=wr[3]+wr[2],tr[2]=wr[3]-wr[2],tr[3]=wr[0]-wr[1],cn[0+Yr]=tr[0]+Rr[0],cn[8+Yr]=tr[1]+Rr[1],cn[16+Yr]=tr[2]+Rr[2],cn[24+Yr]=tr[3]+Rr[3],cn[32+Yr]=tr[3]-Rr[3],cn[40+Yr]=tr[2]-Rr[2],cn[48+Yr]=tr[1]-Rr[1],cn[56+Yr]=tr[0]-Rr[0]}function sr(cn){for(var Xt=0;Xt<64;++Xt){var mn=cn[0][Xt],Nn=cn[1][Xt],In=cn[2][Xt];cn[0][Xt]=mn+1.5747*In,cn[1][Xt]=mn-.1873*Nn-.4682*In,cn[2][Xt]=mn+1.8556*Nn}}function ir(cn,Xt,mn){for(var Nn=0;Nn<64;++Nn)Xt[mn+Nn]=DataUtils.toHalfFloat(kr(cn[Nn]))}function kr(cn){return cn<=1?Math.sign(cn)*Math.pow(Math.abs(cn),2.2):Math.sign(cn)*Math.pow(Kt,Math.abs(cn)-1)}function un(cn){return new DataView(cn.array.buffer,cn.offset.value,cn.size)}function sn(cn){var Xt=cn.viewer.buffer.slice(cn.offset.value,cn.offset.value+cn.size),mn=new Uint8Array(Hn(Xt)),Nn=new Uint8Array(mn.length);return wn(mn),xn(mn,Nn),new DataView(Nn.buffer)}function Kn(cn){var Xt=cn.array.slice(cn.offset.value,cn.offset.value+cn.size),mn=unzlibSync(Xt),Nn=new Uint8Array(mn.length);return wn(mn),xn(mn,Nn),new DataView(Nn.buffer)}function Sr(cn){for(var Xt=cn.viewer,mn={value:cn.offset.value},Nn=new Uint16Array(cn.width*cn.scanlineBlockSize*(cn.channels*cn.type)),In=new Uint8Array(8192),Un=0,mr=new Array(cn.channels),gr=0;gr<cn.channels;gr++)mr[gr]={},mr[gr].start=Un,mr[gr].end=mr[gr].start,mr[gr].nx=cn.width,mr[gr].ny=cn.lines,mr[gr].size=cn.type,Un+=mr[gr].nx*mr[gr].ny*mr[gr].size;var br=pr(Xt,mn),Rr=pr(Xt,mn);if(Rr>=8192)throw"Something is wrong with PIZ_COMPRESSION BITMAP_SIZE";if(br<=Rr)for(var gr=0;gr<Rr-br+1;gr++)In[gr+br]=Ur(Xt,mn);var wr=new Uint16Array(65536),tr=qt(In,wr),to=Nr(Xt,mn);Mn(cn.array,Xt,mn,to,Nn,Un);for(var gr=0;gr<cn.channels;++gr)for(var $r=mr[gr],Yr=0;Yr<mr[gr].size;++Yr)qn(Nn,$r.start+Yr,$r.nx,$r.size,$r.ny,$r.nx*$r.size,tr);Zt(wr,Nn,Un);for(var _o=0,Ro=new Uint8Array(Nn.buffer.byteLength),yo=0;yo<cn.lines;yo++)for(var eo=0;eo<cn.channels;eo++){var $r=mr[eo],Io=$r.nx*$r.size,fo=new Uint8Array(Nn.buffer,$r.end*2,Io*2);Ro.set(fo,_o),_o+=Io*2,$r.end+=Io}return new DataView(Ro.buffer)}function lr(cn){var Xt=cn.array.slice(cn.offset.value,cn.offset.value+cn.size),mn=unzlibSync(Xt);const Nn=cn.lines*cn.channels*cn.width,In=cn.type==1?new Uint16Array(Nn):new Uint32Array(Nn);let Un=0,mr=0;const gr=new Array(4);for(let br=0;br<cn.lines;br++)for(let Rr=0;Rr<cn.channels;Rr++){let wr=0;switch(cn.type){case 1:gr[0]=Un,gr[1]=gr[0]+cn.width,Un=gr[1]+cn.width;for(let tr=0;tr<cn.width;++tr){const to=mn[gr[0]++]<<8|mn[gr[1]++];wr+=to,In[mr]=wr,mr++}break;case 2:gr[0]=Un,gr[1]=gr[0]+cn.width,gr[2]=gr[1]+cn.width,Un=gr[2]+cn.width;for(let tr=0;tr<cn.width;++tr){const to=mn[gr[0]++]<<24|mn[gr[1]++]<<16|mn[gr[2]++]<<8;wr+=to,In[mr]=wr,mr++}break}}return new DataView(In.buffer)}function vr(cn){var Xt=cn.viewer,mn={value:cn.offset.value},Nn=new Uint8Array(cn.width*cn.lines*(cn.channels*cn.type*2)),In={version:Zr(Xt,mn),unknownUncompressedSize:Zr(Xt,mn),unknownCompressedSize:Zr(Xt,mn),acCompressedSize:Zr(Xt,mn),dcCompressedSize:Zr(Xt,mn),rleCompressedSize:Zr(Xt,mn),rleUncompressedSize:Zr(Xt,mn),rleRawSize:Zr(Xt,mn),totalAcUncompressedCount:Zr(Xt,mn),totalDcUncompressedCount:Zr(Xt,mn),acCompression:Zr(Xt,mn)};if(In.version<2)throw"EXRLoader.parse: "+Is.compression+" version "+In.version+" is unsupported";for(var Un=new Array,mr=pr(Xt,mn)-2;mr>0;){var gr=Fr(Xt.buffer,mn),br=Ur(Xt,mn),Rr=br>>2&3,wr=(br>>4)-1,tr=new Int8Array([wr])[0],to=Ur(Xt,mn);Un.push({name:gr,index:tr,type:to,compression:Rr}),mr-=gr.length+3}for(var $r=Is.channels,Yr=new Array(cn.channels),_o=0;_o<cn.channels;++_o){var Ro=Yr[_o]={},yo=$r[_o];Ro.name=yo.name,Ro.compression=0,Ro.decoded=!1,Ro.type=yo.pixelType,Ro.pLinear=yo.pLinear,Ro.width=cn.width,Ro.height=cn.lines}for(var eo={idx:new Array(3)},Io=0;Io<cn.channels;++Io)for(var Ro=Yr[Io],_o=0;_o<Un.length;++_o){var fo=Un[_o];Ro.name==fo.name&&(Ro.compression=fo.compression,fo.index>=0&&(eo.idx[fo.index]=Io),Ro.offset=Io)}if(In.acCompressedSize>0)switch(In.acCompression){case 0:var Uo=new Uint16Array(In.totalAcUncompressedCount);Mn(cn.array,Xt,mn,In.acCompressedSize,Uo,In.totalAcUncompressedCount);break;case 1:var Go=cn.array.slice(mn.value,mn.value+In.totalAcUncompressedCount),Ps=unzlibSync(Go),Uo=new Uint16Array(Ps.buffer);mn.value+=In.totalAcUncompressedCount;break}if(In.dcCompressedSize>0){var _s={array:cn.array,offset:mn,size:In.dcCompressedSize},as=new Uint16Array(Kn(_s).buffer);mn.value+=In.dcCompressedSize}if(In.rleRawSize>0){var Go=cn.array.slice(mn.value,mn.value+In.rleCompressedSize),Ps=unzlibSync(Go),ks=Hn(Ps.buffer);mn.value+=In.rleCompressedSize}for(var xo=0,$o=new Array(Yr.length),_o=0;_o<$o.length;++_o)$o[_o]=new Array;for(var Xs=0;Xs<cn.lines;++Xs)for(var As=0;As<Yr.length;++As)$o[As].push(xo),xo+=Yr[As].width*cn.type*2;Bn(eo,$o,Yr,Uo,as,Nn);for(var _o=0;_o<Yr.length;++_o){var Ro=Yr[_o];if(!Ro.decoded)switch(Ro.compression){case 2:for(var zo=0,ba=0,Xs=0;Xs<cn.lines;++Xs){for(var _d=$o[_o][zo],Vl=0;Vl<Ro.width;++Vl){for(var dp=0;dp<2*Ro.type;++dp)Nn[_d++]=ks[ba+dp*Ro.width*Ro.height];ba++}zo++}break;case 1:default:throw"EXRLoader.parse: unsupported channel compression"}}return new DataView(Nn.buffer)}function Fr(cn,Xt){for(var mn=new Uint8Array(cn),Nn=0;mn[Xt.value+Nn]!=0;)Nn+=1;var In=new TextDecoder().decode(mn.slice(Xt.value,Xt.value+Nn));return Xt.value=Xt.value+Nn+1,In}function Gr(cn,Xt,mn){var Nn=new TextDecoder().decode(new Uint8Array(cn).slice(Xt.value,Xt.value+mn));return Xt.value=Xt.value+mn,Nn}function dr(cn,Xt){var mn=zr(cn,Xt),Nn=Nr(cn,Xt);return[mn,Nn]}function Hr(cn,Xt){var mn=Nr(cn,Xt),Nn=Nr(cn,Xt);return[mn,Nn]}function zr(cn,Xt){var mn=cn.getInt32(Xt.value,!0);return Xt.value=Xt.value+4,mn}function Nr(cn,Xt){var mn=cn.getUint32(Xt.value,!0);return Xt.value=Xt.value+4,mn}function Or(cn,Xt){var mn=cn[Xt.value];return Xt.value=Xt.value+1,mn}function Ur(cn,Xt){var mn=cn.getUint8(Xt.value);return Xt.value=Xt.value+1,mn}const Zr=function(cn,Xt){let mn;return"getBigInt64"in DataView.prototype?mn=Number(cn.getBigInt64(Xt.value,!0)):mn=cn.getUint32(Xt.value+4,!0)+Number(cn.getUint32(Xt.value,!0)<<32),Xt.value+=8,mn};function oo(cn,Xt){var mn=cn.getFloat32(Xt.value,!0);return Xt.value+=4,mn}function zn(cn,Xt){return DataUtils.toHalfFloat(oo(cn,Xt))}function ar(cn){var Xt=(cn&31744)>>10,mn=cn&1023;return(cn>>15?-1:1)*(Xt?Xt===31?mn?NaN:1/0:Math.pow(2,Xt-15)*(1+mn/1024):6103515625e-14*(mn/1024))}function pr(cn,Xt){var mn=cn.getUint16(Xt.value,!0);return Xt.value+=2,mn}function Wr(cn,Xt){return ar(pr(cn,Xt))}function Qr(cn,Xt,mn,Nn){for(var In=mn.value,Un=[];mn.value<In+Nn-1;){var mr=Fr(Xt,mn),gr=zr(cn,mn),br=Ur(cn,mn);mn.value+=3;var Rr=zr(cn,mn),wr=zr(cn,mn);Un.push({name:mr,pixelType:gr,pLinear:br,xSampling:Rr,ySampling:wr})}return mn.value+=1,Un}function ko(cn,Xt){var mn=oo(cn,Xt),Nn=oo(cn,Xt),In=oo(cn,Xt),Un=oo(cn,Xt),mr=oo(cn,Xt),gr=oo(cn,Xt),br=oo(cn,Xt),Rr=oo(cn,Xt);return{redX:mn,redY:Nn,greenX:In,greenY:Un,blueX:mr,blueY:gr,whiteX:br,whiteY:Rr}}function os(cn,Xt){var mn=["NO_COMPRESSION","RLE_COMPRESSION","ZIPS_COMPRESSION","ZIP_COMPRESSION","PIZ_COMPRESSION","PXR24_COMPRESSION","B44_COMPRESSION","B44A_COMPRESSION","DWAA_COMPRESSION","DWAB_COMPRESSION"],Nn=Ur(cn,Xt);return mn[Nn]}function Jo(cn,Xt){var mn=Nr(cn,Xt),Nn=Nr(cn,Xt),In=Nr(cn,Xt),Un=Nr(cn,Xt);return{xMin:mn,yMin:Nn,xMax:In,yMax:Un}}function ws(cn,Xt){var mn=["INCREASING_Y"],Nn=Ur(cn,Xt);return mn[Nn]}function Ms(cn,Xt){var mn=oo(cn,Xt),Nn=oo(cn,Xt);return[mn,Nn]}function ys(cn,Xt){var mn=oo(cn,Xt),Nn=oo(cn,Xt),In=oo(cn,Xt);return[mn,Nn,In]}function bo(cn,Xt,mn,Nn,In){if(Nn==="string"||Nn==="stringvector"||Nn==="iccProfile")return Gr(Xt,mn,In);if(Nn==="chlist")return Qr(cn,Xt,mn,In);if(Nn==="chromaticities")return ko(cn,mn);if(Nn==="compression")return os(cn,mn);if(Nn==="box2i")return Jo(cn,mn);if(Nn==="lineOrder")return ws(cn,mn);if(Nn==="float")return oo(cn,mn);if(Nn==="v2f")return Ms(cn,mn);if(Nn==="v3f")return ys(cn,mn);if(Nn==="int")return zr(cn,mn);if(Nn==="rational")return dr(cn,mn);if(Nn==="timecode")return Hr(cn,mn);if(Nn==="preview")return mn.value+=In,"skipped";mn.value+=In}function mu(cn,Xt,mn){const Nn={};if(cn.getUint32(0,!0)!=20000630)throw"THREE.EXRLoader: provided file doesn't appear to be in OpenEXR format.";Nn.version=cn.getUint8(4);const In=cn.getUint8(5);Nn.spec={singleTile:!!(In&2),longName:!!(In&4),deepFormat:!!(In&8),multiPart:!!(In&16)},mn.value=8;for(var Un=!0;Un;){var mr=Fr(Xt,mn);if(mr==0)Un=!1;else{var gr=Fr(Xt,mn),br=Nr(cn,mn),Rr=bo(cn,Xt,mn,gr,br);Rr===void 0?console.warn(`EXRLoader.parse: skipped unknown header attribute type '${gr}'.`):Nn[mr]=Rr}}if(In&-5)throw console.error("EXRHeader:",Nn),"THREE.EXRLoader: provided file is currently unsupported.";return Nn}function Xl(cn,Xt,mn,Nn,In){const Un={size:0,viewer:Xt,array:mn,offset:Nn,width:cn.dataWindow.xMax-cn.dataWindow.xMin+1,height:cn.dataWindow.yMax-cn.dataWindow.yMin+1,channels:cn.channels.length,bytesPerLine:null,lines:null,inputSize:null,type:cn.channels[0].pixelType,uncompress:null,getter:null,format:null,[hasColorSpace?"colorSpace":"encoding"]:null};switch(cn.compression){case"NO_COMPRESSION":Un.lines=1,Un.uncompress=un;break;case"RLE_COMPRESSION":Un.lines=1,Un.uncompress=sn;break;case"ZIPS_COMPRESSION":Un.lines=1,Un.uncompress=Kn;break;case"ZIP_COMPRESSION":Un.lines=16,Un.uncompress=Kn;break;case"PIZ_COMPRESSION":Un.lines=32,Un.uncompress=Sr;break;case"PXR24_COMPRESSION":Un.lines=16,Un.uncompress=lr;break;case"DWAA_COMPRESSION":Un.lines=32,Un.uncompress=vr;break;case"DWAB_COMPRESSION":Un.lines=256,Un.uncompress=vr;break;default:throw"EXRLoader.parse: "+cn.compression+" is unsupported"}if(Un.scanlineBlockSize=Un.lines,Un.type==1)switch(In){case FloatType:Un.getter=Wr,Un.inputSize=2;break;case HalfFloatType:Un.getter=pr,Un.inputSize=2;break}else if(Un.type==2)switch(In){case FloatType:Un.getter=oo,Un.inputSize=4;break;case HalfFloatType:Un.getter=zn,Un.inputSize=4}else throw"EXRLoader.parse: unsupported pixelType "+Un.type+" for "+cn.compression+".";Un.blockCount=(cn.dataWindow.yMax+1)/Un.scanlineBlockSize;for(var mr=0;mr<Un.blockCount;mr++)Zr(Xt,Nn);Un.outputChannels=Un.channels==3?4:Un.channels;const gr=Un.width*Un.height*Un.outputChannels;switch(In){case FloatType:Un.byteArray=new Float32Array(gr),Un.channels<Un.outputChannels&&Un.byteArray.fill(1,0,gr);break;case HalfFloatType:Un.byteArray=new Uint16Array(gr),Un.channels<Un.outputChannels&&Un.byteArray.fill(15360,0,gr);break;default:console.error("THREE.EXRLoader: unsupported type: ",In);break}return Un.bytesPerLine=Un.width*Un.inputSize*Un.channels,Un.outputChannels==4?Un.format=RGBAFormat:Un.format=RedFormat,hasColorSpace?Un.colorSpace="srgb-linear":Un.encoding=3e3,Un}const ss=new DataView(_),js=new Uint8Array(_),_l={value:0},Is=mu(ss,_,_l),vo=Xl(Is,ss,js,_l,this.type),wl={value:0},ju={R:0,G:1,B:2,A:3,Y:0};for(let cn=0;cn<vo.height/vo.scanlineBlockSize;cn++){const Xt=Nr(ss,_l);vo.size=Nr(ss,_l),vo.lines=Xt+vo.scanlineBlockSize>vo.height?vo.height-Xt:vo.scanlineBlockSize;const Nn=vo.size<vo.lines*vo.bytesPerLine?vo.uncompress(vo):un(vo);_l.value+=vo.size;for(let In=0;In<vo.scanlineBlockSize;In++){const Un=In+cn*vo.scanlineBlockSize;if(Un>=vo.height)break;for(let mr=0;mr<vo.channels;mr++){const gr=ju[Is.channels[mr].name];for(let br=0;br<vo.width;br++){wl.value=(In*(vo.channels*vo.width)+mr*vo.width+br)*vo.inputSize;const Rr=(vo.height-1-Un)*(vo.width*vo.outputChannels)+br*vo.outputChannels+gr;vo.byteArray[Rr]=vo.getter(Nn,wl)}}}}return{header:Is,width:vo.width,height:vo.height,data:vo.byteArray,format:vo.format,[hasColorSpace?"colorSpace":"encoding"]:vo[hasColorSpace?"colorSpace":"encoding"],type:this.type}}setDataType(_){return this.type=_,this}load(_,tt,ot,st){function at(lt,dt){hasColorSpace?lt.colorSpace=dt.colorSpace:lt.encoding=dt.encoding,lt.minFilter=LinearFilter,lt.magFilter=LinearFilter,lt.generateMipmaps=!1,lt.flipY=!1,tt&&tt(lt,dt)}return super.load(_,at,ot,st)}}const _taskCache=new WeakMap;class DRACOLoader extends Loader$1{constructor(_){super(_),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(_){return this.decoderPath=_,this}setDecoderConfig(_){return this.decoderConfig=_,this}setWorkerLimit(_){return this.workerLimit=_,this}load(_,tt,ot,st){const at=new FileLoader(this.manager);at.setPath(this.path),at.setResponseType("arraybuffer"),at.setRequestHeader(this.requestHeader),at.setWithCredentials(this.withCredentials),at.load(_,lt=>{const dt={attributeIDs:this.defaultAttributeIDs,attributeTypes:this.defaultAttributeTypes,useUniqueIDs:!1};this.decodeGeometry(lt,dt).then(tt).catch(st)},ot,st)}decodeDracoFile(_,tt,ot,st){const at={attributeIDs:ot||this.defaultAttributeIDs,attributeTypes:st||this.defaultAttributeTypes,useUniqueIDs:!!ot};this.decodeGeometry(_,at).then(tt)}decodeGeometry(_,tt){for(const ht in tt.attributeTypes){const ft=tt.attributeTypes[ht];ft.BYTES_PER_ELEMENT!==void 0&&(tt.attributeTypes[ht]=ft.name)}const ot=JSON.stringify(tt);if(_taskCache.has(_)){const ht=_taskCache.get(_);if(ht.key===ot)return ht.promise;if(_.byteLength===0)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let st;const at=this.workerNextTaskID++,lt=_.byteLength,dt=this._getWorker(at,lt).then(ht=>(st=ht,new Promise((ft,gt)=>{st._callbacks[at]={resolve:ft,reject:gt},st.postMessage({type:"decode",id:at,taskConfig:tt,buffer:_},[_])}))).then(ht=>this._createGeometry(ht.geometry));return dt.catch(()=>!0).then(()=>{st&&at&&this._releaseTask(st,at)}),_taskCache.set(_,{key:ot,promise:dt}),dt}_createGeometry(_){const tt=new BufferGeometry;_.index&&tt.setIndex(new BufferAttribute(_.index.array,1));for(let ot=0;ot<_.attributes.length;ot++){const st=_.attributes[ot],at=st.name,lt=st.array,dt=st.itemSize;tt.setAttribute(at,new BufferAttribute(lt,dt))}return tt}_loadLibrary(_,tt){const ot=new FileLoader(this.manager);return ot.setPath(this.decoderPath),ot.setResponseType(tt),ot.setWithCredentials(this.withCredentials),new Promise((st,at)=>{ot.load(_,st,void 0,at)})}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;const _=typeof WebAssembly!="object"||this.decoderConfig.type==="js",tt=[];return _?tt.push(this._loadLibrary("draco_decoder.js","text")):(tt.push(this._loadLibrary("draco_wasm_wrapper.js","text")),tt.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(tt).then(ot=>{const st=ot[0];_||(this.decoderConfig.wasmBinary=ot[1]);const at=DRACOWorker.toString(),lt=["/* draco decoder */",st,"","/* worker */",at.substring(at.indexOf("{")+1,at.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([lt]))}),this.decoderPending}_getWorker(_,tt){return this._initDecoder().then(()=>{if(this.workerPool.length<this.workerLimit){const st=new Worker(this.workerSourceURL);st._callbacks={},st._taskCosts={},st._taskLoad=0,st.postMessage({type:"init",decoderConfig:this.decoderConfig}),st.onmessage=function(at){const lt=at.data;switch(lt.type){case"decode":st._callbacks[lt.id].resolve(lt);break;case"error":st._callbacks[lt.id].reject(lt);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+lt.type+'"')}},this.workerPool.push(st)}else this.workerPool.sort(function(st,at){return st._taskLoad>at._taskLoad?-1:1});const ot=this.workerPool[this.workerPool.length-1];return ot._taskCosts[_]=tt,ot._taskLoad+=tt,ot})}_releaseTask(_,tt){_._taskLoad-=_._taskCosts[tt],delete _._callbacks[tt],delete _._taskCosts[tt]}debug(){console.log("Task load: ",this.workerPool.map(_=>_._taskLoad))}dispose(){for(let _=0;_<this.workerPool.length;++_)this.workerPool[_].terminate();return this.workerPool.length=0,this}}function DRACOWorker(){let nt,_;onmessage=function(lt){const dt=lt.data;switch(dt.type){case"init":nt=dt.decoderConfig,_=new Promise(function(gt){nt.onModuleLoaded=function(Et){gt({draco:Et})},DracoDecoderModule(nt)});break;case"decode":const ht=dt.buffer,ft=dt.taskConfig;_.then(gt=>{const Et=gt.draco,yt=new Et.Decoder,Ct=new Et.DecoderBuffer;Ct.Init(new Int8Array(ht),ht.byteLength);try{const wt=tt(Et,yt,Ct,ft),It=wt.attributes.map(Pt=>Pt.array.buffer);wt.index&&It.push(wt.index.array.buffer),self.postMessage({type:"decode",id:dt.id,geometry:wt},It)}catch(wt){console.error(wt),self.postMessage({type:"error",id:dt.id,error:wt.message})}finally{Et.destroy(Ct),Et.destroy(yt)}});break}};function tt(lt,dt,ht,ft){const gt=ft.attributeIDs,Et=ft.attributeTypes;let yt,Ct;const wt=dt.GetEncodedGeometryType(ht);if(wt===lt.TRIANGULAR_MESH)yt=new lt.Mesh,Ct=dt.DecodeBufferToMesh(ht,yt);else if(wt===lt.POINT_CLOUD)yt=new lt.PointCloud,Ct=dt.DecodeBufferToPointCloud(ht,yt);else throw new Error("THREE.DRACOLoader: Unexpected geometry type.");if(!Ct.ok()||yt.ptr===0)throw new Error("THREE.DRACOLoader: Decoding failed: "+Ct.error_msg());const It={index:null,attributes:[]};for(const Pt in gt){const Rt=self[Et[Pt]];let xt,Nt;if(ft.useUniqueIDs)Nt=gt[Pt],xt=dt.GetAttributeByUniqueId(yt,Nt);else{if(Nt=dt.GetAttributeId(yt,lt[gt[Pt]]),Nt===-1)continue;xt=dt.GetAttribute(yt,Nt)}It.attributes.push(st(lt,dt,yt,Pt,Rt,xt))}return wt===lt.TRIANGULAR_MESH&&(It.index=ot(lt,dt,yt)),lt.destroy(yt),It}function ot(lt,dt,ht){const gt=ht.num_faces()*3,Et=gt*4,yt=lt._malloc(Et);dt.GetTrianglesUInt32Array(ht,Et,yt);const Ct=new Uint32Array(lt.HEAPF32.buffer,yt,gt).slice();return lt._free(yt),{array:Ct,itemSize:1}}function st(lt,dt,ht,ft,gt,Et){const yt=Et.num_components(),wt=ht.num_points()*yt,It=wt*gt.BYTES_PER_ELEMENT,Pt=at(lt,gt),Rt=lt._malloc(It);dt.GetAttributeDataArrayForAllPoints(ht,Et,Pt,It,Rt);const xt=new gt(lt.HEAPF32.buffer,Rt,wt).slice();return lt._free(Rt),{name:ft,array:xt,itemSize:yt}}function at(lt,dt){switch(dt){case Float32Array:return lt.DT_FLOAT32;case Int8Array:return lt.DT_INT8;case Int16Array:return lt.DT_INT16;case Int32Array:return lt.DT_INT32;case Uint8Array:return lt.DT_UINT8;case Uint16Array:return lt.DT_UINT16;case Uint32Array:return lt.DT_UINT32}}}let generated;const MeshoptDecoder=()=>{if(generated)return generated;const nt="B9h9z9tFBBBF8fL9gBB9gLaaaaaFa9gEaaaB9gFaFa9gEaaaFaEMcBFFFGGGEIIILF9wFFFLEFBFKNFaFCx/IFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBF8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBGy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBEn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBIi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBKI9z9iqlBOc+x8ycGBM/qQFTa8jUUUUBCU/EBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAGTkUUUBRNCUoBAG9uC/wgBZHKCUGAKCUG9JyRVAECFJRICBRcGXEXAcAF9PQFAVAFAclAcAVJAF9JyRMGXGXAG9FQBAMCbJHKC9wZRSAKCIrCEJCGrRQANCUGJRfCBRbAIRTEXGXAOATlAQ9PQBCBRISEMATAQJRIGXAS9FQBCBRtCBREEXGXAOAIlCi9PQBCBRISLMANCU/CBJAEJRKGXGXGXGXGXATAECKrJ2BBAtCKZrCEZfIBFGEBMAKhB83EBAKCNJhB83EBSEMAKAI2BIAI2BBHmCKrHYAYCE6HYy86BBAKCFJAICIJAYJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCGJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCEJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCIJAYAmJHY2BBAI2BFHmCKrHPAPCE6HPy86BBAKCLJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCKJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCOJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCNJAYAmJHY2BBAI2BGHmCKrHPAPCE6HPy86BBAKCVJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCcJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCMJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCSJAYAmJHm2BBAI2BEHICKrHYAYCE6HYy86BBAKCQJAmAYJHm2BBAICIrCEZHYAYCE6HYy86BBAKCfJAmAYJHm2BBAICGrCEZHYAYCE6HYy86BBAKCbJAmAYJHK2BBAICEZHIAICE6HIy86BBAKAIJRISGMAKAI2BNAI2BBHmCIrHYAYCb6HYy86BBAKCFJAICNJAYJHY2BBAmCbZHmAmCb6Hmy86BBAKCGJAYAmJHm2BBAI2BFHYCIrHPAPCb6HPy86BBAKCEJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCIJAmAYJHm2BBAI2BGHYCIrHPAPCb6HPy86BBAKCLJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCKJAmAYJHm2BBAI2BEHYCIrHPAPCb6HPy86BBAKCOJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCNJAmAYJHm2BBAI2BIHYCIrHPAPCb6HPy86BBAKCVJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCcJAmAYJHm2BBAI2BLHYCIrHPAPCb6HPy86BBAKCMJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCSJAmAYJHm2BBAI2BKHYCIrHPAPCb6HPy86BBAKCQJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCfJAmAYJHm2BBAI2BOHICIrHYAYCb6HYy86BBAKCbJAmAYJHK2BBAICbZHIAICb6HIy86BBAKAIJRISFMAKAI8pBB83BBAKCNJAICNJ8pBB83BBAICTJRIMAtCGJRtAECTJHEAS9JQBMMGXAIQBCBRISEMGXAM9FQBANAbJ2BBRtCBRKAfREEXAEANCU/CBJAKJ2BBHTCFrCBATCFZl9zAtJHt86BBAEAGJREAKCFJHKAM9HQBMMAfCFJRfAIRTAbCFJHbAG9HQBMMABAcAG9sJANCUGJAMAG9sTkUUUBpANANCUGJAMCaJAG9sJAGTkUUUBpMAMCBAIyAcJRcAIQBMC9+RKSFMCBC99AOAIlAGCAAGCA9Ly6yRKMALCU/EBJ8kUUUUBAKM+OmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUFT+JUUUBpALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM+lLKFaF99GaG99FaG99GXGXAGCI9HQBAF9FQFEXGXGX9DBBB8/9DBBB+/ABCGJHG1BB+yAB1BBHE+yHI+L+TABCFJHL1BBHK+yHO+L+THN9DBBBB9gHVyAN9DBB/+hANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE86BBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG86BBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG86BBABCIJRBAFCaJHFQBSGMMAF9FQBEXGXGX9DBBB8/9DBBB+/ABCIJHG8uFB+yAB8uFBHE+yHI+L+TABCGJHL8uFBHK+yHO+L+THN9DBBBB9gHVyAN9DB/+g6ANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE87FBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG87FBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG87FBABCNJRBAFCaJHFQBMMM/SEIEaE99EaF99GXAF9FQBCBREABRIEXGXGX9D/zI818/AICKJ8uFBHLCEq+y+VHKAI8uFB+y+UHO9DB/+g6+U9DBBB8/9DBBB+/AO9DBBBB9gy+SHN+L9DBBB9P9d9FQBAN+oRVSFMCUUUU94RVMAICIJ8uFBRcAICGJ8uFBRMABALCFJCEZAEqCFWJAV87FBGXGXAKAM+y+UHN9DB/+g6+U9DBBB8/9DBBB+/AN9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRMSFMCUUUU94RMMABALCGJCEZAEqCFWJAM87FBGXGXAKAc+y+UHK9DB/+g6+U9DBBB8/9DBBB+/AK9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRcSFMCUUUU94RcMABALCaJCEZAEqCFWJAc87FBGXGX9DBBU8/AOAO+U+TANAN+U+TAKAK+U+THO9DBBBBAO9DBBBB9gy+R9DB/+g6+U9DBBB8/+SHO+L9DBBB9P9d9FQBAO+oRcSFMCUUUU94RcMABALCEZAEqCFWJAc87FBAICNJRIAECIJREAFCaJHFQBMMM9JBGXAGCGrAF9sHF9FQBEXABAB8oGBHGCNWCN91+yAGCi91CnWCUUU/8EJ+++U84GBABCIJRBAFCaJHFQBMMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEM/lFFFaGXGXAFABqCEZ9FQBABRESFMGXGXAGCT9PQBABRESFMABREEXAEAF8oGBjGBAECIJAFCIJ8oGBjGBAECNJAFCNJ8oGBjGBAECSJAFCSJ8oGBjGBAECTJREAFCTJRFAGC9wJHGCb9LQBMMAGCI9JQBEXAEAF8oGBjGBAFCIJRFAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF2BB86BBAECFJREAFCFJRFAGCaJHGQBMMABMoFFGaGXGXABCEZ9FQBABRESFMAFCgFZC+BwsN9sRIGXGXAGCT9PQBABRESFMABREEXAEAIjGBAECSJAIjGBAECNJAIjGBAECIJAIjGBAECTJREAGC9wJHGCb9LQBMMAGCI9JQBEXAEAIjGBAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF86BBAECFJREAGCaJHGQBMMABMMMFBCUNMIT9kBB",_="B9h9z9tFBBBFiI9gBB9gLaaaaaFa9gEaaaB9gFaFaEMcBBFBFFGGGEILF9wFFFLEFBFKNFaFCx/aFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBG8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBIy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBKi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBOn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBNI9z9iqlBVc+N9IcIBTEM9+FLa8jUUUUBCTlRBCBRFEXCBRGCBREEXABCNJAGJAECUaAFAGrCFZHIy86BBAEAIJREAGCFJHGCN9HQBMAFCx+YUUBJAE86BBAFCEWCxkUUBJAB8pEN83EBAFCFJHFCUG9HQBMMk8lLbaE97F9+FaL978jUUUUBCU/KBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAG/8cBBCUoBAG9uC/wgBZHKCUGAKCUG9JyRNAECFJRKCBRVGXEXAVAF9PQFANAFAVlAVANJAF9JyRcGXGXAG9FQBAcCbJHIC9wZHMCE9sRSAMCFWRQAICIrCEJCGrRfCBRbEXAKRTCBRtGXEXGXAOATlAf9PQBCBRKSLMALCU/CBJAtAM9sJRmATAfJRKCBREGXAMCoB9JQBAOAKlC/gB9JQBCBRIEXAmAIJREGXGXGXGXGXATAICKrJ2BBHYCEZfIBFGEBMAECBDtDMIBSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAeDeBJAiCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAeDeBJAiCx+YUUBJ2BBJRKSFMAEAKDBBBDMIBAKCTJRKMGXGXGXGXGXAYCGrCEZfIBFGEBMAECBDtDMITSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCIJAeDeBJAiCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCNJAeDeBJAiCx+YUUBJ2BBJRKSFMAEAKDBBBDMITAKCTJRKMGXGXGXGXGXAYCIrCEZfIBFGEBMAECBDtDMIASEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCIJAeDeBJAiCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCNJAeDeBJAiCx+YUUBJ2BBJRKSFMAEAKDBBBDMIAAKCTJRKMGXGXGXGXGXAYCKrfIBFGEBMAECBDtDMI8wSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCIJAeDeBJAYCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCNJAeDeBJAYCx+YUUBJ2BBJRKSFMAEAKDBBBDMI8wAKCTJRKMAICoBJREAICUFJAM9LQFAERIAOAKlC/fB9LQBMMGXAEAM9PQBAECErRIEXGXAOAKlCi9PQBCBRKSOMAmAEJRYGXGXGXGXGXATAECKrJ2BBAICKZrCEZfIBFGEBMAYCBDtDMIBSEMAYAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAeDeBJAiCx+YUUBJ2BBJRKSGMAYAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAeDeBJAiCx+YUUBJ2BBJRKSFMAYAKDBBBDMIBAKCTJRKMAICGJRIAECTJHEAM9JQBMMGXAK9FQBAKRTAtCFJHtCI6QGSFMMCBRKSEMGXAM9FQBALCUGJAbJREALAbJDBGBReCBRYEXAEALCU/CBJAYJHIDBIBHdCFD9tAdCFDbHPD9OD9hD9RHdAIAMJDBIBH8ZCFD9tA8ZAPD9OD9hD9RH8ZDQBTFtGmEYIPLdKeOnHpAIAQJDBIBHyCFD9tAyAPD9OD9hD9RHyAIASJDBIBH8cCFD9tA8cAPD9OD9hD9RH8cDQBTFtGmEYIPLdKeOnH8dDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGEAeD9uHeDyBjGBAEAGJHIAeAPAPDQILKOILKOILKOILKOD9uHeDyBjGBAIAGJHIAeAPAPDQNVcMNVcMNVcMNVcMD9uHeDyBjGBAIAGJHIAeAPAPDQSQfbSQfbSQfbSQfbD9uHeDyBjGBAIAGJHIAeApA8dDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHeDyBjGBAIAGJHIAeAPAPDQILKOILKOILKOILKOD9uHeDyBjGBAIAGJHIAeAPAPDQNVcMNVcMNVcMNVcMD9uHeDyBjGBAIAGJHIAeAPAPDQSQfbSQfbSQfbSQfbD9uHeDyBjGBAIAGJHIAeAdA8ZDQNiV8ZcpMyS8cQ8df8eb8fHdAyA8cDQNiV8ZcpMyS8cQ8df8eb8fH8ZDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGED9uHeDyBjGBAIAGJHIAeAPAPDQILKOILKOILKOILKOD9uHeDyBjGBAIAGJHIAeAPAPDQNVcMNVcMNVcMNVcMD9uHeDyBjGBAIAGJHIAeAPAPDQSQfbSQfbSQfbSQfbD9uHeDyBjGBAIAGJHIAeAdA8ZDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHeDyBjGBAIAGJHIAeAPAPDQILKOILKOILKOILKOD9uHeDyBjGBAIAGJHIAeAPAPDQNVcMNVcMNVcMNVcMD9uHeDyBjGBAIAGJHIAeAPAPDQSQfbSQfbSQfbSQfbD9uHeDyBjGBAIAGJREAYCTJHYAM9JQBMMAbCIJHbAG9JQBMMABAVAG9sJALCUGJAcAG9s/8cBBALALCUGJAcCaJAG9sJAG/8cBBMAcCBAKyAVJRVAKQBMC9+RKSFMCBC99AOAKlAGCAAGCA9Ly6yRKMALCU/KBJ8kUUUUBAKMNBT+BUUUBM+KmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUF/8MBALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM/dLEK97FaF97GXGXAGCI9HQBAF9FQFCBRGEXABABDBBBHECiD+rFCiD+sFD/6FHIAECND+rFCiD+sFD/6FAID/gFAECTD+rFCiD+sFD/6FHLD/gFD/kFD/lFHKCBDtD+2FHOAICUUUU94DtHND9OD9RD/kFHI9DBB/+hDYAIAID/mFAKAKD/mFALAOALAND9OD9RD/kFHIAID/mFD/kFD/kFD/jFD/nFHLD/mF9DBBX9LDYHOD/kFCgFDtD9OAECUUU94DtD9OD9QAIALD/mFAOD/kFCND+rFCU/+EDtD9OD9QAKALD/mFAOD/kFCTD+rFCUU/8ODtD9OD9QDMBBABCTJRBAGCIJHGAF9JQBSGMMAF9FQBCBRGEXABCTJHVAVDBBBHECBDtHOCUU98D8cFCUU98D8cEHND9OABDBBBHKAEDQILKOSQfbPden8c8d8e8fCggFDtD9OD/6FAKAEDQBFGENVcMTtmYi8ZpyHECTD+sFD/6FHID/gFAECTD+rFCTD+sFD/6FHLD/gFD/kFD/lFHE9DB/+g6DYALAEAOD+2FHOALCUUUU94DtHcD9OD9RD/kFHLALD/mFAEAED/mFAIAOAIAcD9OD9RD/kFHEAED/mFD/kFD/kFD/jFD/nFHID/mF9DBBX9LDYHOD/kFCTD+rFALAID/mFAOD/kFCggEDtD9OD9QHLAEAID/mFAOD/kFCaDbCBDnGCBDnECBDnKCBDnOCBDncCBDnMCBDnfCBDnbD9OHEDQNVi8ZcMpySQ8c8dfb8e8fD9QDMBBABAKAND9OALAEDQBFTtGEmYILPdKOenD9QDMBBABCAJRBAGCIJHGAF9JQBMMM/hEIGaF97FaL978jUUUUBCTlREGXAF9FQBCBRIEXAEABDBBBHLABCTJHKDBBBHODQILKOSQfbPden8c8d8e8fHNCTD+sFHVCID+rFDMIBAB9DBBU8/DY9D/zI818/DYAVCEDtD9QD/6FD/nFHVALAODQBFGENVcMTtmYi8ZpyHLCTD+rFCTD+sFD/6FD/mFHOAOD/mFAVALCTD+sFD/6FD/mFHcAcD/mFAVANCTD+rFCTD+sFD/6FD/mFHNAND/mFD/kFD/kFD/lFCBDtD+4FD/jF9DB/+g6DYHVD/mF9DBBX9LDYHLD/kFCggEDtHMD9OAcAVD/mFALD/kFCTD+rFD9QHcANAVD/mFALD/kFCTD+rFAOAVD/mFALD/kFAMD9OD9QHVDQBFTtGEmYILPdKOenHLD8dBAEDBIBDyB+t+J83EBABCNJALD8dFAEDBIBDyF+t+J83EBAKAcAVDQNVi8ZcMpySQ8c8dfb8e8fHVD8dBAEDBIBDyG+t+J83EBABCiJAVD8dFAEDBIBDyE+t+J83EBABCAJRBAICIJHIAF9JQBMMM9jFF97GXAGCGrAF9sHG9FQBCBRFEXABABDBBBHECND+rFCND+sFD/6FAECiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMBBABCTJRBAFCIJHFAG9JQBMMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEMMMFBCUNMIT9tBB",tt=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),ot=new Uint8Array([32,0,65,253,3,1,2,34,4,106,6,5,11,8,7,20,13,33,12,16,128,9,116,64,19,113,127,15,10,21,22,14,255,66,24,54,136,107,18,23,192,26,114,118,132,17,77,101,130,144,27,87,131,44,45,74,156,154,70,167]);if(typeof WebAssembly!="object")return{supported:!1};let st=nt;WebAssembly.validate(tt)&&(st=_);let at;const lt=WebAssembly.instantiate(dt(st),{}).then(Et=>{at=Et.instance,at.exports.__wasm_call_ctors()});function dt(Et){const yt=new Uint8Array(Et.length);for(let wt=0;wt<Et.length;++wt){const It=Et.charCodeAt(wt);yt[wt]=It>96?It-71:It>64?It-65:It>47?It+4:It>46?63:62}let Ct=0;for(let wt=0;wt<Et.length;++wt)yt[Ct++]=yt[wt]<60?ot[yt[wt]]:(yt[wt]-60)*64+yt[++wt];return yt.buffer.slice(0,Ct)}function ht(Et,yt,Ct,wt,It,Pt){const Rt=at.exports.sbrk,xt=Ct+3&-4,Nt=Rt(xt*wt),kt=Rt(It.length),Vt=new Uint8Array(at.exports.memory.buffer);Vt.set(It,kt);const Ft=Et(Nt,Ct,wt,kt,It.length);if(Ft===0&&Pt&&Pt(Nt,xt,wt),yt.set(Vt.subarray(Nt,Nt+Ct*wt)),Rt(Nt-Rt(0)),Ft!==0)throw new Error(`Malformed buffer data: ${Ft}`)}const ft={0:"",1:"meshopt_decodeFilterOct",2:"meshopt_decodeFilterQuat",3:"meshopt_decodeFilterExp",NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},gt={0:"meshopt_decodeVertexBuffer",1:"meshopt_decodeIndexBuffer",2:"meshopt_decodeIndexSequence",ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return generated={ready:lt,supported:!0,decodeVertexBuffer(Et,yt,Ct,wt,It){ht(at.exports.meshopt_decodeVertexBuffer,Et,yt,Ct,wt,at.exports[ft[It]])},decodeIndexBuffer(Et,yt,Ct,wt){ht(at.exports.meshopt_decodeIndexBuffer,Et,yt,Ct,wt)},decodeIndexSequence(Et,yt,Ct,wt){ht(at.exports.meshopt_decodeIndexSequence,Et,yt,Ct,wt)},decodeGltfBuffer(Et,yt,Ct,wt,It,Pt){ht(at.exports[gt[It]],Et,yt,Ct,wt,at.exports[ft[Pt]])}},generated};function shallow(nt,_){if(Object.is(nt,_))return!0;if(typeof nt!="object"||nt===null||typeof _!="object"||_===null)return!1;const tt=Object.keys(nt);if(tt.length!==Object.keys(_).length)return!1;for(let ot=0;ot<tt.length;ot++)if(!Object.prototype.hasOwnProperty.call(_,tt[ot])||!Object.is(nt[tt[ot]],_[tt[ot]]))return!1;return!0}function workerBootstrap(){var nt=Object.create(null);function _(st,at){var lt=st.id,dt=st.name,ht=st.dependencies;ht===void 0&&(ht=[]);var ft=st.init;ft===void 0&&(ft=function(){});var gt=st.getTransferables;if(gt===void 0&&(gt=null),!nt[lt])try{ht=ht.map(function(yt){return yt&&yt.isWorkerModule&&(_(yt,function(Ct){if(Ct instanceof Error)throw Ct}),yt=nt[yt.id].value),yt}),ft=ot("<"+dt+">.init",ft),gt&&(gt=ot("<"+dt+">.getTransferables",gt));var Et=null;typeof ft=="function"?Et=ft.apply(void 0,ht):console.error("worker module init function failed to rehydrate"),nt[lt]={id:lt,value:Et,getTransferables:gt},at(Et)}catch(yt){yt&&yt.noLog||console.error(yt),at(yt)}}function tt(st,at){var lt,dt=st.id,ht=st.args;(!nt[dt]||typeof nt[dt].value!="function")&&at(new Error("Worker module "+dt+": not found or its 'init' did not return a function"));try{var ft=(lt=nt[dt]).value.apply(lt,ht);ft&&typeof ft.then=="function"?ft.then(gt,function(Et){return at(Et instanceof Error?Et:new Error(""+Et))}):gt(ft)}catch(Et){at(Et)}function gt(Et){try{var yt=nt[dt].getTransferables&&nt[dt].getTransferables(Et);(!yt||!Array.isArray(yt)||!yt.length)&&(yt=void 0),at(Et,yt)}catch(Ct){console.error(Ct),at(Ct)}}}function ot(st,at){var lt=void 0;self.troikaDefine=function(ht){return lt=ht};var dt=URL.createObjectURL(new Blob(["/** "+st.replace(/\*/g,"")+` **/

troikaDefine(
`+at+`
)`],{type:"application/javascript"}));try{importScripts(dt)}catch(ht){console.error(ht)}return URL.revokeObjectURL(dt),delete self.troikaDefine,lt}self.addEventListener("message",function(st){var at=st.data,lt=at.messageId,dt=at.action,ht=at.data;try{dt==="registerModule"&&_(ht,function(ft){ft instanceof Error?postMessage({messageId:lt,success:!1,error:ft.message}):postMessage({messageId:lt,success:!0,result:{isCallable:typeof ft=="function"}})}),dt==="callModule"&&tt(ht,function(ft,gt){ft instanceof Error?postMessage({messageId:lt,success:!1,error:ft.message}):postMessage({messageId:lt,success:!0,result:ft},gt||void 0)})}catch(ft){postMessage({messageId:lt,success:!1,error:ft.stack})}})}function defineMainThreadModule(nt){var _=function(){for(var tt=[],ot=arguments.length;ot--;)tt[ot]=arguments[ot];return _._getInitResult().then(function(st){if(typeof st=="function")return st.apply(void 0,tt);throw new Error("Worker module function was called but `init` did not return a callable function")})};return _._getInitResult=function(){var tt=nt.dependencies,ot=nt.init;tt=Array.isArray(tt)?tt.map(function(at){return at&&at._getInitResult?at._getInitResult():at}):[];var st=Promise.all(tt).then(function(at){return ot.apply(null,at)});return _._getInitResult=function(){return st},st},_}var supportsWorkers=function(){var nt=!1;if(typeof window<"u"&&typeof window.document<"u")try{var _=new Worker(URL.createObjectURL(new Blob([""],{type:"application/javascript"})));_.terminate(),nt=!0}catch(tt){typeof process<"u",console.log("Troika createWorkerModule: web workers not allowed; falling back to main thread execution. Cause: ["+tt.message+"]")}return supportsWorkers=function(){return nt},nt},_workerModuleId=0,_messageId=0,_allowInitAsString=!1,workers=Object.create(null),registeredModules=Object.create(null),openRequests=Object.create(null);function defineWorkerModule(nt){if((!nt||typeof nt.init!="function")&&!_allowInitAsString)throw new Error("requires `options.init` function");var _=nt.dependencies,tt=nt.init,ot=nt.getTransferables,st=nt.workerId;if(!supportsWorkers())return defineMainThreadModule(nt);st==null&&(st="#default");var at="workerModule"+ ++_workerModuleId,lt=nt.name||at,dt=null;_=_&&_.map(function(ft){return typeof ft=="function"&&!ft.workerModuleData&&(_allowInitAsString=!0,ft=defineWorkerModule({workerId:st,name:"<"+lt+"> function dependency: "+ft.name,init:`function(){return (
`+stringifyFunction(ft)+`
)}`}),_allowInitAsString=!1),ft&&ft.workerModuleData&&(ft=ft.workerModuleData),ft});function ht(){for(var ft=[],gt=arguments.length;gt--;)ft[gt]=arguments[gt];if(!dt){dt=callWorker(st,"registerModule",ht.workerModuleData);var Et=function(){dt=null,registeredModules[st].delete(Et)};(registeredModules[st]||(registeredModules[st]=new Set)).add(Et)}return dt.then(function(yt){var Ct=yt.isCallable;if(Ct)return callWorker(st,"callModule",{id:at,args:ft});throw new Error("Worker module function was called but `init` did not return a callable function")})}return ht.workerModuleData={isWorkerModule:!0,id:at,name:lt,dependencies:_,init:stringifyFunction(tt),getTransferables:ot&&stringifyFunction(ot)},ht}function terminateWorker(nt){registeredModules[nt]&&registeredModules[nt].forEach(function(_){_()}),workers[nt]&&(workers[nt].terminate(),delete workers[nt])}function stringifyFunction(nt){var _=nt.toString();return!/^function/.test(_)&&/^\w+\s*\(/.test(_)&&(_="function "+_),_}function getWorker(nt){var _=workers[nt];if(!_){var tt=stringifyFunction(workerBootstrap);_=workers[nt]=new Worker(URL.createObjectURL(new Blob(["/** Worker Module Bootstrap: "+nt.replace(/\*/g,"")+` **/

;(`+tt+")()"],{type:"application/javascript"}))),_.onmessage=function(ot){var st=ot.data,at=st.messageId,lt=openRequests[at];if(!lt)throw new Error("WorkerModule response with empty or unknown messageId");delete openRequests[at],lt(st)}}return _}function callWorker(nt,_,tt){return new Promise(function(ot,st){var at=++_messageId;openRequests[at]=function(lt){lt.success?ot(lt.result):st(new Error("Error in worker "+_+" call: "+lt.error))},getWorker(nt).postMessage({messageId:at,action:_,data:tt})})}function SDFGenerator(){var nt=function(_){function tt(An,Sn,gn,_n,Rn,bn,jn,kn){var Gn=1-jn;kn.x=Gn*Gn*An+2*Gn*jn*gn+jn*jn*Rn,kn.y=Gn*Gn*Sn+2*Gn*jn*_n+jn*jn*bn}function ot(An,Sn,gn,_n,Rn,bn,jn,kn,Gn,Vn){var qn=1-Gn;Vn.x=qn*qn*qn*An+3*qn*qn*Gn*gn+3*qn*Gn*Gn*Rn+Gn*Gn*Gn*jn,Vn.y=qn*qn*qn*Sn+3*qn*qn*Gn*_n+3*qn*Gn*Gn*bn+Gn*Gn*Gn*kn}function st(An,Sn){for(var gn=/([MLQCZ])([^MLQCZ]*)/g,_n,Rn,bn,jn,kn;_n=gn.exec(An);){var Gn=_n[2].replace(/^\s*|\s*$/g,"").split(/[,\s]+/).map(function(Vn){return parseFloat(Vn)});switch(_n[1]){case"M":jn=Rn=Gn[0],kn=bn=Gn[1];break;case"L":(Gn[0]!==jn||Gn[1]!==kn)&&Sn("L",jn,kn,jn=Gn[0],kn=Gn[1]);break;case"Q":{Sn("Q",jn,kn,jn=Gn[2],kn=Gn[3],Gn[0],Gn[1]);break}case"C":{Sn("C",jn,kn,jn=Gn[4],kn=Gn[5],Gn[0],Gn[1],Gn[2],Gn[3]);break}case"Z":(jn!==Rn||kn!==bn)&&Sn("L",jn,kn,Rn,bn);break}}}function at(An,Sn,gn){gn===void 0&&(gn=16);var _n={x:0,y:0};st(An,function(Rn,bn,jn,kn,Gn,Vn,qn,Tr,Mn){switch(Rn){case"L":Sn(bn,jn,kn,Gn);break;case"Q":{for(var Zt=bn,wn=jn,xn=1;xn<gn;xn++)tt(bn,jn,Vn,qn,kn,Gn,xn/(gn-1),_n),Sn(Zt,wn,_n.x,_n.y),Zt=_n.x,wn=_n.y;break}case"C":{for(var Hn=bn,Bn=jn,cr=1;cr<gn;cr++)ot(bn,jn,Vn,qn,Tr,Mn,kn,Gn,cr/(gn-1),_n),Sn(Hn,Bn,_n.x,_n.y),Hn=_n.x,Bn=_n.y;break}}})}var lt="precision highp float;attribute vec2 aUV;varying vec2 vUV;void main(){vUV=aUV;gl_Position=vec4(mix(vec2(-1.0),vec2(1.0),aUV),0.0,1.0);}",dt="precision highp float;uniform sampler2D tex;varying vec2 vUV;void main(){gl_FragColor=texture2D(tex,vUV);}",ht=new WeakMap,ft={premultipliedAlpha:!1,preserveDrawingBuffer:!0,antialias:!1,depth:!1};function gt(An,Sn){var gn=An.getContext?An.getContext("webgl",ft):An,_n=ht.get(gn);if(!_n){let Hn=function(ir){var kr=bn[ir];if(!kr&&(kr=bn[ir]=gn.getExtension(ir),!kr))throw new Error(ir+" not supported");return kr},Bn=function(ir,kr){var un=gn.createShader(kr);return gn.shaderSource(un,ir),gn.compileShader(un),un},cr=function(ir,kr,un,sn){if(!jn[ir]){var Kn={},Sr={},lr=gn.createProgram();gn.attachShader(lr,Bn(kr,gn.VERTEX_SHADER)),gn.attachShader(lr,Bn(un,gn.FRAGMENT_SHADER)),gn.linkProgram(lr),jn[ir]={program:lr,transaction:function(Fr){gn.useProgram(lr),Fr({setUniform:function(dr,Hr){for(var zr=[],Nr=arguments.length-2;Nr-- >0;)zr[Nr]=arguments[Nr+2];var Or=Sr[Hr]||(Sr[Hr]=gn.getUniformLocation(lr,Hr));gn["uniform"+dr].apply(gn,[Or].concat(zr))},setAttribute:function(dr,Hr,zr,Nr,Or){var Ur=Kn[dr];Ur||(Ur=Kn[dr]={buf:gn.createBuffer(),loc:gn.getAttribLocation(lr,dr),data:null}),gn.bindBuffer(gn.ARRAY_BUFFER,Ur.buf),gn.vertexAttribPointer(Ur.loc,Hr,gn.FLOAT,!1,0,0),gn.enableVertexAttribArray(Ur.loc),Rn?gn.vertexAttribDivisor(Ur.loc,Nr):Hn("ANGLE_instanced_arrays").vertexAttribDivisorANGLE(Ur.loc,Nr),Or!==Ur.data&&(gn.bufferData(gn.ARRAY_BUFFER,Or,zr),Ur.data=Or)}})}}}jn[ir].transaction(sn)},Wn=function(ir,kr){Gn++;try{gn.activeTexture(gn.TEXTURE0+Gn);var un=kn[ir];un||(un=kn[ir]=gn.createTexture(),gn.bindTexture(gn.TEXTURE_2D,un),gn.texParameteri(gn.TEXTURE_2D,gn.TEXTURE_MIN_FILTER,gn.NEAREST),gn.texParameteri(gn.TEXTURE_2D,gn.TEXTURE_MAG_FILTER,gn.NEAREST)),gn.bindTexture(gn.TEXTURE_2D,un),kr(un,Gn)}finally{Gn--}},rr=function(ir,kr,un){var sn=gn.createFramebuffer();Vn.push(sn),gn.bindFramebuffer(gn.FRAMEBUFFER,sn),gn.activeTexture(gn.TEXTURE0+kr),gn.bindTexture(gn.TEXTURE_2D,ir),gn.framebufferTexture2D(gn.FRAMEBUFFER,gn.COLOR_ATTACHMENT0,gn.TEXTURE_2D,ir,0);try{un(sn)}finally{gn.deleteFramebuffer(sn),gn.bindFramebuffer(gn.FRAMEBUFFER,Vn[--Vn.length-1]||null)}},sr=function(){bn={},jn={},kn={},Gn=-1,Vn.length=0};var qn=Hn,Tr=Bn,Mn=cr,Zt=Wn,wn=rr,xn=sr,Rn=typeof WebGL2RenderingContext<"u"&&gn instanceof WebGL2RenderingContext,bn={},jn={},kn={},Gn=-1,Vn=[];gn.canvas.addEventListener("webglcontextlost",function(ir){sr(),ir.preventDefault()},!1),ht.set(gn,_n={gl:gn,isWebGL2:Rn,getExtension:Hn,withProgram:cr,withTexture:Wn,withTextureFramebuffer:rr,handleContextLoss:sr})}Sn(_n)}function Et(An,Sn,gn,_n,Rn,bn,jn,kn){jn===void 0&&(jn=15),kn===void 0&&(kn=null),gt(An,function(Gn){var Vn=Gn.gl,qn=Gn.withProgram,Tr=Gn.withTexture;Tr("copy",function(Mn,Zt){Vn.texImage2D(Vn.TEXTURE_2D,0,Vn.RGBA,Rn,bn,0,Vn.RGBA,Vn.UNSIGNED_BYTE,Sn),qn("copy",lt,dt,function(wn){var xn=wn.setUniform,Hn=wn.setAttribute;Hn("aUV",2,Vn.STATIC_DRAW,0,new Float32Array([0,0,2,0,0,2])),xn("1i","image",Zt),Vn.bindFramebuffer(Vn.FRAMEBUFFER,kn||null),Vn.disable(Vn.BLEND),Vn.colorMask(jn&8,jn&4,jn&2,jn&1),Vn.viewport(gn,_n,Rn,bn),Vn.scissor(gn,_n,Rn,bn),Vn.drawArrays(Vn.TRIANGLES,0,3)})})})}function yt(An,Sn,gn){var _n=An.width,Rn=An.height;gt(An,function(bn){var jn=bn.gl,kn=new Uint8Array(_n*Rn*4);jn.readPixels(0,0,_n,Rn,jn.RGBA,jn.UNSIGNED_BYTE,kn),An.width=Sn,An.height=gn,Et(jn,kn,0,0,_n,Rn)})}var Ct=Object.freeze({__proto__:null,withWebGLContext:gt,renderImageData:Et,resizeWebGLCanvasWithoutClearing:yt});function wt(An,Sn,gn,_n,Rn,bn){bn===void 0&&(bn=1);var jn=new Uint8Array(An*Sn),kn=_n[2]-_n[0],Gn=_n[3]-_n[1],Vn=[];at(gn,function(Hn,Bn,cr,Wn){Vn.push({x1:Hn,y1:Bn,x2:cr,y2:Wn,minX:Math.min(Hn,cr),minY:Math.min(Bn,Wn),maxX:Math.max(Hn,cr),maxY:Math.max(Bn,Wn)})}),Vn.sort(function(Hn,Bn){return Hn.maxX-Bn.maxX});for(var qn=0;qn<An;qn++)for(var Tr=0;Tr<Sn;Tr++){var Mn=wn(_n[0]+kn*(qn+.5)/An,_n[1]+Gn*(Tr+.5)/Sn),Zt=Math.pow(1-Math.abs(Mn)/Rn,bn)/2;Mn<0&&(Zt=1-Zt),Zt=Math.max(0,Math.min(255,Math.round(Zt*255))),jn[Tr*An+qn]=Zt}return jn;function wn(Hn,Bn){for(var cr=1/0,Wn=1/0,rr=Vn.length;rr--;){var sr=Vn[rr];if(sr.maxX+Wn<=Hn)break;if(Hn+Wn>sr.minX&&Bn-Wn<sr.maxY&&Bn+Wn>sr.minY){var ir=Rt(Hn,Bn,sr.x1,sr.y1,sr.x2,sr.y2);ir<cr&&(cr=ir,Wn=Math.sqrt(cr))}}return xn(Hn,Bn)&&(Wn=-Wn),Wn}function xn(Hn,Bn){for(var cr=0,Wn=Vn.length;Wn--;){var rr=Vn[Wn];if(rr.maxX<=Hn)break;var sr=rr.y1>Bn!=rr.y2>Bn&&Hn<(rr.x2-rr.x1)*(Bn-rr.y1)/(rr.y2-rr.y1)+rr.x1;sr&&(cr+=rr.y1<rr.y2?1:-1)}return cr!==0}}function It(An,Sn,gn,_n,Rn,bn,jn,kn,Gn,Vn){bn===void 0&&(bn=1),kn===void 0&&(kn=0),Gn===void 0&&(Gn=0),Vn===void 0&&(Vn=0),Pt(An,Sn,gn,_n,Rn,bn,jn,null,kn,Gn,Vn)}function Pt(An,Sn,gn,_n,Rn,bn,jn,kn,Gn,Vn,qn){bn===void 0&&(bn=1),Gn===void 0&&(Gn=0),Vn===void 0&&(Vn=0),qn===void 0&&(qn=0);for(var Tr=wt(An,Sn,gn,_n,Rn,bn),Mn=new Uint8Array(Tr.length*4),Zt=0;Zt<Tr.length;Zt++)Mn[Zt*4+qn]=Tr[Zt];Et(jn,Mn,Gn,Vn,An,Sn,1<<3-qn,kn)}function Rt(An,Sn,gn,_n,Rn,bn){var jn=Rn-gn,kn=bn-_n,Gn=jn*jn+kn*kn,Vn=Gn?Math.max(0,Math.min(1,((An-gn)*jn+(Sn-_n)*kn)/Gn)):0,qn=An-(gn+Vn*jn),Tr=Sn-(_n+Vn*kn);return qn*qn+Tr*Tr}var xt=Object.freeze({__proto__:null,generate:wt,generateIntoCanvas:It,generateIntoFramebuffer:Pt}),Nt="precision highp float;uniform vec4 uGlyphBounds;attribute vec2 aUV;attribute vec4 aLineSegment;varying vec4 vLineSegment;varying vec2 vGlyphXY;void main(){vLineSegment=aLineSegment;vGlyphXY=mix(uGlyphBounds.xy,uGlyphBounds.zw,aUV);gl_Position=vec4(mix(vec2(-1.0),vec2(1.0),aUV),0.0,1.0);}",kt="precision highp float;uniform vec4 uGlyphBounds;uniform float uMaxDistance;uniform float uExponent;varying vec4 vLineSegment;varying vec2 vGlyphXY;float absDistToSegment(vec2 point,vec2 lineA,vec2 lineB){vec2 lineDir=lineB-lineA;float lenSq=dot(lineDir,lineDir);float t=lenSq==0.0 ? 0.0 : clamp(dot(point-lineA,lineDir)/lenSq,0.0,1.0);vec2 linePt=lineA+t*lineDir;return distance(point,linePt);}void main(){vec4 seg=vLineSegment;vec2 p=vGlyphXY;float dist=absDistToSegment(p,seg.xy,seg.zw);float val=pow(1.0-clamp(dist/uMaxDistance,0.0,1.0),uExponent)*0.5;bool crossing=(seg.y>p.y!=seg.w>p.y)&&(p.x<(seg.z-seg.x)*(p.y-seg.y)/(seg.w-seg.y)+seg.x);bool crossingUp=crossing&&vLineSegment.y<vLineSegment.w;gl_FragColor=vec4(crossingUp ? 1.0/255.0 : 0.0,crossing&&!crossingUp ? 1.0/255.0 : 0.0,0.0,val);}",Vt="precision highp float;uniform sampler2D tex;varying vec2 vUV;void main(){vec4 color=texture2D(tex,vUV);bool inside=color.r!=color.g;float val=inside ? 1.0-color.a : color.a;gl_FragColor=vec4(val);}",Ft=new Float32Array([0,0,2,0,0,2]),zt=null,Yt=!1,Kt={},qt=new WeakMap;function pn(An){if(!Yt&&!Cn(An))throw new Error("WebGL generation not supported")}function an(An,Sn,gn,_n,Rn,bn,jn){if(bn===void 0&&(bn=1),jn===void 0&&(jn=null),!jn&&(jn=zt,!jn)){var kn=typeof OffscreenCanvas=="function"?new OffscreenCanvas(1,1):typeof document<"u"?document.createElement("canvas"):null;if(!kn)throw new Error("OffscreenCanvas or DOM canvas not supported");jn=zt=kn.getContext("webgl",{depth:!1})}pn(jn);var Gn=new Uint8Array(An*Sn*4);gt(jn,function(Mn){var Zt=Mn.gl,wn=Mn.withTexture,xn=Mn.withTextureFramebuffer;wn("readable",function(Hn,Bn){Zt.texImage2D(Zt.TEXTURE_2D,0,Zt.RGBA,An,Sn,0,Zt.RGBA,Zt.UNSIGNED_BYTE,null),xn(Hn,Bn,function(cr){dn(An,Sn,gn,_n,Rn,bn,Zt,cr,0,0,0),Zt.readPixels(0,0,An,Sn,Zt.RGBA,Zt.UNSIGNED_BYTE,Gn)})})});for(var Vn=new Uint8Array(An*Sn),qn=0,Tr=0;qn<Gn.length;qn+=4)Vn[Tr++]=Gn[qn];return Vn}function fn(An,Sn,gn,_n,Rn,bn,jn,kn,Gn,Vn){bn===void 0&&(bn=1),kn===void 0&&(kn=0),Gn===void 0&&(Gn=0),Vn===void 0&&(Vn=0),dn(An,Sn,gn,_n,Rn,bn,jn,null,kn,Gn,Vn)}function dn(An,Sn,gn,_n,Rn,bn,jn,kn,Gn,Vn,qn){bn===void 0&&(bn=1),Gn===void 0&&(Gn=0),Vn===void 0&&(Vn=0),qn===void 0&&(qn=0),pn(jn);var Tr=[];at(gn,function(Mn,Zt,wn,xn){Tr.push(Mn,Zt,wn,xn)}),Tr=new Float32Array(Tr),gt(jn,function(Mn){var Zt=Mn.gl,wn=Mn.isWebGL2,xn=Mn.getExtension,Hn=Mn.withProgram,Bn=Mn.withTexture,cr=Mn.withTextureFramebuffer,Wn=Mn.handleContextLoss;if(Bn("rawDistances",function(rr,sr){(An!==rr._lastWidth||Sn!==rr._lastHeight)&&Zt.texImage2D(Zt.TEXTURE_2D,0,Zt.RGBA,rr._lastWidth=An,rr._lastHeight=Sn,0,Zt.RGBA,Zt.UNSIGNED_BYTE,null),Hn("main",Nt,kt,function(ir){var kr=ir.setAttribute,un=ir.setUniform,sn=!wn&&xn("ANGLE_instanced_arrays"),Kn=!wn&&xn("EXT_blend_minmax");kr("aUV",2,Zt.STATIC_DRAW,0,Ft),kr("aLineSegment",4,Zt.DYNAMIC_DRAW,1,Tr),un.apply(void 0,["4f","uGlyphBounds"].concat(_n)),un("1f","uMaxDistance",Rn),un("1f","uExponent",bn),cr(rr,sr,function(Sr){Zt.enable(Zt.BLEND),Zt.colorMask(!0,!0,!0,!0),Zt.viewport(0,0,An,Sn),Zt.scissor(0,0,An,Sn),Zt.blendFunc(Zt.ONE,Zt.ONE),Zt.blendEquationSeparate(Zt.FUNC_ADD,wn?Zt.MAX:Kn.MAX_EXT),Zt.clear(Zt.COLOR_BUFFER_BIT),wn?Zt.drawArraysInstanced(Zt.TRIANGLES,0,3,Tr.length/4):sn.drawArraysInstancedANGLE(Zt.TRIANGLES,0,3,Tr.length/4)})}),Hn("post",lt,Vt,function(ir){ir.setAttribute("aUV",2,Zt.STATIC_DRAW,0,Ft),ir.setUniform("1i","tex",sr),Zt.bindFramebuffer(Zt.FRAMEBUFFER,kn),Zt.disable(Zt.BLEND),Zt.colorMask(qn===0,qn===1,qn===2,qn===3),Zt.viewport(Gn,Vn,An,Sn),Zt.scissor(Gn,Vn,An,Sn),Zt.drawArrays(Zt.TRIANGLES,0,3)})}),Zt.isContextLost())throw Wn(),new Error("webgl context lost")})}function Cn(An){var Sn=!An||An===zt?Kt:An.canvas||An,gn=qt.get(Sn);if(gn===void 0){Yt=!0;var _n=null;try{var Rn=[97,106,97,61,99,137,118,80,80,118,137,99,61,97,106,97],bn=an(4,4,"M8,8L16,8L24,24L16,24Z",[0,0,32,32],24,1,An);gn=bn&&Rn.length===bn.length&&bn.every(function(jn,kn){return jn===Rn[kn]}),gn||(_n="bad trial run results",console.info(Rn,bn))}catch(jn){gn=!1,_n=jn.message}_n&&console.warn("WebGL SDF generation not supported:",_n),Yt=!1,qt.set(Sn,gn)}return gn}var On=Object.freeze({__proto__:null,generate:an,generateIntoCanvas:fn,generateIntoFramebuffer:dn,isSupported:Cn});function Pn(An,Sn,gn,_n,Rn,bn){Rn===void 0&&(Rn=Math.max(_n[2]-_n[0],_n[3]-_n[1])/2),bn===void 0&&(bn=1);try{return an.apply(On,arguments)}catch(jn){return console.info("WebGL SDF generation failed, falling back to JS",jn),wt.apply(xt,arguments)}}function yn(An,Sn,gn,_n,Rn,bn,jn,kn,Gn,Vn){Rn===void 0&&(Rn=Math.max(_n[2]-_n[0],_n[3]-_n[1])/2),bn===void 0&&(bn=1),kn===void 0&&(kn=0),Gn===void 0&&(Gn=0),Vn===void 0&&(Vn=0);try{return fn.apply(On,arguments)}catch(qn){return console.info("WebGL SDF generation failed, falling back to JS",qn),It.apply(xt,arguments)}}return _.forEachPathCommand=st,_.generate=Pn,_.generateIntoCanvas=yn,_.javascript=xt,_.pathToLineSegments=at,_.webgl=On,_.webglUtils=Ct,Object.defineProperty(_,"__esModule",{value:!0}),_}({});return nt}function bidiFactory(){var nt=function(_){var tt={R:"13k,1a,2,3,3,2+1j,ch+16,a+1,5+2,2+n,5,a,4,6+16,4+3,h+1b,4mo,179q,2+9,2+11,2i9+7y,2+68,4,3+4,5+13,4+3,2+4k,3+29,8+cf,1t+7z,w+17,3+3m,1t+3z,16o1+5r,8+30,8+mc,29+1r,29+4v,75+73",EN:"1c+9,3d+1,6,187+9,513,4+5,7+9,sf+j,175h+9,qw+q,161f+1d,4xt+a,25i+9",ES:"17,2,6dp+1,f+1,av,16vr,mx+1,4o,2",ET:"z+2,3h+3,b+1,ym,3e+1,2o,p4+1,8,6u,7c,g6,1wc,1n9+4,30+1b,2n,6d,qhx+1,h0m,a+1,49+2,63+1,4+1,6bb+3,12jj",AN:"16o+5,2j+9,2+1,35,ed,1ff2+9,87+u",CS:"18,2+1,b,2u,12k,55v,l,17v0,2,3,53,2+1,b",B:"a,3,f+2,2v,690",S:"9,2,k",WS:"c,k,4f4,1vk+a,u,1j,335",ON:"x+1,4+4,h+5,r+5,r+3,z,5+3,2+1,2+1,5,2+2,3+4,o,w,ci+1,8+d,3+d,6+8,2+g,39+1,9,6+1,2,33,b8,3+1,3c+1,7+1,5r,b,7h+3,sa+5,2,3i+6,jg+3,ur+9,2v,ij+1,9g+9,7+a,8m,4+1,49+x,14u,2+2,c+2,e+2,e+2,e+1,i+n,e+e,2+p,u+2,e+2,36+1,2+3,2+1,b,2+2,6+5,2,2,2,h+1,5+4,6+3,3+f,16+2,5+3l,3+81,1y+p,2+40,q+a,m+13,2r+ch,2+9e,75+hf,3+v,2+2w,6e+5,f+6,75+2a,1a+p,2+2g,d+5x,r+b,6+3,4+o,g,6+1,6+2,2k+1,4,2j,5h+z,1m+1,1e+f,t+2,1f+e,d+3,4o+3,2s+1,w,535+1r,h3l+1i,93+2,2s,b+1,3l+x,2v,4g+3,21+3,kz+1,g5v+1,5a,j+9,n+v,2,3,2+8,2+1,3+2,2,3,46+1,4+4,h+5,r+5,r+a,3h+2,4+6,b+4,78,1r+24,4+c,4,1hb,ey+6,103+j,16j+c,1ux+7,5+g,fsh,jdq+1t,4,57+2e,p1,1m,1m,1m,1m,4kt+1,7j+17,5+2r,d+e,3+e,2+e,2+10,m+4,w,1n+5,1q,4z+5,4b+rb,9+c,4+c,4+37,d+2g,8+b,l+b,5+1j,9+9,7+13,9+t,3+1,27+3c,2+29,2+3q,d+d,3+4,4+2,6+6,a+o,8+6,a+2,e+6,16+42,2+1i",BN:"0+8,6+d,2s+5,2+p,e,4m9,1kt+2,2b+5,5+5,17q9+v,7k,6p+8,6+1,119d+3,440+7,96s+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+75,6p+2rz,1ben+1,1ekf+1,1ekf+1",NSM:"lc+33,7o+6,7c+18,2,2+1,2+1,2,21+a,1d+k,h,2u+6,3+5,3+1,2+3,10,v+q,2k+a,1n+8,a,p+3,2+8,2+2,2+4,18+2,3c+e,2+v,1k,2,5+7,5,4+6,b+1,u,1n,5+3,9,l+1,r,3+1,1m,5+1,5+1,3+2,4,v+1,4,c+1,1m,5+4,2+1,5,l+1,n+5,2,1n,3,2+3,9,8+1,c+1,v,1q,d,1f,4,1m+2,6+2,2+3,8+1,c+1,u,1n,g+1,l+1,t+1,1m+1,5+3,9,l+1,u,21,8+2,2,2j,3+6,d+7,2r,3+8,c+5,23+1,s,2,2,1k+d,2+4,2+1,6+a,2+z,a,2v+3,2+5,2+1,3+1,q+1,5+2,h+3,e,3+1,7,g,jk+2,qb+2,u+2,u+1,v+1,1t+1,2+6,9,3+a,a,1a+2,3c+1,z,3b+2,5+1,a,7+2,64+1,3,1n,2+6,2,2,3+7,7+9,3,1d+g,1s+3,1d,2+4,2,6,15+8,d+1,x+3,3+1,2+2,1l,2+1,4,2+2,1n+7,3+1,49+2,2+c,2+6,5,7,4+1,5j+1l,2+4,k1+w,2db+2,3y,2p+v,ff+3,30+1,n9x+3,2+9,x+1,29+1,7l,4,5,q+1,6,48+1,r+h,e,13+7,q+a,1b+2,1d,3+3,3+1,14,1w+5,3+1,3+1,d,9,1c,1g,2+2,3+1,6+1,2,17+1,9,6n,3,5,fn5,ki+f,h+f,r2,6b,46+4,1af+2,2+1,6+3,15+2,5,4m+1,fy+3,as+1,4a+a,4x,1j+e,1l+2,1e+3,3+1,1y+2,11+4,2+7,1r,d+1,1h+8,b+3,3,2o+2,3,2+1,7,4h,4+7,m+1,1m+1,4,12+6,4+4,5g+7,3+2,2,o,2d+5,2,5+1,2+1,6n+3,7+1,2+1,s+1,2e+7,3,2+1,2z,2,3+5,2,2u+2,3+3,2+4,78+8,2+1,75+1,2,5,41+3,3+1,5,x+5,3+1,15+5,3+3,9,a+5,3+2,1b+c,2+1,bb+6,2+5,2d+l,3+6,2+1,2+1,3f+5,4,2+1,2+6,2,21+1,4,2,9o+1,f0c+4,1o+6,t5,1s+3,2a,f5l+1,43t+2,i+7,3+6,v+3,45+2,1j0+1i,5+1d,9,f,n+4,2+e,11t+6,2+g,3+6,2+1,2+4,7a+6,c6+3,15t+6,32+6,gzhy+6n",AL:"16w,3,2,e+1b,z+2,2+2s,g+1,8+1,b+m,2+t,s+2i,c+e,4h+f,1d+1e,1bwe+dp,3+3z,x+c,2+1,35+3y,2rm+z,5+7,b+5,dt+l,c+u,17nl+27,1t+27,4x+6n,3+d",LRO:"6ct",RLO:"6cu",LRE:"6cq",RLE:"6cr",PDF:"6cs",LRI:"6ee",RLI:"6ef",FSI:"6eg",PDI:"6eh"},ot={},st={};ot.L=1,st[1]="L",Object.keys(tt).forEach(function(Wn,rr){ot[Wn]=1<<rr+1,st[ot[Wn]]=Wn}),Object.freeze(ot);var at=ot.LRI|ot.RLI|ot.FSI,lt=ot.L|ot.R|ot.AL,dt=ot.B|ot.S|ot.WS|ot.ON|ot.FSI|ot.LRI|ot.RLI|ot.PDI,ht=ot.BN|ot.RLE|ot.LRE|ot.RLO|ot.LRO|ot.PDF,ft=ot.S|ot.WS|ot.B|at|ot.PDI|ht,gt=null;function Et(){if(!gt){gt=new Map;var Wn=function(sr){if(tt.hasOwnProperty(sr)){var ir=0;tt[sr].split(",").forEach(function(kr){var un=kr.split("+"),sn=un[0],Kn=un[1];sn=parseInt(sn,36),Kn=Kn?parseInt(Kn,36):0,gt.set(ir+=sn,ot[sr]);for(var Sr=0;Sr<Kn;Sr++)gt.set(++ir,ot[sr])})}};for(var rr in tt)Wn(rr)}}function yt(Wn){return Et(),gt.get(Wn.codePointAt(0))||ot.L}function Ct(Wn){return st[yt(Wn)]}var wt={pairs:"14>1,1e>2,u>2,2wt>1,1>1,1ge>1,1wp>1,1j>1,f>1,hm>1,1>1,u>1,u6>1,1>1,+5,28>1,w>1,1>1,+3,b8>1,1>1,+3,1>3,-1>-1,3>1,1>1,+2,1s>1,1>1,x>1,th>1,1>1,+2,db>1,1>1,+3,3>1,1>1,+2,14qm>1,1>1,+1,4q>1,1e>2,u>2,2>1,+1",canonical:"6f1>-6dx,6dy>-6dx,6ec>-6ed,6ee>-6ed,6ww>2jj,-2ji>2jj,14r4>-1e7l,1e7m>-1e7l,1e7m>-1e5c,1e5d>-1e5b,1e5c>-14qx,14qy>-14qx,14vn>-1ecg,1ech>-1ecg,1edu>-1ecg,1eci>-1ecg,1eda>-1ecg,1eci>-1ecg,1eci>-168q,168r>-168q,168s>-14ye,14yf>-14ye"};function It(Wn,rr){var sr=36,ir=0,kr=new Map,un=rr&&new Map,sn;return Wn.split(",").forEach(function Kn(Sr){if(Sr.indexOf("+")!==-1)for(var lr=+Sr;lr--;)Kn(sn);else{sn=Sr;var vr=Sr.split(">"),Fr=vr[0],Gr=vr[1];Fr=String.fromCodePoint(ir+=parseInt(Fr,sr)),Gr=String.fromCodePoint(ir+=parseInt(Gr,sr)),kr.set(Fr,Gr),rr&&un.set(Gr,Fr)}}),{map:kr,reverseMap:un}}var Pt,Rt,xt;function Nt(){if(!Pt){var Wn=It(wt.pairs,!0),rr=Wn.map,sr=Wn.reverseMap;Pt=rr,Rt=sr,xt=It(wt.canonical,!1).map}}function kt(Wn){return Nt(),Pt.get(Wn)||null}function Vt(Wn){return Nt(),Rt.get(Wn)||null}function Ft(Wn){return Nt(),xt.get(Wn)||null}var zt=ot.L,Yt=ot.R,Kt=ot.EN,qt=ot.ES,pn=ot.ET,an=ot.AN,fn=ot.CS,dn=ot.B,Cn=ot.S,On=ot.ON,Pn=ot.BN,yn=ot.NSM,An=ot.AL,Sn=ot.LRO,gn=ot.RLO,_n=ot.LRE,Rn=ot.RLE,bn=ot.PDF,jn=ot.LRI,kn=ot.RLI,Gn=ot.FSI,Vn=ot.PDI;function qn(Wn,rr){for(var sr=125,ir=new Uint32Array(Wn.length),kr=0;kr<Wn.length;kr++)ir[kr]=yt(Wn[kr]);var un=new Map;function sn(_u,Cu){var xl=ir[_u];ir[_u]=Cu,un.set(xl,un.get(xl)-1),xl&dt&&un.set(dt,un.get(dt)-1),un.set(Cu,(un.get(Cu)||0)+1),Cu&dt&&un.set(dt,(un.get(dt)||0)+1)}for(var Kn=new Uint8Array(Wn.length),Sr=new Map,lr=[],vr=null,Fr=0;Fr<Wn.length;Fr++)vr||lr.push(vr={start:Fr,end:Wn.length-1,level:rr==="rtl"?1:rr==="ltr"?0:RE(Fr,!1)}),ir[Fr]&dn&&(vr.end=Fr,vr=null);for(var Gr=Rn|_n|gn|Sn|at|Vn|bn|dn,dr=function(_u){return _u+(_u&1?1:2)},Hr=function(_u){return _u+(_u&1?2:1)},zr=0;zr<lr.length;zr++){vr=lr[zr];var Nr=[{_level:vr.level,_override:0,_isolate:0}],Or=void 0,Ur=0,Zr=0,oo=0;un.clear();for(var zn=vr.start;zn<=vr.end;zn++){var ar=ir[zn];if(Or=Nr[Nr.length-1],un.set(ar,(un.get(ar)||0)+1),ar&dt&&un.set(dt,(un.get(dt)||0)+1),ar&Gr)if(ar&(Rn|_n)){Kn[zn]=Or._level;var pr=(ar===Rn?Hr:dr)(Or._level);pr<=sr&&!Ur&&!Zr?Nr.push({_level:pr,_override:0,_isolate:0}):Ur||Zr++}else if(ar&(gn|Sn)){Kn[zn]=Or._level;var Wr=(ar===gn?Hr:dr)(Or._level);Wr<=sr&&!Ur&&!Zr?Nr.push({_level:Wr,_override:ar&gn?Yt:zt,_isolate:0}):Ur||Zr++}else if(ar&at){ar&Gn&&(ar=RE(zn+1,!0)===1?kn:jn),Kn[zn]=Or._level,Or._override&&sn(zn,Or._override);var Qr=(ar===kn?Hr:dr)(Or._level);Qr<=sr&&Ur===0&&Zr===0?(oo++,Nr.push({_level:Qr,_override:0,_isolate:1,_isolInitIndex:zn})):Ur++}else if(ar&Vn){if(Ur>0)Ur--;else if(oo>0){for(Zr=0;!Nr[Nr.length-1]._isolate;)Nr.pop();var ko=Nr[Nr.length-1]._isolInitIndex;ko!=null&&(Sr.set(ko,zn),Sr.set(zn,ko)),Nr.pop(),oo--}Or=Nr[Nr.length-1],Kn[zn]=Or._level,Or._override&&sn(zn,Or._override)}else ar&bn?(Ur===0&&(Zr>0?Zr--:!Or._isolate&&Nr.length>1&&(Nr.pop(),Or=Nr[Nr.length-1])),Kn[zn]=Or._level):ar&dn&&(Kn[zn]=vr.level);else Kn[zn]=Or._level,Or._override&&ar!==Pn&&sn(zn,Or._override)}for(var os=[],Jo=null,ws=vr.start;ws<=vr.end;ws++){var Ms=ir[ws];if(!(Ms&ht)){var ys=Kn[ws],bo=Ms&at,mu=Ms===Vn;Jo&&ys===Jo._level?(Jo._end=ws,Jo._endsWithIsolInit=bo):os.push(Jo={_start:ws,_end:ws,_level:ys,_startsWithPDI:mu,_endsWithIsolInit:bo})}}for(var Xl=[],ss=0;ss<os.length;ss++){var js=os[ss];if(!js._startsWithPDI||js._startsWithPDI&&!Sr.has(js._start)){for(var _l=[Jo=js],Is=void 0;Jo&&Jo._endsWithIsolInit&&(Is=Sr.get(Jo._end))!=null;)for(var vo=ss+1;vo<os.length;vo++)if(os[vo]._start===Is){_l.push(Jo=os[vo]);break}for(var wl=[],ju=0;ju<_l.length;ju++)for(var cn=_l[ju],Xt=cn._start;Xt<=cn._end;Xt++)wl.push(Xt);for(var mn=Kn[wl[0]],Nn=vr.level,In=wl[0]-1;In>=0;In--)if(!(ir[In]&ht)){Nn=Kn[In];break}var Un=wl[wl.length-1],mr=Kn[Un],gr=vr.level;if(!(ir[Un]&at)){for(var br=Un+1;br<=vr.end;br++)if(!(ir[br]&ht)){gr=Kn[br];break}}Xl.push({_seqIndices:wl,_sosType:Math.max(Nn,mn)%2?Yt:zt,_eosType:Math.max(gr,mr)%2?Yt:zt})}}for(var Rr=0;Rr<Xl.length;Rr++){var wr=Xl[Rr],tr=wr._seqIndices,to=wr._sosType,$r=wr._eosType,Yr=Kn[tr[0]]&1?Yt:zt;if(un.get(yn))for(var _o=0;_o<tr.length;_o++){var Ro=tr[_o];if(ir[Ro]&yn){for(var yo=to,eo=_o-1;eo>=0;eo--)if(!(ir[tr[eo]]&ht)){yo=ir[tr[eo]];break}sn(Ro,yo&(at|Vn)?On:yo)}}if(un.get(Kt))for(var Io=0;Io<tr.length;Io++){var fo=tr[Io];if(ir[fo]&Kt)for(var Go=Io-1;Go>=-1;Go--){var Ps=Go===-1?to:ir[tr[Go]];if(Ps&lt){Ps===An&&sn(fo,an);break}}}if(un.get(An))for(var Uo=0;Uo<tr.length;Uo++){var _s=tr[Uo];ir[_s]&An&&sn(_s,Yt)}if(un.get(qt)||un.get(fn))for(var as=1;as<tr.length-1;as++){var ks=tr[as];if(ir[ks]&(qt|fn)){for(var xo=0,$o=0,Xs=as-1;Xs>=0&&(xo=ir[tr[Xs]],!!(xo&ht));Xs--);for(var As=as+1;As<tr.length&&($o=ir[tr[As]],!!($o&ht));As++);xo===$o&&(ir[ks]===qt?xo===Kt:xo&(Kt|an))&&sn(ks,xo)}}if(un.get(Kt))for(var zo=0;zo<tr.length;zo++){var ba=tr[zo];if(ir[ba]&Kt){for(var _d=zo-1;_d>=0&&ir[tr[_d]]&(pn|ht);_d--)sn(tr[_d],Kt);for(zo++;zo<tr.length&&ir[tr[zo]]&(pn|ht|Kt);zo++)ir[tr[zo]]!==Kt&&sn(tr[zo],Kt)}}if(un.get(pn)||un.get(qt)||un.get(fn))for(var Vl=0;Vl<tr.length;Vl++){var dp=tr[Vl];if(ir[dp]&(pn|qt|fn)){sn(dp,On);for(var Lm=Vl-1;Lm>=0&&ir[tr[Lm]]&ht;Lm--)sn(tr[Lm],On);for(var zp=Vl+1;zp<tr.length&&ir[tr[zp]]&ht;zp++)sn(tr[zp],On)}}if(un.get(Kt))for(var cm=0,km=to;cm<tr.length;cm++){var G0=tr[cm],K_=ir[G0];K_&Kt?km===zt&&sn(G0,zt):K_&lt&&(km=K_)}if(un.get(dt)){var Um=Yt|Kt|an,Y_=Um|zt,lm=[];{for(var f_=[],um=0;um<tr.length;um++)if(ir[tr[um]]&dt){var Es=Wn[tr[um]],Av=void 0;if(kt(Es)!==null)if(f_.length<63)f_.push({char:Es,seqIndex:um});else break;else if((Av=Vt(Es))!==null)for(var Bm=f_.length-1;Bm>=0;Bm--){var AE=f_[Bm].char;if(AE===Av||AE===Vt(Ft(Es))||kt(Ft(AE))===Es){lm.push([f_[Bm].seqIndex,um]),f_.length=Bm;break}}}lm.sort(function(_u,Cu){return _u[0]-Cu[0]})}for(var Cv=0;Cv<lm.length;Cv++){for(var bv=lm[Cv],Il=bv[0],X_=bv[1],$0=!1,su=0,Rv=Il+1;Rv<X_;Rv++){var q_=tr[Rv];if(ir[q_]&Y_){$0=!0;var hp=ir[q_]&Um?Yt:zt;if(hp===Yr){su=hp;break}}}if($0&&!su){su=to;for(var wv=Il-1;wv>=0;wv--){var Iv=tr[wv];if(ir[Iv]&Y_){var pp=ir[Iv]&Um?Yt:zt;pp!==Yr?su=pp:su=Yr;break}}}if(su){if(ir[tr[Il]]=ir[tr[X_]]=su,su!==Yr){for(var zu=Il+1;zu<tr.length;zu++)if(!(ir[tr[zu]]&ht)){yt(Wn[tr[zu]])&yn&&(ir[tr[zu]]=su);break}}if(su!==Yr){for(var dm=X_+1;dm<tr.length;dm++)if(!(ir[tr[dm]]&ht)){yt(Wn[tr[dm]])&yn&&(ir[tr[dm]]=su);break}}}}for(var au=0;au<tr.length;au++)if(ir[tr[au]]&dt){for(var Mu=au,CE=au,_h=to,J_=au-1;J_>=0;J_--)if(ir[tr[J_]]&ht)Mu=J_;else{_h=ir[tr[J_]]&Um?Yt:zt;break}for(var Z_=$r,Gl=au+1;Gl<tr.length;Gl++)if(ir[tr[Gl]]&(dt|ht))CE=Gl;else{Z_=ir[tr[Gl]]&Um?Yt:zt;break}for(var Wu=Mu;Wu<=CE;Wu++)ir[tr[Wu]]=_h===Z_?_h:Yr;au=CE}}}for(var gu=vr.start;gu<=vr.end;gu++){var bE=Kn[gu],ep=ir[gu];if(bE&1?ep&(zt|Kt|an)&&Kn[gu]++:ep&Yt?Kn[gu]++:ep&(an|Kt)&&(Kn[gu]+=2),ep&ht&&(Kn[gu]=gu===0?vr.level:Kn[gu-1]),gu===vr.end||yt(Wn[gu])&(Cn|dn))for(var Fm=gu;Fm>=0&&yt(Wn[Fm])&ft;Fm--)Kn[Fm]=vr.level}}return{levels:Kn,paragraphs:lr};function RE(_u,Cu){for(var xl=_u;xl<Wn.length;xl++){var Ol=ir[xl];if(Ol&(Yt|An))return 1;if(Ol&(dn|zt)||Cu&&Ol===Vn)return 0;if(Ol&at){var fp=wE(xl);xl=fp===-1?Wn.length:fp}}return 0}function wE(_u){for(var Cu=1,xl=_u+1;xl<Wn.length;xl++){var Ol=ir[xl];if(Ol&dn)break;if(Ol&Vn){if(--Cu===0)return xl}else Ol&at&&Cu++}return-1}}var Tr="14>1,j>2,t>2,u>2,1a>g,2v3>1,1>1,1ge>1,1wd>1,b>1,1j>1,f>1,ai>3,-2>3,+1,8>1k0,-1jq>1y7,-1y6>1hf,-1he>1h6,-1h5>1ha,-1h8>1qi,-1pu>1,6>3u,-3s>7,6>1,1>1,f>1,1>1,+2,3>1,1>1,+13,4>1,1>1,6>1eo,-1ee>1,3>1mg,-1me>1mk,-1mj>1mi,-1mg>1mi,-1md>1,1>1,+2,1>10k,-103>1,1>1,4>1,5>1,1>1,+10,3>1,1>8,-7>8,+1,-6>7,+1,a>1,1>1,u>1,u6>1,1>1,+5,26>1,1>1,2>1,2>2,8>1,7>1,4>1,1>1,+5,b8>1,1>1,+3,1>3,-2>1,2>1,1>1,+2,c>1,3>1,1>1,+2,h>1,3>1,a>1,1>1,2>1,3>1,1>1,d>1,f>1,3>1,1a>1,1>1,6>1,7>1,13>1,k>1,1>1,+19,4>1,1>1,+2,2>1,1>1,+18,m>1,a>1,1>1,lk>1,1>1,4>1,2>1,f>1,3>1,1>1,+3,db>1,1>1,+3,3>1,1>1,+2,14qm>1,1>1,+1,6>1,4j>1,j>2,t>2,u>2,2>1,+1",Mn;function Zt(){if(!Mn){var Wn=It(Tr,!0),rr=Wn.map,sr=Wn.reverseMap;sr.forEach(function(ir,kr){rr.set(kr,ir)}),Mn=rr}}function wn(Wn){return Zt(),Mn.get(Wn)||null}function xn(Wn,rr,sr,ir){var kr=Wn.length;sr=Math.max(0,sr==null?0:+sr),ir=Math.min(kr-1,ir==null?kr-1:+ir);for(var un=new Map,sn=sr;sn<=ir;sn++)if(rr[sn]&1){var Kn=wn(Wn[sn]);Kn!==null&&un.set(sn,Kn)}return un}function Hn(Wn,rr,sr,ir){var kr=Wn.length;sr=Math.max(0,sr==null?0:+sr),ir=Math.min(kr-1,ir==null?kr-1:+ir);var un=[];return rr.paragraphs.forEach(function(sn){var Kn=Math.max(sr,sn.start),Sr=Math.min(ir,sn.end);if(Kn<Sr){for(var lr=rr.levels.slice(Kn,Sr+1),vr=Sr;vr>=Kn&&yt(Wn[vr])&ft;vr--)lr[vr]=sn.level;for(var Fr=sn.level,Gr=1/0,dr=0;dr<lr.length;dr++){var Hr=lr[dr];Hr>Fr&&(Fr=Hr),Hr<Gr&&(Gr=Hr|1)}for(var zr=Fr;zr>=Gr;zr--)for(var Nr=0;Nr<lr.length;Nr++)if(lr[Nr]>=zr){for(var Or=Nr;Nr+1<lr.length&&lr[Nr+1]>=zr;)Nr++;Nr>Or&&un.push([Or+Kn,Nr+Kn])}}}),un}function Bn(Wn,rr,sr,ir){var kr=cr(Wn,rr,sr,ir),un=[].concat(Wn);return kr.forEach(function(sn,Kn){un[Kn]=(rr.levels[sn]&1?wn(Wn[sn]):null)||Wn[sn]}),un.join("")}function cr(Wn,rr,sr,ir){for(var kr=Hn(Wn,rr,sr,ir),un=[],sn=0;sn<Wn.length;sn++)un[sn]=sn;return kr.forEach(function(Kn){for(var Sr=Kn[0],lr=Kn[1],vr=un.slice(Sr,lr+1),Fr=vr.length;Fr--;)un[lr-Fr]=vr[Fr]}),un}return _.closingToOpeningBracket=Vt,_.getBidiCharType=yt,_.getBidiCharTypeName=Ct,_.getCanonicalBracket=Ft,_.getEmbeddingLevels=qn,_.getMirroredCharacter=wn,_.getMirroredCharactersMap=xn,_.getReorderSegments=Hn,_.getReorderedIndices=cr,_.getReorderedString=Bn,_.openingToClosingBracket=kt,Object.defineProperty(_,"__esModule",{value:!0}),_}({});return nt}const voidMainRegExp=/\bvoid\s+main\s*\(\s*\)\s*{/g;function expandShaderIncludes(nt){const _=/^[ \t]*#include +<([\w\d./]+)>/gm;function tt(ot,st){let at=ShaderChunk[st];return at?expandShaderIncludes(at):ot}return nt.replace(_,tt)}const _lut=[];for(let nt=0;nt<256;nt++)_lut[nt]=(nt<16?"0":"")+nt.toString(16);function generateUUID(){const nt=Math.random()*4294967295|0,_=Math.random()*4294967295|0,tt=Math.random()*4294967295|0,ot=Math.random()*4294967295|0;return(_lut[nt&255]+_lut[nt>>8&255]+_lut[nt>>16&255]+_lut[nt>>24&255]+"-"+_lut[_&255]+_lut[_>>8&255]+"-"+_lut[_>>16&15|64]+_lut[_>>24&255]+"-"+_lut[tt&63|128]+_lut[tt>>8&255]+"-"+_lut[tt>>16&255]+_lut[tt>>24&255]+_lut[ot&255]+_lut[ot>>8&255]+_lut[ot>>16&255]+_lut[ot>>24&255]).toUpperCase()}const assign$3=Object.assign||function(){let nt=arguments[0];for(let _=1,tt=arguments.length;_<tt;_++){let ot=arguments[_];if(ot)for(let st in ot)Object.prototype.hasOwnProperty.call(ot,st)&&(nt[st]=ot[st])}return nt},epoch=Date.now(),CONSTRUCTOR_CACHE=new WeakMap,SHADER_UPGRADE_CACHE=new Map;let materialInstanceId=1e10;function createDerivedMaterial(nt,_){const tt=getKeyForOptions(_);let ot=CONSTRUCTOR_CACHE.get(nt);if(ot||CONSTRUCTOR_CACHE.set(nt,ot=Object.create(null)),ot[tt])return new ot[tt];const st=`_onBeforeCompile${tt}`,at=function(ft,gt){nt.onBeforeCompile.call(this,ft,gt);const Et=this.customProgramCacheKey()+"|"+ft.vertexShader+"|"+ft.fragmentShader;let yt=SHADER_UPGRADE_CACHE[Et];if(!yt){const Ct=upgradeShaders(this,ft,_,tt);yt=SHADER_UPGRADE_CACHE[Et]=Ct}ft.vertexShader=yt.vertexShader,ft.fragmentShader=yt.fragmentShader,assign$3(ft.uniforms,this.uniforms),_.timeUniform&&(ft.uniforms[_.timeUniform]={get value(){return Date.now()-epoch}}),this[st]&&this[st](ft)},lt=function(){return dt(_.chained?nt:nt.clone())},dt=function(ft){const gt=Object.create(ft,ht);return Object.defineProperty(gt,"baseMaterial",{value:nt}),Object.defineProperty(gt,"id",{value:materialInstanceId++}),gt.uuid=generateUUID(),gt.uniforms=assign$3({},ft.uniforms,_.uniforms),gt.defines=assign$3({},ft.defines,_.defines),gt.defines[`TROIKA_DERIVED_MATERIAL_${tt}`]="",gt.extensions=assign$3({},ft.extensions,_.extensions),gt._listeners=void 0,gt},ht={constructor:{value:lt},isDerivedMaterial:{value:!0},customProgramCacheKey:{writable:!0,configurable:!0,value:function(){return nt.customProgramCacheKey()+"|"+tt}},onBeforeCompile:{get(){return at},set(ft){this[st]=ft}},copy:{writable:!0,configurable:!0,value:function(ft){return nt.copy.call(this,ft),!nt.isShaderMaterial&&!nt.isDerivedMaterial&&(assign$3(this.extensions,ft.extensions),assign$3(this.defines,ft.defines),assign$3(this.uniforms,UniformsUtils.clone(ft.uniforms))),this}},clone:{writable:!0,configurable:!0,value:function(){const ft=new nt.constructor;return dt(ft).copy(this)}},getDepthMaterial:{writable:!0,configurable:!0,value:function(){let ft=this._depthMaterial;return ft||(ft=this._depthMaterial=createDerivedMaterial(nt.isDerivedMaterial?nt.getDepthMaterial():new MeshDepthMaterial({depthPacking:RGBADepthPacking}),_),ft.defines.IS_DEPTH_MATERIAL="",ft.uniforms=this.uniforms),ft}},getDistanceMaterial:{writable:!0,configurable:!0,value:function(){let ft=this._distanceMaterial;return ft||(ft=this._distanceMaterial=createDerivedMaterial(nt.isDerivedMaterial?nt.getDistanceMaterial():new MeshDistanceMaterial,_),ft.defines.IS_DISTANCE_MATERIAL="",ft.uniforms=this.uniforms),ft}},dispose:{writable:!0,configurable:!0,value(){const{_depthMaterial:ft,_distanceMaterial:gt}=this;ft&&ft.dispose(),gt&&gt.dispose(),nt.dispose.call(this)}}};return ot[tt]=lt,new lt}function upgradeShaders(nt,{vertexShader:_,fragmentShader:tt},ot,st){let{vertexDefs:at,vertexMainIntro:lt,vertexMainOutro:dt,vertexTransform:ht,fragmentDefs:ft,fragmentMainIntro:gt,fragmentMainOutro:Et,fragmentColorTransform:yt,customRewriter:Ct,timeUniform:wt}=ot;if(at=at||"",lt=lt||"",dt=dt||"",ft=ft||"",gt=gt||"",Et=Et||"",(ht||Ct)&&(_=expandShaderIncludes(_)),(yt||Ct)&&(tt=tt.replace(/^[ \t]*#include <((?:tonemapping|encodings|fog|premultiplied_alpha|dithering)_fragment)>/gm,`
//!BEGIN_POST_CHUNK $1
$&
//!END_POST_CHUNK
`),tt=expandShaderIncludes(tt)),Ct){let It=Ct({vertexShader:_,fragmentShader:tt});_=It.vertexShader,tt=It.fragmentShader}if(yt){let It=[];tt=tt.replace(/^\/\/!BEGIN_POST_CHUNK[^]+?^\/\/!END_POST_CHUNK/gm,Pt=>(It.push(Pt),"")),Et=`${yt}
${It.join(`
`)}
${Et}`}if(wt){const It=`
uniform float ${wt};
`;at=It+at,ft=It+ft}return ht&&(_=`vec3 troika_position_${st};
vec3 troika_normal_${st};
vec2 troika_uv_${st};
${_}
`,at=`${at}
void troikaVertexTransform${st}(inout vec3 position, inout vec3 normal, inout vec2 uv) {
  ${ht}
}
`,lt=`
troika_position_${st} = vec3(position);
troika_normal_${st} = vec3(normal);
troika_uv_${st} = vec2(uv);
troikaVertexTransform${st}(troika_position_${st}, troika_normal_${st}, troika_uv_${st});
${lt}
`,_=_.replace(/\b(position|normal|uv)\b/g,(It,Pt,Rt,xt)=>/\battribute\s+vec[23]\s+$/.test(xt.substr(0,Rt))?Pt:`troika_${Pt}_${st}`),nt.map&&nt.map.channel>0||(_=_.replace(/\bMAP_UV\b/g,`troika_uv_${st}`))),_=injectIntoShaderCode(_,st,at,lt,dt),tt=injectIntoShaderCode(tt,st,ft,gt,Et),{vertexShader:_,fragmentShader:tt}}function injectIntoShaderCode(nt,_,tt,ot,st){return(ot||st||tt)&&(nt=nt.replace(voidMainRegExp,`
${tt}
void troikaOrigMain${_}() {`),nt+=`
void main() {
  ${ot}
  troikaOrigMain${_}();
  ${st}
}`),nt}function optionsJsonReplacer(nt,_){return nt==="uniforms"?void 0:typeof _=="function"?_.toString():_}let _idCtr=0;const optionsHashesToIds=new Map;function getKeyForOptions(nt){const _=JSON.stringify(nt,optionsJsonReplacer);let tt=optionsHashesToIds.get(_);return tt==null&&optionsHashesToIds.set(_,tt=++_idCtr),tt}function createTypesetter(nt,_,tt){const{defaultFontURL:ot}=tt,st=Object.create(null),at=1/0,lt=/[\u00AD\u034F\u061C\u115F-\u1160\u17B4-\u17B5\u180B-\u180E\u200B-\u200F\u202A-\u202E\u2060-\u206F\u3164\uFE00-\uFE0F\uFEFF\uFFA0\uFFF0-\uFFF8]/,dt="[^\\S\\u00A0]",ht=new RegExp(`${dt}|[\\-\\u007C\\u00AD\\u2010\\u2012-\\u2014\\u2027\\u2056\\u2E17\\u2E40]`);function ft(xt,Nt){function kt(){const Vt=Ft=>{console.error(`Failure loading font ${xt}${xt===ot?"":"; trying fallback"}`,Ft),xt!==ot&&(xt=ot,kt())};try{const Ft=new XMLHttpRequest;Ft.open("get",xt,!0),Ft.responseType="arraybuffer",Ft.onload=function(){if(Ft.status>=400)Vt(new Error(Ft.statusText));else if(Ft.status>0)try{const zt=nt(Ft.response);Nt(zt)}catch(zt){Vt(zt)}},Ft.onerror=Vt,Ft.send()}catch(Ft){Vt(Ft)}}kt()}function gt(xt,Nt){xt||(xt=ot);let kt=st[xt];kt?kt.pending?kt.pending.push(Nt):Nt(kt):(st[xt]={pending:[Nt]},ft(xt,Vt=>{let Ft=st[xt].pending;st[xt]=Vt,Ft.forEach(zt=>zt(Vt))}))}function Et({text:xt="",font:Nt=ot,sdfGlyphSize:kt=64,fontSize:Vt=1,letterSpacing:Ft=0,lineHeight:zt="normal",maxWidth:Yt=at,direction:Kt,textAlign:qt="left",textIndent:pn=0,whiteSpace:an="normal",overflowWrap:fn="normal",anchorX:dn=0,anchorY:Cn=0,includeCaretPositions:On=!1,chunkedBoundsSize:Pn=8192,colorRanges:yn=null},An,Sn=!1){const gn=It(),_n={fontLoad:0,typesetting:0};xt.indexOf("\r")>-1&&(console.info("Typesetter: got text with \\r chars; normalizing to \\n"),xt=xt.replace(/\r\n/g,`
`).replace(/\r/g,`
`)),Vt=+Vt,Ft=+Ft,Yt=+Yt,zt=zt||"normal",pn=+pn,gt(Nt,Rn=>{const bn=isFinite(Yt);let jn=null,kn=null,Gn=null,Vn=null,qn=null,Tr=null,Mn=null,Zt=0,wn=0,xn=an!=="nowrap";const{ascender:Hn,descender:Bn,unitsPerEm:cr,lineGap:Wn,capHeight:rr,xHeight:sr}=Rn;_n.fontLoad=It()-gn;const ir=It(),kr=Vt/cr;zt==="normal"&&(zt=(Hn-Bn+Wn)/cr),zt=zt*Vt;const un=(zt-(Hn-Bn)*kr)/2,sn=-(Hn*kr+un),Kn=Math.min(zt,(Hn-Bn)*kr),Sr=(Hn+Bn)/2*kr-Kn/2;let lr=pn,vr=new Pt;const Fr=[vr];Rn.forEachGlyph(xt,Vt,Ft,(Hr,zr,Nr)=>{const Or=xt.charAt(Nr),Ur=Hr.advanceWidth*kr,Zr=vr.count;let oo;if("isEmpty"in Hr||(Hr.isWhitespace=!!Or&&new RegExp(dt).test(Or),Hr.canBreakAfter=!!Or&&ht.test(Or),Hr.isEmpty=Hr.xMin===Hr.xMax||Hr.yMin===Hr.yMax||lt.test(Or)),!Hr.isWhitespace&&!Hr.isEmpty&&wn++,xn&&bn&&!Hr.isWhitespace&&zr+Ur+lr>Yt&&Zr){if(vr.glyphAt(Zr-1).glyphObj.canBreakAfter)oo=new Pt,lr=-zr;else for(let ar=Zr;ar--;)if(ar===0&&fn==="break-word"){oo=new Pt,lr=-zr;break}else if(vr.glyphAt(ar).glyphObj.canBreakAfter){oo=vr.splitAt(ar+1);const pr=oo.glyphAt(0).x;lr-=pr;for(let Wr=oo.count;Wr--;)oo.glyphAt(Wr).x-=pr;break}oo&&(vr.isSoftWrapped=!0,vr=oo,Fr.push(vr),Zt=Yt)}let zn=vr.glyphAt(vr.count);zn.glyphObj=Hr,zn.x=zr+lr,zn.width=Ur,zn.charIndex=Nr,Or===`
`&&(vr=new Pt,Fr.push(vr),lr=-(zr+Ur+Ft*Vt)+pn)}),Fr.forEach(Hr=>{for(let zr=Hr.count;zr--;){let{glyphObj:Nr,x:Or,width:Ur}=Hr.glyphAt(zr);if(!Nr.isWhitespace){Hr.width=Or+Ur,Hr.width>Zt&&(Zt=Hr.width);return}}});let Gr=0,dr=0;if(dn&&(typeof dn=="number"?Gr=-dn:typeof dn=="string"&&(Gr=-Zt*(dn==="left"?0:dn==="center"?.5:dn==="right"?1:Ct(dn)))),Cn){if(typeof Cn=="number")dr=-Cn;else if(typeof Cn=="string"){let Hr=Fr.length*zt;dr=Cn==="top"?0:Cn==="top-baseline"?-sn:Cn==="top-cap"?-sn-rr*kr:Cn==="top-ex"?-sn-sr*kr:Cn==="middle"?Hr/2:Cn==="bottom"?Hr:Cn==="bottom-baseline"?Hr-un+Bn*kr:Ct(Cn)*Hr}}if(!Sn){const Hr=_.getEmbeddingLevels(xt,Kt);jn=new Uint16Array(wn),kn=new Float32Array(wn*2),Gn={},Tr=[at,at,-at,-at],Mn=[];let zr=sn;On&&(qn=new Float32Array(xt.length*3)),yn&&(Vn=new Uint8Array(wn*3));let Nr=0,Or=-1,Ur=-1,Zr,oo;if(Fr.forEach((zn,ar)=>{let{count:pr,width:Wr}=zn;if(pr>0){let Qr=0;for(let ys=pr;ys--&&zn.glyphAt(ys).glyphObj.isWhitespace;)Qr++;let ko=0,os=0;if(qt==="center")ko=(Zt-Wr)/2;else if(qt==="right")ko=Zt-Wr;else if(qt==="justify"&&zn.isSoftWrapped){let ys=0;for(let bo=pr-Qr;bo--;)zn.glyphAt(bo).glyphObj.isWhitespace&&ys++;os=(Zt-Wr)/ys}if(os||ko){let ys=0;for(let bo=0;bo<pr;bo++){let mu=zn.glyphAt(bo);const Xl=mu.glyphObj;mu.x+=ko+ys,os!==0&&Xl.isWhitespace&&bo<pr-Qr&&(ys+=os,mu.width+=os)}}const Jo=_.getReorderSegments(xt,Hr,zn.glyphAt(0).charIndex,zn.glyphAt(zn.count-1).charIndex);for(let ys=0;ys<Jo.length;ys++){const[bo,mu]=Jo[ys];let Xl=1/0,ss=-1/0;for(let js=0;js<pr;js++)if(zn.glyphAt(js).charIndex>=bo){let _l=js,Is=js;for(;Is<pr;Is++){let vo=zn.glyphAt(Is);if(vo.charIndex>mu)break;Is<pr-Qr&&(Xl=Math.min(Xl,vo.x),ss=Math.max(ss,vo.x+vo.width))}for(let vo=_l;vo<Is;vo++){const wl=zn.glyphAt(vo);wl.x=ss-(wl.x+wl.width-Xl)}break}}let ws;const Ms=ys=>ws=ys;for(let ys=0;ys<pr;ys++){let bo=zn.glyphAt(ys);ws=bo.glyphObj;const mu=ws.index,Xl=Hr.levels[bo.charIndex]&1;if(Xl){const ss=_.getMirroredCharacter(xt[bo.charIndex]);ss&&Rn.forEachGlyph(ss,0,0,Ms)}if(On){const{charIndex:ss}=bo,js=bo.x+Gr,_l=bo.x+bo.width+Gr;qn[ss*3]=Xl?_l:js,qn[ss*3+1]=Xl?js:_l,qn[ss*3+2]=zr+Sr+dr;const Is=ss-Or;Is>1&&wt(qn,Or,Is),Or=ss}if(yn){const{charIndex:ss}=bo;for(;ss>Ur;)Ur++,yn.hasOwnProperty(Ur)&&(oo=yn[Ur])}if(!ws.isWhitespace&&!ws.isEmpty){const ss=Nr++;Gn[mu]||(Gn[mu]={path:ws.path,pathBounds:[ws.xMin,ws.yMin,ws.xMax,ws.yMax]});const js=bo.x+Gr,_l=zr+dr;kn[ss*2]=js,kn[ss*2+1]=_l;const Is=js+ws.xMin*kr,vo=_l+ws.yMin*kr,wl=js+ws.xMax*kr,ju=_l+ws.yMax*kr;Is<Tr[0]&&(Tr[0]=Is),vo<Tr[1]&&(Tr[1]=vo),wl>Tr[2]&&(Tr[2]=wl),ju>Tr[3]&&(Tr[3]=ju),ss%Pn===0&&(Zr={start:ss,end:ss,rect:[at,at,-at,-at]},Mn.push(Zr)),Zr.end++;const cn=Zr.rect;if(Is<cn[0]&&(cn[0]=Is),vo<cn[1]&&(cn[1]=vo),wl>cn[2]&&(cn[2]=wl),ju>cn[3]&&(cn[3]=ju),jn[ss]=mu,yn){const Xt=ss*3;Vn[Xt]=oo>>16&255,Vn[Xt+1]=oo>>8&255,Vn[Xt+2]=oo&255}}}}zr-=zt}),qn){const zn=xt.length-Or;zn>1&&wt(qn,Or,zn)}}_n.typesetting=It()-ir,An({glyphIds:jn,glyphPositions:kn,glyphData:Gn,caretPositions:qn,caretHeight:Kn,glyphColors:Vn,chunkedBounds:Mn,fontSize:Vt,unitsPerEm:cr,ascender:Hn*kr,descender:Bn*kr,capHeight:rr*kr,xHeight:sr*kr,lineHeight:zt,topBaseline:sn,blockBounds:[Gr,dr-Fr.length*zt,Gr+Zt,dr],visibleBounds:Tr,timings:_n})})}function yt(xt,Nt){Et(xt,kt=>{const[Vt,Ft,zt,Yt]=kt.blockBounds;Nt({width:zt-Vt,height:Yt-Ft})},{metricsOnly:!0})}function Ct(xt){let Nt=xt.match(/^([\d.]+)%$/),kt=Nt?parseFloat(Nt[1]):NaN;return isNaN(kt)?0:kt/100}function wt(xt,Nt,kt){const Vt=xt[Nt*3],Ft=xt[Nt*3+1],zt=xt[Nt*3+2],Yt=(Ft-Vt)/kt;for(let Kt=0;Kt<kt;Kt++){const qt=(Nt+Kt)*3;xt[qt]=Vt+Yt*Kt,xt[qt+1]=Vt+Yt*(Kt+1),xt[qt+2]=zt}}function It(){return(self.performance||Date).now()}function Pt(){this.data=[]}const Rt=["glyphObj","x","width","charIndex"];return Pt.prototype={width:0,isSoftWrapped:!1,get count(){return Math.ceil(this.data.length/Rt.length)},glyphAt(xt){let Nt=Pt.flyweight;return Nt.data=this.data,Nt.index=xt,Nt},splitAt(xt){let Nt=new Pt;return Nt.data=this.data.splice(xt*Rt.length),Nt}},Pt.flyweight=Rt.reduce((xt,Nt,kt,Vt)=>(Object.defineProperty(xt,Nt,{get(){return this.data[this.index*Rt.length+kt]},set(Ft){this.data[this.index*Rt.length+kt]=Ft}}),xt),{data:null,index:0}),{typeset:Et,measure:yt,loadFont:gt}}const now=()=>(self.performance||Date).now(),mainThreadGenerator=SDFGenerator();let warned;function generateSDF(nt,_,tt,ot,st,at,lt,dt,ht,ft,gt=!0){return gt?generateSDF_GL(nt,_,tt,ot,st,at,lt,dt,ht,ft).then(null,Et=>(warned||(console.warn("WebGL SDF generation failed, falling back to JS",Et),warned=!0),generateSDF_JS_Worker(nt,_,tt,ot,st,at,lt,dt,ht,ft))):generateSDF_JS_Worker(nt,_,tt,ot,st,at,lt,dt,ht,ft)}const queue=[],chunkTimeBudget=5;let timer=0;function nextChunk(){const nt=now();for(;queue.length&&now()-nt<chunkTimeBudget;)queue.shift()();timer=queue.length?setTimeout(nextChunk,0):0}const generateSDF_GL=(...nt)=>new Promise((_,tt)=>{queue.push(()=>{const ot=now();try{mainThreadGenerator.webgl.generateIntoCanvas(...nt),_({timing:now()-ot})}catch(st){tt(st)}}),timer||(timer=setTimeout(nextChunk,0))}),threadCount=4,idleTimeout=2e3,threads={};let callNum=0;function generateSDF_JS_Worker(nt,_,tt,ot,st,at,lt,dt,ht,ft){const gt="TroikaTextSDFGenerator_JS_"+callNum++%threadCount;let Et=threads[gt];return Et||(Et=threads[gt]={workerModule:defineWorkerModule({name:gt,workerId:gt,dependencies:[SDFGenerator,now],init(yt,Ct){const wt=yt().javascript.generate;return function(...It){const Pt=Ct();return{textureData:wt(...It),timing:Ct()-Pt}}},getTransferables(yt){return[yt.textureData.buffer]}}),requests:0,idleTimer:null}),Et.requests++,clearTimeout(Et.idleTimer),Et.workerModule(nt,_,tt,ot,st,at).then(({textureData:yt,timing:Ct})=>{const wt=now(),It=new Uint8Array(yt.length*4);for(let Pt=0;Pt<yt.length;Pt++)It[Pt*4+ft]=yt[Pt];return mainThreadGenerator.webglUtils.renderImageData(lt,It,dt,ht,nt,_,1<<3-ft),Ct+=now()-wt,--Et.requests===0&&(Et.idleTimer=setTimeout(()=>{terminateWorker(gt)},idleTimeout)),{timing:Ct}})}function warmUpSDFCanvas(nt){nt._warm||(mainThreadGenerator.webgl.isSupported(nt),nt._warm=!0)}const resizeWebGLCanvasWithoutClearing=mainThreadGenerator.webglUtils.resizeWebGLCanvasWithoutClearing;/*!
Custom build of Typr.ts (https://github.com/fredli74/Typr.ts) for use in Troika text rendering.
Original MIT license applies: https://github.com/fredli74/Typr.ts/blob/master/LICENSE
*/function typrFactory(){return typeof window>"u"&&(self.window=self),function(nt){var _={parse:function(st){var at=_._bin,lt=new Uint8Array(st);if(at.readASCII(lt,0,4)=="ttcf"){var dt=4;at.readUshort(lt,dt),dt+=2,at.readUshort(lt,dt),dt+=2;var ht=at.readUint(lt,dt);dt+=4;for(var ft=[],gt=0;gt<ht;gt++){var Et=at.readUint(lt,dt);dt+=4,ft.push(_._readFont(lt,Et))}return ft}return[_._readFont(lt,0)]},_readFont:function(st,at){var lt=_._bin,dt=at;lt.readFixed(st,at),at+=4;var ht=lt.readUshort(st,at);at+=2,lt.readUshort(st,at),at+=2,lt.readUshort(st,at),at+=2,lt.readUshort(st,at),at+=2;for(var ft=["cmap","head","hhea","maxp","hmtx","name","OS/2","post","loca","glyf","kern","CFF ","GPOS","GSUB","SVG "],gt={_data:st,_offset:dt},Et={},yt=0;yt<ht;yt++){var Ct=lt.readASCII(st,at,4);at+=4,lt.readUint(st,at),at+=4;var wt=lt.readUint(st,at);at+=4;var It=lt.readUint(st,at);at+=4,Et[Ct]={offset:wt,length:It}}for(yt=0;yt<ft.length;yt++){var Pt=ft[yt];Et[Pt]&&(gt[Pt.trim()]=_[Pt.trim()].parse(st,Et[Pt].offset,Et[Pt].length,gt))}return gt},_tabOffset:function(st,at,lt){for(var dt=_._bin,ht=dt.readUshort(st,lt+4),ft=lt+12,gt=0;gt<ht;gt++){var Et=dt.readASCII(st,ft,4);ft+=4,dt.readUint(st,ft),ft+=4;var yt=dt.readUint(st,ft);if(ft+=4,dt.readUint(st,ft),ft+=4,Et==at)return yt}return 0}};_._bin={readFixed:function(st,at){return(st[at]<<8|st[at+1])+(st[at+2]<<8|st[at+3])/65540},readF2dot14:function(st,at){return _._bin.readShort(st,at)/16384},readInt:function(st,at){return _._bin._view(st).getInt32(at)},readInt8:function(st,at){return _._bin._view(st).getInt8(at)},readShort:function(st,at){return _._bin._view(st).getInt16(at)},readUshort:function(st,at){return _._bin._view(st).getUint16(at)},readUshorts:function(st,at,lt){for(var dt=[],ht=0;ht<lt;ht++)dt.push(_._bin.readUshort(st,at+2*ht));return dt},readUint:function(st,at){return _._bin._view(st).getUint32(at)},readUint64:function(st,at){return 4294967296*_._bin.readUint(st,at)+_._bin.readUint(st,at+4)},readASCII:function(st,at,lt){for(var dt="",ht=0;ht<lt;ht++)dt+=String.fromCharCode(st[at+ht]);return dt},readUnicode:function(st,at,lt){for(var dt="",ht=0;ht<lt;ht++){var ft=st[at++]<<8|st[at++];dt+=String.fromCharCode(ft)}return dt},_tdec:typeof window<"u"&&window.TextDecoder?new window.TextDecoder:null,readUTF8:function(st,at,lt){var dt=_._bin._tdec;return dt&&at==0&&lt==st.length?dt.decode(st):_._bin.readASCII(st,at,lt)},readBytes:function(st,at,lt){for(var dt=[],ht=0;ht<lt;ht++)dt.push(st[at+ht]);return dt},readASCIIArray:function(st,at,lt){for(var dt=[],ht=0;ht<lt;ht++)dt.push(String.fromCharCode(st[at+ht]));return dt},_view:function(st){return st._dataView||(st._dataView=st.buffer?new DataView(st.buffer,st.byteOffset,st.byteLength):new DataView(new Uint8Array(st).buffer))}},_._lctf={},_._lctf.parse=function(st,at,lt,dt,ht){var ft=_._bin,gt={},Et=at;ft.readFixed(st,at),at+=4;var yt=ft.readUshort(st,at);at+=2;var Ct=ft.readUshort(st,at);at+=2;var wt=ft.readUshort(st,at);return at+=2,gt.scriptList=_._lctf.readScriptList(st,Et+yt),gt.featureList=_._lctf.readFeatureList(st,Et+Ct),gt.lookupList=_._lctf.readLookupList(st,Et+wt,ht),gt},_._lctf.readLookupList=function(st,at,lt){var dt=_._bin,ht=at,ft=[],gt=dt.readUshort(st,at);at+=2;for(var Et=0;Et<gt;Et++){var yt=dt.readUshort(st,at);at+=2;var Ct=_._lctf.readLookupTable(st,ht+yt,lt);ft.push(Ct)}return ft},_._lctf.readLookupTable=function(st,at,lt){var dt=_._bin,ht=at,ft={tabs:[]};ft.ltype=dt.readUshort(st,at),at+=2,ft.flag=dt.readUshort(st,at),at+=2;var gt=dt.readUshort(st,at);at+=2;for(var Et=ft.ltype,yt=0;yt<gt;yt++){var Ct=dt.readUshort(st,at);at+=2;var wt=lt(st,Et,ht+Ct,ft);ft.tabs.push(wt)}return ft},_._lctf.numOfOnes=function(st){for(var at=0,lt=0;lt<32;lt++)st>>>lt&1&&at++;return at},_._lctf.readClassDef=function(st,at){var lt=_._bin,dt=[],ht=lt.readUshort(st,at);if(at+=2,ht==1){var ft=lt.readUshort(st,at);at+=2;var gt=lt.readUshort(st,at);at+=2;for(var Et=0;Et<gt;Et++)dt.push(ft+Et),dt.push(ft+Et),dt.push(lt.readUshort(st,at)),at+=2}if(ht==2){var yt=lt.readUshort(st,at);for(at+=2,Et=0;Et<yt;Et++)dt.push(lt.readUshort(st,at)),at+=2,dt.push(lt.readUshort(st,at)),at+=2,dt.push(lt.readUshort(st,at)),at+=2}return dt},_._lctf.getInterval=function(st,at){for(var lt=0;lt<st.length;lt+=3){var dt=st[lt],ht=st[lt+1];if(st[lt+2],dt<=at&&at<=ht)return lt}return-1},_._lctf.readCoverage=function(st,at){var lt=_._bin,dt={};dt.fmt=lt.readUshort(st,at),at+=2;var ht=lt.readUshort(st,at);return at+=2,dt.fmt==1&&(dt.tab=lt.readUshorts(st,at,ht)),dt.fmt==2&&(dt.tab=lt.readUshorts(st,at,3*ht)),dt},_._lctf.coverageIndex=function(st,at){var lt=st.tab;if(st.fmt==1)return lt.indexOf(at);if(st.fmt==2){var dt=_._lctf.getInterval(lt,at);if(dt!=-1)return lt[dt+2]+(at-lt[dt])}return-1},_._lctf.readFeatureList=function(st,at){var lt=_._bin,dt=at,ht=[],ft=lt.readUshort(st,at);at+=2;for(var gt=0;gt<ft;gt++){var Et=lt.readASCII(st,at,4);at+=4;var yt=lt.readUshort(st,at);at+=2;var Ct=_._lctf.readFeatureTable(st,dt+yt);Ct.tag=Et.trim(),ht.push(Ct)}return ht},_._lctf.readFeatureTable=function(st,at){var lt=_._bin,dt=at,ht={},ft=lt.readUshort(st,at);at+=2,ft>0&&(ht.featureParams=dt+ft);var gt=lt.readUshort(st,at);at+=2,ht.tab=[];for(var Et=0;Et<gt;Et++)ht.tab.push(lt.readUshort(st,at+2*Et));return ht},_._lctf.readScriptList=function(st,at){var lt=_._bin,dt=at,ht={},ft=lt.readUshort(st,at);at+=2;for(var gt=0;gt<ft;gt++){var Et=lt.readASCII(st,at,4);at+=4;var yt=lt.readUshort(st,at);at+=2,ht[Et.trim()]=_._lctf.readScriptTable(st,dt+yt)}return ht},_._lctf.readScriptTable=function(st,at){var lt=_._bin,dt=at,ht={},ft=lt.readUshort(st,at);at+=2,ht.default=_._lctf.readLangSysTable(st,dt+ft);var gt=lt.readUshort(st,at);at+=2;for(var Et=0;Et<gt;Et++){var yt=lt.readASCII(st,at,4);at+=4;var Ct=lt.readUshort(st,at);at+=2,ht[yt.trim()]=_._lctf.readLangSysTable(st,dt+Ct)}return ht},_._lctf.readLangSysTable=function(st,at){var lt=_._bin,dt={};lt.readUshort(st,at),at+=2,dt.reqFeature=lt.readUshort(st,at),at+=2;var ht=lt.readUshort(st,at);return at+=2,dt.features=lt.readUshorts(st,at,ht),dt},_.CFF={},_.CFF.parse=function(st,at,lt){var dt=_._bin;(st=new Uint8Array(st.buffer,at,lt))[at=0],st[++at],st[++at],st[++at],at++;var ht=[];at=_.CFF.readIndex(st,at,ht);for(var ft=[],gt=0;gt<ht.length-1;gt++)ft.push(dt.readASCII(st,at+ht[gt],ht[gt+1]-ht[gt]));at+=ht[ht.length-1];var Et=[];at=_.CFF.readIndex(st,at,Et);var yt=[];for(gt=0;gt<Et.length-1;gt++)yt.push(_.CFF.readDict(st,at+Et[gt],at+Et[gt+1]));at+=Et[Et.length-1];var Ct=yt[0],wt=[];at=_.CFF.readIndex(st,at,wt);var It=[];for(gt=0;gt<wt.length-1;gt++)It.push(dt.readASCII(st,at+wt[gt],wt[gt+1]-wt[gt]));if(at+=wt[wt.length-1],_.CFF.readSubrs(st,at,Ct),Ct.CharStrings){at=Ct.CharStrings,wt=[],at=_.CFF.readIndex(st,at,wt);var Pt=[];for(gt=0;gt<wt.length-1;gt++)Pt.push(dt.readBytes(st,at+wt[gt],wt[gt+1]-wt[gt]));Ct.CharStrings=Pt}if(Ct.ROS){at=Ct.FDArray;var Rt=[];for(at=_.CFF.readIndex(st,at,Rt),Ct.FDArray=[],gt=0;gt<Rt.length-1;gt++){var xt=_.CFF.readDict(st,at+Rt[gt],at+Rt[gt+1]);_.CFF._readFDict(st,xt,It),Ct.FDArray.push(xt)}at+=Rt[Rt.length-1],at=Ct.FDSelect,Ct.FDSelect=[];var Nt=st[at];if(at++,Nt!=3)throw Nt;var kt=dt.readUshort(st,at);for(at+=2,gt=0;gt<kt+1;gt++)Ct.FDSelect.push(dt.readUshort(st,at),st[at+2]),at+=3}return Ct.Encoding&&(Ct.Encoding=_.CFF.readEncoding(st,Ct.Encoding,Ct.CharStrings.length)),Ct.charset&&(Ct.charset=_.CFF.readCharset(st,Ct.charset,Ct.CharStrings.length)),_.CFF._readFDict(st,Ct,It),Ct},_.CFF._readFDict=function(st,at,lt){var dt;for(var ht in at.Private&&(dt=at.Private[1],at.Private=_.CFF.readDict(st,dt,dt+at.Private[0]),at.Private.Subrs&&_.CFF.readSubrs(st,dt+at.Private.Subrs,at.Private)),at)["FamilyName","FontName","FullName","Notice","version","Copyright"].indexOf(ht)!=-1&&(at[ht]=lt[at[ht]-426+35])},_.CFF.readSubrs=function(st,at,lt){var dt=_._bin,ht=[];at=_.CFF.readIndex(st,at,ht);var ft,gt=ht.length;ft=gt<1240?107:gt<33900?1131:32768,lt.Bias=ft,lt.Subrs=[];for(var Et=0;Et<ht.length-1;Et++)lt.Subrs.push(dt.readBytes(st,at+ht[Et],ht[Et+1]-ht[Et]))},_.CFF.tableSE=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,0,111,112,113,114,0,115,116,117,118,119,120,121,122,0,123,0,124,125,126,127,128,129,130,131,0,132,133,0,134,135,136,137,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,138,0,139,0,0,0,0,140,141,142,143,0,0,0,0,0,144,0,0,0,145,0,0,146,147,148,149,0,0,0,0],_.CFF.glyphByUnicode=function(st,at){for(var lt=0;lt<st.charset.length;lt++)if(st.charset[lt]==at)return lt;return-1},_.CFF.glyphBySE=function(st,at){return at<0||at>255?-1:_.CFF.glyphByUnicode(st,_.CFF.tableSE[at])},_.CFF.readEncoding=function(st,at,lt){_._bin;var dt=[".notdef"],ht=st[at];if(at++,ht!=0)throw"error: unknown encoding format: "+ht;var ft=st[at];at++;for(var gt=0;gt<ft;gt++)dt.push(st[at+gt]);return dt},_.CFF.readCharset=function(st,at,lt){var dt=_._bin,ht=[".notdef"],ft=st[at];if(at++,ft==0)for(var gt=0;gt<lt;gt++){var Et=dt.readUshort(st,at);at+=2,ht.push(Et)}else{if(ft!=1&&ft!=2)throw"error: format: "+ft;for(;ht.length<lt;){Et=dt.readUshort(st,at),at+=2;var yt=0;for(ft==1?(yt=st[at],at++):(yt=dt.readUshort(st,at),at+=2),gt=0;gt<=yt;gt++)ht.push(Et),Et++}}return ht},_.CFF.readIndex=function(st,at,lt){var dt=_._bin,ht=dt.readUshort(st,at)+1,ft=st[at+=2];if(at++,ft==1)for(var gt=0;gt<ht;gt++)lt.push(st[at+gt]);else if(ft==2)for(gt=0;gt<ht;gt++)lt.push(dt.readUshort(st,at+2*gt));else if(ft==3)for(gt=0;gt<ht;gt++)lt.push(16777215&dt.readUint(st,at+3*gt-1));else if(ht!=1)throw"unsupported offset size: "+ft+", count: "+ht;return(at+=ht*ft)-1},_.CFF.getCharString=function(st,at,lt){var dt=_._bin,ht=st[at],ft=st[at+1];st[at+2],st[at+3],st[at+4];var gt=1,Et=null,yt=null;ht<=20&&(Et=ht,gt=1),ht==12&&(Et=100*ht+ft,gt=2),21<=ht&&ht<=27&&(Et=ht,gt=1),ht==28&&(yt=dt.readShort(st,at+1),gt=3),29<=ht&&ht<=31&&(Et=ht,gt=1),32<=ht&&ht<=246&&(yt=ht-139,gt=1),247<=ht&&ht<=250&&(yt=256*(ht-247)+ft+108,gt=2),251<=ht&&ht<=254&&(yt=256*-(ht-251)-ft-108,gt=2),ht==255&&(yt=dt.readInt(st,at+1)/65535,gt=5),lt.val=yt??"o"+Et,lt.size=gt},_.CFF.readCharString=function(st,at,lt){for(var dt=at+lt,ht=_._bin,ft=[];at<dt;){var gt=st[at],Et=st[at+1];st[at+2],st[at+3],st[at+4];var yt=1,Ct=null,wt=null;gt<=20&&(Ct=gt,yt=1),gt==12&&(Ct=100*gt+Et,yt=2),gt!=19&&gt!=20||(Ct=gt,yt=2),21<=gt&&gt<=27&&(Ct=gt,yt=1),gt==28&&(wt=ht.readShort(st,at+1),yt=3),29<=gt&&gt<=31&&(Ct=gt,yt=1),32<=gt&&gt<=246&&(wt=gt-139,yt=1),247<=gt&&gt<=250&&(wt=256*(gt-247)+Et+108,yt=2),251<=gt&&gt<=254&&(wt=256*-(gt-251)-Et-108,yt=2),gt==255&&(wt=ht.readInt(st,at+1)/65535,yt=5),ft.push(wt??"o"+Ct),at+=yt}return ft},_.CFF.readDict=function(st,at,lt){for(var dt=_._bin,ht={},ft=[];at<lt;){var gt=st[at],Et=st[at+1];st[at+2],st[at+3],st[at+4];var yt=1,Ct=null,wt=null;if(gt==28&&(wt=dt.readShort(st,at+1),yt=3),gt==29&&(wt=dt.readInt(st,at+1),yt=5),32<=gt&&gt<=246&&(wt=gt-139,yt=1),247<=gt&&gt<=250&&(wt=256*(gt-247)+Et+108,yt=2),251<=gt&&gt<=254&&(wt=256*-(gt-251)-Et-108,yt=2),gt==255)throw wt=dt.readInt(st,at+1)/65535,yt=5,"unknown number";if(gt==30){var It=[];for(yt=1;;){var Pt=st[at+yt];yt++;var Rt=Pt>>4,xt=15&Pt;if(Rt!=15&&It.push(Rt),xt!=15&&It.push(xt),xt==15)break}for(var Nt="",kt=[0,1,2,3,4,5,6,7,8,9,".","e","e-","reserved","-","endOfNumber"],Vt=0;Vt<It.length;Vt++)Nt+=kt[It[Vt]];wt=parseFloat(Nt)}gt<=21&&(Ct=["version","Notice","FullName","FamilyName","Weight","FontBBox","BlueValues","OtherBlues","FamilyBlues","FamilyOtherBlues","StdHW","StdVW","escape","UniqueID","XUID","charset","Encoding","CharStrings","Private","Subrs","defaultWidthX","nominalWidthX"][gt],yt=1,gt==12&&(Ct=["Copyright","isFixedPitch","ItalicAngle","UnderlinePosition","UnderlineThickness","PaintType","CharstringType","FontMatrix","StrokeWidth","BlueScale","BlueShift","BlueFuzz","StemSnapH","StemSnapV","ForceBold",0,0,"LanguageGroup","ExpansionFactor","initialRandomSeed","SyntheticBase","PostScript","BaseFontName","BaseFontBlend",0,0,0,0,0,0,"ROS","CIDFontVersion","CIDFontRevision","CIDFontType","CIDCount","UIDBase","FDArray","FDSelect","FontName"][Et],yt=2)),Ct!=null?(ht[Ct]=ft.length==1?ft[0]:ft,ft=[]):ft.push(wt),at+=yt}return ht},_.cmap={},_.cmap.parse=function(st,at,lt){st=new Uint8Array(st.buffer,at,lt),at=0;var dt=_._bin,ht={};dt.readUshort(st,at),at+=2;var ft=dt.readUshort(st,at);at+=2;var gt=[];ht.tables=[];for(var Et=0;Et<ft;Et++){var yt=dt.readUshort(st,at);at+=2;var Ct=dt.readUshort(st,at);at+=2;var wt=dt.readUint(st,at);at+=4;var It="p"+yt+"e"+Ct,Pt=gt.indexOf(wt);if(Pt==-1){var Rt;Pt=ht.tables.length,gt.push(wt);var xt=dt.readUshort(st,wt);xt==0?Rt=_.cmap.parse0(st,wt):xt==4?Rt=_.cmap.parse4(st,wt):xt==6?Rt=_.cmap.parse6(st,wt):xt==12?Rt=_.cmap.parse12(st,wt):console.debug("unknown format: "+xt,yt,Ct,wt),ht.tables.push(Rt)}if(ht[It]!=null)throw"multiple tables for one platform+encoding";ht[It]=Pt}return ht},_.cmap.parse0=function(st,at){var lt=_._bin,dt={};dt.format=lt.readUshort(st,at),at+=2;var ht=lt.readUshort(st,at);at+=2,lt.readUshort(st,at),at+=2,dt.map=[];for(var ft=0;ft<ht-6;ft++)dt.map.push(st[at+ft]);return dt},_.cmap.parse4=function(st,at){var lt=_._bin,dt=at,ht={};ht.format=lt.readUshort(st,at),at+=2;var ft=lt.readUshort(st,at);at+=2,lt.readUshort(st,at),at+=2;var gt=lt.readUshort(st,at);at+=2;var Et=gt/2;ht.searchRange=lt.readUshort(st,at),at+=2,ht.entrySelector=lt.readUshort(st,at),at+=2,ht.rangeShift=lt.readUshort(st,at),at+=2,ht.endCount=lt.readUshorts(st,at,Et),at+=2*Et,at+=2,ht.startCount=lt.readUshorts(st,at,Et),at+=2*Et,ht.idDelta=[];for(var yt=0;yt<Et;yt++)ht.idDelta.push(lt.readShort(st,at)),at+=2;for(ht.idRangeOffset=lt.readUshorts(st,at,Et),at+=2*Et,ht.glyphIdArray=[];at<dt+ft;)ht.glyphIdArray.push(lt.readUshort(st,at)),at+=2;return ht},_.cmap.parse6=function(st,at){var lt=_._bin,dt={};dt.format=lt.readUshort(st,at),at+=2,lt.readUshort(st,at),at+=2,lt.readUshort(st,at),at+=2,dt.firstCode=lt.readUshort(st,at),at+=2;var ht=lt.readUshort(st,at);at+=2,dt.glyphIdArray=[];for(var ft=0;ft<ht;ft++)dt.glyphIdArray.push(lt.readUshort(st,at)),at+=2;return dt},_.cmap.parse12=function(st,at){var lt=_._bin,dt={};dt.format=lt.readUshort(st,at),at+=2,at+=2,lt.readUint(st,at),at+=4,lt.readUint(st,at),at+=4;var ht=lt.readUint(st,at);at+=4,dt.groups=[];for(var ft=0;ft<ht;ft++){var gt=at+12*ft,Et=lt.readUint(st,gt+0),yt=lt.readUint(st,gt+4),Ct=lt.readUint(st,gt+8);dt.groups.push([Et,yt,Ct])}return dt},_.glyf={},_.glyf.parse=function(st,at,lt,dt){for(var ht=[],ft=0;ft<dt.maxp.numGlyphs;ft++)ht.push(null);return ht},_.glyf._parseGlyf=function(st,at){var lt=_._bin,dt=st._data,ht=_._tabOffset(dt,"glyf",st._offset)+st.loca[at];if(st.loca[at]==st.loca[at+1])return null;var ft={};if(ft.noc=lt.readShort(dt,ht),ht+=2,ft.xMin=lt.readShort(dt,ht),ht+=2,ft.yMin=lt.readShort(dt,ht),ht+=2,ft.xMax=lt.readShort(dt,ht),ht+=2,ft.yMax=lt.readShort(dt,ht),ht+=2,ft.xMin>=ft.xMax||ft.yMin>=ft.yMax)return null;if(ft.noc>0){ft.endPts=[];for(var gt=0;gt<ft.noc;gt++)ft.endPts.push(lt.readUshort(dt,ht)),ht+=2;var Et=lt.readUshort(dt,ht);if(ht+=2,dt.length-ht<Et)return null;ft.instructions=lt.readBytes(dt,ht,Et),ht+=Et;var yt=ft.endPts[ft.noc-1]+1;for(ft.flags=[],gt=0;gt<yt;gt++){var Ct=dt[ht];if(ht++,ft.flags.push(Ct),(8&Ct)!=0){var wt=dt[ht];ht++;for(var It=0;It<wt;It++)ft.flags.push(Ct),gt++}}for(ft.xs=[],gt=0;gt<yt;gt++){var Pt=(2&ft.flags[gt])!=0,Rt=(16&ft.flags[gt])!=0;Pt?(ft.xs.push(Rt?dt[ht]:-dt[ht]),ht++):Rt?ft.xs.push(0):(ft.xs.push(lt.readShort(dt,ht)),ht+=2)}for(ft.ys=[],gt=0;gt<yt;gt++)Pt=(4&ft.flags[gt])!=0,Rt=(32&ft.flags[gt])!=0,Pt?(ft.ys.push(Rt?dt[ht]:-dt[ht]),ht++):Rt?ft.ys.push(0):(ft.ys.push(lt.readShort(dt,ht)),ht+=2);var xt=0,Nt=0;for(gt=0;gt<yt;gt++)xt+=ft.xs[gt],Nt+=ft.ys[gt],ft.xs[gt]=xt,ft.ys[gt]=Nt}else{var kt;ft.parts=[];do{kt=lt.readUshort(dt,ht),ht+=2;var Vt={m:{a:1,b:0,c:0,d:1,tx:0,ty:0},p1:-1,p2:-1};if(ft.parts.push(Vt),Vt.glyphIndex=lt.readUshort(dt,ht),ht+=2,1&kt){var Ft=lt.readShort(dt,ht);ht+=2;var zt=lt.readShort(dt,ht);ht+=2}else Ft=lt.readInt8(dt,ht),ht++,zt=lt.readInt8(dt,ht),ht++;2&kt?(Vt.m.tx=Ft,Vt.m.ty=zt):(Vt.p1=Ft,Vt.p2=zt),8&kt?(Vt.m.a=Vt.m.d=lt.readF2dot14(dt,ht),ht+=2):64&kt?(Vt.m.a=lt.readF2dot14(dt,ht),ht+=2,Vt.m.d=lt.readF2dot14(dt,ht),ht+=2):128&kt&&(Vt.m.a=lt.readF2dot14(dt,ht),ht+=2,Vt.m.b=lt.readF2dot14(dt,ht),ht+=2,Vt.m.c=lt.readF2dot14(dt,ht),ht+=2,Vt.m.d=lt.readF2dot14(dt,ht),ht+=2)}while(32&kt);if(256&kt){var Yt=lt.readUshort(dt,ht);for(ht+=2,ft.instr=[],gt=0;gt<Yt;gt++)ft.instr.push(dt[ht]),ht++}}return ft},_.GPOS={},_.GPOS.parse=function(st,at,lt,dt){return _._lctf.parse(st,at,lt,dt,_.GPOS.subt)},_.GPOS.subt=function(st,at,lt,dt){var ht=_._bin,ft=lt,gt={};if(gt.fmt=ht.readUshort(st,lt),lt+=2,at==1||at==2||at==3||at==7||at==8&&gt.fmt<=2){var Et=ht.readUshort(st,lt);lt+=2,gt.coverage=_._lctf.readCoverage(st,Et+ft)}if(at==1&&gt.fmt==1){var yt=ht.readUshort(st,lt);lt+=2;var Ct=_._lctf.numOfOnes(yt);yt!=0&&(gt.pos=_.GPOS.readValueRecord(st,lt,yt))}else if(at==2&&gt.fmt>=1&&gt.fmt<=2){yt=ht.readUshort(st,lt),lt+=2;var wt=ht.readUshort(st,lt);lt+=2,Ct=_._lctf.numOfOnes(yt);var It=_._lctf.numOfOnes(wt);if(gt.fmt==1){gt.pairsets=[];var Pt=ht.readUshort(st,lt);lt+=2;for(var Rt=0;Rt<Pt;Rt++){var xt=ft+ht.readUshort(st,lt);lt+=2;var Nt=ht.readUshort(st,xt);xt+=2;for(var kt=[],Vt=0;Vt<Nt;Vt++){var Ft=ht.readUshort(st,xt);xt+=2,yt!=0&&(an=_.GPOS.readValueRecord(st,xt,yt),xt+=2*Ct),wt!=0&&(fn=_.GPOS.readValueRecord(st,xt,wt),xt+=2*It),kt.push({gid2:Ft,val1:an,val2:fn})}gt.pairsets.push(kt)}}if(gt.fmt==2){var zt=ht.readUshort(st,lt);lt+=2;var Yt=ht.readUshort(st,lt);lt+=2;var Kt=ht.readUshort(st,lt);lt+=2;var qt=ht.readUshort(st,lt);for(lt+=2,gt.classDef1=_._lctf.readClassDef(st,ft+zt),gt.classDef2=_._lctf.readClassDef(st,ft+Yt),gt.matrix=[],Rt=0;Rt<Kt;Rt++){var pn=[];for(Vt=0;Vt<qt;Vt++){var an=null,fn=null;yt!=0&&(an=_.GPOS.readValueRecord(st,lt,yt),lt+=2*Ct),wt!=0&&(fn=_.GPOS.readValueRecord(st,lt,wt),lt+=2*It),pn.push({val1:an,val2:fn})}gt.matrix.push(pn)}}}else{if(at==9&&gt.fmt==1){var dn=ht.readUshort(st,lt);lt+=2;var Cn=ht.readUint(st,lt);if(lt+=4,dt.ltype==9)dt.ltype=dn;else if(dt.ltype!=dn)throw"invalid extension substitution";return _.GPOS.subt(st,dt.ltype,ft+Cn)}console.debug("unsupported GPOS table LookupType",at,"format",gt.fmt)}return gt},_.GPOS.readValueRecord=function(st,at,lt){var dt=_._bin,ht=[];return ht.push(1&lt?dt.readShort(st,at):0),at+=1&lt?2:0,ht.push(2&lt?dt.readShort(st,at):0),at+=2&lt?2:0,ht.push(4&lt?dt.readShort(st,at):0),at+=4&lt?2:0,ht.push(8&lt?dt.readShort(st,at):0),at+=8&lt?2:0,ht},_.GSUB={},_.GSUB.parse=function(st,at,lt,dt){return _._lctf.parse(st,at,lt,dt,_.GSUB.subt)},_.GSUB.subt=function(st,at,lt,dt){var ht=_._bin,ft=lt,gt={};if(gt.fmt=ht.readUshort(st,lt),lt+=2,at!=1&&at!=4&&at!=5&&at!=6)return null;if(at==1||at==4||at==5&&gt.fmt<=2||at==6&&gt.fmt<=2){var Et=ht.readUshort(st,lt);lt+=2,gt.coverage=_._lctf.readCoverage(st,ft+Et)}if(at==1&&gt.fmt>=1&&gt.fmt<=2){if(gt.fmt==1)gt.delta=ht.readShort(st,lt),lt+=2;else if(gt.fmt==2){var yt=ht.readUshort(st,lt);lt+=2,gt.newg=ht.readUshorts(st,lt,yt),lt+=2*gt.newg.length}}else if(at==4){gt.vals=[],yt=ht.readUshort(st,lt),lt+=2;for(var Ct=0;Ct<yt;Ct++){var wt=ht.readUshort(st,lt);lt+=2,gt.vals.push(_.GSUB.readLigatureSet(st,ft+wt))}}else if(at==5&&gt.fmt==2){if(gt.fmt==2){var It=ht.readUshort(st,lt);lt+=2,gt.cDef=_._lctf.readClassDef(st,ft+It),gt.scset=[];var Pt=ht.readUshort(st,lt);for(lt+=2,Ct=0;Ct<Pt;Ct++){var Rt=ht.readUshort(st,lt);lt+=2,gt.scset.push(Rt==0?null:_.GSUB.readSubClassSet(st,ft+Rt))}}}else if(at==6&&gt.fmt==3){if(gt.fmt==3){for(Ct=0;Ct<3;Ct++){yt=ht.readUshort(st,lt),lt+=2;for(var xt=[],Nt=0;Nt<yt;Nt++)xt.push(_._lctf.readCoverage(st,ft+ht.readUshort(st,lt+2*Nt)));lt+=2*yt,Ct==0&&(gt.backCvg=xt),Ct==1&&(gt.inptCvg=xt),Ct==2&&(gt.ahedCvg=xt)}yt=ht.readUshort(st,lt),lt+=2,gt.lookupRec=_.GSUB.readSubstLookupRecords(st,lt,yt)}}else{if(at==7&&gt.fmt==1){var kt=ht.readUshort(st,lt);lt+=2;var Vt=ht.readUint(st,lt);if(lt+=4,dt.ltype==9)dt.ltype=kt;else if(dt.ltype!=kt)throw"invalid extension substitution";return _.GSUB.subt(st,dt.ltype,ft+Vt)}console.debug("unsupported GSUB table LookupType",at,"format",gt.fmt)}return gt},_.GSUB.readSubClassSet=function(st,at){var lt=_._bin.readUshort,dt=at,ht=[],ft=lt(st,at);at+=2;for(var gt=0;gt<ft;gt++){var Et=lt(st,at);at+=2,ht.push(_.GSUB.readSubClassRule(st,dt+Et))}return ht},_.GSUB.readSubClassRule=function(st,at){var lt=_._bin.readUshort,dt={},ht=lt(st,at),ft=lt(st,at+=2);at+=2,dt.input=[];for(var gt=0;gt<ht-1;gt++)dt.input.push(lt(st,at)),at+=2;return dt.substLookupRecords=_.GSUB.readSubstLookupRecords(st,at,ft),dt},_.GSUB.readSubstLookupRecords=function(st,at,lt){for(var dt=_._bin.readUshort,ht=[],ft=0;ft<lt;ft++)ht.push(dt(st,at),dt(st,at+2)),at+=4;return ht},_.GSUB.readChainSubClassSet=function(st,at){var lt=_._bin,dt=at,ht=[],ft=lt.readUshort(st,at);at+=2;for(var gt=0;gt<ft;gt++){var Et=lt.readUshort(st,at);at+=2,ht.push(_.GSUB.readChainSubClassRule(st,dt+Et))}return ht},_.GSUB.readChainSubClassRule=function(st,at){for(var lt=_._bin,dt={},ht=["backtrack","input","lookahead"],ft=0;ft<ht.length;ft++){var gt=lt.readUshort(st,at);at+=2,ft==1&&gt--,dt[ht[ft]]=lt.readUshorts(st,at,gt),at+=2*dt[ht[ft]].length}return gt=lt.readUshort(st,at),at+=2,dt.subst=lt.readUshorts(st,at,2*gt),at+=2*dt.subst.length,dt},_.GSUB.readLigatureSet=function(st,at){var lt=_._bin,dt=at,ht=[],ft=lt.readUshort(st,at);at+=2;for(var gt=0;gt<ft;gt++){var Et=lt.readUshort(st,at);at+=2,ht.push(_.GSUB.readLigature(st,dt+Et))}return ht},_.GSUB.readLigature=function(st,at){var lt=_._bin,dt={chain:[]};dt.nglyph=lt.readUshort(st,at),at+=2;var ht=lt.readUshort(st,at);at+=2;for(var ft=0;ft<ht-1;ft++)dt.chain.push(lt.readUshort(st,at)),at+=2;return dt},_.head={},_.head.parse=function(st,at,lt){var dt=_._bin,ht={};return dt.readFixed(st,at),at+=4,ht.fontRevision=dt.readFixed(st,at),at+=4,dt.readUint(st,at),at+=4,dt.readUint(st,at),at+=4,ht.flags=dt.readUshort(st,at),at+=2,ht.unitsPerEm=dt.readUshort(st,at),at+=2,ht.created=dt.readUint64(st,at),at+=8,ht.modified=dt.readUint64(st,at),at+=8,ht.xMin=dt.readShort(st,at),at+=2,ht.yMin=dt.readShort(st,at),at+=2,ht.xMax=dt.readShort(st,at),at+=2,ht.yMax=dt.readShort(st,at),at+=2,ht.macStyle=dt.readUshort(st,at),at+=2,ht.lowestRecPPEM=dt.readUshort(st,at),at+=2,ht.fontDirectionHint=dt.readShort(st,at),at+=2,ht.indexToLocFormat=dt.readShort(st,at),at+=2,ht.glyphDataFormat=dt.readShort(st,at),at+=2,ht},_.hhea={},_.hhea.parse=function(st,at,lt){var dt=_._bin,ht={};return dt.readFixed(st,at),at+=4,ht.ascender=dt.readShort(st,at),at+=2,ht.descender=dt.readShort(st,at),at+=2,ht.lineGap=dt.readShort(st,at),at+=2,ht.advanceWidthMax=dt.readUshort(st,at),at+=2,ht.minLeftSideBearing=dt.readShort(st,at),at+=2,ht.minRightSideBearing=dt.readShort(st,at),at+=2,ht.xMaxExtent=dt.readShort(st,at),at+=2,ht.caretSlopeRise=dt.readShort(st,at),at+=2,ht.caretSlopeRun=dt.readShort(st,at),at+=2,ht.caretOffset=dt.readShort(st,at),at+=2,at+=8,ht.metricDataFormat=dt.readShort(st,at),at+=2,ht.numberOfHMetrics=dt.readUshort(st,at),at+=2,ht},_.hmtx={},_.hmtx.parse=function(st,at,lt,dt){for(var ht=_._bin,ft={aWidth:[],lsBearing:[]},gt=0,Et=0,yt=0;yt<dt.maxp.numGlyphs;yt++)yt<dt.hhea.numberOfHMetrics&&(gt=ht.readUshort(st,at),at+=2,Et=ht.readShort(st,at),at+=2),ft.aWidth.push(gt),ft.lsBearing.push(Et);return ft},_.kern={},_.kern.parse=function(st,at,lt,dt){var ht=_._bin,ft=ht.readUshort(st,at);if(at+=2,ft==1)return _.kern.parseV1(st,at-2,lt,dt);var gt=ht.readUshort(st,at);at+=2;for(var Et={glyph1:[],rval:[]},yt=0;yt<gt;yt++){at+=2,lt=ht.readUshort(st,at),at+=2;var Ct=ht.readUshort(st,at);at+=2;var wt=Ct>>>8;if((wt&=15)!=0)throw"unknown kern table format: "+wt;at=_.kern.readFormat0(st,at,Et)}return Et},_.kern.parseV1=function(st,at,lt,dt){var ht=_._bin;ht.readFixed(st,at),at+=4;var ft=ht.readUint(st,at);at+=4;for(var gt={glyph1:[],rval:[]},Et=0;Et<ft;Et++){ht.readUint(st,at),at+=4;var yt=ht.readUshort(st,at);at+=2,ht.readUshort(st,at),at+=2;var Ct=yt>>>8;if((Ct&=15)!=0)throw"unknown kern table format: "+Ct;at=_.kern.readFormat0(st,at,gt)}return gt},_.kern.readFormat0=function(st,at,lt){var dt=_._bin,ht=-1,ft=dt.readUshort(st,at);at+=2,dt.readUshort(st,at),at+=2,dt.readUshort(st,at),at+=2,dt.readUshort(st,at),at+=2;for(var gt=0;gt<ft;gt++){var Et=dt.readUshort(st,at);at+=2;var yt=dt.readUshort(st,at);at+=2;var Ct=dt.readShort(st,at);at+=2,Et!=ht&&(lt.glyph1.push(Et),lt.rval.push({glyph2:[],vals:[]}));var wt=lt.rval[lt.rval.length-1];wt.glyph2.push(yt),wt.vals.push(Ct),ht=Et}return at},_.loca={},_.loca.parse=function(st,at,lt,dt){var ht=_._bin,ft=[],gt=dt.head.indexToLocFormat,Et=dt.maxp.numGlyphs+1;if(gt==0)for(var yt=0;yt<Et;yt++)ft.push(ht.readUshort(st,at+(yt<<1))<<1);if(gt==1)for(yt=0;yt<Et;yt++)ft.push(ht.readUint(st,at+(yt<<2)));return ft},_.maxp={},_.maxp.parse=function(st,at,lt){var dt=_._bin,ht={},ft=dt.readUint(st,at);return at+=4,ht.numGlyphs=dt.readUshort(st,at),at+=2,ft==65536&&(ht.maxPoints=dt.readUshort(st,at),at+=2,ht.maxContours=dt.readUshort(st,at),at+=2,ht.maxCompositePoints=dt.readUshort(st,at),at+=2,ht.maxCompositeContours=dt.readUshort(st,at),at+=2,ht.maxZones=dt.readUshort(st,at),at+=2,ht.maxTwilightPoints=dt.readUshort(st,at),at+=2,ht.maxStorage=dt.readUshort(st,at),at+=2,ht.maxFunctionDefs=dt.readUshort(st,at),at+=2,ht.maxInstructionDefs=dt.readUshort(st,at),at+=2,ht.maxStackElements=dt.readUshort(st,at),at+=2,ht.maxSizeOfInstructions=dt.readUshort(st,at),at+=2,ht.maxComponentElements=dt.readUshort(st,at),at+=2,ht.maxComponentDepth=dt.readUshort(st,at),at+=2),ht},_.name={},_.name.parse=function(st,at,lt){var dt=_._bin,ht={};dt.readUshort(st,at),at+=2;var ft=dt.readUshort(st,at);at+=2,dt.readUshort(st,at);for(var gt,Et=["copyright","fontFamily","fontSubfamily","ID","fullName","version","postScriptName","trademark","manufacturer","designer","description","urlVendor","urlDesigner","licence","licenceURL","---","typoFamilyName","typoSubfamilyName","compatibleFull","sampleText","postScriptCID","wwsFamilyName","wwsSubfamilyName","lightPalette","darkPalette"],yt=at+=2,Ct=0;Ct<ft;Ct++){var wt=dt.readUshort(st,at);at+=2;var It=dt.readUshort(st,at);at+=2;var Pt=dt.readUshort(st,at);at+=2;var Rt=dt.readUshort(st,at);at+=2;var xt=dt.readUshort(st,at);at+=2;var Nt=dt.readUshort(st,at);at+=2;var kt,Vt=Et[Rt],Ft=yt+12*ft+Nt;if(wt==0)kt=dt.readUnicode(st,Ft,xt/2);else if(wt==3&&It==0)kt=dt.readUnicode(st,Ft,xt/2);else if(It==0)kt=dt.readASCII(st,Ft,xt);else if(It==1)kt=dt.readUnicode(st,Ft,xt/2);else if(It==3)kt=dt.readUnicode(st,Ft,xt/2);else{if(wt!=1)throw"unknown encoding "+It+", platformID: "+wt;kt=dt.readASCII(st,Ft,xt),console.debug("reading unknown MAC encoding "+It+" as ASCII")}var zt="p"+wt+","+Pt.toString(16);ht[zt]==null&&(ht[zt]={}),ht[zt][Vt!==void 0?Vt:Rt]=kt,ht[zt]._lang=Pt}for(var Yt in ht)if(ht[Yt].postScriptName!=null&&ht[Yt]._lang==1033)return ht[Yt];for(var Yt in ht)if(ht[Yt].postScriptName!=null&&ht[Yt]._lang==0)return ht[Yt];for(var Yt in ht)if(ht[Yt].postScriptName!=null&&ht[Yt]._lang==3084)return ht[Yt];for(var Yt in ht)if(ht[Yt].postScriptName!=null)return ht[Yt];for(var Yt in ht){gt=Yt;break}return console.debug("returning name table with languageID "+ht[gt]._lang),ht[gt]},_["OS/2"]={},_["OS/2"].parse=function(st,at,lt){var dt=_._bin.readUshort(st,at);at+=2;var ht={};if(dt==0)_["OS/2"].version0(st,at,ht);else if(dt==1)_["OS/2"].version1(st,at,ht);else if(dt==2||dt==3||dt==4)_["OS/2"].version2(st,at,ht);else{if(dt!=5)throw"unknown OS/2 table version: "+dt;_["OS/2"].version5(st,at,ht)}return ht},_["OS/2"].version0=function(st,at,lt){var dt=_._bin;return lt.xAvgCharWidth=dt.readShort(st,at),at+=2,lt.usWeightClass=dt.readUshort(st,at),at+=2,lt.usWidthClass=dt.readUshort(st,at),at+=2,lt.fsType=dt.readUshort(st,at),at+=2,lt.ySubscriptXSize=dt.readShort(st,at),at+=2,lt.ySubscriptYSize=dt.readShort(st,at),at+=2,lt.ySubscriptXOffset=dt.readShort(st,at),at+=2,lt.ySubscriptYOffset=dt.readShort(st,at),at+=2,lt.ySuperscriptXSize=dt.readShort(st,at),at+=2,lt.ySuperscriptYSize=dt.readShort(st,at),at+=2,lt.ySuperscriptXOffset=dt.readShort(st,at),at+=2,lt.ySuperscriptYOffset=dt.readShort(st,at),at+=2,lt.yStrikeoutSize=dt.readShort(st,at),at+=2,lt.yStrikeoutPosition=dt.readShort(st,at),at+=2,lt.sFamilyClass=dt.readShort(st,at),at+=2,lt.panose=dt.readBytes(st,at,10),at+=10,lt.ulUnicodeRange1=dt.readUint(st,at),at+=4,lt.ulUnicodeRange2=dt.readUint(st,at),at+=4,lt.ulUnicodeRange3=dt.readUint(st,at),at+=4,lt.ulUnicodeRange4=dt.readUint(st,at),at+=4,lt.achVendID=[dt.readInt8(st,at),dt.readInt8(st,at+1),dt.readInt8(st,at+2),dt.readInt8(st,at+3)],at+=4,lt.fsSelection=dt.readUshort(st,at),at+=2,lt.usFirstCharIndex=dt.readUshort(st,at),at+=2,lt.usLastCharIndex=dt.readUshort(st,at),at+=2,lt.sTypoAscender=dt.readShort(st,at),at+=2,lt.sTypoDescender=dt.readShort(st,at),at+=2,lt.sTypoLineGap=dt.readShort(st,at),at+=2,lt.usWinAscent=dt.readUshort(st,at),at+=2,lt.usWinDescent=dt.readUshort(st,at),at+=2},_["OS/2"].version1=function(st,at,lt){var dt=_._bin;return at=_["OS/2"].version0(st,at,lt),lt.ulCodePageRange1=dt.readUint(st,at),at+=4,lt.ulCodePageRange2=dt.readUint(st,at),at+=4},_["OS/2"].version2=function(st,at,lt){var dt=_._bin;return at=_["OS/2"].version1(st,at,lt),lt.sxHeight=dt.readShort(st,at),at+=2,lt.sCapHeight=dt.readShort(st,at),at+=2,lt.usDefault=dt.readUshort(st,at),at+=2,lt.usBreak=dt.readUshort(st,at),at+=2,lt.usMaxContext=dt.readUshort(st,at),at+=2},_["OS/2"].version5=function(st,at,lt){var dt=_._bin;return at=_["OS/2"].version2(st,at,lt),lt.usLowerOpticalPointSize=dt.readUshort(st,at),at+=2,lt.usUpperOpticalPointSize=dt.readUshort(st,at),at+=2},_.post={},_.post.parse=function(st,at,lt){var dt=_._bin,ht={};return ht.version=dt.readFixed(st,at),at+=4,ht.italicAngle=dt.readFixed(st,at),at+=4,ht.underlinePosition=dt.readShort(st,at),at+=2,ht.underlineThickness=dt.readShort(st,at),at+=2,ht},_==null&&(_={}),_.U==null&&(_.U={}),_.U.codeToGlyph=function(st,at){var lt=st.cmap,dt=-1;if(lt.p0e4!=null?dt=lt.p0e4:lt.p3e1!=null?dt=lt.p3e1:lt.p1e0!=null?dt=lt.p1e0:lt.p0e3!=null&&(dt=lt.p0e3),dt==-1)throw"no familiar platform and encoding!";var ht=lt.tables[dt];if(ht.format==0)return at>=ht.map.length?0:ht.map[at];if(ht.format==4){for(var ft=-1,gt=0;gt<ht.endCount.length;gt++)if(at<=ht.endCount[gt]){ft=gt;break}return ft==-1||ht.startCount[ft]>at?0:65535&(ht.idRangeOffset[ft]!=0?ht.glyphIdArray[at-ht.startCount[ft]+(ht.idRangeOffset[ft]>>1)-(ht.idRangeOffset.length-ft)]:at+ht.idDelta[ft])}if(ht.format==12){if(at>ht.groups[ht.groups.length-1][1])return 0;for(gt=0;gt<ht.groups.length;gt++){var Et=ht.groups[gt];if(Et[0]<=at&&at<=Et[1])return Et[2]+(at-Et[0])}return 0}throw"unknown cmap table format "+ht.format},_.U.glyphToPath=function(st,at){var lt={cmds:[],crds:[]};if(st.SVG&&st.SVG.entries[at]){var dt=st.SVG.entries[at];return dt==null?lt:(typeof dt=="string"&&(dt=_.SVG.toPath(dt),st.SVG.entries[at]=dt),dt)}if(st.CFF){var ht={x:0,y:0,stack:[],nStems:0,haveWidth:!1,width:st.CFF.Private?st.CFF.Private.defaultWidthX:0,open:!1},ft=st.CFF,gt=st.CFF.Private;if(ft.ROS){for(var Et=0;ft.FDSelect[Et+2]<=at;)Et+=2;gt=ft.FDArray[ft.FDSelect[Et+1]].Private}_.U._drawCFF(st.CFF.CharStrings[at],ht,ft,gt,lt)}else st.glyf&&_.U._drawGlyf(at,st,lt);return lt},_.U._drawGlyf=function(st,at,lt){var dt=at.glyf[st];dt==null&&(dt=at.glyf[st]=_.glyf._parseGlyf(at,st)),dt!=null&&(dt.noc>-1?_.U._simpleGlyph(dt,lt):_.U._compoGlyph(dt,at,lt))},_.U._simpleGlyph=function(st,at){for(var lt=0;lt<st.noc;lt++){for(var dt=lt==0?0:st.endPts[lt-1]+1,ht=st.endPts[lt],ft=dt;ft<=ht;ft++){var gt=ft==dt?ht:ft-1,Et=ft==ht?dt:ft+1,yt=1&st.flags[ft],Ct=1&st.flags[gt],wt=1&st.flags[Et],It=st.xs[ft],Pt=st.ys[ft];if(ft==dt)if(yt){if(!Ct){_.U.P.moveTo(at,It,Pt);continue}_.U.P.moveTo(at,st.xs[gt],st.ys[gt])}else Ct?_.U.P.moveTo(at,st.xs[gt],st.ys[gt]):_.U.P.moveTo(at,(st.xs[gt]+It)/2,(st.ys[gt]+Pt)/2);yt?Ct&&_.U.P.lineTo(at,It,Pt):wt?_.U.P.qcurveTo(at,It,Pt,st.xs[Et],st.ys[Et]):_.U.P.qcurveTo(at,It,Pt,(It+st.xs[Et])/2,(Pt+st.ys[Et])/2)}_.U.P.closePath(at)}},_.U._compoGlyph=function(st,at,lt){for(var dt=0;dt<st.parts.length;dt++){var ht={cmds:[],crds:[]},ft=st.parts[dt];_.U._drawGlyf(ft.glyphIndex,at,ht);for(var gt=ft.m,Et=0;Et<ht.crds.length;Et+=2){var yt=ht.crds[Et],Ct=ht.crds[Et+1];lt.crds.push(yt*gt.a+Ct*gt.b+gt.tx),lt.crds.push(yt*gt.c+Ct*gt.d+gt.ty)}for(Et=0;Et<ht.cmds.length;Et++)lt.cmds.push(ht.cmds[Et])}},_.U._getGlyphClass=function(st,at){var lt=_._lctf.getInterval(at,st);return lt==-1?0:at[lt+2]},_.U.getPairAdjustment=function(st,at,lt){var dt=!1;if(st.GPOS)for(var ht=st.GPOS,ft=ht.lookupList,gt=ht.featureList,Et=[],yt=0;yt<gt.length;yt++){var Ct=gt[yt];if(Ct.tag=="kern"){dt=!0;for(var wt=0;wt<Ct.tab.length;wt++)if(!Et[Ct.tab[wt]]){Et[Ct.tab[wt]]=!0;for(var It=ft[Ct.tab[wt]],Pt=0;Pt<It.tabs.length;Pt++)if(It.tabs[Pt]!=null){var Rt,xt=It.tabs[Pt];if((!xt.coverage||(Rt=_._lctf.coverageIndex(xt.coverage,at))!=-1)&&It.ltype!=1){if(It.ltype==2){var Nt=null;if(xt.fmt==1){var kt=xt.pairsets[Rt];for(yt=0;yt<kt.length;yt++)kt[yt].gid2==lt&&(Nt=kt[yt])}else if(xt.fmt==2){var Vt=_.U._getGlyphClass(at,xt.classDef1),Ft=_.U._getGlyphClass(lt,xt.classDef2);Nt=xt.matrix[Vt][Ft]}if(Nt){var zt=0;return Nt.val1&&Nt.val1[2]&&(zt+=Nt.val1[2]),Nt.val2&&Nt.val2[0]&&(zt+=Nt.val2[0]),zt}}}}}}}if(st.kern&&!dt){var Yt=st.kern.glyph1.indexOf(at);if(Yt!=-1){var Kt=st.kern.rval[Yt].glyph2.indexOf(lt);if(Kt!=-1)return st.kern.rval[Yt].vals[Kt]}}return 0},_.U._applySubs=function(st,at,lt,dt){for(var ht=st.length-at-1,ft=0;ft<lt.tabs.length;ft++)if(lt.tabs[ft]!=null){var gt,Et=lt.tabs[ft];if(!Et.coverage||(gt=_._lctf.coverageIndex(Et.coverage,st[at]))!=-1){if(lt.ltype==1)st[at],Et.fmt==1?st[at]=st[at]+Et.delta:st[at]=Et.newg[gt];else if(lt.ltype==4)for(var yt=Et.vals[gt],Ct=0;Ct<yt.length;Ct++){var wt=yt[Ct],It=wt.chain.length;if(!(It>ht)){for(var Pt=!0,Rt=0,xt=0;xt<It;xt++){for(;st[at+Rt+(1+xt)]==-1;)Rt++;wt.chain[xt]!=st[at+Rt+(1+xt)]&&(Pt=!1)}if(Pt){for(st[at]=wt.nglyph,xt=0;xt<It+Rt;xt++)st[at+xt+1]=-1;break}}}else if(lt.ltype==5&&Et.fmt==2)for(var Nt=_._lctf.getInterval(Et.cDef,st[at]),kt=Et.cDef[Nt+2],Vt=Et.scset[kt],Ft=0;Ft<Vt.length;Ft++){var zt=Vt[Ft],Yt=zt.input;if(!(Yt.length>ht)){for(Pt=!0,xt=0;xt<Yt.length;xt++){var Kt=_._lctf.getInterval(Et.cDef,st[at+1+xt]);if(Nt==-1&&Et.cDef[Kt+2]!=Yt[xt]){Pt=!1;break}}if(Pt){var qt=zt.substLookupRecords;for(Ct=0;Ct<qt.length;Ct+=2)qt[Ct],qt[Ct+1]}}}else if(lt.ltype==6&&Et.fmt==3){if(!_.U._glsCovered(st,Et.backCvg,at-Et.backCvg.length)||!_.U._glsCovered(st,Et.inptCvg,at)||!_.U._glsCovered(st,Et.ahedCvg,at+Et.inptCvg.length))continue;var pn=Et.lookupRec;for(Ft=0;Ft<pn.length;Ft+=2){Nt=pn[Ft];var an=dt[pn[Ft+1]];_.U._applySubs(st,at+Nt,an,dt)}}}}},_.U._glsCovered=function(st,at,lt){for(var dt=0;dt<at.length;dt++)if(_._lctf.coverageIndex(at[dt],st[lt+dt])==-1)return!1;return!0},_.U.glyphsToPath=function(st,at,lt){for(var dt={cmds:[],crds:[]},ht=0,ft=0;ft<at.length;ft++){var gt=at[ft];if(gt!=-1){for(var Et=ft<at.length-1&&at[ft+1]!=-1?at[ft+1]:0,yt=_.U.glyphToPath(st,gt),Ct=0;Ct<yt.crds.length;Ct+=2)dt.crds.push(yt.crds[Ct]+ht),dt.crds.push(yt.crds[Ct+1]);for(lt&&dt.cmds.push(lt),Ct=0;Ct<yt.cmds.length;Ct++)dt.cmds.push(yt.cmds[Ct]);lt&&dt.cmds.push("X"),ht+=st.hmtx.aWidth[gt],ft<at.length-1&&(ht+=_.U.getPairAdjustment(st,gt,Et))}}return dt},_.U.P={},_.U.P.moveTo=function(st,at,lt){st.cmds.push("M"),st.crds.push(at,lt)},_.U.P.lineTo=function(st,at,lt){st.cmds.push("L"),st.crds.push(at,lt)},_.U.P.curveTo=function(st,at,lt,dt,ht,ft,gt){st.cmds.push("C"),st.crds.push(at,lt,dt,ht,ft,gt)},_.U.P.qcurveTo=function(st,at,lt,dt,ht){st.cmds.push("Q"),st.crds.push(at,lt,dt,ht)},_.U.P.closePath=function(st){st.cmds.push("Z")},_.U._drawCFF=function(st,at,lt,dt,ht){for(var ft=at.stack,gt=at.nStems,Et=at.haveWidth,yt=at.width,Ct=at.open,wt=0,It=at.x,Pt=at.y,Rt=0,xt=0,Nt=0,kt=0,Vt=0,Ft=0,zt=0,Yt=0,Kt=0,qt=0,pn={val:0,size:0};wt<st.length;){_.CFF.getCharString(st,wt,pn);var an=pn.val;if(wt+=pn.size,an=="o1"||an=="o18")ft.length%2!=0&&!Et&&(yt=ft.shift()+dt.nominalWidthX),gt+=ft.length>>1,ft.length=0,Et=!0;else if(an=="o3"||an=="o23")ft.length%2!=0&&!Et&&(yt=ft.shift()+dt.nominalWidthX),gt+=ft.length>>1,ft.length=0,Et=!0;else if(an=="o4")ft.length>1&&!Et&&(yt=ft.shift()+dt.nominalWidthX,Et=!0),Ct&&_.U.P.closePath(ht),Pt+=ft.pop(),_.U.P.moveTo(ht,It,Pt),Ct=!0;else if(an=="o5")for(;ft.length>0;)It+=ft.shift(),Pt+=ft.shift(),_.U.P.lineTo(ht,It,Pt);else if(an=="o6"||an=="o7")for(var fn=ft.length,dn=an=="o6",Cn=0;Cn<fn;Cn++){var On=ft.shift();dn?It+=On:Pt+=On,dn=!dn,_.U.P.lineTo(ht,It,Pt)}else if(an=="o8"||an=="o24"){fn=ft.length;for(var Pn=0;Pn+6<=fn;)Rt=It+ft.shift(),xt=Pt+ft.shift(),Nt=Rt+ft.shift(),kt=xt+ft.shift(),It=Nt+ft.shift(),Pt=kt+ft.shift(),_.U.P.curveTo(ht,Rt,xt,Nt,kt,It,Pt),Pn+=6;an=="o24"&&(It+=ft.shift(),Pt+=ft.shift(),_.U.P.lineTo(ht,It,Pt))}else{if(an=="o11")break;if(an=="o1234"||an=="o1235"||an=="o1236"||an=="o1237")an=="o1234"&&(xt=Pt,Nt=(Rt=It+ft.shift())+ft.shift(),qt=kt=xt+ft.shift(),Ft=kt,Yt=Pt,It=(zt=(Vt=(Kt=Nt+ft.shift())+ft.shift())+ft.shift())+ft.shift(),_.U.P.curveTo(ht,Rt,xt,Nt,kt,Kt,qt),_.U.P.curveTo(ht,Vt,Ft,zt,Yt,It,Pt)),an=="o1235"&&(Rt=It+ft.shift(),xt=Pt+ft.shift(),Nt=Rt+ft.shift(),kt=xt+ft.shift(),Kt=Nt+ft.shift(),qt=kt+ft.shift(),Vt=Kt+ft.shift(),Ft=qt+ft.shift(),zt=Vt+ft.shift(),Yt=Ft+ft.shift(),It=zt+ft.shift(),Pt=Yt+ft.shift(),ft.shift(),_.U.P.curveTo(ht,Rt,xt,Nt,kt,Kt,qt),_.U.P.curveTo(ht,Vt,Ft,zt,Yt,It,Pt)),an=="o1236"&&(Rt=It+ft.shift(),xt=Pt+ft.shift(),Nt=Rt+ft.shift(),qt=kt=xt+ft.shift(),Ft=kt,zt=(Vt=(Kt=Nt+ft.shift())+ft.shift())+ft.shift(),Yt=Ft+ft.shift(),It=zt+ft.shift(),_.U.P.curveTo(ht,Rt,xt,Nt,kt,Kt,qt),_.U.P.curveTo(ht,Vt,Ft,zt,Yt,It,Pt)),an=="o1237"&&(Rt=It+ft.shift(),xt=Pt+ft.shift(),Nt=Rt+ft.shift(),kt=xt+ft.shift(),Kt=Nt+ft.shift(),qt=kt+ft.shift(),Vt=Kt+ft.shift(),Ft=qt+ft.shift(),zt=Vt+ft.shift(),Yt=Ft+ft.shift(),Math.abs(zt-It)>Math.abs(Yt-Pt)?It=zt+ft.shift():Pt=Yt+ft.shift(),_.U.P.curveTo(ht,Rt,xt,Nt,kt,Kt,qt),_.U.P.curveTo(ht,Vt,Ft,zt,Yt,It,Pt));else if(an=="o14"){if(ft.length>0&&!Et&&(yt=ft.shift()+lt.nominalWidthX,Et=!0),ft.length==4){var yn=ft.shift(),An=ft.shift(),Sn=ft.shift(),gn=ft.shift(),_n=_.CFF.glyphBySE(lt,Sn),Rn=_.CFF.glyphBySE(lt,gn);_.U._drawCFF(lt.CharStrings[_n],at,lt,dt,ht),at.x=yn,at.y=An,_.U._drawCFF(lt.CharStrings[Rn],at,lt,dt,ht)}Ct&&(_.U.P.closePath(ht),Ct=!1)}else if(an=="o19"||an=="o20")ft.length%2!=0&&!Et&&(yt=ft.shift()+dt.nominalWidthX),gt+=ft.length>>1,ft.length=0,Et=!0,wt+=gt+7>>3;else if(an=="o21")ft.length>2&&!Et&&(yt=ft.shift()+dt.nominalWidthX,Et=!0),Pt+=ft.pop(),It+=ft.pop(),Ct&&_.U.P.closePath(ht),_.U.P.moveTo(ht,It,Pt),Ct=!0;else if(an=="o22")ft.length>1&&!Et&&(yt=ft.shift()+dt.nominalWidthX,Et=!0),It+=ft.pop(),Ct&&_.U.P.closePath(ht),_.U.P.moveTo(ht,It,Pt),Ct=!0;else if(an=="o25"){for(;ft.length>6;)It+=ft.shift(),Pt+=ft.shift(),_.U.P.lineTo(ht,It,Pt);Rt=It+ft.shift(),xt=Pt+ft.shift(),Nt=Rt+ft.shift(),kt=xt+ft.shift(),It=Nt+ft.shift(),Pt=kt+ft.shift(),_.U.P.curveTo(ht,Rt,xt,Nt,kt,It,Pt)}else if(an=="o26")for(ft.length%2&&(It+=ft.shift());ft.length>0;)Rt=It,xt=Pt+ft.shift(),It=Nt=Rt+ft.shift(),Pt=(kt=xt+ft.shift())+ft.shift(),_.U.P.curveTo(ht,Rt,xt,Nt,kt,It,Pt);else if(an=="o27")for(ft.length%2&&(Pt+=ft.shift());ft.length>0;)xt=Pt,Nt=(Rt=It+ft.shift())+ft.shift(),kt=xt+ft.shift(),It=Nt+ft.shift(),Pt=kt,_.U.P.curveTo(ht,Rt,xt,Nt,kt,It,Pt);else if(an=="o10"||an=="o29"){var bn=an=="o10"?dt:lt;if(ft.length==0)console.debug("error: empty stack");else{var jn=ft.pop(),kn=bn.Subrs[jn+bn.Bias];at.x=It,at.y=Pt,at.nStems=gt,at.haveWidth=Et,at.width=yt,at.open=Ct,_.U._drawCFF(kn,at,lt,dt,ht),It=at.x,Pt=at.y,gt=at.nStems,Et=at.haveWidth,yt=at.width,Ct=at.open}}else if(an=="o30"||an=="o31"){var Gn=ft.length,Vn=(Pn=0,an=="o31");for(Pn+=Gn-(fn=-3&Gn);Pn<fn;)Vn?(xt=Pt,Nt=(Rt=It+ft.shift())+ft.shift(),Pt=(kt=xt+ft.shift())+ft.shift(),fn-Pn==5?(It=Nt+ft.shift(),Pn++):It=Nt,Vn=!1):(Rt=It,xt=Pt+ft.shift(),Nt=Rt+ft.shift(),kt=xt+ft.shift(),It=Nt+ft.shift(),fn-Pn==5?(Pt=kt+ft.shift(),Pn++):Pt=kt,Vn=!0),_.U.P.curveTo(ht,Rt,xt,Nt,kt,It,Pt),Pn+=4}else{if((an+"").charAt(0)=="o")throw console.debug("Unknown operation: "+an,st),an;ft.push(an)}}}at.x=It,at.y=Pt,at.nStems=gt,at.haveWidth=Et,at.width=yt,at.open=Ct};var tt=_,ot={Typr:tt};return nt.Typr=tt,nt.default=ot,Object.defineProperty(nt,"__esModule",{value:!0}),nt}({}).Typr}/*!
Custom bundle of woff2otf (https://github.com/arty-name/woff2otf) with fflate
(https://github.com/101arrowz/fflate) for use in Troika text rendering. 
Original licenses apply: 
- fflate: https://github.com/101arrowz/fflate/blob/master/LICENSE (MIT)
- woff2otf.js: https://github.com/arty-name/woff2otf/blob/master/woff2otf.js (Apache2)
*/function woff2otfFactory(){return function(nt){var _=Uint8Array,tt=Uint16Array,ot=Uint32Array,st=new _([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),at=new _([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),lt=new _([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),dt=function(an,fn){for(var dn=new tt(31),Cn=0;Cn<31;++Cn)dn[Cn]=fn+=1<<an[Cn-1];var On=new ot(dn[30]);for(Cn=1;Cn<30;++Cn)for(var Pn=dn[Cn];Pn<dn[Cn+1];++Pn)On[Pn]=Pn-dn[Cn]<<5|Cn;return[dn,On]},ht=dt(st,2),ft=ht[0],gt=ht[1];ft[28]=258,gt[258]=28;for(var Et=dt(at,0)[0],yt=new tt(32768),Ct=0;Ct<32768;++Ct){var wt=(43690&Ct)>>>1|(21845&Ct)<<1;wt=(61680&(wt=(52428&wt)>>>2|(13107&wt)<<2))>>>4|(3855&wt)<<4,yt[Ct]=((65280&wt)>>>8|(255&wt)<<8)>>>1}var It=function(an,fn,dn){for(var Cn=an.length,On=0,Pn=new tt(fn);On<Cn;++On)++Pn[an[On]-1];var yn,An=new tt(fn);for(On=0;On<fn;++On)An[On]=An[On-1]+Pn[On-1]<<1;if(dn){yn=new tt(1<<fn);var Sn=15-fn;for(On=0;On<Cn;++On)if(an[On])for(var gn=On<<4|an[On],_n=fn-an[On],Rn=An[an[On]-1]++<<_n,bn=Rn|(1<<_n)-1;Rn<=bn;++Rn)yn[yt[Rn]>>>Sn]=gn}else for(yn=new tt(Cn),On=0;On<Cn;++On)an[On]&&(yn[On]=yt[An[an[On]-1]++]>>>15-an[On]);return yn},Pt=new _(288);for(Ct=0;Ct<144;++Ct)Pt[Ct]=8;for(Ct=144;Ct<256;++Ct)Pt[Ct]=9;for(Ct=256;Ct<280;++Ct)Pt[Ct]=7;for(Ct=280;Ct<288;++Ct)Pt[Ct]=8;var Rt=new _(32);for(Ct=0;Ct<32;++Ct)Rt[Ct]=5;var xt=It(Pt,9,1),Nt=It(Rt,5,1),kt=function(an){for(var fn=an[0],dn=1;dn<an.length;++dn)an[dn]>fn&&(fn=an[dn]);return fn},Vt=function(an,fn,dn){var Cn=fn/8|0;return(an[Cn]|an[Cn+1]<<8)>>(7&fn)&dn},Ft=function(an,fn){var dn=fn/8|0;return(an[dn]|an[dn+1]<<8|an[dn+2]<<16)>>(7&fn)},zt=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],Yt=function(an,fn,dn){var Cn=new Error(fn||zt[an]);if(Cn.code=an,Error.captureStackTrace&&Error.captureStackTrace(Cn,Yt),!dn)throw Cn;return Cn},Kt=function(an,fn,dn){var Cn=an.length;if(!Cn||dn&&!dn.l&&Cn<5)return fn||new _(0);var On=!fn||dn,Pn=!dn||dn.i;dn||(dn={}),fn||(fn=new _(3*Cn));var yn,An=function(Or){var Ur=fn.length;if(Or>Ur){var Zr=new _(Math.max(2*Ur,Or));Zr.set(fn),fn=Zr}},Sn=dn.f||0,gn=dn.p||0,_n=dn.b||0,Rn=dn.l,bn=dn.d,jn=dn.m,kn=dn.n,Gn=8*Cn;do{if(!Rn){dn.f=Sn=Vt(an,gn,1);var Vn=Vt(an,gn+1,3);if(gn+=3,!Vn){var qn=an[(sr=((yn=gn)/8|0)+(7&yn&&1)+4)-4]|an[sr-3]<<8,Tr=sr+qn;if(Tr>Cn){Pn&&Yt(0);break}On&&An(_n+qn),fn.set(an.subarray(sr,Tr),_n),dn.b=_n+=qn,dn.p=gn=8*Tr;continue}if(Vn==1)Rn=xt,bn=Nt,jn=9,kn=5;else if(Vn==2){var Mn=Vt(an,gn,31)+257,Zt=Vt(an,gn+10,15)+4,wn=Mn+Vt(an,gn+5,31)+1;gn+=14;for(var xn=new _(wn),Hn=new _(19),Bn=0;Bn<Zt;++Bn)Hn[lt[Bn]]=Vt(an,gn+3*Bn,7);gn+=3*Zt;var cr=kt(Hn),Wn=(1<<cr)-1,rr=It(Hn,cr,1);for(Bn=0;Bn<wn;){var sr,ir=rr[Vt(an,gn,Wn)];if(gn+=15&ir,(sr=ir>>>4)<16)xn[Bn++]=sr;else{var kr=0,un=0;for(sr==16?(un=3+Vt(an,gn,3),gn+=2,kr=xn[Bn-1]):sr==17?(un=3+Vt(an,gn,7),gn+=3):sr==18&&(un=11+Vt(an,gn,127),gn+=7);un--;)xn[Bn++]=kr}}var sn=xn.subarray(0,Mn),Kn=xn.subarray(Mn);jn=kt(sn),kn=kt(Kn),Rn=It(sn,jn,1),bn=It(Kn,kn,1)}else Yt(1);if(gn>Gn){Pn&&Yt(0);break}}On&&An(_n+131072);for(var Sr=(1<<jn)-1,lr=(1<<kn)-1,vr=gn;;vr=gn){var Fr=(kr=Rn[Ft(an,gn)&Sr])>>>4;if((gn+=15&kr)>Gn){Pn&&Yt(0);break}if(kr||Yt(2),Fr<256)fn[_n++]=Fr;else{if(Fr==256){vr=gn,Rn=null;break}var Gr=Fr-254;if(Fr>264){var dr=st[Bn=Fr-257];Gr=Vt(an,gn,(1<<dr)-1)+ft[Bn],gn+=dr}var Hr=bn[Ft(an,gn)&lr],zr=Hr>>>4;if(Hr||Yt(3),gn+=15&Hr,Kn=Et[zr],zr>3&&(dr=at[zr],Kn+=Ft(an,gn)&(1<<dr)-1,gn+=dr),gn>Gn){Pn&&Yt(0);break}On&&An(_n+131072);for(var Nr=_n+Gr;_n<Nr;_n+=4)fn[_n]=fn[_n-Kn],fn[_n+1]=fn[_n+1-Kn],fn[_n+2]=fn[_n+2-Kn],fn[_n+3]=fn[_n+3-Kn];_n=Nr}}dn.l=Rn,dn.p=vr,dn.b=_n,Rn&&(Sn=1,dn.m=jn,dn.d=bn,dn.n=kn)}while(!Sn);return _n==fn.length?fn:function(Or,Ur,Zr){(Ur==null||Ur<0)&&(Ur=0),(Zr==null||Zr>Or.length)&&(Zr=Or.length);var oo=new(Or instanceof tt?tt:Or instanceof ot?ot:_)(Zr-Ur);return oo.set(Or.subarray(Ur,Zr)),oo}(fn,0,_n)},qt=new _(0),pn=typeof TextDecoder<"u"&&new TextDecoder;try{pn.decode(qt,{stream:!0})}catch{}return nt.convert_streams=function(an){var fn=new DataView(an),dn=0;function Cn(){var Mn=fn.getUint16(dn);return dn+=2,Mn}function On(){var Mn=fn.getUint32(dn);return dn+=4,Mn}function Pn(Mn){qn.setUint16(Tr,Mn),Tr+=2}function yn(Mn){qn.setUint32(Tr,Mn),Tr+=4}for(var An={signature:On(),flavor:On(),length:On(),numTables:Cn(),reserved:Cn(),totalSfntSize:On(),majorVersion:Cn(),minorVersion:Cn(),metaOffset:On(),metaLength:On(),metaOrigLength:On(),privOffset:On(),privLength:On()},Sn=0;Math.pow(2,Sn)<=An.numTables;)Sn++;Sn--;for(var gn=16*Math.pow(2,Sn),_n=16*An.numTables-gn,Rn=12,bn=[],jn=0;jn<An.numTables;jn++)bn.push({tag:On(),offset:On(),compLength:On(),origLength:On(),origChecksum:On()}),Rn+=16;var kn,Gn=new Uint8Array(12+16*bn.length+bn.reduce(function(Mn,Zt){return Mn+Zt.origLength+4},0)),Vn=Gn.buffer,qn=new DataView(Vn),Tr=0;return yn(An.flavor),Pn(An.numTables),Pn(gn),Pn(Sn),Pn(_n),bn.forEach(function(Mn){yn(Mn.tag),yn(Mn.origChecksum),yn(Rn),yn(Mn.origLength),Mn.outOffset=Rn,(Rn+=Mn.origLength)%4!=0&&(Rn+=4-Rn%4)}),bn.forEach(function(Mn){var Zt,wn=an.slice(Mn.offset,Mn.offset+Mn.compLength);if(Mn.compLength!=Mn.origLength){var xn=new Uint8Array(Mn.origLength);Zt=new Uint8Array(wn,2),Kt(Zt,xn)}else xn=new Uint8Array(wn);Gn.set(xn,Mn.outOffset);var Hn=0;(Rn=Mn.outOffset+Mn.origLength)%4!=0&&(Hn=4-Rn%4),Gn.set(new Uint8Array(Hn).buffer,Mn.outOffset+Mn.origLength),kn=Rn+Hn}),Vn.slice(0,kn)},Object.defineProperty(nt,"__esModule",{value:!0}),nt}({}).convert_streams}function parserFactory(nt,_){const tt={M:2,L:2,Q:4,C:6,Z:0},ot={C:"18g,ca,368,1kz",D:"17k,6,2,2+4,5+c,2+6,2+1,10+1,9+f,j+11,2+1,a,2,2+1,15+2,3,j+2,6+3,2+8,2,2,2+1,w+a,4+e,3+3,2,3+2,3+5,23+w,2f+4,3,2+9,2,b,2+3,3,1k+9,6+1,3+1,2+2,2+d,30g,p+y,1,1+1g,f+x,2,sd2+1d,jf3+4,f+3,2+4,2+2,b+3,42,2,4+2,2+1,2,3,t+1,9f+w,2,el+2,2+g,d+2,2l,2+1,5,3+1,2+1,2,3,6,16wm+1v",R:"17m+3,2,2,6+3,m,15+2,2+2,h+h,13,3+8,2,2,3+1,2,p+1,x,5+4,5,a,2,2,3,u,c+2,g+1,5,2+1,4+1,5j,6+1,2,b,2+2,f,2+1,1s+2,2,3+1,7,1ez0,2,2+1,4+4,b,4,3,b,42,2+2,4,3,2+1,2,o+3,ae,ep,x,2o+2,3+1,3,5+1,6",L:"x9u,jff,a,fd,jv",T:"4t,gj+33,7o+4,1+1,7c+18,2,2+1,2+1,2,21+a,2,1b+k,h,2u+6,3+5,3+1,2+3,y,2,v+q,2k+a,1n+8,a,p+3,2+8,2+2,2+4,18+2,3c+e,2+v,1k,2,5+7,5,4+6,b+1,u,1n,5+3,9,l+1,r,3+1,1m,5+1,5+1,3+2,4,v+1,4,c+1,1m,5+4,2+1,5,l+1,n+5,2,1n,3,2+3,9,8+1,c+1,v,1q,d,1f,4,1m+2,6+2,2+3,8+1,c+1,u,1n,3,7,6+1,l+1,t+1,1m+1,5+3,9,l+1,u,21,8+2,2,2j,3+6,d+7,2r,3+8,c+5,23+1,s,2,2,1k+d,2+4,2+1,6+a,2+z,a,2v+3,2+5,2+1,3+1,q+1,5+2,h+3,e,3+1,7,g,jk+2,qb+2,u+2,u+1,v+1,1t+1,2+6,9,3+a,a,1a+2,3c+1,z,3b+2,5+1,a,7+2,64+1,3,1n,2+6,2,2,3+7,7+9,3,1d+d,1,1+1,1s+3,1d,2+4,2,6,15+8,d+1,x+3,3+1,2+2,1l,2+1,4,2+2,1n+7,3+1,49+2,2+c,2+6,5,7,4+1,5j+1l,2+4,ek,3+1,r+4,1e+4,6+5,2p+c,1+3,1,1+2,1+b,2db+2,3y,2p+v,ff+3,30+1,n9x,1+2,2+9,x+1,29+1,7l,4,5,q+1,6,48+1,r+h,e,13+7,q+a,1b+2,1d,3+3,3+1,14,1w+5,3+1,3+1,d,9,1c,1g,2+2,3+1,6+1,2,17+1,9,6n,3,5,fn5,ki+f,h+f,5s,6y+2,ea,6b,46+4,1af+2,2+1,6+3,15+2,5,4m+1,fy+3,as+1,4a+a,4x,1j+e,1l+2,1e+3,3+1,1y+2,11+4,2+7,1r,d+1,1h+8,b+3,3,2o+2,3,2+1,7,4h,4+7,m+1,1m+1,4,12+6,4+4,5g+7,3+2,2,o,2d+5,2,5+1,2+1,6n+3,7+1,2+1,s+1,2e+7,3,2+1,2z,2,3+5,2,2u+2,3+3,2+4,78+8,2+1,75+1,2,5,41+3,3+1,5,x+9,15+5,3+3,9,a+5,3+2,1b+c,2+1,bb+6,2+5,2,2b+l,3+6,2+1,2+1,3f+5,4,2+1,2+6,2,21+1,4,2,9o+1,470+8,at4+4,1o+6,t5,1s+3,2a,f5l+1,2+3,43o+2,a+7,1+7,3+6,v+3,45+2,1j0+1i,5+1d,9,f,n+4,2+e,11t+6,2+g,3+6,2+1,2+4,7a+6,c6+3,15t+6,32+6,1,gzau,v+2n,3l+6n"},st=1,at=2,lt=4,dt=8,ht=16,ft=32;let gt;function Et(Vt){if(!gt){const Ft={R:at,L:st,D:lt,C:ht,U:ft,T:dt};gt=new Map;for(let zt in ot){let Yt=0;ot[zt].split(",").forEach(Kt=>{let[qt,pn]=Kt.split("+");qt=parseInt(qt,36),pn=pn?parseInt(pn,36):0,gt.set(Yt+=qt,Ft[zt]);for(let an=pn;an--;)gt.set(++Yt,Ft[zt])})}}return gt.get(Vt)||ft}const yt=1,Ct=2,wt=3,It=4,Pt=[null,"isol","init","fina","medi"];function Rt(Vt){const Ft=new Uint8Array(Vt.length);let zt=ft,Yt=yt,Kt=-1;for(let qt=0;qt<Vt.length;qt++){const pn=Vt.codePointAt(qt);let an=Et(pn)|0,fn=yt;an&dt||(zt&(st|lt|ht)?an&(at|lt|ht)?(fn=wt,(Yt===yt||Yt===wt)&&Ft[Kt]++):an&(st|ft)&&(Yt===Ct||Yt===It)&&Ft[Kt]--:zt&(at|ft)&&(Yt===Ct||Yt===It)&&Ft[Kt]--,Yt=Ft[qt]=fn,zt=an,Kt=qt,pn>65535&&qt++)}return Ft}function xt(Vt,Ft){const zt=[];for(let Kt=0;Kt<Ft.length;Kt++){const qt=Ft.codePointAt(Kt);qt>65535&&Kt++,zt.push(nt.U.codeToGlyph(Vt,qt))}const Yt=Vt.GSUB;if(Yt){const{lookupList:Kt,featureList:qt}=Yt;let pn;const an=/^(rlig|liga|mset|isol|init|fina|medi|half|pres|blws)$/,fn=[];qt.forEach(dn=>{if(an.test(dn.tag))for(let Cn=0;Cn<dn.tab.length;Cn++){if(fn[dn.tab[Cn]])continue;fn[dn.tab[Cn]]=!0;const On=Kt[dn.tab[Cn]],Pn=/^(isol|init|fina|medi)$/.test(dn.tag);Pn&&!pn&&(pn=Rt(Ft));for(let yn=0;yn<zt.length;yn++)(!pn||!Pn||Pt[pn[yn]]===dn.tag)&&nt.U._applySubs(zt,yn,On,Kt)}})}return zt}function Nt(...Vt){for(let Ft=0;Ft<Vt.length;Ft++)if(typeof Vt[Ft]=="number")return Vt[Ft]}function kt(Vt){const Ft=Object.create(null),zt=Vt["OS/2"],Yt=Vt.hhea,Kt=Vt.head.unitsPerEm,qt=Nt(zt&&zt.sTypoAscender,Yt&&Yt.ascender,Kt),pn={unitsPerEm:Kt,ascender:qt,descender:Nt(zt&&zt.sTypoDescender,Yt&&Yt.descender,0),capHeight:Nt(zt&&zt.sCapHeight,qt),xHeight:Nt(zt&&zt.sxHeight,qt),lineGap:Nt(zt&&zt.sTypoLineGap,Yt&&Yt.lineGap),forEachGlyph(an,fn,dn,Cn){let On=0;const Pn=1/pn.unitsPerEm*fn,yn=xt(Vt,an);let An=0,Sn=-1;return yn.forEach((gn,_n)=>{if(gn!==-1){let Rn=Ft[gn];if(!Rn){const{cmds:bn,crds:jn}=nt.U.glyphToPath(Vt,gn);let kn="",Gn=0;for(let Zt=0,wn=bn.length;Zt<wn;Zt++){const xn=tt[bn[Zt]];kn+=bn[Zt];for(let Hn=1;Hn<=xn;Hn++)kn+=(Hn>1?",":"")+jn[Gn++]}let Vn,qn,Tr,Mn;if(jn.length){Vn=qn=1/0,Tr=Mn=-1/0;for(let Zt=0,wn=jn.length;Zt<wn;Zt+=2){let xn=jn[Zt],Hn=jn[Zt+1];xn<Vn&&(Vn=xn),Hn<qn&&(qn=Hn),xn>Tr&&(Tr=xn),Hn>Mn&&(Mn=Hn)}}else Vn=Tr=qn=Mn=0;Rn=Ft[gn]={index:gn,advanceWidth:Vt.hmtx.aWidth[gn],xMin:Vn,yMin:qn,xMax:Tr,yMax:Mn,path:kn,pathCommandCount:bn.length}}Sn!==-1&&(On+=nt.U.getPairAdjustment(Vt,Sn,gn)*Pn),Cn.call(null,Rn,On,An),Rn.advanceWidth&&(On+=Rn.advanceWidth*Pn),dn&&(On+=dn*fn),Sn=gn}An+=an.codePointAt(An)>65535?2:1}),On}};return pn}return function(Ft){const zt=new Uint8Array(Ft,0,4),Yt=nt._bin.readASCII(zt,0,4);if(Yt==="wOFF")Ft=_(Ft);else if(Yt==="wOF2")throw new Error("woff2 fonts not supported");return kt(nt.parse(Ft)[0])}}const workerModule=defineWorkerModule({name:"Typr Font Parser",dependencies:[typrFactory,woff2otfFactory,parserFactory],init(nt,_,tt){const ot=nt(),st=_();return tt(ot,st)}}),CONFIG={defaultFontURL:"https://fonts.gstatic.com/s/roboto/v18/KFOmCnqEu92Fr1Mu4mxM.woff",sdfGlyphSize:64,sdfMargin:1/16,sdfExponent:9,textureWidth:2048},tempColor=new Color$1;function now$1(){return(self.performance||Date).now()}const atlases=Object.create(null);function getTextRenderInfo(nt,_){nt=assign$2({},nt);const tt=now$1();if(nt.font=toAbsoluteURL(nt.font||CONFIG.defaultFontURL),nt.text=""+nt.text,nt.sdfGlyphSize=nt.sdfGlyphSize||CONFIG.sdfGlyphSize,nt.colorRanges!=null){let Et={};for(let yt in nt.colorRanges)if(nt.colorRanges.hasOwnProperty(yt)){let Ct=nt.colorRanges[yt];typeof Ct!="number"&&(Ct=tempColor.set(Ct).getHex()),Et[yt]=Ct}nt.colorRanges=Et}Object.freeze(nt);const{textureWidth:ot,sdfExponent:st}=CONFIG,{sdfGlyphSize:at}=nt,lt=ot/at*4;let dt=atlases[at];if(!dt){const Et=document.createElement("canvas");Et.width=ot,Et.height=at*256/lt,dt=atlases[at]={glyphCount:0,sdfGlyphSize:at,sdfCanvas:Et,sdfTexture:new Texture(Et,void 0,void 0,void 0,LinearFilter,LinearFilter),contextLost:!1,glyphsByFont:new Map},dt.sdfTexture.generateMipmaps=!1,initContextLossHandling(dt)}const{sdfTexture:ht,sdfCanvas:ft}=dt;let gt=dt.glyphsByFont.get(nt.font);gt||dt.glyphsByFont.set(nt.font,gt=new Map),typesetInWorker(nt).then(Et=>{const{glyphIds:yt,glyphPositions:Ct,fontSize:wt,unitsPerEm:It,timings:Pt}=Et,Rt=[],xt=new Float32Array(yt.length*4),Nt=wt/It;let kt=0,Vt=0;const Ft=now$1();yt.forEach((pn,an)=>{let fn=gt.get(pn);if(!fn){const{path:Pn,pathBounds:yn}=Et.glyphData[pn],An=Math.max(yn[2]-yn[0],yn[3]-yn[1])/at*(CONFIG.sdfMargin*at+.5),Sn=dt.glyphCount++,gn=[yn[0]-An,yn[1]-An,yn[2]+An,yn[3]+An];gt.set(pn,fn={path:Pn,atlasIndex:Sn,sdfViewBox:gn}),Rt.push(fn)}const{sdfViewBox:dn}=fn,Cn=Ct[Vt++],On=Ct[Vt++];xt[kt++]=Cn+dn[0]*Nt,xt[kt++]=On+dn[1]*Nt,xt[kt++]=Cn+dn[2]*Nt,xt[kt++]=On+dn[3]*Nt,yt[an]=fn.atlasIndex}),Pt.quads=(Pt.quads||0)+(now$1()-Ft);const zt=now$1();Pt.sdf={};const Yt=ft.height,Kt=Math.ceil(dt.glyphCount/lt),qt=Math.pow(2,Math.ceil(Math.log2(Kt*at)));qt>Yt&&(console.info(`Increasing SDF texture size ${Yt}->${qt}`),resizeWebGLCanvasWithoutClearing(ft,ot,qt),ht.dispose()),Promise.all(Rt.map(pn=>generateGlyphSDF(pn,dt,nt.gpuAccelerateSDF).then(({timing:an})=>{Pt.sdf[pn.atlasIndex]=an}))).then(()=>{Rt.length&&!dt.contextLost&&(safariPre15Workaround(dt),ht.needsUpdate=!0),Pt.sdfTotal=now$1()-zt,Pt.total=now$1()-tt,_(Object.freeze({parameters:nt,sdfTexture:ht,sdfGlyphSize:at,sdfExponent:st,glyphBounds:xt,glyphAtlasIndices:yt,glyphColors:Et.glyphColors,caretPositions:Et.caretPositions,caretHeight:Et.caretHeight,chunkedBounds:Et.chunkedBounds,ascender:Et.ascender,descender:Et.descender,lineHeight:Et.lineHeight,capHeight:Et.capHeight,xHeight:Et.xHeight,topBaseline:Et.topBaseline,blockBounds:Et.blockBounds,visibleBounds:Et.visibleBounds,timings:Et.timings}))})}),Promise.resolve().then(()=>{dt.contextLost||warmUpSDFCanvas(ft)})}function generateGlyphSDF({path:nt,atlasIndex:_,sdfViewBox:tt},{sdfGlyphSize:ot,sdfCanvas:st,contextLost:at},lt){if(at)return Promise.resolve({timing:-1});const{textureWidth:dt,sdfExponent:ht}=CONFIG,ft=Math.max(tt[2]-tt[0],tt[3]-tt[1]),gt=Math.floor(_/4),Et=gt%(dt/ot)*ot,yt=Math.floor(gt/(dt/ot))*ot,Ct=_%4;return generateSDF(ot,ot,nt,tt,ft,ht,st,Et,yt,Ct,lt)}function initContextLossHandling(nt){const _=nt.sdfCanvas;_.addEventListener("webglcontextlost",tt=>{console.log("Context Lost",tt),tt.preventDefault(),nt.contextLost=!0}),_.addEventListener("webglcontextrestored",tt=>{console.log("Context Restored",tt),nt.contextLost=!1;const ot=[];nt.glyphsByFont.forEach(st=>{st.forEach(at=>{ot.push(generateGlyphSDF(at,nt,!0))})}),Promise.all(ot).then(()=>{safariPre15Workaround(nt),nt.sdfTexture.needsUpdate=!0})})}function preloadFont({font:nt,characters:_,sdfGlyphSize:tt},ot){let st=Array.isArray(_)?_.join(`
`):""+_;getTextRenderInfo({font:nt,sdfGlyphSize:tt,text:st},ot)}function assign$2(nt,_){for(let tt in _)_.hasOwnProperty(tt)&&(nt[tt]=_[tt]);return nt}let linkEl;function toAbsoluteURL(nt){return linkEl||(linkEl=typeof document>"u"?{}:document.createElement("a")),linkEl.href=nt,linkEl.href}function safariPre15Workaround(nt){if(typeof createImageBitmap!="function"){console.info("Safari<15: applying SDF canvas workaround");const{sdfCanvas:_,sdfTexture:tt}=nt,{width:ot,height:st}=_,at=nt.sdfCanvas.getContext("webgl");let lt=tt.image.data;(!lt||lt.length!==ot*st*4)&&(lt=new Uint8Array(ot*st*4),tt.image={width:ot,height:st,data:lt},tt.flipY=!1,tt.isDataTexture=!0),at.readPixels(0,0,ot,st,at.RGBA,at.UNSIGNED_BYTE,lt)}}const typesetterWorkerModule=defineWorkerModule({name:"Typesetter",dependencies:[CONFIG,workerModule,createTypesetter,bidiFactory],init(nt,_,tt,ot){const{defaultFontURL:st}=nt;return tt(_,ot(),{defaultFontURL:st})}}),typesetInWorker=defineWorkerModule({name:"Typesetter",dependencies:[typesetterWorkerModule],init(nt){return function(_){return new Promise(tt=>{nt.typeset(_,tt)})}},getTransferables(nt){const _=[nt.glyphPositions.buffer,nt.glyphIds.buffer];return nt.caretPositions&&_.push(nt.caretPositions.buffer),nt.glyphColors&&_.push(nt.glyphColors.buffer),_}}),templateGeometries={};function getTemplateGeometry(nt){let _=templateGeometries[nt];if(!_){const tt=new PlaneGeometry(1,1,nt,nt),ot=tt.clone(),st=tt.attributes,at=ot.attributes,lt=new BufferGeometry,dt=st.uv.count;for(let ht=0;ht<dt;ht++)at.position.array[ht*3]*=-1,at.normal.array[ht*3+2]*=-1;["position","normal","uv"].forEach(ht=>{lt.setAttribute(ht,new Float32BufferAttribute([...st[ht].array,...at[ht].array],st[ht].itemSize))}),lt.setIndex([...tt.index.array,...ot.index.array.map(ht=>ht+dt)]),lt.translate(.5,.5,0),_=templateGeometries[nt]=lt}return _}const glyphBoundsAttrName="aTroikaGlyphBounds",glyphIndexAttrName="aTroikaGlyphIndex",glyphColorAttrName="aTroikaGlyphColor";class GlyphsGeometry extends InstancedBufferGeometry{constructor(){super(),this.detail=1,this.curveRadius=0,this.groups=[{start:0,count:1/0,materialIndex:0},{start:0,count:1/0,materialIndex:1}],this.boundingSphere=new Sphere,this.boundingBox=new Box3}computeBoundingSphere(){}computeBoundingBox(){}setSide(_){const tt=this.getIndex().count;this.setDrawRange(_===BackSide?tt/2:0,_===DoubleSide?tt:tt/2)}set detail(_){if(_!==this._detail){this._detail=_,(typeof _!="number"||_<1)&&(_=1);let tt=getTemplateGeometry(_);["position","normal","uv"].forEach(ot=>{this.attributes[ot]=tt.attributes[ot].clone()}),this.setIndex(tt.getIndex().clone())}}get detail(){return this._detail}set curveRadius(_){_!==this._curveRadius&&(this._curveRadius=_,this._updateBounds())}get curveRadius(){return this._curveRadius}updateGlyphs(_,tt,ot,st,at){updateBufferAttr(this,glyphBoundsAttrName,_,4),updateBufferAttr(this,glyphIndexAttrName,tt,1),updateBufferAttr(this,glyphColorAttrName,at,3),this._blockBounds=ot,this._chunkedBounds=st,this.instanceCount=tt.length,this._updateBounds()}_updateBounds(){const _=this._blockBounds;if(_){const{curveRadius:tt,boundingBox:ot}=this;if(tt){const{PI:st,floor:at,min:lt,max:dt,sin:ht,cos:ft}=Math,gt=st/2,Et=st*2,yt=Math.abs(tt),Ct=_[0]/yt,wt=_[2]/yt,It=at((Ct+gt)/Et)!==at((wt+gt)/Et)?-yt:lt(ht(Ct)*yt,ht(wt)*yt),Pt=at((Ct-gt)/Et)!==at((wt-gt)/Et)?yt:dt(ht(Ct)*yt,ht(wt)*yt),Rt=at((Ct+st)/Et)!==at((wt+st)/Et)?yt*2:dt(yt-ft(Ct)*yt,yt-ft(wt)*yt);ot.min.set(It,_[1],tt<0?-Rt:0),ot.max.set(Pt,_[3],tt<0?0:Rt)}else ot.min.set(_[0],_[1],0),ot.max.set(_[2],_[3],0);ot.getBoundingSphere(this.boundingSphere)}}applyClipRect(_){let tt=this.getAttribute(glyphIndexAttrName).count,ot=this._chunkedBounds;if(ot)for(let st=ot.length;st--;){tt=ot[st].end;let at=ot[st].rect;if(at[1]<_.w&&at[3]>_.y&&at[0]<_.z&&at[2]>_.x)break}this.instanceCount=tt}}function updateBufferAttr(nt,_,tt,ot){const st=nt.getAttribute(_);tt?st&&st.array.length===tt.length?(st.array.set(tt),st.needsUpdate=!0):(nt.setAttribute(_,new InstancedBufferAttribute(tt,ot)),delete nt._maxInstanceCount,nt.dispose()):st&&nt.deleteAttribute(_)}const VERTEX_DEFS=`
uniform vec2 uTroikaSDFTextureSize;
uniform float uTroikaSDFGlyphSize;
uniform vec4 uTroikaTotalBounds;
uniform vec4 uTroikaClipRect;
uniform mat3 uTroikaOrient;
uniform bool uTroikaUseGlyphColors;
uniform float uTroikaDistanceOffset;
uniform float uTroikaBlurRadius;
uniform vec2 uTroikaPositionOffset;
uniform float uTroikaCurveRadius;
attribute vec4 aTroikaGlyphBounds;
attribute float aTroikaGlyphIndex;
attribute vec3 aTroikaGlyphColor;
varying vec2 vTroikaGlyphUV;
varying vec4 vTroikaTextureUVBounds;
varying float vTroikaTextureChannel;
varying vec3 vTroikaGlyphColor;
varying vec2 vTroikaGlyphDimensions;
`,VERTEX_TRANSFORM=`
vec4 bounds = aTroikaGlyphBounds;
bounds.xz += uTroikaPositionOffset.x;
bounds.yw -= uTroikaPositionOffset.y;

vec4 outlineBounds = vec4(
  bounds.xy - uTroikaDistanceOffset - uTroikaBlurRadius,
  bounds.zw + uTroikaDistanceOffset + uTroikaBlurRadius
);
vec4 clippedBounds = vec4(
  clamp(outlineBounds.xy, uTroikaClipRect.xy, uTroikaClipRect.zw),
  clamp(outlineBounds.zw, uTroikaClipRect.xy, uTroikaClipRect.zw)
);

vec2 clippedXY = (mix(clippedBounds.xy, clippedBounds.zw, position.xy) - bounds.xy) / (bounds.zw - bounds.xy);

position.xy = mix(bounds.xy, bounds.zw, clippedXY);

uv = (position.xy - uTroikaTotalBounds.xy) / (uTroikaTotalBounds.zw - uTroikaTotalBounds.xy);

float rad = uTroikaCurveRadius;
if (rad != 0.0) {
  float angle = position.x / rad;
  position.xz = vec2(sin(angle) * rad, rad - cos(angle) * rad);
  normal.xz = vec2(sin(angle), cos(angle));
}
  
position = uTroikaOrient * position;
normal = uTroikaOrient * normal;

vTroikaGlyphUV = clippedXY.xy;
vTroikaGlyphDimensions = vec2(bounds[2] - bounds[0], bounds[3] - bounds[1]);


float txCols = uTroikaSDFTextureSize.x / uTroikaSDFGlyphSize;
vec2 txUvPerSquare = uTroikaSDFGlyphSize / uTroikaSDFTextureSize;
vec2 txStartUV = txUvPerSquare * vec2(
  mod(floor(aTroikaGlyphIndex / 4.0), txCols),
  floor(floor(aTroikaGlyphIndex / 4.0) / txCols)
);
vTroikaTextureUVBounds = vec4(txStartUV, vec2(txStartUV) + txUvPerSquare);
vTroikaTextureChannel = mod(aTroikaGlyphIndex, 4.0);
`,FRAGMENT_DEFS=`
uniform sampler2D uTroikaSDFTexture;
uniform vec2 uTroikaSDFTextureSize;
uniform float uTroikaSDFGlyphSize;
uniform float uTroikaSDFExponent;
uniform float uTroikaDistanceOffset;
uniform float uTroikaFillOpacity;
uniform float uTroikaOutlineOpacity;
uniform float uTroikaBlurRadius;
uniform vec3 uTroikaStrokeColor;
uniform float uTroikaStrokeWidth;
uniform float uTroikaStrokeOpacity;
uniform bool uTroikaSDFDebug;
varying vec2 vTroikaGlyphUV;
varying vec4 vTroikaTextureUVBounds;
varying float vTroikaTextureChannel;
varying vec2 vTroikaGlyphDimensions;

float troikaSdfValueToSignedDistance(float alpha) {
  // Inverse of exponential encoding in webgl-sdf-generator
  
  float maxDimension = max(vTroikaGlyphDimensions.x, vTroikaGlyphDimensions.y);
  float absDist = (1.0 - pow(2.0 * (alpha > 0.5 ? 1.0 - alpha : alpha), 1.0 / uTroikaSDFExponent)) * maxDimension;
  float signedDist = absDist * (alpha > 0.5 ? -1.0 : 1.0);
  return signedDist;
}

float troikaGlyphUvToSdfValue(vec2 glyphUV) {
  vec2 textureUV = mix(vTroikaTextureUVBounds.xy, vTroikaTextureUVBounds.zw, glyphUV);
  vec4 rgba = texture2D(uTroikaSDFTexture, textureUV);
  float ch = floor(vTroikaTextureChannel + 0.5); //NOTE: can't use round() in WebGL1
  return ch == 0.0 ? rgba.r : ch == 1.0 ? rgba.g : ch == 2.0 ? rgba.b : rgba.a;
}

float troikaGlyphUvToDistance(vec2 uv) {
  return troikaSdfValueToSignedDistance(troikaGlyphUvToSdfValue(uv));
}

float troikaGetAADist() {
  
  #if defined(GL_OES_standard_derivatives) || __VERSION__ >= 300
  return length(fwidth(vTroikaGlyphUV * vTroikaGlyphDimensions)) * 0.5;
  #else
  return vTroikaGlyphDimensions.x / 64.0;
  #endif
}

float troikaGetFragDistValue() {
  vec2 clampedGlyphUV = clamp(vTroikaGlyphUV, 0.5 / uTroikaSDFGlyphSize, 1.0 - 0.5 / uTroikaSDFGlyphSize);
  float distance = troikaGlyphUvToDistance(clampedGlyphUV);
 
  // Extrapolate distance when outside bounds:
  distance += clampedGlyphUV == vTroikaGlyphUV ? 0.0 : 
    length((vTroikaGlyphUV - clampedGlyphUV) * vTroikaGlyphDimensions);

  

  return distance;
}

float troikaGetEdgeAlpha(float distance, float distanceOffset, float aaDist) {
  #if defined(IS_DEPTH_MATERIAL) || defined(IS_DISTANCE_MATERIAL)
  float alpha = step(-distanceOffset, -distance);
  #else

  float alpha = smoothstep(
    distanceOffset + aaDist,
    distanceOffset - aaDist,
    distance
  );
  #endif

  return alpha;
}
`,FRAGMENT_TRANSFORM=`
float aaDist = troikaGetAADist();
float fragDistance = troikaGetFragDistValue();
float edgeAlpha = uTroikaSDFDebug ?
  troikaGlyphUvToSdfValue(vTroikaGlyphUV) :
  troikaGetEdgeAlpha(fragDistance, uTroikaDistanceOffset, max(aaDist, uTroikaBlurRadius));

#if !defined(IS_DEPTH_MATERIAL) && !defined(IS_DISTANCE_MATERIAL)
vec4 fillRGBA = gl_FragColor;
fillRGBA.a *= uTroikaFillOpacity;
vec4 strokeRGBA = uTroikaStrokeWidth == 0.0 ? fillRGBA : vec4(uTroikaStrokeColor, uTroikaStrokeOpacity);
if (fillRGBA.a == 0.0) fillRGBA.rgb = strokeRGBA.rgb;
gl_FragColor = mix(fillRGBA, strokeRGBA, smoothstep(
  -uTroikaStrokeWidth - aaDist,
  -uTroikaStrokeWidth + aaDist,
  fragDistance
));
gl_FragColor.a *= edgeAlpha;
#endif

if (edgeAlpha == 0.0) {
  discard;
}
`;function createTextDerivedMaterial(nt){const _=createDerivedMaterial(nt,{chained:!0,extensions:{derivatives:!0},uniforms:{uTroikaSDFTexture:{value:null},uTroikaSDFTextureSize:{value:new Vector2},uTroikaSDFGlyphSize:{value:0},uTroikaSDFExponent:{value:0},uTroikaTotalBounds:{value:new Vector4(0,0,0,0)},uTroikaClipRect:{value:new Vector4(0,0,0,0)},uTroikaDistanceOffset:{value:0},uTroikaOutlineOpacity:{value:0},uTroikaFillOpacity:{value:1},uTroikaPositionOffset:{value:new Vector2},uTroikaCurveRadius:{value:0},uTroikaBlurRadius:{value:0},uTroikaStrokeWidth:{value:0},uTroikaStrokeColor:{value:new Color$1},uTroikaStrokeOpacity:{value:1},uTroikaOrient:{value:new Matrix3},uTroikaUseGlyphColors:{value:!0},uTroikaSDFDebug:{value:!1}},vertexDefs:VERTEX_DEFS,vertexTransform:VERTEX_TRANSFORM,fragmentDefs:FRAGMENT_DEFS,fragmentColorTransform:FRAGMENT_TRANSFORM,customRewriter({vertexShader:tt,fragmentShader:ot}){let st=/\buniform\s+vec3\s+diffuse\b/;return st.test(ot)&&(ot=ot.replace(st,"varying vec3 vTroikaGlyphColor").replace(/\bdiffuse\b/g,"vTroikaGlyphColor"),st.test(tt)||(tt=tt.replace(voidMainRegExp,`uniform vec3 diffuse;
$&
vTroikaGlyphColor = uTroikaUseGlyphColors ? aTroikaGlyphColor / 255.0 : diffuse;
`))),{vertexShader:tt,fragmentShader:ot}}});return _.transparent=!0,Object.defineProperties(_,{isTroikaTextMaterial:{value:!0},shadowSide:{get(){return this.side},set(){}}}),_}const defaultMaterial=new MeshBasicMaterial({color:16777215,side:DoubleSide,transparent:!0}),defaultStrokeColor=8421504,tempMat4=new Matrix4,tempVec3a=new Vector3,tempVec3b=new Vector3,tempArray=[],origin=new Vector3,defaultOrient="+x+y";function first(nt){return Array.isArray(nt)?nt[0]:nt}let getFlatRaycastMesh=()=>{const nt=new Mesh(new PlaneGeometry(1,1),defaultMaterial);return getFlatRaycastMesh=()=>nt,nt},getCurvedRaycastMesh=()=>{const nt=new Mesh(new PlaneGeometry(1,1,32,1),defaultMaterial);return getCurvedRaycastMesh=()=>nt,nt};const syncStartEvent={type:"syncstart"},syncCompleteEvent={type:"synccomplete"},SYNCABLE_PROPS=["font","fontSize","letterSpacing","lineHeight","maxWidth","overflowWrap","text","direction","textAlign","textIndent","whiteSpace","anchorX","anchorY","colorRanges","sdfGlyphSize"],COPYABLE_PROPS=SYNCABLE_PROPS.concat("material","color","depthOffset","clipRect","curveRadius","orientation","glyphGeometryDetail");let Text$1=class extends Mesh{constructor(){const _=new GlyphsGeometry;super(_,null),this.text="",this.anchorX=0,this.anchorY=0,this.curveRadius=0,this.direction="auto",this.font=null,this.fontSize=.1,this.letterSpacing=0,this.lineHeight="normal",this.maxWidth=1/0,this.overflowWrap="normal",this.textAlign="left",this.textIndent=0,this.whiteSpace="normal",this.material=null,this.color=null,this.colorRanges=null,this.outlineWidth=0,this.outlineColor=0,this.outlineOpacity=1,this.outlineBlur=0,this.outlineOffsetX=0,this.outlineOffsetY=0,this.strokeWidth=0,this.strokeColor=defaultStrokeColor,this.strokeOpacity=1,this.fillOpacity=1,this.depthOffset=0,this.clipRect=null,this.orientation=defaultOrient,this.glyphGeometryDetail=1,this.sdfGlyphSize=null,this.gpuAccelerateSDF=!0,this.debugSDF=!1}sync(_){this._needsSync&&(this._needsSync=!1,this._isSyncing?(this._queuedSyncs||(this._queuedSyncs=[])).push(_):(this._isSyncing=!0,this.dispatchEvent(syncStartEvent),getTextRenderInfo({text:this.text,font:this.font,fontSize:this.fontSize||.1,letterSpacing:this.letterSpacing||0,lineHeight:this.lineHeight||"normal",maxWidth:this.maxWidth,direction:this.direction||"auto",textAlign:this.textAlign,textIndent:this.textIndent,whiteSpace:this.whiteSpace,overflowWrap:this.overflowWrap,anchorX:this.anchorX,anchorY:this.anchorY,colorRanges:this.colorRanges,includeCaretPositions:!0,sdfGlyphSize:this.sdfGlyphSize,gpuAccelerateSDF:this.gpuAccelerateSDF},tt=>{this._isSyncing=!1,this._textRenderInfo=tt,this.geometry.updateGlyphs(tt.glyphBounds,tt.glyphAtlasIndices,tt.blockBounds,tt.chunkedBounds,tt.glyphColors);const ot=this._queuedSyncs;ot&&(this._queuedSyncs=null,this._needsSync=!0,this.sync(()=>{ot.forEach(st=>st&&st())})),this.dispatchEvent(syncCompleteEvent),_&&_()})))}onBeforeRender(_,tt,ot,st,at,lt){this.sync(),at.isTroikaTextMaterial&&this._prepareForRender(at),at._hadOwnSide=at.hasOwnProperty("side"),this.geometry.setSide(at._actualSide=at.side),at.side=FrontSide}onAfterRender(_,tt,ot,st,at,lt){at._hadOwnSide?at.side=at._actualSide:delete at.side}dispose(){this.geometry.dispose()}get textRenderInfo(){return this._textRenderInfo||null}get material(){let _=this._derivedMaterial;const tt=this._baseMaterial||this._defaultMaterial||(this._defaultMaterial=defaultMaterial.clone());if((!_||_.baseMaterial!==tt)&&(_=this._derivedMaterial=createTextDerivedMaterial(tt),tt.addEventListener("dispose",function ot(){tt.removeEventListener("dispose",ot),_.dispose()})),this.outlineWidth||this.outlineBlur||this.outlineOffsetX||this.outlineOffsetY){let ot=_._outlineMtl;return ot||(ot=_._outlineMtl=Object.create(_,{id:{value:_.id+.1}}),ot.isTextOutlineMaterial=!0,ot.depthWrite=!1,ot.map=null,_.addEventListener("dispose",function st(){_.removeEventListener("dispose",st),ot.dispose()})),[ot,_]}else return _}set material(_){_&&_.isTroikaTextMaterial?(this._derivedMaterial=_,this._baseMaterial=_.baseMaterial):this._baseMaterial=_}get glyphGeometryDetail(){return this.geometry.detail}set glyphGeometryDetail(_){this.geometry.detail=_}get curveRadius(){return this.geometry.curveRadius}set curveRadius(_){this.geometry.curveRadius=_}get customDepthMaterial(){return first(this.material).getDepthMaterial()}get customDistanceMaterial(){return first(this.material).getDistanceMaterial()}_prepareForRender(_){const tt=_.isTextOutlineMaterial,ot=_.uniforms,st=this.textRenderInfo;if(st){const{sdfTexture:dt,blockBounds:ht}=st;ot.uTroikaSDFTexture.value=dt,ot.uTroikaSDFTextureSize.value.set(dt.image.width,dt.image.height),ot.uTroikaSDFGlyphSize.value=st.sdfGlyphSize,ot.uTroikaSDFExponent.value=st.sdfExponent,ot.uTroikaTotalBounds.value.fromArray(ht),ot.uTroikaUseGlyphColors.value=!tt&&!!st.glyphColors;let ft=0,gt=0,Et=0,yt,Ct,wt,It=0,Pt=0;if(tt){let{outlineWidth:xt,outlineOffsetX:Nt,outlineOffsetY:kt,outlineBlur:Vt,outlineOpacity:Ft}=this;ft=this._parsePercent(xt)||0,gt=Math.max(0,this._parsePercent(Vt)||0),yt=Ft,It=this._parsePercent(Nt)||0,Pt=this._parsePercent(kt)||0}else Et=Math.max(0,this._parsePercent(this.strokeWidth)||0),Et&&(wt=this.strokeColor,ot.uTroikaStrokeColor.value.set(wt??defaultStrokeColor),Ct=this.strokeOpacity,Ct==null&&(Ct=1)),yt=this.fillOpacity;ot.uTroikaDistanceOffset.value=ft,ot.uTroikaPositionOffset.value.set(It,Pt),ot.uTroikaBlurRadius.value=gt,ot.uTroikaStrokeWidth.value=Et,ot.uTroikaStrokeOpacity.value=Ct,ot.uTroikaFillOpacity.value=yt??1,ot.uTroikaCurveRadius.value=this.curveRadius||0;let Rt=this.clipRect;if(Rt&&Array.isArray(Rt)&&Rt.length===4)ot.uTroikaClipRect.value.fromArray(Rt);else{const xt=(this.fontSize||.1)*100;ot.uTroikaClipRect.value.set(ht[0]-xt,ht[1]-xt,ht[2]+xt,ht[3]+xt)}this.geometry.applyClipRect(ot.uTroikaClipRect.value)}ot.uTroikaSDFDebug.value=!!this.debugSDF,_.polygonOffset=!!this.depthOffset,_.polygonOffsetFactor=_.polygonOffsetUnits=this.depthOffset||0;const at=tt?this.outlineColor||0:this.color;if(at==null)delete _.color;else{const dt=_.hasOwnProperty("color")?_.color:_.color=new Color$1;(at!==dt._input||typeof at=="object")&&dt.set(dt._input=at)}let lt=this.orientation||defaultOrient;if(lt!==_._orientation){let dt=ot.uTroikaOrient.value;lt=lt.replace(/[^-+xyz]/g,"");let ht=lt!==defaultOrient&&lt.match(/^([-+])([xyz])([-+])([xyz])$/);if(ht){let[,ft,gt,Et,yt]=ht;tempVec3a.set(0,0,0)[gt]=ft==="-"?1:-1,tempVec3b.set(0,0,0)[yt]=Et==="-"?-1:1,tempMat4.lookAt(origin,tempVec3a.cross(tempVec3b),tempVec3b),dt.setFromMatrix4(tempMat4)}else dt.identity();_._orientation=lt}}_parsePercent(_){if(typeof _=="string"){let tt=_.match(/^(-?[\d.]+)%$/),ot=tt?parseFloat(tt[1]):NaN;_=(isNaN(ot)?0:ot/100)*this.fontSize}return _}localPositionToTextCoords(_,tt=new Vector2){tt.copy(_);const ot=this.curveRadius;return ot&&(tt.x=Math.atan2(_.x,Math.abs(ot)-Math.abs(_.z))*Math.abs(ot)),tt}worldPositionToTextCoords(_,tt=new Vector2){return tempVec3a.copy(_),this.localPositionToTextCoords(this.worldToLocal(tempVec3a),tt)}raycast(_,tt){const{textRenderInfo:ot,curveRadius:st}=this;if(ot){const at=ot.blockBounds,lt=st?getCurvedRaycastMesh():getFlatRaycastMesh(),dt=lt.geometry,{position:ht,uv:ft}=dt.attributes;for(let gt=0;gt<ft.count;gt++){let Et=at[0]+ft.getX(gt)*(at[2]-at[0]);const yt=at[1]+ft.getY(gt)*(at[3]-at[1]);let Ct=0;st&&(Ct=st-Math.cos(Et/st)*st,Et=Math.sin(Et/st)*st),ht.setXYZ(gt,Et,yt,Ct)}dt.boundingSphere=this.geometry.boundingSphere,dt.boundingBox=this.geometry.boundingBox,lt.matrixWorld=this.matrixWorld,lt.material.side=this.material.side,tempArray.length=0,lt.raycast(_,tempArray);for(let gt=0;gt<tempArray.length;gt++)tempArray[gt].object=this,tt.push(tempArray[gt])}}copy(_){const tt=this.geometry;return super.copy(_),this.geometry=tt,COPYABLE_PROPS.forEach(ot=>{this[ot]=_[ot]}),this}clone(){return new this.constructor().copy(this)}};SYNCABLE_PROPS.forEach(nt=>{const _="_private_"+nt;Object.defineProperty(Text$1.prototype,nt,{get(){return this[_]},set(tt){tt!==this[_]&&(this[_]=tt,this._needsSync=!0)}})});const Text=reactExports.forwardRef(({sdfGlyphSize:nt=64,anchorX:_="center",anchorY:tt="middle",font:ot,fontSize:st=1,children:at,characters:lt,onSync:dt,...ht},ft)=>{const gt=useThree(({invalidate:wt})=>wt),[Et]=reactExports.useState(()=>new Text$1),[yt,Ct]=reactExports.useMemo(()=>{const wt=[];let It="";return reactExports.Children.forEach(at,Pt=>{typeof Pt=="string"||typeof Pt=="number"?It+=Pt:wt.push(Pt)}),[wt,It]},[at]);return suspend(()=>new Promise(wt=>preloadFont({font:ot,characters:lt},wt)),["troika-text",ot,lt]),reactExports.useLayoutEffect(()=>void Et.sync(()=>{gt(),dt&&dt(Et)})),reactExports.useEffect(()=>()=>Et.dispose(),[Et]),reactExports.createElement("primitive",_extends$1({object:Et,ref:ft,font:ot,text:Ct,anchorX:_,anchorY:tt,fontSize:st,sdfGlyphSize:nt},ht),yt)});let dracoLoader=null;function extensions(nt,_,tt){return ot=>{tt&&tt(ot),nt&&(dracoLoader||(dracoLoader=new DRACOLoader),dracoLoader.setDecoderPath(typeof nt=="string"?nt:"https://www.gstatic.com/draco/versioned/decoders/1.5.5/"),ot.setDRACOLoader(dracoLoader)),_&&ot.setMeshoptDecoder(typeof MeshoptDecoder=="function"?MeshoptDecoder():MeshoptDecoder)}}function useGLTF(nt,_=!0,tt=!0,ot){return useLoader(GLTFLoader,nt,extensions(_,tt,ot))}useGLTF.preload=(nt,_=!0,tt=!0,ot)=>useLoader.preload(GLTFLoader,nt,extensions(_,tt,ot));useGLTF.clear=nt=>useLoader.clear(GLTFLoader,nt);/*!
 * camera-controls
 * https://github.com/yomotsu/camera-controls
 * (c) 2017 @yomotsu
 * Released under the MIT License.
 */const MOUSE_BUTTON={LEFT:1,RIGHT:2,MIDDLE:4},ACTION=Object.freeze({NONE:0,ROTATE:1,TRUCK:2,SCREEN_PAN:4,OFFSET:8,DOLLY:16,ZOOM:32,TOUCH_ROTATE:64,TOUCH_TRUCK:128,TOUCH_SCREEN_PAN:256,TOUCH_OFFSET:512,TOUCH_DOLLY:1024,TOUCH_ZOOM:2048,TOUCH_DOLLY_TRUCK:4096,TOUCH_DOLLY_SCREEN_PAN:8192,TOUCH_DOLLY_OFFSET:16384,TOUCH_DOLLY_ROTATE:32768,TOUCH_ZOOM_TRUCK:65536,TOUCH_ZOOM_OFFSET:131072,TOUCH_ZOOM_SCREEN_PAN:262144,TOUCH_ZOOM_ROTATE:524288}),DOLLY_DIRECTION={NONE:0,IN:1,OUT:-1};function isPerspectiveCamera(nt){return nt.isPerspectiveCamera}function isOrthographicCamera(nt){return nt.isOrthographicCamera}const PI_2=Math.PI*2,PI_HALF=Math.PI/2,EPSILON=1e-5,DEG2RAD=Math.PI/180;function clamp$1(nt,_,tt){return Math.max(_,Math.min(tt,nt))}function approxZero(nt,_=EPSILON){return Math.abs(nt)<_}function approxEquals(nt,_,tt=EPSILON){return approxZero(nt-_,tt)}function roundToStep(nt,_){return Math.round(nt/_)*_}function infinityToMaxNumber(nt){return isFinite(nt)?nt:nt<0?-Number.MAX_VALUE:Number.MAX_VALUE}function maxNumberToInfinity(nt){return Math.abs(nt)<Number.MAX_VALUE?nt:nt*(1/0)}function smoothDamp(nt,_,tt,ot,st=1/0,at){ot=Math.max(1e-4,ot);const lt=2/ot,dt=lt*at,ht=1/(1+dt+.48*dt*dt+.235*dt*dt*dt);let ft=nt-_;const gt=_,Et=st*ot;ft=clamp$1(ft,-Et,Et),_=nt-ft;const yt=(tt.value+lt*ft)*at;tt.value=(tt.value-lt*yt)*ht;let Ct=_+(ft+yt)*ht;return gt-nt>0==Ct>gt&&(Ct=gt,tt.value=(Ct-gt)/at),Ct}function smoothDampVec3(nt,_,tt,ot,st=1/0,at,lt){ot=Math.max(1e-4,ot);const dt=2/ot,ht=dt*at,ft=1/(1+ht+.48*ht*ht+.235*ht*ht*ht);let gt=_.x,Et=_.y,yt=_.z,Ct=nt.x-gt,wt=nt.y-Et,It=nt.z-yt;const Pt=gt,Rt=Et,xt=yt,Nt=st*ot,kt=Nt*Nt,Vt=Ct*Ct+wt*wt+It*It;if(Vt>kt){const Cn=Math.sqrt(Vt);Ct=Ct/Cn*Nt,wt=wt/Cn*Nt,It=It/Cn*Nt}gt=nt.x-Ct,Et=nt.y-wt,yt=nt.z-It;const Ft=(tt.x+dt*Ct)*at,zt=(tt.y+dt*wt)*at,Yt=(tt.z+dt*It)*at;tt.x=(tt.x-dt*Ft)*ft,tt.y=(tt.y-dt*zt)*ft,tt.z=(tt.z-dt*Yt)*ft,lt.x=gt+(Ct+Ft)*ft,lt.y=Et+(wt+zt)*ft,lt.z=yt+(It+Yt)*ft;const Kt=Pt-nt.x,qt=Rt-nt.y,pn=xt-nt.z,an=lt.x-Pt,fn=lt.y-Rt,dn=lt.z-xt;return Kt*an+qt*fn+pn*dn>0&&(lt.x=Pt,lt.y=Rt,lt.z=xt,tt.x=(lt.x-Pt)/at,tt.y=(lt.y-Rt)/at,tt.z=(lt.z-xt)/at),lt}function extractClientCoordFromEvent(nt,_){_.set(0,0),nt.forEach(tt=>{_.x+=tt.clientX,_.y+=tt.clientY}),_.x/=nt.length,_.y/=nt.length}function notSupportedInOrthographicCamera(nt,_){return isOrthographicCamera(nt)?(console.warn(`${_} is not supported in OrthographicCamera`),!0):!1}class EventDispatcher{constructor(){this._listeners={}}addEventListener(_,tt){const ot=this._listeners;ot[_]===void 0&&(ot[_]=[]),ot[_].indexOf(tt)===-1&&ot[_].push(tt)}hasEventListener(_,tt){const ot=this._listeners;return ot[_]!==void 0&&ot[_].indexOf(tt)!==-1}removeEventListener(_,tt){const st=this._listeners[_];if(st!==void 0){const at=st.indexOf(tt);at!==-1&&st.splice(at,1)}}removeAllEventListeners(_){if(!_){this._listeners={};return}Array.isArray(this._listeners[_])&&(this._listeners[_].length=0)}dispatchEvent(_){const ot=this._listeners[_.type];if(ot!==void 0){_.target=this;const st=ot.slice(0);for(let at=0,lt=st.length;at<lt;at++)st[at].call(this,_)}}}var _a;const VERSION="2.10.1",TOUCH_DOLLY_FACTOR=1/8,isMac=/Mac/.test((_a=globalThis==null?void 0:globalThis.navigator)===null||_a===void 0?void 0:_a.platform);let THREE,_ORIGIN,_AXIS_Y,_AXIS_Z,_v2,_v3A,_v3B,_v3C,_cameraDirection,_xColumn,_yColumn,_zColumn,_deltaTarget,_deltaOffset,_sphericalA,_sphericalB,_box3A,_box3B,_sphere,_quaternionA,_quaternionB,_rotationMatrix,_raycaster,CameraControls$1=class RP extends EventDispatcher{static install(_){THREE=_.THREE,_ORIGIN=Object.freeze(new THREE.Vector3(0,0,0)),_AXIS_Y=Object.freeze(new THREE.Vector3(0,1,0)),_AXIS_Z=Object.freeze(new THREE.Vector3(0,0,1)),_v2=new THREE.Vector2,_v3A=new THREE.Vector3,_v3B=new THREE.Vector3,_v3C=new THREE.Vector3,_cameraDirection=new THREE.Vector3,_xColumn=new THREE.Vector3,_yColumn=new THREE.Vector3,_zColumn=new THREE.Vector3,_deltaTarget=new THREE.Vector3,_deltaOffset=new THREE.Vector3,_sphericalA=new THREE.Spherical,_sphericalB=new THREE.Spherical,_box3A=new THREE.Box3,_box3B=new THREE.Box3,_sphere=new THREE.Sphere,_quaternionA=new THREE.Quaternion,_quaternionB=new THREE.Quaternion,_rotationMatrix=new THREE.Matrix4,_raycaster=new THREE.Raycaster}static get ACTION(){return ACTION}set verticalDragToForward(_){console.warn("camera-controls: `verticalDragToForward` was removed. Use `mouseButtons.left = CameraControls.ACTION.SCREEN_PAN` instead.")}constructor(_,tt){super(),this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.minDistance=Number.EPSILON,this.maxDistance=1/0,this.infinityDolly=!1,this.minZoom=.01,this.maxZoom=1/0,this.smoothTime=.25,this.draggingSmoothTime=.125,this.maxSpeed=1/0,this.azimuthRotateSpeed=1,this.polarRotateSpeed=1,this.dollySpeed=1,this.dollyDragInverted=!1,this.truckSpeed=2,this.dollyToCursor=!1,this.dragToOffset=!1,this.boundaryFriction=0,this.restThreshold=.01,this.colliderMeshes=[],this.cancel=()=>{},this._enabled=!0,this._state=ACTION.NONE,this._viewport=null,this._changedDolly=0,this._changedZoom=0,this._hasRested=!0,this._boundaryEnclosesCamera=!1,this._needsUpdate=!0,this._updatedLastTime=!1,this._elementRect=new DOMRect,this._isDragging=!1,this._dragNeedsUpdate=!0,this._activePointers=[],this._lockedPointer=null,this._interactiveArea=new DOMRect(0,0,1,1),this._isUserControllingRotate=!1,this._isUserControllingDolly=!1,this._isUserControllingTruck=!1,this._isUserControllingOffset=!1,this._isUserControllingZoom=!1,this._lastDollyDirection=DOLLY_DIRECTION.NONE,this._thetaVelocity={value:0},this._phiVelocity={value:0},this._radiusVelocity={value:0},this._targetVelocity=new THREE.Vector3,this._focalOffsetVelocity=new THREE.Vector3,this._zoomVelocity={value:0},this._truckInternal=(Rt,xt,Nt,kt)=>{let Vt,Ft;if(isPerspectiveCamera(this._camera)){const zt=_v3A.copy(this._camera.position).sub(this._target),Yt=this._camera.getEffectiveFOV()*DEG2RAD,Kt=zt.length()*Math.tan(Yt*.5);Vt=this.truckSpeed*Rt*Kt/this._elementRect.height,Ft=this.truckSpeed*xt*Kt/this._elementRect.height}else if(isOrthographicCamera(this._camera)){const zt=this._camera;Vt=this.truckSpeed*Rt*(zt.right-zt.left)/zt.zoom/this._elementRect.width,Ft=this.truckSpeed*xt*(zt.top-zt.bottom)/zt.zoom/this._elementRect.height}else return;kt?(Nt?this.setFocalOffset(this._focalOffsetEnd.x+Vt,this._focalOffsetEnd.y,this._focalOffsetEnd.z,!0):this.truck(Vt,0,!0),this.forward(-Ft,!0)):Nt?this.setFocalOffset(this._focalOffsetEnd.x+Vt,this._focalOffsetEnd.y+Ft,this._focalOffsetEnd.z,!0):this.truck(Vt,Ft,!0)},this._rotateInternal=(Rt,xt)=>{const Nt=PI_2*this.azimuthRotateSpeed*Rt/this._elementRect.height,kt=PI_2*this.polarRotateSpeed*xt/this._elementRect.height;this.rotate(Nt,kt,!0)},this._dollyInternal=(Rt,xt,Nt)=>{const kt=Math.pow(.95,-Rt*this.dollySpeed),Vt=this._sphericalEnd.radius,Ft=this._sphericalEnd.radius*kt,zt=clamp$1(Ft,this.minDistance,this.maxDistance),Yt=zt-Ft;this.infinityDolly&&this.dollyToCursor?this._dollyToNoClamp(Ft,!0):this.infinityDolly&&!this.dollyToCursor?(this.dollyInFixed(Yt,!0),this._dollyToNoClamp(zt,!0)):this._dollyToNoClamp(zt,!0),this.dollyToCursor&&(this._changedDolly+=(this.infinityDolly?Ft:zt)-Vt,this._dollyControlCoord.set(xt,Nt)),this._lastDollyDirection=Math.sign(-Rt)},this._zoomInternal=(Rt,xt,Nt)=>{const kt=Math.pow(.95,Rt*this.dollySpeed),Vt=this._zoom,Ft=this._zoom*kt;this.zoomTo(Ft,!0),this.dollyToCursor&&(this._changedZoom+=Ft-Vt,this._dollyControlCoord.set(xt,Nt))},typeof THREE>"u"&&console.error("camera-controls: `THREE` is undefined. You must first run `CameraControls.install( { THREE: THREE } )`. Check the docs for further information."),this._camera=_,this._yAxisUpSpace=new THREE.Quaternion().setFromUnitVectors(this._camera.up,_AXIS_Y),this._yAxisUpSpaceInverse=this._yAxisUpSpace.clone().invert(),this._state=ACTION.NONE,this._target=new THREE.Vector3,this._targetEnd=this._target.clone(),this._focalOffset=new THREE.Vector3,this._focalOffsetEnd=this._focalOffset.clone(),this._spherical=new THREE.Spherical().setFromVector3(_v3A.copy(this._camera.position).applyQuaternion(this._yAxisUpSpace)),this._sphericalEnd=this._spherical.clone(),this._lastDistance=this._spherical.radius,this._zoom=this._camera.zoom,this._zoomEnd=this._zoom,this._lastZoom=this._zoom,this._nearPlaneCorners=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3],this._updateNearPlaneCorners(),this._boundary=new THREE.Box3(new THREE.Vector3(-1/0,-1/0,-1/0),new THREE.Vector3(1/0,1/0,1/0)),this._cameraUp0=this._camera.up.clone(),this._target0=this._target.clone(),this._position0=this._camera.position.clone(),this._zoom0=this._zoom,this._focalOffset0=this._focalOffset.clone(),this._dollyControlCoord=new THREE.Vector2,this.mouseButtons={left:ACTION.ROTATE,middle:ACTION.DOLLY,right:ACTION.TRUCK,wheel:isPerspectiveCamera(this._camera)?ACTION.DOLLY:isOrthographicCamera(this._camera)?ACTION.ZOOM:ACTION.NONE},this.touches={one:ACTION.TOUCH_ROTATE,two:isPerspectiveCamera(this._camera)?ACTION.TOUCH_DOLLY_TRUCK:isOrthographicCamera(this._camera)?ACTION.TOUCH_ZOOM_TRUCK:ACTION.NONE,three:ACTION.TOUCH_TRUCK};const ot=new THREE.Vector2,st=new THREE.Vector2,at=new THREE.Vector2,lt=Rt=>{if(!this._enabled||!this._domElement)return;if(this._interactiveArea.left!==0||this._interactiveArea.top!==0||this._interactiveArea.width!==1||this._interactiveArea.height!==1){const kt=this._domElement.getBoundingClientRect(),Vt=Rt.clientX/kt.width,Ft=Rt.clientY/kt.height;if(Vt<this._interactiveArea.left||Vt>this._interactiveArea.right||Ft<this._interactiveArea.top||Ft>this._interactiveArea.bottom)return}const xt=Rt.pointerType!=="mouse"?null:(Rt.buttons&MOUSE_BUTTON.LEFT)===MOUSE_BUTTON.LEFT?MOUSE_BUTTON.LEFT:(Rt.buttons&MOUSE_BUTTON.MIDDLE)===MOUSE_BUTTON.MIDDLE?MOUSE_BUTTON.MIDDLE:(Rt.buttons&MOUSE_BUTTON.RIGHT)===MOUSE_BUTTON.RIGHT?MOUSE_BUTTON.RIGHT:null;if(xt!==null){const kt=this._findPointerByMouseButton(xt);kt&&this._disposePointer(kt)}if((Rt.buttons&MOUSE_BUTTON.LEFT)===MOUSE_BUTTON.LEFT&&this._lockedPointer)return;const Nt={pointerId:Rt.pointerId,clientX:Rt.clientX,clientY:Rt.clientY,deltaX:0,deltaY:0,mouseButton:xt};this._activePointers.push(Nt),this._domElement.ownerDocument.removeEventListener("pointermove",dt,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",ht),this._domElement.ownerDocument.addEventListener("pointermove",dt,{passive:!1}),this._domElement.ownerDocument.addEventListener("pointerup",ht),this._isDragging=!0,yt(Rt)},dt=Rt=>{Rt.cancelable&&Rt.preventDefault();const xt=Rt.pointerId,Nt=this._lockedPointer||this._findPointerById(xt);if(Nt){if(Nt.clientX=Rt.clientX,Nt.clientY=Rt.clientY,Nt.deltaX=Rt.movementX,Nt.deltaY=Rt.movementY,this._state=0,Rt.pointerType==="touch")switch(this._activePointers.length){case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three;break}else(!this._isDragging&&this._lockedPointer||this._isDragging&&(Rt.buttons&MOUSE_BUTTON.LEFT)===MOUSE_BUTTON.LEFT)&&(this._state=this._state|this.mouseButtons.left),this._isDragging&&(Rt.buttons&MOUSE_BUTTON.MIDDLE)===MOUSE_BUTTON.MIDDLE&&(this._state=this._state|this.mouseButtons.middle),this._isDragging&&(Rt.buttons&MOUSE_BUTTON.RIGHT)===MOUSE_BUTTON.RIGHT&&(this._state=this._state|this.mouseButtons.right);Ct()}},ht=Rt=>{const xt=this._findPointerById(Rt.pointerId);if(!(xt&&xt===this._lockedPointer)){if(xt&&this._disposePointer(xt),Rt.pointerType==="touch")switch(this._activePointers.length){case 0:this._state=ACTION.NONE;break;case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three;break}else this._state=ACTION.NONE;wt()}};let ft=-1;const gt=Rt=>{if(!this._domElement||!this._enabled||this.mouseButtons.wheel===ACTION.NONE)return;if(this._interactiveArea.left!==0||this._interactiveArea.top!==0||this._interactiveArea.width!==1||this._interactiveArea.height!==1){const Ft=this._domElement.getBoundingClientRect(),zt=Rt.clientX/Ft.width,Yt=Rt.clientY/Ft.height;if(zt<this._interactiveArea.left||zt>this._interactiveArea.right||Yt<this._interactiveArea.top||Yt>this._interactiveArea.bottom)return}if(Rt.preventDefault(),this.dollyToCursor||this.mouseButtons.wheel===ACTION.ROTATE||this.mouseButtons.wheel===ACTION.TRUCK){const Ft=performance.now();ft-Ft<1e3&&this._getClientRect(this._elementRect),ft=Ft}const xt=isMac?-1:-3,Nt=Rt.deltaMode===1||Rt.ctrlKey?Rt.deltaY/xt:Rt.deltaY/(xt*10),kt=this.dollyToCursor?(Rt.clientX-this._elementRect.x)/this._elementRect.width*2-1:0,Vt=this.dollyToCursor?(Rt.clientY-this._elementRect.y)/this._elementRect.height*-2+1:0;switch(this.mouseButtons.wheel){case ACTION.ROTATE:{this._rotateInternal(Rt.deltaX,Rt.deltaY),this._isUserControllingRotate=!0;break}case ACTION.TRUCK:{this._truckInternal(Rt.deltaX,Rt.deltaY,!1,!1),this._isUserControllingTruck=!0;break}case ACTION.SCREEN_PAN:{this._truckInternal(Rt.deltaX,Rt.deltaY,!1,!0),this._isUserControllingTruck=!0;break}case ACTION.OFFSET:{this._truckInternal(Rt.deltaX,Rt.deltaY,!0,!1),this._isUserControllingOffset=!0;break}case ACTION.DOLLY:{this._dollyInternal(-Nt,kt,Vt),this._isUserControllingDolly=!0;break}case ACTION.ZOOM:{this._zoomInternal(-Nt,kt,Vt),this._isUserControllingZoom=!0;break}}this.dispatchEvent({type:"control"})},Et=Rt=>{if(!(!this._domElement||!this._enabled)){if(this.mouseButtons.right===RP.ACTION.NONE){const xt=Rt instanceof PointerEvent?Rt.pointerId:0,Nt=this._findPointerById(xt);Nt&&this._disposePointer(Nt),this._domElement.ownerDocument.removeEventListener("pointermove",dt,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",ht);return}Rt.preventDefault()}},yt=Rt=>{if(!this._enabled)return;if(extractClientCoordFromEvent(this._activePointers,_v2),this._getClientRect(this._elementRect),ot.copy(_v2),st.copy(_v2),this._activePointers.length>=2){const Nt=_v2.x-this._activePointers[1].clientX,kt=_v2.y-this._activePointers[1].clientY,Vt=Math.sqrt(Nt*Nt+kt*kt);at.set(0,Vt);const Ft=(this._activePointers[0].clientX+this._activePointers[1].clientX)*.5,zt=(this._activePointers[0].clientY+this._activePointers[1].clientY)*.5;st.set(Ft,zt)}if(this._state=0,!Rt)this._lockedPointer&&(this._state=this._state|this.mouseButtons.left);else if("pointerType"in Rt&&Rt.pointerType==="touch")switch(this._activePointers.length){case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three;break}else!this._lockedPointer&&(Rt.buttons&MOUSE_BUTTON.LEFT)===MOUSE_BUTTON.LEFT&&(this._state=this._state|this.mouseButtons.left),(Rt.buttons&MOUSE_BUTTON.MIDDLE)===MOUSE_BUTTON.MIDDLE&&(this._state=this._state|this.mouseButtons.middle),(Rt.buttons&MOUSE_BUTTON.RIGHT)===MOUSE_BUTTON.RIGHT&&(this._state=this._state|this.mouseButtons.right);((this._state&ACTION.ROTATE)===ACTION.ROTATE||(this._state&ACTION.TOUCH_ROTATE)===ACTION.TOUCH_ROTATE||(this._state&ACTION.TOUCH_DOLLY_ROTATE)===ACTION.TOUCH_DOLLY_ROTATE||(this._state&ACTION.TOUCH_ZOOM_ROTATE)===ACTION.TOUCH_ZOOM_ROTATE)&&(this._sphericalEnd.theta=this._spherical.theta,this._sphericalEnd.phi=this._spherical.phi,this._thetaVelocity.value=0,this._phiVelocity.value=0),((this._state&ACTION.TRUCK)===ACTION.TRUCK||(this._state&ACTION.SCREEN_PAN)===ACTION.SCREEN_PAN||(this._state&ACTION.TOUCH_TRUCK)===ACTION.TOUCH_TRUCK||(this._state&ACTION.TOUCH_SCREEN_PAN)===ACTION.TOUCH_SCREEN_PAN||(this._state&ACTION.TOUCH_DOLLY_TRUCK)===ACTION.TOUCH_DOLLY_TRUCK||(this._state&ACTION.TOUCH_DOLLY_SCREEN_PAN)===ACTION.TOUCH_DOLLY_SCREEN_PAN||(this._state&ACTION.TOUCH_ZOOM_TRUCK)===ACTION.TOUCH_ZOOM_TRUCK||(this._state&ACTION.TOUCH_ZOOM_SCREEN_PAN)===ACTION.TOUCH_DOLLY_SCREEN_PAN)&&(this._targetEnd.copy(this._target),this._targetVelocity.set(0,0,0)),((this._state&ACTION.DOLLY)===ACTION.DOLLY||(this._state&ACTION.TOUCH_DOLLY)===ACTION.TOUCH_DOLLY||(this._state&ACTION.TOUCH_DOLLY_TRUCK)===ACTION.TOUCH_DOLLY_TRUCK||(this._state&ACTION.TOUCH_DOLLY_SCREEN_PAN)===ACTION.TOUCH_DOLLY_SCREEN_PAN||(this._state&ACTION.TOUCH_DOLLY_OFFSET)===ACTION.TOUCH_DOLLY_OFFSET||(this._state&ACTION.TOUCH_DOLLY_ROTATE)===ACTION.TOUCH_DOLLY_ROTATE)&&(this._sphericalEnd.radius=this._spherical.radius,this._radiusVelocity.value=0),((this._state&ACTION.ZOOM)===ACTION.ZOOM||(this._state&ACTION.TOUCH_ZOOM)===ACTION.TOUCH_ZOOM||(this._state&ACTION.TOUCH_ZOOM_TRUCK)===ACTION.TOUCH_ZOOM_TRUCK||(this._state&ACTION.TOUCH_ZOOM_SCREEN_PAN)===ACTION.TOUCH_ZOOM_SCREEN_PAN||(this._state&ACTION.TOUCH_ZOOM_OFFSET)===ACTION.TOUCH_ZOOM_OFFSET||(this._state&ACTION.TOUCH_ZOOM_ROTATE)===ACTION.TOUCH_ZOOM_ROTATE)&&(this._zoomEnd=this._zoom,this._zoomVelocity.value=0),((this._state&ACTION.OFFSET)===ACTION.OFFSET||(this._state&ACTION.TOUCH_OFFSET)===ACTION.TOUCH_OFFSET||(this._state&ACTION.TOUCH_DOLLY_OFFSET)===ACTION.TOUCH_DOLLY_OFFSET||(this._state&ACTION.TOUCH_ZOOM_OFFSET)===ACTION.TOUCH_ZOOM_OFFSET)&&(this._focalOffsetEnd.copy(this._focalOffset),this._focalOffsetVelocity.set(0,0,0)),this.dispatchEvent({type:"controlstart"})},Ct=()=>{if(!this._enabled||!this._dragNeedsUpdate)return;this._dragNeedsUpdate=!1,extractClientCoordFromEvent(this._activePointers,_v2);const xt=this._domElement&&this._domElement.ownerDocument.pointerLockElement===this._domElement?this._lockedPointer||this._activePointers[0]:null,Nt=xt?-xt.deltaX:st.x-_v2.x,kt=xt?-xt.deltaY:st.y-_v2.y;if(st.copy(_v2),((this._state&ACTION.ROTATE)===ACTION.ROTATE||(this._state&ACTION.TOUCH_ROTATE)===ACTION.TOUCH_ROTATE||(this._state&ACTION.TOUCH_DOLLY_ROTATE)===ACTION.TOUCH_DOLLY_ROTATE||(this._state&ACTION.TOUCH_ZOOM_ROTATE)===ACTION.TOUCH_ZOOM_ROTATE)&&(this._rotateInternal(Nt,kt),this._isUserControllingRotate=!0),(this._state&ACTION.DOLLY)===ACTION.DOLLY||(this._state&ACTION.ZOOM)===ACTION.ZOOM){const Vt=this.dollyToCursor?(ot.x-this._elementRect.x)/this._elementRect.width*2-1:0,Ft=this.dollyToCursor?(ot.y-this._elementRect.y)/this._elementRect.height*-2+1:0,zt=this.dollyDragInverted?-1:1;(this._state&ACTION.DOLLY)===ACTION.DOLLY?(this._dollyInternal(zt*kt*TOUCH_DOLLY_FACTOR,Vt,Ft),this._isUserControllingDolly=!0):(this._zoomInternal(zt*kt*TOUCH_DOLLY_FACTOR,Vt,Ft),this._isUserControllingZoom=!0)}if((this._state&ACTION.TOUCH_DOLLY)===ACTION.TOUCH_DOLLY||(this._state&ACTION.TOUCH_ZOOM)===ACTION.TOUCH_ZOOM||(this._state&ACTION.TOUCH_DOLLY_TRUCK)===ACTION.TOUCH_DOLLY_TRUCK||(this._state&ACTION.TOUCH_ZOOM_TRUCK)===ACTION.TOUCH_ZOOM_TRUCK||(this._state&ACTION.TOUCH_DOLLY_SCREEN_PAN)===ACTION.TOUCH_DOLLY_SCREEN_PAN||(this._state&ACTION.TOUCH_ZOOM_SCREEN_PAN)===ACTION.TOUCH_ZOOM_SCREEN_PAN||(this._state&ACTION.TOUCH_DOLLY_OFFSET)===ACTION.TOUCH_DOLLY_OFFSET||(this._state&ACTION.TOUCH_ZOOM_OFFSET)===ACTION.TOUCH_ZOOM_OFFSET||(this._state&ACTION.TOUCH_DOLLY_ROTATE)===ACTION.TOUCH_DOLLY_ROTATE||(this._state&ACTION.TOUCH_ZOOM_ROTATE)===ACTION.TOUCH_ZOOM_ROTATE){const Vt=_v2.x-this._activePointers[1].clientX,Ft=_v2.y-this._activePointers[1].clientY,zt=Math.sqrt(Vt*Vt+Ft*Ft),Yt=at.y-zt;at.set(0,zt);const Kt=this.dollyToCursor?(st.x-this._elementRect.x)/this._elementRect.width*2-1:0,qt=this.dollyToCursor?(st.y-this._elementRect.y)/this._elementRect.height*-2+1:0;(this._state&ACTION.TOUCH_DOLLY)===ACTION.TOUCH_DOLLY||(this._state&ACTION.TOUCH_DOLLY_ROTATE)===ACTION.TOUCH_DOLLY_ROTATE||(this._state&ACTION.TOUCH_DOLLY_TRUCK)===ACTION.TOUCH_DOLLY_TRUCK||(this._state&ACTION.TOUCH_DOLLY_SCREEN_PAN)===ACTION.TOUCH_DOLLY_SCREEN_PAN||(this._state&ACTION.TOUCH_DOLLY_OFFSET)===ACTION.TOUCH_DOLLY_OFFSET?(this._dollyInternal(Yt*TOUCH_DOLLY_FACTOR,Kt,qt),this._isUserControllingDolly=!0):(this._zoomInternal(Yt*TOUCH_DOLLY_FACTOR,Kt,qt),this._isUserControllingZoom=!0)}((this._state&ACTION.TRUCK)===ACTION.TRUCK||(this._state&ACTION.TOUCH_TRUCK)===ACTION.TOUCH_TRUCK||(this._state&ACTION.TOUCH_DOLLY_TRUCK)===ACTION.TOUCH_DOLLY_TRUCK||(this._state&ACTION.TOUCH_ZOOM_TRUCK)===ACTION.TOUCH_ZOOM_TRUCK)&&(this._truckInternal(Nt,kt,!1,!1),this._isUserControllingTruck=!0),((this._state&ACTION.SCREEN_PAN)===ACTION.SCREEN_PAN||(this._state&ACTION.TOUCH_SCREEN_PAN)===ACTION.TOUCH_SCREEN_PAN||(this._state&ACTION.TOUCH_DOLLY_SCREEN_PAN)===ACTION.TOUCH_DOLLY_SCREEN_PAN||(this._state&ACTION.TOUCH_ZOOM_SCREEN_PAN)===ACTION.TOUCH_ZOOM_SCREEN_PAN)&&(this._truckInternal(Nt,kt,!1,!0),this._isUserControllingTruck=!0),((this._state&ACTION.OFFSET)===ACTION.OFFSET||(this._state&ACTION.TOUCH_OFFSET)===ACTION.TOUCH_OFFSET||(this._state&ACTION.TOUCH_DOLLY_OFFSET)===ACTION.TOUCH_DOLLY_OFFSET||(this._state&ACTION.TOUCH_ZOOM_OFFSET)===ACTION.TOUCH_ZOOM_OFFSET)&&(this._truckInternal(Nt,kt,!0,!1),this._isUserControllingOffset=!0),this.dispatchEvent({type:"control"})},wt=()=>{extractClientCoordFromEvent(this._activePointers,_v2),st.copy(_v2),this._dragNeedsUpdate=!1,(this._activePointers.length===0||this._activePointers.length===1&&this._activePointers[0]===this._lockedPointer)&&(this._isDragging=!1),this._activePointers.length===0&&this._domElement&&(this._domElement.ownerDocument.removeEventListener("pointermove",dt,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",ht),this.dispatchEvent({type:"controlend"}))};this.lockPointer=()=>{!this._enabled||!this._domElement||(this.cancel(),this._lockedPointer={pointerId:-1,clientX:0,clientY:0,deltaX:0,deltaY:0,mouseButton:null},this._activePointers.push(this._lockedPointer),this._domElement.ownerDocument.removeEventListener("pointermove",dt,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",ht),this._domElement.requestPointerLock(),this._domElement.ownerDocument.addEventListener("pointerlockchange",It),this._domElement.ownerDocument.addEventListener("pointerlockerror",Pt),this._domElement.ownerDocument.addEventListener("pointermove",dt,{passive:!1}),this._domElement.ownerDocument.addEventListener("pointerup",ht),yt())},this.unlockPointer=()=>{var Rt,xt,Nt;this._lockedPointer!==null&&(this._disposePointer(this._lockedPointer),this._lockedPointer=null),(Rt=this._domElement)===null||Rt===void 0||Rt.ownerDocument.exitPointerLock(),(xt=this._domElement)===null||xt===void 0||xt.ownerDocument.removeEventListener("pointerlockchange",It),(Nt=this._domElement)===null||Nt===void 0||Nt.ownerDocument.removeEventListener("pointerlockerror",Pt),this.cancel()};const It=()=>{this._domElement&&this._domElement.ownerDocument.pointerLockElement===this._domElement||this.unlockPointer()},Pt=()=>{this.unlockPointer()};this._addAllEventListeners=Rt=>{this._domElement=Rt,this._domElement.style.touchAction="none",this._domElement.style.userSelect="none",this._domElement.style.webkitUserSelect="none",this._domElement.addEventListener("pointerdown",lt),this._domElement.addEventListener("pointercancel",ht),this._domElement.addEventListener("wheel",gt,{passive:!1}),this._domElement.addEventListener("contextmenu",Et)},this._removeAllEventListeners=()=>{this._domElement&&(this._domElement.style.touchAction="",this._domElement.style.userSelect="",this._domElement.style.webkitUserSelect="",this._domElement.removeEventListener("pointerdown",lt),this._domElement.removeEventListener("pointercancel",ht),this._domElement.removeEventListener("wheel",gt,{passive:!1}),this._domElement.removeEventListener("contextmenu",Et),this._domElement.ownerDocument.removeEventListener("pointermove",dt,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",ht),this._domElement.ownerDocument.removeEventListener("pointerlockchange",It),this._domElement.ownerDocument.removeEventListener("pointerlockerror",Pt))},this.cancel=()=>{this._state!==ACTION.NONE&&(this._state=ACTION.NONE,this._activePointers.length=0,wt())},tt&&this.connect(tt),this.update(0)}get camera(){return this._camera}set camera(_){this._camera=_,this.updateCameraUp(),this._camera.updateProjectionMatrix(),this._updateNearPlaneCorners(),this._needsUpdate=!0}get enabled(){return this._enabled}set enabled(_){this._enabled=_,this._domElement&&(_?(this._domElement.style.touchAction="none",this._domElement.style.userSelect="none",this._domElement.style.webkitUserSelect="none"):(this.cancel(),this._domElement.style.touchAction="",this._domElement.style.userSelect="",this._domElement.style.webkitUserSelect=""))}get active(){return!this._hasRested}get currentAction(){return this._state}get distance(){return this._spherical.radius}set distance(_){this._spherical.radius===_&&this._sphericalEnd.radius===_||(this._spherical.radius=_,this._sphericalEnd.radius=_,this._needsUpdate=!0)}get azimuthAngle(){return this._spherical.theta}set azimuthAngle(_){this._spherical.theta===_&&this._sphericalEnd.theta===_||(this._spherical.theta=_,this._sphericalEnd.theta=_,this._needsUpdate=!0)}get polarAngle(){return this._spherical.phi}set polarAngle(_){this._spherical.phi===_&&this._sphericalEnd.phi===_||(this._spherical.phi=_,this._sphericalEnd.phi=_,this._needsUpdate=!0)}get boundaryEnclosesCamera(){return this._boundaryEnclosesCamera}set boundaryEnclosesCamera(_){this._boundaryEnclosesCamera=_,this._needsUpdate=!0}set interactiveArea(_){this._interactiveArea.width=clamp$1(_.width,0,1),this._interactiveArea.height=clamp$1(_.height,0,1),this._interactiveArea.x=clamp$1(_.x,0,1-this._interactiveArea.width),this._interactiveArea.y=clamp$1(_.y,0,1-this._interactiveArea.height)}addEventListener(_,tt){super.addEventListener(_,tt)}removeEventListener(_,tt){super.removeEventListener(_,tt)}rotate(_,tt,ot=!1){return this.rotateTo(this._sphericalEnd.theta+_,this._sphericalEnd.phi+tt,ot)}rotateAzimuthTo(_,tt=!1){return this.rotateTo(_,this._sphericalEnd.phi,tt)}rotatePolarTo(_,tt=!1){return this.rotateTo(this._sphericalEnd.theta,_,tt)}rotateTo(_,tt,ot=!1){this._isUserControllingRotate=!1;const st=clamp$1(_,this.minAzimuthAngle,this.maxAzimuthAngle),at=clamp$1(tt,this.minPolarAngle,this.maxPolarAngle);this._sphericalEnd.theta=st,this._sphericalEnd.phi=at,this._sphericalEnd.makeSafe(),this._needsUpdate=!0,ot||(this._spherical.theta=this._sphericalEnd.theta,this._spherical.phi=this._sphericalEnd.phi);const lt=!ot||approxEquals(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&approxEquals(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold);return this._createOnRestPromise(lt)}dolly(_,tt=!1){return this.dollyTo(this._sphericalEnd.radius-_,tt)}dollyTo(_,tt=!1){return this._isUserControllingDolly=!1,this._lastDollyDirection=DOLLY_DIRECTION.NONE,this._changedDolly=0,this._dollyToNoClamp(clamp$1(_,this.minDistance,this.maxDistance),tt)}_dollyToNoClamp(_,tt=!1){const ot=this._sphericalEnd.radius;if(this.colliderMeshes.length>=1){const lt=this._collisionTest(),dt=approxEquals(lt,this._spherical.radius);if(!(ot>_)&&dt)return Promise.resolve();this._sphericalEnd.radius=Math.min(_,lt)}else this._sphericalEnd.radius=_;this._needsUpdate=!0,tt||(this._spherical.radius=this._sphericalEnd.radius);const at=!tt||approxEquals(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(at)}dollyInFixed(_,tt=!1){this._targetEnd.add(this._getCameraDirection(_cameraDirection).multiplyScalar(_)),tt||this._target.copy(this._targetEnd);const ot=!tt||approxEquals(this._target.x,this._targetEnd.x,this.restThreshold)&&approxEquals(this._target.y,this._targetEnd.y,this.restThreshold)&&approxEquals(this._target.z,this._targetEnd.z,this.restThreshold);return this._createOnRestPromise(ot)}zoom(_,tt=!1){return this.zoomTo(this._zoomEnd+_,tt)}zoomTo(_,tt=!1){this._isUserControllingZoom=!1,this._zoomEnd=clamp$1(_,this.minZoom,this.maxZoom),this._needsUpdate=!0,tt||(this._zoom=this._zoomEnd);const ot=!tt||approxEquals(this._zoom,this._zoomEnd,this.restThreshold);return this._changedZoom=0,this._createOnRestPromise(ot)}pan(_,tt,ot=!1){return console.warn("`pan` has been renamed to `truck`"),this.truck(_,tt,ot)}truck(_,tt,ot=!1){this._camera.updateMatrix(),_xColumn.setFromMatrixColumn(this._camera.matrix,0),_yColumn.setFromMatrixColumn(this._camera.matrix,1),_xColumn.multiplyScalar(_),_yColumn.multiplyScalar(-tt);const st=_v3A.copy(_xColumn).add(_yColumn),at=_v3B.copy(this._targetEnd).add(st);return this.moveTo(at.x,at.y,at.z,ot)}forward(_,tt=!1){_v3A.setFromMatrixColumn(this._camera.matrix,0),_v3A.crossVectors(this._camera.up,_v3A),_v3A.multiplyScalar(_);const ot=_v3B.copy(this._targetEnd).add(_v3A);return this.moveTo(ot.x,ot.y,ot.z,tt)}elevate(_,tt=!1){return _v3A.copy(this._camera.up).multiplyScalar(_),this.moveTo(this._targetEnd.x+_v3A.x,this._targetEnd.y+_v3A.y,this._targetEnd.z+_v3A.z,tt)}moveTo(_,tt,ot,st=!1){this._isUserControllingTruck=!1;const at=_v3A.set(_,tt,ot).sub(this._targetEnd);this._encloseToBoundary(this._targetEnd,at,this.boundaryFriction),this._needsUpdate=!0,st||this._target.copy(this._targetEnd);const lt=!st||approxEquals(this._target.x,this._targetEnd.x,this.restThreshold)&&approxEquals(this._target.y,this._targetEnd.y,this.restThreshold)&&approxEquals(this._target.z,this._targetEnd.z,this.restThreshold);return this._createOnRestPromise(lt)}lookInDirectionOf(_,tt,ot,st=!1){const dt=_v3A.set(_,tt,ot).sub(this._targetEnd).normalize().multiplyScalar(-this._sphericalEnd.radius).add(this._targetEnd);return this.setPosition(dt.x,dt.y,dt.z,st)}fitToBox(_,tt,{cover:ot=!1,paddingLeft:st=0,paddingRight:at=0,paddingBottom:lt=0,paddingTop:dt=0}={}){const ht=[],ft=_.isBox3?_box3A.copy(_):_box3A.setFromObject(_);ft.isEmpty()&&(console.warn("camera-controls: fitTo() cannot be used with an empty box. Aborting"),Promise.resolve());const gt=roundToStep(this._sphericalEnd.theta,PI_HALF),Et=roundToStep(this._sphericalEnd.phi,PI_HALF);ht.push(this.rotateTo(gt,Et,tt));const yt=_v3A.setFromSpherical(this._sphericalEnd).normalize(),Ct=_quaternionA.setFromUnitVectors(yt,_AXIS_Z),wt=approxEquals(Math.abs(yt.y),1);wt&&Ct.multiply(_quaternionB.setFromAxisAngle(_AXIS_Y,gt)),Ct.multiply(this._yAxisUpSpaceInverse);const It=_box3B.makeEmpty();_v3B.copy(ft.min).applyQuaternion(Ct),It.expandByPoint(_v3B),_v3B.copy(ft.min).setX(ft.max.x).applyQuaternion(Ct),It.expandByPoint(_v3B),_v3B.copy(ft.min).setY(ft.max.y).applyQuaternion(Ct),It.expandByPoint(_v3B),_v3B.copy(ft.max).setZ(ft.min.z).applyQuaternion(Ct),It.expandByPoint(_v3B),_v3B.copy(ft.min).setZ(ft.max.z).applyQuaternion(Ct),It.expandByPoint(_v3B),_v3B.copy(ft.max).setY(ft.min.y).applyQuaternion(Ct),It.expandByPoint(_v3B),_v3B.copy(ft.max).setX(ft.min.x).applyQuaternion(Ct),It.expandByPoint(_v3B),_v3B.copy(ft.max).applyQuaternion(Ct),It.expandByPoint(_v3B),It.min.x-=st,It.min.y-=lt,It.max.x+=at,It.max.y+=dt,Ct.setFromUnitVectors(_AXIS_Z,yt),wt&&Ct.premultiply(_quaternionB.invert()),Ct.premultiply(this._yAxisUpSpace);const Pt=It.getSize(_v3A),Rt=It.getCenter(_v3B).applyQuaternion(Ct);if(isPerspectiveCamera(this._camera)){const xt=this.getDistanceToFitBox(Pt.x,Pt.y,Pt.z,ot);ht.push(this.moveTo(Rt.x,Rt.y,Rt.z,tt)),ht.push(this.dollyTo(xt,tt)),ht.push(this.setFocalOffset(0,0,0,tt))}else if(isOrthographicCamera(this._camera)){const xt=this._camera,Nt=xt.right-xt.left,kt=xt.top-xt.bottom,Vt=ot?Math.max(Nt/Pt.x,kt/Pt.y):Math.min(Nt/Pt.x,kt/Pt.y);ht.push(this.moveTo(Rt.x,Rt.y,Rt.z,tt)),ht.push(this.zoomTo(Vt,tt)),ht.push(this.setFocalOffset(0,0,0,tt))}return Promise.all(ht)}fitToSphere(_,tt){const ot=[],at="isObject3D"in _?RP.createBoundingSphere(_,_sphere):_sphere.copy(_);if(ot.push(this.moveTo(at.center.x,at.center.y,at.center.z,tt)),isPerspectiveCamera(this._camera)){const lt=this.getDistanceToFitSphere(at.radius);ot.push(this.dollyTo(lt,tt))}else if(isOrthographicCamera(this._camera)){const lt=this._camera.right-this._camera.left,dt=this._camera.top-this._camera.bottom,ht=2*at.radius,ft=Math.min(lt/ht,dt/ht);ot.push(this.zoomTo(ft,tt))}return ot.push(this.setFocalOffset(0,0,0,tt)),Promise.all(ot)}setLookAt(_,tt,ot,st,at,lt,dt=!1){this._isUserControllingRotate=!1,this._isUserControllingDolly=!1,this._isUserControllingTruck=!1,this._lastDollyDirection=DOLLY_DIRECTION.NONE,this._changedDolly=0;const ht=_v3B.set(st,at,lt),ft=_v3A.set(_,tt,ot);this._targetEnd.copy(ht),this._sphericalEnd.setFromVector3(ft.sub(ht).applyQuaternion(this._yAxisUpSpace)),this.normalizeRotations(),this._needsUpdate=!0,dt||(this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd));const gt=!dt||approxEquals(this._target.x,this._targetEnd.x,this.restThreshold)&&approxEquals(this._target.y,this._targetEnd.y,this.restThreshold)&&approxEquals(this._target.z,this._targetEnd.z,this.restThreshold)&&approxEquals(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&approxEquals(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold)&&approxEquals(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(gt)}lerpLookAt(_,tt,ot,st,at,lt,dt,ht,ft,gt,Et,yt,Ct,wt=!1){this._isUserControllingRotate=!1,this._isUserControllingDolly=!1,this._isUserControllingTruck=!1,this._lastDollyDirection=DOLLY_DIRECTION.NONE,this._changedDolly=0;const It=_v3A.set(st,at,lt),Pt=_v3B.set(_,tt,ot);_sphericalA.setFromVector3(Pt.sub(It).applyQuaternion(this._yAxisUpSpace));const Rt=_v3C.set(gt,Et,yt),xt=_v3B.set(dt,ht,ft);_sphericalB.setFromVector3(xt.sub(Rt).applyQuaternion(this._yAxisUpSpace)),this._targetEnd.copy(It.lerp(Rt,Ct));const Nt=_sphericalB.theta-_sphericalA.theta,kt=_sphericalB.phi-_sphericalA.phi,Vt=_sphericalB.radius-_sphericalA.radius;this._sphericalEnd.set(_sphericalA.radius+Vt*Ct,_sphericalA.phi+kt*Ct,_sphericalA.theta+Nt*Ct),this.normalizeRotations(),this._needsUpdate=!0,wt||(this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd));const Ft=!wt||approxEquals(this._target.x,this._targetEnd.x,this.restThreshold)&&approxEquals(this._target.y,this._targetEnd.y,this.restThreshold)&&approxEquals(this._target.z,this._targetEnd.z,this.restThreshold)&&approxEquals(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&approxEquals(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold)&&approxEquals(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(Ft)}setPosition(_,tt,ot,st=!1){return this.setLookAt(_,tt,ot,this._targetEnd.x,this._targetEnd.y,this._targetEnd.z,st)}setTarget(_,tt,ot,st=!1){const at=this.getPosition(_v3A),lt=this.setLookAt(at.x,at.y,at.z,_,tt,ot,st);return this._sphericalEnd.phi=clamp$1(this._sphericalEnd.phi,this.minPolarAngle,this.maxPolarAngle),lt}setFocalOffset(_,tt,ot,st=!1){this._isUserControllingOffset=!1,this._focalOffsetEnd.set(_,tt,ot),this._needsUpdate=!0,st||this._focalOffset.copy(this._focalOffsetEnd);const at=!st||approxEquals(this._focalOffset.x,this._focalOffsetEnd.x,this.restThreshold)&&approxEquals(this._focalOffset.y,this._focalOffsetEnd.y,this.restThreshold)&&approxEquals(this._focalOffset.z,this._focalOffsetEnd.z,this.restThreshold);return this._createOnRestPromise(at)}setOrbitPoint(_,tt,ot){this._camera.updateMatrixWorld(),_xColumn.setFromMatrixColumn(this._camera.matrixWorldInverse,0),_yColumn.setFromMatrixColumn(this._camera.matrixWorldInverse,1),_zColumn.setFromMatrixColumn(this._camera.matrixWorldInverse,2);const st=_v3A.set(_,tt,ot),at=st.distanceTo(this._camera.position),lt=st.sub(this._camera.position);_xColumn.multiplyScalar(lt.x),_yColumn.multiplyScalar(lt.y),_zColumn.multiplyScalar(lt.z),_v3A.copy(_xColumn).add(_yColumn).add(_zColumn),_v3A.z=_v3A.z+at,this.dollyTo(at,!1),this.setFocalOffset(-_v3A.x,_v3A.y,-_v3A.z,!1),this.moveTo(_,tt,ot,!1)}setBoundary(_){if(!_){this._boundary.min.set(-1/0,-1/0,-1/0),this._boundary.max.set(1/0,1/0,1/0),this._needsUpdate=!0;return}this._boundary.copy(_),this._boundary.clampPoint(this._targetEnd,this._targetEnd),this._needsUpdate=!0}setViewport(_,tt,ot,st){if(_===null){this._viewport=null;return}this._viewport=this._viewport||new THREE.Vector4,typeof _=="number"?this._viewport.set(_,tt,ot,st):this._viewport.copy(_)}getDistanceToFitBox(_,tt,ot,st=!1){if(notSupportedInOrthographicCamera(this._camera,"getDistanceToFitBox"))return this._spherical.radius;const at=_/tt,lt=this._camera.getEffectiveFOV()*DEG2RAD,dt=this._camera.aspect;return((st?at>dt:at<dt)?tt:_/dt)*.5/Math.tan(lt*.5)+ot*.5}getDistanceToFitSphere(_){if(notSupportedInOrthographicCamera(this._camera,"getDistanceToFitSphere"))return this._spherical.radius;const tt=this._camera.getEffectiveFOV()*DEG2RAD,ot=Math.atan(Math.tan(tt*.5)*this._camera.aspect)*2,st=1<this._camera.aspect?tt:ot;return _/Math.sin(st*.5)}getTarget(_,tt=!0){return(_&&_.isVector3?_:new THREE.Vector3).copy(tt?this._targetEnd:this._target)}getPosition(_,tt=!0){return(_&&_.isVector3?_:new THREE.Vector3).setFromSpherical(tt?this._sphericalEnd:this._spherical).applyQuaternion(this._yAxisUpSpaceInverse).add(tt?this._targetEnd:this._target)}getSpherical(_,tt=!0){return(_||new THREE.Spherical).copy(tt?this._sphericalEnd:this._spherical)}getFocalOffset(_,tt=!0){return(_&&_.isVector3?_:new THREE.Vector3).copy(tt?this._focalOffsetEnd:this._focalOffset)}normalizeRotations(){this._sphericalEnd.theta=this._sphericalEnd.theta%PI_2,this._sphericalEnd.theta<0&&(this._sphericalEnd.theta+=PI_2),this._spherical.theta+=PI_2*Math.round((this._sphericalEnd.theta-this._spherical.theta)/PI_2)}stop(){this._focalOffset.copy(this._focalOffsetEnd),this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd),this._zoom=this._zoomEnd}reset(_=!1){if(!approxEquals(this._camera.up.x,this._cameraUp0.x)||!approxEquals(this._camera.up.y,this._cameraUp0.y)||!approxEquals(this._camera.up.z,this._cameraUp0.z)){this._camera.up.copy(this._cameraUp0);const ot=this.getPosition(_v3A);this.updateCameraUp(),this.setPosition(ot.x,ot.y,ot.z)}const tt=[this.setLookAt(this._position0.x,this._position0.y,this._position0.z,this._target0.x,this._target0.y,this._target0.z,_),this.setFocalOffset(this._focalOffset0.x,this._focalOffset0.y,this._focalOffset0.z,_),this.zoomTo(this._zoom0,_)];return Promise.all(tt)}saveState(){this._cameraUp0.copy(this._camera.up),this.getTarget(this._target0),this.getPosition(this._position0),this._zoom0=this._zoom,this._focalOffset0.copy(this._focalOffset)}updateCameraUp(){this._yAxisUpSpace.setFromUnitVectors(this._camera.up,_AXIS_Y),this._yAxisUpSpaceInverse.copy(this._yAxisUpSpace).invert()}applyCameraUp(){const _=_v3A.subVectors(this._target,this._camera.position).normalize(),tt=_v3B.crossVectors(_,this._camera.up);this._camera.up.crossVectors(tt,_).normalize(),this._camera.updateMatrixWorld();const ot=this.getPosition(_v3A);this.updateCameraUp(),this.setPosition(ot.x,ot.y,ot.z)}update(_){const tt=this._sphericalEnd.theta-this._spherical.theta,ot=this._sphericalEnd.phi-this._spherical.phi,st=this._sphericalEnd.radius-this._spherical.radius,at=_deltaTarget.subVectors(this._targetEnd,this._target),lt=_deltaOffset.subVectors(this._focalOffsetEnd,this._focalOffset),dt=this._zoomEnd-this._zoom;if(approxZero(tt))this._thetaVelocity.value=0,this._spherical.theta=this._sphericalEnd.theta;else{const Et=this._isUserControllingRotate?this.draggingSmoothTime:this.smoothTime;this._spherical.theta=smoothDamp(this._spherical.theta,this._sphericalEnd.theta,this._thetaVelocity,Et,1/0,_),this._needsUpdate=!0}if(approxZero(ot))this._phiVelocity.value=0,this._spherical.phi=this._sphericalEnd.phi;else{const Et=this._isUserControllingRotate?this.draggingSmoothTime:this.smoothTime;this._spherical.phi=smoothDamp(this._spherical.phi,this._sphericalEnd.phi,this._phiVelocity,Et,1/0,_),this._needsUpdate=!0}if(approxZero(st))this._radiusVelocity.value=0,this._spherical.radius=this._sphericalEnd.radius;else{const Et=this._isUserControllingDolly?this.draggingSmoothTime:this.smoothTime;this._spherical.radius=smoothDamp(this._spherical.radius,this._sphericalEnd.radius,this._radiusVelocity,Et,this.maxSpeed,_),this._needsUpdate=!0}if(approxZero(at.x)&&approxZero(at.y)&&approxZero(at.z))this._targetVelocity.set(0,0,0),this._target.copy(this._targetEnd);else{const Et=this._isUserControllingTruck?this.draggingSmoothTime:this.smoothTime;smoothDampVec3(this._target,this._targetEnd,this._targetVelocity,Et,this.maxSpeed,_,this._target),this._needsUpdate=!0}if(approxZero(lt.x)&&approxZero(lt.y)&&approxZero(lt.z))this._focalOffsetVelocity.set(0,0,0),this._focalOffset.copy(this._focalOffsetEnd);else{const Et=this._isUserControllingOffset?this.draggingSmoothTime:this.smoothTime;smoothDampVec3(this._focalOffset,this._focalOffsetEnd,this._focalOffsetVelocity,Et,this.maxSpeed,_,this._focalOffset),this._needsUpdate=!0}if(approxZero(dt))this._zoomVelocity.value=0,this._zoom=this._zoomEnd;else{const Et=this._isUserControllingZoom?this.draggingSmoothTime:this.smoothTime;this._zoom=smoothDamp(this._zoom,this._zoomEnd,this._zoomVelocity,Et,1/0,_)}if(this.dollyToCursor){if(isPerspectiveCamera(this._camera)&&this._changedDolly!==0){const Et=this._spherical.radius-this._lastDistance,yt=this._camera,Ct=this._getCameraDirection(_cameraDirection),wt=_v3A.copy(Ct).cross(yt.up).normalize();wt.lengthSq()===0&&(wt.x=1);const It=_v3B.crossVectors(wt,Ct),Pt=this._sphericalEnd.radius*Math.tan(yt.getEffectiveFOV()*DEG2RAD*.5),xt=(this._sphericalEnd.radius-Et-this._sphericalEnd.radius)/this._sphericalEnd.radius,Nt=_v3C.copy(this._targetEnd).add(wt.multiplyScalar(this._dollyControlCoord.x*Pt*yt.aspect)).add(It.multiplyScalar(this._dollyControlCoord.y*Pt)),kt=_v3A.copy(this._targetEnd).lerp(Nt,xt),Vt=this._lastDollyDirection===DOLLY_DIRECTION.IN&&this._spherical.radius<=this.minDistance,Ft=this._lastDollyDirection===DOLLY_DIRECTION.OUT&&this.maxDistance<=this._spherical.radius;if(this.infinityDolly&&(Vt||Ft)){this._sphericalEnd.radius-=Et,this._spherical.radius-=Et;const Yt=_v3B.copy(Ct).multiplyScalar(-Et);kt.add(Yt)}this._boundary.clampPoint(kt,kt);const zt=_v3B.subVectors(kt,this._targetEnd);this._targetEnd.copy(kt),this._target.add(zt),this._changedDolly-=Et,approxZero(this._changedDolly)&&(this._changedDolly=0)}else if(isOrthographicCamera(this._camera)&&this._changedZoom!==0){const Et=this._zoom-this._lastZoom,yt=this._camera,Ct=_v3A.set(this._dollyControlCoord.x,this._dollyControlCoord.y,(yt.near+yt.far)/(yt.near-yt.far)).unproject(yt),wt=_v3B.set(0,0,-1).applyQuaternion(yt.quaternion),It=_v3C.copy(Ct).add(wt.multiplyScalar(-Ct.dot(yt.up))),Rt=-(this._zoom-Et-this._zoom)/this._zoom,xt=this._getCameraDirection(_cameraDirection),Nt=this._targetEnd.dot(xt),kt=_v3A.copy(this._targetEnd).lerp(It,Rt),Vt=kt.dot(xt),Ft=xt.multiplyScalar(Vt-Nt);kt.sub(Ft),this._boundary.clampPoint(kt,kt);const zt=_v3B.subVectors(kt,this._targetEnd);this._targetEnd.copy(kt),this._target.add(zt),this._changedZoom-=Et,approxZero(this._changedZoom)&&(this._changedZoom=0)}}this._camera.zoom!==this._zoom&&(this._camera.zoom=this._zoom,this._camera.updateProjectionMatrix(),this._updateNearPlaneCorners(),this._needsUpdate=!0),this._dragNeedsUpdate=!0;const ht=this._collisionTest();this._spherical.radius=Math.min(this._spherical.radius,ht),this._spherical.makeSafe(),this._camera.position.setFromSpherical(this._spherical).applyQuaternion(this._yAxisUpSpaceInverse).add(this._target),this._camera.lookAt(this._target),(!approxZero(this._focalOffset.x)||!approxZero(this._focalOffset.y)||!approxZero(this._focalOffset.z))&&(_xColumn.setFromMatrixColumn(this._camera.matrix,0),_yColumn.setFromMatrixColumn(this._camera.matrix,1),_zColumn.setFromMatrixColumn(this._camera.matrix,2),_xColumn.multiplyScalar(this._focalOffset.x),_yColumn.multiplyScalar(-this._focalOffset.y),_zColumn.multiplyScalar(this._focalOffset.z),_v3A.copy(_xColumn).add(_yColumn).add(_zColumn),this._camera.position.add(_v3A),this._camera.updateMatrixWorld()),this._boundaryEnclosesCamera&&this._encloseToBoundary(this._camera.position.copy(this._target),_v3A.setFromSpherical(this._spherical).applyQuaternion(this._yAxisUpSpaceInverse),1);const gt=this._needsUpdate;return gt&&!this._updatedLastTime?(this._hasRested=!1,this.dispatchEvent({type:"wake"}),this.dispatchEvent({type:"update"})):gt?(this.dispatchEvent({type:"update"}),approxZero(tt,this.restThreshold)&&approxZero(ot,this.restThreshold)&&approxZero(st,this.restThreshold)&&approxZero(at.x,this.restThreshold)&&approxZero(at.y,this.restThreshold)&&approxZero(at.z,this.restThreshold)&&approxZero(lt.x,this.restThreshold)&&approxZero(lt.y,this.restThreshold)&&approxZero(lt.z,this.restThreshold)&&approxZero(dt,this.restThreshold)&&!this._hasRested&&(this._hasRested=!0,this.dispatchEvent({type:"rest"}))):!gt&&this._updatedLastTime&&this.dispatchEvent({type:"sleep"}),this._lastDistance=this._spherical.radius,this._lastZoom=this._zoom,this._updatedLastTime=gt,this._needsUpdate=!1,gt}toJSON(){return JSON.stringify({enabled:this._enabled,minDistance:this.minDistance,maxDistance:infinityToMaxNumber(this.maxDistance),minZoom:this.minZoom,maxZoom:infinityToMaxNumber(this.maxZoom),minPolarAngle:this.minPolarAngle,maxPolarAngle:infinityToMaxNumber(this.maxPolarAngle),minAzimuthAngle:infinityToMaxNumber(this.minAzimuthAngle),maxAzimuthAngle:infinityToMaxNumber(this.maxAzimuthAngle),smoothTime:this.smoothTime,draggingSmoothTime:this.draggingSmoothTime,dollySpeed:this.dollySpeed,truckSpeed:this.truckSpeed,dollyToCursor:this.dollyToCursor,target:this._targetEnd.toArray(),position:_v3A.setFromSpherical(this._sphericalEnd).add(this._targetEnd).toArray(),zoom:this._zoomEnd,focalOffset:this._focalOffsetEnd.toArray(),target0:this._target0.toArray(),position0:this._position0.toArray(),zoom0:this._zoom0,focalOffset0:this._focalOffset0.toArray()})}fromJSON(_,tt=!1){const ot=JSON.parse(_);this.enabled=ot.enabled,this.minDistance=ot.minDistance,this.maxDistance=maxNumberToInfinity(ot.maxDistance),this.minZoom=ot.minZoom,this.maxZoom=maxNumberToInfinity(ot.maxZoom),this.minPolarAngle=ot.minPolarAngle,this.maxPolarAngle=maxNumberToInfinity(ot.maxPolarAngle),this.minAzimuthAngle=maxNumberToInfinity(ot.minAzimuthAngle),this.maxAzimuthAngle=maxNumberToInfinity(ot.maxAzimuthAngle),this.smoothTime=ot.smoothTime,this.draggingSmoothTime=ot.draggingSmoothTime,this.dollySpeed=ot.dollySpeed,this.truckSpeed=ot.truckSpeed,this.dollyToCursor=ot.dollyToCursor,this._target0.fromArray(ot.target0),this._position0.fromArray(ot.position0),this._zoom0=ot.zoom0,this._focalOffset0.fromArray(ot.focalOffset0),this.moveTo(ot.target[0],ot.target[1],ot.target[2],tt),_sphericalA.setFromVector3(_v3A.fromArray(ot.position).sub(this._targetEnd).applyQuaternion(this._yAxisUpSpace)),this.rotateTo(_sphericalA.theta,_sphericalA.phi,tt),this.dollyTo(_sphericalA.radius,tt),this.zoomTo(ot.zoom,tt),this.setFocalOffset(ot.focalOffset[0],ot.focalOffset[1],ot.focalOffset[2],tt),this._needsUpdate=!0}connect(_){if(this._domElement){console.warn("camera-controls is already connected.");return}_.setAttribute("data-camera-controls-version",VERSION),this._addAllEventListeners(_),this._getClientRect(this._elementRect)}disconnect(){this.cancel(),this._removeAllEventListeners(),this._domElement&&(this._domElement.removeAttribute("data-camera-controls-version"),this._domElement=void 0)}dispose(){this.removeAllEventListeners(),this.disconnect()}_getTargetDirection(_){return _.setFromSpherical(this._spherical).divideScalar(this._spherical.radius).applyQuaternion(this._yAxisUpSpaceInverse)}_getCameraDirection(_){return this._getTargetDirection(_).negate()}_findPointerById(_){return this._activePointers.find(tt=>tt.pointerId===_)}_findPointerByMouseButton(_){return this._activePointers.find(tt=>tt.mouseButton===_)}_disposePointer(_){this._activePointers.splice(this._activePointers.indexOf(_),1)}_encloseToBoundary(_,tt,ot){const st=tt.lengthSq();if(st===0)return _;const at=_v3B.copy(tt).add(_),dt=this._boundary.clampPoint(at,_v3C).sub(at),ht=dt.lengthSq();if(ht===0)return _.add(tt);if(ht===st)return _;if(ot===0)return _.add(tt).add(dt);{const ft=1+ot*ht/tt.dot(dt);return _.add(_v3B.copy(tt).multiplyScalar(ft)).add(dt.multiplyScalar(1-ot))}}_updateNearPlaneCorners(){if(isPerspectiveCamera(this._camera)){const _=this._camera,tt=_.near,ot=_.getEffectiveFOV()*DEG2RAD,st=Math.tan(ot*.5)*tt,at=st*_.aspect;this._nearPlaneCorners[0].set(-at,-st,0),this._nearPlaneCorners[1].set(at,-st,0),this._nearPlaneCorners[2].set(at,st,0),this._nearPlaneCorners[3].set(-at,st,0)}else if(isOrthographicCamera(this._camera)){const _=this._camera,tt=1/_.zoom,ot=_.left*tt,st=_.right*tt,at=_.top*tt,lt=_.bottom*tt;this._nearPlaneCorners[0].set(ot,at,0),this._nearPlaneCorners[1].set(st,at,0),this._nearPlaneCorners[2].set(st,lt,0),this._nearPlaneCorners[3].set(ot,lt,0)}}_collisionTest(){let _=1/0;if(!(this.colliderMeshes.length>=1)||notSupportedInOrthographicCamera(this._camera,"_collisionTest"))return _;const ot=this._getTargetDirection(_cameraDirection);_rotationMatrix.lookAt(_ORIGIN,ot,this._camera.up);for(let st=0;st<4;st++){const at=_v3B.copy(this._nearPlaneCorners[st]);at.applyMatrix4(_rotationMatrix);const lt=_v3C.addVectors(this._target,at);_raycaster.set(lt,ot),_raycaster.far=this._spherical.radius+1;const dt=_raycaster.intersectObjects(this.colliderMeshes);dt.length!==0&&dt[0].distance<_&&(_=dt[0].distance)}return _}_getClientRect(_){if(!this._domElement)return;const tt=this._domElement.getBoundingClientRect();return _.x=tt.left,_.y=tt.top,this._viewport?(_.x+=this._viewport.x,_.y+=tt.height-this._viewport.w-this._viewport.y,_.width=this._viewport.z,_.height=this._viewport.w):(_.width=tt.width,_.height=tt.height),_}_createOnRestPromise(_){return _?Promise.resolve():(this._hasRested=!1,this.dispatchEvent({type:"transitionstart"}),new Promise(tt=>{const ot=()=>{this.removeEventListener("rest",ot),tt()};this.addEventListener("rest",ot)}))}_addAllEventListeners(_){}_removeAllEventListeners(){}get dampingFactor(){return console.warn(".dampingFactor has been deprecated. use smoothTime (in seconds) instead."),0}set dampingFactor(_){console.warn(".dampingFactor has been deprecated. use smoothTime (in seconds) instead.")}get draggingDampingFactor(){return console.warn(".draggingDampingFactor has been deprecated. use draggingSmoothTime (in seconds) instead."),0}set draggingDampingFactor(_){console.warn(".draggingDampingFactor has been deprecated. use draggingSmoothTime (in seconds) instead.")}static createBoundingSphere(_,tt=new THREE.Sphere){const ot=tt,st=ot.center;_box3A.makeEmpty(),_.traverseVisible(lt=>{lt.isMesh&&_box3A.expandByObject(lt)}),_box3A.getCenter(st);let at=0;return _.traverseVisible(lt=>{if(!lt.isMesh)return;const dt=lt;if(!dt.geometry)return;const ht=dt.geometry.clone();ht.applyMatrix4(dt.matrixWorld);const gt=ht.attributes.position;for(let Et=0,yt=gt.count;Et<yt;Et++)_v3A.fromBufferAttribute(gt,Et),at=Math.max(at,st.distanceToSquared(_v3A))}),ot.radius=Math.sqrt(at),ot}};const CameraControls=reactExports.forwardRef((nt,_)=>{reactExports.useMemo(()=>{CameraControls$1.install({THREE:THREE$1}),extend$2({CameraControlsImpl:CameraControls$1})},[]);const{camera:tt,domElement:ot,makeDefault:st,onStart:at,onEnd:lt,onChange:dt,regress:ht,...ft}=nt,gt=useThree(Vt=>Vt.camera),Et=useThree(Vt=>Vt.gl),yt=useThree(Vt=>Vt.invalidate),Ct=useThree(Vt=>Vt.events),wt=useThree(Vt=>Vt.setEvents),It=useThree(Vt=>Vt.set),Pt=useThree(Vt=>Vt.get),Rt=useThree(Vt=>Vt.performance),xt=tt||gt,Nt=ot||Ct.connected||Et.domElement,kt=reactExports.useMemo(()=>new CameraControls$1(xt),[xt]);return useFrame((Vt,Ft)=>{kt.enabled&&kt.update(Ft)},-1),reactExports.useEffect(()=>(kt.connect(Nt),()=>void kt.disconnect()),[Nt,kt]),reactExports.useEffect(()=>{const Vt=Yt=>{yt(),ht&&Rt.regress(),dt&&dt(Yt)},Ft=Yt=>{at&&at(Yt)},zt=Yt=>{lt&&lt(Yt)};return kt.addEventListener("update",Vt),kt.addEventListener("controlstart",Ft),kt.addEventListener("controlend",zt),kt.addEventListener("control",Vt),kt.addEventListener("transitionstart",Vt),kt.addEventListener("wake",Vt),()=>{kt.removeEventListener("update",Vt),kt.removeEventListener("controlstart",Ft),kt.removeEventListener("controlend",zt),kt.removeEventListener("control",Vt),kt.removeEventListener("transitionstart",Vt),kt.removeEventListener("wake",Vt)}},[kt,at,lt,yt,wt,ht,dt]),reactExports.useEffect(()=>{if(st){const Vt=Pt().controls;return It({controls:kt}),()=>It({controls:Vt})}},[st,kt]),reactExports.createElement("primitive",_extends$1({ref:_,object:kt},ft))});function useAnimations(nt,_){const tt=reactExports.useRef(),[ot]=reactExports.useState(()=>_?_ instanceof Object3D?{current:_}:_:tt),[st]=reactExports.useState(()=>new AnimationMixer(void 0));reactExports.useLayoutEffect(()=>void(st._root=ot.current),[st,_]);const at=reactExports.useRef({}),[lt]=reactExports.useState(()=>{const dt={};return nt.forEach(ht=>Object.defineProperty(dt,ht.name,{enumerable:!0,get(){if(ot.current)return at.current[ht.name]||(at.current[ht.name]=st.clipAction(ht,ot.current))},configurable:!0})),{ref:ot,clips:nt,actions:dt,names:nt.map(ht=>ht.name),mixer:st}});return useFrame((dt,ht)=>st.update(ht)),reactExports.useEffect(()=>{const dt=ot.current;return()=>{at.current={},Object.values(lt.actions).forEach(ht=>{dt&&st.uncacheAction(ht,dt)})}},[nt]),reactExports.useEffect(()=>()=>{st.stopAllAction()},[st]),lt}const presetsObj={apartment:"lebombo_1k.hdr",city:"potsdamer_platz_1k.hdr",dawn:"kiara_1_dawn_1k.hdr",forest:"forest_slope_1k.hdr",lobby:"st_fagans_interior_1k.hdr",night:"dikhololo_night_1k.hdr",park:"rooitou_park_1k.hdr",studio:"studio_small_03_1k.hdr",sunset:"venice_sunset_1k.hdr",warehouse:"empty_warehouse_01_1k.hdr"},CUBEMAP_ROOT="https://raw.githack.com/pmndrs/drei-assets/456060a26bbeb8fdf79326f224b6d99b8bcce736/hdri/",isArray=nt=>Array.isArray(nt);function useEnvironment({files:nt=["/px.png","/nx.png","/py.png","/ny.png","/pz.png","/nz.png"],path:_="",preset:tt=void 0,encoding:ot=void 0,extensions:st}={}){var at;let lt=null,dt=!1,ht;if(tt){if(!(tt in presetsObj))throw new Error("Preset must be one of: "+Object.keys(presetsObj).join(", "));nt=presetsObj[tt],_=CUBEMAP_ROOT}if(dt=isArray(nt),ht=isArray(nt)?"cube":nt.startsWith("data:application/exr")?"exr":nt.startsWith("data:application/hdr")?"hdr":(at=nt.split(".").pop())==null?void 0:at.toLowerCase(),lt=dt?CubeTextureLoader:ht==="hdr"?RGBELoader:ht==="exr"?EXRLoader:null,!lt)throw new Error("useEnvironment: Unrecognized file extension: "+nt);const ft=useLoader(lt,dt?[nt]:nt,Ct=>{Ct.setPath==null||Ct.setPath(_),st&&st(Ct)}),gt=dt?ft[0]:ft;gt.mapping=dt?CubeReflectionMapping:EquirectangularReflectionMapping;const Et=3001,yt=3e3;return"colorSpace"in gt?gt.colorSpace=ot??dt?"srgb":"srgb-linear":gt.encoding=ot??dt?Et:yt,gt}const isRef=nt=>nt.current&&nt.current.isScene,resolveScene=nt=>isRef(nt)?nt.current:nt;function setEnvProps(nt,_,tt,ot,st=0){const at=resolveScene(_||tt),lt=at.background,dt=at.environment,ht=at.backgroundBlurriness||0;return nt!=="only"&&(at.environment=ot),nt&&(at.background=ot),nt&&at.backgroundBlurriness!==void 0&&(at.backgroundBlurriness=st),()=>{nt!=="only"&&(at.environment=dt),nt&&(at.background=lt),nt&&at.backgroundBlurriness!==void 0&&(at.backgroundBlurriness=ht)}}function EnvironmentMap({scene:nt,background:_=!1,blur:tt,map:ot}){const st=useThree(at=>at.scene);return reactExports.useLayoutEffect(()=>{if(ot)return setEnvProps(_,nt,st,ot,tt)},[st,nt,ot,_,tt]),null}function EnvironmentCube({background:nt=!1,scene:_,blur:tt,...ot}){const st=useEnvironment(ot),at=useThree(lt=>lt.scene);return reactExports.useLayoutEffect(()=>setEnvProps(nt,_,at,st,tt),[st,nt,_,at,tt]),null}function EnvironmentPortal({children:nt,near:_=1,far:tt=1e3,resolution:ot=256,frames:st=1,map:at,background:lt=!1,blur:dt,scene:ht,files:ft,path:gt,preset:Et=void 0,extensions:yt}){const Ct=useThree(Nt=>Nt.gl),wt=useThree(Nt=>Nt.scene),It=reactExports.useRef(null),[Pt]=reactExports.useState(()=>new Scene),Rt=reactExports.useMemo(()=>{const Nt=new WebGLCubeRenderTarget(ot);return Nt.texture.type=HalfFloatType,Nt},[ot]);reactExports.useLayoutEffect(()=>(st===1&&It.current.update(Ct,Pt),setEnvProps(lt,ht,wt,Rt.texture,dt)),[nt,Pt,Rt.texture,ht,wt,lt,st,Ct]);let xt=1;return useFrame(()=>{(st===1/0||xt<st)&&(It.current.update(Ct,Pt),xt++)}),reactExports.createElement(reactExports.Fragment,null,createPortal(reactExports.createElement(reactExports.Fragment,null,nt,reactExports.createElement("cubeCamera",{ref:It,args:[_,tt,Rt]}),ft||Et?reactExports.createElement(EnvironmentCube,{background:!0,files:ft,preset:Et,path:gt,extensions:yt}):at?reactExports.createElement(EnvironmentMap,{background:!0,map:at,extensions:yt}):null),Pt))}function EnvironmentGround(nt){var _,tt,ot,st;const at=useEnvironment(nt),lt=nt.map||at;reactExports.useMemo(()=>extend$2({GroundProjectedEnvImpl:GroundProjectedEnv}),[]);const dt=reactExports.useMemo(()=>[lt],[lt]),ht=(_=nt.ground)==null?void 0:_.height,ft=(tt=nt.ground)==null?void 0:tt.radius,gt=(ot=(st=nt.ground)==null?void 0:st.scale)!==null&&ot!==void 0?ot:1e3;return reactExports.createElement(reactExports.Fragment,null,reactExports.createElement(EnvironmentMap,_extends$1({},nt,{map:lt})),reactExports.createElement("groundProjectedEnvImpl",{args:dt,scale:gt,height:ht,radius:ft}))}function Environment(nt){return nt.ground?reactExports.createElement(EnvironmentGround,nt):nt.map?reactExports.createElement(EnvironmentMap,nt):nt.children?reactExports.createElement(EnvironmentPortal,nt):reactExports.createElement(EnvironmentCube,nt)}const ContactShadows=reactExports.forwardRef(({scale:nt=10,frames:_=1/0,opacity:tt=1,width:ot=1,height:st=1,blur:at=1,far:lt=10,resolution:dt=512,smooth:ht=!0,color:ft="#000000",depthWrite:gt=!1,renderOrder:Et,...yt},Ct)=>{const wt=reactExports.useRef(null),It=useThree(fn=>fn.scene),Pt=useThree(fn=>fn.gl),Rt=reactExports.useRef(null);ot=ot*(Array.isArray(nt)?nt[0]:nt||1),st=st*(Array.isArray(nt)?nt[1]:nt||1);const[xt,Nt,kt,Vt,Ft,zt,Yt]=reactExports.useMemo(()=>{const fn=new WebGLRenderTarget(dt,dt),dn=new WebGLRenderTarget(dt,dt);dn.texture.generateMipmaps=fn.texture.generateMipmaps=!1;const Cn=new PlaneGeometry(ot,st).rotateX(Math.PI/2),On=new Mesh(Cn),Pn=new MeshDepthMaterial;Pn.depthTest=Pn.depthWrite=!1,Pn.onBeforeCompile=Sn=>{Sn.uniforms={...Sn.uniforms,ucolor:{value:new Color$1(ft)}},Sn.fragmentShader=Sn.fragmentShader.replace("void main() {",`uniform vec3 ucolor;
           void main() {
          `),Sn.fragmentShader=Sn.fragmentShader.replace("vec4( vec3( 1.0 - fragCoordZ ), opacity );","vec4( ucolor * fragCoordZ * 2.0, ( 1.0 - fragCoordZ ) * 1.0 );")};const yn=new ShaderMaterial(HorizontalBlurShader),An=new ShaderMaterial(VerticalBlurShader);return An.depthTest=yn.depthTest=!1,[fn,Cn,Pn,On,yn,An,dn]},[dt,ot,st,nt,ft]),Kt=fn=>{Vt.visible=!0,Vt.material=Ft,Ft.uniforms.tDiffuse.value=xt.texture,Ft.uniforms.h.value=fn*1/256,Pt.setRenderTarget(Yt),Pt.render(Vt,Rt.current),Vt.material=zt,zt.uniforms.tDiffuse.value=Yt.texture,zt.uniforms.v.value=fn*1/256,Pt.setRenderTarget(xt),Pt.render(Vt,Rt.current),Vt.visible=!1};let qt=0,pn,an;return useFrame(()=>{Rt.current&&(_===1/0||qt<_)&&(qt++,pn=It.background,an=It.overrideMaterial,wt.current.visible=!1,It.background=null,It.overrideMaterial=kt,Pt.setRenderTarget(xt),Pt.render(It,Rt.current),Kt(at),ht&&Kt(at*.4),Pt.setRenderTarget(null),wt.current.visible=!0,It.overrideMaterial=an,It.background=pn)}),reactExports.useImperativeHandle(Ct,()=>wt.current,[]),reactExports.createElement("group",_extends$1({"rotation-x":Math.PI/2},yt,{ref:wt}),reactExports.createElement("mesh",{renderOrder:Et,geometry:Nt,scale:[1,-1,1],rotation:[-Math.PI/2,0,0]},reactExports.createElement("meshBasicMaterial",{transparent:!0,map:xt.texture,opacity:tt,depthWrite:gt})),reactExports.createElement("orthographicCamera",{ref:Rt,args:[-ot/2,ot/2,st/2,-st/2,0,lt]}))});var propTypes={exports:{}},ReactPropTypesSecret$1="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED",ReactPropTypesSecret_1=ReactPropTypesSecret$1,ReactPropTypesSecret=ReactPropTypesSecret_1;function emptyFunction(){}function emptyFunctionWithReset(){}emptyFunctionWithReset.resetWarningCache=emptyFunction;var factoryWithThrowingShims=function(){function nt(ot,st,at,lt,dt,ht){if(ht!==ReactPropTypesSecret){var ft=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw ft.name="Invariant Violation",ft}}nt.isRequired=nt;function _(){return nt}var tt={array:nt,bigint:nt,bool:nt,func:nt,number:nt,object:nt,string:nt,symbol:nt,any:nt,arrayOf:_,element:nt,elementType:nt,instanceOf:_,node:nt,objectOf:_,oneOf:_,oneOfType:_,shape:_,exact:_,checkPropTypes:emptyFunctionWithReset,resetWarningCache:emptyFunction};return tt.PropTypes=tt,tt};propTypes.exports=factoryWithThrowingShims();var propTypesExports=propTypes.exports;const PropTypes=getDefaultExportFromCjs(propTypesExports);function $6ed0406888f73fc4$var$setRef(nt,_){typeof nt=="function"?nt(_):nt!=null&&(nt.current=_)}function $6ed0406888f73fc4$export$43e446d32b3d21af(...nt){return _=>nt.forEach(tt=>$6ed0406888f73fc4$var$setRef(tt,_))}function $6ed0406888f73fc4$export$c7b2cbe3552a0d05(...nt){return reactExports.useCallback($6ed0406888f73fc4$export$43e446d32b3d21af(...nt),nt)}const $5e63c961fc1ce211$export$8c6ed5c666ac1360=reactExports.forwardRef((nt,_)=>{const{children:tt,...ot}=nt,st=reactExports.Children.toArray(tt),at=st.find($5e63c961fc1ce211$var$isSlottable);if(at){const lt=at.props.children,dt=st.map(ht=>ht===at?reactExports.Children.count(lt)>1?reactExports.Children.only(null):reactExports.isValidElement(lt)?lt.props.children:null:ht);return reactExports.createElement($5e63c961fc1ce211$var$SlotClone,_extends$1({},ot,{ref:_}),reactExports.isValidElement(lt)?reactExports.cloneElement(lt,void 0,dt):null)}return reactExports.createElement($5e63c961fc1ce211$var$SlotClone,_extends$1({},ot,{ref:_}),tt)});$5e63c961fc1ce211$export$8c6ed5c666ac1360.displayName="Slot";const $5e63c961fc1ce211$var$SlotClone=reactExports.forwardRef((nt,_)=>{const{children:tt,...ot}=nt;return reactExports.isValidElement(tt)?reactExports.cloneElement(tt,{...$5e63c961fc1ce211$var$mergeProps(ot,tt.props),ref:$6ed0406888f73fc4$export$43e446d32b3d21af(_,tt.ref)}):reactExports.Children.count(tt)>1?reactExports.Children.only(null):null});$5e63c961fc1ce211$var$SlotClone.displayName="SlotClone";const $5e63c961fc1ce211$export$d9f1ccf0bdb05d45=({children:nt})=>reactExports.createElement(reactExports.Fragment,null,nt);function $5e63c961fc1ce211$var$isSlottable(nt){return reactExports.isValidElement(nt)&&nt.type===$5e63c961fc1ce211$export$d9f1ccf0bdb05d45}function $5e63c961fc1ce211$var$mergeProps(nt,_){const tt={..._};for(const ot in _){const st=nt[ot],at=_[ot];/^on[A-Z]/.test(ot)?st&&at?tt[ot]=(...dt)=>{at(...dt),st(...dt)}:st&&(tt[ot]=st):ot==="style"?tt[ot]={...st,...at}:ot==="className"&&(tt[ot]=[st,at].filter(Boolean).join(" "))}return{...nt,...tt}}const $8927f6f2acc4f386$var$NODES=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","span","svg","ul"],$8927f6f2acc4f386$export$250ffa63cdc0d034=$8927f6f2acc4f386$var$NODES.reduce((nt,_)=>{const tt=reactExports.forwardRef((ot,st)=>{const{asChild:at,...lt}=ot,dt=at?$5e63c961fc1ce211$export$8c6ed5c666ac1360:_;return reactExports.useEffect(()=>{window[Symbol.for("radix-ui")]=!0},[]),reactExports.createElement(dt,_extends$1({},lt,{ref:st}))});return tt.displayName=`Primitive.${_}`,{...nt,[_]:tt}},{});function $8927f6f2acc4f386$export$6d1a0317bde7de7f(nt,_){nt&&reactDomExports.flushSync(()=>nt.dispatchEvent(_))}const $f1701beae083dbae$export$602eac185826482c=reactExports.forwardRef((nt,_)=>{var tt;const{container:ot=globalThis==null||(tt=globalThis.document)===null||tt===void 0?void 0:tt.body,...st}=nt;return ot?ReactDOM.createPortal(reactExports.createElement($8927f6f2acc4f386$export$250ffa63cdc0d034.div,_extends$1({},st,{ref:_})),ot):null}),$f1701beae083dbae$export$be92b6f5f03c0fe9=$f1701beae083dbae$export$602eac185826482c;var has=Object.prototype.hasOwnProperty;function dequal(nt,_){var tt,ot;if(nt===_)return!0;if(nt&&_&&(tt=nt.constructor)===_.constructor){if(tt===Date)return nt.getTime()===_.getTime();if(tt===RegExp)return nt.toString()===_.toString();if(tt===Array){if((ot=nt.length)===_.length)for(;ot--&&dequal(nt[ot],_[ot]););return ot===-1}if(!tt||typeof nt=="object"){ot=0;for(tt in nt)if(has.call(nt,tt)&&++ot&&!has.call(_,tt)||!(tt in _)||!dequal(nt[tt],_[tt]))return!1;return Object.keys(_).length===ot}}return nt!==nt&&_!==_}var Rule=function(_,tt,ot,st){this.name=_,this.fn=tt,this.args=ot,this.modifiers=st};Rule.prototype._test=function(_){var tt=this.fn;try{testAux(this.modifiers.slice(),tt,this)(_)}catch{tt=function(){return!1}}try{return testAux(this.modifiers.slice(),tt,this)(_)}catch{return!1}};Rule.prototype._check=function(_){try{testAux(this.modifiers.slice(),this.fn,this)(_)}catch{if(testAux(this.modifiers.slice(),function(ot){return ot},this)(!1))return}if(!testAux(this.modifiers.slice(),this.fn,this)(_))throw null};Rule.prototype._testAsync=function(_){var tt=this;return new Promise(function(ot,st){testAsyncAux(tt.modifiers.slice(),tt.fn,tt)(_).then(function(at){at?ot(_):st(null)}).catch(function(at){return st(at)})})};function pickFn(nt,_){return _===void 0&&(_="simple"),typeof nt=="object"?nt[_]:nt}function testAux(nt,_,tt){if(nt.length){var ot=nt.shift(),st=testAux(nt,_,tt);return ot.perform(st,tt)}else return pickFn(_)}function testAsyncAux(nt,_,tt){if(nt.length){var ot=nt.shift(),st=testAsyncAux(nt,_,tt);return ot.performAsync(st,tt)}else return function(at){return Promise.resolve(pickFn(_,"async")(at))}}var Modifier=function(_,tt,ot){this.name=_,this.perform=tt,this.performAsync=ot},ValidationError=function(nt){function _(tt,ot,st,at){for(var lt=[],dt=arguments.length-4;dt-- >0;)lt[dt]=arguments[dt+4];nt.call(this,lt),nt.captureStackTrace&&nt.captureStackTrace(this,_),this.rule=tt,this.value=ot,this.cause=st,this.target=at}return nt&&(_.__proto__=nt),_.prototype=Object.create(nt&&nt.prototype),_.prototype.constructor=_,_}(Error),Context=function(_,tt){_===void 0&&(_=[]),tt===void 0&&(tt=[]),this.chain=_,this.nextRuleModifiers=tt};Context.prototype._applyRule=function(_,tt){var ot=this;return function(){for(var st=[],at=arguments.length;at--;)st[at]=arguments[at];return ot.chain.push(new Rule(tt,_.apply(ot,st),st,ot.nextRuleModifiers)),ot.nextRuleModifiers=[],ot}};Context.prototype._applyModifier=function(_,tt){return this.nextRuleModifiers.push(new Modifier(tt,_.simple,_.async)),this};Context.prototype._clone=function(){return new Context(this.chain.slice(),this.nextRuleModifiers.slice())};Context.prototype.test=function(_){return this.chain.every(function(tt){return tt._test(_)})};Context.prototype.testAll=function(_){var tt=[];return this.chain.forEach(function(ot){try{ot._check(_)}catch(st){tt.push(new ValidationError(ot,_,st))}}),tt};Context.prototype.check=function(_){this.chain.forEach(function(tt){try{tt._check(_)}catch(ot){throw new ValidationError(tt,_,ot)}})};Context.prototype.testAsync=function(_){var tt=this;return new Promise(function(ot,st){executeAsyncRules(_,tt.chain.slice(),ot,st)})};function executeAsyncRules(nt,_,tt,ot){if(_.length){var st=_.shift();st._testAsync(nt).then(function(){executeAsyncRules(nt,_,tt,ot)},function(at){ot(new ValidationError(st,nt,at))})}else tt(nt)}var consideredEmpty=function(nt,_){return _&&typeof nt=="string"&&nt.trim().length===0?!0:nt==null};function optional(nt,_){return _===void 0&&(_=!1),{simple:function(tt){return consideredEmpty(tt,_)||nt.check(tt)===void 0},async:function(tt){return consideredEmpty(tt,_)||nt.testAsync(tt)}}}function v8n(){return typeof Proxy<"u"?proxyContext(new Context):proxylessContext(new Context)}var customRules={};v8n.extend=function(nt){Object.assign(customRules,nt)};v8n.clearCustomRules=function(){customRules={}};function proxyContext(nt){return new Proxy(nt,{get:function(tt,ot){if(ot in tt)return tt[ot];var st=proxyContext(nt._clone());if(ot in availableModifiers)return st._applyModifier(availableModifiers[ot],ot);if(ot in customRules)return st._applyRule(customRules[ot],ot);if(ot in availableRules)return st._applyRule(availableRules[ot],ot)}})}function proxylessContext(nt){var _=function(st,at){return Object.keys(st).forEach(function(lt){at[lt]=function(){for(var dt=[],ht=arguments.length;ht--;)dt[ht]=arguments[ht];var ft=proxylessContext(at._clone()),gt=ft._applyRule(st[lt],lt).apply(void 0,dt);return gt}}),at},tt=_(availableRules,nt),ot=_(customRules,tt);return Object.keys(availableModifiers).forEach(function(st){Object.defineProperty(ot,st,{get:function(){var at=proxylessContext(ot._clone());return at._applyModifier(availableModifiers[st],st)}})}),ot}var availableModifiers={not:{simple:function(nt){return function(_){return!nt(_)}},async:function(nt){return function(_){return Promise.resolve(nt(_)).then(function(tt){return!tt}).catch(function(){return!0})}}},some:{simple:function(nt){return function(_){return split$1(_).some(function(tt){try{return nt(tt)}catch{return!1}})}},async:function(nt){return function(_){return Promise.all(split$1(_).map(function(tt){try{return nt(tt).catch(function(){return!1})}catch{return!1}})).then(function(tt){return tt.some(Boolean)})}}},every:{simple:function(nt){return function(_){return _!==!1&&split$1(_).every(nt)}},async:function(nt){return function(_){return Promise.all(split$1(_).map(nt)).then(function(tt){return tt.every(Boolean)})}}},strict:{simple:function(nt,_){return function(tt){return isSchemaRule(_)&&tt&&typeof tt=="object"?Object.keys(_.args[0]).length===Object.keys(tt).length&&nt(tt):nt(tt)}},async:function(nt,_){return function(tt){return Promise.resolve(nt(tt)).then(function(ot){return isSchemaRule(_)&&tt&&typeof tt=="object"?Object.keys(_.args[0]).length===Object.keys(tt).length&&ot:ot}).catch(function(){return!1})}}}};function isSchemaRule(nt){return nt&&nt.name==="schema"&&nt.args.length>0&&typeof nt.args[0]=="object"}function split$1(nt){return typeof nt=="string"?nt.split(""):nt}var availableRules={equal:function(nt){return function(_){return _==nt}},exact:function(nt){return function(_){return _===nt}},number:function(nt){return nt===void 0&&(nt=!0),function(_){return typeof _=="number"&&(nt||isFinite(_))}},integer:function(){return function(nt){var _=Number.isInteger||isIntegerPolyfill;return _(nt)}},numeric:function(){return function(nt){return!isNaN(parseFloat(nt))&&isFinite(nt)}},string:function(){return testType("string")},boolean:function(){return testType("boolean")},undefined:function(){return testType("undefined")},null:function(){return testType("null")},array:function(){return testType("array")},object:function(){return testType("object")},instanceOf:function(nt){return function(_){return _ instanceof nt}},pattern:function(nt){return function(_){return nt.test(_)}},lowercase:function(){return function(nt){return typeof nt=="boolean"||nt===nt.toLowerCase()&&nt.trim()!==""}},uppercase:function(){return function(nt){return nt===nt.toUpperCase()&&nt.trim()!==""}},vowel:function(){return function(nt){return/^[aeiou]+$/i.test(nt)}},consonant:function(){return function(nt){return/^(?=[^aeiou])([a-z]+)$/i.test(nt)}},first:function(nt){return function(_){return _[0]==nt}},last:function(nt){return function(_){return _[_.length-1]==nt}},empty:function(){return function(nt){return nt.length===0}},length:function(nt,_){return function(tt){return tt.length>=nt&&tt.length<=(_||nt)}},minLength:function(nt){return function(_){return _.length>=nt}},maxLength:function(nt){return function(_){return _.length<=nt}},negative:function(){return function(nt){return nt<0}},positive:function(){return function(nt){return nt>=0}},between:function(nt,_){return function(tt){return tt>=nt&&tt<=_}},range:function(nt,_){return function(tt){return tt>=nt&&tt<=_}},lessThan:function(nt){return function(_){return _<nt}},lessThanOrEqual:function(nt){return function(_){return _<=nt}},greaterThan:function(nt){return function(_){return _>nt}},greaterThanOrEqual:function(nt){return function(_){return _>=nt}},even:function(){return function(nt){return nt%2===0}},odd:function(){return function(nt){return nt%2!==0}},includes:function(nt){return function(_){return~_.indexOf(nt)}},schema:function(nt){return testSchema(nt)},passesAnyOf:function(){for(var nt=[],_=arguments.length;_--;)nt[_]=arguments[_];return function(tt){return nt.some(function(ot){return ot.test(tt)})}},optional};function testType(nt){return function(_){return Array.isArray(_)&&nt==="array"||_===null&&nt==="null"||typeof _===nt}}function isIntegerPolyfill(nt){return typeof nt=="number"&&isFinite(nt)&&Math.floor(nt)===nt}function testSchema(nt){return{simple:function(_){var tt=[];if(Object.keys(nt).forEach(function(ot){var st=nt[ot];try{st.check((_||{})[ot])}catch(at){at.target=ot,tt.push(at)}}),tt.length>0)throw tt;return!0},async:function(_){var tt=[],ot=Object.keys(nt).map(function(st){var at=nt[st];return at.testAsync((_||{})[st]).catch(function(lt){lt.target=st,tt.push(lt)})});return Promise.all(ot).then(function(){if(tt.length>0)throw tt;return!0})}}}var e$2="colors",t$2="sizes",r$3="space",n$3={gap:r$3,gridGap:r$3,columnGap:r$3,gridColumnGap:r$3,rowGap:r$3,gridRowGap:r$3,inset:r$3,insetBlock:r$3,insetBlockEnd:r$3,insetBlockStart:r$3,insetInline:r$3,insetInlineEnd:r$3,insetInlineStart:r$3,margin:r$3,marginTop:r$3,marginRight:r$3,marginBottom:r$3,marginLeft:r$3,marginBlock:r$3,marginBlockEnd:r$3,marginBlockStart:r$3,marginInline:r$3,marginInlineEnd:r$3,marginInlineStart:r$3,padding:r$3,paddingTop:r$3,paddingRight:r$3,paddingBottom:r$3,paddingLeft:r$3,paddingBlock:r$3,paddingBlockEnd:r$3,paddingBlockStart:r$3,paddingInline:r$3,paddingInlineEnd:r$3,paddingInlineStart:r$3,top:r$3,right:r$3,bottom:r$3,left:r$3,scrollMargin:r$3,scrollMarginTop:r$3,scrollMarginRight:r$3,scrollMarginBottom:r$3,scrollMarginLeft:r$3,scrollMarginX:r$3,scrollMarginY:r$3,scrollMarginBlock:r$3,scrollMarginBlockEnd:r$3,scrollMarginBlockStart:r$3,scrollMarginInline:r$3,scrollMarginInlineEnd:r$3,scrollMarginInlineStart:r$3,scrollPadding:r$3,scrollPaddingTop:r$3,scrollPaddingRight:r$3,scrollPaddingBottom:r$3,scrollPaddingLeft:r$3,scrollPaddingX:r$3,scrollPaddingY:r$3,scrollPaddingBlock:r$3,scrollPaddingBlockEnd:r$3,scrollPaddingBlockStart:r$3,scrollPaddingInline:r$3,scrollPaddingInlineEnd:r$3,scrollPaddingInlineStart:r$3,fontSize:"fontSizes",background:e$2,backgroundColor:e$2,backgroundImage:e$2,borderImage:e$2,border:e$2,borderBlock:e$2,borderBlockEnd:e$2,borderBlockStart:e$2,borderBottom:e$2,borderBottomColor:e$2,borderColor:e$2,borderInline:e$2,borderInlineEnd:e$2,borderInlineStart:e$2,borderLeft:e$2,borderLeftColor:e$2,borderRight:e$2,borderRightColor:e$2,borderTop:e$2,borderTopColor:e$2,caretColor:e$2,color:e$2,columnRuleColor:e$2,fill:e$2,outline:e$2,outlineColor:e$2,stroke:e$2,textDecorationColor:e$2,fontFamily:"fonts",fontWeight:"fontWeights",lineHeight:"lineHeights",letterSpacing:"letterSpacings",blockSize:t$2,minBlockSize:t$2,maxBlockSize:t$2,inlineSize:t$2,minInlineSize:t$2,maxInlineSize:t$2,width:t$2,minWidth:t$2,maxWidth:t$2,height:t$2,minHeight:t$2,maxHeight:t$2,flexBasis:t$2,gridTemplateColumns:t$2,gridTemplateRows:t$2,borderWidth:"borderWidths",borderTopWidth:"borderWidths",borderRightWidth:"borderWidths",borderBottomWidth:"borderWidths",borderLeftWidth:"borderWidths",borderStyle:"borderStyles",borderTopStyle:"borderStyles",borderRightStyle:"borderStyles",borderBottomStyle:"borderStyles",borderLeftStyle:"borderStyles",borderRadius:"radii",borderTopLeftRadius:"radii",borderTopRightRadius:"radii",borderBottomRightRadius:"radii",borderBottomLeftRadius:"radii",boxShadow:"shadows",textShadow:"shadows",transition:"transitions",zIndex:"zIndices"},i$4=(nt,_)=>typeof _=="function"?{"()":Function.prototype.toString.call(_)}:_,o$3=()=>{const nt=Object.create(null);return(_,tt,...ot)=>{const st=(at=>JSON.stringify(at,i$4))(_);return st in nt?nt[st]:nt[st]=tt(_,...ot)}},l$3=Symbol.for("sxs.internal"),s$4=(nt,_)=>Object.defineProperties(nt,Object.getOwnPropertyDescriptors(_)),a$3=nt=>{for(const _ in nt)return!0;return!1},{hasOwnProperty:c$4}=Object.prototype,d$4=nt=>nt.includes("-")?nt:nt.replace(/[A-Z]/g,_=>"-"+_.toLowerCase()),g$4=/\s+(?![^()]*\))/,p$4=nt=>_=>nt(...typeof _=="string"?String(_).split(g$4):[_]),u$4={appearance:nt=>({WebkitAppearance:nt,appearance:nt}),backfaceVisibility:nt=>({WebkitBackfaceVisibility:nt,backfaceVisibility:nt}),backdropFilter:nt=>({WebkitBackdropFilter:nt,backdropFilter:nt}),backgroundClip:nt=>({WebkitBackgroundClip:nt,backgroundClip:nt}),boxDecorationBreak:nt=>({WebkitBoxDecorationBreak:nt,boxDecorationBreak:nt}),clipPath:nt=>({WebkitClipPath:nt,clipPath:nt}),content:nt=>({content:nt.includes('"')||nt.includes("'")||/^([A-Za-z]+\([^]*|[^]*-quote|inherit|initial|none|normal|revert|unset)$/.test(nt)?nt:`"${nt}"`}),hyphens:nt=>({WebkitHyphens:nt,hyphens:nt}),maskImage:nt=>({WebkitMaskImage:nt,maskImage:nt}),maskSize:nt=>({WebkitMaskSize:nt,maskSize:nt}),tabSize:nt=>({MozTabSize:nt,tabSize:nt}),textSizeAdjust:nt=>({WebkitTextSizeAdjust:nt,textSizeAdjust:nt}),userSelect:nt=>({WebkitUserSelect:nt,userSelect:nt}),marginBlock:p$4((nt,_)=>({marginBlockStart:nt,marginBlockEnd:_||nt})),marginInline:p$4((nt,_)=>({marginInlineStart:nt,marginInlineEnd:_||nt})),maxSize:p$4((nt,_)=>({maxBlockSize:nt,maxInlineSize:_||nt})),minSize:p$4((nt,_)=>({minBlockSize:nt,minInlineSize:_||nt})),paddingBlock:p$4((nt,_)=>({paddingBlockStart:nt,paddingBlockEnd:_||nt})),paddingInline:p$4((nt,_)=>({paddingInlineStart:nt,paddingInlineEnd:_||nt}))},h$4=/([\d.]+)([^]*)/,f$4=(nt,_)=>nt.length?nt.reduce((tt,ot)=>(tt.push(..._.map(st=>st.includes("&")?st.replace(/&/g,/[ +>|~]/.test(ot)&&/&.*&/.test(st)?`:is(${ot})`:ot):ot+" "+st)),tt),[]):_,m$4=(nt,_)=>nt in b$4&&typeof _=="string"?_.replace(/^((?:[^]*[^\w-])?)(fit-content|stretch)((?:[^\w-][^]*)?)$/,(tt,ot,st,at)=>ot+(st==="stretch"?`-moz-available${at};${d$4(nt)}:${ot}-webkit-fill-available`:`-moz-fit-content${at};${d$4(nt)}:${ot}fit-content`)+at):String(_),b$4={blockSize:1,height:1,inlineSize:1,maxBlockSize:1,maxHeight:1,maxInlineSize:1,maxWidth:1,minBlockSize:1,minHeight:1,minInlineSize:1,minWidth:1,width:1},S$3=nt=>nt?nt+"-":"",k$3=(nt,_,tt)=>nt.replace(/([+-])?((?:\d+(?:\.\d*)?|\.\d+)(?:[Ee][+-]?\d+)?)?(\$|--)([$\w-]+)/g,(ot,st,at,lt,dt)=>lt=="$"==!!at?ot:(st||lt=="--"?"calc(":"")+"var(--"+(lt==="$"?S$3(_)+(dt.includes("$")?"":S$3(tt))+dt.replace(/\$/g,"-"):dt)+")"+(st||lt=="--"?"*"+(st||"")+(at||"1")+")":"")),y$4=/\s*,\s*(?![^()]*\))/,B=Object.prototype.toString,$$2=(nt,_,tt,ot,st)=>{let at,lt,dt;const ht=(ft,gt,Et)=>{let yt,Ct;const wt=It=>{for(yt in It){const xt=yt.charCodeAt(0)===64,Nt=xt&&Array.isArray(It[yt])?It[yt]:[It[yt]];for(Ct of Nt){const kt=/[A-Z]/.test(Rt=yt)?Rt:Rt.replace(/-[^]/g,Ft=>Ft[1].toUpperCase()),Vt=typeof Ct=="object"&&Ct&&Ct.toString===B&&(!ot.utils[kt]||!gt.length);if(kt in ot.utils&&!Vt){const Ft=ot.utils[kt];if(Ft!==lt){lt=Ft,wt(Ft(Ct)),lt=null;continue}}else if(kt in u$4){const Ft=u$4[kt];if(Ft!==dt){dt=Ft,wt(Ft(Ct)),dt=null;continue}}if(xt&&(Pt=yt.slice(1)in ot.media?"@media "+ot.media[yt.slice(1)]:yt,yt=Pt.replace(/\(\s*([\w-]+)\s*(=|<|<=|>|>=)\s*([\w-]+)\s*(?:(<|<=|>|>=)\s*([\w-]+)\s*)?\)/g,(Ft,zt,Yt,Kt,qt,pn)=>{const an=h$4.test(zt),fn=.0625*(an?-1:1),[dn,Cn]=an?[Kt,zt]:[zt,Kt];return"("+(Yt[0]==="="?"":Yt[0]===">"===an?"max-":"min-")+dn+":"+(Yt[0]!=="="&&Yt.length===1?Cn.replace(h$4,(On,Pn,yn)=>Number(Pn)+fn*(Yt===">"?1:-1)+yn):Cn)+(qt?") and ("+(qt[0]===">"?"min-":"max-")+dn+":"+(qt.length===1?pn.replace(h$4,(On,Pn,yn)=>Number(Pn)+fn*(qt===">"?-1:1)+yn):pn):"")+")"})),Vt){const Ft=xt?Et.concat(yt):[...Et],zt=xt?[...gt]:f$4(gt,yt.split(y$4));at!==void 0&&st(x$3(...at)),at=void 0,ht(Ct,zt,Ft)}else at===void 0&&(at=[[],gt,Et]),yt=xt||yt.charCodeAt(0)!==36?yt:`--${S$3(ot.prefix)}${yt.slice(1).replace(/\$/g,"-")}`,Ct=Vt?Ct:typeof Ct=="number"?Ct&&kt in I$2?String(Ct)+"px":String(Ct):k$3(m$4(kt,Ct??""),ot.prefix,ot.themeMap[kt]),at[0].push(`${xt?`${yt} `:`${d$4(yt)}:`}${Ct}`)}}var Pt,Rt};wt(ft),at!==void 0&&st(x$3(...at)),at=void 0};ht(nt,_,tt)},x$3=(nt,_,tt)=>`${tt.map(ot=>`${ot}{`).join("")}${_.length?`${_.join(",")}{`:""}${nt.join(";")}${_.length?"}":""}${Array(tt.length?tt.length+1:0).join("}")}`,I$2={animationDelay:1,animationDuration:1,backgroundSize:1,blockSize:1,border:1,borderBlock:1,borderBlockEnd:1,borderBlockEndWidth:1,borderBlockStart:1,borderBlockStartWidth:1,borderBlockWidth:1,borderBottom:1,borderBottomLeftRadius:1,borderBottomRightRadius:1,borderBottomWidth:1,borderEndEndRadius:1,borderEndStartRadius:1,borderInlineEnd:1,borderInlineEndWidth:1,borderInlineStart:1,borderInlineStartWidth:1,borderInlineWidth:1,borderLeft:1,borderLeftWidth:1,borderRadius:1,borderRight:1,borderRightWidth:1,borderSpacing:1,borderStartEndRadius:1,borderStartStartRadius:1,borderTop:1,borderTopLeftRadius:1,borderTopRightRadius:1,borderTopWidth:1,borderWidth:1,bottom:1,columnGap:1,columnRule:1,columnRuleWidth:1,columnWidth:1,containIntrinsicSize:1,flexBasis:1,fontSize:1,gap:1,gridAutoColumns:1,gridAutoRows:1,gridTemplateColumns:1,gridTemplateRows:1,height:1,inlineSize:1,inset:1,insetBlock:1,insetBlockEnd:1,insetBlockStart:1,insetInline:1,insetInlineEnd:1,insetInlineStart:1,left:1,letterSpacing:1,margin:1,marginBlock:1,marginBlockEnd:1,marginBlockStart:1,marginBottom:1,marginInline:1,marginInlineEnd:1,marginInlineStart:1,marginLeft:1,marginRight:1,marginTop:1,maxBlockSize:1,maxHeight:1,maxInlineSize:1,maxWidth:1,minBlockSize:1,minHeight:1,minInlineSize:1,minWidth:1,offsetDistance:1,offsetRotate:1,outline:1,outlineOffset:1,outlineWidth:1,overflowClipMargin:1,padding:1,paddingBlock:1,paddingBlockEnd:1,paddingBlockStart:1,paddingBottom:1,paddingInline:1,paddingInlineEnd:1,paddingInlineStart:1,paddingLeft:1,paddingRight:1,paddingTop:1,perspective:1,right:1,rowGap:1,scrollMargin:1,scrollMarginBlock:1,scrollMarginBlockEnd:1,scrollMarginBlockStart:1,scrollMarginBottom:1,scrollMarginInline:1,scrollMarginInlineEnd:1,scrollMarginInlineStart:1,scrollMarginLeft:1,scrollMarginRight:1,scrollMarginTop:1,scrollPadding:1,scrollPaddingBlock:1,scrollPaddingBlockEnd:1,scrollPaddingBlockStart:1,scrollPaddingBottom:1,scrollPaddingInline:1,scrollPaddingInlineEnd:1,scrollPaddingInlineStart:1,scrollPaddingLeft:1,scrollPaddingRight:1,scrollPaddingTop:1,shapeMargin:1,textDecoration:1,textDecorationThickness:1,textIndent:1,textUnderlineOffset:1,top:1,transitionDelay:1,transitionDuration:1,verticalAlign:1,width:1,wordSpacing:1},R$2=nt=>String.fromCharCode(nt+(nt>25?39:97)),z$1=nt=>(_=>{let tt,ot="";for(tt=Math.abs(_);tt>52;tt=tt/52|0)ot=R$2(tt%52)+ot;return R$2(tt%52)+ot})(((_,tt)=>{let ot=tt.length;for(;ot;)_=33*_^tt.charCodeAt(--ot);return _})(5381,JSON.stringify(nt))>>>0),W$1=["themed","global","styled","onevar","resonevar","allvar","inline"],j$1=nt=>{if(nt.href&&!nt.href.startsWith(location.origin))return!1;try{return!!nt.cssRules}catch{return!1}},E$1=nt=>{let _;const tt=()=>{const{cssRules:st}=_.sheet;return[].map.call(st,(at,lt)=>{const{cssText:dt}=at;let ht="";if(dt.startsWith("--sxs"))return"";if(st[lt-1]&&(ht=st[lt-1].cssText).startsWith("--sxs")){if(!at.cssRules.length)return"";for(const ft in _.rules)if(_.rules[ft].group===at)return`--sxs{--sxs:${[..._.rules[ft].cache].join(" ")}}${dt}`;return at.cssRules.length?`${ht}${dt}`:""}return dt}).join("")},ot=()=>{if(_){const{rules:dt,sheet:ht}=_;if(!ht.deleteRule){for(;Object(Object(ht.cssRules)[0]).type===3;)ht.cssRules.splice(0,1);ht.cssRules=[]}for(const ft in dt)delete dt[ft]}const st=Object(nt).styleSheets||[];for(const dt of st)if(j$1(dt)){for(let ht=0,ft=dt.cssRules;ft[ht];++ht){const gt=Object(ft[ht]);if(gt.type!==1)continue;const Et=Object(ft[ht+1]);if(Et.type!==4)continue;++ht;const{cssText:yt}=gt;if(!yt.startsWith("--sxs"))continue;const Ct=yt.slice(14,-3).trim().split(/\s+/),wt=W$1[Ct[0]];wt&&(_||(_={sheet:dt,reset:ot,rules:{},toString:tt}),_.rules[wt]={group:Et,index:ht,cache:new Set(Ct)})}if(_)break}if(!_){const dt=(ht,ft)=>({type:ft,cssRules:[],insertRule(gt,Et){this.cssRules.splice(Et,0,dt(gt,{import:3,undefined:1}[(gt.toLowerCase().match(/^@([a-z]+)/)||[])[1]]||4))},get cssText(){return ht==="@media{}"?`@media{${[].map.call(this.cssRules,gt=>gt.cssText).join("")}}`:ht}});_={sheet:nt?(nt.head||nt).appendChild(document.createElement("style")).sheet:dt("","text/css"),rules:{},reset:ot,toString:tt}}const{sheet:at,rules:lt}=_;for(let dt=W$1.length-1;dt>=0;--dt){const ht=W$1[dt];if(!lt[ht]){const ft=W$1[dt+1],gt=lt[ft]?lt[ft].index:at.cssRules.length;at.insertRule("@media{}",gt),at.insertRule(`--sxs{--sxs:${dt}}`,gt),lt[ht]={group:at.cssRules[gt+1],index:gt,cache:new Set([dt])}}v$3(lt[ht])}};return ot(),_},v$3=nt=>{const _=nt.group;let tt=_.cssRules.length;nt.apply=ot=>{try{_.insertRule(ot,tt),++tt}catch{}}},T$3=Symbol(),w$2=o$3(),M$1=(nt,_)=>w$2(nt,()=>(...tt)=>{let ot={type:null,composers:new Set};for(const st of tt)if(st!=null)if(st[l$3]){ot.type==null&&(ot.type=st[l$3].type);for(const at of st[l$3].composers)ot.composers.add(at)}else st.constructor!==Object||st.$$typeof?ot.type==null&&(ot.type=st):ot.composers.add(C$1(st,nt));return ot.type==null&&(ot.type="span"),ot.composers.size||ot.composers.add(["PJLV",{},[],[],{},[]]),P$1(nt,ot,_)}),C$1=({variants:nt,compoundVariants:_,defaultVariants:tt,...ot},st)=>{const at=`${S$3(st.prefix)}c-${z$1(ot)}`,lt=[],dt=[],ht=Object.create(null),ft=[];for(const yt in tt)ht[yt]=String(tt[yt]);if(typeof nt=="object"&&nt)for(const yt in nt){gt=ht,Et=yt,c$4.call(gt,Et)||(ht[yt]="undefined");const Ct=nt[yt];for(const wt in Ct){const It={[yt]:String(wt)};String(wt)==="undefined"&&ft.push(yt);const Pt=Ct[wt],Rt=[It,Pt,!a$3(Pt)];lt.push(Rt)}}var gt,Et;if(typeof _=="object"&&_)for(const yt of _){let{css:Ct,...wt}=yt;Ct=typeof Ct=="object"&&Ct||{};for(const Pt in wt)wt[Pt]=String(wt[Pt]);const It=[wt,Ct,!a$3(Ct)];dt.push(It)}return[at,ot,lt,dt,ht,ft]},P$1=(nt,_,tt)=>{const[ot,st,at,lt]=L$3(_.composers),dt=typeof _.type=="function"||_.type.$$typeof?(Et=>{function yt(){for(let Ct=0;Ct<yt[T$3].length;Ct++){const[wt,It]=yt[T$3][Ct];Et.rules[wt].apply(It)}return yt[T$3]=[],null}return yt[T$3]=[],yt.rules={},W$1.forEach(Ct=>yt.rules[Ct]={apply:wt=>yt[T$3].push([Ct,wt])}),yt})(tt):null,ht=(dt||tt).rules,ft=`.${ot}${st.length>1?`:where(.${st.slice(1).join(".")})`:""}`,gt=Et=>{Et=typeof Et=="object"&&Et||A$1;const{css:yt,...Ct}=Et,wt={};for(const Rt in at)if(delete Ct[Rt],Rt in Et){let xt=Et[Rt];typeof xt=="object"&&xt?wt[Rt]={"@initial":at[Rt],...xt}:(xt=String(xt),wt[Rt]=xt!=="undefined"||lt.has(Rt)?xt:at[Rt])}else wt[Rt]=at[Rt];const It=new Set([...st]);for(const[Rt,xt,Nt,kt]of _.composers){tt.rules.styled.cache.has(Rt)||(tt.rules.styled.cache.add(Rt),$$2(xt,[`.${Rt}`],[],nt,zt=>{ht.styled.apply(zt)}));const Vt=O$1(Nt,wt,nt.media),Ft=O$1(kt,wt,nt.media,!0);for(const zt of Vt)if(zt!==void 0)for(const[Yt,Kt,qt]of zt){const pn=`${Rt}-${z$1(Kt)}-${Yt}`;It.add(pn);const an=(qt?tt.rules.resonevar:tt.rules.onevar).cache,fn=qt?ht.resonevar:ht.onevar;an.has(pn)||(an.add(pn),$$2(Kt,[`.${pn}`],[],nt,dn=>{fn.apply(dn)}))}for(const zt of Ft)if(zt!==void 0)for(const[Yt,Kt]of zt){const qt=`${Rt}-${z$1(Kt)}-${Yt}`;It.add(qt),tt.rules.allvar.cache.has(qt)||(tt.rules.allvar.cache.add(qt),$$2(Kt,[`.${qt}`],[],nt,pn=>{ht.allvar.apply(pn)}))}}if(typeof yt=="object"&&yt){const Rt=`${ot}-i${z$1(yt)}-css`;It.add(Rt),tt.rules.inline.cache.has(Rt)||(tt.rules.inline.cache.add(Rt),$$2(yt,[`.${Rt}`],[],nt,xt=>{ht.inline.apply(xt)}))}for(const Rt of String(Et.className||"").trim().split(/\s+/))Rt&&It.add(Rt);const Pt=Ct.className=[...It].join(" ");return{type:_.type,className:Pt,selector:ft,props:Ct,toString:()=>Pt,deferredInjector:dt}};return s$4(gt,{className:ot,selector:ft,[l$3]:_,toString:()=>(tt.rules.styled.cache.has(ot)||gt(),ot)})},L$3=nt=>{let _="";const tt=[],ot={},st=[];for(const[at,,,,lt,dt]of nt){_===""&&(_=at),tt.push(at),st.push(...dt);for(const ht in lt){const ft=lt[ht];(ot[ht]===void 0||ft!=="undefined"||dt.includes(ft))&&(ot[ht]=ft)}}return[_,tt,ot,new Set(st)]},O$1=(nt,_,tt,ot)=>{const st=[];e:for(let[at,lt,dt]of nt){if(dt)continue;let ht,ft=0,gt=!1;for(ht in at){const Et=at[ht];let yt=_[ht];if(yt!==Et){if(typeof yt!="object"||!yt)continue e;{let Ct,wt,It=0;for(const Pt in yt){if(Et===String(yt[Pt])){if(Pt!=="@initial"){const Rt=Pt.slice(1);(wt=wt||[]).push(Rt in tt?tt[Rt]:Pt.replace(/^@media ?/,"")),gt=!0}ft+=It,Ct=!0}++It}if(wt&&wt.length&&(lt={["@media "+wt.join(", ")]:lt}),!Ct)continue e}}}(st[ft]=st[ft]||[]).push([ot?"cv":`${ht}-${at[ht]}`,lt,gt])}return st},A$1={},N$2=o$3(),D$2=(nt,_)=>N$2(nt,()=>(...tt)=>{const ot=()=>{for(let st of tt){st=typeof st=="object"&&st||{};let at=z$1(st);if(!_.rules.global.cache.has(at)){if(_.rules.global.cache.add(at),"@import"in st){let lt=[].indexOf.call(_.sheet.cssRules,_.rules.themed.group)-1;for(let dt of[].concat(st["@import"]))dt=dt.includes('"')||dt.includes("'")?dt:`"${dt}"`,_.sheet.insertRule(`@import ${dt};`,lt++);delete st["@import"]}$$2(st,[],[],nt,lt=>{_.rules.global.apply(lt)})}}return""};return s$4(ot,{toString:ot})}),H$2=o$3(),V$1=(nt,_)=>H$2(nt,()=>tt=>{const ot=`${S$3(nt.prefix)}k-${z$1(tt)}`,st=()=>{if(!_.rules.global.cache.has(ot)){_.rules.global.cache.add(ot);const at=[];$$2(tt,[],[],nt,dt=>at.push(dt));const lt=`@keyframes ${ot}{${at.join("")}}`;_.rules.global.apply(lt)}return ot};return s$4(st,{get name(){return st()},toString:st})}),G=class{constructor(nt,_,tt,ot){this.token=nt==null?"":String(nt),this.value=_==null?"":String(_),this.scale=tt==null?"":String(tt),this.prefix=ot==null?"":String(ot)}get computedValue(){return"var("+this.variable+")"}get variable(){return"--"+S$3(this.prefix)+S$3(this.scale)+this.token}toString(){return this.computedValue}},F$1=o$3(),J$1=(nt,_)=>F$1(nt,()=>(tt,ot)=>{ot=typeof tt=="object"&&tt||Object(ot);const st=`.${tt=(tt=typeof tt=="string"?tt:"")||`${S$3(nt.prefix)}t-${z$1(ot)}`}`,at={},lt=[];for(const ht in ot){at[ht]={};for(const ft in ot[ht]){const gt=`--${S$3(nt.prefix)}${ht}-${ft}`,Et=k$3(String(ot[ht][ft]),nt.prefix,ht);at[ht][ft]=new G(ft,Et,ht,nt.prefix),lt.push(`${gt}:${Et}`)}}const dt=()=>{if(lt.length&&!_.rules.themed.cache.has(tt)){_.rules.themed.cache.add(tt);const ht=`${ot===nt.theme?":root,":""}.${tt}{${lt.join(";")}}`;_.rules.themed.apply(ht)}return tt};return{...at,get className(){return dt()},selector:st,toString:dt}}),U$1=o$3(),Y$1=o$3(),q$1=nt=>{const _=(tt=>{let ot=!1;const st=U$1(tt,at=>{ot=!0;const lt="prefix"in(at=typeof at=="object"&&at||{})?String(at.prefix):"",dt=typeof at.media=="object"&&at.media||{},ht=typeof at.root=="object"?at.root||null:globalThis.document||null,ft=typeof at.theme=="object"&&at.theme||{},gt={prefix:lt,media:dt,theme:ft,themeMap:typeof at.themeMap=="object"&&at.themeMap||{...n$3},utils:typeof at.utils=="object"&&at.utils||{}},Et=E$1(ht),yt={css:M$1(gt,Et),globalCss:D$2(gt,Et),keyframes:V$1(gt,Et),createTheme:J$1(gt,Et),reset(){Et.reset(),yt.theme.toString()},theme:{},sheet:Et,config:gt,prefix:lt,getCssText:Et.toString,toString:Et.toString};return String(yt.theme=yt.createTheme(ft)),yt});return ot||st.reset(),st})(nt);return _.styled=(({config:tt,sheet:ot})=>Y$1(tt,()=>{const st=M$1(tt,ot);return(...at)=>{const lt=st(...at),dt=lt[l$3].type,ht=React.forwardRef((ft,gt)=>{const Et=ft&&ft.as||dt,{props:yt,deferredInjector:Ct}=lt(ft);return delete yt.as,yt.ref=gt,Ct?React.createElement(React.Fragment,null,React.createElement(Et,yt),React.createElement(Ct,null)):React.createElement(Et,yt)});return ht.className=lt.className,ht.displayName=`Styled.${dt.displayName||dt.name||dt}`,ht.selector=lt.selector,ht.toString=()=>lt.selector,ht[l$3]=lt[l$3],ht}}))(_),_};function $e42e1063c40fb3ef$export$b9ecd428b558ff10(nt,_,{checkForDefaultPrevented:tt=!0}={}){return function(st){if(nt==null||nt(st),tt===!1||!st.defaultPrevented)return _==null?void 0:_(st)}}function $c512c27ab02ef895$export$50c7b4e9d9f19c1(nt,_=[]){let tt=[];function ot(at,lt){const dt=reactExports.createContext(lt),ht=tt.length;tt=[...tt,lt];function ft(Et){const{scope:yt,children:Ct,...wt}=Et,It=(yt==null?void 0:yt[nt][ht])||dt,Pt=reactExports.useMemo(()=>wt,Object.values(wt));return reactExports.createElement(It.Provider,{value:Pt},Ct)}function gt(Et,yt){const Ct=(yt==null?void 0:yt[nt][ht])||dt,wt=reactExports.useContext(Ct);if(wt)return wt;if(lt!==void 0)return lt;throw new Error(`\`${Et}\` must be used within \`${at}\``)}return ft.displayName=at+"Provider",[ft,gt]}const st=()=>{const at=tt.map(lt=>reactExports.createContext(lt));return function(dt){const ht=(dt==null?void 0:dt[nt])||at;return reactExports.useMemo(()=>({[`__scope${nt}`]:{...dt,[nt]:ht}}),[dt,ht])}};return st.scopeName=nt,[ot,$c512c27ab02ef895$var$composeContextScopes(st,..._)]}function $c512c27ab02ef895$var$composeContextScopes(...nt){const _=nt[0];if(nt.length===1)return _;const tt=()=>{const ot=nt.map(st=>({useScope:st(),scopeName:st.scopeName}));return function(at){const lt=ot.reduce((dt,{useScope:ht,scopeName:ft})=>{const Et=ht(at)[`__scope${ft}`];return{...dt,...Et}},{});return reactExports.useMemo(()=>({[`__scope${_.scopeName}`]:lt}),[lt])}};return tt.scopeName=_.scopeName,tt}function $b1b2314f5f9a1d84$export$25bec8c6f54ee79a(nt){const _=reactExports.useRef(nt);return reactExports.useEffect(()=>{_.current=nt}),reactExports.useMemo(()=>(...tt)=>{var ot;return(ot=_.current)===null||ot===void 0?void 0:ot.call(_,...tt)},[])}function $addc16e1bbe58fd0$export$3a72a57244d6e765(nt,_=globalThis==null?void 0:globalThis.document){const tt=$b1b2314f5f9a1d84$export$25bec8c6f54ee79a(nt);reactExports.useEffect(()=>{const ot=st=>{st.key==="Escape"&&tt(st)};return _.addEventListener("keydown",ot),()=>_.removeEventListener("keydown",ot)},[tt,_])}const $5cb92bef7577960e$var$CONTEXT_UPDATE="dismissableLayer.update",$5cb92bef7577960e$var$POINTER_DOWN_OUTSIDE="dismissableLayer.pointerDownOutside",$5cb92bef7577960e$var$FOCUS_OUTSIDE="dismissableLayer.focusOutside";let $5cb92bef7577960e$var$originalBodyPointerEvents;const $5cb92bef7577960e$var$DismissableLayerContext=reactExports.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),$5cb92bef7577960e$export$177fb62ff3ec1f22=reactExports.forwardRef((nt,_)=>{var tt;const{disableOutsidePointerEvents:ot=!1,onEscapeKeyDown:st,onPointerDownOutside:at,onFocusOutside:lt,onInteractOutside:dt,onDismiss:ht,...ft}=nt,gt=reactExports.useContext($5cb92bef7577960e$var$DismissableLayerContext),[Et,yt]=reactExports.useState(null),Ct=(tt=Et==null?void 0:Et.ownerDocument)!==null&&tt!==void 0?tt:globalThis==null?void 0:globalThis.document,[,wt]=reactExports.useState({}),It=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(_,Yt=>yt(Yt)),Pt=Array.from(gt.layers),[Rt]=[...gt.layersWithOutsidePointerEventsDisabled].slice(-1),xt=Pt.indexOf(Rt),Nt=Et?Pt.indexOf(Et):-1,kt=gt.layersWithOutsidePointerEventsDisabled.size>0,Vt=Nt>=xt,Ft=$5cb92bef7577960e$var$usePointerDownOutside(Yt=>{const Kt=Yt.target,qt=[...gt.branches].some(pn=>pn.contains(Kt));!Vt||qt||(at==null||at(Yt),dt==null||dt(Yt),Yt.defaultPrevented||ht==null||ht())},Ct),zt=$5cb92bef7577960e$var$useFocusOutside(Yt=>{const Kt=Yt.target;[...gt.branches].some(pn=>pn.contains(Kt))||(lt==null||lt(Yt),dt==null||dt(Yt),Yt.defaultPrevented||ht==null||ht())},Ct);return $addc16e1bbe58fd0$export$3a72a57244d6e765(Yt=>{Nt===gt.layers.size-1&&(st==null||st(Yt),!Yt.defaultPrevented&&ht&&(Yt.preventDefault(),ht()))},Ct),reactExports.useEffect(()=>{if(Et)return ot&&(gt.layersWithOutsidePointerEventsDisabled.size===0&&($5cb92bef7577960e$var$originalBodyPointerEvents=Ct.body.style.pointerEvents,Ct.body.style.pointerEvents="none"),gt.layersWithOutsidePointerEventsDisabled.add(Et)),gt.layers.add(Et),$5cb92bef7577960e$var$dispatchUpdate(),()=>{ot&&gt.layersWithOutsidePointerEventsDisabled.size===1&&(Ct.body.style.pointerEvents=$5cb92bef7577960e$var$originalBodyPointerEvents)}},[Et,Ct,ot,gt]),reactExports.useEffect(()=>()=>{Et&&(gt.layers.delete(Et),gt.layersWithOutsidePointerEventsDisabled.delete(Et),$5cb92bef7577960e$var$dispatchUpdate())},[Et,gt]),reactExports.useEffect(()=>{const Yt=()=>wt({});return document.addEventListener($5cb92bef7577960e$var$CONTEXT_UPDATE,Yt),()=>document.removeEventListener($5cb92bef7577960e$var$CONTEXT_UPDATE,Yt)},[]),reactExports.createElement($8927f6f2acc4f386$export$250ffa63cdc0d034.div,_extends$1({},ft,{ref:It,style:{pointerEvents:kt?Vt?"auto":"none":void 0,...nt.style},onFocusCapture:$e42e1063c40fb3ef$export$b9ecd428b558ff10(nt.onFocusCapture,zt.onFocusCapture),onBlurCapture:$e42e1063c40fb3ef$export$b9ecd428b558ff10(nt.onBlurCapture,zt.onBlurCapture),onPointerDownCapture:$e42e1063c40fb3ef$export$b9ecd428b558ff10(nt.onPointerDownCapture,Ft.onPointerDownCapture)}))});function $5cb92bef7577960e$var$usePointerDownOutside(nt,_=globalThis==null?void 0:globalThis.document){const tt=$b1b2314f5f9a1d84$export$25bec8c6f54ee79a(nt),ot=reactExports.useRef(!1),st=reactExports.useRef(()=>{});return reactExports.useEffect(()=>{const at=dt=>{if(dt.target&&!ot.current){let gt=function(){$5cb92bef7577960e$var$handleAndDispatchCustomEvent($5cb92bef7577960e$var$POINTER_DOWN_OUTSIDE,tt,ft,{discrete:!0})};var ht=gt;const ft={originalEvent:dt};dt.pointerType==="touch"?(_.removeEventListener("click",st.current),st.current=gt,_.addEventListener("click",st.current,{once:!0})):gt()}ot.current=!1},lt=window.setTimeout(()=>{_.addEventListener("pointerdown",at)},0);return()=>{window.clearTimeout(lt),_.removeEventListener("pointerdown",at),_.removeEventListener("click",st.current)}},[_,tt]),{onPointerDownCapture:()=>ot.current=!0}}function $5cb92bef7577960e$var$useFocusOutside(nt,_=globalThis==null?void 0:globalThis.document){const tt=$b1b2314f5f9a1d84$export$25bec8c6f54ee79a(nt),ot=reactExports.useRef(!1);return reactExports.useEffect(()=>{const st=at=>{at.target&&!ot.current&&$5cb92bef7577960e$var$handleAndDispatchCustomEvent($5cb92bef7577960e$var$FOCUS_OUTSIDE,tt,{originalEvent:at},{discrete:!1})};return _.addEventListener("focusin",st),()=>_.removeEventListener("focusin",st)},[_,tt]),{onFocusCapture:()=>ot.current=!0,onBlurCapture:()=>ot.current=!1}}function $5cb92bef7577960e$var$dispatchUpdate(){const nt=new CustomEvent($5cb92bef7577960e$var$CONTEXT_UPDATE);document.dispatchEvent(nt)}function $5cb92bef7577960e$var$handleAndDispatchCustomEvent(nt,_,tt,{discrete:ot}){const st=tt.originalEvent.target,at=new CustomEvent(nt,{bubbles:!1,cancelable:!0,detail:tt});_&&st.addEventListener(nt,_,{once:!0}),ot?$8927f6f2acc4f386$export$6d1a0317bde7de7f(st,at):st.dispatchEvent(at)}const $9f79659886946c16$export$e5c5a5f917a5871c=globalThis!=null&&globalThis.document?reactExports.useLayoutEffect:()=>{},$1746a345f3d73bb7$var$useReactId=$2AODx$react["useId".toString()]||(()=>{});let $1746a345f3d73bb7$var$count=0;function $1746a345f3d73bb7$export$f680877a34711e37(nt){const[_,tt]=reactExports.useState($1746a345f3d73bb7$var$useReactId());return $9f79659886946c16$export$e5c5a5f917a5871c(()=>{nt||tt(ot=>ot??String($1746a345f3d73bb7$var$count++))},[nt]),nt||(_?`radix-${_}`:"")}function t$1(nt){return nt.split("-")[0]}function e$1(nt){return nt.split("-")[1]}function n$2(nt){return["top","bottom"].includes(t$1(nt))?"x":"y"}function r$2(nt){return nt==="y"?"height":"width"}function i$3(nt,_,tt){let{reference:ot,floating:st}=nt;const at=ot.x+ot.width/2-st.width/2,lt=ot.y+ot.height/2-st.height/2,dt=n$2(_),ht=r$2(dt),ft=ot[ht]/2-st[ht]/2,gt=dt==="x";let Et;switch(t$1(_)){case"top":Et={x:at,y:ot.y-st.height};break;case"bottom":Et={x:at,y:ot.y+ot.height};break;case"right":Et={x:ot.x+ot.width,y:lt};break;case"left":Et={x:ot.x-st.width,y:lt};break;default:Et={x:ot.x,y:ot.y}}switch(e$1(_)){case"start":Et[dt]-=ft*(tt&&gt?-1:1);break;case"end":Et[dt]+=ft*(tt&&gt?-1:1)}return Et}const o$2=async(nt,_,tt)=>{const{placement:ot="bottom",strategy:st="absolute",middleware:at=[],platform:lt}=tt,dt=await(lt.isRTL==null?void 0:lt.isRTL(_));let ht=await lt.getElementRects({reference:nt,floating:_,strategy:st}),{x:ft,y:gt}=i$3(ht,ot,dt),Et=ot,yt={},Ct=0;for(let wt=0;wt<at.length;wt++){const{name:It,fn:Pt}=at[wt],{x:Rt,y:xt,data:Nt,reset:kt}=await Pt({x:ft,y:gt,initialPlacement:ot,placement:Et,strategy:st,middlewareData:yt,rects:ht,platform:lt,elements:{reference:nt,floating:_}});ft=Rt??ft,gt=xt??gt,yt={...yt,[It]:{...yt[It],...Nt}},kt&&Ct<=50&&(Ct++,typeof kt=="object"&&(kt.placement&&(Et=kt.placement),kt.rects&&(ht=kt.rects===!0?await lt.getElementRects({reference:nt,floating:_,strategy:st}):kt.rects),{x:ft,y:gt}=i$3(ht,Et,dt)),wt=-1)}return{x:ft,y:gt,placement:Et,strategy:st,middlewareData:yt}};function a$2(nt){return typeof nt!="number"?function(_){return{top:0,right:0,bottom:0,left:0,..._}}(nt):{top:nt,right:nt,bottom:nt,left:nt}}function l$2(nt){return{...nt,top:nt.y,left:nt.x,right:nt.x+nt.width,bottom:nt.y+nt.height}}async function s$3(nt,_){var tt;_===void 0&&(_={});const{x:ot,y:st,platform:at,rects:lt,elements:dt,strategy:ht}=nt,{boundary:ft="clippingAncestors",rootBoundary:gt="viewport",elementContext:Et="floating",altBoundary:yt=!1,padding:Ct=0}=_,wt=a$2(Ct),It=dt[yt?Et==="floating"?"reference":"floating":Et],Pt=l$2(await at.getClippingRect({element:(tt=await(at.isElement==null?void 0:at.isElement(It)))==null||tt?It:It.contextElement||await(at.getDocumentElement==null?void 0:at.getDocumentElement(dt.floating)),boundary:ft,rootBoundary:gt,strategy:ht})),Rt=l$2(at.convertOffsetParentRelativeRectToViewportRelativeRect?await at.convertOffsetParentRelativeRectToViewportRelativeRect({rect:Et==="floating"?{...lt.floating,x:ot,y:st}:lt.reference,offsetParent:await(at.getOffsetParent==null?void 0:at.getOffsetParent(dt.floating)),strategy:ht}):lt[Et]);return{top:Pt.top-Rt.top+wt.top,bottom:Rt.bottom-Pt.bottom+wt.bottom,left:Pt.left-Rt.left+wt.left,right:Rt.right-Pt.right+wt.right}}const c$3=Math.min,f$3=Math.max;function u$3(nt,_,tt){return f$3(nt,c$3(_,tt))}const m$3=nt=>({name:"arrow",options:nt,async fn(_){const{element:tt,padding:ot=0}=nt??{},{x:st,y:at,placement:lt,rects:dt,platform:ht}=_;if(tt==null)return{};const ft=a$2(ot),gt={x:st,y:at},Et=n$2(lt),yt=e$1(lt),Ct=r$2(Et),wt=await ht.getDimensions(tt),It=Et==="y"?"top":"left",Pt=Et==="y"?"bottom":"right",Rt=dt.reference[Ct]+dt.reference[Et]-gt[Et]-dt.floating[Ct],xt=gt[Et]-dt.reference[Et],Nt=await(ht.getOffsetParent==null?void 0:ht.getOffsetParent(tt));let kt=Nt?Et==="y"?Nt.clientHeight||0:Nt.clientWidth||0:0;kt===0&&(kt=dt.floating[Ct]);const Vt=Rt/2-xt/2,Ft=ft[It],zt=kt-wt[Ct]-ft[Pt],Yt=kt/2-wt[Ct]/2+Vt,Kt=u$3(Ft,Yt,zt),qt=(yt==="start"?ft[It]:ft[Pt])>0&&Yt!==Kt&&dt.reference[Ct]<=dt.floating[Ct];return{[Et]:gt[Et]-(qt?Yt<Ft?Ft-Yt:zt-Yt:0),data:{[Et]:Kt,centerOffset:Yt-Kt}}}}),g$3={left:"right",right:"left",bottom:"top",top:"bottom"};function d$3(nt){return nt.replace(/left|right|bottom|top/g,_=>g$3[_])}function p$3(nt,_,tt){tt===void 0&&(tt=!1);const ot=e$1(nt),st=n$2(nt),at=r$2(st);let lt=st==="x"?ot===(tt?"end":"start")?"right":"left":ot==="start"?"bottom":"top";return _.reference[at]>_.floating[at]&&(lt=d$3(lt)),{main:lt,cross:d$3(lt)}}const h$3={start:"end",end:"start"};function y$3(nt){return nt.replace(/start|end/g,_=>h$3[_])}const x$2=["top","right","bottom","left"];x$2.reduce((nt,_)=>nt.concat(_,_+"-start",_+"-end"),[]);const b$3=function(nt){return nt===void 0&&(nt={}),{name:"flip",options:nt,async fn(_){var tt;const{placement:ot,middlewareData:st,rects:at,initialPlacement:lt,platform:dt,elements:ht}=_,{mainAxis:ft=!0,crossAxis:gt=!0,fallbackPlacements:Et,fallbackStrategy:yt="bestFit",flipAlignment:Ct=!0,...wt}=nt,It=t$1(ot),Pt=Et||(It===lt||!Ct?[d$3(lt)]:function(Yt){const Kt=d$3(Yt);return[y$3(Yt),Kt,y$3(Kt)]}(lt)),Rt=[lt,...Pt],xt=await s$3(_,wt),Nt=[];let kt=((tt=st.flip)==null?void 0:tt.overflows)||[];if(ft&&Nt.push(xt[It]),gt){const{main:Yt,cross:Kt}=p$3(ot,at,await(dt.isRTL==null?void 0:dt.isRTL(ht.floating)));Nt.push(xt[Yt],xt[Kt])}if(kt=[...kt,{placement:ot,overflows:Nt}],!Nt.every(Yt=>Yt<=0)){var Vt,Ft;const Yt=((Vt=(Ft=st.flip)==null?void 0:Ft.index)!=null?Vt:0)+1,Kt=Rt[Yt];if(Kt)return{data:{index:Yt,overflows:kt},reset:{placement:Kt}};let qt="bottom";switch(yt){case"bestFit":{var zt;const pn=(zt=kt.map(an=>[an,an.overflows.filter(fn=>fn>0).reduce((fn,dn)=>fn+dn,0)]).sort((an,fn)=>an[1]-fn[1])[0])==null?void 0:zt[0].placement;pn&&(qt=pn);break}case"initialPlacement":qt=lt}if(ot!==qt)return{reset:{placement:qt}}}return{}}}};function R$1(nt,_){return{top:nt.top-_.height,right:nt.right-_.width,bottom:nt.bottom-_.height,left:nt.left-_.width}}function A(nt){return x$2.some(_=>nt[_]>=0)}const P=function(nt){let{strategy:_="referenceHidden",...tt}=nt===void 0?{}:nt;return{name:"hide",async fn(ot){const{rects:st}=ot;switch(_){case"referenceHidden":{const at=R$1(await s$3(ot,{...tt,elementContext:"reference"}),st.reference);return{data:{referenceHiddenOffsets:at,referenceHidden:A(at)}}}case"escaped":{const at=R$1(await s$3(ot,{...tt,altBoundary:!0}),st.floating);return{data:{escapedOffsets:at,escaped:A(at)}}}default:return{}}}}},T$2=function(nt){return nt===void 0&&(nt=0),{name:"offset",options:nt,async fn(_){const{x:tt,y:ot}=_,st=await async function(at,lt){const{placement:dt,platform:ht,elements:ft}=at,gt=await(ht.isRTL==null?void 0:ht.isRTL(ft.floating)),Et=t$1(dt),yt=e$1(dt),Ct=n$2(dt)==="x",wt=["left","top"].includes(Et)?-1:1,It=gt&&Ct?-1:1,Pt=typeof lt=="function"?lt(at):lt;let{mainAxis:Rt,crossAxis:xt,alignmentAxis:Nt}=typeof Pt=="number"?{mainAxis:Pt,crossAxis:0,alignmentAxis:null}:{mainAxis:0,crossAxis:0,alignmentAxis:null,...Pt};return yt&&typeof Nt=="number"&&(xt=yt==="end"?-1*Nt:Nt),Ct?{x:xt*It,y:Rt*wt}:{x:Rt*wt,y:xt*It}}(_,nt);return{x:tt+st.x,y:ot+st.y,data:st}}}};function O(nt){return nt==="x"?"y":"x"}const D$1=function(nt){return nt===void 0&&(nt={}),{name:"shift",options:nt,async fn(_){const{x:tt,y:ot,placement:st}=_,{mainAxis:at=!0,crossAxis:lt=!1,limiter:dt={fn:Pt=>{let{x:Rt,y:xt}=Pt;return{x:Rt,y:xt}}},...ht}=nt,ft={x:tt,y:ot},gt=await s$3(_,ht),Et=n$2(t$1(st)),yt=O(Et);let Ct=ft[Et],wt=ft[yt];if(at){const Pt=Et==="y"?"bottom":"right";Ct=u$3(Ct+gt[Et==="y"?"top":"left"],Ct,Ct-gt[Pt])}if(lt){const Pt=yt==="y"?"bottom":"right";wt=u$3(wt+gt[yt==="y"?"top":"left"],wt,wt-gt[Pt])}const It=dt.fn({..._,[Et]:Ct,[yt]:wt});return{...It,data:{x:It.x-tt,y:It.y-ot}}}}},L$2=function(nt){return nt===void 0&&(nt={}),{options:nt,fn(_){const{x:tt,y:ot,placement:st,rects:at,middlewareData:lt}=_,{offset:dt=0,mainAxis:ht=!0,crossAxis:ft=!0}=nt,gt={x:tt,y:ot},Et=n$2(st),yt=O(Et);let Ct=gt[Et],wt=gt[yt];const It=typeof dt=="function"?dt({...at,placement:st}):dt,Pt=typeof It=="number"?{mainAxis:It,crossAxis:0}:{mainAxis:0,crossAxis:0,...It};if(ht){const Vt=Et==="y"?"height":"width",Ft=at.reference[Et]-at.floating[Vt]+Pt.mainAxis,zt=at.reference[Et]+at.reference[Vt]-Pt.mainAxis;Ct<Ft?Ct=Ft:Ct>zt&&(Ct=zt)}if(ft){var Rt,xt,Nt,kt;const Vt=Et==="y"?"width":"height",Ft=["top","left"].includes(t$1(st)),zt=at.reference[yt]-at.floating[Vt]+(Ft&&(Rt=(xt=lt.offset)==null?void 0:xt[yt])!=null?Rt:0)+(Ft?0:Pt.crossAxis),Yt=at.reference[yt]+at.reference[Vt]+(Ft?0:(Nt=(kt=lt.offset)==null?void 0:kt[yt])!=null?Nt:0)-(Ft?Pt.crossAxis:0);wt<zt?wt=zt:wt>Yt&&(wt=Yt)}return{[Et]:Ct,[yt]:wt}}}},k$2=function(nt){return nt===void 0&&(nt={}),{name:"size",options:nt,async fn(_){const{placement:tt,rects:ot,platform:st,elements:at}=_,{apply:lt,...dt}=nt,ht=await s$3(_,dt),ft=t$1(tt),gt=e$1(tt);let Et,yt;ft==="top"||ft==="bottom"?(Et=ft,yt=gt===(await(st.isRTL==null?void 0:st.isRTL(at.floating))?"start":"end")?"left":"right"):(yt=ft,Et=gt==="end"?"top":"bottom");const Ct=f$3(ht.left,0),wt=f$3(ht.right,0),It=f$3(ht.top,0),Pt=f$3(ht.bottom,0),Rt={availableHeight:ot.floating.height-(["left","right"].includes(tt)?2*(It!==0||Pt!==0?It+Pt:f$3(ht.top,ht.bottom)):ht[Et]),availableWidth:ot.floating.width-(["top","bottom"].includes(tt)?2*(Ct!==0||wt!==0?Ct+wt:f$3(ht.left,ht.right)):ht[yt])},xt=await st.getDimensions(at.floating);lt==null||lt({..._,...Rt});const Nt=await st.getDimensions(at.floating);return xt.width!==Nt.width||xt.height!==Nt.height?{reset:{rects:!0}}:{}}}};function n$1(nt){return nt&&nt.document&&nt.location&&nt.alert&&nt.setInterval}function o$1(nt){if(nt==null)return window;if(!n$1(nt)){const _=nt.ownerDocument;return _&&_.defaultView||window}return nt}function i$2(nt){return o$1(nt).getComputedStyle(nt)}function r$1(nt){return n$1(nt)?"":nt?(nt.nodeName||"").toLowerCase():""}function l$1(){const nt=navigator.userAgentData;return nt!=null&&nt.brands?nt.brands.map(_=>_.brand+"/"+_.version).join(" "):navigator.userAgent}function c$2(nt){return nt instanceof o$1(nt).HTMLElement}function f$2(nt){return nt instanceof o$1(nt).Element}function s$2(nt){return typeof ShadowRoot>"u"?!1:nt instanceof o$1(nt).ShadowRoot||nt instanceof ShadowRoot}function u$2(nt){const{overflow:_,overflowX:tt,overflowY:ot}=i$2(nt);return/auto|scroll|overlay|hidden/.test(_+ot+tt)}function d$2(nt){return["table","td","th"].includes(r$1(nt))}function h$2(nt){const _=/firefox/i.test(l$1()),tt=i$2(nt);return tt.transform!=="none"||tt.perspective!=="none"||tt.contain==="paint"||["transform","perspective"].includes(tt.willChange)||_&&tt.willChange==="filter"||_&&!!tt.filter&&tt.filter!=="none"}function a$1(){return!/^((?!chrome|android).)*safari/i.test(l$1())}const g$2=Math.min,p$2=Math.max,m$2=Math.round;function w$1(nt,_,tt){var ot,st,at,lt;_===void 0&&(_=!1),tt===void 0&&(tt=!1);const dt=nt.getBoundingClientRect();let ht=1,ft=1;_&&c$2(nt)&&(ht=nt.offsetWidth>0&&m$2(dt.width)/nt.offsetWidth||1,ft=nt.offsetHeight>0&&m$2(dt.height)/nt.offsetHeight||1);const gt=f$2(nt)?o$1(nt):window,Et=!a$1()&&tt,yt=(dt.left+(Et&&(ot=(st=gt.visualViewport)==null?void 0:st.offsetLeft)!=null?ot:0))/ht,Ct=(dt.top+(Et&&(at=(lt=gt.visualViewport)==null?void 0:lt.offsetTop)!=null?at:0))/ft,wt=dt.width/ht,It=dt.height/ft;return{width:wt,height:It,top:Ct,right:yt+wt,bottom:Ct+It,left:yt,x:yt,y:Ct}}function v$2(nt){return(_=nt,(_ instanceof o$1(_).Node?nt.ownerDocument:nt.document)||window.document).documentElement;var _}function y$2(nt){return f$2(nt)?{scrollLeft:nt.scrollLeft,scrollTop:nt.scrollTop}:{scrollLeft:nt.pageXOffset,scrollTop:nt.pageYOffset}}function x$1(nt){return w$1(v$2(nt)).left+y$2(nt).scrollLeft}function b$2(nt,_,tt){const ot=c$2(_),st=v$2(_),at=w$1(nt,ot&&function(ht){const ft=w$1(ht);return m$2(ft.width)!==ht.offsetWidth||m$2(ft.height)!==ht.offsetHeight}(_),tt==="fixed");let lt={scrollLeft:0,scrollTop:0};const dt={x:0,y:0};if(ot||!ot&&tt!=="fixed")if((r$1(_)!=="body"||u$2(st))&&(lt=y$2(_)),c$2(_)){const ht=w$1(_,!0);dt.x=ht.x+_.clientLeft,dt.y=ht.y+_.clientTop}else st&&(dt.x=x$1(st));return{x:at.left+lt.scrollLeft-dt.x,y:at.top+lt.scrollTop-dt.y,width:at.width,height:at.height}}function L$1(nt){return r$1(nt)==="html"?nt:nt.assignedSlot||nt.parentNode||(s$2(nt)?nt.host:null)||v$2(nt)}function R(nt){return c$2(nt)&&getComputedStyle(nt).position!=="fixed"?nt.offsetParent:null}function T$1(nt){const _=o$1(nt);let tt=R(nt);for(;tt&&d$2(tt)&&getComputedStyle(tt).position==="static";)tt=R(tt);return tt&&(r$1(tt)==="html"||r$1(tt)==="body"&&getComputedStyle(tt).position==="static"&&!h$2(tt))?_:tt||function(ot){let st=L$1(ot);for(s$2(st)&&(st=st.host);c$2(st)&&!["html","body"].includes(r$1(st));){if(h$2(st))return st;st=st.parentNode}return null}(nt)||_}function W(nt){if(c$2(nt))return{width:nt.offsetWidth,height:nt.offsetHeight};const _=w$1(nt);return{width:_.width,height:_.height}}function E(nt){const _=L$1(nt);return["html","body","#document"].includes(r$1(_))?nt.ownerDocument.body:c$2(_)&&u$2(_)?_:E(_)}function H$1(nt,_){var tt;_===void 0&&(_=[]);const ot=E(nt),st=ot===((tt=nt.ownerDocument)==null?void 0:tt.body),at=o$1(ot),lt=st?[at].concat(at.visualViewport||[],u$2(ot)?ot:[]):ot,dt=_.concat(lt);return st?dt:dt.concat(H$1(lt))}function C(nt,_,tt){return _==="viewport"?l$2(function(ot,st){const at=o$1(ot),lt=v$2(ot),dt=at.visualViewport;let ht=lt.clientWidth,ft=lt.clientHeight,gt=0,Et=0;if(dt){ht=dt.width,ft=dt.height;const yt=a$1();(yt||!yt&&st==="fixed")&&(gt=dt.offsetLeft,Et=dt.offsetTop)}return{width:ht,height:ft,x:gt,y:Et}}(nt,tt)):f$2(_)?function(ot,st){const at=w$1(ot,!1,st==="fixed"),lt=at.top+ot.clientTop,dt=at.left+ot.clientLeft;return{top:lt,left:dt,x:dt,y:lt,right:dt+ot.clientWidth,bottom:lt+ot.clientHeight,width:ot.clientWidth,height:ot.clientHeight}}(_,tt):l$2(function(ot){var st;const at=v$2(ot),lt=y$2(ot),dt=(st=ot.ownerDocument)==null?void 0:st.body,ht=p$2(at.scrollWidth,at.clientWidth,dt?dt.scrollWidth:0,dt?dt.clientWidth:0),ft=p$2(at.scrollHeight,at.clientHeight,dt?dt.scrollHeight:0,dt?dt.clientHeight:0);let gt=-lt.scrollLeft+x$1(ot);const Et=-lt.scrollTop;return i$2(dt||at).direction==="rtl"&&(gt+=p$2(at.clientWidth,dt?dt.clientWidth:0)-ht),{width:ht,height:ft,x:gt,y:Et}}(v$2(nt)))}function S$2(nt){const _=H$1(nt),tt=["absolute","fixed"].includes(i$2(nt).position)&&c$2(nt)?T$1(nt):nt;return f$2(tt)?_.filter(ot=>f$2(ot)&&function(st,at){const lt=at.getRootNode==null?void 0:at.getRootNode();if(st.contains(at))return!0;if(lt&&s$2(lt)){let dt=at;do{if(dt&&st===dt)return!0;dt=dt.parentNode||dt.host}while(dt)}return!1}(ot,tt)&&r$1(ot)!=="body"):[]}const D={getClippingRect:function(nt){let{element:_,boundary:tt,rootBoundary:ot,strategy:st}=nt;const at=[...tt==="clippingAncestors"?S$2(_):[].concat(tt),ot],lt=at[0],dt=at.reduce((ht,ft)=>{const gt=C(_,ft,st);return ht.top=p$2(gt.top,ht.top),ht.right=g$2(gt.right,ht.right),ht.bottom=g$2(gt.bottom,ht.bottom),ht.left=p$2(gt.left,ht.left),ht},C(_,lt,st));return{width:dt.right-dt.left,height:dt.bottom-dt.top,x:dt.left,y:dt.top}},convertOffsetParentRelativeRectToViewportRelativeRect:function(nt){let{rect:_,offsetParent:tt,strategy:ot}=nt;const st=c$2(tt),at=v$2(tt);if(tt===at)return _;let lt={scrollLeft:0,scrollTop:0};const dt={x:0,y:0};if((st||!st&&ot!=="fixed")&&((r$1(tt)!=="body"||u$2(at))&&(lt=y$2(tt)),c$2(tt))){const ht=w$1(tt,!0);dt.x=ht.x+tt.clientLeft,dt.y=ht.y+tt.clientTop}return{..._,x:_.x-lt.scrollLeft+dt.x,y:_.y-lt.scrollTop+dt.y}},isElement:f$2,getDimensions:W,getOffsetParent:T$1,getDocumentElement:v$2,getElementRects:nt=>{let{reference:_,floating:tt,strategy:ot}=nt;return{reference:b$2(_,T$1(tt),ot),floating:{...W(tt),x:0,y:0}}},getClientRects:nt=>Array.from(nt.getClientRects()),isRTL:nt=>i$2(nt).direction==="rtl"};function N$1(nt,_,tt,ot){ot===void 0&&(ot={});const{ancestorScroll:st=!0,ancestorResize:at=!0,elementResize:lt=!0,animationFrame:dt=!1}=ot,ht=st&&!dt,ft=at&&!dt,gt=ht||ft?[...f$2(nt)?H$1(nt):[],...H$1(_)]:[];gt.forEach(wt=>{ht&&wt.addEventListener("scroll",tt,{passive:!0}),ft&&wt.addEventListener("resize",tt)});let Et,yt=null;if(lt){let wt=!0;yt=new ResizeObserver(()=>{wt||tt(),wt=!1}),f$2(nt)&&!dt&&yt.observe(nt),yt.observe(_)}let Ct=dt?w$1(nt):null;return dt&&function wt(){const It=w$1(nt);!Ct||It.x===Ct.x&&It.y===Ct.y&&It.width===Ct.width&&It.height===Ct.height||tt(),Ct=It,Et=requestAnimationFrame(wt)}(),tt(),()=>{var wt;gt.forEach(It=>{ht&&It.removeEventListener("scroll",tt),ft&&It.removeEventListener("resize",tt)}),(wt=yt)==null||wt.disconnect(),yt=null,dt&&cancelAnimationFrame(Et)}}const z=(nt,_,tt)=>o$2(nt,_,{platform:D,...tt});var index$1=typeof document<"u"?reactExports.useLayoutEffect:reactExports.useEffect;function deepEqual(nt,_){if(nt===_)return!0;if(typeof nt!=typeof _)return!1;if(typeof nt=="function"&&nt.toString()===_.toString())return!0;let tt,ot,st;if(nt&&_&&typeof nt=="object"){if(Array.isArray(nt)){if(tt=nt.length,tt!=_.length)return!1;for(ot=tt;ot--!==0;)if(!deepEqual(nt[ot],_[ot]))return!1;return!0}if(st=Object.keys(nt),tt=st.length,tt!==Object.keys(_).length)return!1;for(ot=tt;ot--!==0;)if(!Object.prototype.hasOwnProperty.call(_,st[ot]))return!1;for(ot=tt;ot--!==0;){const at=st[ot];if(!(at==="_owner"&&nt.$$typeof)&&!deepEqual(nt[at],_[at]))return!1}return!0}return nt!==nt&&_!==_}function useLatestRef(nt){const _=reactExports.useRef(nt);return index$1(()=>{_.current=nt}),_}function useFloating(nt){let{middleware:_,placement:tt="bottom",strategy:ot="absolute",whileElementsMounted:st}=nt===void 0?{}:nt;const at=reactExports.useRef(null),lt=reactExports.useRef(null),dt=useLatestRef(st),ht=reactExports.useRef(null),[ft,gt]=reactExports.useState({x:null,y:null,strategy:ot,placement:tt,middlewareData:{}}),[Et,yt]=reactExports.useState(_);deepEqual(Et==null?void 0:Et.map(Nt=>{let{options:kt}=Nt;return kt}),_==null?void 0:_.map(Nt=>{let{options:kt}=Nt;return kt}))||yt(_);const Ct=reactExports.useCallback(()=>{!at.current||!lt.current||z(at.current,lt.current,{middleware:Et,placement:tt,strategy:ot}).then(Nt=>{wt.current&&reactDomExports.flushSync(()=>{gt(Nt)})})},[Et,tt,ot]);index$1(()=>{wt.current&&Ct()},[Ct]);const wt=reactExports.useRef(!1);index$1(()=>(wt.current=!0,()=>{wt.current=!1}),[]);const It=reactExports.useCallback(()=>{if(typeof ht.current=="function"&&(ht.current(),ht.current=null),at.current&&lt.current)if(dt.current){const Nt=dt.current(at.current,lt.current,Ct);ht.current=Nt}else Ct()},[Ct,dt]),Pt=reactExports.useCallback(Nt=>{at.current=Nt,It()},[It]),Rt=reactExports.useCallback(Nt=>{lt.current=Nt,It()},[It]),xt=reactExports.useMemo(()=>({reference:at,floating:lt}),[]);return reactExports.useMemo(()=>({...ft,update:Ct,refs:xt,reference:Pt,floating:Rt}),[ft,Ct,xt,Pt,Rt])}const arrow=nt=>{const{element:_,padding:tt}=nt;function ot(st){return Object.prototype.hasOwnProperty.call(st,"current")}return{name:"arrow",options:nt,fn(st){return ot(_)?_.current!=null?m$3({element:_.current,padding:tt}).fn(st):{}:_?m$3({element:_,padding:tt}).fn(st):{}}}},$7e8f5cd07187803e$export$21b07c8f274aebd5=reactExports.forwardRef((nt,_)=>{const{children:tt,width:ot=10,height:st=5,...at}=nt;return reactExports.createElement($8927f6f2acc4f386$export$250ffa63cdc0d034.svg,_extends$1({},at,{ref:_,width:ot,height:st,viewBox:"0 0 30 10",preserveAspectRatio:"none"}),nt.asChild?tt:reactExports.createElement("polygon",{points:"0,0 30,0 15,10"}))}),$7e8f5cd07187803e$export$be92b6f5f03c0fe9=$7e8f5cd07187803e$export$21b07c8f274aebd5;function $db6c3485150b8e66$export$1ab7ae714698c4b8(nt){const[_,tt]=reactExports.useState(void 0);return $9f79659886946c16$export$e5c5a5f917a5871c(()=>{if(nt){tt({width:nt.offsetWidth,height:nt.offsetHeight});const ot=new ResizeObserver(st=>{if(!Array.isArray(st)||!st.length)return;const at=st[0];let lt,dt;if("borderBoxSize"in at){const ht=at.borderBoxSize,ft=Array.isArray(ht)?ht[0]:ht;lt=ft.inlineSize,dt=ft.blockSize}else lt=nt.offsetWidth,dt=nt.offsetHeight;tt({width:lt,height:dt})});return ot.observe(nt,{box:"border-box"}),()=>ot.unobserve(nt)}else tt(void 0)},[nt]),_}const $cf1ac5d9fe0e8206$var$POPPER_NAME="Popper",[$cf1ac5d9fe0e8206$var$createPopperContext,$cf1ac5d9fe0e8206$export$722aac194ae923]=$c512c27ab02ef895$export$50c7b4e9d9f19c1($cf1ac5d9fe0e8206$var$POPPER_NAME),[$cf1ac5d9fe0e8206$var$PopperProvider,$cf1ac5d9fe0e8206$var$usePopperContext]=$cf1ac5d9fe0e8206$var$createPopperContext($cf1ac5d9fe0e8206$var$POPPER_NAME),$cf1ac5d9fe0e8206$export$badac9ada3a0bdf9=nt=>{const{__scopePopper:_,children:tt}=nt,[ot,st]=reactExports.useState(null);return reactExports.createElement($cf1ac5d9fe0e8206$var$PopperProvider,{scope:_,anchor:ot,onAnchorChange:st},tt)},$cf1ac5d9fe0e8206$var$ANCHOR_NAME="PopperAnchor",$cf1ac5d9fe0e8206$export$ecd4e1ccab6ed6d=reactExports.forwardRef((nt,_)=>{const{__scopePopper:tt,virtualRef:ot,...st}=nt,at=$cf1ac5d9fe0e8206$var$usePopperContext($cf1ac5d9fe0e8206$var$ANCHOR_NAME,tt),lt=reactExports.useRef(null),dt=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(_,lt);return reactExports.useEffect(()=>{at.onAnchorChange((ot==null?void 0:ot.current)||lt.current)}),ot?null:reactExports.createElement($8927f6f2acc4f386$export$250ffa63cdc0d034.div,_extends$1({},st,{ref:dt}))}),$cf1ac5d9fe0e8206$var$CONTENT_NAME="PopperContent",[$cf1ac5d9fe0e8206$var$PopperContentProvider,$cf1ac5d9fe0e8206$var$useContentContext]=$cf1ac5d9fe0e8206$var$createPopperContext($cf1ac5d9fe0e8206$var$CONTENT_NAME),[$cf1ac5d9fe0e8206$var$PositionContextProvider,$cf1ac5d9fe0e8206$var$usePositionContext]=$cf1ac5d9fe0e8206$var$createPopperContext($cf1ac5d9fe0e8206$var$CONTENT_NAME,{hasParent:!1,positionUpdateFns:new Set}),$cf1ac5d9fe0e8206$export$bc4ae5855d3c4fc=reactExports.forwardRef((nt,_)=>{var tt,ot,st,at,lt,dt,ht,ft;const{__scopePopper:gt,side:Et="bottom",sideOffset:yt=0,align:Ct="center",alignOffset:wt=0,arrowPadding:It=0,collisionBoundary:Pt=[],collisionPadding:Rt=0,sticky:xt="partial",hideWhenDetached:Nt=!1,avoidCollisions:kt=!0,onPlaced:Vt,...Ft}=nt,zt=$cf1ac5d9fe0e8206$var$usePopperContext($cf1ac5d9fe0e8206$var$CONTENT_NAME,gt),[Yt,Kt]=reactExports.useState(null),qt=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(_,kr=>Kt(kr)),[pn,an]=reactExports.useState(null),fn=$db6c3485150b8e66$export$1ab7ae714698c4b8(pn),dn=(tt=fn==null?void 0:fn.width)!==null&&tt!==void 0?tt:0,Cn=(ot=fn==null?void 0:fn.height)!==null&&ot!==void 0?ot:0,On=Et+(Ct!=="center"?"-"+Ct:""),Pn=typeof Rt=="number"?Rt:{top:0,right:0,bottom:0,left:0,...Rt},yn=Array.isArray(Pt)?Pt:[Pt],An=yn.length>0,Sn={padding:Pn,boundary:yn.filter($cf1ac5d9fe0e8206$var$isNotNull),altBoundary:An},{reference:gn,floating:_n,strategy:Rn,x:bn,y:jn,placement:kn,middlewareData:Gn,update:Vn}=useFloating({strategy:"fixed",placement:On,whileElementsMounted:N$1,middleware:[$cf1ac5d9fe0e8206$var$anchorCssProperties(),T$2({mainAxis:yt+Cn,alignmentAxis:wt}),kt?D$1({mainAxis:!0,crossAxis:!1,limiter:xt==="partial"?L$2():void 0,...Sn}):void 0,pn?arrow({element:pn,padding:It}):void 0,kt?b$3({...Sn}):void 0,k$2({...Sn,apply:({elements:kr,availableWidth:un,availableHeight:sn})=>{kr.floating.style.setProperty("--radix-popper-available-width",`${un}px`),kr.floating.style.setProperty("--radix-popper-available-height",`${sn}px`)}}),$cf1ac5d9fe0e8206$var$transformOrigin({arrowWidth:dn,arrowHeight:Cn}),Nt?P({strategy:"referenceHidden"}):void 0].filter($cf1ac5d9fe0e8206$var$isDefined)});$9f79659886946c16$export$e5c5a5f917a5871c(()=>{gn(zt.anchor)},[gn,zt.anchor]);const qn=bn!==null&&jn!==null,[Tr,Mn]=$cf1ac5d9fe0e8206$var$getSideAndAlignFromPlacement(kn),Zt=$b1b2314f5f9a1d84$export$25bec8c6f54ee79a(Vt);$9f79659886946c16$export$e5c5a5f917a5871c(()=>{qn&&(Zt==null||Zt())},[qn,Zt]);const wn=(st=Gn.arrow)===null||st===void 0?void 0:st.x,xn=(at=Gn.arrow)===null||at===void 0?void 0:at.y,Hn=((lt=Gn.arrow)===null||lt===void 0?void 0:lt.centerOffset)!==0,[Bn,cr]=reactExports.useState();$9f79659886946c16$export$e5c5a5f917a5871c(()=>{Yt&&cr(window.getComputedStyle(Yt).zIndex)},[Yt]);const{hasParent:Wn,positionUpdateFns:rr}=$cf1ac5d9fe0e8206$var$usePositionContext($cf1ac5d9fe0e8206$var$CONTENT_NAME,gt),sr=!Wn;reactExports.useLayoutEffect(()=>{if(!sr)return rr.add(Vn),()=>{rr.delete(Vn)}},[sr,rr,Vn]),$9f79659886946c16$export$e5c5a5f917a5871c(()=>{sr&&qn&&Array.from(rr).reverse().forEach(kr=>requestAnimationFrame(kr))},[sr,qn,rr]);const ir={"data-side":Tr,"data-align":Mn,...Ft,ref:qt,style:{...Ft.style,animation:qn?void 0:"none",opacity:(dt=Gn.hide)!==null&&dt!==void 0&&dt.referenceHidden?0:void 0}};return reactExports.createElement("div",{ref:_n,"data-radix-popper-content-wrapper":"",style:{position:Rn,left:0,top:0,transform:qn?`translate3d(${Math.round(bn)}px, ${Math.round(jn)}px, 0)`:"translate3d(0, -200%, 0)",minWidth:"max-content",zIndex:Bn,"--radix-popper-transform-origin":[(ht=Gn.transformOrigin)===null||ht===void 0?void 0:ht.x,(ft=Gn.transformOrigin)===null||ft===void 0?void 0:ft.y].join(" ")},dir:nt.dir},reactExports.createElement($cf1ac5d9fe0e8206$var$PopperContentProvider,{scope:gt,placedSide:Tr,onArrowChange:an,arrowX:wn,arrowY:xn,shouldHideArrow:Hn},sr?reactExports.createElement($cf1ac5d9fe0e8206$var$PositionContextProvider,{scope:gt,hasParent:!0,positionUpdateFns:rr},reactExports.createElement($8927f6f2acc4f386$export$250ffa63cdc0d034.div,ir)):reactExports.createElement($8927f6f2acc4f386$export$250ffa63cdc0d034.div,ir)))}),$cf1ac5d9fe0e8206$var$ARROW_NAME="PopperArrow",$cf1ac5d9fe0e8206$var$OPPOSITE_SIDE={top:"bottom",right:"left",bottom:"top",left:"right"},$cf1ac5d9fe0e8206$export$79d62cd4e10a3fd0=reactExports.forwardRef(function(_,tt){const{__scopePopper:ot,...st}=_,at=$cf1ac5d9fe0e8206$var$useContentContext($cf1ac5d9fe0e8206$var$ARROW_NAME,ot),lt=$cf1ac5d9fe0e8206$var$OPPOSITE_SIDE[at.placedSide];return reactExports.createElement("span",{ref:at.onArrowChange,style:{position:"absolute",left:at.arrowX,top:at.arrowY,[lt]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[at.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[at.placedSide],visibility:at.shouldHideArrow?"hidden":void 0}},reactExports.createElement($7e8f5cd07187803e$export$be92b6f5f03c0fe9,_extends$1({},st,{ref:tt,style:{...st.style,display:"block"}})))});function $cf1ac5d9fe0e8206$var$isDefined(nt){return nt!==void 0}function $cf1ac5d9fe0e8206$var$isNotNull(nt){return nt!==null}const $cf1ac5d9fe0e8206$var$anchorCssProperties=()=>({name:"anchorCssProperties",fn(nt){const{rects:_,elements:tt}=nt,{width:ot,height:st}=_.reference;return tt.floating.style.setProperty("--radix-popper-anchor-width",`${ot}px`),tt.floating.style.setProperty("--radix-popper-anchor-height",`${st}px`),{}}}),$cf1ac5d9fe0e8206$var$transformOrigin=nt=>({name:"transformOrigin",options:nt,fn(_){var tt,ot,st,at,lt;const{placement:dt,rects:ht,middlewareData:ft}=_,Et=((tt=ft.arrow)===null||tt===void 0?void 0:tt.centerOffset)!==0,yt=Et?0:nt.arrowWidth,Ct=Et?0:nt.arrowHeight,[wt,It]=$cf1ac5d9fe0e8206$var$getSideAndAlignFromPlacement(dt),Pt={start:"0%",center:"50%",end:"100%"}[It],Rt=((ot=(st=ft.arrow)===null||st===void 0?void 0:st.x)!==null&&ot!==void 0?ot:0)+yt/2,xt=((at=(lt=ft.arrow)===null||lt===void 0?void 0:lt.y)!==null&&at!==void 0?at:0)+Ct/2;let Nt="",kt="";return wt==="bottom"?(Nt=Et?Pt:`${Rt}px`,kt=`${-Ct}px`):wt==="top"?(Nt=Et?Pt:`${Rt}px`,kt=`${ht.floating.height+Ct}px`):wt==="right"?(Nt=`${-Ct}px`,kt=Et?Pt:`${xt}px`):wt==="left"&&(Nt=`${ht.floating.width+Ct}px`,kt=Et?Pt:`${xt}px`),{data:{x:Nt,y:kt}}}});function $cf1ac5d9fe0e8206$var$getSideAndAlignFromPlacement(nt){const[_,tt="center"]=nt.split("-");return[_,tt]}const $cf1ac5d9fe0e8206$export$be92b6f5f03c0fe9=$cf1ac5d9fe0e8206$export$badac9ada3a0bdf9,$cf1ac5d9fe0e8206$export$b688253958b8dfe7=$cf1ac5d9fe0e8206$export$ecd4e1ccab6ed6d,$cf1ac5d9fe0e8206$export$7c6e2c02157bb7d2=$cf1ac5d9fe0e8206$export$bc4ae5855d3c4fc,$cf1ac5d9fe0e8206$export$21b07c8f274aebd5=$cf1ac5d9fe0e8206$export$79d62cd4e10a3fd0;function $fe963b355347cc68$export$3e6543de14f8614f(nt,_){return reactExports.useReducer((tt,ot)=>{const st=_[tt][ot];return st??tt},nt)}const $921a889cee6df7e8$export$99c2b779aa4e8b8b=nt=>{const{present:_,children:tt}=nt,ot=$921a889cee6df7e8$var$usePresence(_),st=typeof tt=="function"?tt({present:ot.isPresent}):reactExports.Children.only(tt),at=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(ot.ref,st.ref);return typeof tt=="function"||ot.isPresent?reactExports.cloneElement(st,{ref:at}):null};$921a889cee6df7e8$export$99c2b779aa4e8b8b.displayName="Presence";function $921a889cee6df7e8$var$usePresence(nt){const[_,tt]=reactExports.useState(),ot=reactExports.useRef({}),st=reactExports.useRef(nt),at=reactExports.useRef("none"),lt=nt?"mounted":"unmounted",[dt,ht]=$fe963b355347cc68$export$3e6543de14f8614f(lt,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return reactExports.useEffect(()=>{const ft=$921a889cee6df7e8$var$getAnimationName(ot.current);at.current=dt==="mounted"?ft:"none"},[dt]),$9f79659886946c16$export$e5c5a5f917a5871c(()=>{const ft=ot.current,gt=st.current;if(gt!==nt){const yt=at.current,Ct=$921a889cee6df7e8$var$getAnimationName(ft);nt?ht("MOUNT"):Ct==="none"||(ft==null?void 0:ft.display)==="none"?ht("UNMOUNT"):ht(gt&&yt!==Ct?"ANIMATION_OUT":"UNMOUNT"),st.current=nt}},[nt,ht]),$9f79659886946c16$export$e5c5a5f917a5871c(()=>{if(_){const ft=Et=>{const Ct=$921a889cee6df7e8$var$getAnimationName(ot.current).includes(Et.animationName);Et.target===_&&Ct&&reactDomExports.flushSync(()=>ht("ANIMATION_END"))},gt=Et=>{Et.target===_&&(at.current=$921a889cee6df7e8$var$getAnimationName(ot.current))};return _.addEventListener("animationstart",gt),_.addEventListener("animationcancel",ft),_.addEventListener("animationend",ft),()=>{_.removeEventListener("animationstart",gt),_.removeEventListener("animationcancel",ft),_.removeEventListener("animationend",ft)}}else ht("ANIMATION_END")},[_,ht]),{isPresent:["mounted","unmountSuspended"].includes(dt),ref:reactExports.useCallback(ft=>{ft&&(ot.current=getComputedStyle(ft)),tt(ft)},[])}}function $921a889cee6df7e8$var$getAnimationName(nt){return(nt==null?void 0:nt.animationName)||"none"}function $71cd76cc60e0454e$export$6f32135080cb4c3({prop:nt,defaultProp:_,onChange:tt=()=>{}}){const[ot,st]=$71cd76cc60e0454e$var$useUncontrolledState({defaultProp:_,onChange:tt}),at=nt!==void 0,lt=at?nt:ot,dt=$b1b2314f5f9a1d84$export$25bec8c6f54ee79a(tt),ht=reactExports.useCallback(ft=>{if(at){const Et=typeof ft=="function"?ft(nt):ft;Et!==nt&&dt(Et)}else st(ft)},[at,nt,st,dt]);return[lt,ht]}function $71cd76cc60e0454e$var$useUncontrolledState({defaultProp:nt,onChange:_}){const tt=reactExports.useState(nt),[ot]=tt,st=reactExports.useRef(ot),at=$b1b2314f5f9a1d84$export$25bec8c6f54ee79a(_);return reactExports.useEffect(()=>{st.current!==ot&&(at(ot),st.current=ot)},[ot,st,at]),tt}const $ea1ef594cf570d83$export$439d29a4e110a164=reactExports.forwardRef((nt,_)=>reactExports.createElement($8927f6f2acc4f386$export$250ffa63cdc0d034.span,_extends$1({},nt,{ref:_,style:{position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal",...nt.style}}))),$ea1ef594cf570d83$export$be92b6f5f03c0fe9=$ea1ef594cf570d83$export$439d29a4e110a164,[$a093c7e1ec25a057$var$createTooltipContext,$a093c7e1ec25a057$export$1c540a2224f0d865]=$c512c27ab02ef895$export$50c7b4e9d9f19c1("Tooltip",[$cf1ac5d9fe0e8206$export$722aac194ae923]),$a093c7e1ec25a057$var$usePopperScope=$cf1ac5d9fe0e8206$export$722aac194ae923(),$a093c7e1ec25a057$var$PROVIDER_NAME="TooltipProvider",$a093c7e1ec25a057$var$TOOLTIP_OPEN="tooltip.open",[$a093c7e1ec25a057$var$TooltipProviderContextProvider,$a093c7e1ec25a057$var$useTooltipProviderContext]=$a093c7e1ec25a057$var$createTooltipContext($a093c7e1ec25a057$var$PROVIDER_NAME),$a093c7e1ec25a057$var$TOOLTIP_NAME="Tooltip",[$a093c7e1ec25a057$var$TooltipContextProvider,$a093c7e1ec25a057$var$useTooltipContext]=$a093c7e1ec25a057$var$createTooltipContext($a093c7e1ec25a057$var$TOOLTIP_NAME),$a093c7e1ec25a057$export$28c660c63b792dea=nt=>{const{__scopeTooltip:_,children:tt,open:ot,defaultOpen:st=!1,onOpenChange:at,disableHoverableContent:lt,delayDuration:dt}=nt,ht=$a093c7e1ec25a057$var$useTooltipProviderContext($a093c7e1ec25a057$var$TOOLTIP_NAME,nt.__scopeTooltip),ft=$a093c7e1ec25a057$var$usePopperScope(_),[gt,Et]=reactExports.useState(null),yt=$1746a345f3d73bb7$export$f680877a34711e37(),Ct=reactExports.useRef(0),wt=lt??ht.disableHoverableContent,It=dt??ht.delayDuration,Pt=reactExports.useRef(!1),[Rt=!1,xt]=$71cd76cc60e0454e$export$6f32135080cb4c3({prop:ot,defaultProp:st,onChange:zt=>{zt?(ht.onOpen(),document.dispatchEvent(new CustomEvent($a093c7e1ec25a057$var$TOOLTIP_OPEN))):ht.onClose(),at==null||at(zt)}}),Nt=reactExports.useMemo(()=>Rt?Pt.current?"delayed-open":"instant-open":"closed",[Rt]),kt=reactExports.useCallback(()=>{window.clearTimeout(Ct.current),Pt.current=!1,xt(!0)},[xt]),Vt=reactExports.useCallback(()=>{window.clearTimeout(Ct.current),xt(!1)},[xt]),Ft=reactExports.useCallback(()=>{window.clearTimeout(Ct.current),Ct.current=window.setTimeout(()=>{Pt.current=!0,xt(!0)},It)},[It,xt]);return reactExports.useEffect(()=>()=>window.clearTimeout(Ct.current),[]),reactExports.createElement($cf1ac5d9fe0e8206$export$be92b6f5f03c0fe9,ft,reactExports.createElement($a093c7e1ec25a057$var$TooltipContextProvider,{scope:_,contentId:yt,open:Rt,stateAttribute:Nt,trigger:gt,onTriggerChange:Et,onTriggerEnter:reactExports.useCallback(()=>{ht.isOpenDelayed?Ft():kt()},[ht.isOpenDelayed,Ft,kt]),onTriggerLeave:reactExports.useCallback(()=>{wt?Vt():window.clearTimeout(Ct.current)},[Vt,wt]),onOpen:kt,onClose:Vt,disableHoverableContent:wt},tt))},$a093c7e1ec25a057$var$TRIGGER_NAME="TooltipTrigger",$a093c7e1ec25a057$export$8c610744efcf8a1d=reactExports.forwardRef((nt,_)=>{const{__scopeTooltip:tt,...ot}=nt,st=$a093c7e1ec25a057$var$useTooltipContext($a093c7e1ec25a057$var$TRIGGER_NAME,tt),at=$a093c7e1ec25a057$var$useTooltipProviderContext($a093c7e1ec25a057$var$TRIGGER_NAME,tt),lt=$a093c7e1ec25a057$var$usePopperScope(tt),dt=reactExports.useRef(null),ht=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(_,dt,st.onTriggerChange),ft=reactExports.useRef(!1),gt=reactExports.useRef(!1),Et=reactExports.useCallback(()=>ft.current=!1,[]);return reactExports.useEffect(()=>()=>document.removeEventListener("pointerup",Et),[Et]),reactExports.createElement($cf1ac5d9fe0e8206$export$b688253958b8dfe7,_extends$1({asChild:!0},lt),reactExports.createElement($8927f6f2acc4f386$export$250ffa63cdc0d034.button,_extends$1({"aria-describedby":st.open?st.contentId:void 0,"data-state":st.stateAttribute},ot,{ref:ht,onPointerMove:$e42e1063c40fb3ef$export$b9ecd428b558ff10(nt.onPointerMove,yt=>{yt.pointerType!=="touch"&&!gt.current&&!at.isPointerInTransitRef.current&&(st.onTriggerEnter(),gt.current=!0)}),onPointerLeave:$e42e1063c40fb3ef$export$b9ecd428b558ff10(nt.onPointerLeave,()=>{st.onTriggerLeave(),gt.current=!1}),onPointerDown:$e42e1063c40fb3ef$export$b9ecd428b558ff10(nt.onPointerDown,()=>{ft.current=!0,document.addEventListener("pointerup",Et,{once:!0})}),onFocus:$e42e1063c40fb3ef$export$b9ecd428b558ff10(nt.onFocus,()=>{ft.current||st.onOpen()}),onBlur:$e42e1063c40fb3ef$export$b9ecd428b558ff10(nt.onBlur,st.onClose),onClick:$e42e1063c40fb3ef$export$b9ecd428b558ff10(nt.onClick,st.onClose)})))}),$a093c7e1ec25a057$var$PORTAL_NAME="TooltipPortal",[$a093c7e1ec25a057$var$PortalProvider,$a093c7e1ec25a057$var$usePortalContext]=$a093c7e1ec25a057$var$createTooltipContext($a093c7e1ec25a057$var$PORTAL_NAME,{forceMount:void 0}),$a093c7e1ec25a057$var$CONTENT_NAME="TooltipContent",$a093c7e1ec25a057$export$e9003e2be37ec060=reactExports.forwardRef((nt,_)=>{const tt=$a093c7e1ec25a057$var$usePortalContext($a093c7e1ec25a057$var$CONTENT_NAME,nt.__scopeTooltip),{forceMount:ot=tt.forceMount,side:st="top",...at}=nt,lt=$a093c7e1ec25a057$var$useTooltipContext($a093c7e1ec25a057$var$CONTENT_NAME,nt.__scopeTooltip);return reactExports.createElement($921a889cee6df7e8$export$99c2b779aa4e8b8b,{present:ot||lt.open},lt.disableHoverableContent?reactExports.createElement($a093c7e1ec25a057$var$TooltipContentImpl,_extends$1({side:st},at,{ref:_})):reactExports.createElement($a093c7e1ec25a057$var$TooltipContentHoverable,_extends$1({side:st},at,{ref:_})))}),$a093c7e1ec25a057$var$TooltipContentHoverable=reactExports.forwardRef((nt,_)=>{const tt=$a093c7e1ec25a057$var$useTooltipContext($a093c7e1ec25a057$var$CONTENT_NAME,nt.__scopeTooltip),ot=$a093c7e1ec25a057$var$useTooltipProviderContext($a093c7e1ec25a057$var$CONTENT_NAME,nt.__scopeTooltip),st=reactExports.useRef(null),at=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(_,st),[lt,dt]=reactExports.useState(null),{trigger:ht,onClose:ft}=tt,gt=st.current,{onPointerInTransitChange:Et}=ot,yt=reactExports.useCallback(()=>{dt(null),Et(!1)},[Et]),Ct=reactExports.useCallback((wt,It)=>{const Pt=wt.currentTarget,Rt={x:wt.clientX,y:wt.clientY},xt=$a093c7e1ec25a057$var$getExitSideFromRect(Rt,Pt.getBoundingClientRect()),Nt=xt==="right"||xt==="bottom"?-5:5,Vt=xt==="right"||xt==="left"?{x:wt.clientX+Nt,y:wt.clientY}:{x:wt.clientX,y:wt.clientY+Nt},Ft=$a093c7e1ec25a057$var$getPointsFromRect(It.getBoundingClientRect()),zt=$a093c7e1ec25a057$var$getHull([Vt,...Ft]);dt(zt),Et(!0)},[Et]);return reactExports.useEffect(()=>()=>yt(),[yt]),reactExports.useEffect(()=>{if(ht&&gt){const wt=Pt=>Ct(Pt,gt),It=Pt=>Ct(Pt,ht);return ht.addEventListener("pointerleave",wt),gt.addEventListener("pointerleave",It),()=>{ht.removeEventListener("pointerleave",wt),gt.removeEventListener("pointerleave",It)}}},[ht,gt,Ct,yt]),reactExports.useEffect(()=>{if(lt){const wt=It=>{const Pt=It.target,Rt={x:It.clientX,y:It.clientY},xt=(ht==null?void 0:ht.contains(Pt))||(gt==null?void 0:gt.contains(Pt)),Nt=!$a093c7e1ec25a057$var$isPointInPolygon(Rt,lt);xt?yt():Nt&&(yt(),ft())};return document.addEventListener("pointermove",wt),()=>document.removeEventListener("pointermove",wt)}},[ht,gt,lt,ft,yt]),reactExports.createElement($a093c7e1ec25a057$var$TooltipContentImpl,_extends$1({},nt,{ref:at}))}),[$a093c7e1ec25a057$var$VisuallyHiddenContentContextProvider,$a093c7e1ec25a057$var$useVisuallyHiddenContentContext]=$a093c7e1ec25a057$var$createTooltipContext($a093c7e1ec25a057$var$TOOLTIP_NAME,{isInside:!1}),$a093c7e1ec25a057$var$TooltipContentImpl=reactExports.forwardRef((nt,_)=>{const{__scopeTooltip:tt,children:ot,"aria-label":st,onEscapeKeyDown:at,onPointerDownOutside:lt,...dt}=nt,ht=$a093c7e1ec25a057$var$useTooltipContext($a093c7e1ec25a057$var$CONTENT_NAME,tt),ft=$a093c7e1ec25a057$var$usePopperScope(tt),{onClose:gt}=ht;return reactExports.useEffect(()=>(document.addEventListener($a093c7e1ec25a057$var$TOOLTIP_OPEN,gt),()=>document.removeEventListener($a093c7e1ec25a057$var$TOOLTIP_OPEN,gt)),[gt]),reactExports.useEffect(()=>{if(ht.trigger){const Et=yt=>{const Ct=yt.target;Ct!=null&&Ct.contains(ht.trigger)&&gt()};return window.addEventListener("scroll",Et,{capture:!0}),()=>window.removeEventListener("scroll",Et,{capture:!0})}},[ht.trigger,gt]),reactExports.createElement($5cb92bef7577960e$export$177fb62ff3ec1f22,{asChild:!0,disableOutsidePointerEvents:!1,onEscapeKeyDown:at,onPointerDownOutside:lt,onFocusOutside:Et=>Et.preventDefault(),onDismiss:gt},reactExports.createElement($cf1ac5d9fe0e8206$export$7c6e2c02157bb7d2,_extends$1({"data-state":ht.stateAttribute},ft,dt,{ref:_,style:{...dt.style,"--radix-tooltip-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-tooltip-content-available-width":"var(--radix-popper-available-width)","--radix-tooltip-content-available-height":"var(--radix-popper-available-height)","--radix-tooltip-trigger-width":"var(--radix-popper-anchor-width)","--radix-tooltip-trigger-height":"var(--radix-popper-anchor-height)"}}),reactExports.createElement($5e63c961fc1ce211$export$d9f1ccf0bdb05d45,null,ot),reactExports.createElement($a093c7e1ec25a057$var$VisuallyHiddenContentContextProvider,{scope:tt,isInside:!0},reactExports.createElement($ea1ef594cf570d83$export$be92b6f5f03c0fe9,{id:ht.contentId,role:"tooltip"},st||ot))))}),$a093c7e1ec25a057$var$ARROW_NAME="TooltipArrow",$a093c7e1ec25a057$export$c27ee0ad710f7559=reactExports.forwardRef((nt,_)=>{const{__scopeTooltip:tt,...ot}=nt,st=$a093c7e1ec25a057$var$usePopperScope(tt);return $a093c7e1ec25a057$var$useVisuallyHiddenContentContext($a093c7e1ec25a057$var$ARROW_NAME,tt).isInside?null:reactExports.createElement($cf1ac5d9fe0e8206$export$21b07c8f274aebd5,_extends$1({},st,ot,{ref:_}))});function $a093c7e1ec25a057$var$getExitSideFromRect(nt,_){const tt=Math.abs(_.top-nt.y),ot=Math.abs(_.bottom-nt.y),st=Math.abs(_.right-nt.x),at=Math.abs(_.left-nt.x);switch(Math.min(tt,ot,st,at)){case at:return"left";case st:return"right";case tt:return"top";case ot:return"bottom";default:return null}}function $a093c7e1ec25a057$var$getPointsFromRect(nt){const{top:_,right:tt,bottom:ot,left:st}=nt;return[{x:st,y:_},{x:tt,y:_},{x:tt,y:ot},{x:st,y:ot}]}function $a093c7e1ec25a057$var$isPointInPolygon(nt,_){const{x:tt,y:ot}=nt;let st=!1;for(let at=0,lt=_.length-1;at<_.length;lt=at++){const dt=_[at].x,ht=_[at].y,ft=_[lt].x,gt=_[lt].y;ht>ot!=gt>ot&&tt<(ft-dt)*(ot-ht)/(gt-ht)+dt&&(st=!st)}return st}function $a093c7e1ec25a057$var$getHull(nt){const _=nt.slice();return _.sort((tt,ot)=>tt.x<ot.x?-1:tt.x>ot.x?1:tt.y<ot.y?-1:tt.y>ot.y?1:0),$a093c7e1ec25a057$var$getHullPresorted(_)}function $a093c7e1ec25a057$var$getHullPresorted(nt){if(nt.length<=1)return nt.slice();const _=[];for(let ot=0;ot<nt.length;ot++){const st=nt[ot];for(;_.length>=2;){const at=_[_.length-1],lt=_[_.length-2];if((at.x-lt.x)*(st.y-lt.y)>=(at.y-lt.y)*(st.x-lt.x))_.pop();else break}_.push(st)}_.pop();const tt=[];for(let ot=nt.length-1;ot>=0;ot--){const st=nt[ot];for(;tt.length>=2;){const at=tt[tt.length-1],lt=tt[tt.length-2];if((at.x-lt.x)*(st.y-lt.y)>=(at.y-lt.y)*(st.x-lt.x))tt.pop();else break}tt.push(st)}return tt.pop(),_.length===1&&tt.length===1&&_[0].x===tt[0].x&&_[0].y===tt[0].y?_:_.concat(tt)}const $a093c7e1ec25a057$export$be92b6f5f03c0fe9=$a093c7e1ec25a057$export$28c660c63b792dea,$a093c7e1ec25a057$export$41fb9f06171c75f4=$a093c7e1ec25a057$export$8c610744efcf8a1d,$a093c7e1ec25a057$export$7c6e2c02157bb7d2=$a093c7e1ec25a057$export$e9003e2be37ec060,$a093c7e1ec25a057$export$21b07c8f274aebd5=$a093c7e1ec25a057$export$c27ee0ad710f7559;function _objectWithoutPropertiesLoose$1(nt,_){if(nt==null)return{};var tt={},ot=Object.keys(nt),st,at;for(at=0;at<ot.length;at++)st=ot[at],!(_.indexOf(st)>=0)&&(tt[st]=nt[st]);return tt}function _objectWithoutProperties$1(nt,_){if(nt==null)return{};var tt=_objectWithoutPropertiesLoose$1(nt,_),ot,st;if(Object.getOwnPropertySymbols){var at=Object.getOwnPropertySymbols(nt);for(st=0;st<at.length;st++)ot=at[st],!(_.indexOf(ot)>=0)&&Object.prototype.propertyIsEnumerable.call(nt,ot)&&(tt[ot]=nt[ot])}return tt}let LevaErrors;(function(nt){nt[nt.UNSUPPORTED_INPUT=0]="UNSUPPORTED_INPUT",nt[nt.NO_COMPONENT_FOR_TYPE=1]="NO_COMPONENT_FOR_TYPE",nt[nt.UNKNOWN_INPUT=2]="UNKNOWN_INPUT",nt[nt.DUPLICATE_KEYS=3]="DUPLICATE_KEYS",nt[nt.ALREADY_REGISTERED_TYPE=4]="ALREADY_REGISTERED_TYPE",nt[nt.CLIPBOARD_ERROR=5]="CLIPBOARD_ERROR",nt[nt.THEME_ERROR=6]="THEME_ERROR",nt[nt.PATH_DOESNT_EXIST=7]="PATH_DOESNT_EXIST",nt[nt.INPUT_TYPE_OVERRIDE=8]="INPUT_TYPE_OVERRIDE",nt[nt.EMPTY_KEY=9]="EMPTY_KEY"})(LevaErrors||(LevaErrors={}));const ErrorList={[LevaErrors.UNSUPPORTED_INPUT]:(nt,_)=>[`An input with type \`${nt}\` input was found at path \`${_}\` but it's not supported yet.`],[LevaErrors.NO_COMPONENT_FOR_TYPE]:(nt,_)=>[`Type \`${nt}\` found at path \`${_}\` can't be displayed in panel because no component supports it yet.`],[LevaErrors.UNKNOWN_INPUT]:(nt,_)=>[`input at path \`${nt}\` is not recognized.`,_],[LevaErrors.DUPLICATE_KEYS]:(nt,_,tt)=>[`Key \`${nt}\` of path \`${_}\` already exists at path \`${tt}\`. Even nested keys need to be unique. Rename one of the keys.`],[LevaErrors.ALREADY_REGISTERED_TYPE]:nt=>[`Type ${nt} has already been registered. You can't register a component with the same type.`],[LevaErrors.CLIPBOARD_ERROR]:nt=>["Error copying the value",nt],[LevaErrors.THEME_ERROR]:(nt,_)=>[`Error accessing the theme \`${nt}.${_}\` value.`],[LevaErrors.PATH_DOESNT_EXIST]:nt=>[`Error getting the value at path \`${nt}\`. There is probably an error in your \`render\` function.`],[LevaErrors.PATH_DOESNT_EXIST]:nt=>[`Error accessing the value at path \`${nt}\``],[LevaErrors.INPUT_TYPE_OVERRIDE]:(nt,_,tt)=>[`Input at path \`${nt}\` already exists with type: \`${_}\`. Its type cannot be overridden with type \`${tt}\`.`],[LevaErrors.EMPTY_KEY]:()=>["Keys can not be empty, if you want to hide a label use whitespace."]};function _log(nt,_,...tt){const[ot,...st]=ErrorList[_](...tt);console[nt]("LEVA: "+ot,...st)}const warn=_log.bind(null,"warn"),log=_log.bind(null,"log"),_excluded$a=["value"],_excluded2$4=["schema"],_excluded3$1=["value"],Schemas=[],Plugins={};function getValueType(nt){let{value:_}=nt,tt=_objectWithoutProperties$1(nt,_excluded$a);for(let ot of Schemas){const st=ot(_,tt);if(st)return st}}function register(nt,_){let{schema:tt}=_,ot=_objectWithoutProperties$1(_,_excluded2$4);if(nt in Plugins){warn(LevaErrors.ALREADY_REGISTERED_TYPE,nt);return}Schemas.push((st,at)=>tt(st,at)&&nt),Plugins[nt]=ot}function createInternalPlugin(nt){return nt}function normalize$3$1(nt,_,tt,ot){const{normalize:st}=Plugins[nt];if(st)return st(_,tt,ot);if(typeof _!="object"||!("value"in _))return{value:_};const{value:at}=_,lt=_objectWithoutProperties$1(_,_excluded3$1);return{value:at,settings:lt}}function sanitize$4(nt,_,tt,ot,st,at){const{sanitize:lt}=Plugins[nt];return lt?lt(_,tt,ot,st,at):_}function format$2(nt,_,tt){const{format:ot}=Plugins[nt];return ot?ot(_,tt):_}function _defineProperty$2(nt,_,tt){return _ in nt?Object.defineProperty(nt,_,{value:tt,enumerable:!0,configurable:!0,writable:!0}):nt[_]=tt,nt}function ownKeys$2(nt,_){var tt=Object.keys(nt);if(Object.getOwnPropertySymbols){var ot=Object.getOwnPropertySymbols(nt);_&&(ot=ot.filter(function(st){return Object.getOwnPropertyDescriptor(nt,st).enumerable})),tt.push.apply(tt,ot)}return tt}function _objectSpread2(nt){for(var _=1;_<arguments.length;_++){var tt=arguments[_]!=null?arguments[_]:{};_%2?ownKeys$2(Object(tt),!0).forEach(function(ot){_defineProperty$2(nt,ot,tt[ot])}):Object.getOwnPropertyDescriptors?Object.defineProperties(nt,Object.getOwnPropertyDescriptors(tt)):ownKeys$2(Object(tt)).forEach(function(ot){Object.defineProperty(nt,ot,Object.getOwnPropertyDescriptor(tt,ot))})}return nt}const clamp=(nt,_,tt)=>nt>tt?tt:nt<_?_:nt,parseNumber=nt=>{if(nt===""||typeof nt=="number")return nt;try{const _=evaluate(nt);if(!isNaN(_))return _}catch{}return parseFloat(nt)},log10=Math.log(10);function getStep(nt){let _=Math.abs(+String(nt).replace(".",""));if(_===0)return .01;for(;_!==0&&_%10===0;)_/=10;const tt=Math.floor(Math.log(_)/log10)+1,ot=Math.floor(Math.log10(Math.abs(nt))),st=Math.pow(10,ot-tt);return Math.max(st,.001)}const range=(nt,_,tt)=>tt===_?0:(clamp(nt,_,tt)-_)/(tt-_),invertedRange=(nt,_,tt)=>nt*(tt-_)+_,getUid=()=>"_"+Math.random().toString(36).substr(2,9),parens=/\(([0-9+\-*/^ .]+)\)/,exp=/(\d+(?:\.\d+)?) ?\^ ?(\d+(?:\.\d+)?)/,mul=/(\d+(?:\.\d+)?) ?\* ?(\d+(?:\.\d+)?)/,div=/(\d+(?:\.\d+)?) ?\/ ?(\d+(?:\.\d+)?)/,add=/(\d+(?:\.\d+)?) ?\+ ?(\d+(?:\.\d+)?)/,sub=/(\d+(?:\.\d+)?) ?- ?(\d+(?:\.\d+)?)/;function evaluate(nt){if(isNaN(Number(nt)))if(parens.test(nt)){const _=nt.replace(parens,(tt,ot)=>String(evaluate(ot)));return evaluate(_)}else if(exp.test(nt)){const _=nt.replace(exp,(tt,ot,st)=>String(Math.pow(Number(ot),Number(st))));return evaluate(_)}else if(mul.test(nt)){const _=nt.replace(mul,(tt,ot,st)=>String(Number(ot)*Number(st)));return evaluate(_)}else if(div.test(nt)){const _=nt.replace(div,(tt,ot,st)=>{if(st!=0)return String(Number(ot)/Number(st));throw new Error("Division by zero")});return evaluate(_)}else if(add.test(nt)){const _=nt.replace(add,(tt,ot,st)=>String(Number(ot)+Number(st)));return evaluate(_)}else if(sub.test(nt)){const _=nt.replace(sub,(tt,ot,st)=>String(Number(ot)-Number(st)));return evaluate(_)}else return Number(nt);return Number(nt)}function pick(nt,_){return _.reduce((tt,ot)=>(nt&&nt.hasOwnProperty(ot)&&(tt[ot]=nt[ot]),tt),{})}function omit(nt,_){const tt=_objectSpread2({},nt);return _.forEach(ot=>ot in nt&&delete tt[ot]),tt}function mapArrayToKeys(nt,_){return nt.reduce((tt,ot,st)=>Object.assign(tt,{[_[st]]:ot}),{})}function isObject$8(nt){return Object.prototype.toString.call(nt)==="[object Object]"}const isEmptyObject=nt=>isObject$8(nt)&&Object.keys(nt).length===0;let SpecialInputs;(function(nt){nt.BUTTON="BUTTON",nt.BUTTON_GROUP="BUTTON_GROUP",nt.MONITOR="MONITOR",nt.FOLDER="FOLDER"})(SpecialInputs||(SpecialInputs={}));let LevaInputs;(function(nt){nt.SELECT="SELECT",nt.IMAGE="IMAGE",nt.NUMBER="NUMBER",nt.COLOR="COLOR",nt.STRING="STRING",nt.BOOLEAN="BOOLEAN",nt.INTERVAL="INTERVAL",nt.VECTOR3D="VECTOR3D",nt.VECTOR2D="VECTOR2D"})(LevaInputs||(LevaInputs={}));const _excluded$9=["type","__customInput"],_excluded2$3=["render","label","optional","order","disabled","hint","onChange","onEditStart","onEditEnd","transient"],_excluded3$2=["type"];function parseOptions(nt,_,tt={},ot){var st,at;if(typeof nt!="object"||Array.isArray(nt))return{type:ot,input:nt,options:_objectSpread2({key:_,label:_,optional:!1,disabled:!1,order:0},tt)};if("__customInput"in nt){const{type:Vt,__customInput:Ft}=nt,zt=_objectWithoutProperties$1(nt,_excluded$9);return parseOptions(Ft,_,zt,Vt)}const{render:lt,label:dt,optional:ht,order:ft=0,disabled:gt,hint:Et,onChange:yt,onEditStart:Ct,onEditEnd:wt,transient:It}=nt,Pt=_objectWithoutProperties$1(nt,_excluded2$3),Rt=_objectSpread2({render:lt,key:_,label:dt??_,hint:Et,transient:It??!!yt,onEditStart:Ct,onEditEnd:wt,disabled:gt,optional:ht,order:ft},tt);let{type:xt}=Pt,Nt=_objectWithoutProperties$1(Pt,_excluded3$2);if(xt=ot??xt,xt in SpecialInputs)return{type:xt,input:Nt,options:Rt};let kt;return ot&&isObject$8(Nt)&&"value"in Nt?kt=Nt.value:kt=isEmptyObject(Nt)?void 0:Nt,{type:xt,input:kt,options:_objectSpread2(_objectSpread2({},Rt),{},{onChange:yt,optional:(st=Rt.optional)!==null&&st!==void 0?st:!1,disabled:(at=Rt.disabled)!==null&&at!==void 0?at:!1})}}function normalizeInput(nt,_,tt,ot){const st=parseOptions(nt,_),{type:at,input:lt,options:dt}=st;if(at)return at in SpecialInputs?st:{type:at,input:normalize$3$1(at,lt,tt,ot),options:dt};let ht=getValueType(lt);return ht?{type:ht,input:normalize$3$1(ht,lt,tt,ot),options:dt}:(ht=getValueType({value:lt}),ht?{type:ht,input:normalize$3$1(ht,{value:lt},tt,ot),options:dt}:!1)}function updateInput(nt,_,tt,ot,st){const{value:at,type:lt,settings:dt}=nt;nt.value=sanitizeValue({type:lt,value:at,settings:dt},_,tt,ot),nt.fromPanel=st}const ValueError=function(_,tt,ot){this.type="LEVA_ERROR",this.message="LEVA: "+_,this.previousValue=tt,this.error=ot};function sanitizeValue({type:nt,value:_,settings:tt},ot,st,at){const lt=nt!=="SELECT"&&typeof ot=="function"?ot(_):ot;let dt;try{dt=sanitize$4(nt,lt,tt,_,st,at)}catch(ht){throw new ValueError(`The value \`${ot}\` did not result in a correct value.`,_,ht)}return dequal(dt,_)?_:dt}const debounce=(nt,_,tt=!1)=>{let ot=0;return function(){const st=arguments,at=tt&&!ot,lt=()=>nt.apply(this,st);window.clearTimeout(ot),ot=window.setTimeout(lt,_),at&&lt()}},multiplyStep=nt=>nt.shiftKey?5:nt.altKey?1/5:1;function render(nt,_){const tt=console.error;console.error=()=>{},ReactDOM.render(nt,_),console.error=tt}const _excluded$8=["value"],_excluded2$2$1=["min","max"],schema$3=nt=>{if(typeof nt=="number")return!0;if(typeof nt=="string"){const _=parseFloat(nt);return isNaN(_)?!1:nt.substring((""+_).length).trim().length<4}return!1},sanitize$3=(nt,{min:_=-1/0,max:tt=1/0,suffix:ot})=>{const st=parseFloat(nt);if(nt===""||isNaN(st))throw Error("Invalid number");const at=clamp(st,_,tt);return ot?at+ot:at},format$1$1=(nt,{pad:_=0,suffix:tt})=>{const ot=parseFloat(nt).toFixed(_);return tt?ot+tt:ot},normalize$2$1=nt=>{let{value:_}=nt,tt=_objectWithoutProperties$1(nt,_excluded$8);const{min:ot=-1/0,max:st=1/0}=tt,at=_objectWithoutProperties$1(tt,_excluded2$2$1);let lt=parseFloat(_);const dt=typeof _=="string"?_.substring((""+lt).length):void 0;lt=clamp(lt,ot,st);let ht=tt.step;ht||(Number.isFinite(ot)?Number.isFinite(st)?ht=+(Math.abs(st-ot)/100).toPrecision(1):ht=+(Math.abs(lt-ot)/100).toPrecision(1):Number.isFinite(st)&&(ht=+(Math.abs(st-lt)/100).toPrecision(1)));const ft=ht?getStep(ht)*10:getStep(lt);ht=ht||ft/10;const gt=Math.round(clamp(Math.log10(1/ft),0,2));return{value:dt?lt+dt:lt,settings:_objectSpread2({initialValue:lt,step:ht,pad:gt,min:ot,max:st,suffix:dt},at)}},sanitizeStep$1=(nt,{step:_,initialValue:tt})=>{const ot=Math.round((nt-tt)/_);return tt+ot*_};var props$3=Object.freeze({__proto__:null,schema:schema$3,sanitize:sanitize$3,format:format$1$1,normalize:normalize$2$1,sanitizeStep:sanitizeStep$1});function _extends(){return _extends=Object.assign?Object.assign.bind():function(nt){for(var _=1;_<arguments.length;_++){var tt=arguments[_];for(var ot in tt)Object.prototype.hasOwnProperty.call(tt,ot)&&(nt[ot]=tt[ot])}return nt},_extends.apply(this,arguments)}const InputContext=reactExports.createContext({});function useInputContext(){return reactExports.useContext(InputContext)}const ThemeContext=reactExports.createContext(null),StoreContext=reactExports.createContext(null),PanelSettingsContext=reactExports.createContext(null);function useStoreContext(){return reactExports.useContext(StoreContext)}function usePanelSettingsContext(){return reactExports.useContext(PanelSettingsContext)}const getDefaultTheme=()=>({colors:{elevation1:"#292d39",elevation2:"#181c20",elevation3:"#373c4b",accent1:"#0066dc",accent2:"#007bff",accent3:"#3c93ff",highlight1:"#535760",highlight2:"#8c92a4",highlight3:"#fefefe",vivid1:"#ffcc00",folderWidgetColor:"$highlight2",folderTextColor:"$highlight3",toolTipBackground:"$highlight3",toolTipText:"$elevation2"},radii:{xs:"2px",sm:"3px",lg:"10px"},space:{xs:"3px",sm:"6px",md:"10px",rowGap:"7px",colGap:"7px"},fonts:{mono:"ui-monospace, SFMono-Regular, Menlo, 'Roboto Mono', monospace",sans:"system-ui, sans-serif"},fontSizes:{root:"11px",toolTip:"$root"},sizes:{rootWidth:"280px",controlWidth:"160px",numberInputMinWidth:"38px",scrubberWidth:"8px",scrubberHeight:"16px",rowHeight:"24px",folderTitleHeight:"20px",checkboxSize:"16px",joystickWidth:"100px",joystickHeight:"100px",colorPickerWidth:"$controlWidth",colorPickerHeight:"100px",imagePreviewWidth:"$controlWidth",imagePreviewHeight:"100px",monitorHeight:"60px",titleBarHeight:"39px"},shadows:{level1:"0 0 9px 0 #00000088",level2:"0 4px 14px #00000033"},borderWidths:{root:"0px",input:"1px",focus:"1px",hover:"1px",active:"1px",folder:"1px"},fontWeights:{label:"normal",folder:"normal",button:"normal"}});function createStateClass(nt,_){const[tt,ot]=nt.split(" "),st={};return tt!=="none"&&(st.boxShadow=`${_.inset?"inset ":""}0 0 0 $borderWidths${[_.key]} $colors${tt!=="default"&&tt||_.borderColor}`),ot&&(st.backgroundColor=ot),st}const utils={$inputStyle:()=>nt=>createStateClass(nt,{key:"$input",borderColor:"$highlight1",inset:!0}),$focusStyle:()=>nt=>createStateClass(nt,{key:"$focus",borderColor:"$accent2"}),$hoverStyle:()=>nt=>createStateClass(nt,{key:"$hover",borderColor:"$accent1",inset:!0}),$activeStyle:()=>nt=>createStateClass(nt,{key:"$active",borderColor:"$accent1",inset:!0})},{styled,css,createTheme,globalCss,keyframes}=q$1({prefix:"leva",theme:getDefaultTheme(),utils:_objectSpread2(_objectSpread2({},utils),{},{$flex:()=>({display:"flex",alignItems:"center"}),$flexCenter:()=>({display:"flex",alignItems:"center",justifyContent:"center"}),$reset:()=>({outline:"none",fontSize:"inherit",fontWeight:"inherit",color:"inherit",fontFamily:"inherit",border:"none",backgroundColor:"transparent",appearance:"none"}),$draggable:()=>({touchAction:"none",WebkitUserDrag:"none",userSelect:"none"}),$focus:nt=>({"&:focus":utils.$focusStyle()(nt)}),$focusWithin:nt=>({"&:focus-within":utils.$focusStyle()(nt)}),$hover:nt=>({"&:hover":utils.$hoverStyle()(nt)}),$active:nt=>({"&:active":utils.$activeStyle()(nt)})})}),globalStyles=globalCss({".leva__panel__dragged":{WebkitUserDrag:"none",userSelect:"none",input:{userSelect:"none"},"*":{cursor:"ew-resize !important"}}});function mergeTheme(nt){const _=getDefaultTheme();if(!nt)return{theme:_,className:""};Object.keys(nt).forEach(ot=>{Object.assign(_[ot],nt[ot])});const tt=createTheme(_);return{theme:_,className:tt.className}}function useTh(nt,_){const{theme:tt}=reactExports.useContext(ThemeContext);if(!(nt in tt)||!(_ in tt[nt]))return warn(LevaErrors.THEME_ERROR,nt,_),"";let ot=_;for(;;){let st=tt[nt][ot];if(typeof st=="string"&&st.charAt(0)==="$")ot=st.substr(1);else return st}}const StyledInput=styled("input",{$reset:"",padding:"0 $sm",width:0,minWidth:0,flex:1,height:"100%",variants:{levaType:{number:{textAlign:"right"}},as:{textarea:{padding:"$sm"}}}}),InnerLabel=styled("div",{$draggable:"",height:"100%",$flexCenter:"",position:"relative",padding:"0 $xs",fontSize:"0.8em",opacity:.8,cursor:"default",touchAction:"none",[`& + ${StyledInput}`]:{paddingLeft:0}}),InnerNumberLabel=styled(InnerLabel,{cursor:"ew-resize",marginRight:"-$xs",textTransform:"uppercase",opacity:.3,"&:hover":{opacity:1},variants:{dragging:{true:{backgroundColor:"$accent2",opacity:1}}}}),InputContainer=styled("div",{$flex:"",position:"relative",borderRadius:"$sm",overflow:"hidden",color:"inherit",height:"$rowHeight",backgroundColor:"$elevation3",$inputStyle:"$elevation1",$hover:"",$focusWithin:"",variants:{textArea:{true:{height:"auto"}}}}),_excluded$7$1=["innerLabel","value","onUpdate","onChange","onKeyDown","type","id","inputType","rows"],_excluded2$1$1=["onUpdate"];function ValueInput(nt){let{innerLabel:_,value:tt,onUpdate:ot,onChange:st,onKeyDown:at,type:lt,id:dt,inputType:ht="text",rows:ft=0}=nt,gt=_objectWithoutProperties$1(nt,_excluded$7$1);const{id:Et,emitOnEditStart:yt,emitOnEditEnd:Ct,disabled:wt}=useInputContext(),It=dt||Et,Pt=reactExports.useRef(null),Rt=ft>0,xt=Rt?"textarea":"input",Nt=reactExports.useCallback(Ft=>zt=>{const Yt=zt.currentTarget.value;Ft(Yt)},[]);React.useEffect(()=>{const Ft=Pt.current,zt=Nt(Yt=>{ot(Yt),Ct()});return Ft==null||Ft.addEventListener("blur",zt),()=>Ft==null?void 0:Ft.removeEventListener("blur",zt)},[Nt,ot,Ct]);const kt=reactExports.useCallback(Ft=>{Ft.key==="Enter"&&Nt(ot)(Ft)},[Nt,ot]),Vt=Object.assign({as:xt},Rt?{rows:ft}:{},gt);return React.createElement(InputContainer,{textArea:Rt},_&&typeof _=="string"?React.createElement(InnerLabel,null,_):_,React.createElement(StyledInput,_extends({levaType:lt,ref:Pt,id:It,type:ht,autoComplete:"off",spellCheck:"false",value:tt,onChange:Nt(st),onFocus:()=>yt(),onKeyPress:kt,onKeyDown:at,disabled:wt},Vt)))}function NumberInput(nt){let{onUpdate:_}=nt,tt=_objectWithoutProperties$1(nt,_excluded2$1$1);const ot=reactExports.useCallback(at=>_(parseNumber(at)),[_]),st=reactExports.useCallback(at=>{const lt=at.key==="ArrowUp"?1:at.key==="ArrowDown"?-1:0;if(lt){at.preventDefault();const dt=at.altKey?.1:at.shiftKey?10:1;_(ht=>parseFloat(ht)+lt*dt)}},[_]);return React.createElement(ValueInput,_extends({},tt,{onUpdate:ot,onKeyDown:st,type:"number"}))}const StyledFolder=styled("div",{}),StyledWrapper=styled("div",{position:"relative",background:"$elevation2",transition:"height 300ms ease",variants:{fill:{true:{},false:{}},flat:{false:{},true:{}},isRoot:{true:{},false:{paddingLeft:"$md","&::after":{content:'""',position:"absolute",left:0,top:0,width:"$borderWidths$folder",height:"100%",backgroundColor:"$folderWidgetColor",opacity:.4,transform:"translateX(-50%)"}}}},compoundVariants:[{isRoot:!0,fill:!1,css:{overflowY:"auto",maxHeight:"calc(100vh - 20px - $$titleBarHeight)"}},{isRoot:!0,flat:!1,css:{borderRadius:"$lg"}}]}),StyledTitle=styled("div",{$flex:"",color:"$folderTextColor",userSelect:"none",cursor:"pointer",height:"$folderTitleHeight",fontWeight:"$folder","> svg":{marginLeft:-4,marginRight:4,cursor:"pointer",fill:"$folderWidgetColor",opacity:.6},"&:hover > svg":{fill:"$folderWidgetColor"},[`&:hover + ${StyledWrapper}::after`]:{opacity:.6},[`${StyledFolder}:hover > & + ${StyledWrapper}::after`]:{opacity:.6},[`${StyledFolder}:hover > & > svg`]:{opacity:1}}),StyledContent=styled("div",{position:"relative",display:"grid",gridTemplateColumns:"100%",rowGap:"$rowGap",transition:"opacity 250ms ease",variants:{toggled:{true:{opacity:1,transitionDelay:"250ms"},false:{opacity:0,transitionDelay:"0ms",pointerEvents:"none"}},isRoot:{true:{"& > div":{paddingLeft:"$md",paddingRight:"$md"},"& > div:first-of-type":{paddingTop:"$sm"},"& > div:last-of-type":{paddingBottom:"$sm"},[`> ${StyledFolder}:not(:first-of-type)`]:{paddingTop:"$sm",marginTop:"$md",borderTop:"$borderWidths$folder solid $colors$elevation1"}}}}}),StyledRow=styled("div",{position:"relative",zIndex:100,display:"grid",rowGap:"$rowGap",gridTemplateRows:"minmax($sizes$rowHeight, max-content)",alignItems:"center",color:"$highlight2",[`${StyledContent} > &`]:{"&:first-of-type":{marginTop:"$rowGap"},"&:last-of-type":{marginBottom:"$rowGap"}},variants:{disabled:{true:{pointerEvents:"none"},false:{"&:hover,&:focus-within":{color:"$highlight3"}}}}}),StyledInputRow=styled(StyledRow,{gridTemplateColumns:"auto $sizes$controlWidth",columnGap:"$colGap"}),CopyLabelContainer=styled("div",{$flex:"",height:"100%",position:"relative",overflow:"hidden","& > div":{marginLeft:"$colGap",padding:"0 $xs",opacity:.4},"& > div:hover":{opacity:.8},"& > div > svg":{display:"none",cursor:"pointer",width:13,minWidth:13,height:13,backgroundColor:"$elevation2"},"&:hover > div > svg":{display:"block"},variants:{align:{top:{height:"100%",alignItems:"flex-start",paddingTop:"$sm"}}}}),StyledOptionalToggle=styled("input",{$reset:"",height:0,width:0,opacity:0,margin:0,"& + label":{position:"relative",$flexCenter:"",height:"100%",userSelect:"none",cursor:"pointer",paddingLeft:2,paddingRight:"$sm",pointerEvents:"auto"},"& + label:after":{content:'""',width:6,height:6,backgroundColor:"$elevation3",borderRadius:"50%",$activeStyle:""},"&:focus + label:after":{$focusStyle:""},"& + label:active:after":{backgroundColor:"$accent1",$focusStyle:""},"&:checked + label:after":{backgroundColor:"$accent1"}}),StyledLabel=styled("label",{fontWeight:"$label",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap","& > svg":{display:"block"}}),StyledInputWrapper$1=styled("div",{opacity:1,variants:{disabled:{true:{opacity:.6,pointerEvents:"none",[`& ${StyledLabel}`]:{pointerEvents:"auto"}}}}}),Overlay=styled("div",{position:"fixed",top:0,bottom:0,right:0,left:0,zIndex:1e3,userSelect:"none"}),StyledToolTipContent=styled("div",{background:"$toolTipBackground",fontFamily:"$sans",fontSize:"$toolTip",padding:"$xs $sm",color:"$toolTipText",borderRadius:"$xs",boxShadow:"$level2",maxWidth:260}),ToolTipArrow=styled($a093c7e1ec25a057$export$21b07c8f274aebd5,{fill:"$toolTipBackground"});function Portal({children:nt}){const{className:_}=reactExports.useContext(ThemeContext);return React.createElement($f1701beae083dbae$export$be92b6f5f03c0fe9,{className:_},nt)}const _excluded$6$1=["align"];function OptionalToggle(){const{id:nt,disable:_,disabled:tt}=useInputContext();return React.createElement(React.Fragment,null,React.createElement(StyledOptionalToggle,{id:nt+"__disable",type:"checkbox",checked:!tt,onChange:()=>_(!tt)}),React.createElement("label",{htmlFor:nt+"__disable"}))}function RawLabel(nt){const{id:_,optional:tt,hint:ot}=useInputContext(),st=nt.htmlFor||(_?{htmlFor:_}:null),at=!ot&&typeof nt.children=="string"?{title:nt.children}:null;return React.createElement(React.Fragment,null,tt&&React.createElement(OptionalToggle,null),ot!==void 0?React.createElement($a093c7e1ec25a057$export$be92b6f5f03c0fe9,null,React.createElement($a093c7e1ec25a057$export$41fb9f06171c75f4,{asChild:!0},React.createElement(StyledLabel,_extends({},st,nt))),React.createElement($a093c7e1ec25a057$export$7c6e2c02157bb7d2,{side:"top",sideOffset:2},React.createElement(StyledToolTipContent,null,ot,React.createElement(ToolTipArrow,null)))):React.createElement(StyledLabel,_extends({},st,at,nt)))}function Label(nt){let{align:_}=nt,tt=_objectWithoutProperties$1(nt,_excluded$6$1);const{value:ot,label:st,key:at,disabled:lt}=useInputContext(),{hideCopyButton:dt}=usePanelSettingsContext(),ht=!dt&&at!==void 0,[ft,gt]=reactExports.useState(!1),Et=async()=>{try{await navigator.clipboard.writeText(JSON.stringify({[at]:ot??""})),gt(!0)}catch{warn(LevaErrors.CLIPBOARD_ERROR,{[at]:ot})}};return React.createElement(CopyLabelContainer,{align:_,onPointerLeave:()=>gt(!1)},React.createElement(RawLabel,tt),ht&&!lt&&React.createElement("div",{title:`Click to copy ${typeof st=="string"?st:at} value`},ft?React.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor"},React.createElement("path",{d:"M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"}),React.createElement("path",{fillRule:"evenodd",d:"M4 5a2 2 0 012-2 3 3 0 003 3h2a3 3 0 003-3 2 2 0 012 2v11a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm9.707 5.707a1 1 0 00-1.414-1.414L9 12.586l-1.293-1.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})):React.createElement("svg",{onClick:Et,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor"},React.createElement("path",{d:"M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z"}),React.createElement("path",{d:"M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z"}))))}const _excluded$5$1=["toggled"],Svg=styled("svg",{fill:"currentColor",transition:"transform 350ms ease, fill 250ms ease"});function Chevron(nt){let{toggled:_}=nt,tt=_objectWithoutProperties$1(nt,_excluded$5$1);return React.createElement(Svg,_extends({width:"9",height:"5",viewBox:"0 0 9 5",xmlns:"http://www.w3.org/2000/svg",style:{transform:`rotate(${_?0:-90}deg)`}},tt),React.createElement("path",{d:"M3.8 4.4c.4.3 1 .3 1.4 0L8 1.7A1 1 0 007.4 0H1.6a1 1 0 00-.7 1.7l3 2.7z"}))}const _excluded$4$1=["input"];function Row(nt){let{input:_}=nt,tt=_objectWithoutProperties$1(nt,_excluded$4$1);return _?React.createElement(StyledInputRow,tt):React.createElement(StyledRow,tt)}function useInputSetters({value:nt,type:_,settings:tt,setValue:ot}){const[st,at]=reactExports.useState(format$2(_,nt,tt)),lt=reactExports.useRef(nt),dt=reactExports.useRef(tt);dt.current=tt;const ht=reactExports.useCallback(gt=>at(format$2(_,gt,dt.current)),[_]),ft=reactExports.useCallback(gt=>{try{ot(gt)}catch(Et){const{type:yt,previousValue:Ct}=Et;if(yt!=="LEVA_ERROR")throw Et;ht(Ct)}},[ht,ot]);return reactExports.useEffect(()=>{dequal(nt,lt.current)||ht(nt),lt.current=nt},[nt,ht]),{displayValue:st,onChange:at,onUpdate:ft}}function useDrag(nt,_){const{emitOnEditStart:tt,emitOnEditEnd:ot}=useInputContext();return useDrag$1(st=>{st.first&&(document.body.classList.add("leva__panel__dragged"),tt==null||tt());const at=nt(st);return st.last&&(document.body.classList.remove("leva__panel__dragged"),ot==null||ot()),at},_)}function useCanvas2d(nt){const _=reactExports.useRef(null),tt=reactExports.useRef(null),ot=reactExports.useRef(!1);return reactExports.useEffect(()=>{const st=debounce(()=>{_.current.width=_.current.offsetWidth*window.devicePixelRatio,_.current.height=_.current.offsetHeight*window.devicePixelRatio,nt(_.current,tt.current)},250);return window.addEventListener("resize",st),ot.current||(st(),ot.current=!0),()=>window.removeEventListener("resize",st)},[nt]),reactExports.useEffect(()=>{tt.current=_.current.getContext("2d")},[]),[_,tt]}function useTransform(){const nt=reactExports.useRef(null),_=reactExports.useRef({x:0,y:0}),tt=reactExports.useCallback(ot=>{Object.assign(_.current,ot),nt.current&&(nt.current.style.transform=`translate3d(${_.current.x}px, ${_.current.y}px, 0)`)},[]);return[nt,tt]}const _excluded$3$1=["__refCount"],getInputAtPath=(nt,_)=>{if(!nt[_])return null;const tt=nt[_];return _objectWithoutProperties$1(tt,_excluded$3$1)};function useInput(nt){const _=useStoreContext(),[tt,ot]=reactExports.useState(getInputAtPath(_.getData(),nt)),st=reactExports.useCallback(ft=>_.setValueAtPath(nt,ft,!0),[nt,_]),at=reactExports.useCallback(ft=>_.setSettingsAtPath(nt,ft),[nt,_]),lt=reactExports.useCallback(ft=>_.disableInputAtPath(nt,ft),[nt,_]),dt=reactExports.useCallback(()=>_.emitOnEditStart(nt),[nt,_]),ht=reactExports.useCallback(()=>_.emitOnEditEnd(nt),[nt,_]);return reactExports.useEffect(()=>{ot(getInputAtPath(_.getData(),nt));const ft=_.useStore.subscribe(gt=>getInputAtPath(gt.data,nt),ot,{equalityFn:shallow});return()=>ft()},[_,nt]),[tt,{set:st,setSettings:at,disable:lt,storeId:_.storeId,emitOnEditStart:dt,emitOnEditEnd:ht}]}const RangeGrid=styled("div",{variants:{hasRange:{true:{position:"relative",display:"grid",gridTemplateColumns:"auto $sizes$numberInputMinWidth",columnGap:"$colGap",alignItems:"center"}}}}),Range=styled("div",{position:"relative",width:"100%",height:2,borderRadius:"$xs",backgroundColor:"$elevation1"}),Scrubber=styled("div",{position:"absolute",width:"$scrubberWidth",height:"$scrubberHeight",borderRadius:"$xs",boxShadow:"0 0 0 2px $colors$elevation2",backgroundColor:"$accent2",cursor:"pointer",$active:"none $accent1",$hover:"none $accent3",variants:{position:{left:{borderTopRightRadius:0,borderBottomRightRadius:0,transform:"translateX(calc(-0.5 * ($sizes$scrubberWidth + 4px)))"},right:{borderTopLeftRadius:0,borderBottomLeftRadius:0,transform:"translateX(calc(0.5 * ($sizes$scrubberWidth + 4px)))"}}}}),RangeWrapper=styled("div",{position:"relative",$flex:"",height:"100%",cursor:"pointer",touchAction:"none"}),Indicator=styled("div",{position:"absolute",height:"100%",backgroundColor:"$accent2"});function RangeSlider({value:nt,min:_,max:tt,onDrag:ot,step:st,initialValue:at}){const lt=reactExports.useRef(null),dt=reactExports.useRef(null),ht=reactExports.useRef(0),ft=useTh("sizes","scrubberWidth"),gt=useDrag(({event:yt,first:Ct,xy:[wt],movement:[It],memo:Pt})=>{if(Ct){const{width:xt,left:Nt}=lt.current.getBoundingClientRect();ht.current=xt-parseFloat(ft),Pt=(yt==null?void 0:yt.target)===dt.current?nt:invertedRange((wt-Nt)/xt,_,tt)}const Rt=Pt+invertedRange(It/ht.current,0,tt-_);return ot(sanitizeStep$1(Rt,{step:st,initialValue:at})),Pt}),Et=range(nt,_,tt);return React.createElement(RangeWrapper,_extends({ref:lt},gt()),React.createElement(Range,null,React.createElement(Indicator,{style:{left:0,right:`${(1-Et)*100}%`}})),React.createElement(Scrubber,{ref:dt,style:{left:`calc(${Et} * (100% - ${ft}))`}}))}const DraggableLabel=React.memo(({label:nt,onUpdate:_,step:tt,innerLabelTrim:ot})=>{const[st,at]=reactExports.useState(!1),lt=useDrag(({active:dt,delta:[ht],event:ft,memo:gt=0})=>(at(dt),gt+=ht/2,Math.abs(gt)>=1&&(_(Et=>parseFloat(Et)+Math.floor(gt)*tt*multiplyStep(ft)),gt=0),gt));return React.createElement(InnerNumberLabel,_extends({dragging:st,title:nt.length>1?nt:""},lt()),nt.slice(0,ot))});function Number$1({label:nt,id:_,displayValue:tt,onUpdate:ot,onChange:st,settings:at,innerLabelTrim:lt=1}){const dt=lt>0&&React.createElement(DraggableLabel,{label:nt,step:at.step,onUpdate:ot,innerLabelTrim:lt});return React.createElement(NumberInput,{id:_,value:String(tt),onUpdate:ot,onChange:st,innerLabel:dt})}function NumberComponent(){const nt=useInputContext(),{label:_,value:tt,onUpdate:ot,settings:st,id:at}=nt,{min:lt,max:dt}=st,ht=dt!==1/0&&lt!==-1/0;return React.createElement(Row,{input:!0},React.createElement(Label,null,_),React.createElement(RangeGrid,{hasRange:ht},ht&&React.createElement(RangeSlider,_extends({value:parseFloat(tt),onDrag:ot},st)),React.createElement(Number$1,_extends({},nt,{id:at,label:"value",innerLabelTrim:ht?0:1}))))}const{sanitizeStep}=props$3,rest=_objectWithoutProperties$1(props$3,["sanitizeStep"]);var number$1=_objectSpread2({component:NumberComponent},rest);const schema$2$1=(nt,_)=>v8n().schema({options:v8n().passesAnyOf(v8n().object(),v8n().array())}).test(_),sanitize$2$1=(nt,{values:_})=>{if(_.indexOf(nt)<0)throw Error("Selected value doesn't match Select options");return nt},format$3=(nt,{values:_})=>_.indexOf(nt),normalize$1$1=nt=>{let{value:_,options:tt}=nt,ot,st;return Array.isArray(tt)?(st=tt,ot=tt.map(at=>String(at))):(st=Object.values(tt),ot=Object.keys(tt)),"value"in nt?st.includes(_)||(ot.unshift(String(_)),st.unshift(_)):_=st[0],Object.values(tt).includes(_)||(tt[String(_)]=_),{value:_,settings:{keys:ot,values:st}}};var props$2$1=Object.freeze({__proto__:null,schema:schema$2$1,sanitize:sanitize$2$1,format:format$3,normalize:normalize$1$1});const SelectContainer=styled("div",{$flexCenter:"",position:"relative","> svg":{pointerEvents:"none",position:"absolute",right:"$md"}}),NativeSelect=styled("select",{position:"absolute",top:0,left:0,width:"100%",height:"100%",opacity:0}),PresentationalSelect=styled("div",{display:"flex",alignItems:"center",width:"100%",height:"$rowHeight",backgroundColor:"$elevation3",borderRadius:"$sm",padding:"0 $sm",cursor:"pointer",[`${NativeSelect}:focus + &`]:{$focusStyle:""},[`${NativeSelect}:hover + &`]:{$hoverStyle:""}});function Select({displayValue:nt,value:_,onUpdate:tt,id:ot,settings:st,disabled:at}){const{keys:lt,values:dt}=st,ht=reactExports.useRef();return _===dt[nt]&&(ht.current=lt[nt]),React.createElement(SelectContainer,null,React.createElement(NativeSelect,{id:ot,value:nt,onChange:ft=>tt(dt[Number(ft.currentTarget.value)]),disabled:at},lt.map((ft,gt)=>React.createElement("option",{key:ft,value:gt},ft))),React.createElement(PresentationalSelect,null,ht.current),React.createElement(Chevron,{toggled:!0}))}function SelectComponent(){const{label:nt,value:_,displayValue:tt,onUpdate:ot,id:st,disabled:at,settings:lt}=useInputContext();return React.createElement(Row,{input:!0},React.createElement(Label,null,nt),React.createElement(Select,{id:st,value:_,displayValue:tt,onUpdate:ot,settings:lt,disabled:at}))}var select=_objectSpread2({component:SelectComponent},props$2$1);const schema$1$1=nt=>v8n().string().test(nt),sanitize$1$1=nt=>{if(typeof nt!="string")throw Error("Invalid string");return nt},normalize$4=({value:nt,editable:_=!0,rows:tt=!1})=>({value:nt,settings:{editable:_,rows:typeof tt=="number"?tt:tt?5:0}});var props$1$1=Object.freeze({__proto__:null,schema:schema$1$1,sanitize:sanitize$1$1,normalize:normalize$4});const _excluded$2$1=["displayValue","onUpdate","onChange","editable"],NonEditableString=styled("div",{whiteSpace:"pre-wrap"});function String$1(nt){let{displayValue:_,onUpdate:tt,onChange:ot,editable:st=!0}=nt,at=_objectWithoutProperties$1(nt,_excluded$2$1);return st?React.createElement(ValueInput,_extends({value:_,onUpdate:tt,onChange:ot},at)):React.createElement(NonEditableString,null,_)}function StringComponent(){const{label:nt,settings:_,displayValue:tt,onUpdate:ot,onChange:st}=useInputContext();return React.createElement(Row,{input:!0},React.createElement(Label,null,nt),React.createElement(String$1,_extends({displayValue:tt,onUpdate:ot,onChange:st},_)))}var string=_objectSpread2({component:StringComponent},props$1$1);const schema$4=nt=>v8n().boolean().test(nt),sanitize$5=nt=>{if(typeof nt!="boolean")throw Error("Invalid boolean");return nt};var props$4=Object.freeze({__proto__:null,schema:schema$4,sanitize:sanitize$5});const StyledInputWrapper=styled("div",{position:"relative",$flex:"",height:"$rowHeight",input:{$reset:"",height:0,width:0,opacity:0,margin:0},label:{position:"relative",$flexCenter:"",userSelect:"none",cursor:"pointer",height:"$checkboxSize",width:"$checkboxSize",backgroundColor:"$elevation3",borderRadius:"$sm",$hover:""},"input:focus + label":{$focusStyle:""},"input:focus:checked + label, input:checked + label:hover":{$hoverStyle:"$accent3"},"input + label:active":{backgroundColor:"$accent1"},"input:checked + label:active":{backgroundColor:"$accent1"},"label > svg":{display:"none",width:"90%",height:"90%",stroke:"$highlight3"},"input:checked + label":{backgroundColor:"$accent2"},"input:checked + label > svg":{display:"block"}});function Boolean$1({value:nt,onUpdate:_,id:tt,disabled:ot}){return React.createElement(StyledInputWrapper,null,React.createElement("input",{id:tt,type:"checkbox",checked:nt,onChange:st=>_(st.currentTarget.checked),disabled:ot}),React.createElement("label",{htmlFor:tt},React.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},React.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"}))))}function BooleanComponent(){const{label:nt,value:_,onUpdate:tt,disabled:ot,id:st}=useInputContext();return React.createElement(Row,{input:!0},React.createElement(Label,null,nt),React.createElement(Boolean$1,{value:_,onUpdate:tt,id:st,disabled:ot}))}var boolean=_objectSpread2({component:BooleanComponent},props$4);const _excluded$1$1=["locked"];function Coordinate({value:nt,id:_,valueKey:tt,settings:ot,onUpdate:st,innerLabelTrim:at}){const lt=reactExports.useRef(nt[tt]);lt.current=nt[tt];const dt=reactExports.useCallback(ft=>st({[tt]:sanitizeValue({type:"NUMBER",value:lt.current,settings:ot},ft)}),[st,ot,tt]),ht=useInputSetters({type:"NUMBER",value:nt[tt],settings:ot,setValue:dt});return React.createElement(Number$1,{id:_,label:tt,value:nt[tt],displayValue:ht.displayValue,onUpdate:ht.onUpdate,onChange:ht.onChange,settings:ot,innerLabelTrim:at})}const Container$2=styled("div",{display:"grid",columnGap:"$colGap",gridAutoFlow:"column dense",alignItems:"center",variants:{withLock:{true:{gridTemplateColumns:"10px auto","> svg":{cursor:"pointer"}}}}});function Lock(nt){let{locked:_}=nt,tt=_objectWithoutProperties$1(nt,_excluded$1$1);return React.createElement("svg",_extends({width:"10",height:"10",viewBox:"0 0 15 15",fill:"none",xmlns:"http://www.w3.org/2000/svg"},tt),_?React.createElement("path",{d:"M5 4.63601C5 3.76031 5.24219 3.1054 5.64323 2.67357C6.03934 2.24705 6.64582 1.9783 7.5014 1.9783C8.35745 1.9783 8.96306 2.24652 9.35823 2.67208C9.75838 3.10299 10 3.75708 10 4.63325V5.99999H5V4.63601ZM4 5.99999V4.63601C4 3.58148 4.29339 2.65754 4.91049 1.99307C5.53252 1.32329 6.42675 0.978302 7.5014 0.978302C8.57583 0.978302 9.46952 1.32233 10.091 1.99162C10.7076 2.65557 11 3.57896 11 4.63325V5.99999H12C12.5523 5.99999 13 6.44771 13 6.99999V13C13 13.5523 12.5523 14 12 14H3C2.44772 14 2 13.5523 2 13V6.99999C2 6.44771 2.44772 5.99999 3 5.99999H4ZM3 6.99999H12V13H3V6.99999Z",fill:"currentColor",fillRule:"evenodd",clipRule:"evenodd"}):React.createElement("path",{d:"M9 3.63601C9 2.76044 9.24207 2.11211 9.64154 1.68623C10.0366 1.26502 10.6432 1 11.5014 1C12.4485 1 13.0839 1.30552 13.4722 1.80636C13.8031 2.23312 14 2.84313 14 3.63325H15C15 2.68242 14.7626 1.83856 14.2625 1.19361C13.6389 0.38943 12.6743 0 11.5014 0C10.4294 0 9.53523 0.337871 8.91218 1.0021C8.29351 1.66167 8 2.58135 8 3.63601V6H1C0.447715 6 0 6.44772 0 7V13C0 13.5523 0.447715 14 1 14H10C10.5523 14 11 13.5523 11 13V7C11 6.44772 10.5523 6 10 6H9V3.63601ZM1 7H10V13H1V7Z",fill:"currentColor",fillRule:"evenodd",clipRule:"evenodd"}))}function Vector({value:nt,onUpdate:_,settings:tt,innerLabelTrim:ot}){const{id:st,setSettings:at}=useInputContext(),{lock:lt,locked:dt}=tt;return React.createElement(Container$2,{withLock:lt},lt&&React.createElement(Lock,{locked:dt,onClick:()=>at({locked:!dt})}),Object.keys(nt).map((ht,ft)=>React.createElement(Coordinate,{id:ft===0?st:`${st}.${ht}`,key:ht,valueKey:ht,value:nt,settings:tt[ht],onUpdate:_,innerLabelTrim:ot})))}const normalizeKeyedNumberSettings=(nt,_)=>{const tt={};let ot=0,st=1/0;Object.entries(nt).forEach(([at,lt])=>{tt[at]=normalize$2$1(_objectSpread2({value:lt},_[at])).settings,ot=Math.max(ot,tt[at].step),st=Math.min(st,tt[at].pad)});for(let at in tt){const{step:lt,min:dt,max:ht}=_[at]||{};!isFinite(lt)&&(!isFinite(dt)||!isFinite(ht))&&(tt[at].step=ot,tt[at].pad=st)}return tt},_excluded$b=["lock"],_excluded2$5=["value"];function getVectorSchema(nt){const _=v8n().array().length(nt).every.number(),tt=ot=>{if(!ot||typeof ot!="object")return!1;const st=Object.values(ot);return st.length===nt&&st.every(at=>isFinite(at))};return ot=>_.test(ot)||tt(ot)}function getVectorType(nt){return Array.isArray(nt)?"array":"object"}function convert$1(nt,_,tt){return getVectorType(nt)===_?nt:_==="array"?Object.values(nt):mapArrayToKeys(nt,tt)}const sanitizeVector=(nt,_,tt)=>{const ot=convert$1(nt,"object",_.keys);for(let lt in ot)ot[lt]=sanitize$3(ot[lt],_[lt]);const st=Object.keys(ot);let at={};if(st.length===_.keys.length)at=ot;else{const lt=convert$1(tt,"object",_.keys);if(st.length===1&&_.locked){const dt=st[0],ht=ot[dt],ft=lt[dt],gt=ft!==0?ht/ft:1;for(let Et in lt)Et===dt?at[dt]=ht:at[Et]=lt[Et]*gt}else at=_objectSpread2(_objectSpread2({},lt),ot)}return convert$1(at,_.format,_.keys)},formatVector=(nt,_)=>convert$1(nt,"object",_.keys),isNumberSettings=nt=>!!nt&&("step"in nt||"min"in nt||"max"in nt);function normalizeVector(nt,_,tt=[]){const{lock:ot=!1}=_,st=_objectWithoutProperties$1(_,_excluded$b),at=Array.isArray(nt)?"array":"object",lt=at==="object"?Object.keys(nt):tt,dt=convert$1(nt,"object",lt),ht=isNumberSettings(st)?lt.reduce((gt,Et)=>Object.assign(gt,{[Et]:st}),{}):st,ft=normalizeKeyedNumberSettings(dt,ht);return{value:at==="array"?nt:dt,settings:_objectSpread2(_objectSpread2({},ft),{},{format:at,keys:lt,lock:ot,locked:!1})}}function getVectorPlugin(nt){return{schema:getVectorSchema(nt.length),normalize:_=>{let{value:tt}=_,ot=_objectWithoutProperties$1(_,_excluded2$5);return normalizeVector(tt,ot,nt)},format:(_,tt)=>formatVector(_,tt),sanitize:(_,tt,ot)=>sanitizeVector(_,tt,ot)}}var r={grad:.9,turn:360,rad:360/(2*Math.PI)},t=function(nt){return typeof nt=="string"?nt.length>0:typeof nt=="number"},n=function(nt,_,tt){return _===void 0&&(_=0),tt===void 0&&(tt=Math.pow(10,_)),Math.round(tt*nt)/tt+0},e=function(nt,_,tt){return _===void 0&&(_=0),tt===void 0&&(tt=1),nt>tt?tt:nt>_?nt:_},u$1=function(nt){return(nt=isFinite(nt)?nt%360:0)>0?nt:nt+360},a=function(nt){return{r:e(nt.r,0,255),g:e(nt.g,0,255),b:e(nt.b,0,255),a:e(nt.a)}},o=function(nt){return{r:n(nt.r),g:n(nt.g),b:n(nt.b),a:n(nt.a,3)}},i$1=/^#([0-9a-f]{3,8})$/i,s$1=function(nt){var _=nt.toString(16);return _.length<2?"0"+_:_},h$1=function(nt){var _=nt.r,tt=nt.g,ot=nt.b,st=nt.a,at=Math.max(_,tt,ot),lt=at-Math.min(_,tt,ot),dt=lt?at===_?(tt-ot)/lt:at===tt?2+(ot-_)/lt:4+(_-tt)/lt:0;return{h:60*(dt<0?dt+6:dt),s:at?lt/at*100:0,v:at/255*100,a:st}},b$1=function(nt){var _=nt.h,tt=nt.s,ot=nt.v,st=nt.a;_=_/360*6,tt/=100,ot/=100;var at=Math.floor(_),lt=ot*(1-tt),dt=ot*(1-(_-at)*tt),ht=ot*(1-(1-_+at)*tt),ft=at%6;return{r:255*[ot,dt,lt,lt,ht,ot][ft],g:255*[ht,ot,ot,dt,lt,lt][ft],b:255*[lt,lt,ht,ot,ot,dt][ft],a:st}},g$1=function(nt){return{h:u$1(nt.h),s:e(nt.s,0,100),l:e(nt.l,0,100),a:e(nt.a)}},d$1=function(nt){return{h:n(nt.h),s:n(nt.s),l:n(nt.l),a:n(nt.a,3)}},f$1=function(nt){return b$1((tt=(_=nt).s,{h:_.h,s:(tt*=((ot=_.l)<50?ot:100-ot)/100)>0?2*tt/(ot+tt)*100:0,v:ot+tt,a:_.a}));var _,tt,ot},c$1=function(nt){return{h:(_=h$1(nt)).h,s:(st=(200-(tt=_.s))*(ot=_.v)/100)>0&&st<200?tt*ot/100/(st<=100?st:200-st)*100:0,l:st/2,a:_.a};var _,tt,ot,st},l=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s*,\s*([+-]?\d*\.?\d+)%\s*,\s*([+-]?\d*\.?\d+)%\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,p$1=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s+([+-]?\d*\.?\d+)%\s+([+-]?\d*\.?\d+)%\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,v$1=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,m$1=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,y$1={string:[[function(nt){var _=i$1.exec(nt);return _?(nt=_[1]).length<=4?{r:parseInt(nt[0]+nt[0],16),g:parseInt(nt[1]+nt[1],16),b:parseInt(nt[2]+nt[2],16),a:nt.length===4?n(parseInt(nt[3]+nt[3],16)/255,2):1}:nt.length===6||nt.length===8?{r:parseInt(nt.substr(0,2),16),g:parseInt(nt.substr(2,2),16),b:parseInt(nt.substr(4,2),16),a:nt.length===8?n(parseInt(nt.substr(6,2),16)/255,2):1}:null:null},"hex"],[function(nt){var _=v$1.exec(nt)||m$1.exec(nt);return _?_[2]!==_[4]||_[4]!==_[6]?null:a({r:Number(_[1])/(_[2]?100/255:1),g:Number(_[3])/(_[4]?100/255:1),b:Number(_[5])/(_[6]?100/255:1),a:_[7]===void 0?1:Number(_[7])/(_[8]?100:1)}):null},"rgb"],[function(nt){var _=l.exec(nt)||p$1.exec(nt);if(!_)return null;var tt,ot,st=g$1({h:(tt=_[1],ot=_[2],ot===void 0&&(ot="deg"),Number(tt)*(r[ot]||1)),s:Number(_[3]),l:Number(_[4]),a:_[5]===void 0?1:Number(_[5])/(_[6]?100:1)});return f$1(st)},"hsl"]],object:[[function(nt){var _=nt.r,tt=nt.g,ot=nt.b,st=nt.a,at=st===void 0?1:st;return t(_)&&t(tt)&&t(ot)?a({r:Number(_),g:Number(tt),b:Number(ot),a:Number(at)}):null},"rgb"],[function(nt){var _=nt.h,tt=nt.s,ot=nt.l,st=nt.a,at=st===void 0?1:st;if(!t(_)||!t(tt)||!t(ot))return null;var lt=g$1({h:Number(_),s:Number(tt),l:Number(ot),a:Number(at)});return f$1(lt)},"hsl"],[function(nt){var _=nt.h,tt=nt.s,ot=nt.v,st=nt.a,at=st===void 0?1:st;if(!t(_)||!t(tt)||!t(ot))return null;var lt=function(dt){return{h:u$1(dt.h),s:e(dt.s,0,100),v:e(dt.v,0,100),a:e(dt.a)}}({h:Number(_),s:Number(tt),v:Number(ot),a:Number(at)});return b$1(lt)},"hsv"]]},N=function(nt,_){for(var tt=0;tt<_.length;tt++){var ot=_[tt][0](nt);if(ot)return[ot,_[tt][1]]}return[null,void 0]},x=function(nt){return typeof nt=="string"?N(nt.trim(),y$1.string):typeof nt=="object"&&nt!==null?N(nt,y$1.object):[null,void 0]},I$1=function(nt){return x(nt)[1]},M=function(nt,_){var tt=c$1(nt);return{h:tt.h,s:e(tt.s+100*_,0,100),l:tt.l,a:tt.a}},H=function(nt){return(299*nt.r+587*nt.g+114*nt.b)/1e3/255},$$1=function(nt,_){var tt=c$1(nt);return{h:tt.h,s:tt.s,l:e(tt.l+100*_,0,100),a:tt.a}},j=function(){function nt(_){this.parsed=x(_)[0],this.rgba=this.parsed||{r:0,g:0,b:0,a:1}}return nt.prototype.isValid=function(){return this.parsed!==null},nt.prototype.brightness=function(){return n(H(this.rgba),2)},nt.prototype.isDark=function(){return H(this.rgba)<.5},nt.prototype.isLight=function(){return H(this.rgba)>=.5},nt.prototype.toHex=function(){return _=o(this.rgba),tt=_.r,ot=_.g,st=_.b,lt=(at=_.a)<1?s$1(n(255*at)):"","#"+s$1(tt)+s$1(ot)+s$1(st)+lt;var _,tt,ot,st,at,lt},nt.prototype.toRgb=function(){return o(this.rgba)},nt.prototype.toRgbString=function(){return _=o(this.rgba),tt=_.r,ot=_.g,st=_.b,(at=_.a)<1?"rgba("+tt+", "+ot+", "+st+", "+at+")":"rgb("+tt+", "+ot+", "+st+")";var _,tt,ot,st,at},nt.prototype.toHsl=function(){return d$1(c$1(this.rgba))},nt.prototype.toHslString=function(){return _=d$1(c$1(this.rgba)),tt=_.h,ot=_.s,st=_.l,(at=_.a)<1?"hsla("+tt+", "+ot+"%, "+st+"%, "+at+")":"hsl("+tt+", "+ot+"%, "+st+"%)";var _,tt,ot,st,at},nt.prototype.toHsv=function(){return _=h$1(this.rgba),{h:n(_.h),s:n(_.s),v:n(_.v),a:n(_.a,3)};var _},nt.prototype.invert=function(){return w({r:255-(_=this.rgba).r,g:255-_.g,b:255-_.b,a:_.a});var _},nt.prototype.saturate=function(_){return _===void 0&&(_=.1),w(M(this.rgba,_))},nt.prototype.desaturate=function(_){return _===void 0&&(_=.1),w(M(this.rgba,-_))},nt.prototype.grayscale=function(){return w(M(this.rgba,-1))},nt.prototype.lighten=function(_){return _===void 0&&(_=.1),w($$1(this.rgba,_))},nt.prototype.darken=function(_){return _===void 0&&(_=.1),w($$1(this.rgba,-_))},nt.prototype.rotate=function(_){return _===void 0&&(_=15),this.hue(this.hue()+_)},nt.prototype.alpha=function(_){return typeof _=="number"?w({r:(tt=this.rgba).r,g:tt.g,b:tt.b,a:_}):n(this.rgba.a,3);var tt},nt.prototype.hue=function(_){var tt=c$1(this.rgba);return typeof _=="number"?w({h:_,s:tt.s,l:tt.l,a:tt.a}):n(tt.h)},nt.prototype.isEqual=function(_){return this.toHex()===w(_).toHex()},nt}(),w=function(nt){return nt instanceof j?nt:new j(nt)},S$1=[],k$1=function(nt){nt.forEach(function(_){S$1.indexOf(_)<0&&(_(j,y$1),S$1.push(_))})};function namesPlugin(nt,_){var tt={white:"#ffffff",bisque:"#ffe4c4",blue:"#0000ff",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",antiquewhite:"#faebd7",aqua:"#00ffff",azure:"#f0ffff",whitesmoke:"#f5f5f5",papayawhip:"#ffefd5",plum:"#dda0dd",blanchedalmond:"#ffebcd",black:"#000000",gold:"#ffd700",goldenrod:"#daa520",gainsboro:"#dcdcdc",cornsilk:"#fff8dc",cornflowerblue:"#6495ed",burlywood:"#deb887",aquamarine:"#7fffd4",beige:"#f5f5dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkkhaki:"#bdb76b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",peachpuff:"#ffdab9",darkmagenta:"#8b008b",darkred:"#8b0000",darkorchid:"#9932cc",darkorange:"#ff8c00",darkslateblue:"#483d8b",gray:"#808080",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",deeppink:"#ff1493",deepskyblue:"#00bfff",wheat:"#f5deb3",firebrick:"#b22222",floralwhite:"#fffaf0",ghostwhite:"#f8f8ff",darkviolet:"#9400d3",magenta:"#ff00ff",green:"#008000",dodgerblue:"#1e90ff",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",blueviolet:"#8a2be2",forestgreen:"#228b22",lawngreen:"#7cfc00",indianred:"#cd5c5c",indigo:"#4b0082",fuchsia:"#ff00ff",brown:"#a52a2a",maroon:"#800000",mediumblue:"#0000cd",lightcoral:"#f08080",darkturquoise:"#00ced1",lightcyan:"#e0ffff",ivory:"#fffff0",lightyellow:"#ffffe0",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",linen:"#faf0e6",mediumaquamarine:"#66cdaa",lemonchiffon:"#fffacd",lime:"#00ff00",khaki:"#f0e68c",mediumseagreen:"#3cb371",limegreen:"#32cd32",mediumspringgreen:"#00fa9a",lightskyblue:"#87cefa",lightblue:"#add8e6",midnightblue:"#191970",lightpink:"#ffb6c1",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",mintcream:"#f5fffa",lightslategray:"#778899",lightslategrey:"#778899",navajowhite:"#ffdead",navy:"#000080",mediumvioletred:"#c71585",powderblue:"#b0e0e6",palegoldenrod:"#eee8aa",oldlace:"#fdf5e6",paleturquoise:"#afeeee",mediumturquoise:"#48d1cc",mediumorchid:"#ba55d3",rebeccapurple:"#663399",lightsteelblue:"#b0c4de",mediumslateblue:"#7b68ee",thistle:"#d8bfd8",tan:"#d2b48c",orchid:"#da70d6",mediumpurple:"#9370db",purple:"#800080",pink:"#ffc0cb",skyblue:"#87ceeb",springgreen:"#00ff7f",palegreen:"#98fb98",red:"#ff0000",yellow:"#ffff00",slateblue:"#6a5acd",lavenderblush:"#fff0f5",peru:"#cd853f",palevioletred:"#db7093",violet:"#ee82ee",teal:"#008080",slategray:"#708090",slategrey:"#708090",aliceblue:"#f0f8ff",darkseagreen:"#8fbc8f",darkolivegreen:"#556b2f",greenyellow:"#adff2f",seagreen:"#2e8b57",seashell:"#fff5ee",tomato:"#ff6347",silver:"#c0c0c0",sienna:"#a0522d",lavender:"#e6e6fa",lightgreen:"#90ee90",orange:"#ffa500",orangered:"#ff4500",steelblue:"#4682b4",royalblue:"#4169e1",turquoise:"#40e0d0",yellowgreen:"#9acd32",salmon:"#fa8072",saddlebrown:"#8b4513",sandybrown:"#f4a460",rosybrown:"#bc8f8f",darksalmon:"#e9967a",lightgoldenrodyellow:"#fafad2",snow:"#fffafa",lightgrey:"#d3d3d3",lightgray:"#d3d3d3",dimgray:"#696969",dimgrey:"#696969",olivedrab:"#6b8e23",olive:"#808000"},ot={};for(var st in tt)ot[tt[st]]=st;var at={};nt.prototype.toName=function(lt){if(!(this.rgba.a||this.rgba.r||this.rgba.g||this.rgba.b))return"transparent";var dt,ht,ft=ot[this.toHex()];if(ft)return ft;if(lt!=null&&lt.closest){var gt=this.toRgb(),Et=1/0,yt="black";if(!at.length)for(var Ct in tt)at[Ct]=new nt(tt[Ct]).toRgb();for(var wt in tt){var It=(dt=gt,ht=at[wt],Math.pow(dt.r-ht.r,2)+Math.pow(dt.g-ht.g,2)+Math.pow(dt.b-ht.b,2));It<Et&&(Et=It,yt=wt)}return yt}},_.string.push([function(lt){var dt=lt.toLowerCase(),ht=dt==="transparent"?"#0000":tt[dt];return ht?new nt(ht).toRgb():null},"name"])}function u(){return(u=Object.assign||function(nt){for(var _=1;_<arguments.length;_++){var tt=arguments[_];for(var ot in tt)Object.prototype.hasOwnProperty.call(tt,ot)&&(nt[ot]=tt[ot])}return nt}).apply(this,arguments)}function c(nt,_){if(nt==null)return{};var tt,ot,st={},at=Object.keys(nt);for(ot=0;ot<at.length;ot++)_.indexOf(tt=at[ot])>=0||(st[tt]=nt[tt]);return st}function i(nt){var _=reactExports.useRef(nt),tt=reactExports.useRef(function(ot){_.current&&_.current(ot)});return _.current=nt,tt.current}var s=function(nt,_,tt){return _===void 0&&(_=0),tt===void 0&&(tt=1),nt>tt?tt:nt<_?_:nt},f=function(nt){return"touches"in nt},v=function(nt){return nt&&nt.ownerDocument.defaultView||self},d=function(nt,_,tt){var ot=nt.getBoundingClientRect(),st=f(_)?function(at,lt){for(var dt=0;dt<at.length;dt++)if(at[dt].identifier===lt)return at[dt];return at[0]}(_.touches,tt):_;return{left:s((st.pageX-(ot.left+v(nt).pageXOffset))/ot.width),top:s((st.pageY-(ot.top+v(nt).pageYOffset))/ot.height)}},h=function(nt){!f(nt)&&nt.preventDefault()},m=React.memo(function(nt){var _=nt.onMove,tt=nt.onKey,ot=c(nt,["onMove","onKey"]),st=reactExports.useRef(null),at=i(_),lt=i(tt),dt=reactExports.useRef(null),ht=reactExports.useRef(!1),ft=reactExports.useMemo(function(){var Ct=function(Pt){h(Pt),(f(Pt)?Pt.touches.length>0:Pt.buttons>0)&&st.current?at(d(st.current,Pt,dt.current)):It(!1)},wt=function(){return It(!1)};function It(Pt){var Rt=ht.current,xt=v(st.current),Nt=Pt?xt.addEventListener:xt.removeEventListener;Nt(Rt?"touchmove":"mousemove",Ct),Nt(Rt?"touchend":"mouseup",wt)}return[function(Pt){var Rt=Pt.nativeEvent,xt=st.current;if(xt&&(h(Rt),!function(kt,Vt){return Vt&&!f(kt)}(Rt,ht.current)&&xt)){if(f(Rt)){ht.current=!0;var Nt=Rt.changedTouches||[];Nt.length&&(dt.current=Nt[0].identifier)}xt.focus(),at(d(xt,Rt,dt.current)),It(!0)}},function(Pt){var Rt=Pt.which||Pt.keyCode;Rt<37||Rt>40||(Pt.preventDefault(),lt({left:Rt===39?.05:Rt===37?-.05:0,top:Rt===40?.05:Rt===38?-.05:0}))},It]},[lt,at]),gt=ft[0],Et=ft[1],yt=ft[2];return reactExports.useEffect(function(){return yt},[yt]),React.createElement("div",u({},ot,{onTouchStart:gt,onMouseDown:gt,className:"react-colorful__interactive",ref:st,onKeyDown:Et,tabIndex:0,role:"slider"}))}),g=function(nt){return nt.filter(Boolean).join(" ")},p=function(nt){var _=nt.color,tt=nt.left,ot=nt.top,st=ot===void 0?.5:ot,at=g(["react-colorful__pointer",nt.className]);return React.createElement("div",{className:at,style:{top:100*st+"%",left:100*tt+"%"}},React.createElement("div",{className:"react-colorful__pointer-fill",style:{backgroundColor:_}}))},b=function(nt,_,tt){return _===void 0&&(_=0),tt===void 0&&(tt=Math.pow(10,_)),Math.round(tt*nt)/tt},y=function(nt){var _=nt.s,tt=nt.v,ot=nt.a,st=(200-_)*tt/100;return{h:b(nt.h),s:b(st>0&&st<200?_*tt/100/(st<=100?st:200-st)*100:0),l:b(st/2),a:b(ot,2)}},q=function(nt){var _=y(nt);return"hsl("+_.h+", "+_.s+"%, "+_.l+"%)"},k=function(nt){var _=y(nt);return"hsla("+_.h+", "+_.s+"%, "+_.l+"%, "+_.a+")"},I=function(nt){var _=nt.h,tt=nt.s,ot=nt.v,st=nt.a;_=_/360*6,tt/=100,ot/=100;var at=Math.floor(_),lt=ot*(1-tt),dt=ot*(1-(_-at)*tt),ht=ot*(1-(1-_+at)*tt),ft=at%6;return{r:b(255*[ot,dt,lt,lt,ht,ot][ft]),g:b(255*[ht,ot,ot,dt,lt,lt][ft]),b:b(255*[lt,lt,ht,ot,ot,dt][ft]),a:b(st,2)}},L=function(nt){var _=nt.r,tt=nt.g,ot=nt.b,st=nt.a,at=Math.max(_,tt,ot),lt=at-Math.min(_,tt,ot),dt=lt?at===_?(tt-ot)/lt:at===tt?2+(ot-_)/lt:4+(_-tt)/lt:0;return{h:b(60*(dt<0?dt+6:dt)),s:b(at?lt/at*100:0),v:b(at/255*100),a:st}},S=React.memo(function(nt){var _=nt.hue,tt=nt.onChange,ot=g(["react-colorful__hue",nt.className]);return React.createElement("div",{className:ot},React.createElement(m,{onMove:function(st){tt({h:360*st.left})},onKey:function(st){tt({h:s(_+360*st.left,0,360)})},"aria-label":"Hue","aria-valuenow":b(_),"aria-valuemax":"360","aria-valuemin":"0"},React.createElement(p,{className:"react-colorful__hue-pointer",left:_/360,color:q({h:_,s:100,v:100,a:1})})))}),T=React.memo(function(nt){var _=nt.hsva,tt=nt.onChange,ot={backgroundColor:q({h:_.h,s:100,v:100,a:1})};return React.createElement("div",{className:"react-colorful__saturation",style:ot},React.createElement(m,{onMove:function(st){tt({s:100*st.left,v:100-100*st.top})},onKey:function(st){tt({s:s(_.s+100*st.left,0,100),v:s(_.v-100*st.top,0,100)})},"aria-label":"Color","aria-valuetext":"Saturation "+b(_.s)+"%, Brightness "+b(_.v)+"%"},React.createElement(p,{className:"react-colorful__saturation-pointer",top:1-_.v/100,left:_.s/100,color:q(_)})))}),F=function(nt,_){if(nt===_)return!0;for(var tt in nt)if(nt[tt]!==_[tt])return!1;return!0};function Y(nt,_,tt){var ot=i(tt),st=reactExports.useState(function(){return nt.toHsva(_)}),at=st[0],lt=st[1],dt=reactExports.useRef({color:_,hsva:at});reactExports.useEffect(function(){if(!nt.equal(_,dt.current.color)){var ft=nt.toHsva(_);dt.current={hsva:ft,color:_},lt(ft)}},[_,nt]),reactExports.useEffect(function(){var ft;F(at,dt.current.hsva)||nt.equal(ft=nt.fromHsva(at),dt.current.color)||(dt.current={hsva:at,color:ft},ot(ft))},[at,nt,ot]);var ht=reactExports.useCallback(function(ft){lt(function(gt){return Object.assign({},gt,ft)})},[]);return[at,ht]}var V=typeof window<"u"?reactExports.useLayoutEffect:reactExports.useEffect,$=function(){return typeof __webpack_nonce__<"u"?__webpack_nonce__:void 0},J=new Map,Q=function(nt){V(function(){var _=nt.current?nt.current.ownerDocument:document;if(_!==void 0&&!J.has(_)){var tt=_.createElement("style");tt.innerHTML=`.react-colorful{position:relative;display:flex;flex-direction:column;width:200px;height:200px;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;cursor:default}.react-colorful__saturation{position:relative;flex-grow:1;border-color:transparent;border-bottom:12px solid #000;border-radius:8px 8px 0 0;background-image:linear-gradient(0deg,#000,transparent),linear-gradient(90deg,#fff,hsla(0,0%,100%,0))}.react-colorful__alpha-gradient,.react-colorful__pointer-fill{content:"";position:absolute;left:0;top:0;right:0;bottom:0;pointer-events:none;border-radius:inherit}.react-colorful__alpha-gradient,.react-colorful__saturation{box-shadow:inset 0 0 0 1px rgba(0,0,0,.05)}.react-colorful__alpha,.react-colorful__hue{position:relative;height:24px}.react-colorful__hue{background:linear-gradient(90deg,red 0,#ff0 17%,#0f0 33%,#0ff 50%,#00f 67%,#f0f 83%,red)}.react-colorful__last-control{border-radius:0 0 8px 8px}.react-colorful__interactive{position:absolute;left:0;top:0;right:0;bottom:0;border-radius:inherit;outline:none;touch-action:none}.react-colorful__pointer{position:absolute;z-index:1;box-sizing:border-box;width:28px;height:28px;transform:translate(-50%,-50%);background-color:#fff;border:2px solid #fff;border-radius:50%;box-shadow:0 2px 4px rgba(0,0,0,.2)}.react-colorful__interactive:focus .react-colorful__pointer{transform:translate(-50%,-50%) scale(1.1)}.react-colorful__alpha,.react-colorful__alpha-pointer{background-color:#fff;background-image:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill-opacity=".05"><path d="M8 0h8v8H8zM0 8h8v8H0z"/></svg>')}.react-colorful__saturation-pointer{z-index:3}.react-colorful__hue-pointer{z-index:2}`,J.set(_,tt);var ot=$();ot&&tt.setAttribute("nonce",ot),_.head.appendChild(tt)}},[])},U=function(nt){var _=nt.className,tt=nt.colorModel,ot=nt.color,st=ot===void 0?tt.defaultColor:ot,at=nt.onChange,lt=c(nt,["className","colorModel","color","onChange"]),dt=reactExports.useRef(null);Q(dt);var ht=Y(tt,st,at),ft=ht[0],gt=ht[1],Et=g(["react-colorful",_]);return React.createElement("div",u({},lt,{ref:dt,className:Et}),React.createElement(T,{hsva:ft,onChange:gt}),React.createElement(S,{hue:ft.h,onChange:gt,className:"react-colorful__last-control"}))},ee=function(nt){var _=nt.className,tt=nt.hsva,ot=nt.onChange,st={backgroundImage:"linear-gradient(90deg, "+k(Object.assign({},tt,{a:0}))+", "+k(Object.assign({},tt,{a:1}))+")"},at=g(["react-colorful__alpha",_]),lt=b(100*tt.a);return React.createElement("div",{className:at},React.createElement("div",{className:"react-colorful__alpha-gradient",style:st}),React.createElement(m,{onMove:function(dt){ot({a:dt.left})},onKey:function(dt){ot({a:s(tt.a+dt.left)})},"aria-label":"Alpha","aria-valuetext":lt+"%","aria-valuenow":lt,"aria-valuemin":"0","aria-valuemax":"100"},React.createElement(p,{className:"react-colorful__alpha-pointer",left:tt.a,color:k(tt)})))},re=function(nt){var _=nt.className,tt=nt.colorModel,ot=nt.color,st=ot===void 0?tt.defaultColor:ot,at=nt.onChange,lt=c(nt,["className","colorModel","color","onChange"]),dt=reactExports.useRef(null);Q(dt);var ht=Y(tt,st,at),ft=ht[0],gt=ht[1],Et=g(["react-colorful",_]);return React.createElement("div",u({},lt,{ref:dt,className:Et}),React.createElement(T,{hsva:ft,onChange:gt}),React.createElement(S,{hue:ft.h,onChange:gt}),React.createElement(ee,{hsva:ft,onChange:gt,className:"react-colorful__last-control"}))},xe={defaultColor:{r:0,g:0,b:0,a:1},toHsva:L,fromHsva:I,equal:F},Ce=function(nt){return React.createElement(re,u({},nt,{colorModel:xe}))},Me={defaultColor:{r:0,g:0,b:0},toHsva:function(nt){return L({r:nt.r,g:nt.g,b:nt.b,a:1})},fromHsva:function(nt){return{r:(_=I(nt)).r,g:_.g,b:_.b};var _},equal:F},Ne=function(nt){return React.createElement(U,u({},nt,{colorModel:Me}))};function __awaiter(nt,_,tt,ot){function st(at){return at instanceof tt?at:new tt(function(lt){lt(at)})}return new(tt||(tt=Promise))(function(at,lt){function dt(gt){try{ft(ot.next(gt))}catch(Et){lt(Et)}}function ht(gt){try{ft(ot.throw(gt))}catch(Et){lt(Et)}}function ft(gt){gt.done?at(gt.value):st(gt.value).then(dt,ht)}ft((ot=ot.apply(nt,_||[])).next())})}function __generator(nt,_){var tt={label:0,sent:function(){if(at[0]&1)throw at[1];return at[1]},trys:[],ops:[]},ot,st,at,lt=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return lt.next=dt(0),lt.throw=dt(1),lt.return=dt(2),typeof Symbol=="function"&&(lt[Symbol.iterator]=function(){return this}),lt;function dt(ft){return function(gt){return ht([ft,gt])}}function ht(ft){if(ot)throw new TypeError("Generator is already executing.");for(;lt&&(lt=0,ft[0]&&(tt=0)),tt;)try{if(ot=1,st&&(at=ft[0]&2?st.return:ft[0]?st.throw||((at=st.return)&&at.call(st),0):st.next)&&!(at=at.call(st,ft[1])).done)return at;switch(st=0,at&&(ft=[ft[0]&2,at.value]),ft[0]){case 0:case 1:at=ft;break;case 4:return tt.label++,{value:ft[1],done:!1};case 5:tt.label++,st=ft[1],ft=[0];continue;case 7:ft=tt.ops.pop(),tt.trys.pop();continue;default:if(at=tt.trys,!(at=at.length>0&&at[at.length-1])&&(ft[0]===6||ft[0]===2)){tt=0;continue}if(ft[0]===3&&(!at||ft[1]>at[0]&&ft[1]<at[3])){tt.label=ft[1];break}if(ft[0]===6&&tt.label<at[1]){tt.label=at[1],at=ft;break}if(at&&tt.label<at[2]){tt.label=at[2],tt.ops.push(ft);break}at[2]&&tt.ops.pop(),tt.trys.pop();continue}ft=_.call(nt,tt)}catch(gt){ft=[6,gt],st=0}finally{ot=at=0}if(ft[0]&5)throw ft[1];return{value:ft[0]?ft[1]:void 0,done:!0}}}function __read(nt,_){var tt=typeof Symbol=="function"&&nt[Symbol.iterator];if(!tt)return nt;var ot=tt.call(nt),st,at=[],lt;try{for(;(_===void 0||_-- >0)&&!(st=ot.next()).done;)at.push(st.value)}catch(dt){lt={error:dt}}finally{try{st&&!st.done&&(tt=ot.return)&&tt.call(ot)}finally{if(lt)throw lt.error}}return at}function __spread(){for(var nt=[],_=0;_<arguments.length;_++)nt=nt.concat(__read(arguments[_]));return nt}typeof SuppressedError=="function"&&SuppressedError;var COMMON_MIME_TYPES=new Map([["aac","audio/aac"],["abw","application/x-abiword"],["arc","application/x-freearc"],["avif","image/avif"],["avi","video/x-msvideo"],["azw","application/vnd.amazon.ebook"],["bin","application/octet-stream"],["bmp","image/bmp"],["bz","application/x-bzip"],["bz2","application/x-bzip2"],["cda","application/x-cdf"],["csh","application/x-csh"],["css","text/css"],["csv","text/csv"],["doc","application/msword"],["docx","application/vnd.openxmlformats-officedocument.wordprocessingml.document"],["eot","application/vnd.ms-fontobject"],["epub","application/epub+zip"],["gz","application/gzip"],["gif","image/gif"],["heic","image/heic"],["heif","image/heif"],["htm","text/html"],["html","text/html"],["ico","image/vnd.microsoft.icon"],["ics","text/calendar"],["jar","application/java-archive"],["jpeg","image/jpeg"],["jpg","image/jpeg"],["js","text/javascript"],["json","application/json"],["jsonld","application/ld+json"],["mid","audio/midi"],["midi","audio/midi"],["mjs","text/javascript"],["mp3","audio/mpeg"],["mp4","video/mp4"],["mpeg","video/mpeg"],["mpkg","application/vnd.apple.installer+xml"],["odp","application/vnd.oasis.opendocument.presentation"],["ods","application/vnd.oasis.opendocument.spreadsheet"],["odt","application/vnd.oasis.opendocument.text"],["oga","audio/ogg"],["ogv","video/ogg"],["ogx","application/ogg"],["opus","audio/opus"],["otf","font/otf"],["png","image/png"],["pdf","application/pdf"],["php","application/x-httpd-php"],["ppt","application/vnd.ms-powerpoint"],["pptx","application/vnd.openxmlformats-officedocument.presentationml.presentation"],["rar","application/vnd.rar"],["rtf","application/rtf"],["sh","application/x-sh"],["svg","image/svg+xml"],["swf","application/x-shockwave-flash"],["tar","application/x-tar"],["tif","image/tiff"],["tiff","image/tiff"],["ts","video/mp2t"],["ttf","font/ttf"],["txt","text/plain"],["vsd","application/vnd.visio"],["wav","audio/wav"],["weba","audio/webm"],["webm","video/webm"],["webp","image/webp"],["woff","font/woff"],["woff2","font/woff2"],["xhtml","application/xhtml+xml"],["xls","application/vnd.ms-excel"],["xlsx","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"],["xml","application/xml"],["xul","application/vnd.mozilla.xul+xml"],["zip","application/zip"],["7z","application/x-7z-compressed"],["mkv","video/x-matroska"],["mov","video/quicktime"],["msg","application/vnd.ms-outlook"]]);function toFileWithPath(nt,_){var tt=withMimeType(nt);if(typeof tt.path!="string"){var ot=nt.webkitRelativePath;Object.defineProperty(tt,"path",{value:typeof _=="string"?_:typeof ot=="string"&&ot.length>0?ot:nt.name,writable:!1,configurable:!1,enumerable:!0})}return tt}function withMimeType(nt){var _=nt.name,tt=_&&_.lastIndexOf(".")!==-1;if(tt&&!nt.type){var ot=_.split(".").pop().toLowerCase(),st=COMMON_MIME_TYPES.get(ot);st&&Object.defineProperty(nt,"type",{value:st,writable:!1,configurable:!1,enumerable:!0})}return nt}var FILES_TO_IGNORE=[".DS_Store","Thumbs.db"];function fromEvent(nt){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_){return isObject$7(nt)&&isDataTransfer(nt)?[2,getDataTransferFiles(nt.dataTransfer,nt.type)]:isChangeEvt(nt)?[2,getInputFiles(nt)]:Array.isArray(nt)&&nt.every(function(tt){return"getFile"in tt&&typeof tt.getFile=="function"})?[2,getFsHandleFiles(nt)]:[2,[]]})})}function isDataTransfer(nt){return isObject$7(nt.dataTransfer)}function isChangeEvt(nt){return isObject$7(nt)&&isObject$7(nt.target)}function isObject$7(nt){return typeof nt=="object"&&nt!==null}function getInputFiles(nt){return fromList(nt.target.files).map(function(_){return toFileWithPath(_)})}function getFsHandleFiles(nt){return __awaiter(this,void 0,void 0,function(){var _;return __generator(this,function(tt){switch(tt.label){case 0:return[4,Promise.all(nt.map(function(ot){return ot.getFile()}))];case 1:return _=tt.sent(),[2,_.map(function(ot){return toFileWithPath(ot)})]}})})}function getDataTransferFiles(nt,_){return __awaiter(this,void 0,void 0,function(){var tt,ot;return __generator(this,function(st){switch(st.label){case 0:return nt===null?[2,[]]:nt.items?(tt=fromList(nt.items).filter(function(at){return at.kind==="file"}),_!=="drop"?[2,tt]:[4,Promise.all(tt.map(toFilePromises))]):[3,2];case 1:return ot=st.sent(),[2,noIgnoredFiles(flatten(ot))];case 2:return[2,noIgnoredFiles(fromList(nt.files).map(function(at){return toFileWithPath(at)}))]}})})}function noIgnoredFiles(nt){return nt.filter(function(_){return FILES_TO_IGNORE.indexOf(_.name)===-1})}function fromList(nt){if(nt===null)return[];for(var _=[],tt=0;tt<nt.length;tt++){var ot=nt[tt];_.push(ot)}return _}function toFilePromises(nt){if(typeof nt.webkitGetAsEntry!="function")return fromDataTransferItem(nt);var _=nt.webkitGetAsEntry();return _&&_.isDirectory?fromDirEntry(_):fromDataTransferItem(nt)}function flatten(nt){return nt.reduce(function(_,tt){return __spread(_,Array.isArray(tt)?flatten(tt):[tt])},[])}function fromDataTransferItem(nt){var _=nt.getAsFile();if(!_)return Promise.reject(nt+" is not a File");var tt=toFileWithPath(_);return Promise.resolve(tt)}function fromEntry(nt){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_){return[2,nt.isDirectory?fromDirEntry(nt):fromFileEntry(nt)]})})}function fromDirEntry(nt){var _=nt.createReader();return new Promise(function(tt,ot){var st=[];function at(){var lt=this;_.readEntries(function(dt){return __awaiter(lt,void 0,void 0,function(){var ht,ft,gt;return __generator(this,function(Et){switch(Et.label){case 0:if(dt.length)return[3,5];Et.label=1;case 1:return Et.trys.push([1,3,,4]),[4,Promise.all(st)];case 2:return ht=Et.sent(),tt(ht),[3,4];case 3:return ft=Et.sent(),ot(ft),[3,4];case 4:return[3,6];case 5:gt=Promise.all(dt.map(fromEntry)),st.push(gt),at(),Et.label=6;case 6:return[2]}})})},function(dt){ot(dt)})}at()})}function fromFileEntry(nt){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_){return[2,new Promise(function(tt,ot){nt.file(function(st){var at=toFileWithPath(st,nt.fullPath);tt(at)},function(st){ot(st)})})]})})}var _default=function(nt,_){if(nt&&_){var tt=Array.isArray(_)?_:_.split(",");if(tt.length===0)return!0;var ot=nt.name||"",st=(nt.type||"").toLowerCase(),at=st.replace(/\/.*$/,"");return tt.some(function(lt){var dt=lt.trim().toLowerCase();return dt.charAt(0)==="."?ot.toLowerCase().endsWith(dt):dt.endsWith("/*")?at===dt.replace(/\/.*$/,""):st===dt})}return!0};function ownKeys$1(nt,_){var tt=Object.keys(nt);if(Object.getOwnPropertySymbols){var ot=Object.getOwnPropertySymbols(nt);_&&(ot=ot.filter(function(st){return Object.getOwnPropertyDescriptor(nt,st).enumerable})),tt.push.apply(tt,ot)}return tt}function _objectSpread$1(nt){for(var _=1;_<arguments.length;_++){var tt=arguments[_]!=null?arguments[_]:{};_%2?ownKeys$1(Object(tt),!0).forEach(function(ot){_defineProperty$1(nt,ot,tt[ot])}):Object.getOwnPropertyDescriptors?Object.defineProperties(nt,Object.getOwnPropertyDescriptors(tt)):ownKeys$1(Object(tt)).forEach(function(ot){Object.defineProperty(nt,ot,Object.getOwnPropertyDescriptor(tt,ot))})}return nt}function _defineProperty$1(nt,_,tt){return _ in nt?Object.defineProperty(nt,_,{value:tt,enumerable:!0,configurable:!0,writable:!0}):nt[_]=tt,nt}function _slicedToArray$1(nt,_){return _arrayWithHoles$1(nt)||_iterableToArrayLimit$1(nt,_)||_unsupportedIterableToArray$1(nt,_)||_nonIterableRest$1()}function _nonIterableRest$1(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function _unsupportedIterableToArray$1(nt,_){if(nt){if(typeof nt=="string")return _arrayLikeToArray$1(nt,_);var tt=Object.prototype.toString.call(nt).slice(8,-1);if(tt==="Object"&&nt.constructor&&(tt=nt.constructor.name),tt==="Map"||tt==="Set")return Array.from(nt);if(tt==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(tt))return _arrayLikeToArray$1(nt,_)}}function _arrayLikeToArray$1(nt,_){(_==null||_>nt.length)&&(_=nt.length);for(var tt=0,ot=new Array(_);tt<_;tt++)ot[tt]=nt[tt];return ot}function _iterableToArrayLimit$1(nt,_){var tt=nt==null?null:typeof Symbol<"u"&&nt[Symbol.iterator]||nt["@@iterator"];if(tt!=null){var ot=[],st=!0,at=!1,lt,dt;try{for(tt=tt.call(nt);!(st=(lt=tt.next()).done)&&(ot.push(lt.value),!(_&&ot.length===_));st=!0);}catch(ht){at=!0,dt=ht}finally{try{!st&&tt.return!=null&&tt.return()}finally{if(at)throw dt}}return ot}}function _arrayWithHoles$1(nt){if(Array.isArray(nt))return nt}var FILE_INVALID_TYPE="file-invalid-type",FILE_TOO_LARGE="file-too-large",FILE_TOO_SMALL="file-too-small",TOO_MANY_FILES="too-many-files",getInvalidTypeRejectionErr=function(_){_=Array.isArray(_)&&_.length===1?_[0]:_;var tt=Array.isArray(_)?"one of ".concat(_.join(", ")):_;return{code:FILE_INVALID_TYPE,message:"File type must be ".concat(tt)}},getTooLargeRejectionErr=function(_){return{code:FILE_TOO_LARGE,message:"File is larger than ".concat(_," ").concat(_===1?"byte":"bytes")}},getTooSmallRejectionErr=function(_){return{code:FILE_TOO_SMALL,message:"File is smaller than ".concat(_," ").concat(_===1?"byte":"bytes")}},TOO_MANY_FILES_REJECTION={code:TOO_MANY_FILES,message:"Too many files"};function fileAccepted(nt,_){var tt=nt.type==="application/x-moz-file"||_default(nt,_);return[tt,tt?null:getInvalidTypeRejectionErr(_)]}function fileMatchSize(nt,_,tt){if(isDefined(nt.size))if(isDefined(_)&&isDefined(tt)){if(nt.size>tt)return[!1,getTooLargeRejectionErr(tt)];if(nt.size<_)return[!1,getTooSmallRejectionErr(_)]}else{if(isDefined(_)&&nt.size<_)return[!1,getTooSmallRejectionErr(_)];if(isDefined(tt)&&nt.size>tt)return[!1,getTooLargeRejectionErr(tt)]}return[!0,null]}function isDefined(nt){return nt!=null}function allFilesAccepted(nt){var _=nt.files,tt=nt.accept,ot=nt.minSize,st=nt.maxSize,at=nt.multiple,lt=nt.maxFiles;return!at&&_.length>1||at&&lt>=1&&_.length>lt?!1:_.every(function(dt){var ht=fileAccepted(dt,tt),ft=_slicedToArray$1(ht,1),gt=ft[0],Et=fileMatchSize(dt,ot,st),yt=_slicedToArray$1(Et,1),Ct=yt[0];return gt&&Ct})}function isPropagationStopped(nt){return typeof nt.isPropagationStopped=="function"?nt.isPropagationStopped():typeof nt.cancelBubble<"u"?nt.cancelBubble:!1}function isEvtWithFiles(nt){return nt.dataTransfer?Array.prototype.some.call(nt.dataTransfer.types,function(_){return _==="Files"||_==="application/x-moz-file"}):!!nt.target&&!!nt.target.files}function onDocumentDragOver(nt){nt.preventDefault()}function isIe(nt){return nt.indexOf("MSIE")!==-1||nt.indexOf("Trident/")!==-1}function isEdge(nt){return nt.indexOf("Edge/")!==-1}function isIeOrEdge(){var nt=arguments.length>0&&arguments[0]!==void 0?arguments[0]:window.navigator.userAgent;return isIe(nt)||isEdge(nt)}function composeEventHandlers(){for(var nt=arguments.length,_=new Array(nt),tt=0;tt<nt;tt++)_[tt]=arguments[tt];return function(ot){for(var st=arguments.length,at=new Array(st>1?st-1:0),lt=1;lt<st;lt++)at[lt-1]=arguments[lt];return _.some(function(dt){return!isPropagationStopped(ot)&&dt&&dt.apply(void 0,[ot].concat(at)),isPropagationStopped(ot)})}}function canUseFileSystemAccessAPI(){return"showOpenFilePicker"in window}function filePickerOptionsTypes(nt){return nt=typeof nt=="string"?nt.split(","):nt,[{description:"everything",accept:Array.isArray(nt)?nt.filter(function(_){return _==="audio/*"||_==="video/*"||_==="image/*"||_==="text/*"||/\w+\/[-+.\w]+/g.test(_)}).reduce(function(_,tt){return _objectSpread$1(_objectSpread$1({},_),{},_defineProperty$1({},tt,[]))},{}):{}}]}function isAbort(nt){return nt instanceof DOMException&&(nt.name==="AbortError"||nt.code===nt.ABORT_ERR)}function isSecurityError(nt){return nt instanceof DOMException&&(nt.name==="SecurityError"||nt.code===nt.SECURITY_ERR)}var _excluded=["children"],_excluded2$2=["open"],_excluded3=["refKey","role","onKeyDown","onFocus","onBlur","onClick","onDragEnter","onDragOver","onDragLeave","onDrop"],_excluded4=["refKey","onChange","onClick"];function _toConsumableArray(nt){return _arrayWithoutHoles(nt)||_iterableToArray(nt)||_unsupportedIterableToArray(nt)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function _iterableToArray(nt){if(typeof Symbol<"u"&&nt[Symbol.iterator]!=null||nt["@@iterator"]!=null)return Array.from(nt)}function _arrayWithoutHoles(nt){if(Array.isArray(nt))return _arrayLikeToArray(nt)}function _slicedToArray(nt,_){return _arrayWithHoles(nt)||_iterableToArrayLimit(nt,_)||_unsupportedIterableToArray(nt,_)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function _unsupportedIterableToArray(nt,_){if(nt){if(typeof nt=="string")return _arrayLikeToArray(nt,_);var tt=Object.prototype.toString.call(nt).slice(8,-1);if(tt==="Object"&&nt.constructor&&(tt=nt.constructor.name),tt==="Map"||tt==="Set")return Array.from(nt);if(tt==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(tt))return _arrayLikeToArray(nt,_)}}function _arrayLikeToArray(nt,_){(_==null||_>nt.length)&&(_=nt.length);for(var tt=0,ot=new Array(_);tt<_;tt++)ot[tt]=nt[tt];return ot}function _iterableToArrayLimit(nt,_){var tt=nt==null?null:typeof Symbol<"u"&&nt[Symbol.iterator]||nt["@@iterator"];if(tt!=null){var ot=[],st=!0,at=!1,lt,dt;try{for(tt=tt.call(nt);!(st=(lt=tt.next()).done)&&(ot.push(lt.value),!(_&&ot.length===_));st=!0);}catch(ht){at=!0,dt=ht}finally{try{!st&&tt.return!=null&&tt.return()}finally{if(at)throw dt}}return ot}}function _arrayWithHoles(nt){if(Array.isArray(nt))return nt}function ownKeys(nt,_){var tt=Object.keys(nt);if(Object.getOwnPropertySymbols){var ot=Object.getOwnPropertySymbols(nt);_&&(ot=ot.filter(function(st){return Object.getOwnPropertyDescriptor(nt,st).enumerable})),tt.push.apply(tt,ot)}return tt}function _objectSpread(nt){for(var _=1;_<arguments.length;_++){var tt=arguments[_]!=null?arguments[_]:{};_%2?ownKeys(Object(tt),!0).forEach(function(ot){_defineProperty(nt,ot,tt[ot])}):Object.getOwnPropertyDescriptors?Object.defineProperties(nt,Object.getOwnPropertyDescriptors(tt)):ownKeys(Object(tt)).forEach(function(ot){Object.defineProperty(nt,ot,Object.getOwnPropertyDescriptor(tt,ot))})}return nt}function _defineProperty(nt,_,tt){return _ in nt?Object.defineProperty(nt,_,{value:tt,enumerable:!0,configurable:!0,writable:!0}):nt[_]=tt,nt}function _objectWithoutProperties(nt,_){if(nt==null)return{};var tt=_objectWithoutPropertiesLoose(nt,_),ot,st;if(Object.getOwnPropertySymbols){var at=Object.getOwnPropertySymbols(nt);for(st=0;st<at.length;st++)ot=at[st],!(_.indexOf(ot)>=0)&&Object.prototype.propertyIsEnumerable.call(nt,ot)&&(tt[ot]=nt[ot])}return tt}function _objectWithoutPropertiesLoose(nt,_){if(nt==null)return{};var tt={},ot=Object.keys(nt),st,at;for(at=0;at<ot.length;at++)st=ot[at],!(_.indexOf(st)>=0)&&(tt[st]=nt[st]);return tt}var Dropzone=reactExports.forwardRef(function(nt,_){var tt=nt.children,ot=_objectWithoutProperties(nt,_excluded),st=useDropzone(ot),at=st.open,lt=_objectWithoutProperties(st,_excluded2$2);return reactExports.useImperativeHandle(_,function(){return{open:at}},[at]),React.createElement(reactExports.Fragment,null,tt(_objectSpread(_objectSpread({},lt),{},{open:at})))});Dropzone.displayName="Dropzone";var defaultProps={disabled:!1,getFilesFromEvent:fromEvent,maxSize:1/0,minSize:0,multiple:!0,maxFiles:0,preventDropOnDocument:!0,noClick:!1,noKeyboard:!1,noDrag:!1,noDragEventsBubbling:!1,validator:null,useFsAccessApi:!0};Dropzone.defaultProps=defaultProps;Dropzone.propTypes={children:PropTypes.func,accept:PropTypes.oneOfType([PropTypes.string,PropTypes.arrayOf(PropTypes.string)]),multiple:PropTypes.bool,preventDropOnDocument:PropTypes.bool,noClick:PropTypes.bool,noKeyboard:PropTypes.bool,noDrag:PropTypes.bool,noDragEventsBubbling:PropTypes.bool,minSize:PropTypes.number,maxSize:PropTypes.number,maxFiles:PropTypes.number,disabled:PropTypes.bool,getFilesFromEvent:PropTypes.func,onFileDialogCancel:PropTypes.func,onFileDialogOpen:PropTypes.func,useFsAccessApi:PropTypes.bool,onDragEnter:PropTypes.func,onDragLeave:PropTypes.func,onDragOver:PropTypes.func,onDrop:PropTypes.func,onDropAccepted:PropTypes.func,onDropRejected:PropTypes.func,validator:PropTypes.func};var initialState={isFocused:!1,isFileDialogActive:!1,isDragActive:!1,isDragAccept:!1,isDragReject:!1,draggedFiles:[],acceptedFiles:[],fileRejections:[]};function useDropzone(){var nt=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},_=_objectSpread(_objectSpread({},defaultProps),nt),tt=_.accept,ot=_.disabled,st=_.getFilesFromEvent,at=_.maxSize,lt=_.minSize,dt=_.multiple,ht=_.maxFiles,ft=_.onDragEnter,gt=_.onDragLeave,Et=_.onDragOver,yt=_.onDrop,Ct=_.onDropAccepted,wt=_.onDropRejected,It=_.onFileDialogCancel,Pt=_.onFileDialogOpen,Rt=_.useFsAccessApi,xt=_.preventDropOnDocument,Nt=_.noClick,kt=_.noKeyboard,Vt=_.noDrag,Ft=_.noDragEventsBubbling,zt=_.validator,Yt=reactExports.useMemo(function(){return typeof Pt=="function"?Pt:noop$1},[Pt]),Kt=reactExports.useMemo(function(){return typeof It=="function"?It:noop$1},[It]),qt=reactExports.useRef(null),pn=reactExports.useRef(null),an=reactExports.useReducer(reducer,initialState),fn=_slicedToArray(an,2),dn=fn[0],Cn=fn[1],On=dn.isFocused,Pn=dn.isFileDialogActive,yn=dn.draggedFiles,An=reactExports.useRef(typeof window<"u"&&window.isSecureContext&&Rt&&canUseFileSystemAccessAPI()),Sn=function(){!An.current&&Pn&&setTimeout(function(){if(pn.current){var sn=pn.current.files;sn.length||(Cn({type:"closeDialog"}),Kt())}},300)};reactExports.useEffect(function(){return window.addEventListener("focus",Sn,!1),function(){window.removeEventListener("focus",Sn,!1)}},[pn,Pn,Kt,An]);var gn=reactExports.useRef([]),_n=function(sn){qt.current&&qt.current.contains(sn.target)||(sn.preventDefault(),gn.current=[])};reactExports.useEffect(function(){return xt&&(document.addEventListener("dragover",onDocumentDragOver,!1),document.addEventListener("drop",_n,!1)),function(){xt&&(document.removeEventListener("dragover",onDocumentDragOver),document.removeEventListener("drop",_n))}},[qt,xt]);var Rn=reactExports.useCallback(function(un){un.preventDefault(),un.persist(),Bn(un),gn.current=[].concat(_toConsumableArray(gn.current),[un.target]),isEvtWithFiles(un)&&Promise.resolve(st(un)).then(function(sn){isPropagationStopped(un)&&!Ft||(Cn({draggedFiles:sn,isDragActive:!0,type:"setDraggedFiles"}),ft&&ft(un))})},[st,ft,Ft]),bn=reactExports.useCallback(function(un){un.preventDefault(),un.persist(),Bn(un);var sn=isEvtWithFiles(un);if(sn&&un.dataTransfer)try{un.dataTransfer.dropEffect="copy"}catch{}return sn&&Et&&Et(un),!1},[Et,Ft]),jn=reactExports.useCallback(function(un){un.preventDefault(),un.persist(),Bn(un);var sn=gn.current.filter(function(Sr){return qt.current&&qt.current.contains(Sr)}),Kn=sn.indexOf(un.target);Kn!==-1&&sn.splice(Kn,1),gn.current=sn,!(sn.length>0)&&(Cn({isDragActive:!1,type:"setDraggedFiles",draggedFiles:[]}),isEvtWithFiles(un)&&gt&&gt(un))},[qt,gt,Ft]),kn=reactExports.useCallback(function(un,sn){var Kn=[],Sr=[];un.forEach(function(lr){var vr=fileAccepted(lr,tt),Fr=_slicedToArray(vr,2),Gr=Fr[0],dr=Fr[1],Hr=fileMatchSize(lr,lt,at),zr=_slicedToArray(Hr,2),Nr=zr[0],Or=zr[1],Ur=zt?zt(lr):null;if(Gr&&Nr&&!Ur)Kn.push(lr);else{var Zr=[dr,Or];Ur&&(Zr=Zr.concat(Ur)),Sr.push({file:lr,errors:Zr.filter(function(oo){return oo})})}}),(!dt&&Kn.length>1||dt&&ht>=1&&Kn.length>ht)&&(Kn.forEach(function(lr){Sr.push({file:lr,errors:[TOO_MANY_FILES_REJECTION]})}),Kn.splice(0)),Cn({acceptedFiles:Kn,fileRejections:Sr,type:"setFiles"}),yt&&yt(Kn,Sr,sn),Sr.length>0&&wt&&wt(Sr,sn),Kn.length>0&&Ct&&Ct(Kn,sn)},[Cn,dt,tt,lt,at,ht,yt,Ct,wt,zt]),Gn=reactExports.useCallback(function(un){un.preventDefault(),un.persist(),Bn(un),gn.current=[],isEvtWithFiles(un)&&Promise.resolve(st(un)).then(function(sn){isPropagationStopped(un)&&!Ft||kn(sn,un)}),Cn({type:"reset"})},[st,kn,Ft]),Vn=reactExports.useCallback(function(){if(An.current){Cn({type:"openDialog"}),Yt();var un={multiple:dt,types:filePickerOptionsTypes(tt)};window.showOpenFilePicker(un).then(function(sn){return st(sn)}).then(function(sn){kn(sn,null),Cn({type:"closeDialog"})}).catch(function(sn){isAbort(sn)?(Kt(sn),Cn({type:"closeDialog"})):isSecurityError(sn)&&(An.current=!1,pn.current&&(pn.current.value=null,pn.current.click()))});return}pn.current&&(Cn({type:"openDialog"}),Yt(),pn.current.value=null,pn.current.click())},[Cn,Yt,Kt,Rt,kn,tt,dt]),qn=reactExports.useCallback(function(un){!qt.current||!qt.current.isEqualNode(un.target)||(un.key===" "||un.key==="Enter"||un.keyCode===32||un.keyCode===13)&&(un.preventDefault(),Vn())},[qt,Vn]),Tr=reactExports.useCallback(function(){Cn({type:"focus"})},[]),Mn=reactExports.useCallback(function(){Cn({type:"blur"})},[]),Zt=reactExports.useCallback(function(){Nt||(isIeOrEdge()?setTimeout(Vn,0):Vn())},[Nt,Vn]),wn=function(sn){return ot?null:sn},xn=function(sn){return kt?null:wn(sn)},Hn=function(sn){return Vt?null:wn(sn)},Bn=function(sn){Ft&&sn.stopPropagation()},cr=reactExports.useMemo(function(){return function(){var un=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},sn=un.refKey,Kn=sn===void 0?"ref":sn,Sr=un.role,lr=un.onKeyDown,vr=un.onFocus,Fr=un.onBlur,Gr=un.onClick,dr=un.onDragEnter,Hr=un.onDragOver,zr=un.onDragLeave,Nr=un.onDrop,Or=_objectWithoutProperties(un,_excluded3);return _objectSpread(_objectSpread(_defineProperty({onKeyDown:xn(composeEventHandlers(lr,qn)),onFocus:xn(composeEventHandlers(vr,Tr)),onBlur:xn(composeEventHandlers(Fr,Mn)),onClick:wn(composeEventHandlers(Gr,Zt)),onDragEnter:Hn(composeEventHandlers(dr,Rn)),onDragOver:Hn(composeEventHandlers(Hr,bn)),onDragLeave:Hn(composeEventHandlers(zr,jn)),onDrop:Hn(composeEventHandlers(Nr,Gn)),role:typeof Sr=="string"&&Sr!==""?Sr:"button"},Kn,qt),!ot&&!kt?{tabIndex:0}:{}),Or)}},[qt,qn,Tr,Mn,Zt,Rn,bn,jn,Gn,kt,Vt,ot]),Wn=reactExports.useCallback(function(un){un.stopPropagation()},[]),rr=reactExports.useMemo(function(){return function(){var un=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},sn=un.refKey,Kn=sn===void 0?"ref":sn,Sr=un.onChange,lr=un.onClick,vr=_objectWithoutProperties(un,_excluded4),Fr=_defineProperty({accept:tt,multiple:dt,type:"file",style:{display:"none"},onChange:wn(composeEventHandlers(Sr,Gn)),onClick:wn(composeEventHandlers(lr,Wn)),tabIndex:-1},Kn,pn);return _objectSpread(_objectSpread({},Fr),vr)}},[pn,tt,dt,Gn,ot]),sr=yn.length,ir=sr>0&&allFilesAccepted({files:yn,accept:tt,minSize:lt,maxSize:at,multiple:dt,maxFiles:ht}),kr=sr>0&&!ir;return _objectSpread(_objectSpread({},dn),{},{isDragAccept:ir,isDragReject:kr,isFocused:On&&!ot,getRootProps:cr,getInputProps:rr,rootRef:qt,inputRef:pn,open:wn(Vn)})}function reducer(nt,_){switch(_.type){case"focus":return _objectSpread(_objectSpread({},nt),{},{isFocused:!0});case"blur":return _objectSpread(_objectSpread({},nt),{},{isFocused:!1});case"openDialog":return _objectSpread(_objectSpread({},initialState),{},{isFileDialogActive:!0});case"closeDialog":return _objectSpread(_objectSpread({},nt),{},{isFileDialogActive:!1});case"setDraggedFiles":var tt=_.isDragActive,ot=_.draggedFiles;return _objectSpread(_objectSpread({},nt),{},{draggedFiles:ot,isDragActive:tt});case"setFiles":return _objectSpread(_objectSpread({},nt),{},{acceptedFiles:_.acceptedFiles,fileRejections:_.fileRejections});case"reset":return _objectSpread({},initialState);default:return nt}}function noop$1(){}/*!
 * isobject <https://github.com/jonschlinkert/isobject>
 *
 * Copyright (c) 2014-2017, Jon Schlinkert.
 * Released under the MIT License.
 */var isobject=function(_){return _!=null&&typeof _=="object"&&Array.isArray(_)===!1};/*!
 * is-plain-object <https://github.com/jonschlinkert/is-plain-object>
 *
 * Copyright (c) 2014-2017, Jon Schlinkert.
 * Released under the MIT License.
 */var isObject$6=isobject;function isObjectObject(nt){return isObject$6(nt)===!0&&Object.prototype.toString.call(nt)==="[object Object]"}var isPlainObject$2=function(_){var tt,ot;return!(isObjectObject(_)===!1||(tt=_.constructor,typeof tt!="function")||(ot=tt.prototype,isObjectObject(ot)===!1)||ot.hasOwnProperty("isPrototypeOf")===!1)};/*!
 * is-extendable <https://github.com/jonschlinkert/is-extendable>
 *
 * Copyright (c) 2015-2017, Jon Schlinkert.
 * Released under the MIT License.
 */var isPlainObject$1=isPlainObject$2,isExtendable$4=function(_){return isPlainObject$1(_)||typeof _=="function"||Array.isArray(_)};/*!
 * for-in <https://github.com/jonschlinkert/for-in>
 *
 * Copyright (c) 2014-2017, Jon Schlinkert.
 * Released under the MIT License.
 */var forIn$1=function(_,tt,ot){for(var st in _)if(tt.call(ot,_[st],st,_)===!1)break},isExtendable$3=isExtendable$4,forIn=forIn$1;function mixinDeep(nt,_){for(var tt=arguments.length,ot=0;++ot<tt;){var st=arguments[ot];isObject$5(st)&&forIn(st,copy,nt)}return nt}function copy(nt,_){if(isValidKey$1(_)){var tt=this[_];isObject$5(nt)&&isObject$5(tt)?mixinDeep(tt,nt):this[_]=nt}}function isObject$5(nt){return isExtendable$3(nt)&&!Array.isArray(nt)}function isValidKey$1(nt){return nt!=="__proto__"&&nt!=="constructor"&&nt!=="prototype"}var mixinDeep_1=mixinDeep;/*!
 * get-value <https://github.com/jonschlinkert/get-value>
 *
 * Copyright (c) 2014-2015, Jon Schlinkert.
 * Licensed under the MIT License.
 */var getValue$1=function(nt,_,tt,ot,st){if(!isObject$4(nt)||!_)return nt;if(_=toString(_),tt&&(_+="."+toString(tt)),ot&&(_+="."+toString(ot)),st&&(_+="."+toString(st)),_ in nt)return nt[_];for(var at=_.split("."),lt=at.length,dt=-1;nt&&++dt<lt;){for(var ht=at[dt];ht[ht.length-1]==="\\";)ht=ht.slice(0,-1)+"."+at[++dt];nt=nt[ht]}return nt};function isObject$4(nt){return nt!==null&&(typeof nt=="object"||typeof nt=="function")}function toString(nt){return nt?Array.isArray(nt)?nt.join("."):nt:""}/*!
 * assign-symbols <https://github.com/jonschlinkert/assign-symbols>
 *
 * Copyright (c) 2015, Jon Schlinkert.
 * Licensed under the MIT License.
 */var assignSymbols$1=function(nt,_){if(nt===null||typeof nt>"u")throw new TypeError("expected first argument to be an object.");if(typeof _>"u"||typeof Symbol>"u"||typeof Object.getOwnPropertySymbols!="function")return nt;for(var tt=Object.prototype.propertyIsEnumerable,ot=Object(nt),st=arguments.length,at=0;++at<st;)for(var lt=Object(arguments[at]),dt=Object.getOwnPropertySymbols(lt),ht=0;ht<dt.length;ht++){var ft=dt[ht];tt.call(lt,ft)&&(ot[ft]=lt[ft])}return ot},isExtendable$2=isExtendable$4,assignSymbols=assignSymbols$1,extendShallow$1=Object.assign||function(nt){if(nt===null||typeof nt>"u")throw new TypeError("Cannot convert undefined or null to object");isObject$3(nt)||(nt={});for(var _=1;_<arguments.length;_++){var tt=arguments[_];isString(tt)&&(tt=toObject(tt)),isObject$3(tt)&&(assign$1(nt,tt),assignSymbols(nt,tt))}return nt};function assign$1(nt,_){for(var tt in _)hasOwn$1(_,tt)&&(nt[tt]=_[tt])}function isString(nt){return nt&&typeof nt=="string"}function toObject(nt){var _={};for(var tt in nt)_[tt]=nt[tt];return _}function isObject$3(nt){return nt&&typeof nt=="object"||isExtendable$2(nt)}function hasOwn$1(nt,_){return Object.prototype.hasOwnProperty.call(nt,_)}/*!
 * split-string <https://github.com/jonschlinkert/split-string>
 *
 * Copyright (c) 2015-2017, Jon Schlinkert.
 * Released under the MIT License.
 */var extend$1=extendShallow$1,splitString=function(nt,_,tt){if(typeof nt!="string")throw new TypeError("expected a string");typeof _=="function"&&(tt=_,_=null),typeof _=="string"&&(_={sep:_});var ot=extend$1({sep:"."},_),st=ot.quotes||['"',"'","`"],at;ot.brackets===!0?at={"<":">","(":")","[":"]","{":"}"}:ot.brackets&&(at=ot.brackets);var lt=[],dt=[],ht=[""],ft=ot.sep,gt=nt.length,Et=-1,yt;function Ct(){if(at&&dt.length)return at[dt[dt.length-1]]}for(;++Et<gt;){var wt=nt[Et],It=nt[Et+1],Pt={val:wt,idx:Et,arr:ht,str:nt};if(lt.push(Pt),wt==="\\"){Pt.val=keepEscaping(ot,nt,Et)===!0?wt+It:It,Pt.escaped=!0,typeof tt=="function"&&tt(Pt),ht[ht.length-1]+=Pt.val,Et++;continue}if(at&&at[wt]){dt.push(wt);var Rt=Ct(),xt=Et+1;if(nt.indexOf(Rt,xt+1)!==-1)for(;dt.length&&xt<gt;){var Nt=nt[++xt];if(Nt==="\\"){Nt++;continue}if(st.indexOf(Nt)!==-1){xt=getClosingQuote(nt,Nt,xt+1);continue}if(Rt=Ct(),dt.length&&nt.indexOf(Rt,xt+1)===-1)break;if(at[Nt]){dt.push(Nt);continue}Rt===Nt&&dt.pop()}if(yt=xt,yt===-1){ht[ht.length-1]+=wt;continue}wt=nt.slice(Et,yt+1),Pt.val=wt,Pt.idx=Et=yt}if(st.indexOf(wt)!==-1){if(yt=getClosingQuote(nt,wt,Et+1),yt===-1){ht[ht.length-1]+=wt;continue}keepQuotes(wt,ot)===!0?wt=nt.slice(Et,yt+1):wt=nt.slice(Et+1,yt),Pt.val=wt,Pt.idx=Et=yt}if(typeof tt=="function"&&(tt(Pt,lt),wt=Pt.val,Et=Pt.idx),Pt.val===ft&&Pt.split!==!1){ht.push("");continue}ht[ht.length-1]+=Pt.val}return ht};function getClosingQuote(nt,_,tt,ot){var st=nt.indexOf(_,tt);return nt.charAt(st-1)==="\\"?getClosingQuote(nt,_,st+1):st}function keepQuotes(nt,_){return _.keepDoubleQuotes===!0&&nt==='"'||_.keepSingleQuotes===!0&&nt==="'"?!0:_.keepQuotes}function keepEscaping(nt,_,tt){return typeof nt.keepEscaping=="function"?nt.keepEscaping(_,tt):nt.keepEscaping===!0||_[tt+1]==="\\"}/*!
 * is-extendable <https://github.com/jonschlinkert/is-extendable>
 *
 * Copyright (c) 2015, Jon Schlinkert.
 * Licensed under the MIT License.
 */var isExtendable$1=function(_){return typeof _<"u"&&_!==null&&(typeof _=="object"||typeof _=="function")},isObject$2=isExtendable$1,extendShallow=function(_){isObject$2(_)||(_={});for(var tt=arguments.length,ot=1;ot<tt;ot++){var st=arguments[ot];isObject$2(st)&&assign(_,st)}return _};function assign(nt,_){for(var tt in _)hasOwn(_,tt)&&(nt[tt]=_[tt])}function hasOwn(nt,_){return Object.prototype.hasOwnProperty.call(nt,_)}/*!
 * is-extendable <https://github.com/jonschlinkert/is-extendable>
 *
 * Copyright (c) 2015, Jon Schlinkert.
 * Licensed under the MIT License.
 */var isExtendable=function(_){return typeof _<"u"&&_!==null&&(typeof _=="object"||typeof _=="function")};/*!
 * set-value <https://github.com/jonschlinkert/set-value>
 *
 * Copyright (c) 2014-2015, 2017, Jon Schlinkert.
 * Released under the MIT License.
 */var split=splitString,extend=extendShallow,isPlainObject=isPlainObject$2,isObject$1=isExtendable,setValue=function(nt,_,tt){if(!isObject$1(nt)||(Array.isArray(_)&&(_=[].concat.apply([],_).join(".")),typeof _!="string"))return nt;for(var ot=split(_,{sep:".",brackets:!0}).filter(isValidKey),st=ot.length,at=-1,lt=nt;++at<st;){var dt=ot[at];if(at!==st-1){isObject$1(lt[dt])||(lt[dt]={}),lt=lt[dt];continue}isPlainObject(lt[dt])&&isPlainObject(tt)?lt[dt]=extend({},lt[dt],tt):lt[dt]=tt}return nt};function isValidKey(nt){return nt!=="__proto__"&&nt!=="constructor"&&nt!=="prototype"}var isObject=isExtendable$4,merge=mixinDeep_1,get=getValue$1,set=setValue,mergeValue=function(_,tt,ot){if(!isObject(_))throw new TypeError("expected an object");if(typeof tt!="string"||ot==null)return merge.apply(null,arguments);if(typeof ot=="string")return set(_,tt,ot),_;var st=get(_,tt);return isObject(ot)&&isObject(st)&&(ot=merge({},st,ot)),set(_,tt,ot),_};const merge$1=getDefaultExportFromCjs(mergeValue),join=(...nt)=>nt.filter(Boolean).join(".");function getKeyPath(nt){const _=nt.split(".");return[_.pop(),_.join(".")||void 0]}function getValuesForPaths(nt,_){return Object.entries(pick(nt,_)).reduce((tt,[,{value:ot,disabled:st,key:at}])=>(tt[at]=st?void 0:ot,tt),{})}function useCompareMemoize(nt,_){const tt=reactExports.useRef();return(_?dequal:shallow)(nt,tt.current)||(tt.current=nt),tt.current}function useDeepMemo(nt,_){return reactExports.useMemo(nt,useCompareMemoize(_,!0))}function useToggle(nt){const _=reactExports.useRef(null),tt=reactExports.useRef(null),ot=reactExports.useRef(!0);return reactExports.useLayoutEffect(()=>{nt||(_.current.style.height="0px",_.current.style.overflow="hidden")},[]),reactExports.useEffect(()=>{if(ot.current){ot.current=!1;return}let st;const at=_.current,lt=()=>{nt&&(at.style.removeProperty("height"),at.style.removeProperty("overflow"),tt.current.scrollIntoView({behavior:"smooth",block:"nearest"}))};at.addEventListener("transitionend",lt,{once:!0});const{height:dt}=tt.current.getBoundingClientRect();return at.style.height=dt+"px",nt||(at.style.overflow="hidden",st=window.setTimeout(()=>at.style.height="0px",50)),()=>{at.removeEventListener("transitionend",lt),clearTimeout(st)}},[nt]),{wrapperRef:_,contentRef:tt}}const useVisiblePaths=nt=>{const[_,tt]=reactExports.useState(nt.getVisiblePaths());return reactExports.useEffect(()=>{tt(nt.getVisiblePaths());const ot=nt.useStore.subscribe(nt.getVisiblePaths,tt,{equalityFn:shallow});return()=>ot()},[nt]),_};function useValuesForPath(nt,_,tt){return nt.useStore(st=>{const at=_objectSpread2(_objectSpread2({},tt),st.data);return getValuesForPaths(at,_)},shallow)}function usePopin(nt=3){const _=reactExports.useRef(null),tt=reactExports.useRef(null),[ot,st]=reactExports.useState(!1),at=reactExports.useCallback(()=>st(!0),[]),lt=reactExports.useCallback(()=>st(!1),[]);return reactExports.useLayoutEffect(()=>{if(ot){const{bottom:dt,top:ht,left:ft}=_.current.getBoundingClientRect(),{height:gt}=tt.current.getBoundingClientRect(),Et=dt+gt>window.innerHeight-40?"up":"down";tt.current.style.position="fixed",tt.current.style.zIndex="10000",tt.current.style.left=ft+"px",Et==="down"?tt.current.style.top=dt+nt+"px":tt.current.style.bottom=window.innerHeight-ht+nt+"px"}},[nt,ot]),{popinRef:_,wrapperRef:tt,shown:ot,show:at,hide:lt}}k$1([namesPlugin]);const convertMap={rgb:"toRgb",hsl:"toHsl",hsv:"toHsv",hex:"toHex"};v8n.extend({color:()=>nt=>w(nt).isValid()});const schema$2=nt=>v8n().color().test(nt);function convert(nt,{format:_,hasAlpha:tt,isString:ot}){const st=convertMap[_]+(ot&&_!=="hex"?"String":""),at=nt[st]();return typeof at=="object"&&!tt?omit(at,["a"]):at}const sanitize$2=(nt,_)=>{const tt=w(nt);if(!tt.isValid())throw Error("Invalid color");return convert(tt,_)},format$1=(nt,_)=>convert(w(nt),_objectSpread2(_objectSpread2({},_),{},{isString:!0,format:"hex"})),normalize$3=({value:nt})=>{const _=I$1(nt),tt=_==="name"?"hex":_,ot=typeof nt=="object"?"a"in nt:_==="hex"&&nt.length===8||/^(rgba)|(hsla)|(hsva)/.test(nt),st={format:tt,hasAlpha:ot,isString:typeof nt=="string"};return{value:sanitize$2(nt,st),settings:st}};var props$2=Object.freeze({__proto__:null,schema:schema$2,sanitize:sanitize$2,format:format$1,normalize:normalize$3});const ColorPreview=styled("div",{position:"relative",boxSizing:"border-box",borderRadius:"$sm",overflow:"hidden",cursor:"pointer",height:"$rowHeight",width:"$rowHeight",backgroundColor:"#fff",backgroundImage:`url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill-opacity=".05"><path d="M8 0h8v8H8zM0 8h8v8H0z"/></svg>')`,$inputStyle:"",$hover:"",zIndex:1,variants:{active:{true:{$inputStyle:"$accent1"}}},"&::before":{content:'""',position:"absolute",top:0,bottom:0,right:0,left:0,backgroundColor:"currentColor",zIndex:1}}),PickerContainer=styled("div",{position:"relative",display:"grid",gridTemplateColumns:"$sizes$rowHeight auto",columnGap:"$colGap",alignItems:"center"}),PickerWrapper=styled("div",{width:"$colorPickerWidth",height:"$colorPickerHeight",".react-colorful":{width:"100%",height:"100%",boxShadow:"$level2",cursor:"crosshair"},".react-colorful__saturation":{borderRadius:"$sm $sm 0 0"},".react-colorful__alpha, .react-colorful__hue":{height:10},".react-colorful__last-control":{borderRadius:"0 0 $sm $sm"},".react-colorful__pointer":{height:12,width:12}});function convertToRgb(nt,_){return _!=="rgb"?w(nt).toRgb():nt}function Color({value:nt,displayValue:_,settings:tt,onUpdate:ot}){const{emitOnEditStart:st,emitOnEditEnd:at}=useInputContext(),{format:lt,hasAlpha:dt}=tt,{popinRef:ht,wrapperRef:ft,shown:gt,show:Et,hide:yt}=usePopin(),Ct=reactExports.useRef(0),[wt,It]=reactExports.useState(()=>convertToRgb(nt,lt)),Pt=dt?Ce:Ne,Rt=()=>{It(convertToRgb(nt,lt)),Et(),st()},xt=()=>{yt(),at(),window.clearTimeout(Ct.current)},Nt=()=>{Ct.current=window.setTimeout(xt,500)};return reactExports.useEffect(()=>()=>window.clearTimeout(Ct.current),[]),React.createElement(React.Fragment,null,React.createElement(ColorPreview,{ref:ht,active:gt,onClick:()=>Rt(),style:{color:_}}),gt&&React.createElement(Portal,null,React.createElement(Overlay,{onPointerUp:xt}),React.createElement(PickerWrapper,{ref:ft,onMouseEnter:()=>window.clearTimeout(Ct.current),onMouseLeave:kt=>kt.buttons===0&&Nt()},React.createElement(Pt,{color:wt,onChange:ot}))))}function ColorComponent(){const{value:nt,displayValue:_,label:tt,onChange:ot,onUpdate:st,settings:at}=useInputContext();return React.createElement(Row,{input:!0},React.createElement(Label,null,tt),React.createElement(PickerContainer,null,React.createElement(Color,{value:nt,displayValue:_,onChange:ot,onUpdate:st,settings:at}),React.createElement(ValueInput,{value:_,onChange:ot,onUpdate:st})))}var color=_objectSpread2({component:ColorComponent},props$2);function Vector3dComponent(){const{label:nt,displayValue:_,onUpdate:tt,settings:ot}=useInputContext();return React.createElement(Row,{input:!0},React.createElement(Label,null,nt),React.createElement(Vector,{value:_,settings:ot,onUpdate:tt}))}var vector3d=_objectSpread2({component:Vector3dComponent},getVectorPlugin(["x","y","z"]));const JoystickTrigger=styled("div",{$flexCenter:"",position:"relative",backgroundColor:"$elevation3",borderRadius:"$sm",cursor:"pointer",height:"$rowHeight",width:"$rowHeight",touchAction:"none",$draggable:"",$hover:"","&:active":{cursor:"none"},"&::after":{content:'""',backgroundColor:"$accent2",height:4,width:4,borderRadius:2}}),JoystickPlayground=styled("div",{$flexCenter:"",width:"$joystickWidth",height:"$joystickHeight",borderRadius:"$sm",boxShadow:"$level2",position:"fixed",zIndex:1e4,overflow:"hidden",$draggable:"",transform:"translate(-50%, -50%)",variants:{isOutOfBounds:{true:{backgroundColor:"$elevation1"},false:{backgroundColor:"$elevation3"}}},"> div":{position:"absolute",$flexCenter:"",borderStyle:"solid",borderWidth:1,borderColor:"$highlight1",backgroundColor:"$elevation3",width:"80%",height:"80%","&::after,&::before":{content:'""',position:"absolute",zindex:10,backgroundColor:"$highlight1"},"&::before":{width:"100%",height:1},"&::after":{height:"100%",width:1}},"> span":{position:"relative",zindex:100,width:10,height:10,backgroundColor:"$accent2",borderRadius:"50%"}});function Joystick({value:nt,settings:_,onUpdate:tt}){const ot=reactExports.useRef(),st=reactExports.useRef(0),at=reactExports.useRef(0),lt=reactExports.useRef(1),[dt,ht]=reactExports.useState(!1),[ft,gt]=reactExports.useState(!1),[Et,yt]=useTransform(),Ct=reactExports.useRef(null),wt=reactExports.useRef(null);reactExports.useLayoutEffect(()=>{if(dt){const{top:an,left:fn,width:dn,height:Cn}=Ct.current.getBoundingClientRect();wt.current.style.left=fn+dn/2+"px",wt.current.style.top=an+Cn/2+"px"}},[dt]);const{keys:[It,Pt],joystick:Rt}=_,xt=Rt==="invertY"?1:-1,{[It]:{step:Nt},[Pt]:{step:kt}}=_,Vt=useTh("sizes","joystickWidth"),Ft=useTh("sizes","joystickHeight"),zt=parseFloat(Vt)*.8/2,Yt=parseFloat(Ft)*.8/2,Kt=reactExports.useCallback(()=>{ot.current||(gt(!0),st.current&&yt({x:st.current*zt}),at.current&&yt({y:at.current*-Yt}),ot.current=window.setInterval(()=>{tt(an=>{const fn=Nt*st.current*lt.current,dn=xt*kt*at.current*lt.current;return Array.isArray(an)?{[It]:an[0]+fn,[Pt]:an[1]+dn}:{[It]:an[It]+fn,[Pt]:an[Pt]+dn}})},16))},[zt,Yt,tt,yt,Nt,kt,It,Pt,xt]),qt=reactExports.useCallback(()=>{window.clearTimeout(ot.current),ot.current=void 0,gt(!1)},[]);reactExports.useEffect(()=>{function an(fn){lt.current=multiplyStep(fn)}return window.addEventListener("keydown",an),window.addEventListener("keyup",an),()=>{window.clearTimeout(ot.current),window.removeEventListener("keydown",an),window.removeEventListener("keyup",an)}},[]);const pn=useDrag(({first:an,active:fn,delta:[dn,Cn],movement:[On,Pn]})=>{an&&ht(!0);const yn=clamp(On,-zt,zt),An=clamp(Pn,-Yt,Yt);st.current=Math.abs(On)>Math.abs(yn)?Math.sign(On-yn):0,at.current=Math.abs(Pn)>Math.abs(An)?Math.sign(An-Pn):0;let Sn=nt[It],gn=nt[Pt];fn?(st.current||(Sn+=dn*Nt*lt.current,yt({x:yn})),at.current||(gn-=xt*Cn*kt*lt.current,yt({y:An})),st.current||at.current?Kt():qt(),tt({[It]:Sn,[Pt]:gn})):(ht(!1),st.current=0,at.current=0,yt({x:0,y:0}),qt())});return React.createElement(JoystickTrigger,_extends({ref:Ct},pn()),dt&&React.createElement(Portal,null,React.createElement(JoystickPlayground,{ref:wt,isOutOfBounds:ft},React.createElement("div",null),React.createElement("span",{ref:Et}))))}const Container$1=styled("div",{display:"grid",columnGap:"$colGap",variants:{withJoystick:{true:{gridTemplateColumns:"$sizes$rowHeight auto"},false:{gridTemplateColumns:"auto"}}}});function Vector2dComponent(){const{label:nt,displayValue:_,onUpdate:tt,settings:ot}=useInputContext();return React.createElement(Row,{input:!0},React.createElement(Label,null,nt),React.createElement(Container$1,{withJoystick:!!ot.joystick},ot.joystick&&React.createElement(Joystick,{value:_,settings:ot,onUpdate:tt}),React.createElement(Vector,{value:_,settings:ot,onUpdate:tt})))}const _excluded$7=["joystick"],plugin=getVectorPlugin(["x","y"]),normalize$2=nt=>{let{joystick:_=!0}=nt,tt=_objectWithoutProperties$1(nt,_excluded$7);const{value:ot,settings:st}=plugin.normalize(tt);return{value:ot,settings:_objectSpread2(_objectSpread2({},st),{},{joystick:_})}};var vector2d=_objectSpread2(_objectSpread2({component:Vector2dComponent},plugin),{},{normalize:normalize$2});const sanitize$1=nt=>{if(nt!==void 0){if(nt instanceof File)try{return URL.createObjectURL(nt)}catch{return}if(typeof nt=="string"&&nt.indexOf("blob:")===0)return nt;throw Error("Invalid image format [undefined | blob |File].")}},schema$1=(nt,_)=>typeof _=="object"&&"image"in _,normalize$1=({image:nt})=>({value:nt});var props$1=Object.freeze({__proto__:null,sanitize:sanitize$1,schema:schema$1,normalize:normalize$1});const ImageContainer=styled("div",{position:"relative",display:"grid",gridTemplateColumns:"$sizes$rowHeight auto 20px",columnGap:"$colGap",alignItems:"center"}),DropZone=styled("div",{$flexCenter:"",overflow:"hidden",height:"$rowHeight",background:"$elevation3",textAlign:"center",color:"inherit",borderRadius:"$sm",outline:"none",userSelect:"none",cursor:"pointer",$inputStyle:"",$hover:"",$focusWithin:"",$active:"$accent1 $elevation1",variants:{isDragAccept:{true:{$inputStyle:"$accent1",backgroundColor:"$elevation1"}}}}),ImagePreview=styled("div",{boxSizing:"border-box",borderRadius:"$sm",height:"$rowHeight",width:"$rowHeight",$inputStyle:"",backgroundSize:"cover",backgroundPosition:"center",variants:{hasImage:{true:{cursor:"pointer",$hover:"",$active:""}}}}),ImageLargePreview=styled("div",{$flexCenter:"",width:"$imagePreviewWidth",height:"$imagePreviewHeight",borderRadius:"$sm",boxShadow:"$level2",pointerEvents:"none",$inputStyle:"",backgroundSize:"cover",backgroundPosition:"center"}),Instructions=styled("div",{fontSize:"0.8em",height:"100%",padding:"$rowGap $md"}),Remove=styled("div",{$flexCenter:"",top:"0",right:"0",marginRight:"$sm",height:"100%",cursor:"pointer",variants:{disabled:{true:{color:"$elevation3",cursor:"default"}}},"&::after,&::before":{content:'""',position:"absolute",height:2,width:10,borderRadius:1,backgroundColor:"currentColor"},"&::after":{transform:"rotate(45deg)"},"&::before":{transform:"rotate(-45deg)"}});function ImageComponent(){const{label:nt,value:_,onUpdate:tt,disabled:ot}=useInputContext(),{popinRef:st,wrapperRef:at,shown:lt,show:dt,hide:ht}=usePopin(),ft=reactExports.useCallback(wt=>{wt.length&&tt(wt[0])},[tt]),gt=reactExports.useCallback(wt=>{wt.stopPropagation(),tt(void 0)},[tt]),{getRootProps:Et,getInputProps:yt,isDragAccept:Ct}=useDropzone({maxFiles:1,accept:"image/*",onDrop:ft,disabled:ot});return React.createElement(Row,{input:!0},React.createElement(Label,null,nt),React.createElement(ImageContainer,null,React.createElement(ImagePreview,{ref:st,hasImage:!!_,onPointerDown:()=>!!_&&dt(),onPointerUp:ht,style:{backgroundImage:_?`url(${_})`:"none"}}),lt&&!!_&&React.createElement(Portal,null,React.createElement(Overlay,{onPointerUp:ht,style:{cursor:"pointer"}}),React.createElement(ImageLargePreview,{ref:at,style:{backgroundImage:`url(${_})`}})),React.createElement(DropZone,Et({isDragAccept:Ct}),React.createElement("input",yt()),React.createElement(Instructions,null,Ct?"drop image":"click or drop")),React.createElement(Remove,{onClick:gt,disabled:!_})))}var image=_objectSpread2({component:ImageComponent},props$1);const number=v8n().number(),schema=(nt,_)=>v8n().array().length(2).every.number().test(nt)&&v8n().schema({min:number,max:number}).test(_),format=nt=>({min:nt[0],max:nt[1]}),sanitize=(nt,{bounds:[_,tt]},ot)=>{const st=Array.isArray(nt)?format(nt):nt,at={min:ot[0],max:ot[1]},{min:lt,max:dt}=_objectSpread2(_objectSpread2({},at),st);return[clamp(Number(lt),_,Math.max(_,dt)),clamp(Number(dt),Math.min(tt,lt),tt)]},normalize=({value:nt,min:_,max:tt})=>{const ot={min:_,max:tt},st=normalizeKeyedNumberSettings(format(nt),{min:ot,max:ot}),at=[_,tt],lt=_objectSpread2(_objectSpread2({},st),{},{bounds:at});return{value:sanitize(format(nt),lt,nt),settings:lt}};var props=Object.freeze({__proto__:null,schema,format,sanitize,normalize});const _excluded$6=["value","bounds","onDrag"],_excluded2$1=["bounds"],Container=styled("div",{display:"grid",columnGap:"$colGap",gridTemplateColumns:"auto calc($sizes$numberInputMinWidth * 2 + $space$rowGap)"});function IntervalSlider(nt){let{value:_,bounds:[tt,ot],onDrag:st}=nt,at=_objectWithoutProperties$1(nt,_excluded$6);const lt=reactExports.useRef(null),dt=reactExports.useRef(null),ht=reactExports.useRef(null),ft=reactExports.useRef(0),gt=useTh("sizes","scrubberWidth"),Et=useDrag(({event:wt,first:It,xy:[Pt],movement:[Rt],memo:xt={}})=>{if(It){const{width:kt,left:Vt}=lt.current.getBoundingClientRect();ft.current=kt-parseFloat(gt);const Ft=(wt==null?void 0:wt.target)===dt.current||(wt==null?void 0:wt.target)===ht.current;xt.pos=invertedRange((Pt-Vt)/kt,tt,ot);const zt=Math.abs(xt.pos-_.min)-Math.abs(xt.pos-_.max);xt.key=zt<0||zt===0&&xt.pos<=_.min?"min":"max",Ft&&(xt.pos=_[xt.key])}const Nt=xt.pos+invertedRange(Rt/ft.current,0,ot-tt);return st({[xt.key]:sanitizeStep(Nt,at[xt.key])}),xt}),yt=`calc(${range(_.min,tt,ot)} * (100% - ${gt} - 8px) + 4px)`,Ct=`calc(${1-range(_.max,tt,ot)} * (100% - ${gt} - 8px) + 4px)`;return React.createElement(RangeWrapper,_extends({ref:lt},Et()),React.createElement(Range,null,React.createElement(Indicator,{style:{left:yt,right:Ct}})),React.createElement(Scrubber,{position:"left",ref:dt,style:{left:yt}}),React.createElement(Scrubber,{position:"right",ref:ht,style:{right:Ct}}))}function IntervalComponent(){const{label:nt,displayValue:_,onUpdate:tt,settings:ot}=useInputContext(),st=_objectWithoutProperties$1(ot,_excluded2$1);return React.createElement(React.Fragment,null,React.createElement(Row,{input:!0},React.createElement(Label,null,nt),React.createElement(Container,null,React.createElement(IntervalSlider,_extends({value:_},ot,{onDrag:tt})),React.createElement(Vector,{value:_,settings:st,onUpdate:tt,innerLabelTrim:0}))))}var interval=_objectSpread2({component:IntervalComponent},props);const createEventEmitter=()=>{const nt=new Map;return{on:(_,tt)=>{let ot=nt.get(_);ot===void 0&&(ot=new Set,nt.set(_,ot)),ot.add(tt)},off:(_,tt)=>{const ot=nt.get(_);ot!==void 0&&(ot.delete(tt),ot.size===0&&nt.delete(_))},emit:(_,...tt)=>{const ot=nt.get(_);if(ot!==void 0)for(const st of ot)st(...tt)}}},_excluded$5=["type","value"],_excluded2=["onChange","transient","onEditStart","onEditEnd"],Store=function(){const _=create$2(subscribeWithSelector(()=>({data:{}}))),tt=createEventEmitter();this.storeId=getUid(),this.useStore=_;const ot={},st=new Set;this.getVisiblePaths=()=>{const lt=this.getData(),dt=Object.keys(lt),ht=[];Object.entries(ot).forEach(([gt,Et])=>{Et.render&&dt.some(yt=>yt.indexOf(gt)===0)&&!Et.render(this.get)&&ht.push(gt+".")});const ft=[];return st.forEach(gt=>{gt in lt&&lt[gt].__refCount>0&&ht.every(Et=>gt.indexOf(Et)===-1)&&(!lt[gt].render||lt[gt].render(this.get))&&ft.push(gt)}),ft},this.setOrderedPaths=lt=>{lt.forEach(dt=>st.add(dt))},this.orderPaths=lt=>(this.setOrderedPaths(lt),lt),this.disposePaths=lt=>{_.setState(dt=>{const ht=dt.data;return lt.forEach(ft=>{if(ft in ht){const gt=ht[ft];gt.__refCount--,gt.__refCount===0&&gt.type in SpecialInputs&&delete ht[ft]}}),{data:ht}})},this.dispose=()=>{_.setState(()=>({data:{}}))},this.getFolderSettings=lt=>ot[lt]||{},this.getData=()=>_.getState().data,this.addData=(lt,dt)=>{_.setState(ht=>{const ft=ht.data;return Object.entries(lt).forEach(([gt,Et])=>{let yt=ft[gt];if(yt){const{type:Ct,value:wt}=Et,It=_objectWithoutProperties$1(Et,_excluded$5);Ct!==yt.type?warn(LevaErrors.INPUT_TYPE_OVERRIDE,Ct):((yt.__refCount===0||dt)&&Object.assign(yt,It),yt.__refCount++)}else ft[gt]=_objectSpread2(_objectSpread2({},Et),{},{__refCount:1})}),{data:ft}})},this.setValueAtPath=(lt,dt,ht)=>{_.setState(ft=>{const gt=ft.data;return updateInput(gt[lt],dt,lt,this,ht),{data:gt}})},this.setSettingsAtPath=(lt,dt)=>{_.setState(ht=>{const ft=ht.data;return ft[lt].settings=_objectSpread2(_objectSpread2({},ft[lt].settings),dt),{data:ft}})},this.disableInputAtPath=(lt,dt)=>{_.setState(ht=>{const ft=ht.data;return ft[lt].disabled=dt,{data:ft}})},this.set=(lt,dt)=>{_.setState(ht=>{const ft=ht.data;return Object.entries(lt).forEach(([gt,Et])=>{try{updateInput(ft[gt],Et,void 0,void 0,dt)}catch{}}),{data:ft}})},this.getInput=lt=>{try{return this.getData()[lt]}catch{warn(LevaErrors.PATH_DOESNT_EXIST,lt)}},this.get=lt=>{var dt;return(dt=this.getInput(lt))===null||dt===void 0?void 0:dt.value},this.emitOnEditStart=lt=>{tt.emit(`onEditStart:${lt}`,this.get(lt),lt,_objectSpread2(_objectSpread2({},this.getInput(lt)),{},{get:this.get}))},this.emitOnEditEnd=lt=>{tt.emit(`onEditEnd:${lt}`,this.get(lt),lt,_objectSpread2(_objectSpread2({},this.getInput(lt)),{},{get:this.get}))},this.subscribeToEditStart=(lt,dt)=>{const ht=`onEditStart:${lt}`;return tt.on(ht,dt),()=>tt.off(ht,dt)},this.subscribeToEditEnd=(lt,dt)=>{const ht=`onEditEnd:${lt}`;return tt.on(ht,dt),()=>tt.off(ht,dt)};const at=(lt,dt,ht)=>{const ft={};return Object.entries(lt).forEach(([gt,Et])=>{if(gt==="")return warn(LevaErrors.EMPTY_KEY);let yt=join(dt,gt);if(Et.type===SpecialInputs.FOLDER){const Ct=at(Et.schema,yt,ht);Object.assign(ft,Ct),yt in ot||(ot[yt]=Et.settings)}else if(gt in ht)warn(LevaErrors.DUPLICATE_KEYS,gt,yt,ht[gt].path);else{const Ct=normalizeInput(Et,gt,yt,ft);if(Ct){const{type:wt,options:It,input:Pt}=Ct,{onChange:Rt,transient:xt,onEditStart:Nt,onEditEnd:kt}=It,Vt=_objectWithoutProperties$1(It,_excluded2);ft[yt]=_objectSpread2(_objectSpread2(_objectSpread2({type:wt},Vt),Pt),{},{fromPanel:!0}),ht[gt]={path:yt,onChange:Rt,transient:xt,onEditStart:Nt,onEditEnd:kt}}else warn(LevaErrors.UNKNOWN_INPUT,yt,Et)}}),ft};this.getDataFromSchema=lt=>{const dt={};return[at(lt,"",dt),dt]}},levaStore=new Store,defaultSettings$2={collapsed:!1};function folder(nt,_){return{type:SpecialInputs.FOLDER,schema:nt,settings:_objectSpread2(_objectSpread2({},defaultSettings$2),_)}}const defaultSettings$1={disabled:!1};function button(nt,_){return{type:SpecialInputs.BUTTON,onClick:nt,settings:_objectSpread2(_objectSpread2({},defaultSettings$1),_)}}const isInput=nt=>"__levaInput"in nt,buildTree=(nt,_)=>{const tt={},ot=_?_.toLowerCase():null;return nt.forEach(st=>{const[at,lt]=getKeyPath(st);(!ot||at.toLowerCase().indexOf(ot)>-1)&&merge$1(tt,lt,{[at]:{__levaInput:!0,path:st}})}),tt},_excluded$4=["type","label","path","valueKey","value","settings","setValue","disabled"];function ControlInput(nt){let{type:_,label:tt,path:ot,valueKey:st,value:at,settings:lt,setValue:dt,disabled:ht}=nt,ft=_objectWithoutProperties$1(nt,_excluded$4);const{displayValue:gt,onChange:Et,onUpdate:yt}=useInputSetters({type:_,value:at,settings:lt,setValue:dt}),Ct=Plugins[_].component;return Ct?React.createElement(InputContext.Provider,{value:_objectSpread2({key:st,path:ot,id:""+ot,label:tt,displayValue:gt,value:at,onChange:Et,onUpdate:yt,settings:lt,setValue:dt,disabled:ht},ft)},React.createElement(StyledInputWrapper$1,{disabled:ht},React.createElement(Ct,null))):(warn(LevaErrors.NO_COMPONENT_FOR_TYPE,_,ot),null)}const StyledButton=styled("button",{display:"block",$reset:"",fontWeight:"$button",height:"$rowHeight",borderStyle:"none",borderRadius:"$sm",backgroundColor:"$elevation1",color:"$highlight1","&:not(:disabled)":{color:"$highlight3",backgroundColor:"$accent2",cursor:"pointer",$hover:"$accent3",$active:"$accent3 $accent1",$focus:""}});function Button({onClick:nt,settings:_,label:tt}){const ot=useStoreContext();return React.createElement(Row,null,React.createElement(StyledButton,{disabled:_.disabled,onClick:()=>nt(ot.get)},tt))}const StyledButtonGroup=styled("div",{$flex:"",justifyContent:"flex-end",gap:"$colGap"}),StyledButtonGroupButton=styled("button",{$reset:"",cursor:"pointer",borderRadius:"$xs","&:hover":{backgroundColor:"$elevation3"}}),getOpts=({label:nt,opts:_})=>{let tt=typeof nt=="string"&&nt.trim()===""?null:nt,ot=_;return typeof _.opts=="object"&&(ot.label!==void 0&&(tt=_.label),ot=_.opts),{label:tt,opts:ot}};function ButtonGroup(nt){const{label:_,opts:tt}=getOpts(nt),ot=useStoreContext();return React.createElement(Row,{input:!!_},_&&React.createElement(Label,null,_),React.createElement(StyledButtonGroup,null,Object.entries(tt).map(([st,at])=>React.createElement(StyledButtonGroupButton,{key:st,onClick:()=>at(ot.get)},st))))}const Canvas=styled("canvas",{height:"$monitorHeight",width:"100%",display:"block",borderRadius:"$sm"}),POINTS=100;function push(nt,_){nt.push(_),nt.length>POINTS&&nt.shift()}const MonitorCanvas=reactExports.forwardRef(function({initialValue:nt},_){const tt=useTh("colors","highlight3"),ot=useTh("colors","elevation2"),st=useTh("colors","highlight1"),[at,lt]=reactExports.useMemo(()=>[w(st).alpha(.4).toRgbString(),w(st).alpha(.1).toRgbString()],[st]),dt=reactExports.useRef([nt]),ht=reactExports.useRef(nt),ft=reactExports.useRef(nt),gt=reactExports.useRef(),Et=reactExports.useCallback((wt,It)=>{if(!wt)return;const{width:Pt,height:Rt}=wt,xt=new Path2D,Nt=Pt/POINTS,kt=Rt*.05;for(let zt=0;zt<dt.current.length;zt++){const Yt=range(dt.current[zt],ht.current,ft.current),Kt=Nt*zt,qt=Rt-Yt*(Rt-kt*2)-kt;xt.lineTo(Kt,qt)}It.clearRect(0,0,Pt,Rt);const Vt=new Path2D(xt);Vt.lineTo(Nt*(dt.current.length+1),Rt),Vt.lineTo(0,Rt),Vt.lineTo(0,0);const Ft=It.createLinearGradient(0,0,0,Rt);Ft.addColorStop(0,at),Ft.addColorStop(1,lt),It.fillStyle=Ft,It.fill(Vt),It.strokeStyle=ot,It.lineJoin="round",It.lineWidth=14,It.stroke(xt),It.strokeStyle=tt,It.lineWidth=2,It.stroke(xt)},[tt,ot,at,lt]),[yt,Ct]=useCanvas2d(Et);return reactExports.useImperativeHandle(_,()=>({frame:wt=>{(ht.current===void 0||wt<ht.current)&&(ht.current=wt),(ft.current===void 0||wt>ft.current)&&(ft.current=wt),push(dt.current,wt),gt.current=requestAnimationFrame(()=>Et(yt.current,Ct.current))}}),[yt,Ct,Et]),reactExports.useEffect(()=>()=>cancelAnimationFrame(gt.current),[]),React.createElement(Canvas,{ref:yt})}),parse$1=nt=>Number.isFinite(nt)?nt.toPrecision(2):nt.toString(),MonitorLog=reactExports.forwardRef(function({initialValue:nt},_){const[tt,ot]=reactExports.useState(parse$1(nt));return reactExports.useImperativeHandle(_,()=>({frame:st=>ot(parse$1(st))}),[]),React.createElement("div",null,tt)});function getValue(nt){return typeof nt=="function"?nt():nt.current}function Monitor({label:nt,objectOrFn:_,settings:tt}){const ot=reactExports.useRef(),st=reactExports.useRef(getValue(_));return reactExports.useEffect(()=>{const at=window.setInterval(()=>{var lt;document.hidden||(lt=ot.current)===null||lt===void 0||lt.frame(getValue(_))},tt.interval);return()=>window.clearInterval(at)},[_,tt.interval]),React.createElement(Row,{input:!0},React.createElement(Label,{align:"top"},nt),tt.graph?React.createElement(MonitorCanvas,{ref:ot,initialValue:st.current}):React.createElement(MonitorLog,{ref:ot,initialValue:st.current}))}const _excluded$3=["type","label","key"],specialComponents={[SpecialInputs.BUTTON]:Button,[SpecialInputs.BUTTON_GROUP]:ButtonGroup,[SpecialInputs.MONITOR]:Monitor},Control=React.memo(({path:nt})=>{const[_,{set:tt,setSettings:ot,disable:st,storeId:at,emitOnEditStart:lt,emitOnEditEnd:dt}]=useInput(nt);if(!_)return null;const{type:ht,label:ft,key:gt}=_,Et=_objectWithoutProperties$1(_,_excluded$3);if(ht in SpecialInputs){const yt=specialComponents[ht];return React.createElement(yt,_extends({label:ft,path:nt},Et))}return ht in Plugins?React.createElement(ControlInput,_extends({key:at+nt,type:ht,label:ft,storeId:at,path:nt,valueKey:gt,setValue:tt,setSettings:ot,disable:st,emitOnEditStart:lt,emitOnEditEnd:dt},Et)):(log(LevaErrors.UNSUPPORTED_INPUT,ht,nt),null)});function FolderTitle({toggle:nt,toggled:_,name:tt}){return React.createElement(StyledTitle,{onClick:()=>nt()},React.createElement(Chevron,{toggled:_}),React.createElement("div",null,tt))}const Folder=({name:nt,path:_,tree:tt})=>{const ot=useStoreContext(),st=join(_,nt),{collapsed:at,color:lt}=ot.getFolderSettings(st),[dt,ht]=reactExports.useState(!at),ft=reactExports.useRef(null),gt=useTh("colors","folderWidgetColor"),Et=useTh("colors","folderTextColor");return reactExports.useLayoutEffect(()=>{ft.current.style.setProperty("--leva-colors-folderWidgetColor",lt||gt),ft.current.style.setProperty("--leva-colors-folderTextColor",lt||Et)},[lt,gt,Et]),React.createElement(StyledFolder,{ref:ft},React.createElement(FolderTitle,{name:nt,toggled:dt,toggle:()=>ht(yt=>!yt)}),React.createElement(TreeWrapper,{parent:st,tree:tt,toggled:dt}))},TreeWrapper=React.memo(({isRoot:nt=!1,fill:_=!1,flat:tt=!1,parent:ot,tree:st,toggled:at})=>{const{wrapperRef:lt,contentRef:dt}=useToggle(at),ht=useStoreContext(),ft=([Et,yt])=>{var Ct;return(isInput(yt)?(Ct=ht.getInput(yt.path))===null||Ct===void 0?void 0:Ct.order:ht.getFolderSettings(join(ot,Et)).order)||0},gt=Object.entries(st).sort((Et,yt)=>ft(Et)-ft(yt));return React.createElement(StyledWrapper,{ref:lt,isRoot:nt,fill:_,flat:tt},React.createElement(StyledContent,{ref:dt,isRoot:nt,toggled:at},gt.map(([Et,yt])=>isInput(yt)?React.createElement(Control,{key:yt.path,valueKey:yt.valueKey,path:yt.path}):React.createElement(Folder,{key:Et,name:Et,path:ot,tree:yt}))))}),StyledRoot=styled("div",{position:"relative",fontFamily:"$mono",fontSize:"$root",color:"$rootText",backgroundColor:"$elevation1",variants:{fill:{false:{position:"fixed",top:"10px",right:"10px",zIndex:1e3,width:"$rootWidth"},true:{position:"relative",width:"100%"}},flat:{false:{borderRadius:"$lg",boxShadow:"$level1"}},oneLineLabels:{true:{[`${StyledInputRow}`]:{gridTemplateColumns:"auto",gridAutoColumns:"minmax(max-content, 1fr)",gridAutoRows:"minmax($sizes$rowHeight), auto)",rowGap:0,columnGap:0,marginTop:"$rowGap"}}},hideTitleBar:{true:{$$titleBarHeight:"0px"},false:{$$titleBarHeight:"$sizes$titleBarHeight"}}},"&,*,*:after,*:before":{boxSizing:"border-box"},"*::selection":{backgroundColor:"$accent2"}}),iconWidth=40,Icon=styled("i",{$flexCenter:"",width:iconWidth,userSelect:"none",cursor:"pointer","> svg":{fill:"$highlight1",transition:"transform 350ms ease, fill 250ms ease"},"&:hover > svg":{fill:"$highlight3"},variants:{active:{true:{"> svg":{fill:"$highlight2"}}}}}),StyledTitleWithFilter=styled("div",{display:"flex",alignItems:"stretch",justifyContent:"space-between",height:"$titleBarHeight",variants:{mode:{drag:{cursor:"grab"}}}}),FilterWrapper=styled("div",{$flex:"",position:"relative",width:"100%",overflow:"hidden",transition:"height 250ms ease",color:"$highlight3",paddingLeft:"$md",[`> ${Icon}`]:{height:30},variants:{toggled:{true:{height:30},false:{height:0}}}}),StyledFilterInput=styled("input",{$reset:"",flex:1,position:"relative",height:30,width:"100%",backgroundColor:"transparent",fontSize:"10px",borderRadius:"$root","&:focus":{},"&::placeholder":{color:"$highlight2"}}),TitleContainer=styled("div",{touchAction:"none",$flexCenter:"",flex:1,"> svg":{fill:"$highlight1"},color:"$highlight1",variants:{drag:{true:{$draggable:"","> svg":{transition:"fill 250ms ease"},"&:hover":{color:"$highlight3"},"&:hover > svg":{fill:"$highlight3"}}},filterEnabled:{false:{paddingRight:iconWidth}}}}),FilterInput=React.forwardRef(({setFilter:nt,toggle:_},tt)=>{const[ot,st]=reactExports.useState(""),at=reactExports.useMemo(()=>debounce(nt,250),[nt]),lt=()=>{nt(""),st("")},dt=ht=>{const ft=ht.currentTarget.value;_(!0),st(ft)};return reactExports.useEffect(()=>{at(ot)},[ot,at]),React.createElement(React.Fragment,null,React.createElement(StyledFilterInput,{ref:tt,value:ot,placeholder:"[Open filter with CMD+SHIFT+L]",onPointerDown:ht=>ht.stopPropagation(),onChange:dt}),React.createElement(Icon,{onClick:()=>lt(),style:{visibility:ot?"visible":"hidden"}},React.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",height:"14",width:"14",viewBox:"0 0 20 20",fill:"currentColor"},React.createElement("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"}))))});function TitleWithFilter({setFilter:nt,onDrag:_,onDragStart:tt,onDragEnd:ot,toggle:st,toggled:at,title:lt,drag:dt,filterEnabled:ht,from:ft}){const[gt,Et]=reactExports.useState(!1),yt=reactExports.useRef(null);reactExports.useEffect(()=>{var wt,It;gt?(wt=yt.current)===null||wt===void 0||wt.focus():(It=yt.current)===null||It===void 0||It.blur()},[gt]);const Ct=useDrag(({offset:[wt,It],first:Pt,last:Rt})=>{_({x:wt,y:It}),Pt&&tt({x:wt,y:It}),Rt&&ot({x:wt,y:It})},{filterTaps:!0,from:({offset:[wt,It]})=>[(ft==null?void 0:ft.x)||wt,(ft==null?void 0:ft.y)||It]});return reactExports.useEffect(()=>{const wt=It=>{It.key==="L"&&It.shiftKey&&It.metaKey&&Et(Pt=>!Pt)};return window.addEventListener("keydown",wt),()=>window.removeEventListener("keydown",wt)},[]),React.createElement(React.Fragment,null,React.createElement(StyledTitleWithFilter,{mode:dt?"drag":void 0},React.createElement(Icon,{active:!at,onClick:()=>st()},React.createElement(Chevron,{toggled:at,width:12,height:8})),React.createElement(TitleContainer,_extends({},dt?Ct():{},{drag:dt,filterEnabled:ht}),lt===void 0&&dt?React.createElement("svg",{width:"20",height:"10",viewBox:"0 0 28 14",xmlns:"http://www.w3.org/2000/svg"},React.createElement("circle",{cx:"2",cy:"2",r:"2"}),React.createElement("circle",{cx:"14",cy:"2",r:"2"}),React.createElement("circle",{cx:"26",cy:"2",r:"2"}),React.createElement("circle",{cx:"2",cy:"12",r:"2"}),React.createElement("circle",{cx:"14",cy:"12",r:"2"}),React.createElement("circle",{cx:"26",cy:"12",r:"2"})):lt),ht&&React.createElement(Icon,{active:gt,onClick:()=>Et(wt=>!wt)},React.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",height:"20",viewBox:"0 0 20 20"},React.createElement("path",{d:"M9 9a2 2 0 114 0 2 2 0 01-4 0z"}),React.createElement("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm1-13a4 4 0 00-3.446 6.032l-2.261 2.26a1 1 0 101.414 1.415l2.261-2.261A4 4 0 1011 5z",clipRule:"evenodd"})))),React.createElement(FilterWrapper,{toggled:gt},React.createElement(FilterInput,{ref:yt,setFilter:nt,toggle:st})))}const _excluded$2=["store","hidden","theme","collapsed"];function LevaRoot(nt){let{store:_,hidden:tt=!1,theme:ot,collapsed:st=!1}=nt,at=_objectWithoutProperties$1(nt,_excluded$2);const lt=useDeepMemo(()=>mergeTheme(ot),[ot]),[dt,ht]=reactExports.useState(!st),ft=typeof st=="object"?!st.collapsed:dt,gt=reactExports.useMemo(()=>typeof st=="object"?Et=>{typeof Et=="function"?st.onChange(!Et(!st.collapsed)):st.onChange(!Et)}:ht,[st]);return!_||tt?null:React.createElement(ThemeContext.Provider,{value:lt},React.createElement(LevaCore,_extends({store:_},at,{toggled:ft,setToggle:gt,rootClass:lt.className})))}const LevaCore=React.memo(({store:nt,rootClass:_,fill:tt=!1,flat:ot=!1,neverHide:st=!1,oneLineLabels:at=!1,titleBar:lt={title:void 0,drag:!0,filter:!0,position:void 0,onDrag:void 0,onDragStart:void 0,onDragEnd:void 0},hideCopyButton:dt=!1,toggled:ht,setToggle:ft})=>{var gt,Et;const yt=useVisiblePaths(nt),[Ct,wt]=reactExports.useState(""),It=reactExports.useMemo(()=>buildTree(yt,Ct),[yt,Ct]),[Pt,Rt]=useTransform(),xt=st||yt.length>0,Nt=typeof lt=="object"&&lt.title||void 0,kt=typeof lt=="object"&&(gt=lt.drag)!==null&&gt!==void 0?gt:!0,Vt=typeof lt=="object"&&(Et=lt.filter)!==null&&Et!==void 0?Et:!0,Ft=typeof lt=="object"&&lt.position||void 0,zt=typeof lt=="object"&&lt.onDrag||void 0,Yt=typeof lt=="object"&&lt.onDragStart||void 0,Kt=typeof lt=="object"&&lt.onDragEnd||void 0;return React.useEffect(()=>{Rt({x:Ft==null?void 0:Ft.x,y:Ft==null?void 0:Ft.y})},[Ft,Rt]),globalStyles(),React.createElement(PanelSettingsContext.Provider,{value:{hideCopyButton:dt}},React.createElement(StyledRoot,{ref:Pt,className:_,fill:tt,flat:ot,oneLineLabels:at,hideTitleBar:!lt,style:{display:xt?"block":"none"}},lt&&React.createElement(TitleWithFilter,{onDrag:qt=>{Rt(qt),zt==null||zt(qt)},onDragStart:qt=>Yt==null?void 0:Yt(qt),onDragEnd:qt=>Kt==null?void 0:Kt(qt),setFilter:wt,toggle:qt=>ft(pn=>qt??!pn),toggled:ht,title:Nt,drag:kt,filterEnabled:Vt,from:Ft}),xt&&React.createElement(StoreContext.Provider,{value:nt},React.createElement(TreeWrapper,{isRoot:!0,fill:tt,flat:ot,tree:It,toggled:ht}))))}),_excluded$1=["isRoot"];let rootInitialized=!1,rootEl=null;function Leva(nt){let{isRoot:_=!1}=nt,tt=_objectWithoutProperties$1(nt,_excluded$1);return reactExports.useEffect(()=>(rootInitialized=!0,!_&&rootEl&&(rootEl.remove(),rootEl=null),()=>{_||(rootInitialized=!1)}),[_]),React.createElement(LevaRoot,_extends({store:levaStore},tt))}function useRenderRoot(nt){reactExports.useEffect(()=>{nt&&!rootInitialized&&(rootEl||(rootEl=document.getElementById("leva__root")||Object.assign(document.createElement("div"),{id:"leva__root"}),document.body&&(document.body.appendChild(rootEl),render(React.createElement(Leva,{isRoot:!0}),rootEl))),rootInitialized=!0)},[nt])}function parseArgs(nt,_,tt,ot,st){let at,lt,dt,ht,ft;return typeof nt=="string"?(lt=nt,at=_,Array.isArray(tt)?ft=tt:tt&&("store"in tt?(ht=tt,ft=ot):(dt=tt,Array.isArray(ot)?ft=ot:(ht=ot,ft=st)))):(at=nt,Array.isArray(_)?ft=_:(ht=_,ft=tt)),{schema:at,folderName:lt,folderSettings:dt,hookSettings:ht,deps:ft||[]}}function useControls(nt,_,tt,ot,st){const{folderName:at,schema:lt,folderSettings:dt,hookSettings:ht,deps:ft}=parseArgs(nt,_,tt,ot,st),gt=typeof lt=="function",Et=reactExports.useRef(!1),yt=reactExports.useRef(!0),Ct=useDeepMemo(()=>{Et.current=!0;const pn=typeof lt=="function"?lt():lt;return at?{[at]:folder(pn,dt)}:pn},ft),wt=!(ht!=null&&ht.store);useRenderRoot(wt);const[It]=reactExports.useState(()=>(ht==null?void 0:ht.store)||levaStore),[Pt,Rt]=reactExports.useMemo(()=>It.getDataFromSchema(Ct),[It,Ct]),[xt,Nt,kt,Vt,Ft]=reactExports.useMemo(()=>{const pn=[],an=[],fn={},dn={},Cn={};return Object.values(Rt).forEach(({path:On,onChange:Pn,onEditStart:yn,onEditEnd:An,transient:Sn})=>{pn.push(On),Pn?(fn[On]=Pn,Sn||an.push(On)):an.push(On),yn&&(dn[On]=yn),An&&(Cn[On]=An)}),[pn,an,fn,dn,Cn]},[Rt]),zt=reactExports.useMemo(()=>It.orderPaths(xt),[xt,It]),Yt=useValuesForPath(It,Nt,Pt),Kt=reactExports.useCallback(pn=>{const an=Object.entries(pn).reduce((fn,[dn,Cn])=>Object.assign(fn,{[Rt[dn].path]:Cn}),{});It.set(an,!1)},[It,Rt]),qt=reactExports.useCallback(pn=>It.get(Rt[pn].path),[It,Rt]);return reactExports.useEffect(()=>{const pn=!yt.current&&Et.current;return It.addData(Pt,pn),yt.current=!1,Et.current=!1,()=>It.disposePaths(zt)},[It,zt,Pt]),reactExports.useEffect(()=>{const pn=[];return Object.entries(kt).forEach(([an,fn])=>{fn(It.get(an),an,_objectSpread2({initial:!0,get:It.get},It.getInput(an)));const dn=It.useStore.subscribe(Cn=>{const On=Cn.data[an];return[On.disabled?void 0:On.value,On]},([Cn,On])=>fn(Cn,an,_objectSpread2({initial:!1,get:It.get},On)),{equalityFn:shallow});pn.push(dn)}),()=>pn.forEach(an=>an())},[It,kt]),reactExports.useEffect(()=>{const pn=[];return Object.entries(Vt).forEach(([an,fn])=>pn.push(It.subscribeToEditStart(an,fn))),Object.entries(Ft).forEach(([an,fn])=>pn.push(It.subscribeToEditEnd(an,fn))),()=>pn.forEach(an=>an())},[Vt,Ft,It]),gt?[Yt,Kt,qt]:Yt}register(LevaInputs.SELECT,select);register(LevaInputs.IMAGE,image);register(LevaInputs.NUMBER,number$1);register(LevaInputs.COLOR,color);register(LevaInputs.STRING,string);register(LevaInputs.BOOLEAN,boolean);register(LevaInputs.INTERVAL,interval);register(LevaInputs.VECTOR3D,vector3d);register(LevaInputs.VECTOR2D,vector2d);var AgoraRTC_NProduction={exports:{}};(function(nt,_){(function(tt,ot){nt.exports=ot()})(commonjsGlobal,function(){function tt(_e,rt){return rt.forEach(function(it){it&&typeof it!="string"&&!Array.isArray(it)&&Object.keys(it).forEach(function(ct){if(ct!=="default"&&!(ct in _e)){var ut=Object.getOwnPropertyDescriptor(it,ct);Object.defineProperty(_e,ct,ut.get?ut:{enumerable:!0,get:function(){return it[ct]}})}})}),Object.freeze(_e)}var ot=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof commonjsGlobal<"u"?commonjsGlobal:typeof self<"u"?self:{};function st(_e){return _e&&_e.__esModule&&Object.prototype.hasOwnProperty.call(_e,"default")?_e.default:_e}var at=function(_e){try{return!!_e()}catch{return!0}},lt=!at(function(){var _e=(function(){}).bind();return typeof _e!="function"||_e.hasOwnProperty("prototype")}),dt=lt,ht=Function.prototype,ft=ht.call,gt=dt&&ht.bind.bind(ft,ft),Et=dt?gt:function(_e){return function(){return ft.apply(_e,arguments)}},yt=Et({}.isPrototypeOf),Ct=function(_e){return _e&&_e.Math===Math&&_e},wt=Ct(typeof globalThis=="object"&&globalThis)||Ct(typeof window=="object"&&window)||Ct(typeof self=="object"&&self)||Ct(typeof ot=="object"&&ot)||Ct(typeof ot=="object"&&ot)||function(){return this}()||Function("return this")(),It=lt,Pt=Function.prototype,Rt=Pt.apply,xt=Pt.call,Nt=typeof Reflect=="object"&&Reflect.apply||(It?xt.bind(Rt):function(){return xt.apply(Rt,arguments)}),kt=Et,Vt=kt({}.toString),Ft=kt("".slice),zt=function(_e){return Ft(Vt(_e),8,-1)},Yt=zt,Kt=Et,qt=function(_e){if(Yt(_e)==="Function")return Kt(_e)},pn=typeof document=="object"&&document.all,an=pn===void 0&&pn!==void 0?function(_e){return typeof _e=="function"||_e===pn}:function(_e){return typeof _e=="function"},fn={},dn=!at(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!==7}),Cn=lt,On=Function.prototype.call,Pn=Cn?On.bind(On):function(){return On.apply(On,arguments)},yn={},An={}.propertyIsEnumerable,Sn=Object.getOwnPropertyDescriptor,gn=Sn&&!An.call({1:2},1);yn.f=gn?function(_e){var rt=Sn(this,_e);return!!rt&&rt.enumerable}:An;var _n,Rn,bn=function(_e,rt){return{enumerable:!(1&_e),configurable:!(2&_e),writable:!(4&_e),value:rt}},jn=at,kn=zt,Gn=Object,Vn=Et("".split),qn=jn(function(){return!Gn("z").propertyIsEnumerable(0)})?function(_e){return kn(_e)==="String"?Vn(_e,""):Gn(_e)}:Gn,Tr=function(_e){return _e==null},Mn=Tr,Zt=TypeError,wn=function(_e){if(Mn(_e))throw new Zt("Can't call method on "+_e);return _e},xn=qn,Hn=wn,Bn=function(_e){return xn(Hn(_e))},cr=an,Wn=function(_e){return typeof _e=="object"?_e!==null:cr(_e)},rr={},sr=rr,ir=wt,kr=an,un=function(_e){return kr(_e)?_e:void 0},sn=function(_e,rt){return arguments.length<2?un(sr[_e])||un(ir[_e]):sr[_e]&&sr[_e][rt]||ir[_e]&&ir[_e][rt]},Kn=wt.navigator,Sr=Kn&&Kn.userAgent,lr=Sr?String(Sr):"",vr=wt,Fr=lr,Gr=vr.process,dr=vr.Deno,Hr=Gr&&Gr.versions||dr&&dr.version,zr=Hr&&Hr.v8;zr&&(Rn=(_n=zr.split("."))[0]>0&&_n[0]<4?1:+(_n[0]+_n[1])),!Rn&&Fr&&(!(_n=Fr.match(/Edge\/(\d+)/))||_n[1]>=74)&&(_n=Fr.match(/Chrome\/(\d+)/))&&(Rn=+_n[1]);var Nr=Rn,Or=Nr,Ur=at,Zr=wt.String,oo=!!Object.getOwnPropertySymbols&&!Ur(function(){var _e=Symbol("symbol detection");return!Zr(_e)||!(Object(_e)instanceof Symbol)||!Symbol.sham&&Or&&Or<41}),zn=oo&&!Symbol.sham&&typeof Symbol.iterator=="symbol",ar=sn,pr=an,Wr=yt,Qr=Object,ko=zn?function(_e){return typeof _e=="symbol"}:function(_e){var rt=ar("Symbol");return pr(rt)&&Wr(rt.prototype,Qr(_e))},os=String,Jo=function(_e){try{return os(_e)}catch{return"Object"}},ws=an,Ms=Jo,ys=TypeError,bo=function(_e){if(ws(_e))return _e;throw new ys(Ms(_e)+" is not a function")},mu=bo,Xl=Tr,ss=function(_e,rt){var it=_e[rt];return Xl(it)?void 0:mu(it)},js=Pn,_l=an,Is=Wn,vo=TypeError,wl={exports:{}},ju=wt,cn=Object.defineProperty,Xt=wt,mn=function(_e,rt){try{cn(ju,_e,{value:rt,configurable:!0,writable:!0})}catch{ju[_e]=rt}return rt},Nn="__core-js_shared__",In=wl.exports=Xt[Nn]||mn(Nn,{});(In.versions||(In.versions=[])).push({version:"3.42.0",mode:"pure",copyright:" 2014-2025 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.42.0/LICENSE",source:"https://github.com/zloirock/core-js"});var Un=wl.exports,mr=Un,gr=function(_e,rt){return mr[_e]||(mr[_e]=rt||{})},br=wn,Rr=Object,wr=function(_e){return Rr(br(_e))},tr=wr,to=Et({}.hasOwnProperty),$r=Object.hasOwn||function(_e,rt){return to(tr(_e),rt)},Yr=Et,_o=0,Ro=Math.random(),yo=Yr(1 .toString),eo=function(_e){return"Symbol("+(_e===void 0?"":_e)+")_"+yo(++_o+Ro,36)},Io=gr,fo=$r,Go=eo,Ps=oo,Uo=zn,_s=wt.Symbol,as=Io("wks"),ks=Uo?_s.for||_s:_s&&_s.withoutSetter||Go,xo=function(_e){return fo(as,_e)||(as[_e]=Ps&&fo(_s,_e)?_s[_e]:ks("Symbol."+_e)),as[_e]},$o=Pn,Xs=Wn,As=ko,zo=ss,ba=function(_e,rt){var it,ct;if(rt==="string"&&_l(it=_e.toString)&&!Is(ct=js(it,_e))||_l(it=_e.valueOf)&&!Is(ct=js(it,_e))||rt!=="string"&&_l(it=_e.toString)&&!Is(ct=js(it,_e)))return ct;throw new vo("Can't convert object to primitive value")},_d=TypeError,Vl=xo("toPrimitive"),dp=function(_e,rt){if(!Xs(_e)||As(_e))return _e;var it,ct=zo(_e,Vl);if(ct){if(rt===void 0&&(rt="default"),it=$o(ct,_e,rt),!Xs(it)||As(it))return it;throw new _d("Can't convert object to primitive value")}return rt===void 0&&(rt="number"),ba(_e,rt)},Lm=ko,zp=function(_e){var rt=dp(_e,"string");return Lm(rt)?rt:rt+""},cm=Wn,km=wt.document,G0=cm(km)&&cm(km.createElement),K_=function(_e){return G0?km.createElement(_e):{}},Um=K_,Y_=!dn&&!at(function(){return Object.defineProperty(Um("div"),"a",{get:function(){return 7}}).a!==7}),lm=dn,f_=Pn,um=yn,Es=bn,Av=Bn,Bm=zp,AE=$r,Cv=Y_,bv=Object.getOwnPropertyDescriptor;fn.f=lm?bv:function(_e,rt){if(_e=Av(_e),rt=Bm(rt),Cv)try{return bv(_e,rt)}catch{}if(AE(_e,rt))return Es(!f_(um.f,_e,rt),_e[rt])};var Il=at,X_=an,$0=/#|\.prototype\./,su=function(_e,rt){var it=q_[Rv(_e)];return it===wv||it!==hp&&(X_(rt)?Il(rt):!!rt)},Rv=su.normalize=function(_e){return String(_e).replace($0,".").toLowerCase()},q_=su.data={},hp=su.NATIVE="N",wv=su.POLYFILL="P",Iv=su,pp=bo,zu=lt,dm=qt(qt.bind),au=function(_e,rt){return pp(_e),rt===void 0?_e:zu?dm(_e,rt):function(){return _e.apply(rt,arguments)}},Mu={},CE=dn&&at(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!==42}),_h=Wn,J_=String,Z_=TypeError,Gl=function(_e){if(_h(_e))return _e;throw new Z_(J_(_e)+" is not an object")},Wu=dn,gu=Y_,bE=CE,ep=Gl,Fm=zp,RE=TypeError,wE=Object.defineProperty,_u=Object.getOwnPropertyDescriptor,Cu="enumerable",xl="configurable",Ol="writable";Mu.f=Wu?bE?function(_e,rt,it){if(ep(_e),rt=Fm(rt),ep(it),typeof _e=="function"&&rt==="prototype"&&"value"in it&&Ol in it&&!it[Ol]){var ct=_u(_e,rt);ct&&ct[Ol]&&(_e[rt]=it.value,it={configurable:xl in it?it[xl]:ct[xl],enumerable:Cu in it?it[Cu]:ct[Cu],writable:!1})}return wE(_e,rt,it)}:wE:function(_e,rt,it){if(ep(_e),rt=Fm(rt),ep(it),gu)try{return wE(_e,rt,it)}catch{}if("get"in it||"set"in it)throw new RE("Accessors not supported");return"value"in it&&(_e[rt]=it.value),_e};var fp=Mu,m_=bn,Vm=dn?function(_e,rt,it){return fp.f(_e,rt,m_(1,it))}:function(_e,rt,it){return _e[rt]=it,_e},IE=wt,Gm=Nt,g_=qt,H0=an,oC=fn.f,j0=Iv,Q_=rr,sC=au,__=Vm,xv=$r,aC=function(_e){var rt=function(it,ct,ut){if(this instanceof rt){switch(arguments.length){case 0:return new _e;case 1:return new _e(it);case 2:return new _e(it,ct)}return new _e(it,ct,ut)}return Gm(_e,this,arguments)};return rt.prototype=_e.prototype,rt},Ko=function(_e,rt){var it,ct,ut,pt,mt,_t,vt,Tt,bt,Ot=_e.target,Mt=_e.global,Dt=_e.stat,jt=_e.proto,$t=Mt?IE:Dt?IE[Ot]:IE[Ot]&&IE[Ot].prototype,Ht=Mt?Q_:Q_[Ot]||__(Q_,Ot,{})[Ot],en=Ht.prototype;for(pt in rt)ct=!(it=j0(Mt?pt:Ot+(Dt?".":"#")+pt,_e.forced))&&$t&&xv($t,pt),_t=Ht[pt],ct&&(vt=_e.dontCallGetSet?(bt=oC($t,pt))&&bt.value:$t[pt]),mt=ct&&vt?vt:rt[pt],(it||jt||typeof _t!=typeof mt)&&(Tt=_e.bind&&ct?sC(mt,IE):_e.wrap&&ct?aC(mt):jt&&H0(mt)?g_(mt):mt,(_e.sham||mt&&mt.sham||_t&&_t.sham)&&__(Tt,"sham",!0),__(Ht,pt,Tt),jt&&(xv(Q_,ut=Ot+"Prototype")||__(Q_,ut,{}),__(Q_[ut],pt,mt),_e.real&&en&&(it||!en[pt])&&__(en,pt,mt)))},cC=Math.ceil,eT=Math.floor,xE=Math.trunc||function(_e){var rt=+_e;return(rt>0?eT:cC)(rt)},OE=xE,ME=function(_e){var rt=+_e;return rt!=rt||rt===0?0:OE(rt)},z0=ME,Rp=Math.max,wp=Math.min,$m=function(_e,rt){var it=z0(_e);return it<0?Rp(it+rt,0):wp(it,rt)},Hm=ME,jm=Math.min,E_=function(_e){var rt=Hm(_e);return rt>0?jm(rt,9007199254740991):0},lC=E_,hm=function(_e){return lC(_e.length)},tT=Bn,mp=$m,gp=hm,El=function(_e){return function(rt,it,ct){var ut=tT(rt),pt=gp(ut);if(pt===0)return!_e&&-1;var mt,_t=mp(ct,pt);if(_e&&it!=it){for(;pt>_t;)if((mt=ut[_t++])!=mt)return!0}else for(;pt>_t;_t++)if((_e||_t in ut)&&ut[_t]===it)return _e||_t||0;return!_e&&-1}},eE={includes:El(!0),indexOf:El(!1)},Wp=eE.includes;Ko({target:"Array",proto:!0,forced:at(function(){return!Array(1).includes()})},{includes:function(_e){return Wp(this,_e,arguments.length>1?arguments[1]:void 0)}});var uC=wt,dC=rr,tp=function(_e,rt){var it=dC[_e+"Prototype"],ct=it&&it[rt];if(ct)return ct;var ut=uC[_e],pt=ut&&ut.prototype;return pt&&pt[rt]},nT=tp("Array","includes"),hC=Wn,Ov=zt,PE=xo("match"),W0=function(_e){var rt;return hC(_e)&&((rt=_e[PE])!==void 0?!!rt:Ov(_e)==="RegExp")},Mv=W0,K0=TypeError,rT={};rT[xo("toStringTag")]="z";var Y0=String(rT)==="[object z]",NE=Y0,pC=an,v_=zt,Ip=xo("toStringTag"),Pv=Object,DE=v_(function(){return arguments}())==="Arguments",bu=NE?v_:function(_e){var rt,it,ct;return _e===void 0?"Undefined":_e===null?"Null":typeof(it=function(ut,pt){try{return ut[pt]}catch{}}(rt=Pv(_e),Ip))=="string"?it:DE?v_(rt):(ct=v_(rt))==="Object"&&pC(rt.callee)?"Arguments":ct},iT=bu,LE=String,Ku=function(_e){if(iT(_e)==="Symbol")throw new TypeError("Cannot convert a Symbol value to a string");return LE(_e)},oT=xo("match"),Ml=Ko,X0=function(_e){if(Mv(_e))throw new K0("The method doesn't accept regular expressions");return _e},sT=wn,q0=Ku,J0=function(_e){var rt=/./;try{"/./"[_e](rt)}catch{try{return rt[oT]=!1,"/./"[_e](rt)}catch{}}return!1},xp=Et("".indexOf);Ml({target:"String",proto:!0,forced:!J0("includes")},{includes:function(_e){return!!~xp(q0(sT(this)),q0(X0(_e)),arguments.length>1?arguments[1]:void 0)}});var kE=tp("String","includes"),Pl=yt,Pu=nT,Eu=kE,UE=Array.prototype,tE=String.prototype,Nv=function(_e){var rt=_e.includes;return _e===UE||Pl(UE,_e)&&rt===UE.includes?Pu:typeof _e=="string"||_e===tE||Pl(tE,_e)&&rt===tE.includes?Eu:rt},Er=st(Nv),Nu=bo,aT=wr,cT=qn,lT=hm,pm=TypeError,Kp="Reduce of empty array with no initial value",y_=function(_e){return function(rt,it,ct,ut){var pt=aT(rt),mt=cT(pt),_t=lT(pt);if(Nu(it),_t===0&&ct<2)throw new pm(Kp);var vt=_e?_t-1:0,Tt=_e?-1:1;if(ct<2)for(;;){if(vt in mt){ut=mt[vt],vt+=Tt;break}if(vt+=Tt,_e?vt<0:_t<=vt)throw new pm(Kp)}for(;_e?vt>=0:_t>vt;vt+=Tt)vt in mt&&(ut=it(ut,mt[vt],vt,pt));return ut}},Z0={left:y_(!1),right:y_(!0)},Q0=at,Dv=function(_e,rt){var it=[][_e];return!!it&&Q0(function(){it.call(null,rt||function(){return 1},1)})},BE=wt,fC=lr,mC=zt,Lv=function(_e){return fC.slice(0,_e.length)===_e},ey=Lv("Bun/")?"BUN":Lv("Cloudflare-Workers")?"CLOUDFLARE":Lv("Deno/")?"DENO":Lv("Node.js/")?"NODE":BE.Bun&&typeof Bun.version=="string"?"BUN":BE.Deno&&typeof Deno.version=="object"?"DENO":mC(BE.process)==="process"?"NODE":BE.window&&BE.document?"BROWSER":"REST",FE=ey==="NODE",kv=Z0.left;Ko({target:"Array",proto:!0,forced:!FE&&Nr>79&&Nr<83||!Dv("reduce")},{reduce:function(_e){var rt=arguments.length;return kv(this,_e,rt,rt>1?arguments[1]:void 0)}});var gC=tp("Array","reduce"),ty=yt,ny=gC,Uv=Array.prototype,Bv=function(_e){var rt=_e.reduce;return _e===Uv||ty(Uv,_e)&&rt===Uv.reduce?ny:rt},uT=Bv,_p=st(uT),_C=zt,VE=Array.isArray||function(_e){return _C(_e)==="Array"},dT=Ko,EC=VE,vC=Et([].reverse),yC=[1,2];dT({target:"Array",proto:!0,forced:String(yC)===String(yC.reverse())},{reverse:function(){return EC(this)&&(this.length=this.length),vC(this)}});var SC=tp("Array","reverse"),P1=yt,N1=SC,ry=Array.prototype,TC=function(_e){var rt=_e.reverse;return _e===ry||P1(ry,_e)&&rt===ry.reverse?N1:rt},hT=TC,pT=st(hT),iy=eo,AC=gr("keys"),oy=function(_e){return AC[_e]||(AC[_e]=iy(_e))},D1=!at(function(){function _e(){}return _e.prototype.constructor=null,Object.getPrototypeOf(new _e)!==_e.prototype}),fT=$r,mT=an,L1=wr,CC=D1,gT=oy("IE_PROTO"),sy=Object,bC=sy.prototype,ay=CC?sy.getPrototypeOf:function(_e){var rt=L1(_e);if(fT(rt,gT))return rt[gT];var it=rt.constructor;return mT(it)&&rt instanceof it?it.prototype:rt instanceof sy?bC:null},fm=Et,RC=bo,Fv=Wn,Vv=function(_e){return Fv(_e)||_e===null},cy=String,ly=TypeError,wC=function(_e,rt,it){try{return fm(RC(Object.getOwnPropertyDescriptor(_e,rt)[it]))}catch{}},Gv=Wn,Du=wn,k1=function(_e){if(Vv(_e))return _e;throw new ly("Can't set "+cy(_e)+" as a prototype")},U1=Object.setPrototypeOf||("__proto__"in{}?function(){var _e,rt=!1,it={};try{(_e=wC(Object.prototype,"__proto__","set"))(it,[]),rt=it instanceof Array}catch{}return function(ct,ut){return Du(ct),k1(ut),Gv(ct)&&(rt?_e(ct,ut):ct.__proto__=ut),ct}}():void 0),Lu={},vu={},uy=$r,IC=Bn,xC=eE.indexOf,OC=vu,_T=Et([].push),dy=function(_e,rt){var it,ct=IC(_e),ut=0,pt=[];for(it in ct)!uy(OC,it)&&uy(ct,it)&&_T(pt,it);for(;rt.length>ut;)uy(ct,it=rt[ut++])&&(~xC(pt,it)||_T(pt,it));return pt},hy=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],ET=dy,MC=hy.concat("length","prototype");Lu.f=Object.getOwnPropertyNames||function(_e){return ET(_e,MC)};var GE={};GE.f=Object.getOwnPropertySymbols;var fy=sn,my=Lu,PC=GE,vT=Gl,NC=Et([].concat),DC=fy("Reflect","ownKeys")||function(_e){var rt=my.f(vT(_e)),it=PC.f;return it?NC(rt,it(_e)):rt},$v=$r,LC=DC,yT=fn,kC=Mu,Yp={},B1=dy,F1=hy,nE=Object.keys||function(_e){return B1(_e,F1)},rE=dn,V1=CE,ro=Mu,gy=Gl,ST=Bn,UC=nE;Yp.f=rE&&!V1?Object.defineProperties:function(_e,rt){gy(_e);for(var it,ct=ST(rt),ut=UC(rt),pt=ut.length,mt=0;pt>mt;)ro.f(_e,it=ut[mt++],ct[it]);return _e};var Ey,S_=sn("document","documentElement"),Hv=Gl,TT=Yp,AT=hy,BC=vu,FC=S_,VC=K_,vy="prototype",yy="script",Sy=oy("IE_PROTO"),jv=function(){},CT=function(_e){return"<"+yy+">"+_e+"</"+yy+">"},Ty=function(_e){_e.write(CT("")),_e.close();var rt=_e.parentWindow.Object;return _e=null,rt},iE=function(){try{Ey=new ActiveXObject("htmlfile")}catch{}var _e,rt,it;iE=typeof document<"u"?document.domain&&Ey?Ty(Ey):(rt=VC("iframe"),it="java"+yy+":",rt.style.display="none",FC.appendChild(rt),rt.src=String(it),(_e=rt.contentWindow.document).open(),_e.write(CT("document.F=Object")),_e.close(),_e.F):Ty(Ey);for(var ct=AT.length;ct--;)delete iE[vy][AT[ct]];return iE()};BC[Sy]=!0;var zv=Object.create||function(_e,rt){var it;return _e!==null?(jv[vy]=Hv(_e),it=new jv,jv[vy]=null,it[Sy]=_e):it=iE(),rt===void 0?it:TT.f(it,rt)},G1=Wn,GC=Vm,bT=Error,$C=Et("".replace),HC=String(new bT("zxcasd").stack),Wv=/\n\s*at [^:]*:[^\n]*/,Ay=Wv.test(HC),Cy=bn,by=!at(function(){var _e=new Error("a");return!("stack"in _e)||(Object.defineProperty(_e,"stack",Cy(1,7)),_e.stack!==7)}),Ry=Vm,Kv=function(_e,rt){if(Ay&&typeof _e=="string"&&!bT.prepareStackTrace)for(;rt--;)_e=$C(_e,Wv,"");return _e},RT=by,wy=Error.captureStackTrace,T_={},jC=T_,wT=xo("iterator"),$1=Array.prototype,Yv=function(_e){return _e!==void 0&&(jC.Array===_e||$1[wT]===_e)},IT=bu,Ll=ss,hs=Tr,Jl=T_,Zl=xo("iterator"),Ql=function(_e){if(!hs(_e))return Ll(_e,Zl)||Ll(_e,"@@iterator")||Jl[IT(_e)]},Ep=Pn,$E=bo,cu=Gl,Xv=Jo,HE=Ql,Iy=TypeError,qv=function(_e,rt){var it=arguments.length<2?HE(_e):rt;if($E(it))return cu(Ep(it,_e));throw new Iy(Xv(_e)+" is not iterable")},Jv=Pn,Yu=Gl,xT=ss,xy=function(_e,rt,it){var ct,ut;Yu(_e);try{if(!(ct=xT(_e,"return"))){if(rt==="throw")throw it;return it}ct=Jv(ct,_e)}catch(pt){ut=!0,ct=pt}if(rt==="throw")throw it;if(ut)throw ct;return Yu(ct),it},jE=au,Oy=Pn,OT=Gl,A_=Jo,My=Yv,C_=hm,Zv=yt,Qv=qv,MT=Ql,e0=xy,Py=TypeError,yu=function(_e,rt){this.stopped=_e,this.result=rt},zm=yu.prototype,ku=function(_e,rt,it){var ct,ut,pt,mt,_t,vt,Tt,bt=it&&it.that,Ot=!(!it||!it.AS_ENTRIES),Mt=!(!it||!it.IS_RECORD),Dt=!(!it||!it.IS_ITERATOR),jt=!(!it||!it.INTERRUPTED),$t=jE(rt,bt),Ht=function(Qt){return ct&&e0(ct,"normal",Qt),new yu(!0,Qt)},en=function(Qt){return Ot?(OT(Qt),jt?$t(Qt[0],Qt[1],Ht):$t(Qt[0],Qt[1])):jt?$t(Qt,Ht):$t(Qt)};if(Mt)ct=_e.iterator;else if(Dt)ct=_e;else{if(!(ut=MT(_e)))throw new Py(A_(_e)+" is not iterable");if(My(ut)){for(pt=0,mt=C_(_e);mt>pt;pt++)if((_t=en(_e[pt]))&&Zv(zm,_t))return _t;return new yu(!1)}ct=Qv(_e,ut)}for(vt=Mt?_e.next:ct.next;!(Tt=Oy(vt,ct)).done;){try{_t=en(Tt.value)}catch(Qt){e0(ct,"throw",Qt)}if(typeof _t=="object"&&_t&&Zv(zm,_t))return _t}return new yu(!1)},Ny=Ku,np=Ko,zC=yt,PT=ay,zE=U1,H1=function(_e,rt,it){for(var ct=LC(rt),ut=kC.f,pt=yT.f,mt=0;mt<ct.length;mt++){var _t=ct[mt];$v(_e,_t)||it&&$v(it,_t)||ut(_e,_t,pt(rt,_t))}},Wm=zv,Dy=Vm,Ly=bn,NT=function(_e,rt){G1(rt)&&"cause"in rt&&GC(_e,"cause",rt.cause)},oE=function(_e,rt,it,ct){RT&&(wy?wy(_e,rt):Ry(_e,"stack",Kv(it,ct)))},WC=ku,KC=function(_e,rt){return _e===void 0?arguments.length<2?"":rt:Ny(_e)},DT=xo("toStringTag"),sE=Error,j1=[].push,WE=function(_e,rt){var it,ct=zC(ky,this);zE?it=zE(new sE,ct?PT(this):ky):(it=ct?this:Wm(ky),Dy(it,DT,"Error")),rt!==void 0&&Dy(it,"message",KC(rt)),oE(it,WE,it.stack,1),arguments.length>2&&NT(it,arguments[2]);var ut=[];return WC(_e,j1,{that:ut}),Dy(it,"errors",ut),it};zE?zE(WE,sE):H1(WE,sE,{name:!0});var ky=WE.prototype=Wm(sE.prototype,{constructor:Ly(1,WE),message:Ly(1,""),name:Ly(1,"AggregateError")});np({global:!0,constructor:!0,arity:2},{AggregateError:WE});var t0,Xp,Uy,aE=an,LT=wt.WeakMap,rp=aE(LT)&&/native code/.test(String(LT)),YC=wt,XC=Wn,z1=Vm,kT=$r,By=Un,qC=oy,W1=vu,vp="Object already initialized",n0=YC.TypeError,K1=YC.WeakMap;if(rp||By.state){var Ru=By.state||(By.state=new K1);Ru.get=Ru.get,Ru.has=Ru.has,Ru.set=Ru.set,t0=function(_e,rt){if(Ru.has(_e))throw new n0(vp);return rt.facade=_e,Ru.set(_e,rt),rt},Xp=function(_e){return Ru.get(_e)||{}},Uy=function(_e){return Ru.has(_e)}}else{var Km=qC("state");W1[Km]=!0,t0=function(_e,rt){if(kT(_e,Km))throw new n0(vp);return rt.facade=_e,z1(_e,Km,rt),rt},Xp=function(_e){return kT(_e,Km)?_e[Km]:{}},Uy=function(_e){return kT(_e,Km)}}var yp,r0,Fy,Ym={set:t0,get:Xp,has:Uy,enforce:function(_e){return Uy(_e)?Xp(_e):t0(_e,{})},getterFor:function(_e){return function(rt){var it;if(!XC(rt)||(it=Xp(rt)).type!==_e)throw new n0("Incompatible receiver, "+_e+" required");return it}}},UT=dn,JC=$r,BT=Function.prototype,ZC=UT&&Object.getOwnPropertyDescriptor,Vy=JC(BT,"name"),Gy={EXISTS:Vy,PROPER:Vy&&(function(){}).name==="something",CONFIGURABLE:Vy&&(!UT||UT&&ZC(BT,"name").configurable)},Y1=Vm,b_=function(_e,rt,it,ct){return ct&&ct.enumerable?_e[rt]=it:Y1(_e,rt,it),_e},St=at,At=an,Lt=Wn,Bt=zv,Wt=ay,nn=b_,Dn=xo("iterator"),Zn=!1;[].keys&&("next"in(Fy=[].keys())?(r0=Wt(Wt(Fy)))!==Object.prototype&&(yp=r0):Zn=!0);var xr=!Lt(yp)||St(function(){var _e={};return yp[Dn].call(_e)!==_e});At((yp=xr?{}:Bt(yp))[Dn])||nn(yp,Dn,function(){return this});var Kr={IteratorPrototype:yp,BUGGY_SAFARI_ITERATORS:Zn},mo=bu,Zo=Y0?{}.toString:function(){return"[object "+mo(this)+"]"},Mo=Y0,Zs=Mu.f,To=Vm,Uu=$r,Mp=Zo,yr=xo("toStringTag"),er=function(_e,rt,it,ct){var ut=it?_e:_e&&_e.prototype;ut&&(Uu(ut,yr)||Zs(ut,yr,{configurable:!0,value:rt}),ct&&!Mo&&To(ut,"toString",Mp))},Ar=Kr.IteratorPrototype,ao=zv,So=bn,cs=er,Qo=T_,Us=function(){return this},eu=function(_e,rt,it,ct){var ut=rt+" Iterator";return _e.prototype=ao(Ar,{next:So(+!ct,it)}),cs(_e,ut,!1,!0),Qo[ut]=Us,_e},Bs=Ko,R_=Pn,X1=Gy,y$=eu,S$=ay,T$=er,wP=b_,IP=T_,A$=Kr,C$=X1.PROPER,QC=A$.BUGGY_SAFARI_ITERATORS,q1=xo("iterator"),xP="keys",eR="values",OP="entries",b$=function(){return this},MP=function(_e,rt,it,ct,ut,pt,mt){y$(it,rt,ct);var _t,vt,Tt,bt=function(en){if(en===ut&&$t)return $t;if(!QC&&en&&en in Dt)return Dt[en];switch(en){case xP:case eR:case OP:return function(){return new it(this,en)}}return function(){return new it(this)}},Ot=rt+" Iterator",Mt=!1,Dt=_e.prototype,jt=Dt[q1]||Dt["@@iterator"]||ut&&Dt[ut],$t=!QC&&jt||bt(ut),Ht=rt==="Array"&&Dt.entries||jt;if(Ht&&(_t=S$(Ht.call(new _e)))!==Object.prototype&&_t.next&&(T$(_t,Ot,!0,!0),IP[Ot]=b$),C$&&ut===eR&&jt&&jt.name!==eR&&(Mt=!0,$t=function(){return R_(jt,this)}),ut)if(vt={values:bt(eR),keys:pt?$t:bt(xP),entries:bt(OP)},mt)for(Tt in vt)(QC||Mt||!(Tt in Dt))&&wP(Dt,Tt,vt[Tt]);else Bs({target:rt,proto:!0,forced:QC||Mt},vt);return mt&&Dt[q1]!==$t&&wP(Dt,q1,$t,{name:ut}),IP[rt]=$t,vt},tR=function(_e,rt){return{value:_e,done:rt}},R$=Bn,PP=T_,NP=Ym;Mu.f;var w$=MP,nR=tR,DP="Array Iterator",I$=NP.set,x$=NP.getterFor(DP);w$(Array,"Array",function(_e,rt){I$(this,{type:DP,target:R$(_e),index:0,kind:rt})},function(){var _e=x$(this),rt=_e.target,it=_e.index++;if(!rt||it>=rt.length)return _e.target=null,nR(void 0,!0);switch(_e.kind){case"keys":return nR(it,!1);case"values":return nR(rt[it],!1)}return nR([it,rt[it]],!1)},"values"),PP.Arguments=PP.Array;var O$=Mu,rR=function(_e,rt,it){return O$.f(_e,rt,it)},M$=sn,P$=rR,N$=dn,LP=xo("species"),D$=yt,L$=TypeError,J1=function(_e,rt){if(D$(rt,_e))return _e;throw new L$("Incorrect invocation")},k$=an,Z1=Un,U$=Et(Function.toString);k$(Z1.inspectSource)||(Z1.inspectSource=function(_e){return U$(_e)});var kP=Z1.inspectSource,B$=Et,F$=at,UP=an,V$=bu,G$=kP,BP=function(){},FP=sn("Reflect","construct"),Q1=/^\s*(?:class|function)\b/,$$=B$(Q1.exec),H$=!Q1.test(BP),FT=function(_e){if(!UP(_e))return!1;try{return FP(BP,[],_e),!0}catch{return!1}},VP=function(_e){if(!UP(_e))return!1;switch(V$(_e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return H$||!!$$(Q1,G$(_e))}catch{return!0}};VP.sham=!0;var VT,$y,GP,eI,iR=!FP||F$(function(){var _e;return FT(FT.call)||!FT(Object)||!FT(function(){_e=!0})||_e})?VP:FT,j$=iR,z$=Jo,W$=TypeError,$P=Gl,K$=function(_e){if(j$(_e))return _e;throw new W$(z$(_e)+" is not a constructor")},Y$=Tr,X$=xo("species"),tI=function(_e,rt){var it,ct=$P(_e).constructor;return ct===void 0||Y$(it=$P(ct)[X$])?rt:K$(it)},KE=Et([].slice),q$=TypeError,i0=function(_e,rt){if(_e<rt)throw new q$("Not enough arguments");return _e},HP=/(?:ipad|iphone|ipod).*applewebkit/i.test(lr),qp=wt,J$=Nt,Z$=au,jP=an,Q$=$r,zP=at,WP=S_,eH=KE,KP=K_,tH=i0,nH=HP,rH=FE,nI=qp.setImmediate,rI=qp.clearImmediate,iH=qp.process,iI=qp.Dispatch,oH=qp.Function,YP=qp.MessageChannel,sH=qp.String,oI=0,GT={},XP="onreadystatechange";zP(function(){VT=qp.location});var sI=function(_e){if(Q$(GT,_e)){var rt=GT[_e];delete GT[_e],rt()}},aI=function(_e){return function(){sI(_e)}},qP=function(_e){sI(_e.data)},JP=function(_e){qp.postMessage(sH(_e),VT.protocol+"//"+VT.host)};nI&&rI||(nI=function(_e){tH(arguments.length,1);var rt=jP(_e)?_e:oH(_e),it=eH(arguments,1);return GT[++oI]=function(){J$(rt,void 0,it)},$y(oI),oI},rI=function(_e){delete GT[_e]},rH?$y=function(_e){iH.nextTick(aI(_e))}:iI&&iI.now?$y=function(_e){iI.now(aI(_e))}:YP&&!nH?(eI=(GP=new YP).port2,GP.port1.onmessage=qP,$y=Z$(eI.postMessage,eI)):qp.addEventListener&&jP(qp.postMessage)&&!qp.importScripts&&VT&&VT.protocol!=="file:"&&!zP(JP)?($y=JP,qp.addEventListener("message",qP,!1)):$y=XP in KP("script")?function(_e){WP.appendChild(KP("script"))[XP]=function(){WP.removeChild(this),sI(_e)}}:function(_e){setTimeout(aI(_e),0)});var oR={set:nI,clear:rI},ZP=wt,aH=dn,cH=Object.getOwnPropertyDescriptor,QP=function(_e){if(!aH)return ZP[_e];var rt=cH(ZP,_e);return rt&&rt.value},eN=function(){this.head=null,this.tail=null};eN.prototype={add:function(_e){var rt={item:_e,next:null},it=this.tail;it?it.next=rt:this.head=rt,this.tail=rt},get:function(){var _e=this.head;if(_e)return(this.head=_e.next)===null&&(this.tail=null),_e.item}};var Hy,cI,lI,uI,tN,nN=eN,lH=/ipad|iphone|ipod/i.test(lr)&&typeof Pebble<"u",uH=/web0s(?!.*chrome)/i.test(lr),jy=wt,dH=QP,rN=au,dI=oR.set,hH=nN,pH=HP,fH=lH,mH=uH,hI=FE,iN=jy.MutationObserver||jy.WebKitMutationObserver,oN=jy.document,sN=jy.process,sR=jy.Promise,pI=dH("queueMicrotask");if(!pI){var aR=new hH,cR=function(){var _e,rt;for(hI&&(_e=sN.domain)&&_e.exit();rt=aR.get();)try{rt()}catch(it){throw aR.head&&Hy(),it}_e&&_e.enter()};pH||hI||mH||!iN||!oN?!fH&&sR&&sR.resolve?((uI=sR.resolve(void 0)).constructor=sR,tN=rN(uI.then,uI),Hy=function(){tN(cR)}):hI?Hy=function(){sN.nextTick(cR)}:(dI=rN(dI,jy),Hy=function(){dI(cR)}):(cI=!0,lI=oN.createTextNode(""),new iN(cR).observe(lI,{characterData:!0}),Hy=function(){lI.data=cI=!cI}),pI=function(_e){aR.head||Hy(),aR.add(_e)}}var aN=pI,zy=function(_e){try{return{error:!1,value:_e()}}catch(rt){return{error:!0,value:rt}}},o0=wt.Promise,gH=wt,$T=o0,_H=an,EH=Iv,vH=kP,yH=xo,cN=ey,fI=Nr,lN=$T&&$T.prototype,SH=yH("species"),uN=!1,dN=_H(gH.PromiseRejectionEvent),TH=EH("Promise",function(){var _e=vH($T),rt=_e!==String($T);if(!rt&&fI===66||!lN.catch||!lN.finally)return!0;if(!fI||fI<51||!/native code/.test(_e)){var it=new $T(function(ut){ut(1)}),ct=function(ut){ut(function(){},function(){})};if((it.constructor={})[SH]=ct,!(uN=it.then(function(){})instanceof ct))return!0}return!(rt||cN!=="BROWSER"&&cN!=="DENO"||dN)}),HT={CONSTRUCTOR:TH,REJECTION_EVENT:dN,SUBCLASSING:uN},w_={},hN=bo,AH=TypeError,CH=function(_e){var rt,it;this.promise=new _e(function(ct,ut){if(rt!==void 0||it!==void 0)throw new AH("Bad Promise constructor");rt=ct,it=ut}),this.resolve=hN(rt),this.reject=hN(it)};w_.f=function(_e){return new CH(_e)};var mI,pN,bH=Ko,lR=FE,YE=wt,jT=Pn,RH=b_,wH=er,IH=function(_e){var rt=M$(_e);N$&&rt&&!rt[LP]&&P$(rt,LP,{configurable:!0,get:function(){return this}})},xH=bo,gI=an,OH=Wn,MH=J1,PH=tI,fN=oR.set,_I=aN,NH=function(_e,rt){try{arguments.length===1?console.error(_e):console.error(_e,rt)}catch{}},DH=zy,LH=nN,mN=Ym,EI=o0,gN=HT,_N=w_,uR="Promise",EN=gN.CONSTRUCTOR,kH=gN.REJECTION_EVENT,vI=mN.getterFor(uR),UH=mN.set,BH=EI&&EI.prototype,zT=EI,yI=BH,vN=YE.TypeError,SI=YE.document,TI=YE.process,AI=_N.f,FH=AI,VH=!!(SI&&SI.createEvent&&YE.dispatchEvent),yN="unhandledrejection",SN=function(_e){var rt;return!(!OH(_e)||!gI(rt=_e.then))&&rt},TN=function(_e,rt){var it,ct,ut,pt=rt.value,mt=rt.state===1,_t=mt?_e.ok:_e.fail,vt=_e.resolve,Tt=_e.reject,bt=_e.domain;try{_t?(mt||(rt.rejection===2&&$H(rt),rt.rejection=1),_t===!0?it=pt:(bt&&bt.enter(),it=_t(pt),bt&&(bt.exit(),ut=!0)),it===_e.promise?Tt(new vN("Promise-chain cycle")):(ct=SN(it))?jT(ct,it,vt,Tt):vt(it)):Tt(pt)}catch(Ot){bt&&!ut&&bt.exit(),Tt(Ot)}},AN=function(_e,rt){_e.notified||(_e.notified=!0,_I(function(){for(var it,ct=_e.reactions;it=ct.get();)TN(it,_e);_e.notified=!1,rt&&!_e.rejection&&GH(_e)}))},CN=function(_e,rt,it){var ct,ut;VH?((ct=SI.createEvent("Event")).promise=rt,ct.reason=it,ct.initEvent(_e,!1,!0),YE.dispatchEvent(ct)):ct={promise:rt,reason:it},!kH&&(ut=YE["on"+_e])?ut(ct):_e===yN&&NH("Unhandled promise rejection",it)},GH=function(_e){jT(fN,YE,function(){var rt,it=_e.facade,ct=_e.value;if(bN(_e)&&(rt=DH(function(){lR?TI.emit("unhandledRejection",ct,it):CN(yN,it,ct)}),_e.rejection=lR||bN(_e)?2:1,rt.error))throw rt.value})},bN=function(_e){return _e.rejection!==1&&!_e.parent},$H=function(_e){jT(fN,YE,function(){var rt=_e.facade;lR?TI.emit("rejectionHandled",rt):CN("rejectionhandled",rt,_e.value)})},Wy=function(_e,rt,it){return function(ct){_e(rt,ct,it)}},Ky=function(_e,rt,it){_e.done||(_e.done=!0,it&&(_e=it),_e.value=rt,_e.state=2,AN(_e,!0))},CI=function(_e,rt,it){if(!_e.done){_e.done=!0,it&&(_e=it);try{if(_e.facade===rt)throw new vN("Promise can't be resolved itself");var ct=SN(rt);ct?_I(function(){var ut={done:!1};try{jT(ct,rt,Wy(CI,ut,_e),Wy(Ky,ut,_e))}catch(pt){Ky(ut,pt,_e)}}):(_e.value=rt,_e.state=1,AN(_e,!1))}catch(ut){Ky({done:!1},ut,_e)}}};EN&&(yI=(zT=function(_e){MH(this,yI),xH(_e),jT(mI,this);var rt=vI(this);try{_e(Wy(CI,rt),Wy(Ky,rt))}catch(it){Ky(rt,it)}}).prototype,(mI=function(_e){UH(this,{type:uR,done:!1,notified:!1,parent:!1,reactions:new LH,rejection:!1,state:0,value:null})}).prototype=RH(yI,"then",function(_e,rt){var it=vI(this),ct=AI(PH(this,zT));return it.parent=!0,ct.ok=!gI(_e)||_e,ct.fail=gI(rt)&&rt,ct.domain=lR?TI.domain:void 0,it.state===0?it.reactions.add(ct):_I(function(){TN(ct,it)}),ct.promise}),pN=function(){var _e=new mI,rt=vI(_e);this.promise=_e,this.resolve=Wy(CI,rt),this.reject=Wy(Ky,rt)},_N.f=AI=function(_e){return _e===zT||_e===void 0?new pN(_e):FH(_e)}),bH({global:!0,constructor:!0,wrap:!0,forced:EN},{Promise:zT}),wH(zT,uR,!1,!0),IH(uR);var RN=xo("iterator"),wN=!1;try{var HH=0,IN={next:function(){return{done:!!HH++}},return:function(){wN=!0}};IN[RN]=function(){return this},Array.from(IN,function(){throw 2})}catch{}var jH=o0,zH=function(_e,rt){try{if(!rt&&!wN)return!1}catch{return!1}var it=!1;try{var ct={};ct[RN]=function(){return{next:function(){return{done:it=!0}}}},_e(ct)}catch{}return it},dR=HT.CONSTRUCTOR||!zH(function(_e){jH.all(_e).then(void 0,function(){})}),WH=Pn,KH=bo,YH=w_,XH=zy,qH=ku;Ko({target:"Promise",stat:!0,forced:dR},{all:function(_e){var rt=this,it=YH.f(rt),ct=it.resolve,ut=it.reject,pt=XH(function(){var mt=KH(rt.resolve),_t=[],vt=0,Tt=1;qH(_e,function(bt){var Ot=vt++,Mt=!1;Tt++,WH(mt,rt,bt).then(function(Dt){Mt||(Mt=!0,_t[Ot]=Dt,--Tt||ct(_t))},ut)}),--Tt||ct(_t)});return pt.error&&ut(pt.value),it.promise}});var JH=Ko,ZH=HT.CONSTRUCTOR;o0&&o0.prototype,JH({target:"Promise",proto:!0,forced:ZH,real:!0},{catch:function(_e){return this.then(void 0,_e)}});var QH=Pn,_j=bo,$j=w_,e6=zy,t6=ku;Ko({target:"Promise",stat:!0,forced:dR},{race:function(_e){var rt=this,it=$j.f(rt),ct=it.reject,ut=e6(function(){var pt=_j(rt.resolve);t6(_e,function(mt){QH(pt,rt,mt).then(it.resolve,ct)})});return ut.error&&ct(ut.value),it.promise}});var n6=w_;Ko({target:"Promise",stat:!0,forced:HT.CONSTRUCTOR},{reject:function(_e){var rt=n6.f(this);return(0,rt.reject)(_e),rt.promise}});var r6=Gl,i6=Wn,o6=w_,xN=function(_e,rt){if(r6(_e),i6(rt)&&rt.constructor===_e)return rt;var it=o6.f(_e);return(0,it.resolve)(rt),it.promise},s6=Ko,a6=o0,c6=HT.CONSTRUCTOR,l6=xN,u6=sn("Promise"),d6=!c6;s6({target:"Promise",stat:!0,forced:!0},{resolve:function(_e){return l6(d6&&this===u6?a6:this,_e)}});var h6=Pn,p6=bo,f6=w_,m6=zy,g6=ku;Ko({target:"Promise",stat:!0,forced:dR},{allSettled:function(_e){var rt=this,it=f6.f(rt),ct=it.resolve,ut=it.reject,pt=m6(function(){var mt=p6(rt.resolve),_t=[],vt=0,Tt=1;g6(_e,function(bt){var Ot=vt++,Mt=!1;Tt++,h6(mt,rt,bt).then(function(Dt){Mt||(Mt=!0,_t[Ot]={status:"fulfilled",value:Dt},--Tt||ct(_t))},function(Dt){Mt||(Mt=!0,_t[Ot]={status:"rejected",reason:Dt},--Tt||ct(_t))})}),--Tt||ct(_t)});return pt.error&&ut(pt.value),it.promise}});var _6=Pn,E6=bo,v6=sn,y6=w_,S6=zy,T6=ku,ON="No one promise resolved";Ko({target:"Promise",stat:!0,forced:dR},{any:function(_e){var rt=this,it=v6("AggregateError"),ct=y6.f(rt),ut=ct.resolve,pt=ct.reject,mt=S6(function(){var _t=E6(rt.resolve),vt=[],Tt=0,bt=1,Ot=!1;T6(_e,function(Mt){var Dt=Tt++,jt=!1;bt++,_6(_t,rt,Mt).then(function($t){jt||Ot||(Ot=!0,ut($t))},function($t){jt||Ot||(jt=!0,vt[Dt]=$t,--bt||pt(new it(vt,ON)))})}),--bt||pt(new it(vt,ON))});return mt.error&&pt(mt.value),ct.promise}});var A6=Ko,C6=Nt,b6=KE,R6=w_,w6=bo,MN=zy,bI=wt.Promise,PN=!1;A6({target:"Promise",stat:!0,forced:!bI||!bI.try||MN(function(){bI.try(function(_e){PN=_e===8},8)}).error||!PN},{try:function(_e){var rt=arguments.length>1?b6(arguments,1):[],it=R6.f(this),ct=MN(function(){return C6(w6(_e),void 0,rt)});return(ct.error?it.reject:it.resolve)(ct.value),it.promise}});var I6=w_;Ko({target:"Promise",stat:!0},{withResolvers:function(){var _e=I6.f(this);return{promise:_e.promise,resolve:_e.resolve,reject:_e.reject}}});var x6=Ko,RI=o0,O6=at,M6=sn,P6=an,N6=tI,NN=xN,D6=RI&&RI.prototype;x6({target:"Promise",proto:!0,real:!0,forced:!!RI&&O6(function(){D6.finally.call({then:function(){}},function(){})})},{finally:function(_e){var rt=N6(this,M6("Promise")),it=P6(_e);return this.then(it?function(ct){return NN(rt,_e()).then(function(){return ct})}:_e,it?function(ct){return NN(rt,_e()).then(function(){throw ct})}:_e)}});var wI=Et,L6=ME,k6=Ku,U6=wn,B6=wI("".charAt),DN=wI("".charCodeAt),F6=wI("".slice),LN=function(_e){return function(rt,it){var ct,ut,pt=k6(U6(rt)),mt=L6(it),_t=pt.length;return mt<0||mt>=_t?_e?"":void 0:(ct=DN(pt,mt))<55296||ct>56319||mt+1===_t||(ut=DN(pt,mt+1))<56320||ut>57343?_e?B6(pt,mt):ct:_e?F6(pt,mt,mt+2):ut-56320+(ct-55296<<10)+65536}},II={codeAt:LN(!1),charAt:LN(!0)},V6=II.charAt,G6=Ku,kN=Ym,$6=MP,UN=tR,BN="String Iterator",H6=kN.set,j6=kN.getterFor(BN);$6(String,"String",function(_e){H6(this,{type:BN,string:G6(_e),index:0})},function(){var _e,rt=j6(this),it=rt.string,ct=rt.index;return ct>=it.length?UN(void 0,!0):(_e=V6(it,ct),rt.index+=_e.length,UN(_e,!1))});var z6=rr.Promise,W6={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},K6=wt,Y6=er,FN=T_;for(var xI in W6)Y6(K6[xI],xI),FN[xI]=FN.Array;var VN=z6,Ir=st(VN),X6=tp("Array","values"),q6=bu,J6=$r,Z6=yt,Q6=X6,OI=Array.prototype,ez={DOMTokenList:!0,NodeList:!0},tz=function(_e){var rt=_e.values;return _e===OI||Z6(OI,_e)&&rt===OI.values||J6(ez,q6(_e))?Q6:rt},Sp=st(tz),GN=Jo,nz=TypeError,$N=KE,rz=Math.floor,MI=function(_e,rt){var it=_e.length;if(it<8)for(var ct,ut,pt=1;pt<it;){for(ut=pt,ct=_e[pt];ut&&rt(_e[ut-1],ct)>0;)_e[ut]=_e[--ut];ut!==pt++&&(_e[ut]=ct)}else for(var mt=rz(it/2),_t=MI($N(_e,0,mt),rt),vt=MI($N(_e,mt),rt),Tt=_t.length,bt=vt.length,Ot=0,Mt=0;Ot<Tt||Mt<bt;)_e[Ot+Mt]=Ot<Tt&&Mt<bt?rt(_t[Ot],vt[Mt])<=0?_t[Ot++]:vt[Mt++]:Ot<Tt?_t[Ot++]:vt[Mt++];return _e},HN=MI,jN=lr.match(/firefox\/(\d+)/i),iz=!!jN&&+jN[1],oz=/MSIE|Trident/.test(lr),zN=lr.match(/AppleWebKit\/(\d+)\./),sz=!!zN&&+zN[1],az=Ko,WN=Et,cz=bo,lz=wr,KN=hm,uz=function(_e,rt){if(!delete _e[rt])throw new nz("Cannot delete property "+GN(rt)+" of "+GN(_e))},YN=Ku,PI=at,dz=HN,hz=Dv,XN=iz,fz=oz,qN=Nr,JN=sz,XE=[],ZN=WN(XE.sort),mz=WN(XE.push),gz=PI(function(){XE.sort(void 0)}),Ez=PI(function(){XE.sort(null)}),vz=hz("sort"),QN=!PI(function(){if(qN)return qN<70;if(!(XN&&XN>3)){if(fz)return!0;if(JN)return JN<603;var _e,rt,it,ct,ut="";for(_e=65;_e<76;_e++){switch(rt=String.fromCharCode(_e),_e){case 66:case 69:case 70:case 72:it=3;break;case 68:case 71:it=4;break;default:it=2}for(ct=0;ct<47;ct++)XE.push({k:rt+ct,v:it})}for(XE.sort(function(pt,mt){return mt.v-pt.v}),ct=0;ct<XE.length;ct++)rt=XE[ct].k.charAt(0),ut.charAt(ut.length-1)!==rt&&(ut+=rt);return ut!=="DGBEFHACIJK"}});az({target:"Array",proto:!0,forced:gz||!Ez||!vz||!QN},{sort:function(_e){_e!==void 0&&cz(_e);var rt=lz(this);if(QN)return _e===void 0?ZN(rt):ZN(rt,_e);var it,ct,ut=[],pt=KN(rt);for(ct=0;ct<pt;ct++)ct in rt&&mz(ut,rt[ct]);for(dz(ut,function(mt){return function(_t,vt){return vt===void 0?-1:_t===void 0?1:mt!==void 0?+mt(_t,vt)||0:YN(_t)>YN(vt)?1:-1}}(_e)),it=KN(ut),ct=0;ct<it;)rt[ct]=ut[ct++];for(;ct<pt;)uz(rt,ct++);return rt}});var yz=tp("Array","sort"),Sz=yt,Tz=yz,NI=Array.prototype,Az=function(_e){var rt=_e.sort;return _e===NI||Sz(NI,_e)&&rt===NI.sort?Tz:rt},s0=st(Az),Cz=Ko,bz=Et,Rz=$m,wz=RangeError,eD=String.fromCharCode,tD=String.fromCodePoint,Iz=bz([].join);Cz({target:"String",stat:!0,arity:1,forced:!!tD&&tD.length!==1},{fromCodePoint:function(_e){for(var rt,it=[],ct=arguments.length,ut=0;ct>ut;){if(rt=+arguments[ut++],Rz(rt,1114111)!==rt)throw new wz(rt+" is not a valid code point");it[ut]=rt<65536?eD(rt):eD(55296+((rt-=65536)>>10),rt%1024+56320)}return Iz(it,"")}});var xz=at,Oz=xo("iterator"),hR=!xz(function(){var _e=new URL("b?a=1&b=2&c=3","https://a"),rt=_e.searchParams,it=new URLSearchParams("a=1&a=2&b=3"),ct="";return _e.pathname="c%20d",rt.forEach(function(ut,pt){rt.delete("b"),ct+=pt+ut}),it.delete("a",2),it.delete("b",void 0),!_e.toJSON||!it.has("a",1)||it.has("a",2)||!it.has("a",void 0)||it.has("b")||!rt.size&&!0||!rt.sort||_e.href!=="https://a/c%20d?a=1&c=3"||rt.get("c")!=="3"||String(new URLSearchParams("?a=1"))!=="a=1"||!rt[Oz]||new URL("https://a@b").username!=="a"||new URLSearchParams(new URLSearchParams("a=b")).get("a")!=="b"||new URL("https://").host!=="xn--e1aybc"||new URL("https://a#").hash!=="#%D0%B1"||ct!=="a1c3"||new URL("https://x",void 0).host!=="x"}),Mz=b_,DI=Ko,nD=wt,LI=QP,Pz=sn,pR=Pn,Xm=Et,WT=dn,rD=hR,iD=b_,Nz=rR,Dz=function(_e,rt,it){for(var ct in rt)it&&it.unsafe&&_e[ct]?_e[ct]=rt[ct]:Mz(_e,ct,rt[ct],it);return _e},Lz=er,kz=eu,kI=Ym,oD=J1,BI=an,Uz=$r,Bz=au,Fz=bu,Vz=Gl,sD=Wn,Tp=Ku,Gz=zv,aD=bn,cD=qv,$z=Ql,fR=tR,Yy=i0,Hz=HN,jz=xo("iterator"),Xy="URLSearchParams",lD=Xy+"Iterator",uD=kI.set,mm=kI.getterFor(Xy),zz=kI.getterFor(lD),dD=LI("fetch"),mR=LI("Request"),KT=LI("Headers"),FI=mR&&mR.prototype,hD=KT&&KT.prototype,Wz=nD.TypeError,Kz=nD.encodeURIComponent,Yz=String.fromCharCode,Xz=Pz("String","fromCodePoint"),qz=parseInt,gR=Xm("".charAt),pD=Xm([].join),qE=Xm([].push),fD=Xm("".replace),Jz=Xm([].shift),mD=Xm([].splice),gD=Xm("".split),_D=Xm("".slice),Zz=Xm(/./.exec),Qz=/\+/g,e8=/^[0-9a-f]+$/i,ED=function(_e,rt){var it=_D(_e,rt,rt+2);return Zz(e8,it)?qz(it,16):NaN},t8=function(_e){for(var rt=0,it=128;it>0&&_e&it;it>>=1)rt++;return rt},n8=function(_e){var rt=null;switch(_e.length){case 1:rt=_e[0];break;case 2:rt=(31&_e[0])<<6|63&_e[1];break;case 3:rt=(15&_e[0])<<12|(63&_e[1])<<6|63&_e[2];break;case 4:rt=(7&_e[0])<<18|(63&_e[1])<<12|(63&_e[2])<<6|63&_e[3]}return rt>1114111?null:rt},vD=function(_e){for(var rt=(_e=fD(_e,Qz," ")).length,it="",ct=0;ct<rt;){var ut=gR(_e,ct);if(ut==="%"){if(gR(_e,ct+1)==="%"||ct+3>rt){it+="%",ct++;continue}var pt=ED(_e,ct+1);if(pt!=pt){it+=ut,ct++;continue}ct+=2;var mt=t8(pt);if(mt===0)ut=Yz(pt);else{if(mt===1||mt>4){it+="",ct++;continue}for(var _t=[pt],vt=1;vt<mt&&!(++ct+3>rt||gR(_e,ct)!=="%");){var Tt=ED(_e,ct+1);if(Tt!=Tt){ct+=3;break}if(Tt>191||Tt<128)break;qE(_t,Tt),ct+=2,vt++}if(_t.length!==mt){it+="";continue}var bt=n8(_t);bt===null?it+="":ut=Xz(bt)}}it+=ut,ct++}return it},r8=/[!'()~]|%20/g,i8={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},o8=function(_e){return i8[_e]},yD=function(_e){return fD(Kz(_e),r8,o8)},VI=kz(function(_e,rt){uD(this,{type:lD,target:mm(_e).entries,index:0,kind:rt})},Xy,function(){var _e=zz(this),rt=_e.target,it=_e.index++;if(!rt||it>=rt.length)return _e.target=null,fR(void 0,!0);var ct=rt[it];switch(_e.kind){case"keys":return fR(ct.key,!1);case"values":return fR(ct.value,!1)}return fR([ct.key,ct.value],!1)},!0),SD=function(_e){this.entries=[],this.url=null,_e!==void 0&&(sD(_e)?this.parseObject(_e):this.parseQuery(typeof _e=="string"?gR(_e,0)==="?"?_D(_e,1):_e:Tp(_e)))};SD.prototype={type:Xy,bindURL:function(_e){this.url=_e,this.update()},parseObject:function(_e){var rt,it,ct,ut,pt,mt,_t,vt=this.entries,Tt=$z(_e);if(Tt)for(it=(rt=cD(_e,Tt)).next;!(ct=pR(it,rt)).done;){if(pt=(ut=cD(Vz(ct.value))).next,(mt=pR(pt,ut)).done||(_t=pR(pt,ut)).done||!pR(pt,ut).done)throw new Wz("Expected sequence with length 2");qE(vt,{key:Tp(mt.value),value:Tp(_t.value)})}else for(var bt in _e)Uz(_e,bt)&&qE(vt,{key:bt,value:Tp(_e[bt])})},parseQuery:function(_e){if(_e)for(var rt,it,ct=this.entries,ut=gD(_e,"&"),pt=0;pt<ut.length;)(rt=ut[pt++]).length&&(it=gD(rt,"="),qE(ct,{key:vD(Jz(it)),value:vD(pD(it,"="))}))},serialize:function(){for(var _e,rt=this.entries,it=[],ct=0;ct<rt.length;)_e=rt[ct++],qE(it,yD(_e.key)+"="+yD(_e.value));return pD(it,"&")},update:function(){this.entries.length=0,this.parseQuery(this.url.query)},updateURL:function(){this.url&&this.url.update()}};var _R=function(){oD(this,qy);var _e=uD(this,new SD(arguments.length>0?arguments[0]:void 0));WT||(this.size=_e.entries.length)},qy=_R.prototype;if(Dz(qy,{append:function(_e,rt){var it=mm(this);Yy(arguments.length,2),qE(it.entries,{key:Tp(_e),value:Tp(rt)}),WT||this.length++,it.updateURL()},delete:function(_e){for(var rt=mm(this),it=Yy(arguments.length,1),ct=rt.entries,ut=Tp(_e),pt=it<2?void 0:arguments[1],mt=pt===void 0?pt:Tp(pt),_t=0;_t<ct.length;){var vt=ct[_t];if(vt.key!==ut||mt!==void 0&&vt.value!==mt)_t++;else if(mD(ct,_t,1),mt!==void 0)break}WT||(this.size=ct.length),rt.updateURL()},get:function(_e){var rt=mm(this).entries;Yy(arguments.length,1);for(var it=Tp(_e),ct=0;ct<rt.length;ct++)if(rt[ct].key===it)return rt[ct].value;return null},getAll:function(_e){var rt=mm(this).entries;Yy(arguments.length,1);for(var it=Tp(_e),ct=[],ut=0;ut<rt.length;ut++)rt[ut].key===it&&qE(ct,rt[ut].value);return ct},has:function(_e){for(var rt=mm(this).entries,it=Yy(arguments.length,1),ct=Tp(_e),ut=it<2?void 0:arguments[1],pt=ut===void 0?ut:Tp(ut),mt=0;mt<rt.length;){var _t=rt[mt++];if(_t.key===ct&&(pt===void 0||_t.value===pt))return!0}return!1},set:function(_e,rt){var it=mm(this);Yy(arguments.length,1);for(var ct,ut=it.entries,pt=!1,mt=Tp(_e),_t=Tp(rt),vt=0;vt<ut.length;vt++)(ct=ut[vt]).key===mt&&(pt?mD(ut,vt--,1):(pt=!0,ct.value=_t));pt||qE(ut,{key:mt,value:_t}),WT||(this.size=ut.length),it.updateURL()},sort:function(){var _e=mm(this);Hz(_e.entries,function(rt,it){return rt.key>it.key?1:-1}),_e.updateURL()},forEach:function(_e){for(var rt,it=mm(this).entries,ct=Bz(_e,arguments.length>1?arguments[1]:void 0),ut=0;ut<it.length;)ct((rt=it[ut++]).value,rt.key,this)},keys:function(){return new VI(this,"keys")},values:function(){return new VI(this,"values")},entries:function(){return new VI(this,"entries")}},{enumerable:!0}),iD(qy,jz,qy.entries,{name:"entries"}),iD(qy,"toString",function(){return mm(this).serialize()},{enumerable:!0}),WT&&Nz(qy,"size",{get:function(){return mm(this).entries.length},configurable:!0,enumerable:!0}),Lz(_R,Xy),DI({global:!0,constructor:!0,forced:!rD},{URLSearchParams:_R}),!rD&&BI(KT)){var s8=Xm(hD.has),a8=Xm(hD.set),TD=function(_e){if(sD(_e)){var rt,it=_e.body;if(Fz(it)===Xy)return rt=_e.headers?new KT(_e.headers):new KT,s8(rt,"content-type")||a8(rt,"content-type","application/x-www-form-urlencoded;charset=UTF-8"),Gz(_e,{body:aD(0,Tp(it)),headers:aD(0,rt)})}return _e};if(BI(dD)&&DI({global:!0,enumerable:!0,dontCallGetSet:!0,forced:!0},{fetch:function(_e){return dD(_e,arguments.length>1?TD(arguments[1]):{})}}),BI(mR)){var GI=function(_e){return oD(this,FI),new mR(_e,arguments.length>1?TD(arguments[1]):{})};FI.constructor=GI,GI.prototype=FI,DI({global:!0,constructor:!0,dontCallGetSet:!0,forced:!0},{Request:GI})}}var gm,c8={URLSearchParams:_R,getState:mm},l8=rr.URLSearchParams,AD=dn,d8=Et,h8=Pn,p8=at,$I=nE,f8=GE,m8=yn,g8=wr,_8=qn,Jy=Object.assign,CD=Object.defineProperty,E8=d8([].concat),v8=!Jy||p8(function(){if(AD&&Jy({b:1},Jy(CD({},"a",{enumerable:!0,get:function(){CD(this,"b",{value:3,enumerable:!1})}}),{b:2})).b!==1)return!0;var _e={},rt={},it=Symbol("assign detection"),ct="abcdefghijklmnopqrst";return _e[it]=7,ct.split("").forEach(function(ut){rt[ut]=ut}),Jy({},_e)[it]!==7||$I(Jy({},rt)).join("")!==ct})?function(_e,rt){for(var it=g8(_e),ct=arguments.length,ut=1,pt=f8.f,mt=m8.f;ct>ut;)for(var _t,vt=_8(arguments[ut++]),Tt=pt?E8($I(vt),pt(vt)):$I(vt),bt=Tt.length,Ot=0;bt>Ot;)_t=Tt[Ot++],AD&&!h8(mt,vt,_t)||(it[_t]=vt[_t]);return it}:Jy,y8=Gl,S8=xy,T8=dn,A8=Mu,C8=bn,HI=function(_e,rt,it){T8?A8.f(_e,rt,C8(0,it)):_e[rt]=it},b8=au,R8=Pn,w8=wr,I8=function(_e,rt,it,ct){try{return ct?rt(y8(it)[0],it[1]):rt(it)}catch(ut){S8(_e,"throw",ut)}},x8=Yv,O8=iR,M8=hm,bD=HI,P8=qv,N8=Ql,RD=Array,a0=Et,jI=2147483647,D8=/[^\0-\u007E]/,wD=/[.\u3002\uFF0E\uFF61]/g,ID="Overflow: input needs wider integers to process",xD=RangeError,L8=a0(wD.exec),Zy=Math.floor,zI=String.fromCharCode,OD=a0("".charCodeAt),MD=a0([].join),JE=a0([].push),k8=a0("".replace),U8=a0("".split),B8=a0("".toLowerCase),PD=function(_e){return _e+22+75*(_e<26)},F8=function(_e,rt,it){var ct=0;for(_e=it?Zy(_e/700):_e>>1,_e+=Zy(_e/rt);_e>455;)_e=Zy(_e/35),ct+=36;return Zy(ct+36*_e/(_e+38))},V8=function(_e){var rt=[];_e=function(en){for(var Qt=[],on=0,Tn=en.length;on<Tn;){var vn=OD(en,on++);if(vn>=55296&&vn<=56319&&on<Tn){var hn=OD(en,on++);(64512&hn)==56320?JE(Qt,((1023&vn)<<10)+(1023&hn)+65536):(JE(Qt,vn),on--)}else JE(Qt,vn)}return Qt}(_e);var it,ct,ut=_e.length,pt=128,mt=0,_t=72;for(it=0;it<_e.length;it++)(ct=_e[it])<128&&JE(rt,zI(ct));var vt=rt.length,Tt=vt;for(vt&&JE(rt,"-");Tt<ut;){var bt=jI;for(it=0;it<_e.length;it++)(ct=_e[it])>=pt&&ct<bt&&(bt=ct);var Ot=Tt+1;if(bt-pt>Zy((jI-mt)/Ot))throw new xD(ID);for(mt+=(bt-pt)*Ot,pt=bt,it=0;it<_e.length;it++){if((ct=_e[it])<pt&&++mt>jI)throw new xD(ID);if(ct===pt){for(var Mt=mt,Dt=36;;){var jt=Dt<=_t?1:Dt>=_t+26?26:Dt-_t;if(Mt<jt)break;var $t=Mt-jt,Ht=36-jt;JE(rt,zI(PD(jt+$t%Ht))),Mt=Zy($t/Ht),Dt+=36}JE(rt,zI(PD(Mt))),_t=F8(mt,Ot,Tt===vt),mt=0,Tt++}}mt++,pt++}return MD(rt,"")},G8=Ko,WI=dn,$8=hR,KI=wt,ND=au,_m=Et,ER=b_,Em=rR,H8=J1,YI=$r,XI=v8,Qy=function(_e){var rt=w8(_e),it=O8(this),ct=arguments.length,ut=ct>1?arguments[1]:void 0,pt=ut!==void 0;pt&&(ut=b8(ut,ct>2?arguments[2]:void 0));var mt,_t,vt,Tt,bt,Ot,Mt=N8(rt),Dt=0;if(!Mt||this===RD&&x8(Mt))for(mt=M8(rt),_t=it?new this(mt):RD(mt);mt>Dt;Dt++)Ot=pt?ut(rt[Dt],Dt):rt[Dt],bD(_t,Dt,Ot);else for(_t=it?new this:[],bt=(Tt=P8(rt,Mt)).next;!(vt=R8(bt,Tt)).done;Dt++)Ot=pt?I8(Tt,ut,[vt.value,Dt],!0):vt.value,bD(_t,Dt,Ot);return _t.length=Dt,_t},qm=KE,j8=II.codeAt,z8=function(_e){var rt,it,ct=[],ut=U8(k8(B8(_e),wD,"."),".");for(rt=0;rt<ut.length;rt++)it=ut[rt],JE(ct,L8(D8,it)?"xn--"+V8(it):it);return MD(ct,".")},cE=Ku,W8=er,K8=i0,DD=c8,LD=Ym,Y8=LD.set,vR=LD.getterFor("URL"),X8=DD.URLSearchParams,q8=DD.getState,YT=KI.URL,qI=KI.TypeError,yR=KI.parseInt,J8=Math.floor,kD=Math.pow,vm=_m("".charAt),Jm=_m(/./.exec),XT=_m([].join),Z8=_m(1 .toString),Q8=_m([].pop),eS=_m([].push),JI=_m("".replace),eW=_m([].shift),tW=_m("".split),qT=_m("".slice),SR=_m("".toLowerCase),nW=_m([].unshift),ZI="Invalid scheme",c0="Invalid host",UD="Invalid port",BD=/[a-z]/i,rW=/[\d+-.a-z]/i,QI=/\d/,iW=/^0x/i,oW=/^[0-7]+$/,sW=/^\d+$/,FD=/^[\da-f]+$/i,aW=/[\0\t\n\r #%/:<>?@[\\\]^|]/,cW=/[\0\t\n\r #/:<>?@[\\\]^|]/,lW=/^[\u0000-\u0020]+/,uW=/(^|[^\u0000-\u0020])[\u0000-\u0020]+$/,dW=/[\t\n\r]/g,JT=function(_e){var rt,it,ct,ut;if(typeof _e=="number"){for(rt=[],it=0;it<4;it++)nW(rt,_e%256),_e=J8(_e/256);return XT(rt,".")}if(typeof _e=="object"){for(rt="",ct=function(pt){for(var mt=null,_t=1,vt=null,Tt=0,bt=0;bt<8;bt++)pt[bt]!==0?(Tt>_t&&(mt=vt,_t=Tt),vt=null,Tt=0):(vt===null&&(vt=bt),++Tt);return Tt>_t?vt:mt}(_e),it=0;it<8;it++)ut&&_e[it]===0||(ut&&(ut=!1),ct===it?(rt+=it?":":"::",ut=!0):(rt+=Z8(_e[it],16),it<7&&(rt+=":")));return"["+rt+"]"}return _e},TR={},VD=XI({},TR,{" ":1,'"':1,"<":1,">":1,"`":1}),GD=XI({},VD,{"#":1,"?":1,"{":1,"}":1}),ex=XI({},GD,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),ZE=function(_e,rt){var it=j8(_e,0);return it>32&&it<127&&!YI(rt,_e)?_e:encodeURIComponent(_e)},AR={ftp:21,file:null,http:80,https:443,ws:80,wss:443},ZT=function(_e,rt){var it;return _e.length===2&&Jm(BD,vm(_e,0))&&((it=vm(_e,1))===":"||!rt&&it==="|")},$D=function(_e){var rt;return _e.length>1&&ZT(qT(_e,0,2))&&(_e.length===2||(rt=vm(_e,2))==="/"||rt==="\\"||rt==="?"||rt==="#")},hW=function(_e){return _e==="."||SR(_e)==="%2e"},tx={},HD={},nx={},jD={},zD={},rx={},WD={},KD={},CR={},bR={},ix={},ox={},sx={},ax={},YD={},cx={},tS={},I_={},XD={},l0={},lE={},lx=function(_e,rt,it){var ct,ut,pt,mt=cE(_e);if(rt){if(ut=this.parse(mt))throw new qI(ut);this.searchParams=null}else{if(it!==void 0&&(ct=new lx(it,!0)),ut=this.parse(mt,null,ct))throw new qI(ut);(pt=q8(new X8)).bindURL(this),this.searchParams=pt}};lx.prototype={type:"URL",parse:function(_e,rt,it){var ct,ut,pt,mt,_t,vt=this,Tt=rt||tx,bt=0,Ot="",Mt=!1,Dt=!1,jt=!1;for(_e=cE(_e),rt||(vt.scheme="",vt.username="",vt.password="",vt.host=null,vt.port=null,vt.path=[],vt.query=null,vt.fragment=null,vt.cannotBeABaseURL=!1,_e=JI(_e,lW,""),_e=JI(_e,uW,"$1")),_e=JI(_e,dW,""),ct=Qy(_e);bt<=ct.length;){switch(ut=ct[bt],Tt){case tx:if(!ut||!Jm(BD,ut)){if(rt)return ZI;Tt=nx;continue}Ot+=SR(ut),Tt=HD;break;case HD:if(ut&&(Jm(rW,ut)||ut==="+"||ut==="-"||ut==="."))Ot+=SR(ut);else{if(ut!==":"){if(rt)return ZI;Ot="",Tt=nx,bt=0;continue}if(rt&&(vt.isSpecial()!==YI(AR,Ot)||Ot==="file"&&(vt.includesCredentials()||vt.port!==null)||vt.scheme==="file"&&!vt.host))return;if(vt.scheme=Ot,rt)return void(vt.isSpecial()&&AR[vt.scheme]===vt.port&&(vt.port=null));Ot="",vt.scheme==="file"?Tt=ax:vt.isSpecial()&&it&&it.scheme===vt.scheme?Tt=jD:vt.isSpecial()?Tt=KD:ct[bt+1]==="/"?(Tt=zD,bt++):(vt.cannotBeABaseURL=!0,eS(vt.path,""),Tt=XD)}break;case nx:if(!it||it.cannotBeABaseURL&&ut!=="#")return ZI;if(it.cannotBeABaseURL&&ut==="#"){vt.scheme=it.scheme,vt.path=qm(it.path),vt.query=it.query,vt.fragment="",vt.cannotBeABaseURL=!0,Tt=lE;break}Tt=it.scheme==="file"?ax:rx;continue;case jD:if(ut!=="/"||ct[bt+1]!=="/"){Tt=rx;continue}Tt=CR,bt++;break;case zD:if(ut==="/"){Tt=bR;break}Tt=I_;continue;case rx:if(vt.scheme=it.scheme,ut===gm)vt.username=it.username,vt.password=it.password,vt.host=it.host,vt.port=it.port,vt.path=qm(it.path),vt.query=it.query;else if(ut==="/"||ut==="\\"&&vt.isSpecial())Tt=WD;else if(ut==="?")vt.username=it.username,vt.password=it.password,vt.host=it.host,vt.port=it.port,vt.path=qm(it.path),vt.query="",Tt=l0;else{if(ut!=="#"){vt.username=it.username,vt.password=it.password,vt.host=it.host,vt.port=it.port,vt.path=qm(it.path),vt.path.length--,Tt=I_;continue}vt.username=it.username,vt.password=it.password,vt.host=it.host,vt.port=it.port,vt.path=qm(it.path),vt.query=it.query,vt.fragment="",Tt=lE}break;case WD:if(!vt.isSpecial()||ut!=="/"&&ut!=="\\"){if(ut!=="/"){vt.username=it.username,vt.password=it.password,vt.host=it.host,vt.port=it.port,Tt=I_;continue}Tt=bR}else Tt=CR;break;case KD:if(Tt=CR,ut!=="/"||vm(Ot,bt+1)!=="/")continue;bt++;break;case CR:if(ut!=="/"&&ut!=="\\"){Tt=bR;continue}break;case bR:if(ut==="@"){Mt&&(Ot="%40"+Ot),Mt=!0,pt=Qy(Ot);for(var $t=0;$t<pt.length;$t++){var Ht=pt[$t];if(Ht!==":"||jt){var en=ZE(Ht,ex);jt?vt.password+=en:vt.username+=en}else jt=!0}Ot=""}else if(ut===gm||ut==="/"||ut==="?"||ut==="#"||ut==="\\"&&vt.isSpecial()){if(Mt&&Ot==="")return"Invalid authority";bt-=Qy(Ot).length+1,Ot="",Tt=ix}else Ot+=ut;break;case ix:case ox:if(rt&&vt.scheme==="file"){Tt=cx;continue}if(ut!==":"||Dt){if(ut===gm||ut==="/"||ut==="?"||ut==="#"||ut==="\\"&&vt.isSpecial()){if(vt.isSpecial()&&Ot==="")return c0;if(rt&&Ot===""&&(vt.includesCredentials()||vt.port!==null))return;if(mt=vt.parseHost(Ot))return mt;if(Ot="",Tt=tS,rt)return;continue}ut==="["?Dt=!0:ut==="]"&&(Dt=!1),Ot+=ut}else{if(Ot==="")return c0;if(mt=vt.parseHost(Ot))return mt;if(Ot="",Tt=sx,rt===ox)return}break;case sx:if(!Jm(QI,ut)){if(ut===gm||ut==="/"||ut==="?"||ut==="#"||ut==="\\"&&vt.isSpecial()||rt){if(Ot!==""){var Qt=yR(Ot,10);if(Qt>65535)return UD;vt.port=vt.isSpecial()&&Qt===AR[vt.scheme]?null:Qt,Ot=""}if(rt)return;Tt=tS;continue}return UD}Ot+=ut;break;case ax:if(vt.scheme="file",ut==="/"||ut==="\\")Tt=YD;else{if(!it||it.scheme!=="file"){Tt=I_;continue}switch(ut){case gm:vt.host=it.host,vt.path=qm(it.path),vt.query=it.query;break;case"?":vt.host=it.host,vt.path=qm(it.path),vt.query="",Tt=l0;break;case"#":vt.host=it.host,vt.path=qm(it.path),vt.query=it.query,vt.fragment="",Tt=lE;break;default:$D(XT(qm(ct,bt),""))||(vt.host=it.host,vt.path=qm(it.path),vt.shortenPath()),Tt=I_;continue}}break;case YD:if(ut==="/"||ut==="\\"){Tt=cx;break}it&&it.scheme==="file"&&!$D(XT(qm(ct,bt),""))&&(ZT(it.path[0],!0)?eS(vt.path,it.path[0]):vt.host=it.host),Tt=I_;continue;case cx:if(ut===gm||ut==="/"||ut==="\\"||ut==="?"||ut==="#"){if(!rt&&ZT(Ot))Tt=I_;else if(Ot===""){if(vt.host="",rt)return;Tt=tS}else{if(mt=vt.parseHost(Ot))return mt;if(vt.host==="localhost"&&(vt.host=""),rt)return;Ot="",Tt=tS}continue}Ot+=ut;break;case tS:if(vt.isSpecial()){if(Tt=I_,ut!=="/"&&ut!=="\\")continue}else if(rt||ut!=="?")if(rt||ut!=="#"){if(ut!==gm&&(Tt=I_,ut!=="/"))continue}else vt.fragment="",Tt=lE;else vt.query="",Tt=l0;break;case I_:if(ut===gm||ut==="/"||ut==="\\"&&vt.isSpecial()||!rt&&(ut==="?"||ut==="#")){if((_t=SR(_t=Ot))===".."||_t==="%2e."||_t===".%2e"||_t==="%2e%2e"?(vt.shortenPath(),ut==="/"||ut==="\\"&&vt.isSpecial()||eS(vt.path,"")):hW(Ot)?ut==="/"||ut==="\\"&&vt.isSpecial()||eS(vt.path,""):(vt.scheme==="file"&&!vt.path.length&&ZT(Ot)&&(vt.host&&(vt.host=""),Ot=vm(Ot,0)+":"),eS(vt.path,Ot)),Ot="",vt.scheme==="file"&&(ut===gm||ut==="?"||ut==="#"))for(;vt.path.length>1&&vt.path[0]==="";)eW(vt.path);ut==="?"?(vt.query="",Tt=l0):ut==="#"&&(vt.fragment="",Tt=lE)}else Ot+=ZE(ut,GD);break;case XD:ut==="?"?(vt.query="",Tt=l0):ut==="#"?(vt.fragment="",Tt=lE):ut!==gm&&(vt.path[0]+=ZE(ut,TR));break;case l0:rt||ut!=="#"?ut!==gm&&(ut==="'"&&vt.isSpecial()?vt.query+="%27":vt.query+=ut==="#"?"%23":ZE(ut,TR)):(vt.fragment="",Tt=lE);break;case lE:ut!==gm&&(vt.fragment+=ZE(ut,VD))}bt++}},parseHost:function(_e){var rt,it,ct;if(vm(_e,0)==="["){if(vm(_e,_e.length-1)!=="]"||(rt=function(ut){var pt,mt,_t,vt,Tt,bt,Ot,Mt=[0,0,0,0,0,0,0,0],Dt=0,jt=null,$t=0,Ht=function(){return vm(ut,$t)};if(Ht()===":"){if(vm(ut,1)!==":")return;$t+=2,jt=++Dt}for(;Ht();){if(Dt===8)return;if(Ht()!==":"){for(pt=mt=0;mt<4&&Jm(FD,Ht());)pt=16*pt+yR(Ht(),16),$t++,mt++;if(Ht()==="."){if(mt===0||($t-=mt,Dt>6))return;for(_t=0;Ht();){if(vt=null,_t>0){if(!(Ht()==="."&&_t<4))return;$t++}if(!Jm(QI,Ht()))return;for(;Jm(QI,Ht());){if(Tt=yR(Ht(),10),vt===null)vt=Tt;else{if(vt===0)return;vt=10*vt+Tt}if(vt>255)return;$t++}Mt[Dt]=256*Mt[Dt]+vt,++_t!=2&&_t!==4||Dt++}if(_t!==4)return;break}if(Ht()===":"){if($t++,!Ht())return}else if(Ht())return;Mt[Dt++]=pt}else{if(jt!==null)return;$t++,jt=++Dt}}if(jt!==null)for(bt=Dt-jt,Dt=7;Dt!==0&&bt>0;)Ot=Mt[Dt],Mt[Dt--]=Mt[jt+bt-1],Mt[jt+--bt]=Ot;else if(Dt!==8)return;return Mt}(qT(_e,1,-1)),!rt))return c0;this.host=rt}else if(this.isSpecial()){if(_e=z8(_e),Jm(aW,_e)||(rt=function(ut){var pt,mt,_t,vt,Tt,bt,Ot,Mt=tW(ut,".");if(Mt.length&&Mt[Mt.length-1]===""&&Mt.length--,(pt=Mt.length)>4)return ut;for(mt=[],_t=0;_t<pt;_t++){if((vt=Mt[_t])==="")return ut;if(Tt=10,vt.length>1&&vm(vt,0)==="0"&&(Tt=Jm(iW,vt)?16:8,vt=qT(vt,Tt===8?1:2)),vt==="")bt=0;else{if(!Jm(Tt===10?sW:Tt===8?oW:FD,vt))return ut;bt=yR(vt,Tt)}eS(mt,bt)}for(_t=0;_t<pt;_t++)if(bt=mt[_t],_t===pt-1){if(bt>=kD(256,5-pt))return null}else if(bt>255)return null;for(Ot=Q8(mt),_t=0;_t<mt.length;_t++)Ot+=mt[_t]*kD(256,3-_t);return Ot}(_e),rt===null))return c0;this.host=rt}else{if(Jm(cW,_e))return c0;for(rt="",it=Qy(_e),ct=0;ct<it.length;ct++)rt+=ZE(it[ct],TR);this.host=rt}},cannotHaveUsernamePasswordPort:function(){return!this.host||this.cannotBeABaseURL||this.scheme==="file"},includesCredentials:function(){return this.username!==""||this.password!==""},isSpecial:function(){return YI(AR,this.scheme)},shortenPath:function(){var _e=this.path,rt=_e.length;!rt||this.scheme==="file"&&rt===1&&ZT(_e[0],!0)||_e.length--},serialize:function(){var _e=this,rt=_e.scheme,it=_e.username,ct=_e.password,ut=_e.host,pt=_e.port,mt=_e.path,_t=_e.query,vt=_e.fragment,Tt=rt+":";return ut!==null?(Tt+="//",_e.includesCredentials()&&(Tt+=it+(ct?":"+ct:"")+"@"),Tt+=JT(ut),pt!==null&&(Tt+=":"+pt)):rt==="file"&&(Tt+="//"),Tt+=_e.cannotBeABaseURL?mt[0]:mt.length?"/"+XT(mt,"/"):"",_t!==null&&(Tt+="?"+_t),vt!==null&&(Tt+="#"+vt),Tt},setHref:function(_e){var rt=this.parse(_e);if(rt)throw new qI(rt);this.searchParams.update()},getOrigin:function(){var _e=this.scheme,rt=this.port;if(_e==="blob")try{return new nS(_e.path[0]).origin}catch{return"null"}return _e!=="file"&&this.isSpecial()?_e+"://"+JT(this.host)+(rt!==null?":"+rt:""):"null"},getProtocol:function(){return this.scheme+":"},setProtocol:function(_e){this.parse(cE(_e)+":",tx)},getUsername:function(){return this.username},setUsername:function(_e){var rt=Qy(cE(_e));if(!this.cannotHaveUsernamePasswordPort()){this.username="";for(var it=0;it<rt.length;it++)this.username+=ZE(rt[it],ex)}},getPassword:function(){return this.password},setPassword:function(_e){var rt=Qy(cE(_e));if(!this.cannotHaveUsernamePasswordPort()){this.password="";for(var it=0;it<rt.length;it++)this.password+=ZE(rt[it],ex)}},getHost:function(){var _e=this.host,rt=this.port;return _e===null?"":rt===null?JT(_e):JT(_e)+":"+rt},setHost:function(_e){this.cannotBeABaseURL||this.parse(_e,ix)},getHostname:function(){var _e=this.host;return _e===null?"":JT(_e)},setHostname:function(_e){this.cannotBeABaseURL||this.parse(_e,ox)},getPort:function(){var _e=this.port;return _e===null?"":cE(_e)},setPort:function(_e){this.cannotHaveUsernamePasswordPort()||((_e=cE(_e))===""?this.port=null:this.parse(_e,sx))},getPathname:function(){var _e=this.path;return this.cannotBeABaseURL?_e[0]:_e.length?"/"+XT(_e,"/"):""},setPathname:function(_e){this.cannotBeABaseURL||(this.path=[],this.parse(_e,tS))},getSearch:function(){var _e=this.query;return _e?"?"+_e:""},setSearch:function(_e){(_e=cE(_e))===""?this.query=null:(vm(_e,0)==="?"&&(_e=qT(_e,1)),this.query="",this.parse(_e,l0)),this.searchParams.update()},getSearchParams:function(){return this.searchParams.facade},getHash:function(){var _e=this.fragment;return _e?"#"+_e:""},setHash:function(_e){(_e=cE(_e))!==""?(vm(_e,0)==="#"&&(_e=qT(_e,1)),this.fragment="",this.parse(_e,lE)):this.fragment=null},update:function(){this.query=this.searchParams.serialize()||null}};var nS=function(_e){var rt=H8(this,Ap),it=K8(arguments.length,1)>1?arguments[1]:void 0,ct=Y8(rt,new lx(_e,!1,it));WI||(rt.href=ct.serialize(),rt.origin=ct.getOrigin(),rt.protocol=ct.getProtocol(),rt.username=ct.getUsername(),rt.password=ct.getPassword(),rt.host=ct.getHost(),rt.hostname=ct.getHostname(),rt.port=ct.getPort(),rt.pathname=ct.getPathname(),rt.search=ct.getSearch(),rt.searchParams=ct.getSearchParams(),rt.hash=ct.getHash())},Ap=nS.prototype,ym=function(_e,rt){return{get:function(){return vR(this)[_e]()},set:rt&&function(it){return vR(this)[rt](it)},configurable:!0,enumerable:!0}};if(WI&&(Em(Ap,"href",ym("serialize","setHref")),Em(Ap,"origin",ym("getOrigin")),Em(Ap,"protocol",ym("getProtocol","setProtocol")),Em(Ap,"username",ym("getUsername","setUsername")),Em(Ap,"password",ym("getPassword","setPassword")),Em(Ap,"host",ym("getHost","setHost")),Em(Ap,"hostname",ym("getHostname","setHostname")),Em(Ap,"port",ym("getPort","setPort")),Em(Ap,"pathname",ym("getPathname","setPathname")),Em(Ap,"search",ym("getSearch","setSearch")),Em(Ap,"searchParams",ym("getSearchParams")),Em(Ap,"hash",ym("getHash","setHash"))),ER(Ap,"toJSON",function(){return vR(this).serialize()},{enumerable:!0}),ER(Ap,"toString",function(){return vR(this).serialize()},{enumerable:!0}),YT){var qD=YT.createObjectURL,JD=YT.revokeObjectURL;qD&&ER(nS,"createObjectURL",ND(qD,YT)),JD&&ER(nS,"revokeObjectURL",ND(JD,YT))}W8(nS,"URL"),G8({global:!0,constructor:!0,forced:!$8,sham:!WI},{URL:nS});var pW=Ko,ZD=at,fW=i0,QD=Ku,mW=hR,ux=sn("URL"),gW=mW&&ZD(function(){ux.canParse()}),_W=ZD(function(){return ux.canParse.length!==1});pW({target:"URL",stat:!0,forced:!gW||_W},{canParse:function(_e){var rt=fW(arguments.length,1),it=QD(_e),ct=rt<2||arguments[1]===void 0?void 0:QD(arguments[1]);try{return!!new ux(it,ct)}catch{return!1}}});var EW=Ko,vW=i0,eL=Ku,yW=hR,SW=sn("URL");EW({target:"URL",stat:!0,forced:!yW},{parse:function(_e){var rt=vW(arguments.length,1),it=eL(_e),ct=rt<2||arguments[1]===void 0?void 0:eL(arguments[1]);try{return new SW(it,ct)}catch{return null}}});var RR=st(rr.URL);let tL=!0,nL=!0;function wR(_e,rt,it){const ct=_e.match(rt);return ct&&ct.length>=it&&parseInt(ct[it],10)}function u0(_e,rt,it){if(!_e.RTCPeerConnection)return;const ct=_e.RTCPeerConnection.prototype,ut=ct.addEventListener;ct.addEventListener=function(mt,_t){if(mt!==rt)return ut.apply(this,arguments);const vt=Tt=>{const bt=it(Tt);bt&&(_t.handleEvent?_t.handleEvent(bt):_t(bt))};return this._eventMap=this._eventMap||{},this._eventMap[rt]||(this._eventMap[rt]=new Map),this._eventMap[rt].set(_t,vt),ut.apply(this,[mt,vt])};const pt=ct.removeEventListener;ct.removeEventListener=function(mt,_t){if(mt!==rt||!this._eventMap||!this._eventMap[rt])return pt.apply(this,arguments);if(!this._eventMap[rt].has(_t))return pt.apply(this,arguments);const vt=this._eventMap[rt].get(_t);return this._eventMap[rt].delete(_t),this._eventMap[rt].size===0&&delete this._eventMap[rt],Object.keys(this._eventMap).length===0&&delete this._eventMap,pt.apply(this,[mt,vt])},Object.defineProperty(ct,"on"+rt,{get(){return this["_on"+rt]},set(mt){this["_on"+rt]&&(this.removeEventListener(rt,this["_on"+rt]),delete this["_on"+rt]),mt&&this.addEventListener(rt,this["_on"+rt]=mt)},enumerable:!0,configurable:!0})}function TW(_e){return typeof _e!="boolean"?new Error("Argument type: "+typeof _e+". Please use a boolean."):(tL=_e,_e?"adapter.js logging disabled":"adapter.js logging enabled")}function AW(_e){return typeof _e!="boolean"?new Error("Argument type: "+typeof _e+". Please use a boolean."):(nL=!_e,"adapter.js deprecation warnings "+(_e?"disabled":"enabled"))}function rL(){if(typeof window=="object"){if(tL)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function dx(_e,rt){nL&&console.warn(_e+" is deprecated, please use "+rt+" instead.")}function iL(_e){return Object.prototype.toString.call(_e)==="[object Object]"}function oL(_e){var rt;return iL(_e)?_p(rt=Object.keys(_e)).call(rt,function(it,ct){const ut=iL(_e[ct]),pt=ut?oL(_e[ct]):_e[ct],mt=ut&&!Object.keys(pt).length;return pt===void 0||mt?it:Object.assign(it,{[ct]:pt})},{}):_e}function hx(_e,rt,it){rt&&!it.has(rt.id)&&(it.set(rt.id,rt),Object.keys(rt).forEach(ct=>{ct.endsWith("Id")?hx(_e,_e.get(rt[ct]),it):ct.endsWith("Ids")&&rt[ct].forEach(ut=>{hx(_e,_e.get(ut),it)})}))}function sL(_e,rt,it){const ct=it?"outbound-rtp":"inbound-rtp",ut=new Map;if(rt===null)return ut;const pt=[];return _e.forEach(mt=>{mt.type==="track"&&mt.trackIdentifier===rt.id&&pt.push(mt)}),pt.forEach(mt=>{_e.forEach(_t=>{_t.type===ct&&_t.trackId===mt.id&&hx(_e,_t,ut)})}),ut}const aL=rL;function cL(_e,rt){const it=_e&&_e.navigator;if(!it.mediaDevices)return;const ct=function(mt){if(typeof mt!="object"||mt.mandatory||mt.optional)return mt;const _t={};return Object.keys(mt).forEach(vt=>{if(vt==="require"||vt==="advanced"||vt==="mediaSource")return;const Tt=typeof mt[vt]=="object"?mt[vt]:{ideal:mt[vt]};Tt.exact!==void 0&&typeof Tt.exact=="number"&&(Tt.min=Tt.max=Tt.exact);const bt=function(Ot,Mt){return Ot?Ot+Mt.charAt(0).toUpperCase()+Mt.slice(1):Mt==="deviceId"?"sourceId":Mt};if(Tt.ideal!==void 0){_t.optional=_t.optional||[];let Ot={};typeof Tt.ideal=="number"?(Ot[bt("min",vt)]=Tt.ideal,_t.optional.push(Ot),Ot={},Ot[bt("max",vt)]=Tt.ideal,_t.optional.push(Ot)):(Ot[bt("",vt)]=Tt.ideal,_t.optional.push(Ot))}Tt.exact!==void 0&&typeof Tt.exact!="number"?(_t.mandatory=_t.mandatory||{},_t.mandatory[bt("",vt)]=Tt.exact):["min","max"].forEach(Ot=>{Tt[Ot]!==void 0&&(_t.mandatory=_t.mandatory||{},_t.mandatory[bt(Ot,vt)]=Tt[Ot])})}),mt.advanced&&(_t.optional=(_t.optional||[]).concat(mt.advanced)),_t},ut=function(mt,_t){if(rt.version>=61)return _t(mt);if((mt=JSON.parse(JSON.stringify(mt)))&&typeof mt.audio=="object"){const vt=function(Tt,bt,Ot){bt in Tt&&!(Ot in Tt)&&(Tt[Ot]=Tt[bt],delete Tt[bt])};vt((mt=JSON.parse(JSON.stringify(mt))).audio,"autoGainControl","googAutoGainControl"),vt(mt.audio,"noiseSuppression","googNoiseSuppression"),mt.audio=ct(mt.audio)}if(mt&&typeof mt.video=="object"){let vt=mt.video.facingMode;vt=vt&&(typeof vt=="object"?vt:{ideal:vt});const Tt=rt.version<66;if(vt&&(vt.exact==="user"||vt.exact==="environment"||vt.ideal==="user"||vt.ideal==="environment")&&(!it.mediaDevices.getSupportedConstraints||!it.mediaDevices.getSupportedConstraints().facingMode||Tt)){let bt;if(delete mt.video.facingMode,vt.exact==="environment"||vt.ideal==="environment"?bt=["back","rear"]:vt.exact!=="user"&&vt.ideal!=="user"||(bt=["front"]),bt)return it.mediaDevices.enumerateDevices().then(Ot=>{Ot=Ot.filter(Dt=>Dt.kind==="videoinput");let Mt=Ot.find(Dt=>bt.some(jt=>{var $t;return Er($t=Dt.label.toLowerCase()).call($t,jt)}));return!Mt&&Ot.length&&Er(bt).call(bt,"back")&&(Mt=Ot[Ot.length-1]),Mt&&(mt.video.deviceId=vt.exact?{exact:Mt.deviceId}:{ideal:Mt.deviceId}),mt.video=ct(mt.video),aL("chrome: "+JSON.stringify(mt)),_t(mt)})}mt.video=ct(mt.video)}return aL("chrome: "+JSON.stringify(mt)),_t(mt)},pt=function(mt){return rt.version>=64?mt:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[mt.name]||mt.name,message:mt.message,constraint:mt.constraint||mt.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(it.getUserMedia=(function(mt,_t,vt){ut(mt,Tt=>{it.webkitGetUserMedia(Tt,_t,bt=>{vt&&vt(pt(bt))})})}).bind(it),it.mediaDevices.getUserMedia){const mt=it.mediaDevices.getUserMedia.bind(it.mediaDevices);it.mediaDevices.getUserMedia=function(_t){return ut(_t,vt=>mt(vt).then(Tt=>{if(vt.audio&&!Tt.getAudioTracks().length||vt.video&&!Tt.getVideoTracks().length)throw Tt.getTracks().forEach(bt=>{bt.stop()}),new DOMException("","NotFoundError");return Tt},Tt=>Ir.reject(pt(Tt))))}}}function lL(_e){_e.MediaStream=_e.MediaStream||_e.webkitMediaStream}function uL(_e){if(typeof _e=="object"&&_e.RTCPeerConnection&&!("ontrack"in _e.RTCPeerConnection.prototype)){Object.defineProperty(_e.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(it){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=it)},enumerable:!0,configurable:!0});const rt=_e.RTCPeerConnection.prototype.setRemoteDescription;_e.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=it=>{it.stream.addEventListener("addtrack",ct=>{let ut;ut=_e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(mt=>mt.track&&mt.track.id===ct.track.id):{track:ct.track};const pt=new Event("track");pt.track=ct.track,pt.receiver=ut,pt.transceiver={receiver:ut},pt.streams=[it.stream],this.dispatchEvent(pt)}),it.stream.getTracks().forEach(ct=>{let ut;ut=_e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(mt=>mt.track&&mt.track.id===ct.id):{track:ct};const pt=new Event("track");pt.track=ct,pt.receiver=ut,pt.transceiver={receiver:ut},pt.streams=[it.stream],this.dispatchEvent(pt)})},this.addEventListener("addstream",this._ontrackpoly)),rt.apply(this,arguments)}}else u0(_e,"track",rt=>(rt.transceiver||Object.defineProperty(rt,"transceiver",{value:{receiver:rt.receiver}}),rt))}function dL(_e){if(typeof _e=="object"&&_e.RTCPeerConnection&&!("getSenders"in _e.RTCPeerConnection.prototype)&&"createDTMFSender"in _e.RTCPeerConnection.prototype){const rt=function(ut,pt){return{track:pt,get dtmf(){return this._dtmf===void 0&&(pt.kind==="audio"?this._dtmf=ut.createDTMFSender(pt):this._dtmf=null),this._dtmf},_pc:ut}};if(!_e.RTCPeerConnection.prototype.getSenders){_e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const ut=_e.RTCPeerConnection.prototype.addTrack;_e.RTCPeerConnection.prototype.addTrack=function(mt,_t){let vt=ut.apply(this,arguments);return vt||(vt=rt(this,mt),this._senders.push(vt)),vt};const pt=_e.RTCPeerConnection.prototype.removeTrack;_e.RTCPeerConnection.prototype.removeTrack=function(mt){pt.apply(this,arguments);const _t=this._senders.indexOf(mt);_t!==-1&&this._senders.splice(_t,1)}}const it=_e.RTCPeerConnection.prototype.addStream;_e.RTCPeerConnection.prototype.addStream=function(ut){this._senders=this._senders||[],it.apply(this,[ut]),ut.getTracks().forEach(pt=>{this._senders.push(rt(this,pt))})};const ct=_e.RTCPeerConnection.prototype.removeStream;_e.RTCPeerConnection.prototype.removeStream=function(ut){this._senders=this._senders||[],ct.apply(this,[ut]),ut.getTracks().forEach(pt=>{const mt=this._senders.find(_t=>_t.track===pt);mt&&this._senders.splice(this._senders.indexOf(mt),1)})}}else if(typeof _e=="object"&&_e.RTCPeerConnection&&"getSenders"in _e.RTCPeerConnection.prototype&&"createDTMFSender"in _e.RTCPeerConnection.prototype&&_e.RTCRtpSender&&!("dtmf"in _e.RTCRtpSender.prototype)){const rt=_e.RTCPeerConnection.prototype.getSenders;_e.RTCPeerConnection.prototype.getSenders=function(){const it=rt.apply(this,[]);return it.forEach(ct=>ct._pc=this),it},Object.defineProperty(_e.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function hL(_e){if(!_e.RTCPeerConnection)return;const rt=_e.RTCPeerConnection.prototype.getStats;_e.RTCPeerConnection.prototype.getStats=function(){const[it,ct,ut]=arguments;if(arguments.length>0&&typeof it=="function")return rt.apply(this,arguments);if(rt.length===0&&(arguments.length===0||typeof it!="function"))return rt.apply(this,[]);const pt=function(_t){const vt={};return _t.result().forEach(Tt=>{const bt={id:Tt.id,timestamp:Tt.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[Tt.type]||Tt.type};Tt.names().forEach(Ot=>{bt[Ot]=Tt.stat(Ot)}),vt[bt.id]=bt}),vt},mt=function(_t){return new Map(Object.keys(_t).map(vt=>[vt,_t[vt]]))};if(arguments.length>=2){const _t=function(vt){ct(mt(pt(vt)))};return rt.apply(this,[_t,it])}return new Ir((_t,vt)=>{rt.apply(this,[function(Tt){_t(mt(pt(Tt)))},vt])}).then(ct,ut)}}function pL(_e){if(!(typeof _e=="object"&&_e.RTCPeerConnection&&_e.RTCRtpSender&&_e.RTCRtpReceiver))return;if(!("getStats"in _e.RTCRtpSender.prototype)){const it=_e.RTCPeerConnection.prototype.getSenders;it&&(_e.RTCPeerConnection.prototype.getSenders=function(){const ut=it.apply(this,[]);return ut.forEach(pt=>pt._pc=this),ut});const ct=_e.RTCPeerConnection.prototype.addTrack;ct&&(_e.RTCPeerConnection.prototype.addTrack=function(){const ut=ct.apply(this,arguments);return ut._pc=this,ut}),_e.RTCRtpSender.prototype.getStats=function(){const ut=this;return this._pc.getStats().then(pt=>sL(pt,ut.track,!0))}}if(!("getStats"in _e.RTCRtpReceiver.prototype)){const it=_e.RTCPeerConnection.prototype.getReceivers;it&&(_e.RTCPeerConnection.prototype.getReceivers=function(){const ct=it.apply(this,[]);return ct.forEach(ut=>ut._pc=this),ct}),u0(_e,"track",ct=>(ct.receiver._pc=ct.srcElement,ct)),_e.RTCRtpReceiver.prototype.getStats=function(){const ct=this;return this._pc.getStats().then(ut=>sL(ut,ct.track,!1))}}if(!("getStats"in _e.RTCRtpSender.prototype)||!("getStats"in _e.RTCRtpReceiver.prototype))return;const rt=_e.RTCPeerConnection.prototype.getStats;_e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof _e.MediaStreamTrack){const it=arguments[0];let ct,ut,pt;return this.getSenders().forEach(mt=>{mt.track===it&&(ct?pt=!0:ct=mt)}),this.getReceivers().forEach(mt=>(mt.track===it&&(ut?pt=!0:ut=mt),mt.track===it)),pt||ct&&ut?Ir.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):ct?ct.getStats():ut?ut.getStats():Ir.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return rt.apply(this,arguments)}}function fL(_e){_e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(pt=>this._shimmedLocalStreams[pt][0])};const rt=_e.RTCPeerConnection.prototype.addTrack;_e.RTCPeerConnection.prototype.addTrack=function(pt,mt){if(!mt)return rt.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const _t=rt.apply(this,arguments);return this._shimmedLocalStreams[mt.id]?this._shimmedLocalStreams[mt.id].indexOf(_t)===-1&&this._shimmedLocalStreams[mt.id].push(_t):this._shimmedLocalStreams[mt.id]=[mt,_t],_t};const it=_e.RTCPeerConnection.prototype.addStream;_e.RTCPeerConnection.prototype.addStream=function(pt){this._shimmedLocalStreams=this._shimmedLocalStreams||{},pt.getTracks().forEach(vt=>{if(this.getSenders().find(bt=>bt.track===vt))throw new DOMException("Track already exists.","InvalidAccessError")});const mt=this.getSenders();it.apply(this,arguments);const _t=this.getSenders().filter(vt=>mt.indexOf(vt)===-1);this._shimmedLocalStreams[pt.id]=[pt].concat(_t)};const ct=_e.RTCPeerConnection.prototype.removeStream;_e.RTCPeerConnection.prototype.removeStream=function(pt){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[pt.id],ct.apply(this,arguments)};const ut=_e.RTCPeerConnection.prototype.removeTrack;_e.RTCPeerConnection.prototype.removeTrack=function(pt){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},pt&&Object.keys(this._shimmedLocalStreams).forEach(mt=>{const _t=this._shimmedLocalStreams[mt].indexOf(pt);_t!==-1&&this._shimmedLocalStreams[mt].splice(_t,1),this._shimmedLocalStreams[mt].length===1&&delete this._shimmedLocalStreams[mt]}),ut.apply(this,arguments)}}function mL(_e,rt){if(!_e.RTCPeerConnection)return;if(_e.RTCPeerConnection.prototype.addTrack&&rt.version>=65)return fL(_e);const it=_e.RTCPeerConnection.prototype.getLocalStreams;_e.RTCPeerConnection.prototype.getLocalStreams=function(){const vt=it.apply(this);return this._reverseStreams=this._reverseStreams||{},vt.map(Tt=>this._reverseStreams[Tt.id])};const ct=_e.RTCPeerConnection.prototype.addStream;_e.RTCPeerConnection.prototype.addStream=function(vt){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},vt.getTracks().forEach(Tt=>{if(this.getSenders().find(Ot=>Ot.track===Tt))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[vt.id]){const Tt=new _e.MediaStream(vt.getTracks());this._streams[vt.id]=Tt,this._reverseStreams[Tt.id]=vt,vt=Tt}ct.apply(this,[vt])};const ut=_e.RTCPeerConnection.prototype.removeStream;function pt(vt,Tt){let bt=Tt.sdp;return Object.keys(vt._reverseStreams||[]).forEach(Ot=>{const Mt=vt._reverseStreams[Ot],Dt=vt._streams[Mt.id];bt=bt.replace(new RegExp(Dt.id,"g"),Mt.id)}),new RTCSessionDescription({type:Tt.type,sdp:bt})}_e.RTCPeerConnection.prototype.removeStream=function(vt){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},ut.apply(this,[this._streams[vt.id]||vt]),delete this._reverseStreams[this._streams[vt.id]?this._streams[vt.id].id:vt.id],delete this._streams[vt.id]},_e.RTCPeerConnection.prototype.addTrack=function(vt,Tt){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const bt=[].slice.call(arguments,1);if(bt.length!==1||!bt[0].getTracks().find(Dt=>Dt===vt))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(Dt=>Dt.track===vt))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const Mt=this._streams[Tt.id];if(Mt)Mt.addTrack(vt),Ir.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const Dt=new _e.MediaStream([vt]);this._streams[Tt.id]=Dt,this._reverseStreams[Dt.id]=Tt,this.addStream(Dt)}return this.getSenders().find(Dt=>Dt.track===vt)},["createOffer","createAnswer"].forEach(function(vt){const Tt=_e.RTCPeerConnection.prototype[vt],bt={[vt](){const Ot=arguments;return arguments.length&&typeof arguments[0]=="function"?Tt.apply(this,[Mt=>{const Dt=pt(this,Mt);Ot[0].apply(null,[Dt])},Mt=>{Ot[1]&&Ot[1].apply(null,Mt)},arguments[2]]):Tt.apply(this,arguments).then(Mt=>pt(this,Mt))}};_e.RTCPeerConnection.prototype[vt]=bt[vt]});const mt=_e.RTCPeerConnection.prototype.setLocalDescription;_e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=function(vt,Tt){let bt=Tt.sdp;return Object.keys(vt._reverseStreams||[]).forEach(Ot=>{const Mt=vt._reverseStreams[Ot],Dt=vt._streams[Mt.id];bt=bt.replace(new RegExp(Mt.id,"g"),Dt.id)}),new RTCSessionDescription({type:Tt.type,sdp:bt})}(this,arguments[0]),mt.apply(this,arguments)):mt.apply(this,arguments)};const _t=Object.getOwnPropertyDescriptor(_e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(_e.RTCPeerConnection.prototype,"localDescription",{get(){const vt=_t.get.apply(this);return vt.type===""?vt:pt(this,vt)}}),_e.RTCPeerConnection.prototype.removeTrack=function(vt){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!vt._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(vt._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let Tt;this._streams=this._streams||{},Object.keys(this._streams).forEach(bt=>{this._streams[bt].getTracks().find(Ot=>vt.track===Ot)&&(Tt=this._streams[bt])}),Tt&&(Tt.getTracks().length===1?this.removeStream(this._reverseStreams[Tt.id]):Tt.removeTrack(vt.track),this.dispatchEvent(new Event("negotiationneeded")))}}function fx(_e,rt){!_e.RTCPeerConnection&&_e.webkitRTCPeerConnection&&(_e.RTCPeerConnection=_e.webkitRTCPeerConnection),_e.RTCPeerConnection&&rt.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(it){const ct=_e.RTCPeerConnection.prototype[it],ut={[it](){return arguments[0]=new(it==="addIceCandidate"?_e.RTCIceCandidate:_e.RTCSessionDescription)(arguments[0]),ct.apply(this,arguments)}};_e.RTCPeerConnection.prototype[it]=ut[it]})}function gL(_e,rt){u0(_e,"negotiationneeded",it=>{const ct=it.target;if(!(rt.version<72||ct.getConfiguration&&ct.getConfiguration().sdpSemantics==="plan-b")||ct.signalingState==="stable")return it})}var _L=Object.freeze({__proto__:null,fixNegotiationNeeded:gL,shimAddTrackRemoveTrack:mL,shimAddTrackRemoveTrackWithNative:fL,shimGetDisplayMedia:function(_e,rt){_e.navigator.mediaDevices&&"getDisplayMedia"in _e.navigator.mediaDevices||_e.navigator.mediaDevices&&(typeof rt=="function"?_e.navigator.mediaDevices.getDisplayMedia=function(it){return rt(it).then(ct=>{const ut=it.video&&it.video.width,pt=it.video&&it.video.height,mt=it.video&&it.video.frameRate;return it.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:ct,maxFrameRate:mt||3}},ut&&(it.video.mandatory.maxWidth=ut),pt&&(it.video.mandatory.maxHeight=pt),_e.navigator.mediaDevices.getUserMedia(it)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))},shimGetSendersWithDtmf:dL,shimGetStats:hL,shimGetUserMedia:cL,shimMediaStream:lL,shimOnTrack:uL,shimPeerConnection:fx,shimSenderReceiverGetStats:pL});function EL(_e,rt){const it=_e&&_e.navigator,ct=_e&&_e.MediaStreamTrack;if(it.getUserMedia=function(ut,pt,mt){dx("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),it.mediaDevices.getUserMedia(ut).then(pt,mt)},!(rt.version>55&&"autoGainControl"in it.mediaDevices.getSupportedConstraints())){const ut=function(mt,_t,vt){_t in mt&&!(vt in mt)&&(mt[vt]=mt[_t],delete mt[_t])},pt=it.mediaDevices.getUserMedia.bind(it.mediaDevices);if(it.mediaDevices.getUserMedia=function(mt){return typeof mt=="object"&&typeof mt.audio=="object"&&(mt=JSON.parse(JSON.stringify(mt)),ut(mt.audio,"autoGainControl","mozAutoGainControl"),ut(mt.audio,"noiseSuppression","mozNoiseSuppression")),pt(mt)},ct&&ct.prototype.getSettings){const mt=ct.prototype.getSettings;ct.prototype.getSettings=function(){const _t=mt.apply(this,arguments);return ut(_t,"mozAutoGainControl","autoGainControl"),ut(_t,"mozNoiseSuppression","noiseSuppression"),_t}}if(ct&&ct.prototype.applyConstraints){const mt=ct.prototype.applyConstraints;ct.prototype.applyConstraints=function(_t){return this.kind==="audio"&&typeof _t=="object"&&(_t=JSON.parse(JSON.stringify(_t)),ut(_t,"autoGainControl","mozAutoGainControl"),ut(_t,"noiseSuppression","mozNoiseSuppression")),mt.apply(this,[_t])}}}}function vL(_e){typeof _e=="object"&&_e.RTCTrackEvent&&"receiver"in _e.RTCTrackEvent.prototype&&!("transceiver"in _e.RTCTrackEvent.prototype)&&Object.defineProperty(_e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function mx(_e,rt){if(typeof _e!="object"||!_e.RTCPeerConnection&&!_e.mozRTCPeerConnection)return;!_e.RTCPeerConnection&&_e.mozRTCPeerConnection&&(_e.RTCPeerConnection=_e.mozRTCPeerConnection),rt.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(ut){const pt=_e.RTCPeerConnection.prototype[ut],mt={[ut](){return arguments[0]=new(ut==="addIceCandidate"?_e.RTCIceCandidate:_e.RTCSessionDescription)(arguments[0]),pt.apply(this,arguments)}};_e.RTCPeerConnection.prototype[ut]=mt[ut]});const it={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},ct=_e.RTCPeerConnection.prototype.getStats;_e.RTCPeerConnection.prototype.getStats=function(){const[ut,pt,mt]=arguments;return ct.apply(this,[ut||null]).then(_t=>{if(rt.version<53&&!pt)try{_t.forEach(vt=>{vt.type=it[vt.type]||vt.type})}catch(vt){if(vt.name!=="TypeError")throw vt;_t.forEach((Tt,bt)=>{_t.set(bt,Object.assign({},Tt,{type:it[Tt.type]||Tt.type}))})}return _t}).then(pt,mt)}}function yL(_e){if(typeof _e!="object"||!_e.RTCPeerConnection||!_e.RTCRtpSender||_e.RTCRtpSender&&"getStats"in _e.RTCRtpSender.prototype)return;const rt=_e.RTCPeerConnection.prototype.getSenders;rt&&(_e.RTCPeerConnection.prototype.getSenders=function(){const ct=rt.apply(this,[]);return ct.forEach(ut=>ut._pc=this),ct});const it=_e.RTCPeerConnection.prototype.addTrack;it&&(_e.RTCPeerConnection.prototype.addTrack=function(){const ct=it.apply(this,arguments);return ct._pc=this,ct}),_e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Ir.resolve(new Map)}}function SL(_e){if(typeof _e!="object"||!_e.RTCPeerConnection||!_e.RTCRtpSender||_e.RTCRtpSender&&"getStats"in _e.RTCRtpReceiver.prototype)return;const rt=_e.RTCPeerConnection.prototype.getReceivers;rt&&(_e.RTCPeerConnection.prototype.getReceivers=function(){const it=rt.apply(this,[]);return it.forEach(ct=>ct._pc=this),it}),u0(_e,"track",it=>(it.receiver._pc=it.srcElement,it)),_e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function TL(_e){_e.RTCPeerConnection&&!("removeStream"in _e.RTCPeerConnection.prototype)&&(_e.RTCPeerConnection.prototype.removeStream=function(rt){dx("removeStream","removeTrack"),this.getSenders().forEach(it=>{var ct;it.track&&Er(ct=rt.getTracks()).call(ct,it.track)&&this.removeTrack(it)})})}function AL(_e){_e.DataChannel&&!_e.RTCDataChannel&&(_e.RTCDataChannel=_e.DataChannel)}function CL(_e){if(typeof _e!="object"||!_e.RTCPeerConnection)return;const rt=_e.RTCPeerConnection.prototype.addTransceiver;rt&&(_e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let it=arguments[1]&&arguments[1].sendEncodings;it===void 0&&(it=[]),it=[...it];const ct=it.length>0;ct&&it.forEach(pt=>{if("rid"in pt&&!/^[a-z0-9]{0,16}$/i.test(pt.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in pt&&!(parseFloat(pt.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in pt&&!(parseFloat(pt.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const ut=rt.apply(this,arguments);if(ct){const{sender:pt}=ut,mt=pt.getParameters();(!("encodings"in mt)||mt.encodings.length===1&&Object.keys(mt.encodings[0]).length===0)&&(mt.encodings=it,pt.sendEncodings=it,this.setParametersPromises.push(pt.setParameters(mt).then(()=>{delete pt.sendEncodings}).catch(()=>{delete pt.sendEncodings})))}return ut})}function bL(_e){if(typeof _e!="object"||!_e.RTCRtpSender)return;const rt=_e.RTCRtpSender.prototype.getParameters;rt&&(_e.RTCRtpSender.prototype.getParameters=function(){const it=rt.apply(this,arguments);return"encodings"in it||(it.encodings=[].concat(this.sendEncodings||[{}])),it})}function RL(_e){if(typeof _e!="object"||!_e.RTCPeerConnection)return;const rt=_e.RTCPeerConnection.prototype.createOffer;_e.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Ir.all(this.setParametersPromises).then(()=>rt.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):rt.apply(this,arguments)}}function wL(_e){if(typeof _e!="object"||!_e.RTCPeerConnection)return;const rt=_e.RTCPeerConnection.prototype.createAnswer;_e.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Ir.all(this.setParametersPromises).then(()=>rt.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):rt.apply(this,arguments)}}var IL=Object.freeze({__proto__:null,shimAddTransceiver:CL,shimCreateAnswer:wL,shimCreateOffer:RL,shimGetDisplayMedia:function(_e,rt){_e.navigator.mediaDevices&&"getDisplayMedia"in _e.navigator.mediaDevices||_e.navigator.mediaDevices&&(_e.navigator.mediaDevices.getDisplayMedia=function(it){if(!it||!it.video){const ct=new DOMException("getDisplayMedia without video constraints is undefined");return ct.name="NotFoundError",ct.code=8,Ir.reject(ct)}return it.video===!0?it.video={mediaSource:rt}:it.video.mediaSource=rt,_e.navigator.mediaDevices.getUserMedia(it)})},shimGetParameters:bL,shimGetUserMedia:EL,shimOnTrack:vL,shimPeerConnection:mx,shimRTCDataChannel:AL,shimReceiverGetStats:SL,shimRemoveStream:TL,shimSenderGetStats:yL});function xL(_e){if(typeof _e=="object"&&_e.RTCPeerConnection){if("getLocalStreams"in _e.RTCPeerConnection.prototype||(_e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in _e.RTCPeerConnection.prototype)){const rt=_e.RTCPeerConnection.prototype.addTrack;_e.RTCPeerConnection.prototype.addStream=function(it){var ct;this._localStreams||(this._localStreams=[]),Er(ct=this._localStreams).call(ct,it)||this._localStreams.push(it),it.getAudioTracks().forEach(ut=>rt.call(this,ut,it)),it.getVideoTracks().forEach(ut=>rt.call(this,ut,it))},_e.RTCPeerConnection.prototype.addTrack=function(it){for(var ct=arguments.length,ut=new Array(ct>1?ct-1:0),pt=1;pt<ct;pt++)ut[pt-1]=arguments[pt];return ut&&ut.forEach(mt=>{var _t;this._localStreams?Er(_t=this._localStreams).call(_t,mt)||this._localStreams.push(mt):this._localStreams=[mt]}),rt.apply(this,arguments)}}"removeStream"in _e.RTCPeerConnection.prototype||(_e.RTCPeerConnection.prototype.removeStream=function(rt){this._localStreams||(this._localStreams=[]);const it=this._localStreams.indexOf(rt);if(it===-1)return;this._localStreams.splice(it,1);const ct=rt.getTracks();this.getSenders().forEach(ut=>{Er(ct).call(ct,ut.track)&&this.removeTrack(ut)})})}}function OL(_e){if(typeof _e=="object"&&_e.RTCPeerConnection&&("getRemoteStreams"in _e.RTCPeerConnection.prototype||(_e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in _e.RTCPeerConnection.prototype))){Object.defineProperty(_e.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(it){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=it),this.addEventListener("track",this._onaddstreampoly=ct=>{ct.streams.forEach(ut=>{var pt;if(this._remoteStreams||(this._remoteStreams=[]),Er(pt=this._remoteStreams).call(pt,ut))return;this._remoteStreams.push(ut);const mt=new Event("addstream");mt.stream=ut,this.dispatchEvent(mt)})})}});const rt=_e.RTCPeerConnection.prototype.setRemoteDescription;_e.RTCPeerConnection.prototype.setRemoteDescription=function(){const it=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(ct){ct.streams.forEach(ut=>{if(it._remoteStreams||(it._remoteStreams=[]),it._remoteStreams.indexOf(ut)>=0)return;it._remoteStreams.push(ut);const pt=new Event("addstream");pt.stream=ut,it.dispatchEvent(pt)})}),rt.apply(it,arguments)}}}function ML(_e){if(typeof _e!="object"||!_e.RTCPeerConnection)return;const rt=_e.RTCPeerConnection.prototype,it=rt.createOffer,ct=rt.createAnswer,ut=rt.setLocalDescription,pt=rt.setRemoteDescription,mt=rt.addIceCandidate;rt.createOffer=function(vt,Tt){const bt=arguments.length>=2?arguments[2]:arguments[0],Ot=it.apply(this,[bt]);return Tt?(Ot.then(vt,Tt),Ir.resolve()):Ot},rt.createAnswer=function(vt,Tt){const bt=arguments.length>=2?arguments[2]:arguments[0],Ot=ct.apply(this,[bt]);return Tt?(Ot.then(vt,Tt),Ir.resolve()):Ot};let _t=function(vt,Tt,bt){const Ot=ut.apply(this,[vt]);return bt?(Ot.then(Tt,bt),Ir.resolve()):Ot};rt.setLocalDescription=_t,_t=function(vt,Tt,bt){const Ot=pt.apply(this,[vt]);return bt?(Ot.then(Tt,bt),Ir.resolve()):Ot},rt.setRemoteDescription=_t,_t=function(vt,Tt,bt){const Ot=mt.apply(this,[vt]);return bt?(Ot.then(Tt,bt),Ir.resolve()):Ot},rt.addIceCandidate=_t}function PL(_e){const rt=_e&&_e.navigator;if(rt.mediaDevices&&rt.mediaDevices.getUserMedia){const it=rt.mediaDevices,ct=it.getUserMedia.bind(it);rt.mediaDevices.getUserMedia=ut=>ct(NL(ut))}!rt.getUserMedia&&rt.mediaDevices&&rt.mediaDevices.getUserMedia&&(rt.getUserMedia=(function(it,ct,ut){rt.mediaDevices.getUserMedia(it).then(ct,ut)}).bind(rt))}function NL(_e){return _e&&_e.video!==void 0?Object.assign({},_e,{video:oL(_e.video)}):_e}function DL(_e){if(!_e.RTCPeerConnection)return;const rt=_e.RTCPeerConnection;_e.RTCPeerConnection=function(it,ct){if(it&&it.iceServers){const ut=[];for(let pt=0;pt<it.iceServers.length;pt++){let mt=it.iceServers[pt];!mt.hasOwnProperty("urls")&&mt.hasOwnProperty("url")?(dx("RTCIceServer.url","RTCIceServer.urls"),mt=JSON.parse(JSON.stringify(mt)),mt.urls=mt.url,delete mt.url,ut.push(mt)):ut.push(it.iceServers[pt])}it.iceServers=ut}return new rt(it,ct)},_e.RTCPeerConnection.prototype=rt.prototype,"generateCertificate"in rt&&Object.defineProperty(_e.RTCPeerConnection,"generateCertificate",{get:()=>rt.generateCertificate})}function LL(_e){typeof _e=="object"&&_e.RTCTrackEvent&&"receiver"in _e.RTCTrackEvent.prototype&&!("transceiver"in _e.RTCTrackEvent.prototype)&&Object.defineProperty(_e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function kL(_e){const rt=_e.RTCPeerConnection.prototype.createOffer;_e.RTCPeerConnection.prototype.createOffer=function(it){if(it){it.offerToReceiveAudio!==void 0&&(it.offerToReceiveAudio=!!it.offerToReceiveAudio);const ct=this.getTransceivers().find(pt=>pt.receiver.track.kind==="audio");it.offerToReceiveAudio===!1&&ct?ct.direction==="sendrecv"?ct.setDirection?ct.setDirection("sendonly"):ct.direction="sendonly":ct.direction==="recvonly"&&(ct.setDirection?ct.setDirection("inactive"):ct.direction="inactive"):it.offerToReceiveAudio!==!0||ct||this.addTransceiver("audio",{direction:"recvonly"}),it.offerToReceiveVideo!==void 0&&(it.offerToReceiveVideo=!!it.offerToReceiveVideo);const ut=this.getTransceivers().find(pt=>pt.receiver.track.kind==="video");it.offerToReceiveVideo===!1&&ut?ut.direction==="sendrecv"?ut.setDirection?ut.setDirection("sendonly"):ut.direction="sendonly":ut.direction==="recvonly"&&(ut.setDirection?ut.setDirection("inactive"):ut.direction="inactive"):it.offerToReceiveVideo!==!0||ut||this.addTransceiver("video",{direction:"recvonly"})}return rt.apply(this,arguments)}}function UL(_e){typeof _e!="object"||_e.AudioContext||(_e.AudioContext=_e.webkitAudioContext)}var BL=Object.freeze({__proto__:null,shimAudioContext:UL,shimCallbacksAPI:ML,shimConstraints:NL,shimCreateOfferLegacy:kL,shimGetUserMedia:PL,shimLocalStreamsAPI:xL,shimRTCIceServerUrls:DL,shimRemoteStreamsAPI:OL,shimTrackEventTransceiver:LL}),FL=`	
\v\f\r \u2028\u2029\uFEFF`,CW=wn,bW=Ku,gx=FL,VL=Et("".replace),RW=RegExp("^["+gx+"]+"),wW=RegExp("(^|[^"+gx+"])["+gx+"]+$"),Ex=function(_e){return function(rt){var it=bW(CW(rt));return 1&_e&&(it=VL(it,RW,"")),2&_e&&(it=VL(it,wW,"$1")),it}},IW={start:Ex(1),end:Ex(2),trim:Ex(3)},xW=Gy.PROPER,OW=at,GL=FL,MW=IW.trim;Ko({target:"String",proto:!0,forced:function(_e){return OW(function(){return!!GL[_e]()||""[_e]()!==""||xW&&GL[_e].name!==_e})}("trim")},{trim:function(){return MW(this)}});var PW=tp("String","trim"),NW=yt,DW=PW,vx=String.prototype,LW=function(_e){var rt=_e.trim;return typeof _e=="string"||_e===vx||NW(vx,_e)&&rt===vx.trim?DW:rt},wu=st(LW),$L={exports:{}};(function(_e){const rt={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};rt.localCName=rt.generateIdentifier(),rt.splitLines=function(it){return it.trim().split(`
`).map(ct=>ct.trim())},rt.splitSections=function(it){return it.split(`
m=`).map((ct,ut)=>(ut>0?"m="+ct:ct).trim()+`\r
`)},rt.getDescription=function(it){const ct=rt.splitSections(it);return ct&&ct[0]},rt.getMediaSections=function(it){const ct=rt.splitSections(it);return ct.shift(),ct},rt.matchPrefix=function(it,ct){return rt.splitLines(it).filter(ut=>ut.indexOf(ct)===0)},rt.parseCandidate=function(it){let ct;ct=it.indexOf("a=candidate:")===0?it.substring(12).split(" "):it.substring(10).split(" ");const ut={foundation:ct[0],component:{1:"rtp",2:"rtcp"}[ct[1]]||ct[1],protocol:ct[2].toLowerCase(),priority:parseInt(ct[3],10),ip:ct[4],address:ct[4],port:parseInt(ct[5],10),type:ct[7]};for(let pt=8;pt<ct.length;pt+=2)switch(ct[pt]){case"raddr":ut.relatedAddress=ct[pt+1];break;case"rport":ut.relatedPort=parseInt(ct[pt+1],10);break;case"tcptype":ut.tcpType=ct[pt+1];break;case"ufrag":ut.ufrag=ct[pt+1],ut.usernameFragment=ct[pt+1];break;default:ut[ct[pt]]===void 0&&(ut[ct[pt]]=ct[pt+1])}return ut},rt.writeCandidate=function(it){const ct=[];ct.push(it.foundation);const ut=it.component;ut==="rtp"?ct.push(1):ut==="rtcp"?ct.push(2):ct.push(ut),ct.push(it.protocol.toUpperCase()),ct.push(it.priority),ct.push(it.address||it.ip),ct.push(it.port);const pt=it.type;return ct.push("typ"),ct.push(pt),pt!=="host"&&it.relatedAddress&&it.relatedPort&&(ct.push("raddr"),ct.push(it.relatedAddress),ct.push("rport"),ct.push(it.relatedPort)),it.tcpType&&it.protocol.toLowerCase()==="tcp"&&(ct.push("tcptype"),ct.push(it.tcpType)),(it.usernameFragment||it.ufrag)&&(ct.push("ufrag"),ct.push(it.usernameFragment||it.ufrag)),"candidate:"+ct.join(" ")},rt.parseIceOptions=function(it){return it.substring(14).split(" ")},rt.parseRtpMap=function(it){let ct=it.substring(9).split(" ");const ut={payloadType:parseInt(ct.shift(),10)};return ct=ct[0].split("/"),ut.name=ct[0],ut.clockRate=parseInt(ct[1],10),ut.channels=ct.length===3?parseInt(ct[2],10):1,ut.numChannels=ut.channels,ut},rt.writeRtpMap=function(it){let ct=it.payloadType;it.preferredPayloadType!==void 0&&(ct=it.preferredPayloadType);const ut=it.channels||it.numChannels||1;return"a=rtpmap:"+ct+" "+it.name+"/"+it.clockRate+(ut!==1?"/"+ut:"")+`\r
`},rt.parseExtmap=function(it){const ct=it.substring(9).split(" ");return{id:parseInt(ct[0],10),direction:ct[0].indexOf("/")>0?ct[0].split("/")[1]:"sendrecv",uri:ct[1],attributes:ct.slice(2).join(" ")}},rt.writeExtmap=function(it){return"a=extmap:"+(it.id||it.preferredId)+(it.direction&&it.direction!=="sendrecv"?"/"+it.direction:"")+" "+it.uri+(it.attributes?" "+it.attributes:"")+`\r
`},rt.parseFmtp=function(it){const ct={};let ut;const pt=it.substring(it.indexOf(" ")+1).split(";");for(let mt=0;mt<pt.length;mt++)ut=pt[mt].trim().split("="),ct[ut[0].trim()]=ut[1];return ct},rt.writeFmtp=function(it){let ct="",ut=it.payloadType;if(it.preferredPayloadType!==void 0&&(ut=it.preferredPayloadType),it.parameters&&Object.keys(it.parameters).length){const pt=[];Object.keys(it.parameters).forEach(mt=>{it.parameters[mt]!==void 0?pt.push(mt+"="+it.parameters[mt]):pt.push(mt)}),ct+="a=fmtp:"+ut+" "+pt.join(";")+`\r
`}return ct},rt.parseRtcpFb=function(it){const ct=it.substring(it.indexOf(" ")+1).split(" ");return{type:ct.shift(),parameter:ct.join(" ")}},rt.writeRtcpFb=function(it){let ct="",ut=it.payloadType;return it.preferredPayloadType!==void 0&&(ut=it.preferredPayloadType),it.rtcpFeedback&&it.rtcpFeedback.length&&it.rtcpFeedback.forEach(pt=>{ct+="a=rtcp-fb:"+ut+" "+pt.type+(pt.parameter&&pt.parameter.length?" "+pt.parameter:"")+`\r
`}),ct},rt.parseSsrcMedia=function(it){const ct=it.indexOf(" "),ut={ssrc:parseInt(it.substring(7,ct),10)},pt=it.indexOf(":",ct);return pt>-1?(ut.attribute=it.substring(ct+1,pt),ut.value=it.substring(pt+1)):ut.attribute=it.substring(ct+1),ut},rt.parseSsrcGroup=function(it){const ct=it.substring(13).split(" ");return{semantics:ct.shift(),ssrcs:ct.map(ut=>parseInt(ut,10))}},rt.getMid=function(it){const ct=rt.matchPrefix(it,"a=mid:")[0];if(ct)return ct.substring(6)},rt.parseFingerprint=function(it){const ct=it.substring(14).split(" ");return{algorithm:ct[0].toLowerCase(),value:ct[1].toUpperCase()}},rt.getDtlsParameters=function(it,ct){return{role:"auto",fingerprints:rt.matchPrefix(it+ct,"a=fingerprint:").map(rt.parseFingerprint)}},rt.writeDtlsParameters=function(it,ct){let ut="a=setup:"+ct+`\r
`;return it.fingerprints.forEach(pt=>{ut+="a=fingerprint:"+pt.algorithm+" "+pt.value+`\r
`}),ut},rt.parseCryptoLine=function(it){const ct=it.substring(9).split(" ");return{tag:parseInt(ct[0],10),cryptoSuite:ct[1],keyParams:ct[2],sessionParams:ct.slice(3)}},rt.writeCryptoLine=function(it){return"a=crypto:"+it.tag+" "+it.cryptoSuite+" "+(typeof it.keyParams=="object"?rt.writeCryptoKeyParams(it.keyParams):it.keyParams)+(it.sessionParams?" "+it.sessionParams.join(" "):"")+`\r
`},rt.parseCryptoKeyParams=function(it){if(it.indexOf("inline:")!==0)return null;const ct=it.substring(7).split("|");return{keyMethod:"inline",keySalt:ct[0],lifeTime:ct[1],mkiValue:ct[2]?ct[2].split(":")[0]:void 0,mkiLength:ct[2]?ct[2].split(":")[1]:void 0}},rt.writeCryptoKeyParams=function(it){return it.keyMethod+":"+it.keySalt+(it.lifeTime?"|"+it.lifeTime:"")+(it.mkiValue&&it.mkiLength?"|"+it.mkiValue+":"+it.mkiLength:"")},rt.getCryptoParameters=function(it,ct){return rt.matchPrefix(it+ct,"a=crypto:").map(rt.parseCryptoLine)},rt.getIceParameters=function(it,ct){const ut=rt.matchPrefix(it+ct,"a=ice-ufrag:")[0],pt=rt.matchPrefix(it+ct,"a=ice-pwd:")[0];return ut&&pt?{usernameFragment:ut.substring(12),password:pt.substring(10)}:null},rt.writeIceParameters=function(it){let ct="a=ice-ufrag:"+it.usernameFragment+`\r
a=ice-pwd:`+it.password+`\r
`;return it.iceLite&&(ct+=`a=ice-lite\r
`),ct},rt.parseRtpParameters=function(it){const ct={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},ut=rt.splitLines(it)[0].split(" ");ct.profile=ut[2];for(let mt=3;mt<ut.length;mt++){const _t=ut[mt],vt=rt.matchPrefix(it,"a=rtpmap:"+_t+" ")[0];if(vt){const Tt=rt.parseRtpMap(vt),bt=rt.matchPrefix(it,"a=fmtp:"+_t+" ");switch(Tt.parameters=bt.length?rt.parseFmtp(bt[0]):{},Tt.rtcpFeedback=rt.matchPrefix(it,"a=rtcp-fb:"+_t+" ").map(rt.parseRtcpFb),ct.codecs.push(Tt),Tt.name.toUpperCase()){case"RED":case"ULPFEC":ct.fecMechanisms.push(Tt.name.toUpperCase())}}}rt.matchPrefix(it,"a=extmap:").forEach(mt=>{ct.headerExtensions.push(rt.parseExtmap(mt))});const pt=rt.matchPrefix(it,"a=rtcp-fb:* ").map(rt.parseRtcpFb);return ct.codecs.forEach(mt=>{pt.forEach(_t=>{mt.rtcpFeedback.find(vt=>vt.type===_t.type&&vt.parameter===_t.parameter)||mt.rtcpFeedback.push(_t)})}),ct},rt.writeRtpDescription=function(it,ct){let ut="";ut+="m="+it+" ",ut+=ct.codecs.length>0?"9":"0",ut+=" "+(ct.profile||"UDP/TLS/RTP/SAVPF")+" ",ut+=ct.codecs.map(mt=>mt.preferredPayloadType!==void 0?mt.preferredPayloadType:mt.payloadType).join(" ")+`\r
`,ut+=`c=IN IP4 0.0.0.0\r
`,ut+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,ct.codecs.forEach(mt=>{ut+=rt.writeRtpMap(mt),ut+=rt.writeFmtp(mt),ut+=rt.writeRtcpFb(mt)});let pt=0;return ct.codecs.forEach(mt=>{mt.maxptime>pt&&(pt=mt.maxptime)}),pt>0&&(ut+="a=maxptime:"+pt+`\r
`),ct.headerExtensions&&ct.headerExtensions.forEach(mt=>{ut+=rt.writeExtmap(mt)}),ut},rt.parseRtpEncodingParameters=function(it){const ct=[],ut=rt.parseRtpParameters(it),pt=ut.fecMechanisms.indexOf("RED")!==-1,mt=ut.fecMechanisms.indexOf("ULPFEC")!==-1,_t=rt.matchPrefix(it,"a=ssrc:").map(Mt=>rt.parseSsrcMedia(Mt)).filter(Mt=>Mt.attribute==="cname"),vt=_t.length>0&&_t[0].ssrc;let Tt;const bt=rt.matchPrefix(it,"a=ssrc-group:FID").map(Mt=>Mt.substring(17).split(" ").map(Dt=>parseInt(Dt,10)));bt.length>0&&bt[0].length>1&&bt[0][0]===vt&&(Tt=bt[0][1]),ut.codecs.forEach(Mt=>{if(Mt.name.toUpperCase()==="RTX"&&Mt.parameters.apt){let Dt={ssrc:vt,codecPayloadType:parseInt(Mt.parameters.apt,10)};vt&&Tt&&(Dt.rtx={ssrc:Tt}),ct.push(Dt),pt&&(Dt=JSON.parse(JSON.stringify(Dt)),Dt.fec={ssrc:vt,mechanism:mt?"red+ulpfec":"red"},ct.push(Dt))}}),ct.length===0&&vt&&ct.push({ssrc:vt});let Ot=rt.matchPrefix(it,"b=");return Ot.length&&(Ot=Ot[0].indexOf("b=TIAS:")===0?parseInt(Ot[0].substring(7),10):Ot[0].indexOf("b=AS:")===0?1e3*parseInt(Ot[0].substring(5),10)*.95-16e3:void 0,ct.forEach(Mt=>{Mt.maxBitrate=Ot})),ct},rt.parseRtcpParameters=function(it){const ct={},ut=rt.matchPrefix(it,"a=ssrc:").map(_t=>rt.parseSsrcMedia(_t)).filter(_t=>_t.attribute==="cname")[0];ut&&(ct.cname=ut.value,ct.ssrc=ut.ssrc);const pt=rt.matchPrefix(it,"a=rtcp-rsize");ct.reducedSize=pt.length>0,ct.compound=pt.length===0;const mt=rt.matchPrefix(it,"a=rtcp-mux");return ct.mux=mt.length>0,ct},rt.writeRtcpParameters=function(it){let ct="";return it.reducedSize&&(ct+=`a=rtcp-rsize\r
`),it.mux&&(ct+=`a=rtcp-mux\r
`),it.ssrc!==void 0&&it.cname&&(ct+="a=ssrc:"+it.ssrc+" cname:"+it.cname+`\r
`),ct},rt.parseMsid=function(it){let ct;const ut=rt.matchPrefix(it,"a=msid:");if(ut.length===1)return ct=ut[0].substring(7).split(" "),{stream:ct[0],track:ct[1]};const pt=rt.matchPrefix(it,"a=ssrc:").map(mt=>rt.parseSsrcMedia(mt)).filter(mt=>mt.attribute==="msid");return pt.length>0?(ct=pt[0].value.split(" "),{stream:ct[0],track:ct[1]}):void 0},rt.parseSctpDescription=function(it){const ct=rt.parseMLine(it),ut=rt.matchPrefix(it,"a=max-message-size:");let pt;ut.length>0&&(pt=parseInt(ut[0].substring(19),10)),isNaN(pt)&&(pt=65536);const mt=rt.matchPrefix(it,"a=sctp-port:");if(mt.length>0)return{port:parseInt(mt[0].substring(12),10),protocol:ct.fmt,maxMessageSize:pt};const _t=rt.matchPrefix(it,"a=sctpmap:");if(_t.length>0){const vt=_t[0].substring(10).split(" ");return{port:parseInt(vt[0],10),protocol:vt[1],maxMessageSize:pt}}},rt.writeSctpDescription=function(it,ct){let ut=[];return ut=it.protocol!=="DTLS/SCTP"?["m="+it.kind+" 9 "+it.protocol+" "+ct.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+ct.port+`\r
`]:["m="+it.kind+" 9 "+it.protocol+" "+ct.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+ct.port+" "+ct.protocol+` 65535\r
`],ct.maxMessageSize!==void 0&&ut.push("a=max-message-size:"+ct.maxMessageSize+`\r
`),ut.join("")},rt.generateSessionId=function(){return Math.random().toString().substr(2,22)},rt.writeSessionBoilerplate=function(it,ct,ut){let pt;const mt=ct!==void 0?ct:2;return pt=it||rt.generateSessionId(),`v=0\r
o=`+(ut||"thisisadapterortc")+" "+pt+" "+mt+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},rt.getDirection=function(it,ct){const ut=rt.splitLines(it);for(let pt=0;pt<ut.length;pt++)switch(ut[pt]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return ut[pt].substring(2)}return ct?rt.getDirection(ct):"sendrecv"},rt.getKind=function(it){return rt.splitLines(it)[0].split(" ")[0].substring(2)},rt.isRejected=function(it){return it.split(" ",2)[1]==="0"},rt.parseMLine=function(it){const ct=rt.splitLines(it)[0].substring(2).split(" ");return{kind:ct[0],port:parseInt(ct[1],10),protocol:ct[2],fmt:ct.slice(3).join(" ")}},rt.parseOLine=function(it){const ct=rt.matchPrefix(it,"o=")[0].substring(2).split(" ");return{username:ct[0],sessionId:ct[1],sessionVersion:parseInt(ct[2],10),netType:ct[3],addressType:ct[4],address:ct[5]}},rt.isValidSDP=function(it){if(typeof it!="string"||it.length===0)return!1;const ct=rt.splitLines(it);for(let ut=0;ut<ct.length;ut++)if(ct[ut].length<2||ct[ut].charAt(1)!=="=")return!1;return!0},_e.exports=rt})($L);var HL=$L.exports,rS=st(HL),kW=tt({__proto__:null,default:rS},[HL]);function IR(_e){if(!_e.RTCIceCandidate||_e.RTCIceCandidate&&"foundation"in _e.RTCIceCandidate.prototype)return;const rt=_e.RTCIceCandidate;_e.RTCIceCandidate=function(it){if(typeof it=="object"&&it.candidate&&it.candidate.indexOf("a=")===0&&((it=JSON.parse(JSON.stringify(it))).candidate=it.candidate.substr(2)),it.candidate&&it.candidate.length){const ct=new rt(it),ut=rS.parseCandidate(it.candidate),pt=Object.assign(ct,ut);return pt.toJSON=function(){return{candidate:pt.candidate,sdpMid:pt.sdpMid,sdpMLineIndex:pt.sdpMLineIndex,usernameFragment:pt.usernameFragment}},pt}return new rt(it)},_e.RTCIceCandidate.prototype=rt.prototype,u0(_e,"icecandidate",it=>(it.candidate&&Object.defineProperty(it,"candidate",{value:new _e.RTCIceCandidate(it.candidate),writable:"false"}),it))}function yx(_e){!_e.RTCIceCandidate||_e.RTCIceCandidate&&"relayProtocol"in _e.RTCIceCandidate.prototype||u0(_e,"icecandidate",rt=>{if(rt.candidate){const it=rS.parseCandidate(rt.candidate.candidate);it.type==="relay"&&(rt.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[it.priority>>24])}return rt})}function xR(_e,rt){if(!_e.RTCPeerConnection)return;"sctp"in _e.RTCPeerConnection.prototype||Object.defineProperty(_e.RTCPeerConnection.prototype,"sctp",{get(){return this._sctp===void 0?null:this._sctp}});const it=function(_t){if(!_t||!_t.sdp)return!1;const vt=rS.splitSections(_t.sdp);return vt.shift(),vt.some(Tt=>{const bt=rS.parseMLine(Tt);return bt&&bt.kind==="application"&&bt.protocol.indexOf("SCTP")!==-1})},ct=function(_t){const vt=_t.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(vt===null||vt.length<2)return-1;const Tt=parseInt(vt[1],10);return Tt!=Tt?-1:Tt},ut=function(_t){let vt=65536;return rt.browser==="firefox"&&(vt=rt.version<57?_t===-1?16384:2147483637:rt.version<60?rt.version===57?65535:65536:2147483637),vt},pt=function(_t,vt){let Tt=65536;rt.browser==="firefox"&&rt.version===57&&(Tt=65535);const bt=rS.matchPrefix(_t.sdp,"a=max-message-size:");return bt.length>0?Tt=parseInt(bt[0].substr(19),10):rt.browser==="firefox"&&vt!==-1&&(Tt=2147483637),Tt},mt=_e.RTCPeerConnection.prototype.setRemoteDescription;_e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,rt.browser==="chrome"&&rt.version>=76){const{sdpSemantics:_t}=this.getConfiguration();_t==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return this._sctp===void 0?null:this._sctp},enumerable:!0,configurable:!0})}if(it(arguments[0])){const _t=ct(arguments[0]),vt=ut(_t),Tt=pt(arguments[0],_t);let bt;bt=vt===0&&Tt===0?Number.POSITIVE_INFINITY:vt===0||Tt===0?Math.max(vt,Tt):Math.min(vt,Tt);const Ot={};Object.defineProperty(Ot,"maxMessageSize",{get:()=>bt}),this._sctp=Ot}return mt.apply(this,arguments)}}function OR(_e){if(!_e.RTCPeerConnection||!("createDataChannel"in _e.RTCPeerConnection.prototype))return;function rt(ct,ut){const pt=ct.send;ct.send=function(){const mt=arguments[0],_t=mt.length||mt.size||mt.byteLength;if(ct.readyState==="open"&&ut.sctp&&_t>ut.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+ut.sctp.maxMessageSize+" bytes)");return pt.apply(ct,arguments)}}const it=_e.RTCPeerConnection.prototype.createDataChannel;_e.RTCPeerConnection.prototype.createDataChannel=function(){const ct=it.apply(this,arguments);return rt(ct,this),ct},u0(_e,"datachannel",ct=>(rt(ct.channel,ct.target),ct))}function Sx(_e){if(!_e.RTCPeerConnection||"connectionState"in _e.RTCPeerConnection.prototype)return;const rt=_e.RTCPeerConnection.prototype;Object.defineProperty(rt,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(rt,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(it){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),it&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=it)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(it=>{const ct=rt[it];rt[it]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=ut=>{const pt=ut.target;if(pt._lastConnectionState!==pt.connectionState){pt._lastConnectionState=pt.connectionState;const mt=new Event("connectionstatechange",ut);pt.dispatchEvent(mt)}return ut},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),ct.apply(this,arguments)}})}function Tx(_e,rt){if(!_e.RTCPeerConnection||rt.browser==="chrome"&&rt.version>=71||rt.browser==="safari"&&rt.version>=605)return;const it=_e.RTCPeerConnection.prototype.setRemoteDescription;_e.RTCPeerConnection.prototype.setRemoteDescription=function(ct){if(ct&&ct.sdp&&ct.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const ut=ct.sdp.split(`
`).filter(pt=>wu(pt).call(pt)!=="a=extmap-allow-mixed").join(`
`);_e.RTCSessionDescription&&ct instanceof _e.RTCSessionDescription?arguments[0]=new _e.RTCSessionDescription({type:ct.type,sdp:ut}):ct.sdp=ut}return it.apply(this,arguments)}}function MR(_e,rt){if(!_e.RTCPeerConnection||!_e.RTCPeerConnection.prototype)return;const it=_e.RTCPeerConnection.prototype.addIceCandidate;it&&it.length!==0&&(_e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(rt.browser==="chrome"&&rt.version<78||rt.browser==="firefox"&&rt.version<68||rt.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Ir.resolve():it.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Ir.resolve())})}function PR(_e,rt){if(!_e.RTCPeerConnection||!_e.RTCPeerConnection.prototype)return;const it=_e.RTCPeerConnection.prototype.setLocalDescription;it&&it.length!==0&&(_e.RTCPeerConnection.prototype.setLocalDescription=function(){let ct=arguments[0]||{};if(typeof ct!="object"||ct.type&&ct.sdp)return it.apply(this,arguments);if(ct={type:ct.type,sdp:ct.sdp},!ct.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":ct.type="offer";break;default:ct.type="answer"}return ct.sdp||ct.type!=="offer"&&ct.type!=="answer"?it.apply(this,[ct]):(ct.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(ut=>it.apply(this,[ut]))})}var UW=Object.freeze({__proto__:null,removeExtmapAllowMixed:Tx,shimAddIceCandidateNullOrEmpty:MR,shimConnectionState:Sx,shimMaxMessageSize:xR,shimParameterlessSetLocalDescription:PR,shimRTCIceCandidate:IR,shimRTCIceCandidateRelayProtocol:yx,shimSendThrowTypeError:OR});(function(){let{window:_e}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},rt=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0};const it=rL,ct=function(pt){const mt={browser:null,version:null};if(pt===void 0||!pt.navigator)return mt.browser="Not a browser.",mt;const{navigator:_t}=pt;if(_t.mozGetUserMedia)mt.browser="firefox",mt.version=wR(_t.userAgent,/Firefox\/(\d+)\./,1);else if(_t.webkitGetUserMedia||pt.isSecureContext===!1&&pt.webkitRTCPeerConnection)mt.browser="chrome",mt.version=wR(_t.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!pt.RTCPeerConnection||!_t.userAgent.match(/AppleWebKit\/(\d+)\./))return mt.browser="Not a supported browser.",mt;mt.browser="safari",mt.version=wR(_t.userAgent,/AppleWebKit\/(\d+)\./,1),mt.supportsUnifiedPlan=pt.RTCRtpTransceiver&&"currentDirection"in pt.RTCRtpTransceiver.prototype}return mt}(_e),ut={browserDetails:ct,commonShim:UW,extractVersion:wR,disableLog:TW,disableWarnings:AW,sdp:kW};switch(ct.browser){case"chrome":if(!_L||!fx||!rt.shimChrome)return it("Chrome shim is not included in this adapter release."),ut;if(ct.version===null)return it("Chrome shim can not determine version, not shimming."),ut;it("adapter.js shimming chrome."),ut.browserShim=_L,MR(_e,ct),PR(_e),cL(_e,ct),lL(_e),fx(_e,ct),uL(_e),mL(_e,ct),dL(_e),hL(_e),pL(_e),gL(_e,ct),IR(_e),yx(_e),Sx(_e),xR(_e,ct),OR(_e),Tx(_e,ct);break;case"firefox":if(!IL||!mx||!rt.shimFirefox)return it("Firefox shim is not included in this adapter release."),ut;it("adapter.js shimming firefox."),ut.browserShim=IL,MR(_e,ct),PR(_e),EL(_e,ct),mx(_e,ct),vL(_e),TL(_e),yL(_e),SL(_e),AL(_e),CL(_e),bL(_e),RL(_e),wL(_e),IR(_e),Sx(_e),xR(_e,ct),OR(_e);break;case"safari":if(!BL||!rt.shimSafari)return it("Safari shim is not included in this adapter release."),ut;it("adapter.js shimming safari."),ut.browserShim=BL,MR(_e,ct),PR(_e),DL(_e),kL(_e),ML(_e),xL(_e),OL(_e),LL(_e),PL(_e),UL(_e),IR(_e),yx(_e),xR(_e,ct),OR(_e),Tx(_e,ct);break;default:it("Unsupported browser!")}})({window:typeof window>"u"?void 0:window});var Ax=wt;Ko({global:!0,forced:Ax.globalThis!==Ax},{globalThis:Ax});var jL=st(wt),Cx={exports:{}};(function(_e,rt){(function(it,ct){var ut="function",pt="undefined",mt="object",_t="string",vt="major",Tt="model",bt="name",Ot="type",Mt="vendor",Dt="version",jt="architecture",$t="console",Ht="mobile",en="tablet",Qt="smarttv",on="wearable",Tn="embedded",vn="Amazon",hn="Apple",Ln="ASUS",Xn="BlackBerry",Qn="Browser",ur="Chrome",go="Firefox",Eo="Google",no="Huawei",Yo="LG",jo="Microsoft",fu="Motorola",Jn="Opera",_r="Samsung",Dr="Sharp",nr="Sony",Gt="Xiaomi",ln="Zebra",En="Facebook",fr="Chromium OS",uo="Mac OS",vs=" Browser",Tl=function(_c){for(var Al={},Rs=0;Rs<_c.length;Rs++)Al[_c[Rs].toUpperCase()]=_c[Rs];return Al},sm=function(_c,Al){return typeof _c===_t&&Dm(Al).indexOf(Dm(_c))!==-1},Dm=function(_c){return _c.toLowerCase()},rC=function(_c,Al){if(typeof _c===_t)return _c=_c.replace(/^\s\s*/,""),typeof Al===pt?_c:_c.substring(0,500)},B0=function(_c,Al){for(var Rs,up,h_,Js,TE,Lo,p_=0;p_<Al.length&&!TE;){var F0=Al[p_],W_=Al[p_+1];for(Rs=up=0;Rs<F0.length&&!TE&&F0[Rs];)if(TE=F0[Rs++].exec(_c))for(h_=0;h_<W_.length;h_++)Lo=TE[++up],typeof(Js=W_[h_])===mt&&Js.length>0?Js.length===2?typeof Js[1]==ut?this[Js[0]]=Js[1].call(this,Lo):this[Js[0]]=Js[1]:Js.length===3?typeof Js[1]!==ut||Js[1].exec&&Js[1].test?this[Js[0]]=Lo?Lo.replace(Js[1],Js[2]):ct:this[Js[0]]=Lo?Js[1].call(this,Lo,Js[2]):ct:Js.length===4&&(this[Js[0]]=Lo?Js[3].call(this,Lo.replace(Js[1],Js[2])):ct):this[Js]=Lo||ct;p_+=2}},ZS=function(_c,Al){for(var Rs in Al)if(typeof Al[Rs]===mt&&Al[Rs].length>0){for(var up=0;up<Al[Rs].length;up++)if(sm(Al[Rs][up],_c))return Rs==="?"?ct:Rs}else if(sm(Al[Rs],_c))return Rs==="?"?ct:Rs;return Al.hasOwnProperty("*")?Al["*"]:_c},x1={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},O1={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[Dt,[bt,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[Dt,[bt,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[bt,Dt],[/opios[\/ ]+([\w\.]+)/i],[Dt,[bt,Jn+" Mini"]],[/\bop(?:rg)?x\/([\w\.]+)/i],[Dt,[bt,Jn+" GX"]],[/\bopr\/([\w\.]+)/i],[Dt,[bt,Jn]],[/\bb[ai]*d(?:uhd|[ub]*[aekoprswx]{5,6})[\/ ]?([\w\.]+)/i],[Dt,[bt,"Baidu"]],[/\b(?:mxbrowser|mxios|myie2)\/?([-\w\.]*)\b/i],[Dt,[bt,"Maxthon"]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer|sleipnir)[\/ ]?([\w\.]*)/i,/(avant|iemobile|slim(?:browser|boat|jet))[\/ ]?([\d\.]*)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|duckduckgo|klar|helio|(?=comodo_)?dragon)\/([-\w\.]+)/i,/(heytap|ovi|115)browser\/([\d\.]+)/i,/(weibo)__([\d\.]+)/i],[bt,Dt],[/quark(?:pc)?\/([-\w\.]+)/i],[Dt,[bt,"Quark"]],[/\bddg\/([\w\.]+)/i],[Dt,[bt,"DuckDuckGo"]],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[Dt,[bt,"UC"+Qn]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i,/micromessenger\/([\w\.]+)/i],[Dt,[bt,"WeChat"]],[/konqueror\/([\w\.]+)/i],[Dt,[bt,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[Dt,[bt,"IE"]],[/ya(?:search)?browser\/([\w\.]+)/i],[Dt,[bt,"Yandex"]],[/slbrowser\/([\w\.]+)/i],[Dt,[bt,"Smart Lenovo "+Qn]],[/(avast|avg)\/([\w\.]+)/i],[[bt,/(.+)/,"$1 Secure "+Qn],Dt],[/\bfocus\/([\w\.]+)/i],[Dt,[bt,go+" Focus"]],[/\bopt\/([\w\.]+)/i],[Dt,[bt,Jn+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[Dt,[bt,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[Dt,[bt,"Dolphin"]],[/coast\/([\w\.]+)/i],[Dt,[bt,Jn+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[Dt,[bt,"MIUI"+vs]],[/fxios\/([\w\.-]+)/i],[Dt,[bt,go]],[/\bqihoobrowser\/?([\w\.]*)/i],[Dt,[bt,"360"]],[/\b(qq)\/([\w\.]+)/i],[[bt,/(.+)/,"$1Browser"],Dt],[/(oculus|sailfish|huawei|vivo|pico)browser\/([\w\.]+)/i],[[bt,/(.+)/,"$1"+vs],Dt],[/samsungbrowser\/([\w\.]+)/i],[Dt,[bt,_r+" Internet"]],[/metasr[\/ ]?([\d\.]+)/i],[Dt,[bt,"Sogou Explorer"]],[/(sogou)mo\w+\/([\d\.]+)/i],[[bt,"Sogou Mobile"],Dt],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|2345(?=browser|chrome|explorer))\w*[\/ ]?v?([\w\.]+)/i],[bt,Dt],[/(lbbrowser|rekonq)/i,/\[(linkedin)app\]/i],[bt],[/ome\/([\w\.]+) \w* ?(iron) saf/i,/ome\/([\w\.]+).+qihu (360)[es]e/i],[Dt,bt],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[bt,En],Dt],[/(Klarna)\/([\w\.]+)/i,/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(alipay)client\/([\w\.]+)/i,/(twitter)(?:and| f.+e\/([\w\.]+))/i,/(chromium|instagram|snapchat)[\/ ]([-\w\.]+)/i],[bt,Dt],[/\bgsa\/([\w\.]+) .*safari\//i],[Dt,[bt,"GSA"]],[/musical_ly(?:.+app_?version\/|_)([\w\.]+)/i],[Dt,[bt,"TikTok"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[Dt,[bt,ur+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[bt,ur+" WebView"],Dt],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[Dt,[bt,"Android "+Qn]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[bt,Dt],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[Dt,[bt,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[Dt,bt],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[bt,[Dt,ZS,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[bt,Dt],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[bt,"Netscape"],Dt],[/(wolvic|librewolf)\/([\w\.]+)/i],[bt,Dt],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[Dt,[bt,go+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i],[bt,[Dt,/_/g,"."]],[/(cobalt)\/([\w\.]+)/i],[bt,[Dt,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[jt,"amd64"]],[/(ia32(?=;))/i],[[jt,Dm]],[/((?:i[346]|x)86)[;\)]/i],[[jt,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[jt,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[jt,"armhf"]],[/windows (ce|mobile); ppc;/i],[[jt,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[jt,/ower/,"",Dm]],[/(sun4\w)[;\)]/i],[[jt,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[jt,Dm]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[Tt,[Mt,_r],[Ot,en]],[/\b((?:s[cgp]h|gt|sm)-(?![lr])\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]((?!sm-[lr])[-\w]+)/i,/sec-(sgh\w+)/i],[Tt,[Mt,_r],[Ot,Ht]],[/(?:\/|\()(ip(?:hone|od)[\w, ]*)(?:\/|;)/i],[Tt,[Mt,hn],[Ot,Ht]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[Tt,[Mt,hn],[Ot,en]],[/(macintosh);/i],[Tt,[Mt,hn]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[Tt,[Mt,Dr],[Ot,Ht]],[/(?:honor)([-\w ]+)[;\)]/i],[Tt,[Mt,"Honor"],[Ot,Ht]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[Tt,[Mt,no],[Ot,en]],[/(?:huawei)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[Tt,[Mt,no],[Ot,Ht]],[/\b(poco[\w ]+|m2\d{3}j\d\d[a-z]{2})(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/oid[^\)]+; (m?[12][0-389][01]\w{3,6}[c-y])( bui|; wv|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite|pro)?)(?: bui|\))/i],[[Tt,/_/g," "],[Mt,Gt],[Ot,Ht]],[/oid[^\)]+; (2\d{4}(283|rpbf)[cgl])( bui|\))/i,/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[Tt,/_/g," "],[Mt,Gt],[Ot,en]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[Tt,[Mt,"OPPO"],[Ot,Ht]],[/\b(opd2\d{3}a?) bui/i],[Tt,[Mt,"OPPO"],[Ot,en]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[Tt,[Mt,"Vivo"],[Ot,Ht]],[/\b(rmx[1-3]\d{3})(?: bui|;|\))/i],[Tt,[Mt,"Realme"],[Ot,Ht]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[Tt,[Mt,fu],[Ot,Ht]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[Tt,[Mt,fu],[Ot,en]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[Tt,[Mt,Yo],[Ot,en]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[Tt,[Mt,Yo],[Ot,Ht]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[Tt,[Mt,"Lenovo"],[Ot,en]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[Tt,/_/g," "],[Mt,"Nokia"],[Ot,Ht]],[/(pixel c)\b/i],[Tt,[Mt,Eo],[Ot,en]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[Tt,[Mt,Eo],[Ot,Ht]],[/droid.+; (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[Tt,[Mt,nr],[Ot,Ht]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[Tt,"Xperia Tablet"],[Mt,nr],[Ot,en]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[Tt,[Mt,"OnePlus"],[Ot,Ht]],[/(alexa)webm/i,/(kf[a-z]{2}wi|aeo(?!bc)\w\w)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[Tt,[Mt,vn],[Ot,en]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[Tt,/(.+)/g,"Fire Phone $1"],[Mt,vn],[Ot,Ht]],[/(playbook);[-\w\),; ]+(rim)/i],[Tt,Mt,[Ot,en]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[Tt,[Mt,Xn],[Ot,Ht]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[Tt,[Mt,Ln],[Ot,en]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[Tt,[Mt,Ln],[Ot,Ht]],[/(nexus 9)/i],[Tt,[Mt,"HTC"],[Ot,en]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[Mt,[Tt,/_/g," "],[Ot,Ht]],[/droid [\w\.]+; ((?:8[14]9[16]|9(?:0(?:48|60|8[01])|1(?:3[27]|66)|2(?:6[69]|9[56])|466))[gqswx])\w*(\)| bui)/i],[Tt,[Mt,"TCL"],[Ot,en]],[/(itel) ((\w+))/i],[[Mt,Dm],Tt,[Ot,ZS,{tablet:["p10001l","w7001"],"*":"mobile"}]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[Tt,[Mt,"Acer"],[Ot,en]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[Tt,[Mt,"Meizu"],[Ot,Ht]],[/; ((?:power )?armor(?:[\w ]{0,8}))(?: bui|\))/i],[Tt,[Mt,"Ulefone"],[Ot,Ht]],[/; (energy ?\w+)(?: bui|\))/i,/; energizer ([\w ]+)(?: bui|\))/i],[Tt,[Mt,"Energizer"],[Ot,Ht]],[/; cat (b35);/i,/; (b15q?|s22 flip|s48c|s62 pro)(?: bui|\))/i],[Tt,[Mt,"Cat"],[Ot,Ht]],[/((?:new )?andromax[\w- ]+)(?: bui|\))/i],[Tt,[Mt,"Smartfren"],[Ot,Ht]],[/droid.+; (a(?:015|06[35]|142p?))/i],[Tt,[Mt,"Nothing"],[Ot,Ht]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron|infinix|tecno|micromax|advan)[-_ ]?([-\w]*)/i,/; (imo) ((?!tab)[\w ]+?)(?: bui|\))/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[Mt,Tt,[Ot,Ht]],[/(imo) (tab \w+)/i,/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[Mt,Tt,[Ot,en]],[/(surface duo)/i],[Tt,[Mt,jo],[Ot,en]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[Tt,[Mt,"Fairphone"],[Ot,Ht]],[/(u304aa)/i],[Tt,[Mt,"AT&T"],[Ot,Ht]],[/\bsie-(\w*)/i],[Tt,[Mt,"Siemens"],[Ot,Ht]],[/\b(rct\w+) b/i],[Tt,[Mt,"RCA"],[Ot,en]],[/\b(venue[\d ]{2,7}) b/i],[Tt,[Mt,"Dell"],[Ot,en]],[/\b(q(?:mv|ta)\w+) b/i],[Tt,[Mt,"Verizon"],[Ot,en]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[Tt,[Mt,"Barnes & Noble"],[Ot,en]],[/\b(tm\d{3}\w+) b/i],[Tt,[Mt,"NuVision"],[Ot,en]],[/\b(k88) b/i],[Tt,[Mt,"ZTE"],[Ot,en]],[/\b(nx\d{3}j) b/i],[Tt,[Mt,"ZTE"],[Ot,Ht]],[/\b(gen\d{3}) b.+49h/i],[Tt,[Mt,"Swiss"],[Ot,Ht]],[/\b(zur\d{3}) b/i],[Tt,[Mt,"Swiss"],[Ot,en]],[/\b((zeki)?tb.*\b) b/i],[Tt,[Mt,"Zeki"],[Ot,en]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[Mt,"Dragon Touch"],Tt,[Ot,en]],[/\b(ns-?\w{0,9}) b/i],[Tt,[Mt,"Insignia"],[Ot,en]],[/\b((nxa|next)-?\w{0,9}) b/i],[Tt,[Mt,"NextBook"],[Ot,en]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[Mt,"Voice"],Tt,[Ot,Ht]],[/\b(lvtel\-)?(v1[12]) b/i],[[Mt,"LvTel"],Tt,[Ot,Ht]],[/\b(ph-1) /i],[Tt,[Mt,"Essential"],[Ot,Ht]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[Tt,[Mt,"Envizen"],[Ot,en]],[/\b(trio[-\w\. ]+) b/i],[Tt,[Mt,"MachSpeed"],[Ot,en]],[/\btu_(1491) b/i],[Tt,[Mt,"Rotor"],[Ot,en]],[/(shield[\w ]+) b/i],[Tt,[Mt,"Nvidia"],[Ot,en]],[/(sprint) (\w+)/i],[Mt,Tt,[Ot,Ht]],[/(kin\.[onetw]{3})/i],[[Tt,/\./g," "],[Mt,jo],[Ot,Ht]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[Tt,[Mt,ln],[Ot,en]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[Tt,[Mt,ln],[Ot,Ht]],[/smart-tv.+(samsung)/i],[Mt,[Ot,Qt]],[/hbbtv.+maple;(\d+)/i],[[Tt,/^/,"SmartTV"],[Mt,_r],[Ot,Qt]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[Mt,Yo],[Ot,Qt]],[/(apple) ?tv/i],[Mt,[Tt,hn+" TV"],[Ot,Qt]],[/crkey/i],[[Tt,ur+"cast"],[Mt,Eo],[Ot,Qt]],[/droid.+aft(\w+)( bui|\))/i],[Tt,[Mt,vn],[Ot,Qt]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[Tt,[Mt,Dr],[Ot,Qt]],[/(bravia[\w ]+)( bui|\))/i],[Tt,[Mt,nr],[Ot,Qt]],[/(mitv-\w{5}) bui/i],[Tt,[Mt,Gt],[Ot,Qt]],[/Hbbtv.*(technisat) (.*);/i],[Mt,Tt,[Ot,Qt]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[Mt,rC],[Tt,rC],[Ot,Qt]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[Ot,Qt]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[Mt,Tt,[Ot,$t]],[/droid.+; (shield) bui/i],[Tt,[Mt,"Nvidia"],[Ot,$t]],[/(playstation [345portablevi]+)/i],[Tt,[Mt,nr],[Ot,$t]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[Tt,[Mt,jo],[Ot,$t]],[/\b(sm-[lr]\d\d[05][fnuw]?s?)\b/i],[Tt,[Mt,_r],[Ot,on]],[/((pebble))app/i],[Mt,Tt,[Ot,on]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[Tt,[Mt,hn],[Ot,on]],[/droid.+; (glass) \d/i],[Tt,[Mt,Eo],[Ot,on]],[/droid.+; (wt63?0{2,3})\)/i],[Tt,[Mt,ln],[Ot,on]],[/droid.+; (glass) \d/i],[Tt,[Mt,Eo],[Ot,on]],[/(pico) (4|neo3(?: link|pro)?)/i],[Mt,Tt,[Ot,on]],[/; (quest( \d| pro)?)/i],[Tt,[Mt,En],[Ot,on]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[Mt,[Ot,Tn]],[/(aeobc)\b/i],[Tt,[Mt,vn],[Ot,Tn]],[/droid .+?; ([^;]+?)(?: bui|; wv\)|\) applew).+? mobile safari/i],[Tt,[Ot,Ht]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[Tt,[Ot,en]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[Ot,en]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[Ot,Ht]],[/(android[-\w\. ]{0,9});.+buil/i],[Tt,[Mt,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[Dt,[bt,"EdgeHTML"]],[/(arkweb)\/([\w\.]+)/i],[bt,Dt],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[Dt,[bt,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna|servo)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i,/\b(libweb)/i],[bt,Dt],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[Dt,bt]],os:[[/microsoft (windows) (vista|xp)/i],[bt,Dt],[/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i],[bt,[Dt,ZS,x1]],[/windows nt 6\.2; (arm)/i,/windows[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i,/(?:win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[Dt,ZS,x1],[bt,"Windows"]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/(?:ios;fbsv\/|iphone.+ios[\/ ])([\d\.]+)/i,/cfnetwork\/.+darwin/i],[[Dt,/_/g,"."],[bt,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[bt,uo],[Dt,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[Dt,bt],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish|openharmony)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[bt,Dt],[/\(bb(10);/i],[Dt,[bt,Xn]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[Dt,[bt,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[Dt,[bt,go+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[Dt,[bt,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[Dt,[bt,"watchOS"]],[/crkey\/([\d\.]+)/i],[Dt,[bt,ur+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[bt,fr],Dt],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[bt,Dt],[/(sunos) ?([\w\.\d]*)/i],[[bt,"Solaris"],Dt],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux|serenityos)/i,/(unix) ?([\w\.]*)/i],[bt,Dt]]},am=function(_c,Al){if(typeof _c===mt&&(Al=_c,_c=ct),!(this instanceof am))return new am(_c,Al).getResult();var Rs=typeof it!==pt&&it.navigator?it.navigator:ct,up=_c||(Rs&&Rs.userAgent?Rs.userAgent:""),h_=Rs&&Rs.userAgentData?Rs.userAgentData:ct,Js=Al?function(Lo,p_){var F0={};for(var W_ in Lo)p_[W_]&&p_[W_].length%2==0?F0[W_]=p_[W_].concat(Lo[W_]):F0[W_]=Lo[W_];return F0}(O1,Al):O1,TE=Rs&&Rs.userAgent==up;return this.getBrowser=function(){var Lo={};return Lo[bt]=ct,Lo[Dt]=ct,B0.call(Lo,up,Js.browser),Lo[vt]=function(p_){return typeof p_===_t?p_.replace(/[^\d\.]/g,"").split(".")[0]:ct}(Lo[Dt]),TE&&Rs&&Rs.brave&&typeof Rs.brave.isBrave==ut&&(Lo[bt]="Brave"),Lo},this.getCPU=function(){var Lo={};return Lo[jt]=ct,B0.call(Lo,up,Js.cpu),Lo},this.getDevice=function(){var Lo={};return Lo[Mt]=ct,Lo[Tt]=ct,Lo[Ot]=ct,B0.call(Lo,up,Js.device),TE&&!Lo[Ot]&&h_&&h_.mobile&&(Lo[Ot]=Ht),TE&&Lo[Tt]=="Macintosh"&&Rs&&typeof Rs.standalone!==pt&&Rs.maxTouchPoints&&Rs.maxTouchPoints>2&&(Lo[Tt]="iPad",Lo[Ot]=en),Lo},this.getEngine=function(){var Lo={};return Lo[bt]=ct,Lo[Dt]=ct,B0.call(Lo,up,Js.engine),Lo},this.getOS=function(){var Lo={};return Lo[bt]=ct,Lo[Dt]=ct,B0.call(Lo,up,Js.os),TE&&!Lo[bt]&&h_&&h_.platform&&h_.platform!="Unknown"&&(Lo[bt]=h_.platform.replace(/chrome os/i,fr).replace(/macos/i,uo)),Lo},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return up},this.setUA=function(Lo){return up=typeof Lo===_t&&Lo.length>500?rC(Lo,500):Lo,this},this.setUA(up),this};am.VERSION="0.7.40",am.BROWSER=Tl([bt,Dt,vt]),am.CPU=Tl([jt]),am.DEVICE=Tl([Tt,Mt,Ot,$t,Ht,Qt,en,on,Tn]),am.ENGINE=am.OS=Tl([bt,Dt]),_e.exports&&(rt=_e.exports=am),rt.UAParser=am;var SE=typeof it!==pt&&(it.jQuery||it.Zepto);if(SE&&!SE.ua){var M1=new am;SE.ua=M1.getResult(),SE.ua.get=function(){return M1.getUA()},SE.ua.set=function(_c){M1.setUA(_c);var Al=M1.getResult();for(var Rs in Al)SE.ua[Rs]=Al[Rs]}}})(typeof window=="object"?window:ot)})(Cx,Cx.exports);var BW=st(Cx.exports),zL=oR.clear;Ko({global:!0,bind:!0,enumerable:!0,forced:wt.clearImmediate!==zL},{clearImmediate:zL});var WL=wt,FW=Nt,VW=an,GW=ey,$W=lr,HW=KE,jW=i0,zW=WL.Function,WW=/MSIE .\./.test($W)||GW==="BUN"&&function(){var _e=WL.Bun.version.split(".");return _e.length<3||_e[0]==="0"&&(_e[1]<3||_e[1]==="3"&&_e[2]==="0")}(),KW=Ko,KL=wt,YL=oR.set,YW=function(_e,rt){var it=rt?2:1;return WW?function(ct,ut){var pt=jW(arguments.length,1)>it,mt=VW(ct)?ct:zW(ct),_t=pt?HW(arguments,it):[],vt=pt?function(){FW(mt,this,_t)}:mt;return rt?_e(vt,ut):_e(vt)}:_e},XL=KL.setImmediate?YW(YL,!1):YL;KW({global:!0,bind:!0,enumerable:!0,forced:KL.setImmediate!==XL},{setImmediate:XL});var qL=st(rr.setImmediate),XW=wt,qW=aN,JW=bo,ZW=i0,QW=dn;Ko({global:!0,enumerable:!0,dontCallGetSet:!0,forced:at(function(){return QW&&Object.getOwnPropertyDescriptor(XW,"queueMicrotask").value.length!==1})},{queueMicrotask:function(_e){ZW(arguments.length,1),qW(JW(_e))}});var JL=st(rr.queueMicrotask);function ZL(_e,rt){return function(){return _e.apply(rt,arguments)}}const{toString:e9}=Object.prototype,{getPrototypeOf:bx}=Object,{iterator:NR,toStringTag:QL}=Symbol,DR=(Rx=Object.create(null),_e=>{const rt=e9.call(_e);return Rx[rt]||(Rx[rt]=rt.slice(8,-1).toLowerCase())});var Rx;const Zm=_e=>(_e=_e.toLowerCase(),rt=>DR(rt)===_e),LR=_e=>rt=>typeof rt===_e,{isArray:iS}=Array,QT=LR("undefined"),e2=Zm("ArrayBuffer"),t9=LR("string"),Pp=LR("function"),t2=LR("number"),kR=_e=>_e!==null&&typeof _e=="object",UR=_e=>{if(DR(_e)!=="object")return!1;const rt=bx(_e);return!(rt!==null&&rt!==Object.prototype&&Object.getPrototypeOf(rt)!==null||QL in _e||NR in _e)},n9=Zm("Date"),r9=Zm("File"),i9=Zm("Blob"),o9=Zm("FileList"),s9=Zm("URLSearchParams"),[a9,c9,l9,u9]=["ReadableStream","Request","Response","Headers"].map(Zm);function eA(_e,rt){let it,ct,{allOwnKeys:ut=!1}=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(_e!=null)if(typeof _e!="object"&&(_e=[_e]),iS(_e))for(it=0,ct=_e.length;it<ct;it++)rt.call(null,_e[it],it,_e);else{const pt=ut?Object.getOwnPropertyNames(_e):Object.keys(_e),mt=pt.length;let _t;for(it=0;it<mt;it++)_t=pt[it],rt.call(null,_e[_t],_t,_e)}}function n2(_e,rt){rt=rt.toLowerCase();const it=Object.keys(_e);let ct,ut=it.length;for(;ut-- >0;)if(ct=it[ut],rt===ct.toLowerCase())return ct;return null}const d0=jL!==void 0?jL:typeof self<"u"?self:typeof window<"u"?window:commonjsGlobal,r2=_e=>!QT(_e)&&_e!==d0,d9=(wx=typeof Uint8Array<"u"&&bx(Uint8Array),_e=>wx&&_e instanceof wx);var wx;const h9=Zm("HTMLFormElement"),i2=(_e=>{let{hasOwnProperty:rt}=_e;return(it,ct)=>rt.call(it,ct)})(Object.prototype),p9=Zm("RegExp"),o2=(_e,rt)=>{const it=Object.getOwnPropertyDescriptors(_e),ct={};eA(it,(ut,pt)=>{let mt;(mt=rt(ut,pt,_e))!==!1&&(ct[pt]=mt||ut)}),Object.defineProperties(_e,ct)},f9=Zm("AsyncFunction"),s2=(a2=typeof qL=="function",c2=Pp(d0.postMessage),a2?qL:c2?(Ix="axios@".concat(Math.random()),BR=[],d0.addEventListener("message",_e=>{let{source:rt,data:it}=_e;rt===d0&&it===Ix&&BR.length&&BR.shift()()},!1),_e=>{BR.push(_e),d0.postMessage(Ix,"*")}):_e=>setTimeout(_e));var a2,c2,Ix,BR;const m9=JL!==void 0?JL.bind(d0):typeof process<"u"&&process.nextTick||s2;var Cr={isArray:iS,isArrayBuffer:e2,isBuffer:function(_e){return _e!==null&&!QT(_e)&&_e.constructor!==null&&!QT(_e.constructor)&&Pp(_e.constructor.isBuffer)&&_e.constructor.isBuffer(_e)},isFormData:_e=>{let rt;return _e&&(typeof FormData=="function"&&_e instanceof FormData||Pp(_e.append)&&((rt=DR(_e))==="formdata"||rt==="object"&&Pp(_e.toString)&&_e.toString()==="[object FormData]"))},isArrayBufferView:function(_e){let rt;return rt=typeof ArrayBuffer<"u"&&ArrayBuffer.isView?ArrayBuffer.isView(_e):_e&&_e.buffer&&e2(_e.buffer),rt},isString:t9,isNumber:t2,isBoolean:_e=>_e===!0||_e===!1,isObject:kR,isPlainObject:UR,isReadableStream:a9,isRequest:c9,isResponse:l9,isHeaders:u9,isUndefined:QT,isDate:n9,isFile:r9,isBlob:i9,isRegExp:p9,isFunction:Pp,isStream:_e=>kR(_e)&&Pp(_e.pipe),isURLSearchParams:s9,isTypedArray:d9,isFileList:o9,forEach:eA,merge:function _e(){const{caseless:rt}=r2(this)&&this||{},it={},ct=(ut,pt)=>{const mt=rt&&n2(it,pt)||pt;UR(it[mt])&&UR(ut)?it[mt]=_e(it[mt],ut):UR(ut)?it[mt]=_e({},ut):iS(ut)?it[mt]=ut.slice():it[mt]=ut};for(let ut=0,pt=arguments.length;ut<pt;ut++)arguments[ut]&&eA(arguments[ut],ct);return it},extend:function(_e,rt,it){let{allOwnKeys:ct}=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return eA(rt,(ut,pt)=>{it&&Pp(ut)?_e[pt]=ZL(ut,it):_e[pt]=ut},{allOwnKeys:ct}),_e},trim:_e=>wu(_e)?wu(_e).call(_e):_e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:_e=>(_e.charCodeAt(0)===65279&&(_e=_e.slice(1)),_e),inherits:(_e,rt,it,ct)=>{_e.prototype=Object.create(rt.prototype,ct),_e.prototype.constructor=_e,Object.defineProperty(_e,"super",{value:rt.prototype}),it&&Object.assign(_e.prototype,it)},toFlatObject:(_e,rt,it,ct)=>{let ut,pt,mt;const _t={};if(rt=rt||{},_e==null)return rt;do{for(ut=Object.getOwnPropertyNames(_e),pt=ut.length;pt-- >0;)mt=ut[pt],ct&&!ct(mt,_e,rt)||_t[mt]||(rt[mt]=_e[mt],_t[mt]=!0);_e=it!==!1&&bx(_e)}while(_e&&(!it||it(_e,rt))&&_e!==Object.prototype);return rt},kindOf:DR,kindOfTest:Zm,endsWith:(_e,rt,it)=>{_e=String(_e),(it===void 0||it>_e.length)&&(it=_e.length),it-=rt.length;const ct=_e.indexOf(rt,it);return ct!==-1&&ct===it},toArray:_e=>{if(!_e)return null;if(iS(_e))return _e;let rt=_e.length;if(!t2(rt))return null;const it=new Array(rt);for(;rt-- >0;)it[rt]=_e[rt];return it},forEachEntry:(_e,rt)=>{const it=(_e&&_e[NR]).call(_e);let ct;for(;(ct=it.next())&&!ct.done;){const ut=ct.value;rt.call(_e,ut[0],ut[1])}},matchAll:(_e,rt)=>{let it;const ct=[];for(;(it=_e.exec(rt))!==null;)ct.push(it);return ct},isHTMLForm:h9,hasOwnProperty:i2,hasOwnProp:i2,reduceDescriptors:o2,freezeMethods:_e=>{o2(_e,(rt,it)=>{if(Pp(_e)&&["arguments","caller","callee"].indexOf(it)!==-1)return!1;const ct=_e[it];Pp(ct)&&(rt.enumerable=!1,"writable"in rt?rt.writable=!1:rt.set||(rt.set=()=>{throw Error("Can not rewrite read-only method '"+it+"'")}))})},toObjectSet:(_e,rt)=>{const it={},ct=ut=>{ut.forEach(pt=>{it[pt]=!0})};return iS(_e)?ct(_e):ct(String(_e).split(rt)),it},toCamelCase:_e=>_e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(rt,it,ct){return it.toUpperCase()+ct}),noop:()=>{},toFiniteNumber:(_e,rt)=>_e!=null&&Number.isFinite(_e=+_e)?_e:rt,findKey:n2,global:d0,isContextDefined:r2,isSpecCompliantForm:function(_e){return!!(_e&&Pp(_e.append)&&_e[QL]==="FormData"&&_e[NR])},toJSONObject:_e=>{const rt=new Array(10),it=(ct,ut)=>{if(kR(ct)){if(rt.indexOf(ct)>=0)return;if(!("toJSON"in ct)){rt[ut]=ct;const pt=iS(ct)?[]:{};return eA(ct,(mt,_t)=>{const vt=it(mt,ut+1);!QT(vt)&&(pt[_t]=vt)}),rt[ut]=void 0,pt}}return ct};return it(_e,0)},isAsyncFn:f9,isThenable:_e=>_e&&(kR(_e)||Pp(_e))&&Pp(_e.then)&&Pp(_e.catch),setImmediate:s2,asap:m9,isIterable:_e=>_e!=null&&Pp(_e[NR])};function ls(_e,rt,it,ct,ut){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=_e,this.name="AxiosError",rt&&(this.code=rt),it&&(this.config=it),ct&&(this.request=ct),ut&&(this.response=ut,this.status=ut.status?ut.status:null)}Cr.inherits(ls,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:Cr.toJSONObject(this.config),code:this.code,status:this.status}}});const l2=ls.prototype,u2={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(_e=>{u2[_e]={value:_e}}),Object.defineProperties(ls,u2),Object.defineProperty(l2,"isAxiosError",{value:!0}),ls.from=(_e,rt,it,ct,ut,pt)=>{const mt=Object.create(l2);return Cr.toFlatObject(_e,mt,function(_t){return _t!==Error.prototype},_t=>_t!=="isAxiosError"),ls.call(mt,_e.message,rt,it,ct,ut),mt.cause=_e,mt.name=_e.name,pt&&Object.assign(mt,pt),mt};function xx(_e){return Cr.isPlainObject(_e)||Cr.isArray(_e)}function d2(_e){return Cr.endsWith(_e,"[]")?_e.slice(0,-2):_e}function h2(_e,rt,it){return _e?_e.concat(rt).map(function(ct,ut){return ct=d2(ct),!it&&ut?"["+ct+"]":ct}).join(it?".":""):rt}const g9=Cr.toFlatObject(Cr,{},null,function(_e){return/^is[A-Z]/.test(_e)});function FR(_e,rt,it){if(!Cr.isObject(_e))throw new TypeError("target must be an object");rt=rt||new FormData;const ct=(it=Cr.toFlatObject(it,{metaTokens:!0,dots:!1,indexes:!1},!1,function(Mt,Dt){return!Cr.isUndefined(Dt[Mt])})).metaTokens,ut=it.visitor||Tt,pt=it.dots,mt=it.indexes,_t=(it.Blob||typeof Blob<"u"&&Blob)&&Cr.isSpecCompliantForm(rt);if(!Cr.isFunction(ut))throw new TypeError("visitor must be a function");function vt(Mt){if(Mt===null)return"";if(Cr.isDate(Mt))return Mt.toISOString();if(!_t&&Cr.isBlob(Mt))throw new ls("Blob is not supported. Use a Buffer instead.");return Cr.isArrayBuffer(Mt)||Cr.isTypedArray(Mt)?_t&&typeof Blob=="function"?new Blob([Mt]):Buffer.from(Mt):Mt}function Tt(Mt,Dt,jt){let $t=Mt;if(Mt&&!jt&&typeof Mt=="object"){if(Cr.endsWith(Dt,"{}"))Dt=ct?Dt:Dt.slice(0,-2),Mt=JSON.stringify(Mt);else if(Cr.isArray(Mt)&&function(Ht){return Cr.isArray(Ht)&&!Ht.some(xx)}(Mt)||(Cr.isFileList(Mt)||Cr.endsWith(Dt,"[]"))&&($t=Cr.toArray(Mt)))return Dt=d2(Dt),$t.forEach(function(Ht,en){!Cr.isUndefined(Ht)&&Ht!==null&&rt.append(mt===!0?h2([Dt],en,pt):mt===null?Dt:Dt+"[]",vt(Ht))}),!1}return!!xx(Mt)||(rt.append(h2(jt,Dt,pt),vt(Mt)),!1)}const bt=[],Ot=Object.assign(g9,{defaultVisitor:Tt,convertValue:vt,isVisitable:xx});if(!Cr.isObject(_e))throw new TypeError("data must be an object");return function Mt(Dt,jt){if(!Cr.isUndefined(Dt)){if(bt.indexOf(Dt)!==-1)throw Error("Circular reference detected in "+jt.join("."));bt.push(Dt),Cr.forEach(Dt,function($t,Ht){(!(Cr.isUndefined($t)||$t===null)&&ut.call(rt,$t,Cr.isString(Ht)?wu(Ht).call(Ht):Ht,jt,Ot))===!0&&Mt($t,jt?jt.concat(Ht):[Ht])}),bt.pop()}}(_e),rt}function p2(_e){const rt={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(_e).replace(/[!'()~]|%20|%00/g,function(it){return rt[it]})}function Ox(_e,rt){this._pairs=[],_e&&FR(_e,this,rt)}const f2=Ox.prototype;function _9(_e){return encodeURIComponent(_e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function m2(_e,rt,it){if(!rt)return _e;const ct=it&&it.encode||_9;Cr.isFunction(it)&&(it={serialize:it});const ut=it&&it.serialize;let pt;if(pt=ut?ut(rt,it):Cr.isURLSearchParams(rt)?rt.toString():new Ox(rt,it).toString(ct),pt){const mt=_e.indexOf("#");mt!==-1&&(_e=_e.slice(0,mt)),_e+=(_e.indexOf("?")===-1?"?":"&")+pt}return _e}f2.append=function(_e,rt){this._pairs.push([_e,rt])},f2.toString=function(_e){const rt=_e?function(it){return _e.call(this,it,p2)}:p2;return this._pairs.map(function(it){return rt(it[0])+"="+rt(it[1])},"").join("&")};var g2=class{constructor(){this.handlers=[]}use(_e,rt,it){return this.handlers.push({fulfilled:_e,rejected:rt,synchronous:!!it&&it.synchronous,runWhen:it?it.runWhen:null}),this.handlers.length-1}eject(_e){this.handlers[_e]&&(this.handlers[_e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(_e){Cr.forEach(this.handlers,function(rt){rt!==null&&_e(rt)})}},_2={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},E2={exports:{}},E9=Ko,v9=dn,v2=Mu.f;E9({target:"Object",stat:!0,forced:Object.defineProperty!==v2,sham:!v9},{defineProperty:v2});var y2=rr.Object,y9=E2.exports=function(_e,rt,it){return y2.defineProperty(_e,rt,it)};y2.defineProperty.sham&&(y9.sham=!0);var S2=st(E2.exports),S9=TypeError,T2=VE,T9=iR,A9=Wn,C9=xo("species"),A2=Array,b9=function(_e){var rt;return T2(_e)&&(rt=_e.constructor,(T9(rt)&&(rt===A2||T2(rt.prototype))||A9(rt)&&(rt=rt[C9])===null)&&(rt=void 0)),rt===void 0?A2:rt},C2=function(_e,rt){return new(b9(_e))(rt===0?0:rt)},R9=at,w9=Nr,I9=xo("species"),b2=function(_e){return w9>=51||!R9(function(){var rt=[];return(rt.constructor={})[I9]=function(){return{foo:1}},rt[_e](Boolean).foo!==1})},x9=Ko,O9=at,M9=VE,P9=Wn,N9=wr,D9=hm,R2=function(_e){if(_e>9007199254740991)throw S9("Maximum allowed index exceeded");return _e},w2=HI,L9=C2,k9=b2,U9=Nr,I2=xo("isConcatSpreadable"),B9=U9>=51||!O9(function(){var _e=[];return _e[I2]=!1,_e.concat()[0]!==_e}),F9=function(_e){if(!P9(_e))return!1;var rt=_e[I2];return rt!==void 0?!!rt:M9(_e)};x9({target:"Array",proto:!0,arity:1,forced:!B9||!k9("concat")},{concat:function(_e){var rt,it,ct,ut,pt,mt=N9(this),_t=L9(mt,0),vt=0;for(rt=-1,ct=arguments.length;rt<ct;rt++)if(F9(pt=rt===-1?mt:arguments[rt]))for(ut=D9(pt),R2(vt+ut),it=0;it<ut;it++,vt++)it in pt&&w2(_t,vt,pt[it]);else R2(vt+1),w2(_t,vt++,pt);return _t.length=vt,_t}});var x2={},V9=zt,G9=Bn,O2=Lu.f,$9=KE,M2=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];x2.f=function(_e){return M2&&V9(_e)==="Window"?function(rt){try{return O2(rt)}catch{return $9(M2)}}(_e):O2(G9(_e))};var oS={},H9=xo;oS.f=H9;var P2=rr,j9=$r,z9=oS,W9=Mu.f,$l=function(_e){var rt=P2.Symbol||(P2.Symbol={});j9(rt,_e)||W9(rt,_e,{value:z9.f(_e)})},K9=Pn,Y9=sn,X9=xo,q9=b_,N2=function(){var _e=Y9("Symbol"),rt=_e&&_e.prototype,it=rt&&rt.valueOf,ct=X9("toPrimitive");rt&&!rt[ct]&&q9(rt,ct,function(ut){return K9(it,this)},{arity:1})},J9=au,Z9=qn,Q9=wr,e7=hm,t7=C2,D2=Et([].push),QE=function(_e){var rt=_e===1,it=_e===2,ct=_e===3,ut=_e===4,pt=_e===6,mt=_e===7,_t=_e===5||pt;return function(vt,Tt,bt,Ot){for(var Mt,Dt,jt=Q9(vt),$t=Z9(jt),Ht=e7($t),en=J9(Tt,bt),Qt=0,on=Ot||t7,Tn=rt?on(vt,Ht):it||mt?on(vt,0):void 0;Ht>Qt;Qt++)if((_t||Qt in $t)&&(Dt=en(Mt=$t[Qt],Qt,jt),_e))if(rt)Tn[Qt]=Dt;else if(Dt)switch(_e){case 3:return!0;case 5:return Mt;case 6:return Qt;case 2:D2(Tn,Mt)}else switch(_e){case 4:return!1;case 7:D2(Tn,Mt)}return pt?-1:ct||ut?ut:Tn}},L2={forEach:QE(0),map:QE(1),filter:QE(2),some:QE(3),every:QE(4),find:QE(5),findIndex:QE(6),filterReject:QE(7)},VR=Ko,tA=wt,Mx=Pn,n7=Et,sS=dn,aS=oo,r7=at,Bu=$r,i7=yt,Px=Gl,GR=Bn,Nx=zp,o7=Ku,Dx=bn,cS=zv,k2=nE,s7=Lu,U2=x2,a7=GE,B2=fn,F2=Mu,c7=Yp,V2=yn,G2=b_,l7=rR,Lx=gr,$2=vu,H2=eo,u7=xo,d7=oS,h7=$l,p7=N2,f7=er,j2=Ym,$R=L2.forEach,Np=oy("hidden"),HR="Symbol",nA="prototype",m7=j2.set,z2=j2.getterFor(HR),Qm=Object[nA],h0=tA.Symbol,jR=h0&&h0[nA],g7=tA.RangeError,_7=tA.TypeError,kx=tA.QObject,W2=B2.f,p0=F2.f,K2=U2.f,E7=V2.f,Y2=n7([].push),uE=Lx("symbols"),rA=Lx("op-symbols"),v7=Lx("wks"),Ux=!kx||!kx[nA]||!kx[nA].findChild,X2=function(_e,rt,it){var ct=W2(Qm,rt);ct&&delete Qm[rt],p0(_e,rt,it),ct&&_e!==Qm&&p0(Qm,rt,ct)},Bx=sS&&r7(function(){return cS(p0({},"a",{get:function(){return p0(this,"a",{value:7}).a}})).a!==7})?X2:p0,Fx=function(_e,rt){var it=uE[_e]=cS(jR);return m7(it,{type:HR,tag:_e,description:rt}),sS||(it.description=rt),it},zR=function(_e,rt,it){_e===Qm&&zR(rA,rt,it),Px(_e);var ct=Nx(rt);return Px(it),Bu(uE,ct)?(it.enumerable?(Bu(_e,Np)&&_e[Np][ct]&&(_e[Np][ct]=!1),it=cS(it,{enumerable:Dx(0,!1)})):(Bu(_e,Np)||p0(_e,Np,Dx(1,cS(null))),_e[Np][ct]=!0),Bx(_e,ct,it)):p0(_e,ct,it)},Vx=function(_e,rt){Px(_e);var it=GR(rt),ct=k2(it).concat(Q2(it));return $R(ct,function(ut){sS&&!Mx(q2,it,ut)||zR(_e,ut,it[ut])}),_e},q2=function(_e){var rt=Nx(_e),it=Mx(E7,this,rt);return!(this===Qm&&Bu(uE,rt)&&!Bu(rA,rt))&&(!(it||!Bu(this,rt)||!Bu(uE,rt)||Bu(this,Np)&&this[Np][rt])||it)},J2=function(_e,rt){var it=GR(_e),ct=Nx(rt);if(it!==Qm||!Bu(uE,ct)||Bu(rA,ct)){var ut=W2(it,ct);return!ut||!Bu(uE,ct)||Bu(it,Np)&&it[Np][ct]||(ut.enumerable=!0),ut}},Z2=function(_e){var rt=K2(GR(_e)),it=[];return $R(rt,function(ct){Bu(uE,ct)||Bu($2,ct)||Y2(it,ct)}),it},Q2=function(_e){var rt=_e===Qm,it=K2(rt?rA:GR(_e)),ct=[];return $R(it,function(ut){!Bu(uE,ut)||rt&&!Bu(Qm,ut)||Y2(ct,uE[ut])}),ct};aS||(h0=function(){if(i7(jR,this))throw new _7("Symbol is not a constructor");var _e=arguments.length&&arguments[0]!==void 0?o7(arguments[0]):void 0,rt=H2(_e),it=function(ct){var ut=this===void 0?tA:this;ut===Qm&&Mx(it,rA,ct),Bu(ut,Np)&&Bu(ut[Np],rt)&&(ut[Np][rt]=!1);var pt=Dx(1,ct);try{Bx(ut,rt,pt)}catch(mt){if(!(mt instanceof g7))throw mt;X2(ut,rt,pt)}};return sS&&Ux&&Bx(Qm,rt,{configurable:!0,set:it}),Fx(rt,_e)},G2(jR=h0[nA],"toString",function(){return z2(this).tag}),G2(h0,"withoutSetter",function(_e){return Fx(H2(_e),_e)}),V2.f=q2,F2.f=zR,c7.f=Vx,B2.f=J2,s7.f=U2.f=Z2,a7.f=Q2,d7.f=function(_e){return Fx(u7(_e),_e)},sS&&l7(jR,"description",{configurable:!0,get:function(){return z2(this).description}})),VR({global:!0,constructor:!0,wrap:!0,forced:!aS,sham:!aS},{Symbol:h0}),$R(k2(v7),function(_e){h7(_e)}),VR({target:HR,stat:!0,forced:!aS},{useSetter:function(){Ux=!0},useSimple:function(){Ux=!1}}),VR({target:"Object",stat:!0,forced:!aS,sham:!sS},{create:function(_e,rt){return rt===void 0?cS(_e):Vx(cS(_e),rt)},defineProperty:zR,defineProperties:Vx,getOwnPropertyDescriptor:J2}),VR({target:"Object",stat:!0,forced:!aS},{getOwnPropertyNames:Z2}),p7(),f7(h0,HR),$2[Np]=!0;var _k=oo&&!!Symbol.for&&!!Symbol.keyFor,y7=Ko,S7=sn,T7=$r,A7=Ku,eU=gr,C7=_k,Gx=eU("string-to-symbol-registry"),b7=eU("symbol-to-string-registry");y7({target:"Symbol",stat:!0,forced:!C7},{for:function(_e){var rt=A7(_e);if(T7(Gx,rt))return Gx[rt];var it=S7("Symbol")(rt);return Gx[rt]=it,b7[it]=rt,it}});var R7=Ko,w7=$r,I7=ko,x7=Jo,O7=_k,tU=gr("symbol-to-string-registry");R7({target:"Symbol",stat:!0,forced:!O7},{keyFor:function(_e){if(!I7(_e))throw new TypeError(x7(_e)+" is not a symbol");if(w7(tU,_e))return tU[_e]}});var nU=VE,M7=an,rU=zt,P7=Ku,iU=Et([].push),N7=Ko,oU=sn,sU=Nt,D7=Pn,iA=Et,aU=at,cU=an,lU=ko,uU=KE,L7=function(_e){if(M7(_e))return _e;if(nU(_e)){for(var rt=_e.length,it=[],ct=0;ct<rt;ct++){var ut=_e[ct];typeof ut=="string"?iU(it,ut):typeof ut!="number"&&rU(ut)!=="Number"&&rU(ut)!=="String"||iU(it,P7(ut))}var pt=it.length,mt=!0;return function(_t,vt){if(mt)return mt=!1,vt;if(nU(this))return vt;for(var Tt=0;Tt<pt;Tt++)if(it[Tt]===_t)return vt}}},k7=oo,U7=String,ev=oU("JSON","stringify"),WR=iA(/./.exec),dU=iA("".charAt),B7=iA("".charCodeAt),F7=iA("".replace),V7=iA(1 .toString),G7=/[\uD800-\uDFFF]/g,hU=/^[\uD800-\uDBFF]$/,pU=/^[\uDC00-\uDFFF]$/,fU=!k7||aU(function(){var _e=oU("Symbol")("stringify detection");return ev([_e])!=="[null]"||ev({a:_e})!=="{}"||ev(Object(_e))!=="{}"}),mU=aU(function(){return ev("\uDF06\uD834")!=='"\\udf06\\ud834"'||ev("\uDEAD")!=='"\\udead"'}),$7=function(_e,rt){var it=uU(arguments),ct=L7(rt);if(cU(ct)||_e!==void 0&&!lU(_e))return it[1]=function(ut,pt){if(cU(ct)&&(pt=D7(ct,this,U7(ut),pt)),!lU(pt))return pt},sU(ev,null,it)},H7=function(_e,rt,it){var ct=dU(it,rt-1),ut=dU(it,rt+1);return WR(hU,_e)&&!WR(pU,ut)||WR(pU,_e)&&!WR(hU,ct)?"\\u"+V7(B7(_e,0),16):_e};ev&&N7({target:"JSON",stat:!0,arity:3,forced:fU||mU},{stringify:function(_e,rt,it){var ct=uU(arguments),ut=sU(fU?$7:ev,null,ct);return mU&&typeof ut=="string"?F7(ut,G7,H7):ut}});var gU=GE,j7=wr;Ko({target:"Object",stat:!0,forced:!oo||at(function(){gU.f(1)})},{getOwnPropertySymbols:function(_e){var rt=gU.f;return rt?rt(j7(_e)):[]}}),$l("asyncIterator"),$l("hasInstance"),$l("isConcatSpreadable"),$l("iterator"),$l("match"),$l("matchAll"),$l("replace"),$l("search"),$l("species"),$l("split");var z7=N2;$l("toPrimitive"),z7();var W7=sn,K7=er;$l("toStringTag"),K7(W7("Symbol"),"Symbol"),$l("unscopables"),er(wt.JSON,"JSON",!0);var Y7=rr.Symbol,X7=xo,q7=Mu.f,_U=X7("metadata"),EU=Function.prototype;EU[_U]===void 0&&q7(EU,_U,{value:null}),$l("asyncDispose"),$l("dispose"),$l("metadata");var J7=Y7,Z7=Et,$x=sn("Symbol"),Q7=$x.keyFor,eK=Z7($x.prototype.valueOf),vU=$x.isRegisteredSymbol||function(_e){try{return Q7(eK(_e))!==void 0}catch{return!1}};Ko({target:"Symbol",stat:!0},{isRegisteredSymbol:vU});for(var tK=gr,yU=sn,nK=Et,rK=ko,iK=xo,KR=yU("Symbol"),SU=KR.isWellKnownSymbol,TU=yU("Object","getOwnPropertyNames"),oK=nK(KR.prototype.valueOf),AU=tK("wks"),Hx=0,CU=TU(KR),sK=CU.length;Hx<sK;Hx++)try{var bU=CU[Hx];rK(KR[bU])&&iK(bU)}catch{}var RU=function(_e){if(SU&&SU(_e))return!0;try{for(var rt=oK(_e),it=0,ct=TU(AU),ut=ct.length;it<ut;it++)if(AU[ct[it]]==rt)return!0}catch{}return!1};Ko({target:"Symbol",stat:!0,forced:!0},{isWellKnownSymbol:RU}),$l("customMatcher"),$l("observable"),Ko({target:"Symbol",stat:!0,name:"isRegisteredSymbol"},{isRegistered:vU}),Ko({target:"Symbol",stat:!0,name:"isWellKnownSymbol",forced:!0},{isWellKnown:RU}),$l("matcher"),$l("metadataKey"),$l("patternMatch"),$l("replaceAll");var lS=st(J7),wU=st(oS.f("iterator"));function oA(_e){return oA=typeof lS=="function"&&typeof wU=="symbol"?function(rt){return typeof rt}:function(rt){return rt&&typeof lS=="function"&&rt.constructor===lS&&rt!==lS.prototype?"symbol":typeof rt},oA(_e)}var aK=st(oS.f("toPrimitive"));function cK(_e){var rt=function(it,ct){if(oA(it)!="object"||!it)return it;var ut=it[aK];if(ut!==void 0){var pt=ut.call(it,ct||"default");if(oA(pt)!="object")return pt;throw new TypeError("@@toPrimitive must return a primitive value.")}return(ct==="string"?String:Number)(it)}(_e,"string");return oA(rt)=="symbol"?rt:rt+""}function Jt(_e,rt,it){return(rt=cK(rt))in _e?S2(_e,rt,{value:it,enumerable:!0,configurable:!0,writable:!0}):_e[rt]=it,_e}var IU=st(l8),lK={isBrowser:!0,classes:{URLSearchParams:IU!==void 0?IU:Ox,FormData:typeof FormData<"u"?FormData:null,Blob:typeof Blob<"u"?Blob:null},protocols:["http","https","file","blob","url","data"]};const jx=typeof window<"u"&&typeof document<"u",zx=typeof navigator=="object"&&navigator||void 0,uK=jx&&(!zx||["ReactNative","NativeScript","NS"].indexOf(zx.product)<0),dK=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",hK=jx&&window.location.href||"http://localhost";function xU(_e,rt){var it=Object.keys(_e);if(Object.getOwnPropertySymbols){var ct=Object.getOwnPropertySymbols(_e);rt&&(ct=ct.filter(function(ut){return Object.getOwnPropertyDescriptor(_e,ut).enumerable})),it.push.apply(it,ct)}return it}function OU(_e){for(var rt=1;rt<arguments.length;rt++){var it=arguments[rt]!=null?arguments[rt]:{};rt%2?xU(Object(it),!0).forEach(function(ct){Jt(_e,ct,it[ct])}):Object.getOwnPropertyDescriptors?Object.defineProperties(_e,Object.getOwnPropertyDescriptors(it)):xU(Object(it)).forEach(function(ct){Object.defineProperty(_e,ct,Object.getOwnPropertyDescriptor(it,ct))})}return _e}var ip=OU(OU({},Object.freeze({__proto__:null,hasBrowserEnv:jx,hasStandardBrowserEnv:uK,hasStandardBrowserWebWorkerEnv:dK,navigator:zx,origin:hK})),lK),pK=Gl,fK=Pn,mK=$r,gK=yt,_K=function(){var _e=pK(this),rt="";return _e.hasIndices&&(rt+="d"),_e.global&&(rt+="g"),_e.ignoreCase&&(rt+="i"),_e.multiline&&(rt+="m"),_e.dotAll&&(rt+="s"),_e.unicode&&(rt+="u"),_e.unicodeSets&&(rt+="v"),_e.sticky&&(rt+="y"),rt},MU=RegExp.prototype,PU=function(_e){var rt=_e.flags;return rt!==void 0||"flags"in MU||mK(_e,"flags")||!gK(MU,_e)?rt:fK(_K,_e)},EK=II.charAt,NU=Pn,vK=Gl,yK=an,SK=zt,TK=/./.exec,AK=TypeError,CK=Ko,DU=Pn,LU=qt,bK=eu,YR=tR,kU=wn,UU=E_,sA=Ku,RK=Gl,wK=Wn,IK=zt,xK=W0,BU=PU,OK=ss,MK=at,PK=tI,NK=function(_e,rt,it){return rt+(it?EK(_e,rt).length:1)},DK=function(_e,rt){var it=_e.exec;if(yK(it)){var ct=NU(it,_e,rt);return ct!==null&&vK(ct),ct}if(SK(_e)==="RegExp")return NU(TK,_e,rt);throw new AK("RegExp#exec called on incompatible receiver")},FU=Ym,LK=xo("matchAll"),VU="RegExp String",GU=VU+" Iterator",kK=FU.set,UK=FU.getterFor(GU),BK=TypeError,Wx=LU("".indexOf),XR=LU("".matchAll),Kx=!!XR&&!MK(function(){XR("a",/./)}),FK=bK(function(_e,rt,it,ct){kK(this,{type:GU,regexp:_e,string:rt,global:it,unicode:ct,done:!1})},VU,function(){var _e=UK(this);if(_e.done)return YR(void 0,!0);var rt=_e.regexp,it=_e.string,ct=DK(rt,it);return ct===null?(_e.done=!0,YR(void 0,!0)):_e.global?(sA(ct[0])===""&&(rt.lastIndex=NK(it,UU(rt.lastIndex),_e.unicode)),YR(ct,!1)):(_e.done=!0,YR(ct,!1))}),$U=function(_e){var rt,it,ct,ut=RK(this),pt=sA(_e),mt=PK(ut,RegExp),_t=sA(BU(ut));return rt=new mt(mt===RegExp?ut.source:ut,_t),it=!!~Wx(_t,"g"),ct=!!~Wx(_t,"u"),rt.lastIndex=UU(ut.lastIndex),new FK(rt,pt,it,ct)};CK({target:"String",proto:!0,forced:Kx},{matchAll:function(_e){var rt,it,ct,ut,pt=kU(this);if(wK(_e)){if(xK(_e)&&(rt=sA(kU(BU(_e))),!~Wx(rt,"g")))throw new BK("`.matchAll` does not allow non-global regexes");if(Kx)return XR(pt,_e);if((ct=OK(_e,LK))===void 0&&IK(_e)==="RegExp"&&(ct=$U),ct)return DU(ct,_e,pt)}else if(Kx)return XR(pt,_e);return it=sA(pt),ut=new RegExp(_e,"g"),DU($U,ut,it)}});var VK=tp("String","matchAll"),GK=yt,$K=VK,Yx=String.prototype,HK=function(_e){var rt=_e.matchAll;return typeof _e=="string"||_e===Yx||GK(Yx,_e)&&rt===Yx.matchAll?$K:rt},jK=st(HK);function HU(_e){function rt(it,ct,ut,pt){let mt=it[pt++];if(mt==="__proto__")return!0;const _t=Number.isFinite(+mt),vt=pt>=it.length;return mt=!mt&&Cr.isArray(ut)?ut.length:mt,vt?(Cr.hasOwnProp(ut,mt)?ut[mt]=[ut[mt],ct]:ut[mt]=ct,!_t):(ut[mt]&&Cr.isObject(ut[mt])||(ut[mt]=[]),rt(it,ct,ut[mt],pt)&&Cr.isArray(ut[mt])&&(ut[mt]=function(Tt){const bt={},Ot=Object.keys(Tt);let Mt;const Dt=Ot.length;let jt;for(Mt=0;Mt<Dt;Mt++)jt=Ot[Mt],bt[jt]=Tt[jt];return bt}(ut[mt])),!_t)}if(Cr.isFormData(_e)&&Cr.isFunction(_e.entries)){const it={};return Cr.forEachEntry(_e,(ct,ut)=>{rt(function(pt){return jK(Cr).call(Cr,/\w+|\[(\w*)]/g,pt).map(mt=>mt[0]==="[]"?"":mt[1]||mt[0])}(ct),ut,it,0)}),it}return null}const Xx={transitional:_2,adapter:["xhr","http","fetch"],transformRequest:[function(_e,rt){const it=rt.getContentType()||"",ct=it.indexOf("application/json")>-1,ut=Cr.isObject(_e);if(ut&&Cr.isHTMLForm(_e)&&(_e=new FormData(_e)),Cr.isFormData(_e))return ct?JSON.stringify(HU(_e)):_e;if(Cr.isArrayBuffer(_e)||Cr.isBuffer(_e)||Cr.isStream(_e)||Cr.isFile(_e)||Cr.isBlob(_e)||Cr.isReadableStream(_e))return _e;if(Cr.isArrayBufferView(_e))return _e.buffer;if(Cr.isURLSearchParams(_e))return rt.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),_e.toString();let pt;if(ut){if(it.indexOf("application/x-www-form-urlencoded")>-1)return function(mt,_t){return FR(mt,new ip.classes.URLSearchParams,Object.assign({visitor:function(vt,Tt,bt,Ot){return ip.isNode&&Cr.isBuffer(vt)?(this.append(Tt,vt.toString("base64")),!1):Ot.defaultVisitor.apply(this,arguments)}},_t))}(_e,this.formSerializer).toString();if((pt=Cr.isFileList(_e))||it.indexOf("multipart/form-data")>-1){const mt=this.env&&this.env.FormData;return FR(pt?{"files[]":_e}:_e,mt&&new mt,this.formSerializer)}}return ut||ct?(rt.setContentType("application/json",!1),function(mt,_t,vt){if(Cr.isString(mt))try{return(_t||JSON.parse)(mt),wu(Cr).call(Cr,mt)}catch(Tt){if(Tt.name!=="SyntaxError")throw Tt}return(vt||JSON.stringify)(mt)}(_e)):_e}],transformResponse:[function(_e){const rt=this.transitional||Xx.transitional,it=rt&&rt.forcedJSONParsing,ct=this.responseType==="json";if(Cr.isResponse(_e)||Cr.isReadableStream(_e))return _e;if(_e&&Cr.isString(_e)&&(it&&!this.responseType||ct)){const ut=!(rt&&rt.silentJSONParsing)&&ct;try{return JSON.parse(_e)}catch(pt){if(ut)throw pt.name==="SyntaxError"?ls.from(pt,ls.ERR_BAD_RESPONSE,this,null,this.response):pt}}return _e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:ip.classes.FormData,Blob:ip.classes.Blob},validateStatus:function(_e){return _e>=200&&_e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};Cr.forEach(["delete","get","head","post","put","patch"],_e=>{Xx.headers[_e]={}});var qx=Xx;const zK=Cr.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),jU=Symbol("internals");function aA(_e){var rt;return _e&&wu(rt=String(_e)).call(rt).toLowerCase()}function qR(_e){return _e===!1||_e==null?_e:Cr.isArray(_e)?_e.map(qR):String(_e)}function Jx(_e,rt,it,ct,ut){return Cr.isFunction(ct)?ct.call(this,rt,it):(ut&&(rt=it),Cr.isString(rt)?Cr.isString(ct)?rt.indexOf(ct)!==-1:Cr.isRegExp(ct)?ct.test(rt):void 0:void 0)}class JR{constructor(rt){rt&&this.set(rt)}set(rt,it,ct){const ut=this;function pt(vt,Tt,bt){const Ot=aA(Tt);if(!Ot)throw new Error("header name must be a non-empty string");const Mt=Cr.findKey(ut,Ot);(!Mt||ut[Mt]===void 0||bt===!0||bt===void 0&&ut[Mt]!==!1)&&(ut[Mt||Tt]=qR(vt))}const mt=(vt,Tt)=>Cr.forEach(vt,(bt,Ot)=>pt(bt,Ot,Tt));if(Cr.isPlainObject(rt)||rt instanceof this.constructor)mt(rt,it);else if(Cr.isString(rt)&&(rt=wu(rt).call(rt))&&!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(wu(_t=rt).call(_t)))mt((vt=>{const Tt={};let bt,Ot,Mt;return vt&&vt.split(`
`).forEach(function(Dt){var jt,$t;Mt=Dt.indexOf(":"),bt=wu(jt=Dt.substring(0,Mt)).call(jt).toLowerCase(),Ot=wu($t=Dt.substring(Mt+1)).call($t),!bt||Tt[bt]&&zK[bt]||(bt==="set-cookie"?Tt[bt]?Tt[bt].push(Ot):Tt[bt]=[Ot]:Tt[bt]=Tt[bt]?Tt[bt]+", "+Ot:Ot)}),Tt})(rt),it);else if(Cr.isObject(rt)&&Cr.isIterable(rt)){let vt,Tt,bt={};for(const Ot of rt){if(!Cr.isArray(Ot))throw TypeError("Object iterator must return a key-value pair");bt[Tt=Ot[0]]=(vt=bt[Tt])?Cr.isArray(vt)?[...vt,Ot[1]]:[vt,Ot[1]]:Ot[1]}mt(bt,it)}else rt!=null&&pt(it,rt,ct);var _t;return this}get(rt,it){if(rt=aA(rt)){const ct=Cr.findKey(this,rt);if(ct){const ut=this[ct];if(!it)return ut;if(it===!0)return function(pt){const mt=Object.create(null),_t=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let vt;for(;vt=_t.exec(pt);)mt[vt[1]]=vt[2];return mt}(ut);if(Cr.isFunction(it))return it.call(this,ut,ct);if(Cr.isRegExp(it))return it.exec(ut);throw new TypeError("parser must be boolean|regexp|function")}}}has(rt,it){if(rt=aA(rt)){const ct=Cr.findKey(this,rt);return!(!ct||this[ct]===void 0||it&&!Jx(0,this[ct],ct,it))}return!1}delete(rt,it){const ct=this;let ut=!1;function pt(mt){if(mt=aA(mt)){const _t=Cr.findKey(ct,mt);!_t||it&&!Jx(0,ct[_t],_t,it)||(delete ct[_t],ut=!0)}}return Cr.isArray(rt)?rt.forEach(pt):pt(rt),ut}clear(rt){const it=Object.keys(this);let ct=it.length,ut=!1;for(;ct--;){const pt=it[ct];rt&&!Jx(0,this[pt],pt,rt,!0)||(delete this[pt],ut=!0)}return ut}normalize(rt){const it=this,ct={};return Cr.forEach(this,(ut,pt)=>{var mt;const _t=Cr.findKey(ct,pt);if(_t)return it[_t]=qR(ut),void delete it[pt];const vt=rt?function(Tt){return wu(Tt).call(Tt).toLowerCase().replace(/([a-z\d])(\w*)/g,(bt,Ot,Mt)=>Ot.toUpperCase()+Mt)}(pt):wu(mt=String(pt)).call(mt);vt!==pt&&delete it[pt],it[vt]=qR(ut),ct[vt]=!0}),this}concat(){for(var rt=arguments.length,it=new Array(rt),ct=0;ct<rt;ct++)it[ct]=arguments[ct];return this.constructor.concat(this,...it)}toJSON(rt){const it=Object.create(null);return Cr.forEach(this,(ct,ut)=>{ct!=null&&ct!==!1&&(it[ut]=rt&&Cr.isArray(ct)?ct.join(", "):ct)}),it}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(rt=>{let[it,ct]=rt;return it+": "+ct}).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(rt){return rt instanceof this?rt:new this(rt)}static concat(rt){const it=new this(rt);for(var ct=arguments.length,ut=new Array(ct>1?ct-1:0),pt=1;pt<ct;pt++)ut[pt-1]=arguments[pt];return ut.forEach(mt=>it.set(mt)),it}static accessor(rt){const it=(this[jU]=this[jU]={accessors:{}}).accessors,ct=this.prototype;function ut(pt){const mt=aA(pt);it[mt]||(function(_t,vt){const Tt=Cr.toCamelCase(" "+vt);["get","set","has"].forEach(bt=>{Object.defineProperty(_t,bt+Tt,{value:function(Ot,Mt,Dt){return this[bt].call(this,vt,Ot,Mt,Dt)},configurable:!0})})}(ct,pt),it[mt]=!0)}return Cr.isArray(rt)?rt.forEach(ut):ut(rt),this}}JR.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),Cr.reduceDescriptors(JR.prototype,(_e,rt)=>{let{value:it}=_e,ct=rt[0].toUpperCase()+rt.slice(1);return{get:()=>it,set(ut){this[ct]=ut}}}),Cr.freezeMethods(JR);var _g=JR;function Zx(_e,rt){const it=this||qx,ct=rt||it,ut=_g.from(ct.headers);let pt=ct.data;return Cr.forEach(_e,function(mt){pt=mt.call(it,pt,ut.normalize(),rt?rt.status:void 0)}),ut.normalize(),pt}function zU(_e){return!(!_e||!_e.__CANCEL__)}function uS(_e,rt,it){ls.call(this,_e??"canceled",ls.ERR_CANCELED,rt,it),this.name="CanceledError"}function WU(_e,rt,it){const ct=it.config.validateStatus;it.status&&ct&&!ct(it.status)?rt(new ls("Request failed with status code "+it.status,[ls.ERR_BAD_REQUEST,ls.ERR_BAD_RESPONSE][Math.floor(it.status/100)-4],it.config,it.request,it)):_e(it)}Cr.inherits(uS,ls,{__CANCEL__:!0});const ZR=function(_e,rt){let it=arguments.length>2&&arguments[2]!==void 0?arguments[2]:3,ct=0;const ut=function(pt,mt){pt=pt||10;const _t=new Array(pt),vt=new Array(pt);let Tt,bt=0,Ot=0;return mt=mt!==void 0?mt:1e3,function(Mt){const Dt=Date.now(),jt=vt[Ot];Tt||(Tt=Dt),_t[bt]=Mt,vt[bt]=Dt;let $t=Ot,Ht=0;for(;$t!==bt;)Ht+=_t[$t++],$t%=pt;if(bt=(bt+1)%pt,bt===Ot&&(Ot=(Ot+1)%pt),Dt-Tt<mt)return;const en=jt&&Dt-jt;return en?Math.round(1e3*Ht/en):void 0}}(50,250);return function(pt,mt){let _t,vt,Tt=0,bt=1e3/mt;const Ot=function(Mt){Tt=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Date.now(),_t=null,vt&&(clearTimeout(vt),vt=null),pt.apply(null,Mt)};return[function(){const Mt=Date.now(),Dt=Mt-Tt;for(var jt=arguments.length,$t=new Array(jt),Ht=0;Ht<jt;Ht++)$t[Ht]=arguments[Ht];Dt>=bt?Ot($t,Mt):(_t=$t,vt||(vt=setTimeout(()=>{vt=null,Ot(_t)},bt-Dt)))},()=>_t&&Ot(_t)]}(pt=>{const mt=pt.loaded,_t=pt.lengthComputable?pt.total:void 0,vt=mt-ct,Tt=ut(vt);ct=mt,_e({loaded:mt,total:_t,progress:_t?mt/_t:void 0,bytes:vt,rate:Tt||void 0,estimated:Tt&&_t&&mt<=_t?(_t-mt)/Tt:void 0,event:pt,lengthComputable:_t!=null,[rt?"download":"upload"]:!0})},it)},KU=(_e,rt)=>{const it=_e!=null;return[ct=>rt[0]({lengthComputable:it,total:_e,loaded:ct}),rt[1]]},YU=_e=>function(){for(var rt=arguments.length,it=new Array(rt),ct=0;ct<rt;ct++)it[ct]=arguments[ct];return Cr.asap(()=>_e(...it))};var WK=ip.hasStandardBrowserEnv?((_e,rt)=>it=>(it=new RR(it,ip.origin),_e.protocol===it.protocol&&_e.host===it.host&&(rt||_e.port===it.port)))(new RR(ip.origin),ip.navigator&&/(msie|trident)/i.test(ip.navigator.userAgent)):()=>!0,KK=ip.hasStandardBrowserEnv?{write(_e,rt,it,ct,ut,pt){const mt=[_e+"="+encodeURIComponent(rt)];Cr.isNumber(it)&&mt.push("expires="+new Date(it).toGMTString()),Cr.isString(ct)&&mt.push("path="+ct),Cr.isString(ut)&&mt.push("domain="+ut),pt===!0&&mt.push("secure"),document.cookie=mt.join("; ")},read(_e){const rt=document.cookie.match(new RegExp("(^|;\\s*)("+_e+")=([^;]*)"));return rt?decodeURIComponent(rt[3]):null},remove(_e){this.write(_e,"",Date.now()-864e5)}}:{write(){},read:()=>null,remove(){}};function XU(_e,rt,it){let ct=!function(ut){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(ut)}(rt);return _e&&(ct||it==0)?function(ut,pt){return pt?ut.replace(/\/?\/$/,"")+"/"+pt.replace(/^\/+/,""):ut}(_e,rt):rt}function qU(_e,rt){var it=Object.keys(_e);if(Object.getOwnPropertySymbols){var ct=Object.getOwnPropertySymbols(_e);rt&&(ct=ct.filter(function(ut){return Object.getOwnPropertyDescriptor(_e,ut).enumerable})),it.push.apply(it,ct)}return it}const JU=_e=>_e instanceof _g?function(rt){for(var it=1;it<arguments.length;it++){var ct=arguments[it]!=null?arguments[it]:{};it%2?qU(Object(ct),!0).forEach(function(ut){Jt(rt,ut,ct[ut])}):Object.getOwnPropertyDescriptors?Object.defineProperties(rt,Object.getOwnPropertyDescriptors(ct)):qU(Object(ct)).forEach(function(ut){Object.defineProperty(rt,ut,Object.getOwnPropertyDescriptor(ct,ut))})}return rt}({},_e):_e;function f0(_e,rt){rt=rt||{};const it={};function ct(Tt,bt,Ot,Mt){return Cr.isPlainObject(Tt)&&Cr.isPlainObject(bt)?Cr.merge.call({caseless:Mt},Tt,bt):Cr.isPlainObject(bt)?Cr.merge({},bt):Cr.isArray(bt)?bt.slice():bt}function ut(Tt,bt,Ot,Mt){return Cr.isUndefined(bt)?Cr.isUndefined(Tt)?void 0:ct(void 0,Tt,0,Mt):ct(Tt,bt,0,Mt)}function pt(Tt,bt){if(!Cr.isUndefined(bt))return ct(void 0,bt)}function mt(Tt,bt){return Cr.isUndefined(bt)?Cr.isUndefined(Tt)?void 0:ct(void 0,Tt):ct(void 0,bt)}function _t(Tt,bt,Ot){return Ot in rt?ct(Tt,bt):Ot in _e?ct(void 0,Tt):void 0}const vt={url:pt,method:pt,data:pt,baseURL:mt,transformRequest:mt,transformResponse:mt,paramsSerializer:mt,timeout:mt,timeoutMessage:mt,withCredentials:mt,withXSRFToken:mt,adapter:mt,responseType:mt,xsrfCookieName:mt,xsrfHeaderName:mt,onUploadProgress:mt,onDownloadProgress:mt,decompress:mt,maxContentLength:mt,maxBodyLength:mt,beforeRedirect:mt,transport:mt,httpAgent:mt,httpsAgent:mt,cancelToken:mt,socketPath:mt,responseEncoding:mt,validateStatus:_t,headers:(Tt,bt,Ot)=>ut(JU(Tt),JU(bt),0,!0)};return Cr.forEach(Object.keys(Object.assign({},_e,rt)),function(Tt){const bt=vt[Tt]||ut,Ot=bt(_e[Tt],rt[Tt],Tt);Cr.isUndefined(Ot)&&bt!==_t||(it[Tt]=Ot)}),it}var ZU=_e=>{const rt=f0({},_e);let it,{data:ct,withXSRFToken:ut,xsrfHeaderName:pt,xsrfCookieName:mt,headers:_t,auth:vt}=rt;if(rt.headers=_t=_g.from(_t),rt.url=m2(XU(rt.baseURL,rt.url,rt.allowAbsoluteUrls),_e.params,_e.paramsSerializer),vt&&_t.set("Authorization","Basic "+btoa((vt.username||"")+":"+(vt.password?unescape(encodeURIComponent(vt.password)):""))),Cr.isFormData(ct)){if(ip.hasStandardBrowserEnv||ip.hasStandardBrowserWebWorkerEnv)_t.setContentType(void 0);else if((it=_t.getContentType())!==!1){const[Tt,...bt]=it?it.split(";").map(Ot=>wu(Ot).call(Ot)).filter(Boolean):[];_t.setContentType([Tt||"multipart/form-data",...bt].join("; "))}}if(ip.hasStandardBrowserEnv&&(ut&&Cr.isFunction(ut)&&(ut=ut(rt)),ut||ut!==!1&&WK(rt.url))){const Tt=pt&&mt&&KK.read(mt);Tt&&_t.set(pt,Tt)}return rt},YK=typeof XMLHttpRequest<"u"&&function(_e){return new Ir(function(rt,it){const ct=ZU(_e);let ut=ct.data;const pt=_g.from(ct.headers).normalize();let mt,_t,vt,Tt,bt,{responseType:Ot,onUploadProgress:Mt,onDownloadProgress:Dt}=ct;function jt(){Tt&&Tt(),bt&&bt(),ct.cancelToken&&ct.cancelToken.unsubscribe(mt),ct.signal&&ct.signal.removeEventListener("abort",mt)}let $t=new XMLHttpRequest;function Ht(){if(!$t)return;const Qt=_g.from("getAllResponseHeaders"in $t&&$t.getAllResponseHeaders());WU(function(on){rt(on),jt()},function(on){it(on),jt()},{data:Ot&&Ot!=="text"&&Ot!=="json"?$t.response:$t.responseText,status:$t.status,statusText:$t.statusText,headers:Qt,config:_e,request:$t}),$t=null}$t.open(ct.method.toUpperCase(),ct.url,!0),$t.timeout=ct.timeout,"onloadend"in $t?$t.onloadend=Ht:$t.onreadystatechange=function(){$t&&$t.readyState===4&&($t.status!==0||$t.responseURL&&$t.responseURL.indexOf("file:")===0)&&setTimeout(Ht)},$t.onabort=function(){$t&&(it(new ls("Request aborted",ls.ECONNABORTED,_e,$t)),$t=null)},$t.onerror=function(){it(new ls("Network Error",ls.ERR_NETWORK,_e,$t)),$t=null},$t.ontimeout=function(){let Qt=ct.timeout?"timeout of "+ct.timeout+"ms exceeded":"timeout exceeded";const on=ct.transitional||_2;ct.timeoutErrorMessage&&(Qt=ct.timeoutErrorMessage),it(new ls(Qt,on.clarifyTimeoutError?ls.ETIMEDOUT:ls.ECONNABORTED,_e,$t)),$t=null},ut===void 0&&pt.setContentType(null),"setRequestHeader"in $t&&Cr.forEach(pt.toJSON(),function(Qt,on){$t.setRequestHeader(on,Qt)}),Cr.isUndefined(ct.withCredentials)||($t.withCredentials=!!ct.withCredentials),Ot&&Ot!=="json"&&($t.responseType=ct.responseType),Dt&&([vt,bt]=ZR(Dt,!0),$t.addEventListener("progress",vt)),Mt&&$t.upload&&([_t,Tt]=ZR(Mt),$t.upload.addEventListener("progress",_t),$t.upload.addEventListener("loadend",Tt)),(ct.cancelToken||ct.signal)&&(mt=Qt=>{$t&&(it(!Qt||Qt.type?new uS(null,_e,$t):Qt),$t.abort(),$t=null)},ct.cancelToken&&ct.cancelToken.subscribe(mt),ct.signal&&(ct.signal.aborted?mt():ct.signal.addEventListener("abort",mt)));const en=function(Qt){const on=/^([-+\w]{1,25})(:?\/\/|:)/.exec(Qt);return on&&on[1]||""}(ct.url);en&&ip.protocols.indexOf(en)===-1?it(new ls("Unsupported protocol "+en+":",ls.ERR_BAD_REQUEST,_e)):$t.send(ut||null)})},XK=(_e,rt)=>{const{length:it}=_e=_e?_e.filter(Boolean):[];if(rt||it){let ct,ut=new AbortController;const pt=function(Tt){if(!ct){ct=!0,_t();const bt=Tt instanceof Error?Tt:this.reason;ut.abort(bt instanceof ls?bt:new uS(bt instanceof Error?bt.message:bt))}};let mt=rt&&setTimeout(()=>{mt=null,pt(new ls("timeout ".concat(rt," of ms exceeded"),ls.ETIMEDOUT))},rt);const _t=()=>{_e&&(mt&&clearTimeout(mt),mt=null,_e.forEach(Tt=>{Tt.unsubscribe?Tt.unsubscribe(pt):Tt.removeEventListener("abort",pt)}),_e=null)};_e.forEach(Tt=>Tt.addEventListener("abort",pt));const{signal:vt}=ut;return vt.unsubscribe=()=>Cr.asap(_t),vt}},Qx=st(VN),QU=oS.f("asyncIterator"),qK=st(QU);function eO(_e,rt){this.v=_e,this.k=rt}function Jp(_e){return function(){return new cA(_e.apply(this,arguments))}}function cA(_e){var rt,it;function ct(pt,mt){try{var _t=_e[pt](mt),vt=_t.value,Tt=vt instanceof eO;Qx.resolve(Tt?vt.v:vt).then(function(bt){if(Tt){var Ot=pt==="return"?"return":"next";if(!vt.k||bt.done)return ct(Ot,bt);bt=_e[Ot](bt).value}ut(_t.done?"return":"normal",bt)},function(bt){ct("throw",bt)})}catch(bt){ut("throw",bt)}}function ut(pt,mt){switch(pt){case"return":rt.resolve({value:mt,done:!0});break;case"throw":rt.reject(mt);break;default:rt.resolve({value:mt,done:!1})}(rt=rt.next)?ct(rt.key,rt.arg):it=null}this._invoke=function(pt,mt){return new Qx(function(_t,vt){var Tt={key:pt,arg:mt,resolve:_t,reject:vt,next:null};it?it=it.next=Tt:(rt=it=Tt,ct(pt,mt))})},typeof _e.return!="function"&&(this.return=void 0)}function Bo(_e){return new eO(_e,0)}function QR(_e){var rt={},it=!1;function ct(ut,pt){return it=!0,pt=new Qx(function(mt){mt(_e[ut](pt))}),{done:!1,value:new eO(pt,1)}}return rt[lS!==void 0&&wU||"@@iterator"]=function(){return this},rt.next=function(ut){return it?(it=!1,ut):ct("next",ut)},typeof _e.throw=="function"&&(rt.throw=function(ut){if(it)throw it=!1,ut;return ct("throw",ut)}),typeof _e.return=="function"&&(rt.return=function(ut){return it?(it=!1,ut):ct("return",ut)}),rt}cA.prototype[typeof lS=="function"&&qK||"@@asyncIterator"]=function(){return this},cA.prototype.next=function(_e){return this._invoke("next",_e)},cA.prototype.throw=function(_e){return this._invoke("throw",_e)},cA.prototype.return=function(_e){return this._invoke("return",_e)};var tO=st(QU);function nO(_e){var rt,it,ct,ut=2;for(typeof Symbol<"u"&&(it=tO,ct=Symbol.iterator);ut--;){if(it&&(rt=_e[it])!=null)return rt.call(_e);if(ct&&(rt=_e[ct])!=null)return new ew(rt.call(_e));it="@@asyncIterator",ct="@@iterator"}throw new TypeError("Object is not async iterable")}function ew(_e){function rt(it){if(Object(it)!==it)return Ir.reject(new TypeError(it+" is not an object."));var ct=it.done;return Ir.resolve(it.value).then(function(ut){return{value:ut,done:ct}})}return ew=function(it){this.s=it,this.n=it.next},ew.prototype={s:null,n:null,next:function(){return rt(this.n.apply(this.s,arguments))},return:function(it){var ct=this.s.return;return ct===void 0?Ir.resolve({value:it,done:!0}):rt(ct.apply(this.s,arguments))},throw:function(it){var ct=this.s.return;return ct===void 0?Ir.reject(it):rt(ct.apply(this.s,arguments))}},new ew(_e)}const JK=function*(_e,rt){let it=_e.byteLength;if(!rt||it<rt)return void(yield _e);let ct,ut=0;for(;ut<it;)ct=ut+rt,yield _e.slice(ut,ct),ut=ct},ZK=function(){var _e=Jp(function*(rt,it){var ct,ut=!1,pt=!1;try{for(var mt,_t=nO(QK(rt));ut=!(mt=yield Bo(_t.next())).done;ut=!1){const vt=mt.value;yield*QR(nO(JK(vt,it)))}}catch(vt){pt=!0,ct=vt}finally{try{ut&&_t.return!=null&&(yield Bo(_t.return()))}finally{if(pt)throw ct}}});return function(rt,it){return _e.apply(this,arguments)}}(),QK=function(){var _e=Jp(function*(rt){if(rt[tO])return void(yield*QR(nO(rt)));const it=rt.getReader();try{for(;;){const{done:ct,value:ut}=yield Bo(it.read());if(ct)break;yield ut}}finally{yield Bo(it.cancel())}});return function(rt){return _e.apply(this,arguments)}}(),e3=(_e,rt,it,ct)=>{const ut=ZK(_e,rt);let pt,mt=0,_t=vt=>{pt||(pt=!0,ct&&ct(vt))};return new ReadableStream({async pull(vt){try{const{done:Tt,value:bt}=await ut.next();if(Tt)return _t(),void vt.close();let Ot=bt.byteLength;if(it){let Mt=mt+=Ot;it(Mt)}vt.enqueue(new Uint8Array(bt))}catch(Tt){throw _t(Tt),Tt}},cancel:vt=>(_t(vt),ut.return())},{highWaterMark:2})};function t3(_e,rt){var it=Object.keys(_e);if(Object.getOwnPropertySymbols){var ct=Object.getOwnPropertySymbols(_e);rt&&(ct=ct.filter(function(ut){return Object.getOwnPropertyDescriptor(_e,ut).enumerable})),it.push.apply(it,ct)}return it}function n3(_e){for(var rt=1;rt<arguments.length;rt++){var it=arguments[rt]!=null?arguments[rt]:{};rt%2?t3(Object(it),!0).forEach(function(ct){Jt(_e,ct,it[ct])}):Object.getOwnPropertyDescriptors?Object.defineProperties(_e,Object.getOwnPropertyDescriptors(it)):t3(Object(it)).forEach(function(ct){Object.defineProperty(_e,ct,Object.getOwnPropertyDescriptor(it,ct))})}return _e}const tw=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",r3=tw&&typeof ReadableStream=="function",eY=tw&&(typeof TextEncoder=="function"?(i3=new TextEncoder,_e=>i3.encode(_e)):async _e=>new Uint8Array(await new Response(_e).arrayBuffer()));var i3;const o3=function(_e){try{for(var rt=arguments.length,it=new Array(rt>1?rt-1:0),ct=1;ct<rt;ct++)it[ct-1]=arguments[ct];return!!_e(...it)}catch{return!1}},tY=r3&&o3(()=>{let _e=!1;const rt=new Request(ip.origin,{body:new ReadableStream,method:"POST",get duplex(){return _e=!0,"half"}}).headers.has("Content-Type");return _e&&!rt}),rO=r3&&o3(()=>Cr.isReadableStream(new Response("").body)),nw={stream:rO&&(_e=>_e.body)};var s3;tw&&(s3=new Response,["text","arrayBuffer","blob","formData","stream"].forEach(_e=>{!nw[_e]&&(nw[_e]=Cr.isFunction(s3[_e])?rt=>rt[_e]():(rt,it)=>{throw new ls("Response type '".concat(_e,"' is not supported"),ls.ERR_NOT_SUPPORT,it)})}));const nY=async(_e,rt)=>{const it=Cr.toFiniteNumber(_e.getContentLength());return it??(async ct=>ct==null?0:Cr.isBlob(ct)?ct.size:Cr.isSpecCompliantForm(ct)?(await new Request(ip.origin,{method:"POST",body:ct}).arrayBuffer()).byteLength:Cr.isArrayBufferView(ct)||Cr.isArrayBuffer(ct)?ct.byteLength:(Cr.isURLSearchParams(ct)&&(ct+=""),Cr.isString(ct)?(await eY(ct)).byteLength:void 0))(rt)};var rY=tw&&(async _e=>{let{url:rt,method:it,data:ct,signal:ut,cancelToken:pt,timeout:mt,onDownloadProgress:_t,onUploadProgress:vt,responseType:Tt,headers:bt,withCredentials:Ot="same-origin",fetchOptions:Mt}=ZU(_e);Tt=Tt?(Tt+"").toLowerCase():"text";let Dt,jt=XK([ut,pt&&pt.toAbortSignal()],mt);const $t=jt&&jt.unsubscribe&&(()=>{jt.unsubscribe()});let Ht;try{if(vt&&tY&&it!=="get"&&it!=="head"&&(Ht=await nY(bt,ct))!==0){let vn,hn=new Request(rt,{method:"POST",body:ct,duplex:"half"});if(Cr.isFormData(ct)&&(vn=hn.headers.get("content-type"))&&bt.setContentType(vn),hn.body){const[Ln,Xn]=KU(Ht,ZR(YU(vt)));ct=e3(hn.body,65536,Ln,Xn)}}Cr.isString(Ot)||(Ot=Ot?"include":"omit");const en="credentials"in Request.prototype;Dt=new Request(rt,n3(n3({},Mt),{},{signal:jt,method:it.toUpperCase(),headers:bt.normalize().toJSON(),body:ct,duplex:"half",credentials:en?Ot:void 0}));let Qt=await fetch(Dt);const on=rO&&(Tt==="stream"||Tt==="response");if(rO&&(_t||on&&$t)){const vn={};["status","statusText","headers"].forEach(Qn=>{vn[Qn]=Qt[Qn]});const hn=Cr.toFiniteNumber(Qt.headers.get("content-length")),[Ln,Xn]=_t&&KU(hn,ZR(YU(_t),!0))||[];Qt=new Response(e3(Qt.body,65536,Ln,()=>{Xn&&Xn(),$t&&$t()}),vn)}Tt=Tt||"text";let Tn=await nw[Cr.findKey(nw,Tt)||"text"](Qt,_e);return!on&&$t&&$t(),await new Ir((vn,hn)=>{WU(vn,hn,{data:Tn,headers:_g.from(Qt.headers),status:Qt.status,statusText:Qt.statusText,config:_e,request:Dt})})}catch(en){throw $t&&$t(),en&&en.name==="TypeError"&&/Load failed|fetch/i.test(en.message)?Object.assign(new ls("Network Error",ls.ERR_NETWORK,_e,Dt),{cause:en.cause||en}):ls.from(en,en&&en.code,_e,Dt)}});const iO={http:null,xhr:YK,fetch:rY};Cr.forEach(iO,(_e,rt)=>{if(_e){try{Object.defineProperty(_e,"name",{value:rt})}catch{}Object.defineProperty(_e,"adapterName",{value:rt})}});const a3=_e=>"- ".concat(_e),iY=_e=>Cr.isFunction(_e)||_e===null||_e===!1;var c3={getAdapter:_e=>{_e=Cr.isArray(_e)?_e:[_e];const{length:rt}=_e;let it,ct;const ut={};for(let pt=0;pt<rt;pt++){let mt;if(it=_e[pt],ct=it,!iY(it)&&(ct=iO[(mt=String(it)).toLowerCase()],ct===void 0))throw new ls("Unknown adapter '".concat(mt,"'"));if(ct)break;ut[mt||"#"+pt]=ct}if(!ct){const pt=Object.entries(ut).map(mt=>{let[_t,vt]=mt;return"adapter ".concat(_t," ")+(vt===!1?"is not supported by the environment":"is not available in the build")});throw new ls("There is no suitable adapter to dispatch the request "+(rt?pt.length>1?`since :
`+pt.map(a3).join(`
`):" "+a3(pt[0]):"as no adapter specified"),"ERR_NOT_SUPPORT")}return ct},adapters:iO};function oO(_e){if(_e.cancelToken&&_e.cancelToken.throwIfRequested(),_e.signal&&_e.signal.aborted)throw new uS(null,_e)}function l3(_e){return oO(_e),_e.headers=_g.from(_e.headers),_e.data=Zx.call(_e,_e.transformRequest),["post","put","patch"].indexOf(_e.method)!==-1&&_e.headers.setContentType("application/x-www-form-urlencoded",!1),c3.getAdapter(_e.adapter||qx.adapter)(_e).then(function(rt){return oO(_e),rt.data=Zx.call(_e,_e.transformResponse,rt),rt.headers=_g.from(rt.headers),rt},function(rt){return zU(rt)||(oO(_e),rt&&rt.response&&(rt.response.data=Zx.call(_e,_e.transformResponse,rt.response),rt.response.headers=_g.from(rt.response.headers))),Ir.reject(rt)})}const u3="1.9.0",rw={};["object","boolean","number","function","string","symbol"].forEach((_e,rt)=>{rw[_e]=function(it){return typeof it===_e||"a"+(rt<1?"n ":" ")+_e}});const d3={};rw.transitional=function(_e,rt,it){function ct(ut,pt){return"[Axios v"+u3+"] Transitional option '"+ut+"'"+pt+(it?". "+it:"")}return(ut,pt,mt)=>{if(_e===!1)throw new ls(ct(pt," has been removed"+(rt?" in "+rt:"")),ls.ERR_DEPRECATED);return rt&&!d3[pt]&&(d3[pt]=!0,console.warn(ct(pt," has been deprecated since v"+rt+" and will be removed in the near future"))),!_e||_e(ut,pt,mt)}},rw.spelling=function(_e){return(rt,it)=>(console.warn("".concat(it," is likely a misspelling of ").concat(_e)),!0)};var iw={assertOptions:function(_e,rt,it){if(typeof _e!="object")throw new ls("options must be an object",ls.ERR_BAD_OPTION_VALUE);const ct=Object.keys(_e);let ut=ct.length;for(;ut-- >0;){const pt=ct[ut],mt=rt[pt];if(mt){const _t=_e[pt],vt=_t===void 0||mt(_t,pt,_e);if(vt!==!0)throw new ls("option "+pt+" must be "+vt,ls.ERR_BAD_OPTION_VALUE)}else if(it!==!0)throw new ls("Unknown option "+pt,ls.ERR_BAD_OPTION)}},validators:rw};const x_=iw.validators;let ow=class{constructor(_e){this.defaults=_e||{},this.interceptors={request:new g2,response:new g2}}async request(_e,rt){try{return await this._request(_e,rt)}catch(it){if(it instanceof Error){let ct={};Error.captureStackTrace?Error.captureStackTrace(ct):ct=new Error;const ut=ct.stack?ct.stack.replace(/^.+\n/,""):"";try{it.stack?ut&&!String(it.stack).endsWith(ut.replace(/^.+\n.+\n/,""))&&(it.stack+=`
`+ut):it.stack=ut}catch{}}throw it}}_request(_e,rt){typeof _e=="string"?(rt=rt||{}).url=_e:rt=_e||{},rt=f0(this.defaults,rt);const{transitional:it,paramsSerializer:ct,headers:ut}=rt;it!==void 0&&iw.assertOptions(it,{silentJSONParsing:x_.transitional(x_.boolean),forcedJSONParsing:x_.transitional(x_.boolean),clarifyTimeoutError:x_.transitional(x_.boolean)},!1),ct!=null&&(Cr.isFunction(ct)?rt.paramsSerializer={serialize:ct}:iw.assertOptions(ct,{encode:x_.function,serialize:x_.function},!0)),rt.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?rt.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:rt.allowAbsoluteUrls=!0),iw.assertOptions(rt,{baseUrl:x_.spelling("baseURL"),withXsrfToken:x_.spelling("withXSRFToken")},!0),rt.method=(rt.method||this.defaults.method||"get").toLowerCase();let pt=ut&&Cr.merge(ut.common,ut[rt.method]);ut&&Cr.forEach(["delete","get","head","post","put","patch","common"],Dt=>{delete ut[Dt]}),rt.headers=_g.concat(pt,ut);const mt=[];let _t=!0;this.interceptors.request.forEach(function(Dt){typeof Dt.runWhen=="function"&&Dt.runWhen(rt)===!1||(_t=_t&&Dt.synchronous,mt.unshift(Dt.fulfilled,Dt.rejected))});const vt=[];let Tt;this.interceptors.response.forEach(function(Dt){vt.push(Dt.fulfilled,Dt.rejected)});let bt,Ot=0;if(!_t){const Dt=[l3.bind(this),void 0];for(Dt.unshift.apply(Dt,mt),Dt.push.apply(Dt,vt),bt=Dt.length,Tt=Ir.resolve(rt);Ot<bt;)Tt=Tt.then(Dt[Ot++],Dt[Ot++]);return Tt}bt=mt.length;let Mt=rt;for(Ot=0;Ot<bt;){const Dt=mt[Ot++],jt=mt[Ot++];try{Mt=Dt(Mt)}catch($t){jt.call(this,$t);break}}try{Tt=l3.call(this,Mt)}catch(Dt){return Ir.reject(Dt)}for(Ot=0,bt=vt.length;Ot<bt;)Tt=Tt.then(vt[Ot++],vt[Ot++]);return Tt}getUri(_e){return m2(XU((_e=f0(this.defaults,_e)).baseURL,_e.url,_e.allowAbsoluteUrls),_e.params,_e.paramsSerializer)}};Cr.forEach(["delete","get","head","options"],function(_e){ow.prototype[_e]=function(rt,it){return this.request(f0(it||{},{method:_e,url:rt,data:(it||{}).data}))}}),Cr.forEach(["post","put","patch"],function(_e){function rt(it){return function(ct,ut,pt){return this.request(f0(pt||{},{method:_e,headers:it?{"Content-Type":"multipart/form-data"}:{},url:ct,data:ut}))}}ow.prototype[_e]=rt(),ow.prototype[_e+"Form"]=rt(!0)});var sw=ow;class sO{constructor(rt){if(typeof rt!="function")throw new TypeError("executor must be a function.");let it;this.promise=new Ir(function(ut){it=ut});const ct=this;this.promise.then(ut=>{if(!ct._listeners)return;let pt=ct._listeners.length;for(;pt-- >0;)ct._listeners[pt](ut);ct._listeners=null}),this.promise.then=ut=>{let pt;const mt=new Ir(_t=>{ct.subscribe(_t),pt=_t}).then(ut);return mt.cancel=function(){ct.unsubscribe(pt)},mt},rt(function(ut,pt,mt){ct.reason||(ct.reason=new uS(ut,pt,mt),it(ct.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(rt){this.reason?rt(this.reason):this._listeners?this._listeners.push(rt):this._listeners=[rt]}unsubscribe(rt){if(!this._listeners)return;const it=this._listeners.indexOf(rt);it!==-1&&this._listeners.splice(it,1)}toAbortSignal(){const rt=new AbortController,it=ct=>{rt.abort(ct)};return this.subscribe(it),rt.signal.unsubscribe=()=>this.unsubscribe(it),rt.signal}static source(){let rt;return{token:new sO(function(ct){rt=ct}),cancel:rt}}}var oY=sO;const aO={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(aO).forEach(_e=>{let[rt,it]=_e;aO[it]=rt});var sY=aO;const Su=function _e(rt){const it=new sw(rt),ct=ZL(sw.prototype.request,it);return Cr.extend(ct,sw.prototype,it,{allOwnKeys:!0}),Cr.extend(ct,it,null,{allOwnKeys:!0}),ct.create=function(ut){return _e(f0(rt,ut))},ct}(qx);Su.Axios=sw,Su.CanceledError=uS,Su.CancelToken=oY,Su.isCancel=zU,Su.VERSION=u3,Su.toFormData=FR,Su.AxiosError=ls,Su.Cancel=Su.CanceledError,Su.all=function(_e){return Ir.all(_e)},Su.spread=function(_e){return function(rt){return _e.apply(null,rt)}},Su.isAxiosError=function(_e){return Cr.isObject(_e)&&_e.isAxiosError===!0},Su.mergeConfig=f0,Su.AxiosHeaders=_g,Su.formToJSON=_e=>HU(Cr.isHTMLForm(_e)?new FormData(_e):_e),Su.getAdapter=c3.getAdapter,Su.HttpStatusCode=sY,Su.default=Su;var Xu=Su;const aY=()=>{};function lA(){const _e={promise:void 0,isResolved:!1,isRejected:!1,isFinished:!1,resolve:void 0,reject:void 0,cancel:aY};return _e.promise=new Ir((rt,it)=>{_e.resolve=ct=>{_e.isFinished||(_e.isResolved=!0,_e.isFinished=!0,rt(ct),_e.value=ct)},_e.reject=ct=>{_e.isFinished||(_e.isRejected=!0,_e.isFinished=!0,it(ct))}}),_e}const aw=new Map,cw=new Map,O_=new Map;let Nl=function(_e){return _e.WIN_10="Windows 10",_e.WIN_81="Windows 8.1",_e.WIN_8="Windows 8",_e.WIN_7="Windows 7",_e.WIN_VISTA="Windows Vista",_e.WIN_SERVER_2003="Windows Server 2003",_e.WIN_XP="Windows XP",_e.WIN_2000="Windows 2000",_e.ANDROID="Android",_e.HARMONY_OS="HarmonyOS",_e.OPEN_BSD="Open BSD",_e.SUN_OS="Sun OS",_e.LINUX="Linux",_e.IOS="iOS",_e.MAC_OS="Mac OS",_e.CHROMIUM_OS="Chromium OS",_e.QNX="QNX",_e.UNIX="UNIX",_e.BEOS="BeOS",_e.OS_2="OS/2",_e.SEARCH_BOT="Search Bot",_e}({}),Ho=function(_e){return _e.CHROME="Chrome",_e.SAFARI="Safari",_e.EDGE="Edge",_e.FIREFOX="Firefox",_e.OPERA="OPR",_e.QQ="QQBrowser",_e.WECHAT="MicroMessenger",_e}({});const cO=new BW;let e_=cO.getResult(),lO=null;function No(_e){if(!lO){_e&&cO.setUA(_e),e_=cO.getResult();const rt=function(_t){if(_t.engine.name==="Blink"&&_t.browser.name!=="WeChat")return Ho.CHROME;switch(_t.browser.name){case"Chrome Headless":case"Chrome":case"Chromium":return Ho.CHROME;case"Safari":case"Mobile Safari":return Ho.SAFARI;case"Edge":return Ho.EDGE;case"Firefox":return Ho.FIREFOX;case"QQ":case"QQBrowser":return Ho.QQ;case"Opera":return Ho.OPERA;case"WeChat":return Ho.WECHAT;default:return _t.browser.name||""}}(e_),it=h3(e_),ct=function(_t){return _t.os.name==="Windows"?_t.os.version?_t.os.name+" "+_t.os.version:_t.os.name:_t.os.name||""}(e_),ut=e_.os.version,pt=h3(e_,!1),mt=e_.device.type;if(!(rt&&it&&ct&&ut))return{name:rt,version:it,os:ct,osVersion:ut,browserVersion:pt,deviceType:mt};lO={name:rt,version:it,os:ct,osVersion:ut,browserVersion:pt,deviceType:mt}}return lO}function h3(_e){let rt,it=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];return rt=_e.engine.name==="Blink"?_e.engine.version||"":_e.browser.version||"",it?rt.split(".")[0]:rt}function lw(){return No().os}function p3(){const _e=No();return"".concat(_e.os," ").concat(_e.osVersion)}function uw(){const _e=No();return!!(e_.engine.name==="WebKit"&&_e.os===Nl.MAC_OS&&navigator.maxTouchPoints&&navigator.maxTouchPoints>0&&_e.name!==Ho.SAFARI||Tu()&&_e.name!==Ho.SAFARI)}function dE(){return No().name===Ho.CHROME}function tu(){return No().name===Ho.SAFARI}function f3(){const _e=No();if(_e.name!==Ho.SAFARI||!_e.browserVersion)return!1;const rt=_e.browserVersion.split(".");return Number(rt[0])>15||Number(rt[0])===15&&Number(rt[1])>=4}function m3(){return No().name===Ho.EDGE}function Gs(){return No().name===Ho.FIREFOX}function Tu(){return No().os===Nl.IOS}function dS(_e){const rt=No();return!(rt.name!==Ho.CHROME||!rt.osVersion)&&Number(rt.version)>=_e}function g3(_e){const rt=No();return!(rt.name!==Ho.CHROME||!rt.osVersion)&&Number(rt.version)<_e}function uO(_e,rt,it){const ct=No();return!(ct.name!==_e||!ct.osVersion)&&(it?Number(ct.version)>=rt&&Number(ct.version)<=it:Number(ct.version)===rt)}function dO(_e){const rt=No();return!(rt.name!==Ho.EDGE||!rt.osVersion)&&Number(rt.version)>=_e}function hO(_e){const rt=No();return!(rt.name!==Ho.FIREFOX||!rt.osVersion)&&Number(rt.version)>=_e}function _3(_e){const rt=No();return!(rt.name!==Ho.SAFARI||!rt.osVersion)&&Number(rt.version)>=_e}function E3(_e,rt,it){const ct=No();if(ct.os!==Nl.IOS||!ct.osVersion)return!1;const ut=ct.osVersion.split(".");return it?rt&&Number(ut[0])===_e&&Number(ut[1])>rt||Number(ut[0])>_e:rt?Number(ut[0])===_e&&Number(ut[1])>=rt||Number(ut[0])>_e:Number(ut[0])>=_e}function v3(_e,rt,it){const ct=No();if(ct.os!==Nl.IOS||!ct.osVersion)return!1;const ut=ct.osVersion.split(".");return it?rt&&Number(ut[0])===_e&&Number(ut[1])<rt||Number(ut[0])<_e:rt?Number(ut[0])===_e&&Number(ut[1])<=rt||Number(ut[0])<_e:Number(ut[0])<=_e}function pO(_e,rt,it){const ct=No();if(ct.name!==Ho.SAFARI||!ct.osVersion||!ct.browserVersion)return!1;const ut=ct.browserVersion.split(".");return it?rt&&Number(ut[0])===_e&&Number(ut[1])<rt||Number(ut[0])<_e:rt?Number(ut[0])===_e&&Number(ut[1])<=rt||Number(ut[0])<_e:Number(ut[0])<=_e}function fO(_e){const rt=No();return!(rt.name!==Ho.OPERA||!rt.osVersion)&&Number(rt.version)>=_e}function y3(){const _e=No();if(_e.os!==Nl.IOS||!_e.osVersion)return!1;const rt=_e.osVersion.split(".");return Number(rt[0])<14||Number(rt[0])===14&&Number(rt[1])<=6}function hS(){const _e=No();if(_e.os!==Nl.IOS||!_e.osVersion)return!1;const rt=_e.osVersion.split(".");return Number(rt[0])===15}function mO(){const _e=No();if(_e.os!==Nl.IOS||!_e.osVersion)return!1;const rt=_e.osVersion.split(".");return Number(rt[0])===16}function S3(){const _e=No();if(_e.os!==Nl.IOS||!_e.osVersion)return!1;const rt=_e.osVersion.split(".");return Number(rt[0])===15&&Number(rt[1])>=1}function Sm(){return tu()&&navigator.maxTouchPoints>0}function T3(){return No().name===Ho.WECHAT}function A3(){return window.navigator.appVersion&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)!==null&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]<=35}function gO(){const _e=lw();return function(){const{deviceType:rt}=No();return rt==="mobile"||rt==="tablet"}()||_e===Nl.ANDROID||_e===Nl.IOS||_e===Nl.HARMONY_OS}function hE(){const _e=No();return _e.name!==Ho.EDGE&&_e.name!==Ho.SAFARI&&!!navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]./i)}function dw(){return lw()===Nl.ANDROID}function uA(){const _e=No();return dw()&&(_e.name===Ho.CHROME||_e.name===Ho.WECHAT||/chrome|chromium/i.test(navigator.userAgent))}function so(_e,rt,it){return(rt=function(ct){var ut=function(pt,mt){if(typeof pt!="object"||!pt)return pt;var _t=pt[Symbol.toPrimitive];if(_t!==void 0){var vt=_t.call(pt,"string");if(typeof vt!="object")return vt;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(pt)}(ct);return typeof ut=="symbol"?ut:ut+""}(rt))in _e?Object.defineProperty(_e,rt,{value:it,enumerable:!0,configurable:!0,writable:!0}):_e[rt]=it,_e}function C3(_e,rt){var it=Object.keys(_e);if(Object.getOwnPropertySymbols){var ct=Object.getOwnPropertySymbols(_e);rt&&(ct=ct.filter(function(ut){return Object.getOwnPropertyDescriptor(_e,ut).enumerable})),it.push.apply(it,ct)}return it}function hr(_e){for(var rt=1;rt<arguments.length;rt++){var it=arguments[rt]!=null?arguments[rt]:{};rt%2?C3(Object(it),!0).forEach(function(ct){so(_e,ct,it[ct])}):Object.getOwnPropertyDescriptors?Object.defineProperties(_e,Object.getOwnPropertyDescriptors(it)):C3(Object(it)).forEach(function(ct){Object.defineProperty(_e,ct,Object.getOwnPropertyDescriptor(it,ct))})}return _e}let tn=function(_e){return _e.UNEXPECTED_ERROR="UNEXPECTED_ERROR",_e.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",_e.TIMEOUT="TIMEOUT",_e.INVALID_PARAMS="INVALID_PARAMS",_e.NOT_READABLE="NOT_READABLE",_e.NOT_SUPPORTED="NOT_SUPPORTED",_e.INVALID_OPERATION="INVALID_OPERATION",_e.OPERATION_ABORTED="OPERATION_ABORTED",_e.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",_e.EXCHANGE_SDP_FAILED="EXCHANGE_SDP_FAILED",_e.ADD_CANDIDATE_FAILED="ADD_CANDIDATE_FAILED",_e.DATACHANNEL_FAILED="DATACHANNEL_FAILED",_e.NETWORK_ERROR="NETWORK_ERROR",_e.NETWORK_TIMEOUT="NETWORK_TIMEOUT",_e.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",_e.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",_e.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",_e.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",_e.ELECTRON_IS_NULL="ELECTRON_IS_NULL",_e.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",_e.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",_e.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",_e.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",_e.PERMISSION_DENIED="PERMISSION_DENIED",_e.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",_e.TRACK_IS_DISABLED="TRACK_IS_DISABLED",_e.GET_VIDEO_ELEMENT_VISIBLE_ERROR="GET_VIDEO_ELEMENT_VISIBLE_ERROR",_e.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",_e.LOW_STREAM_ENCODING_ERROR="LOW_STREAM_ENCODING_ERROR",_e.SET_ENCODING_PARAMETER_ERROR="SET_ENCODING_PARAMETER_ERROR",_e.TRACK_STATE_UNREACHABLE="TRACK_STATE_UNREACHABLE",_e.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",_e.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",_e.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",_e.VOID_GATEWAY_ADDRESS="VOID_GATEWAY_ADDRESS",_e.UID_CONFLICT="UID_CONFLICT",_e.MULTI_UNILBS_RESPONSE_ERROR="MULTI_UNILBS_RESPONSE_ERROR",_e.UPDATE_TICKET_FAILED="UPDATE_TICKET_FAILED",_e.TOKEN_EXPIRE="TOKEN_EXPIRE",_e.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",_e.INVALID_TRACK="INVALID_TRACK",_e.SENDER_NOT_FOUND="SENDER_NOT_FOUND",_e.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",_e.SET_ANSWER_FAILED="SET_ANSWER_FAILED",_e.ICE_FAILED="ICE_FAILED",_e.PC_CLOSED="PC_CLOSED",_e.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",_e.GET_LOCAL_CAPABILITIES_FAILED="GET_LOCAL_CAPABILITIES_FAILED",_e.GET_LOCAL_CONNECTION_PARAMS_FAILED="GET_LOCAL_CONNECTION_PARAMS_FAILED",_e.SUBSCRIBE_FAILED="SUBSCRIBE_FAILED",_e.UNSUBSCRIBE_FAILED="UNSUBSCRIBE_FAILED",_e.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",_e.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",_e.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",_e.EXIST_DISABLED_VIDEO_TRACK="EXIST_DISABLED_VIDEO_TRACK",_e.INVALID_REMOTE_USER="INVALID_REMOTE_USER",_e.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",_e.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",_e.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",_e.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",_e.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",_e.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",_e.WS_ABORT="WS_ABORT",_e.WS_DISCONNECT="WS_DISCONNECT",_e.WS_ERR="WS_ERR",_e.EXTERNAL_SIGNAL_ABORT="EXTERNAL_SIGNAL_ABORT",_e.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",_e.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",_e.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",_e.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",_e.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED="LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED",_e.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",_e.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",_e.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",_e.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",_e.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",_e.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",_e.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",_e.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",_e.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",_e.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",_e.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",_e.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",_e.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE",_e.LOCAL_AEC_ERROR="LOCAL_AEC_ERROR",_e.INVALID_PLUGIN="INVALID_PLUGIN",_e.DISCONNECT_P2P="DISCONNECT_P2P",_e.CONVERTING_IMAGEDATA_TO_BLOB_FAILED="CONVERTING_IMAGEDATA_TO_BLOB_FAILED",_e.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED="CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED",_e.INIT_DATACHANNEL_TIMEOUT="INIT_DATACHANNEL_TIMEOUT",_e.CREATE_DATACHANNEL_ERROR="CREATE_DATACHANNEL_ERROR",_e.DATACHANNEL_CONNECTION_TIMEOUT="DATACHANNEL_CONNECTION_TIMEOUT",_e.PROHIBITED_OPERATION="PROHIBITED_OPERATION",_e.IMAGE_MODERATION_UPLOAD_FAILED="IMAGE_MODERATION_UPLOAD_FAILED",_e.P2P_MESSAGE_FAILED="P2P_MESSAGE_FAILED",_e}({}),Yn=class extends Error{constructor(_e){let rt=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",it=arguments.length>2?arguments[2]:void 0;super(rt),so(this,"code",void 0),so(this,"message",void 0),so(this,"data",void 0),so(this,"name","AgoraRTCException"),this.code=_e,this.message="AgoraRTCError ".concat(this.code,": ").concat(rt),this.data=it}toString(){return this.data?"".concat(this.message,`
data: `).concat(JSON.stringify(this.data)):this.message}print(){let _e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error",rt=arguments.length>1?arguments[1]:void 0;return _e==="error"&&(rt||console).error(this.toString()),_e==="warning"&&(rt||console).warn(this.toString()),this}throw(_e){throw this.print("error",_e),this}};function t_(_e,rt){if(typeof _e!="boolean")throw new Yn(tn.INVALID_PARAMS,"Invalid ".concat(rt,": The value is of the boolean type."))}function Cl(_e,rt,it){if(!Er(it).call(it,_e))throw new Yn(tn.INVALID_PARAMS,"".concat(rt," can only be set as ").concat(JSON.stringify(it)))}function us(_e,rt){let it=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,ct=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1e4;if(_e<it||_e>ct||(!(arguments.length>4&&arguments[4]!==void 0)||arguments[4])&&!function(ut){return typeof ut=="number"&&ut%1==0}(_e))throw new Yn(tn.INVALID_PARAMS,"invalid ".concat(rt,": the value range is [").concat(it,", ").concat(ct,"]. integer only"))}function _O(_e,rt){if(typeof _e!="number"){if(!(_e.min||_e.max||_e.ideal||_e.exact))throw new Yn(tn.INVALID_PARAMS,"".concat(rt," is not a valid ConstrainLong"));_e.min!==void 0&&us(_e.min,"".concat(rt,".min"),0,1/0),_e.max!==void 0&&us(_e.max,"".concat(rt,".max"),1,1/0),_e.exact!==void 0&&us(_e.exact,"".concat(rt,".exact"),1,1/0),_e.ideal!==void 0&&us(_e.ideal,"".concat(rt,".ideal"),1,1/0)}else us(_e,rt,1,1/0)}function Hl(_e,rt){let it=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,ct=arguments.length>3&&arguments[3]!==void 0?arguments[3]:255,ut=!(arguments.length>4&&arguments[4]!==void 0)||arguments[4];if(_e==null)throw new Yn(tn.INVALID_PARAMS,"".concat(rt||"param"," cannot be empty"));if(!b3(_e,it,ct,ut))throw new Yn(tn.INVALID_PARAMS,"Invalid ".concat(rt||"string param",": Length of the string: [").concat(it,",").concat(ct,"].").concat(ut?" ASCII characters only.":""))}function pE(_e,rt){if(!Array.isArray(_e))throw new Yn(tn.INVALID_PARAMS,"".concat(rt," should be an array"))}function $s(_e){return _e==null}function b3(_e){let rt=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,it=arguments.length>2&&arguments[2]!==void 0?arguments[2]:255,ct=!(arguments.length>3&&arguments[3]!==void 0)||arguments[3];return typeof _e=="string"&&_e.length<=it&&_e.length>=rt&&(!ct||function(ut){if(typeof ut!="string")return!1;for(let pt=0;pt<ut.length;pt+=1){const mt=ut.charCodeAt(pt);if(mt<0||mt>255)return!1}return!0}(_e))}var dA=function(_e){return _e.COVERED="COVERED",_e.POSITION="POSITION",_e.SIZE="SIZE",_e.STYLE="STYLE",_e}(dA||{}),EO=function(_e){return _e.UNMOUNTED="UNMOUNTED",_e.INVALID_HTML_ELEMENT="INVALID_HTML_ELEMENT",_e}(EO||{});const R3=new class{constructor(){so(this,"_clientSize",null),so(this,"getClientWidth",()=>document.documentElement?document.documentElement.clientWidth:document.body.clientWidth),so(this,"getClientHeight",()=>document.documentElement?document.documentElement.clientHeight:document.body.clientHeight),so(this,"getStyle",_e=>window.getComputedStyle(_e,null)),so(this,"checkCssVisibleProperty",_e=>{var rt;let it=!0;const ct=this.getStyle(_e),{display:ut,visibility:pt,opacity:mt,filter:_t}=ct;return(ut==="none"||Er(rt=["hidden","collapse"]).call(rt,pt)||Number(mt)<.1)&&(it=!1),!!it&&(_t&&_t.split(" ").filter(vt=>{var Tt;const bt=vt.split("(")[0];return Er(Tt=["brightness","blur","opacity"]).call(Tt,bt)}).map(vt=>{const[Tt,bt]=vt.split(/\(|\)/);return[Tt,Number(bt.match(/^[0-9\.]+/))]}).forEach(vt=>{const[Tt,bt]=vt;switch(Tt){case"brightness":(bt<.1||bt>3)&&(it=!1);break;case"blur":bt>3&&(it=!1);break;case"opacity":bt<.1&&(it=!1)}}),it)}),so(this,"checkPropertyUpToAllParentNodes",(_e,rt)=>{let it=!0,ct=!0;const ut=mt=>rt(mt);let pt=_e;for(;pt&&ct;)ut(pt)||(it=!1,ct=!1),pt=pt.parentElement,pt||(ct=!1);return it}),so(this,"checkActualCssVisibleIncludeInherit",_e=>this.checkPropertyUpToAllParentNodes(_e,this.checkCssVisibleProperty)),so(this,"getSizeAboutClient",_e=>{const{width:rt,height:it,left:ct,right:ut,top:pt,bottom:mt}=_e.getBoundingClientRect(),_t=this.getClientWidth(),vt=this.getClientHeight();return{width:rt,height:it,left:ct,right:ut,top:pt,bottom:mt,clientWidth:_t,clientHeight:vt,clientMin:Math.min(_t,vt)}}),so(this,"checkActualSize",()=>{const{width:_e,height:rt,clientMin:it}=this._clientSize;return this.checkSizeIsVisible(_e,rt,it)}),so(this,"elementFromPoint",(_e,rt)=>document.elementFromPoint?document.elementFromPoint(_e,rt):null),so(this,"checkCoverForAPoint",(_e,rt,it)=>{const ct=this.elementFromPoint(_e,rt);return ct!==null&&ct!==it}),so(this,"getPointPositionList",()=>{const{width:_e,height:rt,left:it,top:ct}=this._clientSize,ut=_e/6,pt=rt/6,mt=[],_t=10**6;for(let vt=0;vt<5;vt++)for(let Tt=0;Tt<5;Tt++){const bt=(it*_t+(vt===0?.1:vt===4?(ut*vt*_t-1e5)/_t:ut*vt)*_t)/_t,Ot=(ct*_t+(Tt===0?.1:Tt===4?(pt*Tt*_t-1e5)/_t:pt*Tt)*_t)/_t;mt.push({x:bt,y:Ot})}return[...mt]}),so(this,"checkElementCover",_e=>this.getPointPositionList().map(rt=>this.checkCoverForAPoint(rt.x,rt.y,_e)).filter(rt=>!!rt).length>6),so(this,"checkSizeIsVisible",(_e,rt,it)=>(_e>50||it/_e<=10)&&(rt>50||it/rt<=10)),so(this,"checkSizeOfPartInClient",()=>{const{left:_e,right:rt,top:it,bottom:ct,clientHeight:ut,clientWidth:pt,clientMin:mt}=this._clientSize;let _t,vt,Tt,bt;if(_e<0)_t=0;else{if(!(_e<pt))return!1;_t=_e}if(rt<0)return!1;if(vt=rt<pt?rt:pt,it<0)Tt=0;else{if(!(it<ut))return!1;Tt=it}if(ct<0)return!1;bt=ct<ut?ct:ut;const Ot=vt-_t,Mt=bt-Tt;return this.checkSizeIsVisible(Ot,Mt,mt)}),so(this,"returnHiddenResult",_e=>(this._clientSize=null,{visible:!1,reason:_e})),so(this,"checkOneElementVisible",_e=>{if(_e instanceof HTMLElement){if(this.checkElementIsMountedOnDom(_e)){if(this.checkActualCssVisibleIncludeInherit(_e)){if(this._clientSize=this.getSizeAboutClient(_e),this.checkElementCover(_e))return this.returnHiddenResult(dA.COVERED);{const rt=this.checkActualSize(),it=this.checkSizeOfPartInClient();return rt&&!it?this.returnHiddenResult(dA.POSITION):rt?(this._clientSize=null,{visible:!0}):this.returnHiddenResult(dA.SIZE)}}return this.returnHiddenResult(dA.STYLE)}return this.returnHiddenResult(EO.UNMOUNTED)}return this.returnHiddenResult(EO.INVALID_HTML_ELEMENT)}),so(this,"checkElementIsMountedOnDom",_e=>this.checkPropertyUpToAllParentNodes(_e,rt=>rt.nodeName.toUpperCase()!=="HTML"?rt.parentElement!==null:!!document.documentElement))}};function vO(_e){return new TextEncoder().encode(_e)}const w3=function(_e,rt){const it=new Uint8Array(_e.byteLength+rt.byteLength);return it.set(new Uint8Array(_e),0),it.set(new Uint8Array(rt),_e.byteLength),it},yO=async _e=>function(rt,it){let ct="";return new Uint8Array(rt).forEach(ut=>{ct+=ut.toString(it).padStart(2,"0")}),ct}(await crypto.subtle.digest("SHA-256",vO(_e)),16);class Fs{constructor(){so(this,"_events",{}),so(this,"addListener",this.on)}getListeners(rt){return this._events[rt]?this._events[rt].map(it=>it.listener):[]}on(rt,it){this._events[rt]||(this._events[rt]=[]);const ct=this._events[rt];this._indexOfListener(ct,it)===-1&&ct.push({listener:it,once:!1})}once(rt,it){this._events[rt]||(this._events[rt]=[]);const ct=this._events[rt];this._indexOfListener(ct,it)===-1&&ct.push({listener:it,once:!0})}off(rt,it){if(!this._events[rt])return;const ct=this._events[rt],ut=this._indexOfListener(ct,it);ut!==-1&&ct.splice(ut,1),this._events[rt].length===0&&delete this._events[rt]}removeAllListeners(rt){rt?delete this._events[rt]:this._events={}}emit(rt){this._events[rt]||(this._events[rt]=[]);const it=this._events[rt].map(mt=>mt);for(var ct=arguments.length,ut=new Array(ct>1?ct-1:0),pt=1;pt<ct;pt++)ut[pt-1]=arguments[pt];for(let mt=0;mt<it.length;mt+=1){const _t=it[mt];_t.once&&this.off(rt,_t.listener),_t.listener.apply(this,ut||[])}}safeEmit(rt){for(var it=arguments.length,ct=new Array(it>1?it-1:0),ut=1;ut<it;ut++)ct[ut-1]=arguments[ut];[...this._events[rt]||[]].forEach(pt=>{pt.once&&this.off(rt,pt.listener);try{pt.listener.apply(this,ct)}catch(mt){console.error("safeEmit event:".concat(rt," error ").concat(mt==null?void 0:mt.toString()))}})}_indexOfListener(rt,it){let ct=rt.length;for(;ct--;)if(rt[ct].listener===it)return ct;return-1}}let hA=null;function I3(){if(hA)return hA;if(window.electron)return hA=window.electron;if(!window.require)return null;try{return hA=window.require("electron"),hA}catch{return null}}let Ks=function(_e){return _e.CREATE_CLIENT="createClient",_e.CHECK_SYSTEM_REQUIREMENTS="checkSystemRequirements",_e.SET_AREA="setArea",_e.PRELOAD="PRELOAD",_e.CHECK_VIDEO_TRACK_IS_ACTIVE="checkVideoTrackIsActive",_e.CHECK_AUDIO_TRACK_IS_ACTIVE="checkAudioTrackIsActive",_e.CREATE_MIC_AUDIO_TRACK="createMicrophoneAudioTrack",_e.CREATE_CUSTOM_AUDIO_TRACK="createCustomAudioTrack",_e.CREATE_BUFFER_AUDIO_TRACK="createBufferSourceAudioTrack",_e.CREATE_CAM_VIDEO_TRACK="createCameraVideoTrack",_e.CREATE_CUSTOM_VIDEO_TRACK="createCustomVideoTrack",_e.CREATE_MIC_AND_CAM_TRACKS="createMicrophoneAndCameraTracks",_e.CREATE_SCREEN_VIDEO_TRACK="createScreenVideoTrack",_e.SET_ENCRYPTION_CONFIG="Client.setEncryptionConfig",_e.START_PROXY_SERVER="Client.startProxyServer",_e.STOP_PROXY_SERVER="Client.stopProxyServer",_e.SET_PROXY_SERVER="Client.setProxyServer",_e.SET_TURN_SERVER="Client.setTurnServer",_e.SET_CLIENT_ROLE="Client.setClientRole",_e.SET_LOW_STREAM_PARAMETER="Client.setLowStreamParameter",_e.ENABLE_DUAL_STREAM="Client.enableDualStream",_e.DISABLE_DUAL_STREAM="Client.disableDualStream",_e.JOIN="Client.join",_e.LEAVE="Client.leave",_e.PUBLISH="Client.publish",_e.UNPUBLISH="Client.unpublish",_e.SUBSCRIBE="Client.subscribe",_e.MASS_SUBSCRIBE="Client.massSubscribe",_e.MASS_UNSUBSCRIBE="Client.massUnsubscribe",_e.UNSUBSCRIBE="Client.unsubscribe",_e.RENEW_TOKEN="Client.renewToken",_e.SET_REMOTE_VIDEO_STREAM_TYPE="Client.setRemoteVideoStreamType",_e.SET_STREAM_FALLBACK_OPTION="Client.setStreamFallbackOption",_e.ENABLE_AUDIO_VOLUME_INDICATOR="Client.enableAudioVolumeIndicator",_e.SEND_CUSTOM_REPORT_MESSAGE="Client.sendCustomReportMessage",_e.INSPECT_VIDEO_CONTENT="Client.inspectVideoContent",_e.STOP_INSPECT_VIDEO_CONTENT="Client.stopInspectVideoContent",_e.JOIN_FALLBACK_TO_PROXY="Client._joinFallbackToProxy",_e.ON_LIVE_STREAM_WARNING="Client.onLiveStreamWarning",_e.ON_LIVE_STREAM_ERROR="Client.onLiveStreamingError",_e.START_LIVE_STREAMING="Client.startLiveStreaming",_e.SET_LIVE_TRANSCODING="Client.setLiveTranscoding",_e.STOP_LIVE_STREAMING="Client.stopLiveStreaming",_e.START_CHANNEL_MEDIA_RELAY="Client.startChannelMediaRelay",_e.UPDATE_CHANNEL_MEDIA_RELAY="Client.updateChannelMediaRelay",_e.STOP_CHANNEL_MEDIA_RELAY="Client.stopChannelMediaRelay",_e.REQUEST_CONFIG_DISTRIBUTE="_config-distribute-request",_e.SET_CONFIG_DISTRIBUTE="_configDistribute",_e.LOCAL_TRACK_SET_MUTED="LocalTrack.setMute",_e.LOCAL_AUDIO_TRACK_PLAY="LocalAudioTrack.play",_e.LOCAL_AUDIO_TRACK_PLAY_IN_ELEMENT="LocalAudioTrack.playInElement",_e.LOCAL_AUDIO_TRACK_STOP="LocalAudioTrack.stop",_e.LOCAL_AUDIO_TRACK_SET_VOLUME="LocalAudioTrack.setVolume",_e.MIC_AUDIO_TRACK_SET_DEVICE="MicrophoneAudioTrack.setDevice",_e.BUFFER_AUDIO_TRACK_START="BufferSourceAudioTrack.startProcessAudioBuffer",_e.BUFFER_AUDIO_TRACK_STOP="BufferSourceAudioTrack.stopProcessAudioBuffer",_e.BUFFER_AUDIO_TRACK_PAUSE="BufferSourceAudioTrack.pauseProcessAudioBuffer",_e.BUFFER_AUDIO_TRACK_RESUME="BufferSourceAudioTrack.resumeProcessAudioBuffer",_e.BUFFER_AUDIO_TRACK_SEEK="BufferSourceAudioTrack.seekAudioBuffer",_e.LOCAL_VIDEO_TRACK_PLAY="LocalVideoTrack.play",_e.LOCAL_VIDEO_TRACK_STOP="LocalVideoTrack.stop",_e.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE="LocalVideoTrack.getVideoElementVisibleStatus",_e.LOCAL_VIDEO_TRACK_BEAUTY="LocalVideoTrack.setBeautyEffect",_e.LOCAL_VIDEO_SEND_SEI_DATA="LocalVideoTrack.sendSeiData",_e.CAM_VIDEO_TRACK_SET_DEVICE="CameraVideoTrack.setDevice",_e.CAM_VIDEO_TRACK_SET_ENCODER_CONFIG="CameraVideoTrack.setEncoderConfiguration",_e.REMOTE_VIDEO_TRACK_PLAY="RemoteVideoTrack.play",_e.REMOTE_VIDEO_TRACK_STOP="RemoteVideoTrack.stop",_e.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE="RemoteVideoTrack.getVideoElementVisibleStatus",_e.REMOTE_AUDIO_TRACK_PLAY="RemoteAudioTrack.play",_e.REMOTE_AUDIO_TRACK_STOP="RemoteAudioTrack.stop",_e.REMOTE_AUDIO_SET_VOLUME="RemoteAudioTrack.setVolume",_e.REMOTE_AUDIO_SET_OUTPUT_DEVICE="RemoteAudioTrack.setOutputDevice",_e.GET_MEDIA_STREAM_TRACK="Track.getMediaStreamTrack",_e.STREAM_TYPE_CHANGE="streamTypeChange",_e.CONNECTION_STATE_CHANGE="connectionStateChange",_e.LOAD_CONFIG_FROM_LOCALSTORAGE="loadConfigFromLocalStorage",_e.IMAGE_MODERATION_UPLOAD="imageModerationUpload",_e.REPUB_AFTER_PC_CONNECTED="repubAfterPCConnected",_e.PRELOAD_MEDIA_FAILED="preloadMediaFailed",_e.MISMATCH_DTLS_PARAMETERS="mismatchDtlsParameters",_e}({}),Ns=function(_e){return _e.TRACER="tracer",_e}({});function x3(_e){return us(_e.timeout,"config.timeout",0,1e5),us(_e.timeoutFactor,"config.timeoutFactor",0,100,!1),us(_e.maxRetryCount,"config.maxRetryConfig",0,1/0),us(_e.maxRetryTimeout,"config.maxRetryTimeout",0,1/0),!0}let cY=function(_e){return _e[_e.AUDIENCE_LEVEL_LOW_LATENCY=1]="AUDIENCE_LEVEL_LOW_LATENCY",_e[_e.AUDIENCE_LEVEL_ULTRA_LOW_LATENCY=2]="AUDIENCE_LEVEL_ULTRA_LOW_LATENCY",_e[_e.AUDIENCE_LEVEL_SYNC_LATENCY=3]="AUDIENCE_LEVEL_SYNC_LATENCY",_e}({}),Xo=function(_e){return _e.LEAVE="LEAVE",_e.NETWORK_ERROR="NETWORK_ERROR",_e.SERVER_ERROR="SERVER_ERROR",_e.UID_BANNED="UID_BANNED",_e.FALLBACK="FALLBACK",_e.IP_BANNED="IP_BANNED",_e.CHANNEL_BANNED="CHANNEL_BANNED",_e.LICENSE_MISSING="LICENSE_MISSING",_e.LICENSE_EXPIRED="LICENSE_EXPIRED",_e.LICENSE_MINUTES_EXCEEDED="LICENSE_MINUTES_EXCEEDED",_e.LICENSE_PERIOD_INVALID="LICENSE_PERIOD_INVALID",_e.LICENSE_MULTIPLE_SDK_SERVICE="LICENSE_MULTIPLE_SDK_SERVICE",_e.LICENSE_ILLEGAL="LICENSE_ILLEGAL",_e.TOKEN_EXPIRE="TOKEN_EXPIRE",_e}({});function pA(_e){if(!Array.isArray(_e)||_e.length<1)return!1;try{_e.forEach(rt=>{if(!rt.urls)throw Error()})}catch{return!1}return!0}function O3(_e){return Hl(_e.turnServerURL,"turnServerURL"),Hl(_e.username,"username"),Hl(_e.password,"password"),_e.udpport&&us(_e.udpport,"udpport",1,99999,!0),_e.forceturn&&t_(_e.forceturn,"forceturn"),_e.security&&t_(_e.security,"security"),_e.tcpport&&us(_e.tcpport,"tcpport",1,99999,!0),!0}function SO(_e){return _e.level!==void 0&&Cl(_e.level,"level",[1,2,3]),_e.delay!==void 0&&us(_e.delay,"delay",0,3e3,!0),!0}let wo=function(_e){return _e.PEERCONNECTION_STATE_CHANGE="peerconnection-state-change",_e.AUDIO_METADATA="audio-metadata",_e.AUDIO_PTS="audio-pts",_e.CONNECTION_STATE_CHANGE="connection-state-change",_e.MEDIA_RECONNECT_START="media-reconnect-start",_e.MEDIA_RECONNECT_END="media-reconnect-end",_e.IS_USING_CLOUD_PROXY="is-using-cloud-proxy",_e.USER_JOINED="user-joined",_e.USER_LEAVED="user-left",_e.USER_PUBLISHED="user-published",_e.USER_UNPUBLISHED="user-unpublished",_e.USER_INFO_UPDATED="user-info-updated",_e.CLIENT_BANNED="client-banned",_e.CHANNEL_MEDIA_RELAY_STATE="channel-media-relay-state",_e.CHANNEL_MEDIA_RELAY_EVENT="channel-media-relay-event",_e.VOLUME_INDICATOR="volume-indicator",_e.CRYPT_ERROR="crypt-error",_e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="token-privilege-will-expire",_e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="token-privilege-did-expire",_e.NETWORK_QUALITY="network-quality",_e.STREAM_TYPE_CHANGED="stream-type-changed",_e.STREAM_FALLBACK="stream-fallback",_e.RECEIVE_METADATA="receive-metadata",_e.STREAM_MESSAGE="stream-message",_e.LIVE_STREAMING_ERROR="live-streaming-error",_e.LIVE_STREAMING_WARNING="live-streaming-warning",_e.EXCEPTION="exception",_e.ERROR="error",_e.P2P_LOST="p2p_lost",_e.JOIN_FALLBACK_TO_PROXY="join-fallback-to-proxy",_e.CHANNEL_FALLBACK_TO_WEBSOCKET="channel-fallback-to-websocket",_e.MEDIA_CONNECTION_TYPE_CHANGE="media-connection-type-change",_e.PUBLISHED_USER_LIST="published-user-list",_e.CONTENT_INSPECT_CONNECTION_STATE_CHANGE="content-inspect-connection-state-change",_e.CONTENT_INSPECT_ERROR="content-inspect-error",_e.CONTENT_INSPECT_RESULT="content-inspect-result",_e.IMAGE_MODERATION_CONNECTION_STATE_CHANGE="image-moderation-connection-state-change",_e}({}),nu=function(_e){return _e.NETWORK_ERROR="NETWORK_ERROR",_e.SERVER_ERROR="SERVER_ERROR",_e.MULTI_IP="MULTI_IP",_e.TIMEOUT="TIMEOUT",_e.OFFLINE="OFFLINE",_e.LEAVE="LEAVE",_e.P2P_FAILED="P2P_FAILED",_e.FALLBACK="FALLBACK",_e.REGIONAL_DISTRIBUTION="REGIONAL_DISTRIBUTION",_e}({}),Cp=function(_e){return _e.ONLINE="ONLINE",_e.OFFLINE="OFFLINE",_e}({}),pS=function(_e){return _e.NETWORK_STATE_CHANGE="NETWORK_STATE_CHANGE",_e.ONLINE="ONLINE",_e.OFFLINE="OFFLINE",_e}({});function ru(_e,rt){for(var it=arguments.length,ct=new Array(it>2?it-2:0),ut=2;ut<it;ut++)ct[ut-2]=arguments[ut];return _e.getListeners(rt).length===0?Ir.reject(new Yn(tn.UNEXPECTED_ERROR,"can not emit promise")):new Ir((pt,mt)=>{_e.emit(rt,...ct,pt,mt)})}function ps(_e,rt){if(_e.getListeners(rt).length===0)return Ir.resolve();for(var it=arguments.length,ct=new Array(it>2?it-2:0),ut=2;ut<it;ut++)ct[ut-2]=arguments[ut];return ru(_e,rt,...ct)}function Dp(_e,rt){if(_e.getListeners(rt).length===0)return null;for(var it=arguments.length,ct=new Array(it>2?it-2:0),ut=2;ut<it;ut++)ct[ut-2]=arguments[ut];return fA(_e,rt,...ct)}function fA(_e,rt){let it=null,ct=null;for(var ut=arguments.length,pt=new Array(ut>2?ut-2:0),mt=2;mt<ut;mt++)pt[mt-2]=arguments[mt];if(_e.emit(rt,...pt,_t=>{it=_t},_t=>{ct=_t}),ct!==null)throw ct;if(it===null)throw new Yn(tn.UNEXPECTED_ERROR,"handler is not sync");return it}const Qs=new class extends Fs{set networkState(_e){this.emit(pS.NETWORK_STATE_CHANGE,_e,this._networkState),_e===Cp.ONLINE?this.emit(pS.ONLINE):_e===Cp.OFFLINE&&(this.onlineWaiter=new Ir(rt=>{this.once(pS.ONLINE,()=>{this.onlineWaiter=void 0,rt(Cp.ONLINE)})}),this.emit(pS.OFFLINE)),this._networkState=_e}get networkState(){return this._networkState}get isOnline(){return this._networkState===Cp.ONLINE}constructor(){super(),so(this,"_moduleName","network-indicator"),so(this,"_networkState",Cp.ONLINE),so(this,"onlineWaiter",void 0),window.addEventListener("online",()=>{this.networkState=Cp.ONLINE}),window.addEventListener("offline",()=>{this.networkState=Cp.OFFLINE})}};function hw(_e,rt){const it=_e.indexOf(rt);it!==-1&&_e.splice(it,1)}function fS(_e){const rt=[];return _e.forEach(it=>{rt.indexOf(it)===-1&&rt.push(it)}),rt}function pw(_e){Ir!==void 0?Ir.resolve().then(_e):setTimeout(_e,0)}function Ds(_e){return JSON.parse(JSON.stringify(_e))}function m0(_e){try{return Ds(_e)}catch{return _e}}const M3={};function tv(_e,rt){M3[rt]||(M3[rt]=!0,_e())}function g0(_e){const rt=window.atob(_e),it=new Uint8Array(new ArrayBuffer(rt.length));for(let ct=0;ct<rt.length;ct+=1)it[ct]=rt.charCodeAt(ct);return it}function nv(_e){let rt="";for(let it=0;it<_e.length;it+=1)rt+=String.fromCharCode(_e[it]);return window.btoa(rt)}function P3(_e){let rt=arguments.length>1&&arguments[1]!==void 0?arguments[1]:16,it=new TextEncoder().encode(_e);if(it.length>rt)it=it.slice(0,rt);else if(it.length<rt){const ct=new Uint8Array(rt);ct.set(it),it=ct}return it}function N3(){for(var _e=arguments.length,rt=new Array(_e),it=0;it<_e;it++)rt[it]=arguments[it];const ct=_p(rt).call(rt,(mt,_t)=>mt+_t.length,0),ut=new Uint8Array(new ArrayBuffer(ct));let pt=0;return rt.forEach(mt=>{ut.set(mt,pt),pt+=mt.length}),ut}function M_(_e){return window.TextEncoder?new TextEncoder().encode(_e).length:_e.length}function D3(_e){let rt=0;return(/DingTalk/i.test(navigator.userAgent)||/AliApp/i.test(navigator.userAgent))&&_e.realFormData&&(_e=_e.realFormData),_e.forEach(it=>{rt+=typeof it=="string"?M_(it):it.size}),rt+138}function lY(_e){const rt=new Yn(tn.TIMEOUT,"timeout");return new Ir((it,ct)=>{window.setTimeout(()=>ct(rt),_e)})}function zl(_e){return new Ir(rt=>{window.setTimeout(rt,_e)})}function ms(){let _e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:7,rt=arguments.length>1?arguments[1]:void 0;const it=Math.random().toString(16).substr(2,_e).toLowerCase();return it.length===_e?"".concat(rt).concat(it):"".concat(rt).concat(it)+ms(_e-it.length,"")}function _0(){return ms(32,"").toUpperCase()}const fw=()=>{},L3=new class{constructor(){so(this,"fnMap",new Map)}throttleByKey(_e,rt,it,ct){for(var ut=arguments.length,pt=new Array(ut>4?ut-4:0),mt=4;mt<ut;mt++)pt[mt-4]=arguments[mt];if(this.fnMap.has(rt)){const _t=this.fnMap.get(rt);if(_t.threshold!==it){_t.fn(..._t.args),clearTimeout(_t.timer);const vt=window.setTimeout(()=>{const Tt=this.fnMap.get(rt);Tt&&Tt.fn(...Tt.args),this.fnMap.delete(rt)},it);this.fnMap.set(rt,{fn:_e,threshold:it,timer:vt,args:pt,skipFn:ct})}else _t.skipFn&&_t.skipFn(..._t.args),this.fnMap.set(rt,hr(hr({},_t),{},{fn:_e,args:pt,skipFn:ct}))}else{const _t=window.setTimeout(()=>{const vt=this.fnMap.get(rt);vt&&vt.fn(...vt.args),this.fnMap.delete(rt)},it);this.fnMap.set(rt,{fn:_e,threshold:it,timer:_t,args:pt,skipFn:ct})}}},k3=L3.throttleByKey.bind(L3);function U3(_e){return typeof _e=="object"&&_e!==null&&!(_e instanceof RegExp)}function TO(_e,rt){if(!U3(_e)||!U3(rt)||Array.isArray(_e)&&!Array.isArray(rt)||!Array.isArray(_e)&&Array.isArray(rt))return rt;if(Array.isArray(rt)&&Array.isArray(_e)){const it=[..._e];for(let ct=0;ct<rt.length;ct++)it[ct]=TO(_e[ct],rt[ct]);return it}{const it=hr({},_e);for(const ct in rt)Object.prototype.hasOwnProperty.call(rt,ct)&&(Object.prototype.hasOwnProperty.call(_e,ct)?it[ct]=TO(_e[ct],rt[ct]):it[ct]=rt[ct]);return it}}function B3(_e,rt){let it=[0];if(rt&&(it=new Array(rt).fill(0)),_e===0)return it;let ct=0;for(;_e>0&&(it[ct]=255&_e,_e>>=8,ct++,!rt||ct!==rt););return it}function mS(_e){return typeof _e=="number"?_e:_e.exact||_e.ideal||_e.max||_e.min||0}function AO(_e){return _p(_e).call(_e,(rt,it)=>rt+it,0)}function F3(_e){const rt="0123456789abcdef";function it(on){let Tn,vn="";for(Tn=0;Tn<=3;Tn++)vn+=rt.charAt(on>>8*Tn+4&15)+rt.charAt(on>>8*Tn&15);return vn}function ct(on,Tn){const vn=(65535&on)+(65535&Tn);return(on>>16)+(Tn>>16)+(vn>>16)<<16|65535&vn}function ut(on,Tn,vn,hn,Ln,Xn){return ct(function(Qn,ur){return Qn<<ur|Qn>>>32-ur}(ct(ct(Tn,on),ct(hn,Xn)),Ln),vn)}function pt(on,Tn,vn,hn,Ln,Xn,Qn){return ut(Tn&vn|~Tn&hn,on,Tn,Ln,Xn,Qn)}function mt(on,Tn,vn,hn,Ln,Xn,Qn){return ut(Tn&hn|vn&~hn,on,Tn,Ln,Xn,Qn)}function _t(on,Tn,vn,hn,Ln,Xn,Qn){return ut(Tn^vn^hn,on,Tn,Ln,Xn,Qn)}function vt(on,Tn,vn,hn,Ln,Xn,Qn){return ut(vn^(Tn|~hn),on,Tn,Ln,Xn,Qn)}const Tt=function(on){let Tn;const vn=1+(on.length+8>>6),hn=new Array(16*vn);for(Tn=0;Tn<16*vn;Tn++)hn[Tn]=0;for(Tn=0;Tn<on.length;Tn++)hn[Tn>>2]|=on.charCodeAt(Tn)<<Tn%4*8;return hn[Tn>>2]|=128<<Tn%4*8,hn[16*vn-2]=8*on.length,hn}(_e);let bt,Ot,Mt,Dt,jt,$t=1732584193,Ht=-271733879,en=-1732584194,Qt=271733878;for(bt=0;bt<Tt.length;bt+=16)Ot=$t,Mt=Ht,Dt=en,jt=Qt,$t=pt($t,Ht,en,Qt,Tt[bt+0],7,-680876936),Qt=pt(Qt,$t,Ht,en,Tt[bt+1],12,-389564586),en=pt(en,Qt,$t,Ht,Tt[bt+2],17,606105819),Ht=pt(Ht,en,Qt,$t,Tt[bt+3],22,-1044525330),$t=pt($t,Ht,en,Qt,Tt[bt+4],7,-176418897),Qt=pt(Qt,$t,Ht,en,Tt[bt+5],12,1200080426),en=pt(en,Qt,$t,Ht,Tt[bt+6],17,-1473231341),Ht=pt(Ht,en,Qt,$t,Tt[bt+7],22,-45705983),$t=pt($t,Ht,en,Qt,Tt[bt+8],7,1770035416),Qt=pt(Qt,$t,Ht,en,Tt[bt+9],12,-1958414417),en=pt(en,Qt,$t,Ht,Tt[bt+10],17,-42063),Ht=pt(Ht,en,Qt,$t,Tt[bt+11],22,-1990404162),$t=pt($t,Ht,en,Qt,Tt[bt+12],7,1804603682),Qt=pt(Qt,$t,Ht,en,Tt[bt+13],12,-40341101),en=pt(en,Qt,$t,Ht,Tt[bt+14],17,-1502002290),Ht=pt(Ht,en,Qt,$t,Tt[bt+15],22,1236535329),$t=mt($t,Ht,en,Qt,Tt[bt+1],5,-165796510),Qt=mt(Qt,$t,Ht,en,Tt[bt+6],9,-1069501632),en=mt(en,Qt,$t,Ht,Tt[bt+11],14,643717713),Ht=mt(Ht,en,Qt,$t,Tt[bt+0],20,-373897302),$t=mt($t,Ht,en,Qt,Tt[bt+5],5,-701558691),Qt=mt(Qt,$t,Ht,en,Tt[bt+10],9,38016083),en=mt(en,Qt,$t,Ht,Tt[bt+15],14,-660478335),Ht=mt(Ht,en,Qt,$t,Tt[bt+4],20,-405537848),$t=mt($t,Ht,en,Qt,Tt[bt+9],5,568446438),Qt=mt(Qt,$t,Ht,en,Tt[bt+14],9,-1019803690),en=mt(en,Qt,$t,Ht,Tt[bt+3],14,-187363961),Ht=mt(Ht,en,Qt,$t,Tt[bt+8],20,1163531501),$t=mt($t,Ht,en,Qt,Tt[bt+13],5,-1444681467),Qt=mt(Qt,$t,Ht,en,Tt[bt+2],9,-51403784),en=mt(en,Qt,$t,Ht,Tt[bt+7],14,1735328473),Ht=mt(Ht,en,Qt,$t,Tt[bt+12],20,-1926607734),$t=_t($t,Ht,en,Qt,Tt[bt+5],4,-378558),Qt=_t(Qt,$t,Ht,en,Tt[bt+8],11,-2022574463),en=_t(en,Qt,$t,Ht,Tt[bt+11],16,1839030562),Ht=_t(Ht,en,Qt,$t,Tt[bt+14],23,-35309556),$t=_t($t,Ht,en,Qt,Tt[bt+1],4,-1530992060),Qt=_t(Qt,$t,Ht,en,Tt[bt+4],11,1272893353),en=_t(en,Qt,$t,Ht,Tt[bt+7],16,-155497632),Ht=_t(Ht,en,Qt,$t,Tt[bt+10],23,-1094730640),$t=_t($t,Ht,en,Qt,Tt[bt+13],4,681279174),Qt=_t(Qt,$t,Ht,en,Tt[bt+0],11,-358537222),en=_t(en,Qt,$t,Ht,Tt[bt+3],16,-722521979),Ht=_t(Ht,en,Qt,$t,Tt[bt+6],23,76029189),$t=_t($t,Ht,en,Qt,Tt[bt+9],4,-640364487),Qt=_t(Qt,$t,Ht,en,Tt[bt+12],11,-421815835),en=_t(en,Qt,$t,Ht,Tt[bt+15],16,530742520),Ht=_t(Ht,en,Qt,$t,Tt[bt+2],23,-995338651),$t=vt($t,Ht,en,Qt,Tt[bt+0],6,-198630844),Qt=vt(Qt,$t,Ht,en,Tt[bt+7],10,1126891415),en=vt(en,Qt,$t,Ht,Tt[bt+14],15,-1416354905),Ht=vt(Ht,en,Qt,$t,Tt[bt+5],21,-57434055),$t=vt($t,Ht,en,Qt,Tt[bt+12],6,1700485571),Qt=vt(Qt,$t,Ht,en,Tt[bt+3],10,-1894986606),en=vt(en,Qt,$t,Ht,Tt[bt+10],15,-1051523),Ht=vt(Ht,en,Qt,$t,Tt[bt+1],21,-2054922799),$t=vt($t,Ht,en,Qt,Tt[bt+8],6,1873313359),Qt=vt(Qt,$t,Ht,en,Tt[bt+15],10,-30611744),en=vt(en,Qt,$t,Ht,Tt[bt+6],15,-1560198380),Ht=vt(Ht,en,Qt,$t,Tt[bt+13],21,1309151649),$t=vt($t,Ht,en,Qt,Tt[bt+4],6,-145523070),Qt=vt(Qt,$t,Ht,en,Tt[bt+11],10,-1120210379),en=vt(en,Qt,$t,Ht,Tt[bt+2],15,718787259),Ht=vt(Ht,en,Qt,$t,Tt[bt+9],21,-343485551),$t=ct($t,Ot),Ht=ct(Ht,Mt),en=ct(en,Dt),Qt=ct(Qt,jt);return it($t)+it(Ht)+it(en)+it(Qt)}let uY=1,V3=console,lu=class{static setLogger(_e){V3=_e}constructor(_e,rt){so(this,"id",void 0),so(this,"lockingPromise",Ir.resolve()),so(this,"locks",0),so(this,"name",""),so(this,"lockId",void 0),this.lockId=uY++,_e&&(this.name=_e),rt&&(this.id=rt),this.logger("created")}logger(_e,rt){const it=(this.id?"[".concat(this.id,"]"):"")+"[lock-".concat(this.name,"-").concat(this.lockId,"]"),ct=_e==="created"?"is ".concat(_e,"."):"is ".concat(_e,", current queue ").concat(this.locks,". ").concat(rt??"");V3.debug("".concat(it," ").concat(ct))}setId(_e){this.id=_e}get isLocked(){return this.locks>0}lock(_e){let rt;this.locks+=1,this.logger("locked",_e);const it=new Ir(ut=>{rt=()=>{this.locks-=1,this.logger("unlocked",_e),ut()}}),ct=this.lockingPromise.then(()=>rt);return this.lockingPromise=this.lockingPromise.then(()=>it),ct}};function gS(_e,rt){return function(it,ct,ut){const pt=ut.value;if(typeof pt!="function")throw new Error("Cannot use mutex on object property.");return ut.value=async function(){const mt=this[rt];if(!mt)throw new Error("mutex property key ".concat(rt," doesn't exist on ").concat(_e));const _t=await mt.lock("From ".concat(_e,".").concat(ct));try{for(var vt=arguments.length,Tt=new Array(vt),bt=0;bt<vt;bt++)Tt[bt]=arguments[bt];return await pt.apply(this,Tt)}finally{_t()}},ut}}const xa={timeout:500,timeoutFactor:1.5,maxRetryCount:1/0,maxRetryTimeout:1e4};function CO(_e,rt){const it=Math.floor(rt.timeout*Math.pow(rt.timeoutFactor,_e));return Math.min(rt.maxRetryTimeout,it)}function n_(_e,rt,it,ct){const ut=Object.assign({},xa,ct);let pt=ut.timeout;const mt=async()=>{await function(Tt){return new Ir(bt=>{window.setTimeout(bt,Tt)})}(pt),pt*=ut.timeoutFactor,pt=Math.min(ut.maxRetryTimeout,pt)};let _t=!1;const vt=new Ir(async(Tt,bt)=>{rt=rt||(()=>!1),it=it||(()=>!0);for(let Ot=0;Ot<ut.maxRetryCount;Ot+=1){if(_t)return bt(new Yn(tn.OPERATION_ABORTED));try{const Mt=await _e();if(!rt(Mt,Ot)||Ot+1===ut.maxRetryCount)return Tt(Mt);await mt()}catch(Mt){if(!it(Mt,Ot)||Ot+1===ut.maxRetryCount)return bt(Mt);await mt()}}});return vt.cancel=()=>_t=!0,vt}let mw,G3=class{constructor(_e){so(this,"input",[]),so(this,"size",void 0),this.size=_e}add(_e){this.input.push(_e),this.input.length>this.size&&this.input.splice(0,1)}mean(){var _e;return this.input.length===0?0:_p(_e=this.input).call(_e,(rt,it)=>rt+it)/this.input.length}},gw=0,bO=0;function RO(_e,rt,it,ct){return new Ir((ut,pt)=>{rt.responseType=rt.responseType||"json",rt.data&&!it?(rt.data=JSON.stringify(rt.data),gw+=M_(rt.data)):it&&(rt.data.size?gw+=rt.data.size:rt.data instanceof FormData?gw+=D3(rt.data):gw+=M_(JSON.stringify(rt.data))),rt.headers=rt.headers||{},rt.headers["Content-Type"]=rt.headers["Content-Type"]||"application/json",rt.method="POST",rt.url=_e,Xu.request(rt).then(mt=>{typeof mt.data=="string"?bO+=M_(mt.data):mt.data instanceof ArrayBuffer||mt.data instanceof Uint8Array?bO+=mt.data.byteLength:bO+=M_(JSON.stringify(mt.data)),ct&&ut({data:mt.data,headers:mt.headers}),ut(mt.data)}).catch(mt=>{Xu.isCancel(mt)?pt(new Yn(tn.OPERATION_ABORTED,"cancel token canceled")):mt.code==="ECONNABORTED"?pt(new Yn(tn.NETWORK_TIMEOUT,mt.message)):mt.response?pt(new Yn(tn.NETWORK_RESPONSE_ERROR,mt.response.status)):pt(new Yn(tn.NETWORK_ERROR,mt.message))})})}async function dY(_e,rt){const it=new Blob([rt.data],{type:"buffer"});return await RO(_e,hr(hr({},rt),{},{data:it,headers:{"Content-Type":"application/octet-stream"}}),!0)}const $3=()=>window.isSecureContext!==void 0;function Tm(_e){if(Array.isArray(_e))return _e.map(it=>it);if(!H3(_e))return _e;const rt={};for(const it in _e){const ct=_e[it];H3(ct)||Array.isArray(ct)?rt[it]=Tm(ct):rt[it]=ct}return rt}function H3(_e){return!(typeof _e!="object"||Array.isArray(_e)||!_e)}let wO=class{constructor(_e){so(this,"input",[]),so(this,"size",void 0),this.size=_e}add(_e){this.input.push(_e),this.input.length>this.size&&this.input.splice(0,1)}diffMean(){return this.input.length===0?0:(this.input[this.input.length-1]-this.input[0])/this.input.length}};const P_={address:"unknown",candidateType:"unknown",id:"unknown",port:0,priority:0,protocol:"unknown",type:"unknown"},mA={timestamp:0,bitrate:{actualEncoded:0,transmit:0},sendPacketLossRate:0,recvPacketLossRate:0,videoRecv:[],videoSend:[],audioRecv:[],audioSend:[],selectedCandidatePair:{id:"unknown",localCandidate:P_,remoteCandidate:P_},updateInterval:0},j3={firsCount:0,nacksCount:0,plisCount:0,framesDecodeCount:0,framesDecodeInterval:0,framesDecodeFreezeTime:0,decodeFrameRate:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,qpSumPerFrame:0,framesDroppedCount:0,outputFrameRate:0,packetsDiscarded:0,framesAssembledFromMultiplePackets:0,totalProcessingDelay:0,avgDecodeMs:0,avgFramesAssembledFromMultiplePacketsMs:0,avgProcessingDelayMs:0,avgInterFrameDelayMs:0,totalAssemblyTime:0},z3={firsCount:0,nacksCount:0,plisCount:0,frameCount:0,bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0,qpSumPerFrame:0},W3={bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0},K3={jitterBufferMs:0,jitterMs:0,bytes:0,packetsLost:0,packetLostRate:0,packetsDiscarded:0,packets:0,ssrc:0,receivedFrames:0,droppedFrames:0,concealedSamples:0,totalSamplesReceived:0,silentConcealedSamples:0,concealmentEvents:0,freezeMs80:0,freezeMs200:0,freezeSamples80:0,freezeSamples200:0};let IO=class{constructor(_e,rt){so(this,"onFirstVideoReceived",void 0),so(this,"onFirstVideoDecoded",void 0),so(this,"onFirstAudioReceived",void 0),so(this,"onFirstVideoDecodedTimeout",void 0),so(this,"onFirstAudioDecoded",void 0),so(this,"onSelectedLocalCandidateChanged",void 0),so(this,"onSelectedRemoteCandidateChanged",void 0),so(this,"videoIsReady",!1),so(this,"videoIsReady2",{}),so(this,"pc",void 0),so(this,"options",void 0),so(this,"intervalTimer",void 0),so(this,"stats",Tm(mA)),so(this,"isFirstVideoReceived",{}),so(this,"isFirstVideoDecoded",{}),so(this,"isFirstAudioReceived",{}),so(this,"isFirstAudioDecoded",{}),so(this,"isFirstVideoDecodedTimeout",{}),so(this,"lossRateWindowStats",[]),this.pc=_e,this.options=rt,this.intervalTimer=window.setInterval(async()=>{this.updateStats()},this.options.updateInterval)}getStats(){return this.stats}getSelectedCandidatePair(){return new Ir(_e=>{_e({local:hr({},P_),remote:hr({},P_)})})}setVideoIsReady(_e){this.videoIsReady=_e}setVideoIsReady2(_e,rt){this.videoIsReady2[_e]=rt}getVideoIsReady(_e){return this.videoIsReady2[_e]||!1}setIsFirstAudioDecoded(_e){}destroy(){window.clearInterval(this.intervalTimer),this.pc=void 0}calcLossRate(_e){this.lossRateWindowStats.push(_e),this.lossRateWindowStats.length>this.options.lossRateInterval&&this.lossRateWindowStats.splice(0,1);const rt=this.lossRateWindowStats.length,it=["videoSend","audioSend","videoRecv","audioRecv"];let ct=0,ut=0,pt=0,mt=0;for(const _t of it)_e[_t].forEach((vt,Tt)=>{if(!this.lossRateWindowStats[rt-1][_t][Tt]||!this.lossRateWindowStats[0][_t][Tt])return;const bt=this.lossRateWindowStats[rt-1][_t][Tt].packets-this.lossRateWindowStats[0][_t][Tt].packets,Ot=this.lossRateWindowStats[rt-1][_t][Tt].packetsLost-this.lossRateWindowStats[0][_t][Tt].packetsLost;_t==="videoSend"||_t==="audioSend"?(ct+=bt,pt+=Ot):(ut+=bt,mt+=Ot),Number.isNaN(bt)||Number.isNaN(bt)?vt.packetLostRate=0:vt.packetLostRate=bt<=0||Ot<=0?0:Ot/(bt+Ot)});_e.sendPacketLossRate=ct<=0||pt<=0?0:pt/(ct+pt),_e.recvPacketLossRate=ut<=0||mt<=0?0:mt/(ut+mt)}},hY=class extends IO{constructor(){super(...arguments),so(this,"_stats",mA),so(this,"lastDecodeVideoReceiverStats",new Map)}async updateStats(){const _e=await this._getStats(),rt=this.statsResponsesToObjects(_e);this._stats=Tm(mA);const it=rt.filter(ut=>ut.type==="ssrc");this.processSSRCStats(it);const ct=rt.find(ut=>ut.type==="VideoBwe");ct&&this.processBandwidthStats(ct),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}processBandwidthStats(_e){this._stats.bitrate={actualEncoded:Number(_e.googActualEncBitrate),targetEncoded:Number(_e.googTargetEncBitrate),retransmit:Number(_e.googRetransmitBitrate),transmit:Number(_e.googTransmitBitrate)},this._stats.sendBandwidth=Number(_e.googAvailableSendBandwidth)}processSSRCStats(_e){_e.forEach(rt=>{var it;const ct=Er(it=rt.id).call(it,"send");switch("".concat(rt.mediaType,"_").concat(ct?"send":"recv")){case"video_send":{const ut=Tm(z3);ut.codec=rt.googCodecName,ut.adaptionChangeReason="none",rt.googCpuLimitedResolution&&(ut.adaptionChangeReason="cpu"),rt.googBandwidthLimitedResolution&&(ut.adaptionChangeReason="bandwidth"),ut.avgEncodeMs=Number(rt.googAvgEncodeMs),ut.inputFrame={width:Number(rt.googFrameWidthInput)||Number(rt.googFrameWidthSent),height:Number(rt.googFrameHeightInput)||Number(rt.googFrameHeightSent),frameRate:Number(rt.googFrameRateInput)},ut.sentFrame={width:Number(rt.googFrameWidthSent),height:Number(rt.googFrameHeightSent),frameRate:Number(rt.googFrameRateInput)},ut.firsCount=Number(rt.googFirReceived),ut.nacksCount=Number(rt.googNacksReceived),ut.plisCount=Number(rt.googPlisReceived),ut.frameCount=Number(rt.framesEncoded),ut.bytes=Number(rt.bytesSent),ut.packets=Number(rt.packetsSent),ut.packetsLost=Number(rt.packetsLost),ut.ssrc=Number(rt.ssrc),ut.rttMs=Number(rt.googRtt||0),this._stats.videoSend.push(ut),this._stats.rtt=ut.rttMs;break}case"video_recv":{const ut=Tm(j3),pt=this.lastDecodeVideoReceiverStats.get(Number(rt.ssrc));if(ut.codec=rt.googCodecName,ut.targetDelayMs=Number(rt.googTargetDelayMs),ut.renderDelayMs=Number(rt.googRenderDelayMs),ut.currentDelayMs=Number(rt.googCurrentDelayMs),ut.minPlayoutDelayMs=Number(rt.googMinPlayoutDelayMs),ut.decodeMs=Number(rt.googDecodeMs),ut.maxDecodeMs=Number(rt.googMaxDecodeMs),ut.receivedFrame={width:Number(rt.googFrameWidthReceived),height:Number(rt.googFrameHeightReceived),frameRate:Number(rt.googFrameRateReceived)},ut.decodedFrame={width:Number(rt.googFrameWidthReceived),height:Number(rt.googFrameHeightReceived),frameRate:Number(rt.googFrameRateDecoded)},ut.decodeFrameRate=Number(rt.googFrameRateDecoded),ut.outputFrame={width:Number(rt.googFrameWidthReceived),height:Number(rt.googFrameHeightReceived),frameRate:Number(rt.googFrameRateOutput)},ut.jitterBufferMs=Number(rt.googJitterBufferMs),ut.firsCount=Number(rt.googFirsSent),ut.nacksCount=Number(rt.googNacksSent),ut.plisCount=Number(rt.googPlisSent),ut.framesDecodeCount=Number(rt.framesDecoded),ut.bytes=Number(rt.bytesReceived),ut.packets=Number(rt.packetsReceived),ut.packetsLost=Number(rt.packetsLost),ut.ssrc=Number(rt.ssrc),ut.packets>0&&!this.isFirstVideoReceived[ut.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(ut.ssrc),this.isFirstVideoReceived[ut.ssrc]=!0),ut.framesDecodeCount>0&&!this.isFirstVideoDecoded[ut.ssrc]&&(this.onFirstVideoDecoded&&this.onFirstVideoDecoded(ut.ssrc,ut.decodedFrame.width,ut.decodedFrame.height),this.isFirstVideoDecoded[ut.ssrc]=!0),pt){const mt=pt.stats,_t=Date.now()-pt.lts;ut.framesDecodeFreezeTime=mt.framesDecodeFreezeTime,ut.framesDecodeInterval=mt.framesDecodeInterval,ut.framesDecodeCount>mt.framesDecodeCount&&this.isFirstVideoDecoded[ut.ssrc]?(pt.lts=Date.now(),ut.framesDecodeInterval=_t,ut.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(rt.ssrc,10))?ut.framesDecodeFreezeTime+=ut.framesDecodeInterval:this.setVideoIsReady2(parseInt(rt.ssrc,10),!0))):ut.framesDecodeCount<pt.stats.framesDecodeCount&&(ut.framesDecodeInterval=0)}this.lastDecodeVideoReceiverStats.set(ut.ssrc,{stats:hr({},ut),lts:Date.now()}),this._stats.videoRecv.push(ut);break}case"audio_recv":{const ut=Tm(K3);ut.codec=rt.googCodecName,ut.outputLevel=Math.abs(Number(rt.audioOutputLevel))/32767,ut.decodingCNG=Number(rt.googDecodingCNG),ut.decodingCTN=Number(rt.googDecodingCTN),ut.decodingCTSG=Number(rt.googDecodingCTSG),ut.decodingNormal=Number(rt.googDecodingNormal),ut.decodingPLC=Number(rt.googDecodingPLC),ut.decodingPLCCNG=Number(rt.googDecodingPLCCNG),ut.expandRate=Number(rt.googExpandRate),ut.accelerateRate=Number(rt.googAccelerateRate),ut.preemptiveExpandRate=Number(rt.googPreemptiveExpandRate),ut.secondaryDecodedRate=Number(rt.googSecondaryDecodedRate),ut.speechExpandRate=Number(rt.googSpeechExpandRate),ut.preferredJitterBufferMs=Number(rt.googPreferredJitterBufferMs),ut.jitterBufferMs=Number(rt.googJitterBufferMs),ut.jitterMs=Number(rt.googJitterReceived),ut.bytes=Number(rt.bytesReceived),ut.packets=Number(rt.packetsReceived),ut.packetsLost=Number(rt.packetsLost),ut.ssrc=Number(rt.ssrc),ut.receivedFrames=Number(rt.googDecodingCTN)||Number(rt.packetsReceived),ut.droppedFrames=Number(rt.googDecodingPLC)+Number(rt.googDecodingPLCCNG)||Number(rt.packetsLost),ut.receivedFrames>0&&!this.isFirstAudioReceived[ut.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(ut.ssrc),this.isFirstAudioReceived[ut.ssrc]=!0),ut.decodingNormal>0&&!this.isFirstAudioDecoded[ut.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(ut.ssrc),this.isFirstAudioDecoded[ut.ssrc]=!0),this._stats.audioRecv.push(ut);break}case"audio_send":{const ut=Tm(W3);ut.codec=rt.googCodecName,ut.inputLevel=Math.abs(Number(rt.audioInputLevel))/32767,ut.aecReturnLoss=Number(rt.googEchoCancellationReturnLoss||0),ut.aecReturnLossEnhancement=Number(rt.googEchoCancellationReturnLossEnhancement||0),ut.residualEchoLikelihood=Number(rt.googResidualEchoLikelihood||0),ut.residualEchoLikelihoodRecentMax=Number(rt.googResidualEchoLikelihoodRecentMax||0),ut.bytes=Number(rt.bytesSent),ut.packets=Number(rt.packetsSent),ut.packetsLost=Number(rt.packetsLost),ut.ssrc=Number(rt.ssrc),ut.rttMs=Number(rt.googRtt||0),this._stats.rtt=ut.rttMs,this._stats.audioSend.push(ut);break}}})}_getStats(){return new Ir((_e,rt)=>{this.pc.getStats(_e,rt)})}statsResponsesToObjects(_e){const rt=[];return _e.result().forEach(it=>{const ct={id:it.id,timestamp:it.timestamp.valueOf().toString(),type:it.type};it.names().forEach(ut=>{ct[ut]=it.stat(ut)}),rt.push(ct)}),rt}},gA=function(_e){return _e.BANDWIDTH="bandwidth",_e.CPU="cpu",_e.NONE="none",_e.OTHER="other",_e}({}),_w=function(_e){return _e.L1T1="L1T1",_e.L1T2="L1T2",_e.L1T3="L1T3",_e.L1T3_KEY="L1T3_KEY",_e.L2T1_KEY="L2T1_KEY",_e.L2T2_KEY="L2T2_KEY",_e.L2T3_KEY="L2T3_KEY",_e.L3T1_KEY="L3T1_KEY",_e.L3T2_KEY="L3T2_KEY",_e.L3T3_KEY="L3T3_KEY",_e}({}),xO=function(_e){return _e[_e.new=0]="new",_e[_e.connecting=1]="connecting",_e[_e.connected=2]="connected",_e[_e.disconnected=3]="disconnected",_e[_e.failed=4]="failed",_e[_e.closed=5]="closed",_e}({}),Lp=function(_e){return _e.CERTIFICATE="certificate",_e.CODEC="codec",_e.CANDIDATE_PAIR="candidate-pair",_e.LOCAL_CANDIDATE="local-candidate",_e.REMOTE_CANDIDATE="remote-candidate",_e.INBOUND="inbound-rtp",_e.TRACK="track",_e.OUTBOUND="outbound-rtp",_e.PC="peer-connection",_e.REMOTE_INBOUND="remote-inbound-rtp",_e.REMOTE_OUTBOUND="remote-outbound-rtp",_e.TRANSPORT="transport",_e.CSRC="csrc",_e.DATA_CHANNEL="data-channel",_e.STREAM="stream",_e.SENDER="sender",_e.RECEIVER="receiver",_e}({});var _S=function(_e){return _e[_e.kNone=1]="kNone",_e[_e.kMillisecondsFromSeconds=1e3]="kMillisecondsFromSeconds",_e[_e.kBytesToBits=8]="kBytesToBits",_e}(_S||{});function _A(_e,rt,it,ct){let ut=arguments.length>4&&arguments[4]!==void 0?arguments[4]:_S.kNone;if(!rt)return;const pt=Number(rt[it]);if(typeof pt!="number")return;const mt=Number(rt[ct]);if(typeof mt!="number")return;if(!_e)return mt?pt/mt*ut:void 0;const _t=Number(_e[it]);if(typeof _t!="number")return;const vt=Number(_e[ct]);if(typeof vt!="number")return;const Tt=mt-vt;return Tt?(pt-_t)/Tt*ut:void 0}let Y3=class extends IO{constructor(){super(...arguments),so(this,"_stats",mA),so(this,"report",void 0),so(this,"lastDecodeVideoReceiverStats",new Map),so(this,"lastVideoFramesRecv",new Map),so(this,"lastVideoFramesSent",new Map),so(this,"lastVideoFramesDecode",new Map),so(this,"lastVideoFramesOutput",new Map),so(this,"lastVideoJBDelay",new Map),so(this,"lastAudioJBDelay",new Map),so(this,"mediaBytesSent",new Map),so(this,"mediaBytesRetransmit",new Map),so(this,"mediaBytesTargetEncode",new Map),so(this,"lastDecodeAudioReceiverStats",new Map),so(this,"lastAudioConcealment",new Map),so(this,"lastEncoderMs",new Map)}async updateStats(){this.report=await this.pc.getStats(),this._stats=Tm(mA),this.report.forEach(_e=>{switch(_e.type){case Lp.OUTBOUND:case Lp.INBOUND:{const rt=_e.mediaType||_e.kind,it=!rt&&"frameWidth"in _e,ct=!rt&&!("frameWidth"in _e);_e.type===Lp.OUTBOUND?rt==="audio"||ct?this.processAudioOutboundStats(_e):(rt==="video"||it)&&this.processVideoOutboundStats(_e):_e.type===Lp.INBOUND&&(rt==="audio"||ct?this.processAudioInboundStats(_e):(rt==="video"||it)&&this.processVideoInboundStats(_e));break}case Lp.TRANSPORT:{const rt=this.report.get(_e.selectedCandidatePairId);rt&&this.processCandidatePairStats(rt);break}case Lp.CANDIDATE_PAIR:_e.selected&&this.processCandidatePairStats(_e)}}),this.updateSendBitrate(),this._stats.updateInterval=Date.now()-this.stats.timestamp,this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}async getSelectedCandidatePair(){const _e=await this.pc.getStats(),rt={local:hr({},P_),remote:hr({},P_)};return _e.forEach(it=>{let ct;if(it.type===Lp.TRANSPORT&&(ct=_e.get(it.selectedCandidatePairId)),it.type===Lp.CANDIDATE_PAIR&&it.selected&&(ct=it),ct){const ut=(pt,mt)=>{pt.type=mt.type,pt.id=mt.id,mt.address&&(pt.address=mt.address),mt.candidateType&&(pt.candidateType=mt.candidateType),mt.port&&(pt.port=mt.port),mt.priority&&(pt.priority=mt.priority),mt.protocol&&(pt.protocol=mt.protocol),mt.relayProtocol&&(pt.relayProtocol=mt.relayProtocol)};if(ct.localCandidateId){const pt=_e.get(ct.localCandidateId);pt&&ut(rt.local,pt)}if(ct.remoteCandidateId){const pt=_e.get(ct.remoteCandidateId);pt&&ut(rt.remote,pt)}}}),rt}processCandidatePairStats(_e){if(this._stats.sendBandwidth=_e.availableOutgoingBitrate||0,_e.currentRoundTripTime&&(this._stats.rtt=1e3*_e.currentRoundTripTime),this._stats.videoSend.forEach(rt=>{_e.currentRoundTripTime&&(rt.rttMs=1e3*_e.currentRoundTripTime)}),this._stats.audioSend.forEach(rt=>{_e.currentRoundTripTime&&(rt.rttMs=1e3*_e.currentRoundTripTime)}),this._stats.selectedCandidatePair.id=_e.id,_e.localCandidateId){const rt=this.report.get(_e.localCandidateId);rt&&this.processCandidateStats(rt)}if(_e.remoteCandidateId){const rt=this.report.get(_e.remoteCandidateId);rt&&this.processCandidateStats(rt)}}processCandidateStats(_e){let rt;_e.type===Lp.LOCAL_CANDIDATE&&(rt=this._stats.selectedCandidatePair.localCandidate),_e.type===Lp.REMOTE_CANDIDATE&&(rt=this._stats.selectedCandidatePair.remoteCandidate),rt&&(rt.type=_e.type,rt.id=_e.id,_e.address&&(rt.address=_e.address),_e.candidateType&&(rt.candidateType=_e.candidateType),_e.port&&(rt.port=_e.port),_e.priority&&(rt.priority=_e.priority),_e.protocol&&(rt.protocol=_e.protocol),_e.relayProtocol&&(rt.relayProtocol=_e.relayProtocol),_e.type===Lp.LOCAL_CANDIDATE&&this.stats.selectedCandidatePair.localCandidate.id!==rt.id&&this.onSelectedLocalCandidateChanged&&this.onSelectedLocalCandidateChanged(hr({},rt),hr({},this.stats.selectedCandidatePair.localCandidate)),_e.type===Lp.REMOTE_CANDIDATE&&this.stats.selectedCandidatePair.remoteCandidate.id!==rt.id&&this.onSelectedRemoteCandidateChanged&&this.onSelectedRemoteCandidateChanged(hr({},rt),hr({},this.stats.selectedCandidatePair.remoteCandidate)))}processAudioInboundStats(_e){let rt=this._stats.audioRecv.find(ct=>ct.ssrc===_e.ssrc);rt||(rt=Tm(K3),this._stats.audioRecv.push(rt)),rt.ssrc=_e.ssrc,rt.packets=_e.packetsReceived,rt.packetsLost=_e.packetsLost,rt.packetsDiscarded=_e.packetsDiscarded,rt.bytes=_e.bytesReceived,rt.jitterMs=1e3*_e.jitter,rt.retransmittedBytesReceived=_e.retransmittedBytesReceived,rt.retransmittedPacketsReceived=_e.retransmittedPacketsReceived,rt.totalProcessingDelay=_e.totalProcessingDelay,rt.jitterBufferEmittedCount=_e.jitterBufferEmittedCount;const it=this.lastDecodeAudioReceiverStats.get(rt.ssrc);rt.avgProcessingDelayMs=_A(it,rt,"totalProcessingDelay","jitterBufferEmittedCount",_S.kMillisecondsFromSeconds),this.processAudioTrackReceiverStats(_e,_e.trackId,rt),this.calculateAudioFreeze(rt,it,_e),_e.codecId&&(rt.codec=this.getCodecFromCodecStats(_e.codecId)),rt.receivedFrames||(rt.receivedFrames=_e.packetsReceived),rt.droppedFrames||(rt.droppedFrames=_e.packetsLost),rt.receivedFrames>0&&!this.isFirstAudioReceived[rt.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(rt.ssrc),this.isFirstAudioReceived[rt.ssrc]=!0),rt.outputLevel&&rt.outputLevel>0&&!this.isFirstAudioDecoded[rt.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(rt.ssrc),this.isFirstAudioDecoded[rt.ssrc]=!0),typeof _e.concealedSamples=="number"&&(rt.concealedSamples=_e.concealedSamples),this.lastDecodeAudioReceiverStats.set(rt.ssrc,hr({},rt))}calculateAudioFreeze(_e,rt,it){const ct=this.lastAudioConcealment.get(_e.ssrc);if(rt!=null&&ct!=null){const ut=ct.lts,pt=it.timestamp,mt=pt-ut;if(mt<=0)return;const _t=_e.concealedSamples-rt.concealedSamples-0,vt=ct.nonSilent+_t,Tt=_e.totalSamplesReceived-rt.totalSamplesReceived;if(Tt<=0)return;const bt=80*Tt/mt,Ot=200*Tt/mt,Mt=mt/Tt;let Dt=0;_e.freezeSamples80=rt.freezeSamples80,_e.freezeMs80=rt.freezeMs80,vt>bt&&(ct.plc80>0?(_e.freezeSamples80+=_t,_e.freezeMs80+=Math.round(_t*Mt)):(_e.freezeSamples80+=vt,_e.freezeMs80+=Math.round(vt*Mt)),Dt=ct.plc80+1);let jt=0;_e.freezeSamples200=rt.freezeSamples200,_e.freezeMs200=rt.freezeMs200,vt>Ot&&(ct.plc200>0?(_e.freezeSamples200+=_t,_e.freezeMs200+=Math.round(_t*Mt)):(_e.freezeSamples200+=vt,_e.freezeMs200+=Math.round(vt*Mt)),jt=ct.plc200+1),this.lastAudioConcealment.set(_e.ssrc,{nonSilent:_t,lts:pt,plc80:Dt,plc200:jt})}else _e.freezeSamples80=0,_e.freezeSamples200=0,_e.freezeMs80=0,_e.freezeMs200=0,this.lastAudioConcealment.set(_e.ssrc,{nonSilent:0,lts:it.timestamp,plc80:0,plc200:0})}processVideoInboundStats(_e){let rt=this._stats.videoRecv.find(mt=>mt.ssrc===_e.ssrc);rt||(rt=Tm(j3),this._stats.videoRecv.push(rt)),rt.ssrc=_e.ssrc,rt.packets=_e.packetsReceived,rt.packetsLost=_e.packetsLost,rt.bytes=_e.bytesReceived,rt.firsCount=_e.firCount,rt.nacksCount=_e.nackCount,rt.plisCount=_e.pliCount,rt.framesDecodeCount=_e.framesDecoded,rt.framesDroppedCount=_e.framesDropped,rt.totalInterFrameDelay=_e.totalInterFrameDelay,rt.totalSquaredInterFrameDelay=_e.totalSquaredInterFrameDelay,rt.totalFreezesDuration=_e.totalFreezesDuration,rt.totalProcessingDelay=_e.totalProcessingDelay,rt.packetsDiscarded=_e.packetsDiscarded,rt.framesAssembledFromMultiplePackets=_e.framesAssembledFromMultiplePackets,rt.totalAssemblyTime=_e.totalAssemblyTime,rt.keyFramesDecoded=_e.keyFramesDecoded,rt.retransmittedBytesReceived=_e.retransmittedBytesReceived,rt.retransmittedPacketsReceived=_e.retransmittedPacketsReceived;const it=this.lastDecodeVideoReceiverStats.get(rt.ssrc),ct=this.lastVideoFramesDecode.get(rt.ssrc),ut=this.lastVideoFramesOutput.get(rt.ssrc),pt=Date.now();if(rt.framesDecodeCount>0&&!this.isFirstVideoDecoded[rt.ssrc]){const mt=rt.decodedFrame?rt.decodedFrame.width:0,_t=rt.decodedFrame?rt.decodedFrame.height:0;this.onFirstVideoDecoded&&this.onFirstVideoDecoded(rt.ssrc,mt,_t),this.isFirstVideoDecoded[rt.ssrc]=!0}if(it){const mt=it.stats,_t=pt-it.lts;rt.framesDecodeFreezeTime=mt.framesDecodeFreezeTime,rt.framesDecodeInterval=mt.framesDecodeInterval,!this.isFirstVideoDecoded[rt.ssrc]&&_t>this.options.firstVideoDecodedTimeout&&!this.isFirstVideoDecodedTimeout[rt.ssrc]&&(this.onFirstVideoDecodedTimeout&&this.onFirstVideoDecodedTimeout(rt.ssrc),this.isFirstVideoDecodedTimeout[rt.ssrc]=!0),rt.framesDecodeCount>mt.framesDecodeCount&&this.isFirstVideoDecoded[rt.ssrc]?(it.lts=Date.now(),rt.framesDecodeInterval=_t,rt.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(_e.ssrc))?rt.framesDecodeFreezeTime+=rt.framesDecodeInterval:this.setVideoIsReady2(parseInt(_e.ssrc,10),!0))):rt.framesDecodeCount<mt.framesDecodeCount&&(rt.framesDecodeInterval=0),_e.framesDecoded&&_e.qpSum&&(it.stats.framesDecodeCount>_e.framesDecoded?rt.qpSumPerFrame=_e.qpSum/_e.framesDecoded:rt.qpSumPerFrame=(_e.qpSum-it.qpSum)/(_e.framesDecoded-it.stats.framesDecodeCount))}_e.totalDecodeTime&&(rt.decodeMs=1e3*_e.totalDecodeTime,rt.avgDecodeMs=_A(it==null?void 0:it.stats,rt,"decodeMs","framesDecodeCount")),rt.avgProcessingDelayMs=_A(it==null?void 0:it.stats,rt,"totalProcessingDelay","framesDecodeCount",_S.kMillisecondsFromSeconds),rt.avgFramesAssembledFromMultiplePacketsMs=_A(it==null?void 0:it.stats,rt,"totalAssemblyTime","framesAssembledFromMultiplePackets",_S.kMillisecondsFromSeconds),rt.avgInterFrameDelayMs=_A(it==null?void 0:it.stats,rt,"totalInterFrameDelay","framesDecodeCount",_S.kMillisecondsFromSeconds),ct&&pt-ct.lts>=800?(rt.decodeFrameRate=Math.round((rt.framesDecodeCount-ct.count)/((pt-ct.lts)/1e3)),this.lastVideoFramesDecode.set(rt.ssrc,{count:rt.framesDecodeCount,lts:pt,rate:rt.decodeFrameRate})):ct?rt.decodeFrameRate=ct.rate:this.lastVideoFramesDecode.set(rt.ssrc,{count:rt.framesDecodeCount,lts:pt,rate:0}),rt.framesDroppedCount&&_e.framesReceived&&(ut&&pt-ut.lts>=800?(rt.outputFrameRate=Math.round((_e.framesReceived-rt.framesDroppedCount-ut.count)/((pt-ut.lts)/1e3)),this.lastVideoFramesOutput.set(rt.ssrc,{count:_e.framesReceived-rt.framesDroppedCount,lts:pt,rate:Math.max(rt.outputFrameRate,0)})):ut?rt.outputFrameRate=ut.rate:this.lastVideoFramesOutput.set(rt.ssrc,{count:_e.framesReceived-rt.framesDroppedCount,lts:pt,rate:0})),this.processVideoTrackReceiverStats(_e,_e.trackId,rt),_e.codecId&&(rt.codec=this.getCodecFromCodecStats(_e.codecId)),_e.framerateMean&&(rt.framesRateFirefox=_e.framerateMean),rt.packets>0&&!this.isFirstVideoReceived[rt.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(rt.ssrc),this.isFirstVideoReceived[rt.ssrc]=!0),this.lastDecodeVideoReceiverStats.set(rt.ssrc,{stats:hr({},rt),lts:it?it.lts:Date.now(),qpSum:_e.qpSum})}processVideoOutboundStats(_e){let rt=this._stats.videoSend.find(ct=>ct.ssrc===_e.ssrc);rt||(rt=Tm(z3),this._stats.videoSend.push(rt));const it=this.mediaBytesSent.get(_e.ssrc);if(it)it.add(_e.bytesSent);else{const ct=new wO(10);ct.add(_e.bytesSent),this.mediaBytesSent.set(_e.ssrc,ct)}if(_e.retransmittedBytesSent!==void 0){const ct=this.mediaBytesRetransmit.get(_e.ssrc);if(ct)ct.add(_e.retransmittedBytesSent);else{const ut=new wO(10);ut.add(_e.retransmittedBytesSent),this.mediaBytesRetransmit.set(_e.ssrc,ut)}}if(_e.totalEncodedBytesTarget){const ct=this.mediaBytesTargetEncode.get(_e.ssrc);if(ct)ct.add(_e.totalEncodedBytesTarget);else{const ut=new wO(10);ut.add(_e.totalEncodedBytesTarget),this.mediaBytesTargetEncode.set(_e.ssrc,ut)}}if(rt.ssrc=_e.ssrc,rt.bytes=_e.bytesSent,rt.packets=_e.packetsSent,rt.firsCount=_e.firCount,rt.nacksCount=_e.nackCount,rt.plisCount=_e.pliCount,rt.frameCount=_e.framesEncoded,rt.adaptionChangeReason=_e.qualityLimitationReason,rt.scalabilityMode=_e.scalabilityMode,rt.retransmittedBytesSent=_e.retransmittedBytesSent,rt.retransmittedPacketsSent=_e.retransmittedPacketsSent,rt.hugeFramesSent=_e.hugeFramesSent,rt.keyFramesEncoded=_e.keyFramesEncoded,rt.targetBitrate=_e.targetBitrate,_e.totalEncodeTime&&_e.framesEncoded){const ct=this.lastEncoderMs.get(_e.ssrc);if(!ct||ct.lastFrameCount>_e.framesEncoded)rt.avgEncodeMs=1e3*_e.totalEncodeTime/_e.framesEncoded;else{const ut=_e.framesEncoded-ct.lastFrameCount,pt=_e.totalEncodeTime-ct.lastEncoderTime;rt.avgEncodeMs=1e3*pt/ut}}if(_e.framesEncoded&&_e.qpSum){const ct=this.lastEncoderMs.get(_e.ssrc);!ct||ct.lastFrameCount>_e.framesEncoded?rt.qpSumPerFrame=_e.qpSum/_e.framesEncoded:rt.qpSumPerFrame=(_e.qpSum-ct.lastQpSum)/(_e.framesEncoded-ct.lastFrameCount)}if(this.lastEncoderMs.set(_e.ssrc,{lastFrameCount:_e.framesEncoded,lastEncoderTime:_e.totalEncodeTime,lastQpSum:_e.qpSum,lts:Date.now()}),_e.codecId&&(rt.codec=this.getCodecFromCodecStats(_e.codecId)),_e.mediaSourceId&&this.processVideoMediaSource(_e.mediaSourceId,rt),this.processVideoTrackSenderStats(_e,_e.trackId,rt),_e.remoteId)this.processRemoteInboundStats(_e.remoteId,rt);else{const ct=this.findRemoteStatsId(_e.ssrc,Lp.REMOTE_INBOUND);ct&&this.processRemoteInboundStats(ct,rt)}}processAudioOutboundStats(_e){let rt=this._stats.audioSend.find(it=>it.ssrc===_e.ssrc);if(rt||(rt=Tm(W3),this._stats.audioSend.push(rt)),rt.ssrc=_e.ssrc,rt.packets=_e.packetsSent,rt.bytes=_e.bytesSent,rt.retransmittedBytesSent=_e.retransmittedBytesSent,rt.retransmittedPacketsSent=_e.retransmittedPacketsSent,_e.mediaSourceId&&this.processAudioMediaSource(_e.mediaSourceId,rt),_e.codecId&&(rt.codec=this.getCodecFromCodecStats(_e.codecId)),this.processAudioTrackSenderStats(_e,_e.trackId,rt),_e.remoteId)this.processRemoteInboundStats(_e.remoteId,rt);else{const it=this.findRemoteStatsId(_e.ssrc,Lp.REMOTE_INBOUND);it&&this.processRemoteInboundStats(it,rt)}}findRemoteStatsId(_e,rt){var it;const ct=Array.from(Sp(it=this.report).call(it)).find(ut=>ut.type===rt&&ut.ssrc===_e);return ct?ct.id:null}processVideoMediaSource(_e,rt){const it=this.report.get(_e);it&&it.width&&it.height&&it.framesPerSecond&&(rt.inputFrame={width:it.width,height:it.height,frameRate:it.framesPerSecond})}processAudioMediaSource(_e,rt){const it=this.report.get(_e);it&&(rt.inputLevel=it.audioLevel)}processVideoTrackSenderStats(_e,rt,it){var ct,ut,pt,mt;const _t=rt?this.report.get(rt):void 0,vt=(ct=_t==null?void 0:_t.framesSent)!==null&&ct!==void 0?ct:_e.framesSent;if(typeof vt!="number")return;let Tt=(ut=_t==null?void 0:_t.frameWidth)!==null&&ut!==void 0?ut:_e.frameWidth,bt=(pt=_t==null?void 0:_t.frameHeight)!==null&&pt!==void 0?pt:_e.frameHeight,Ot=(mt=_t==null?void 0:_t.framesPerSecond)!==null&&mt!==void 0?mt:_e.framesPerSecond;if(typeof Tt=="number"&&typeof bt=="number"||(Tt=0,bt=0),Ot==null){const Mt=Date.now(),Dt=this.lastVideoFramesSent.get(it.ssrc);Dt&&Mt-Dt.lts>=800?(Ot=Math.round((vt-Dt.count)/((Mt-Dt.lts)/1e3)),this.lastVideoFramesSent.set(it.ssrc,{count:vt,lts:Mt,rate:Ot})):Dt?Ot=Dt.rate:this.lastVideoFramesSent.set(it.ssrc,{count:vt,lts:Mt,rate:0})}it.sentFrame={width:Tt,height:bt,frameRate:Math.max(0,Ot)}}processVideoTrackReceiverStats(_e,rt,it){var ct,ut,pt,mt,_t;const vt=rt?this.report.get(rt):void 0,Tt=(ct=vt==null?void 0:vt.framesReceived)!==null&&ct!==void 0?ct:_e.framesReceived,bt=(ut=vt==null?void 0:vt.frameWidth)!==null&&ut!==void 0?ut:_e.frameWidth,Ot=(pt=vt==null?void 0:vt.frameHeight)!==null&&pt!==void 0?pt:_e.frameHeight,Mt=(mt=vt==null?void 0:vt.jitterBufferDelay)!==null&&mt!==void 0?mt:_e.jitterBufferDelay,Dt=(_t=vt==null?void 0:vt.jitterBufferEmittedCount)!==null&&_t!==void 0?_t:_e.jitterBufferEmittedCount;if(typeof Tt=="number"){const jt=this.lastVideoFramesRecv.get(it.ssrc),$t=Date.now();it.framesReceivedCount=Tt;let Ht=0;jt&&$t-jt.lts>=800?(Ht=Math.round((Tt-jt.count)/(($t-jt.lts)/1e3)),this.lastVideoFramesRecv.set(it.ssrc,{count:Tt,lts:$t,rate:Ht})):jt?Ht=jt.rate:this.lastVideoFramesRecv.set(it.ssrc,{count:Tt,lts:$t,rate:0}),it.receivedFrame={width:bt||0,height:Ot||0,frameRate:Ht||0},it.decodedFrame={width:bt||0,height:Ot||0,frameRate:it.decodeFrameRate||0},it.outputFrame={width:bt||0,height:Ot||0,frameRate:it.outputFrameRate||it.decodeFrameRate||0}}if(Mt&&Dt){const jt=this.lastVideoJBDelay.get(it.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let $t=jt.jitterBufferMs;const Ht=Dt-jt.jitterBufferEmittedCount;Ht>0&&($t=1e3*(Mt-jt.jitterBufferDelay)/Ht),it.jitterBufferMs=$t,it.currentDelayMs=Math.round($t),this.lastVideoJBDelay.set(it.ssrc,{jitterBufferDelay:Mt,jitterBufferEmittedCount:Dt,jitterBufferMs:it.currentDelayMs})}}processAudioTrackSenderStats(_e,rt,it){var ct,ut,pt,mt;const _t=rt?this.report.get(rt):void 0,vt=(ct=(ut=_t==null?void 0:_t.echoReturnLoss)!==null&&ut!==void 0?ut:_e.echoReturnLoss)!==null&&ct!==void 0?ct:0,Tt=(pt=(mt=_t==null?void 0:_t.echoReturnLossEnhancement)!==null&&mt!==void 0?mt:_e.echoReturnLossEnhancement)!==null&&pt!==void 0?pt:0;it.aecReturnLoss=vt,it.aecReturnLossEnhancement=Tt}processAudioTrackReceiverStats(_e,rt,it){var ct,ut,pt,mt,_t,vt,Tt,bt,Ot;const Mt=rt?this.report.get(rt):void 0,Dt=(ct=Mt==null?void 0:Mt.removedSamplesForAcceleration)!==null&&ct!==void 0?ct:_e.removedSamplesForAcceleration,jt=(ut=Mt==null?void 0:Mt.totalSamplesReceived)!==null&&ut!==void 0?ut:_e.totalSamplesReceived,$t=(pt=Mt==null?void 0:Mt.jitterBufferDelay)!==null&&pt!==void 0?pt:_e.jitterBufferDelay,Ht=(mt=Mt==null?void 0:Mt.jitterBufferEmittedCount)!==null&&mt!==void 0?mt:_e.jitterBufferEmittedCount,en=(_t=Mt==null?void 0:Mt.audioLevel)!==null&&_t!==void 0?_t:_e==null?void 0:_e.audioLevel,Qt=(vt=Mt==null?void 0:Mt.totalSamplesDuration)!==null&&vt!==void 0?vt:_e==null?void 0:_e.totalSamplesDuration,on=(Tt=Mt==null?void 0:Mt.concealedSamples)!==null&&Tt!==void 0?Tt:_e.concealedSamples,Tn=(bt=Mt==null?void 0:Mt.silentConcealedSamples)!==null&&bt!==void 0?bt:_e.silentConcealedSamples,vn=(Ot=Mt==null?void 0:Mt.concealmentEvents)!==null&&Ot!==void 0?Ot:_e.concealmentEvents;if(typeof jt=="number"&&(it.totalSamplesReceived=jt),typeof Tn=="number"&&(it.silentConcealedSamples=Tn),typeof vn=="number"&&(it.concealmentEvents=vn),typeof on=="number"&&(it.concealedSamples=on),Dt&&jt&&(it.accelerateRate=Dt/jt),$t&&Ht){const Ln=this.lastAudioJBDelay.get(it.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let Xn=Ln.jitterBufferMs;const Qn=Ht-Ln.jitterBufferEmittedCount;Qn>0&&(Xn=1e3*($t-Ln.jitterBufferDelay)/Qn),it.jitterBufferMs=Math.round(Xn),this.lastAudioJBDelay.set(it.ssrc,{jitterBufferDelay:$t,jitterBufferEmittedCount:Ht,jitterBufferMs:it.jitterBufferMs})}it.outputLevel=en;let hn=1920;Qt&&jt&&(hn=jt/Qt/50,it.receivedFrames=Math.round(jt/hn)),on&&(it.droppedFrames=Math.round(on/hn))}processRemoteInboundStats(_e,rt){const it=this.report.get(_e);it&&(rt.packetsLost=it.packetsLost,it.roundTripTime&&(rt.rttMs=1e3*it.roundTripTime),it.jitter&&(rt.jitterMs=1e3*it.jitter),it.timestamp&&(rt.timestamp=it.timestamp))}getCodecFromCodecStats(_e){const rt=this.report.get(_e);if(!rt)return"";const it=rt.mimeType.match(/\/(.*)$/);return it&&it[1]?it[1]:""}updateSendBitrate(){let _e=0,rt=null,it=null;this.mediaBytesSent.forEach(ut=>{_e+=ut.diffMean()}),this.mediaBytesRetransmit.forEach(ut=>{rt=rt===null?ut.diffMean():rt+ut.diffMean()}),this.mediaBytesTargetEncode.forEach(ut=>{it=it===null?ut.diffMean():it+ut.diffMean()});const ct=rt!==null?_e-rt:_e;this._stats.bitrate={actualEncoded:8*ct/(this.options.updateInterval/1e3),transmit:8*_e/(this.options.updateInterval/1e3)},rt!==null&&(this._stats.bitrate.retransmit=8*rt/(this.options.updateInterval/1e3)),it!==null&&(this._stats.bitrate.targetEncoded=8*it/(this.options.updateInterval/1e3))}},pY=class extends IO{updateStats(){return Ir.resolve()}};function OO(_e){let rt=arguments.length>1&&arguments[1]!==void 0?arguments[1]:250,it=arguments.length>2&&arguments[2]!==void 0?arguments[2]:8,ct=arguments.length>3&&arguments[3]!==void 0?arguments[3]:500,ut=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1e4;const pt=function(){const mt=navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]*/i);return mt&&mt[0]?Number(mt[0].split("/")[1]):null}();return pt?pt<76?new hY(_e,{updateInterval:rt,lossRateInterval:it,freezeRateLimit:ct,firstVideoDecodedTimeout:ut}):new Y3(_e,{updateInterval:rt,lossRateInterval:it,freezeRateLimit:ct,firstVideoDecodedTimeout:ut}):function(mt){if(!window.RTCStatsReport)return!1;const _t=mt.getStats();return!!(_t instanceof Ir||function(vt){return!!vt&&(typeof vt=="object"||typeof vt=="function")&&typeof vt.then=="function"}(_t))}(_e)?new Y3(_e,{updateInterval:rt,lossRateInterval:it,freezeRateLimit:ct,firstVideoDecodedTimeout:ut}):new pY(_e,{updateInterval:rt,lossRateInterval:it,freezeRateLimit:ct,firstVideoDecodedTimeout:ut})}const X3="websdk_ng_install_id";function MO(){try{if(rn("INSTALL_ID"))return rn("INSTALL_ID");let _e=window.localStorage.getItem(X3);return _e||(_e=_0(),window.localStorage.setItem(X3,_e)),ns("INSTALL_ID",_e),_e}catch{return}}const Zp=function(_e){if(_e.match(/[0-9]+\.[0-9]+\.[0-9]+$/))return _e;const rt=_e.match(/([0-9]+\.[0-9]+\.[0-9]+)\-([0-9]+)/);if(rt&&rt[1]&&rt[2]){const it=rt[1],ct=rt[2];return"".concat(it,".").concat(ct)}return"4.0.0.999"}("4.24.0"),PO=function(){try{return JSON.parse("true")===!0}catch{return!0}}();let E0=function(_e){return _e.Default="default",_e.Auto="auto",_e.Relay="relay",_e.SdRtn="sd-rtn",_e}({});const iu=function(){const _e="us".concat("erna","me"),rt="pa".concat("sswo","rd"),it=["t","s","t"];it.splice(1,0,"e");const ct=it.join(""),ut=[];for(let _t=0;_t<6;_t++)ut.push("1");const pt=ut.join(""),mt={};return mt[_e]=ct,mt[rt]=pt,Object.assign(mt,{turnServerURL:"",tcpport:3433,udpport:3478,forceturn:!1})}();window.DEFAULT_TURN_CONFIG=iu;const Ew={ENABLE_PUBLISHED_USER_LIST:!0,MAX_SUBSCRIPTION:50,SUBSCRIBE_AUDIO_FILTER_TOPN:void 0,ENABLE_PUBLISH_AUDIO_FILTER:void 0,ENABLE_USER_LICENSE_CHECK:!0,DISABLE_FEC:void 0,ENABLE_NTP_REPORT:!1,ENABLE_INSTANT_VIDEO:!1,ENABLE_USER_AUTO_REBALANCE_CHECK:!0,ENABLE_LOSSBASED_BWE:!0,ENABLE_AUT_CC:!0,FORCE_ENABLE_AUT_CC:!1,ENABLE_CC_FALLBACK:void 0,SUBSCRIBE_TWCC:!0,PUBLISH_TWCC:!1,ENABLE_SVC_DEFAULT_CODECS:["H264","VP8","VP9","AV1"],SVC:[],ENABLE_FULL_LINK_AV_SYNC:!1,SVC_MODE:null,PRE_SUB_NUM:1,ENABLE_AUT_FEEDBACK:!0,SVC_EXTENDED:["VP9"]},NO={MIN_FRAME_RATE:1,MAX_FRAME_RATE:30,MAX_THRESHOLD_FRAMERATE:30,BITRATE_MIN_THRESHOLD:100,BITRATE_MAX_THRESHOLD:100,MAX_SCALE:5,BWE_SCALE_UP_THRESHOLD:.6,BWE_SCALE_DOWN_THRESHOLD:.6,PERF_SCALE_UP_THRESHOLD:.7,PERF_SCALE_DOWN_THRESHOLD:.6,MOTION_RESOLUTION_FACTOR:.8,MOTION_BITRATE_FACTOR:.6,DETAIL_FRAMERATE_FACTOR:.8,DETAIL_BITRATE_FACTOR:.6,BALANCE_RESOLUTION_FACTOR:.9,BALANCE_FRAMERATE_FACTOR:.9,BALANCE_BITRATE_FACTOR:.6,OVERUSE_TIMES_THRESHOLD:10,UNDERUSE_TIMES_THRESHOLD:40},DO="v4.24.0-0-gf2267710-dirty(7/31/2025, 7:00:42 PM)",LO={ENABLE_EVENT_REPORT:!0,UPLOAD_LOG:!1,ENABLE_AG_ADAPTATION:!0,FORCE_AG_HIGH_FRAMERATE:!1,FORCE_SUPPORT_AG_ADAPTATION:!1,ENCODER_CONFIG_LIMIT:{},CAMERA_CAPTURE_CONFIG:void 0,ENABLE_PRELOAD:!0,NEW_ICE_RESTART:!0,ICE_RESTART_INTERVAL:1e4,RESTART_SEQUENCE:["udp_tcp_relay","relay"],FIRST_TCP_CANDIDATE:!1,FIRST_TCP_CANDIDATE_INTERVAL:1e3,TURN_DOMAIN:"edge.agora.io",USE_TURN_IP:!0,NEW_TURN_MODE:4,NEW_FORCE_TURN:!1,USE_NEW_RENDER_FREEZE_TIME:!1,ENCODE_EXCEPTION_TIMES:5,ENABLE_ENCODE_EXCEPTION:!0,ENCODE_EXCEPTION_VALIDATE_CODEC:["h264"],VIDEO_ENCODER_CONFIG_LIST:[{width:240,height:180},{width:320,height:240},{width:400,height:300},{width:480,height:360},{width:560,height:420},{width:640,height:480}],DELETE_NEQ_AFTER_USER_LEAVE:!0},xs=hr(hr(hr(hr({},LO),{},{PROCESS_ID:"",ENCRYPT_AES:!0,AREAS:["CHINA","GLOBAL"],WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io","webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io","webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-web-2.ap.sd-rtn.com","cds-ap-web-3.agora.io","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-web-2.ap.sd-rtn.com","sua-ap-web-3.agora.io","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-ap-web-1.agora.io","uap-web-2.ap.sd-rtn.com","uap-ap-web-3.agora.io","uap-web-4.ap.sd-rtn.com"],LOG_UPLOAD_SERVER:"logservice.agora.io",EVENT_REPORT_DOMAIN:"statscollector-1.agora.io",EVENT_REPORT_BACKUP_DOMAIN:"web-2.statscollector.sd-rtn.com",GATEWAY_ADDRESS:[],GATEWAY_WSS_ADDRESS:"",LIVE_STREAMING_ADDRESS:"",HTTP_CONNECT_TIMEOUT:5e3,SIGNAL_REQUEST_TIMEOUT:1e4,REPORT_STATS:!0,NOT_REPORT_EVENT:[],PING_PONG_TIME_OUT:10,WEBSOCKET_TIMEOUT_MIN:1e4,EVENT_REPORT_SEND_INTERVAL:3e3,CONFIG_DISTRIBUTE_INTERVAL:3e5,ENABLE_CONFIG_DISTRIBUTE:!0,CANDIDATE_TIMEOUT:5e3,SHOW_REPORT_INVOKER_LOG:!1,SHOW_REPORT_USER_INVOKER_LOG:!0,JOIN_EXTEND:"",PUB_EXTEND:"",SUB_EXTEND:"",FORCE_TURN:!1,TURN_ENABLE_TCP:!0,TURN_ENABLE_UDP:!0,MAX_UPLOAD_CACHE:50,UPLOAD_CACHE_INTERVAL:2e3,AJAX_REQUEST_CONCURRENT:3,REPORT_APP_SCENARIO:void 0,GATEWAY_DOMAINS:["edge.agora.io","edge.sd-rtn.com"],CONNECT_GATEWAY_WITHOUT_DOMAIN:!1,WORKER_DOMAIN:"edge.agora.io",EVENT_REPORT_RETRY:!0,CHROME_FORCE_PLAN_B:!1,AUDIO_SOURCE_VOLUME_UPDATE_INTERVAL:400,AUDIO_SOURCE_AVG_VOLUME_DURATION:3e3,AUDIO_VOLUME_INDICATION_INTERVAL:2e3,VOLUME_VOICE_WEIGHT:10,GET_VOLUME_OF_MUTED_AUDIO_TRACK:!1,STATS_UPDATE_INTERVAL:250,NORMAL_EVENT_QUEUE_CAPACITY:100,CUSTOM_REPORT:!0,CUSTOM_REPORT_LIMIT:20,PROXY_SERVER_TYPE2:"webnginx-proxy.agora.io",PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com","webrtc-cloud-proxy.agora.io"],CUSTOM_PUB_ANSWER_MODIFIER:null,CUSTOM_SUB_ANSWER_MODIFIER:null,CUSTOM_PUB_OFFER_MODIFIER:null,CUSTOM_SUB_OFFER_MODIFIER:null,DSCP_TYPE:"high",REMOVE_NEW_CODECS:!0,FRAGEMENT_LENGTH:3,WEBSOCKET_COMPRESS:!1,SIMULCAST:!1,CHECK_VIDEO_VISIBLE_INTERVAL:3e4,CHECK_LOCAL_STATS_INTERVAL:250,PROFILE_SWITCH_INTERVAL:2e3,UNSUPPORTED_VIDEO_CODEC:[],ENUMERATE_DEVICES_INTERVAL:!1,ENUMERATE_DEVICES_INTERVAL_TIME:1e4,USE_NEW_TOKEN:!1,CLOSE_AFB_FOR_LOCAL_AP:!0,JOIN_MAX_CONCURRENCY:6,JOIN_WITH_FALLBACK_SIGNAL_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE:!1,JOIN_GATEWAY_TRY_443PORT_DURATION:2e3,JOIN_GATEWAY_USE_443PORT_ONLY:!1,JOIN_GATEWAY_USE_DUAL_DOMAIN:!0,JOIN_GATEWAY_FALLBACK_PORT:443,USE_TURN_SERVER_OF_GATEWAY:!1,H264_PROFILE_LEVEL_ID:"",USE_NEW_LOG:!1,LOG_VERSION:3,MEDIA_DEVICE_CONSTRAINTS:null,ENCRYPT_PROXY_USERNAME_AND_PSW:!0,SDP_LOGGING:!1,CSP_DETECTED_HOSTNAME_LIST:["agora.io","sd-rtn.com"],REMOTE_AUDIO_TRACK_USES_WEB_AUDIO:!1,LOCAL_AUDIO_TRACK_USES_WEB_AUDIO:!1,BITRATE_ADAPTER_TYPE:"STANDARD_BITRATE",AI_DENOISER_PARAMETERS:{excludedLinks:[]},ADJUST_3A_FROM_PLUGINS:!0,RAISE_H264_BASELINE_PRIORITY:!0,FILTER_SEND_H264_BASELINE:!1,FIRST_H264_PROFILE_LEVEL_ID:"42001f",FIRST_PACKETIZATION_MODE:"",X_GOOGLE_START_BITRATE:void 0,NEW_REPORT_SERVER:!1,NEW_REPORT_SERVER_DOMAINS:["data-reporting.agora.io","data-reporting.agora.io"],VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT:3e5,VIDEO_INSPECT_INTERVAL_MINIMUM:1e3,VIDEO_INSPECT_QUALITY_RATIO:.9,VIDEO_INSPECT_WORKER_MANAGER_HOST:"edge.agora.io",VIDEO_INSPECT_WORKER_MANAGER_PORT:"",VIDEO_INSPECT_WORKER_PORT:"",SHOW_VIDEO_INSPECT_WORKER_MESSAGE:!1,STATS_COLLECTOR_PORT:443,FORCE_TURN_TCP:!1,WEBAUDIO_INIT_OPTIONS:void 0,FILTER_VIDEO_FEC:!0,FILTER_AUDIO_FEC:!1,CHROME_DUAL_STREAM_USE_ENCODING:!0,DISABLE_DUAL_STREAM_USE_ENCODING:!1,EXTENSION_USAGE_UPLOAD_INTERVAL:1e4,ICE_RESTART:!0,FINGERPRINT:null,ENABLE_VIDEO_FRAME_CALLBACK:!0,VIDEO_FREEZE_DURATION:500,SPATIALIZER_PARAMETERS:{},UPLOAD_LOG_INTERVAL:3e3,UPLOAD_LOG_REQUEST_RETRY_INTERVAL:2e3,UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL:2e4,UPLOAD_LOG_TRY_INTERVAL_WHILE_OFF:5e3,UPLOAD_LOG_RETRY_INTERVAL_V1:1e4,UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1:200,UPLOAD_LOG_LENGTH_EACH_TIME:10,APP_TYPE:0,DISABLE_WEBAUDIO:!1,CHANNEL_MEDIA_RELAY_SERVERS:void 0,KEEP_LAST_FRAME:!0,FORWARD_P2P_CREATION:!0,SYNC_GROUP:!0,BLOCK_LOCAL_CLIENT:!1,ENABLE_AUDIO_TOPN:!1,ENABLE_AUDIO_METADATA:!1,ENABLE_AUDIO_PTS:!1,TOPN_SMOOTH_LEVEL:void 0,TOPN_NEW_SPEAKER_DELAY:void 0,TOPN_SWITCH_HOLD_MS:void 0,TOPN_AUDIO_GAIN:void 0,TOPN_SILENCE_THRESHOLD:250,AP_AREA:!0,ENABLE_ENCODED_TRANSFORM:!1,ENABLE_VIDEO_SEI:!1,IMAGE_MODERATION_WORKER_HOST:"edge.agora.io",IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT:3e5,IMAGE_MODERATION_INTERVAL_MINIMUM:1e3,SHOW_IMAGE_MODERATION_WORKER_MESSAGE:!1,IMAGE_MODERATION_QUALITY_RATIO:.9,IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL:5e3,SHOW_GLOBAL_CLIENT_LIST:!1,DATASTREAM_MAX_RETRANSMITS:10,TCP_CANDIDATE_ONLY:!1,EXTERNAL_SIGNAL_REQUEST_TIMEOUT:3e3,SHOW_P2P_LOG:!1,MAX_P2P_TIMEOUT:3e4,P2P_TOKEN_INTERVAL:1e3,SHOW_DATASTREAM2_LOG:!1,RESTRICTION_SET_PLAYBACK_DEVICE:!0,USE_PURE_ENCRYPTION_MASTER_KEY:!1,ENABLE_AUDIO_RED:!1,OPUS_PTIME:void 0,AUDIO_DUPLICATE_NUM:void 0,ENABLE_ABSSENDTIME_AS_SENTTS:!0,ACCOUNT_REGISTER_RETRY_TIMEOUT:1,ACCOUNT_REGISTER_RETRY_RATIO:2,ACCOUNT_REGISTER_RETRY_TIMEOUT_MAX:6e4,ACCOUNT_REGISTER_RETRY_COUNT_MAX:1e5,AUDIO_CONTEXT:null,WEBCS_BACKUP_CONNECT_TIMEOUT:6e3,PLAYER_STATE_DEFER:2e3,SIGNAL_REQUEST_WATCH_INTERVAL:1e3,FILEPATH_LENMAX:255,DUALSTREAM_OPERATION_CHECK:!0,MEDIA_ELEMENT_EXISTS_DEPTH:3,SHIM_CANDIDATE:!1,LEAVE_MSG_TIMEOUT:2e3,STATS_FILTER:{transportId:!0,googTrackId:!0},FILTER_VIDEO_CODEC:[],UNSUPPORTED_VIDEO_UPLINK_CODEC:[],UNSUPPORTED_VIDEO_DOWNLINK_CODEC:[],USE_NEW_NETWORK_CONFIG:!1,AUTO_RESET_AUDIO_ROUTE:!1,PLUGIN_INFO:[],OVERUSE_DETECTOR_PARAMS:NO,CUSTOM_ADAPTATION_DEFAULT_MODE:"",HIDE_NO_POSTER:!1,AP_CACHE_NUM:10,AP_UPDATE_INTERVAL:12e4,AP_CACHE_LIFETIME:12e4,MAX_PRELOAD_ASYNC_LENGTH:3,DISABLE_SCREEN_SHARE_REMB:!1},Ew),{},{USE_CANDIDATE_FROM_AP_DETAIL:!1,AP_REQUEST_DETAIL:void 0,ENABLE_ROLE_SELECT_EDGE:!1,CLIENT_ROLE_OPTIONS:void 0,COMPATIBLE_SDP_EXTENSION:["gdpr_forbidden"],LIMIT_BITRATE:void 0,EXPERIMENTS:{},USE_PUB_RTX:!0,USE_SUB_RTX:!0,ENABLE_DATASTREAM_2:!1,USE_XR:!0,ENABLE_PREALLOC_PC:!1,ENABLE_PRE_SUB:!1,ENABLE_SVC:!1,ENABLE_PRE_RENDER:!1,FORCE_DISABLE_AUTO_SUB:!1,ENABLE_PRE_SUB_WITH_PRE_PC:!1,PRE_USE_LOCAL_CODECS:!0},{INSTALL_ID:""}),{},{K_MIN_RENDER_DELAY:66,USE_STANDARD_BITRATE_DEFAULT:!1,VIDEO_NEW_BITRATE_RATIO:void 0,VIDEO_STANDARD_BITRATE_VERSION:2,BASELINE_MORE_H264_BITRATE_RATIO:1.1});function ns(_e,rt,it){var ct,ut,pt;Er(ct=Object.keys(xs)).call(ct,_e)&&(!it&&Er(ut=Object.keys(r_)).call(ut,_e)||(xs[_e]=rt,_e!=="ENABLE_VIDEO_SEI"&&_e!=="ENABLE_AUDIO_TOPN"&&_e!=="ENABLE_AUDIO_METADATA"&&_e!=="ENABLE_AUDIO_PTS"||rt!==!0||(xs.ENABLE_ENCODED_TRANSFORM=!0),_e==="USE_NEW_NETWORK_CONFIG"&&rt&&(pt=!!rt,xs.USE_NEW_NETWORK_CONFIG=pt,pt&&(xs.WEBCS_DOMAIN=["webrtc2-2.ap.sd-rtn.com"],xs.WEBCS_DOMAIN_BACKUP_LIST=["webrtc2-4.ap.sd-rtn.com"],xs.CDS_AP=["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],xs.ACCOUNT_REGISTER=["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],xs.EVENT_REPORT_DOMAIN="web-2.statscollector.sd-rtn.com",xs.EVENT_REPORT_BACKUP_DOMAIN="statscollector-1.agora.io",xs.GATEWAY_DOMAINS=["edge.sd-rtn.com"])),_e==="ENABLE_PRE_SUB"&&rt&&(xs.ENABLE_INSTANT_VIDEO=!0,xs.ENABLE_PREALLOC_PC=!0),_e==="ENABLE_SVC"&&rt&&(xs.ENABLE_AUT_CC=!0),_e==="NEW_FORCE_TURN"&&rt&&(xs.NEW_TURN_MODE||(xs.NEW_TURN_MODE=4))))}function rn(_e){return xs[_e]}PO||(xs.WEBCS_DOMAIN=["ap-web-1-oversea.agora.io","ap-web-1-north-america.agora.io"],xs.WEBCS_DOMAIN_BACKUP_LIST=["ap-web-2-oversea.agora.io","ap-web-2-north-america.agora.io"],xs.PROXY_CS=["proxy-ap-web-oversea.agora.io","proxy-ap-web-america.agora.io"],xs.CDS_AP=["cds-ap-web-oversea.agora.io","cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],xs.ACCOUNT_REGISTER=["sua-ap-web-oversea.agora.io","sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],xs.UAP_AP=["uap-ap-web-oversea.agora.io","uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],xs.LOG_UPLOAD_SERVER="logservice-oversea.agora.io",xs.EVENT_REPORT_DOMAIN="statscollector-1-oversea.agora.io",xs.EVENT_REPORT_BACKUP_DOMAIN="statscollector-2-oversea.agora.io",xs.PROXY_SERVER_TYPE3="webrtc-cloud-proxy.agora.io",xs.AREAS=["NORTH_AMERICA","OVERSEA"]);let q3=function(_e){return _e[_e.REALTIME=1]="REALTIME",_e}({});const r_={};var co=function(_e){return _e.SET_SESSION_ID="SET_SESSION_ID",_e.SET_P2P_ID="SET_P2P_id",_e.SET_DC_ID="SET_DC_id",_e.SET_UID="SET_UID",_e.SET_INT_UID="SET_INT_UID",_e.SET_PUB_ID="SET_PUB_ID",_e.SET_CLOUD_PROXY_SERVER_MODE="SET_CLOUD_PROXY_SERVER_MODE",_e.KEY_METRIC_CLIENT_CREATED="KEY_METRIC_CLIENT_CREATED",_e.KEY_METRIC_JOIN_START="KEY_METRIC_JOIN_START",_e.KEY_METRIC_PRELOAD_START="KEY_METRIC_PRELOAD_START",_e.KEY_METRIC_PRELOAD_END="KEY_METRIC_PRELOAD_END",_e.KEY_METRIC_JOIN_END="KEY_METRIC_JOIN_END",_e.KEY_METRIC_REQUEST_AP_START="KEY_METRIC_REQUEST_AP_START",_e.KEY_METRIC_REQUEST_AP_END="KEY_METRIC_REQUEST_AP_END",_e.KEY_METRIC_REQUEST_SUA_END="KEY_METRIC_REQUEST_SUA_END",_e.KEY_METRIC_BEFORE_CONNECT="KEY_METRIC_BEFORE_CONNECT",_e.KEY_METRIC_PEER_RECEIVER="KEY_METRIC_PEER_RECEIVER",_e.KEY_METRIC_SIGNAL_CONNECTED="KEY_METRIC_SIGNAL_CONNECTED",_e.KEY_METRIC_JOIN_REQ="KEY_METRIC_JOIN_REQ",_e.KEY_METRIC_JOIN_REP="KEY_METRIC_JOIN_REP",_e.KEY_METRIC_JOIN_GATEWAY_START="KEY_METRIC_JOIN_GATEWAY_START",_e.KEY_METRIC_JOIN_GATEWAY_END="KEY_METRIC_JOIN_GATEWAY_END",_e.KEY_METRIC_PEER_CONNECTION_START="KEY_METRIC_PEER_CONNECTION_START",_e.KEY_METRIC_PEER_CONNECTION_END="KEY_METRIC_PEER_CONNECTION_END",_e.KEY_METRIC_FIRST_VIDEO_FRAME_DECODED="KEY_METRIC_FIRST_VIDEO_FRAME_DECODED",_e.KEY_METRIC_DESCRIPTION_START="KEY_METRIC_DESCRIPTION_START",_e.KEY_METRIC_ICE_CONNECTION_END="KEY_METRIC_ICE_CONNECTION_END",_e.KEY_METRIC_SIGNAL_CHANNEL_OPEN="KEY_METRIC_SIGNAL_CHANNEL_OPEN",_e.KEY_METRIC_PUBLISH="KEY_METRIC_PUBLISH",_e.KEY_METRIC_SUBSCRIBE="KEY_METRIC_SUBSCRIBE",_e.RECORD_JOIN_CHANNEL_SERVICE="RECORD_JOIN_CHANNEL_SERVICE",_e.RESET_JOIN_CHANNEL_SERVICE_RECORDS="RESET_JOIN_CHANNEL_SERVICE_RECORDS",_e.RESET_KEY_METRICS="RESET_KEY_METRICS",_e.RESET_FIRST_VIDEO_FRAME_DECODED="RESET_FIRST_VIDEO_FRAME_DECODED",_e.SET_USE_P2P="SET_USE_P2P",_e.SET_TRANSPORT_TYPE="SET_TRANSPORT_TYPE",_e}(co||{});let EA=function(_e){return _e.h264="h264",_e.h265="h265",_e.vp8="vp8",_e.vp9="vp9",_e.av1="av1",_e}({});(function(_e){_e.opus="opus",_e.pcma="pcma",_e.pcmu="pcmu",_e.g722="g722"})({});const J3=128,fY=96,Z3=1e3,ES=10;let mY=0;var Q3=(()=>{var _e={8:(ct,ut,pt)=>{pt.r(ut),pt.d(ut,{Parser:()=>Qn,Printer:()=>Yo,parse:()=>_r,print:()=>Dr});const mt=`
`,_t="".concat("\r").concat(mt),vt=" ";let Tt;function bt(nr){return nr>="0"&&nr<="9"}function Ot(nr){return nr>="!"&&nr<="~"}function Mt(nr){return Ot(nr)||nr>=""&&nr<=""}function Dt(nr){return nr==="!"||nr>="#"&&nr<="'"||nr>="*"&&nr<="+"||nr>="-"&&nr<="."||nr>="0"&&nr<="9"||nr>="A"&&nr<="Z"||nr>="^"&&nr<="~"}function jt(nr){return nr>="1"&&nr<="9"}function $t(nr){return nr>="A"&&nr<="Z"||nr>="a"&&nr<="z"}function Ht(nr){return nr==="d"||nr==="h"||nr==="m"||nr==="s"}function en(nr){return nr>""&&nr<"	"||nr>"\v"&&nr<"\f"||nr>""&&nr<""}function Qt(nr){return $t(nr)||bt(nr)||nr==="+"||nr==="/"}function on(nr){return bt(nr)||$t(nr)||nr==="+"||nr==="/"||nr==="-"||nr==="_"}function Tn(nr){return $t(nr)||bt(nr)||nr==="+"||nr==="/"}function vn(nr,Gt){var ln=Object.keys(nr);if(Object.getOwnPropertySymbols){var En=Object.getOwnPropertySymbols(nr);Gt&&(En=En.filter(function(fr){return Object.getOwnPropertyDescriptor(nr,fr).enumerable})),ln.push.apply(ln,En)}return ln}function hn(nr){for(var Gt=1;Gt<arguments.length;Gt++){var ln=arguments[Gt]!=null?arguments[Gt]:{};Gt%2?vn(Object(ln),!0).forEach(function(En){Ln(nr,En,ln[En])}):Object.getOwnPropertyDescriptors?Object.defineProperties(nr,Object.getOwnPropertyDescriptors(ln)):vn(Object(ln)).forEach(function(En){Object.defineProperty(nr,En,Object.getOwnPropertyDescriptor(ln,En))})}return nr}function Ln(nr,Gt,ln){return Gt in nr?Object.defineProperty(nr,Gt,{value:ln,enumerable:!0,configurable:!0,writable:!0}):nr[Gt]=ln,nr}(function(nr){nr.VERSION="v",nr.ORIGIN="o",nr.SESSION_NAME="s",nr.INFORMATION="i",nr.URI="u",nr.EMAIL="e",nr.PHONE="p",nr.CONNECTION="c",nr.BANDWIDTH="b",nr.TIME="t",nr.REPEAT="r",nr.ZONE_ADJUSTMENTS="z",nr.KEY="k",nr.ATTRIBUTE="a",nr.MEDIA="m"})(Tt||(Tt={}));class Xn{consumeText(Gt,ln){let En=ln;for(;En<Gt.length;){const fr=Gt[En];if(fr==="\0"||fr==="\r"||fr===mt)break;En+=1}if(En-ln==0)throw new Error("Invalid text, at ".concat(Gt));return En}consumeUnicastAddress(Gt,ln,En){return this.consumeTill(Gt,ln,vt)}consumeOneOrMore(Gt,ln,En){let fr=ln;for(;En(Gt[fr]);)fr++;if(fr-ln==0)throw new Error("Invalid rule at ".concat(ln,"."));return fr}consumeSpace(Gt,ln){if(Gt[ln]===vt)return ln+1;throw new Error("Invalid space at ".concat(ln,"."))}consumeIP4Address(Gt,ln){let En=ln;for(let fr=0;fr<4;fr++)if(En=this.consumeDecimalUChar(Gt,En),fr!==3){if(Gt[En]!==".")throw new Error("Invalid IP4 address.");En++}return En}consumeDecimalUChar(Gt,ln){let En=ln;for(let uo=0;uo<3&&bt(Gt[En]);uo++,En++);if(En-ln==0)throw new Error("Invalid decimal uchar.");const fr=parseInt(Gt.slice(ln,En));if(fr>=0&&fr<=255)return En;throw new Error("Invalid decimal uchar")}consumeIP6Address(Gt,ln){let En=this.consumeHexpart(Gt,ln);return Gt[En]===":"&&(En+=1,En=this.consumeIP4Address(Gt,En)),En}consumeHexpart(Gt,ln){let En=ln;if(Gt[En]===":"&&Gt[En+1]===":"){En+=2;try{En=this.consumeHexseq(Gt,En)}catch{}return En}if(En=this.consumeHexseq(Gt,En),Gt[En]===":"&&Gt[En+1]===":"){En+=2;try{En=this.consumeHexseq(Gt,En)}catch{}return En}return En}consumeHexseq(Gt,ln){let En=ln;for(;En=this.consumeHex4(Gt,En),Gt[En]===":"&&Gt[En+1]!==":";)En+=1;return En}consumeHex4(Gt,ln){let En=0;for(;En<4;En++)if(!((fr=Gt[ln+En])>="0"&&fr<="9"||fr>="a"&&fr<="f"||fr>="A"&&fr<="F")){if(En===0)throw new Error("Invalid hex 4");break}var fr;return ln+En}consumeFQDN(Gt,ln){let En=ln;for(;bt(Gt[En])||$t(Gt[En])||Gt[En]==="-"||Gt[En]===".";)En+=1;if(En-ln<4)throw new Error("Invalid FQDN");return En}consumeExtnAddr(Gt,ln){return this.consumeOneOrMore(Gt,ln,Mt)}consumeMulticastAddress(Gt,ln,En){switch(En){case"IP4":case"ip4":return this.consumeIP4MulticastAddress(Gt,ln);case"IP6":case"ip6":return this.consumeIP6MulticastAddress(Gt,ln);default:try{return this.consumeFQDN(Gt,ln)}catch{return this.consumeExtnAddr(Gt,ln)}}}consumeIP6MulticastAddress(Gt,ln){const En=this.consumeHexpart(Gt,ln);return Gt[En]==="/"?this.consumeInteger(Gt,En+1):En}consumeIP4MulticastAddress(Gt,ln){let En=ln+3;const fr=Gt.slice(ln,En),uo=parseInt(fr);if(uo<224||uo>239)throw new Error("Invalid IP4 multicast address, IPv4 multicast addresses may be in the range 224.0.0.0 to 239.255.255.255.");for(let vs=0;vs<3;vs++){if(Gt[En]!==".")throw new Error("Invalid IP4 multicast address.");En+=1,En=this.consumeDecimalUChar(Gt,En)}return Gt[En]==="/"&&(En+=1),En=this.consumeTTL(Gt,En),Gt[En]==="/"&&(En=this.consumeInteger(Gt,En)),En}consumeInteger(Gt,ln){if(!jt(Gt[ln]))throw new Error("Invalid integer.");for(ln+=1;bt(Gt[ln]);)ln+=1;return ln}consumeTTL(Gt,ln){if(Gt[ln]==="0")return ln+1;if(!jt(Gt[ln]))throw new Error("Invalid TTL.");ln+=1;for(let En=0;En<2&&bt(Gt[ln]);En++)ln+=1;return ln}consumeToken(Gt,ln){return this.consumeOneOrMore(Gt,ln,Dt)}consumeTime(Gt,ln){let En=ln;if(Gt[En]==="0")return En+1;for(jt(Gt[En])&&(En+=1);bt(Gt[En]);)En++;if(En-ln<10)throw new Error("Invalid time");return En}consumeAddress(Gt,ln){return this.consumeTill(Gt,ln,vt)}consumeTypedTime(Gt,ln){let En=ln;return En=this.consumeOneOrMore(Gt,En,bt),Ht(Gt[En])?En+1:En}consumeRepeatInterval(Gt,ln){if(!jt(Gt[ln]))throw new Error("Invalid repeat interval");for(ln+=1;bt(Gt[ln]);)ln+=1;return Ht(Gt[ln])&&(ln+=1),ln}consumePort(Gt,ln){return this.consumeOneOrMore(Gt,ln,bt)}consume(Gt,ln,En){for(let fr=0;fr<En.length;fr++){if(ln+fr>=Gt.length)throw new Error("consume exceeding value length");if(Gt[ln+fr]!==En[fr])throw new Error("consume ".concat(En," failed at ").concat(fr))}return ln+En.length}consumeTill(Gt,ln,En){let fr=ln;for(;fr<Gt.length&&(typeof En!="string"||Gt[fr]!==En)&&(typeof En!="function"||!En(Gt[fr]));)fr++;return fr}}class Qn extends Xn{constructor(){super(),Ln(this,"records",[]),Ln(this,"currentLine",0)}parse(Gt){const ln=this.probeEOL(Gt);this.records=Gt.split(ln).filter(SE=>!!wu(SE).call(SE)).map(this.parseLine),this.currentLine=0;const En=this.parseVersion(),fr=this.parseOrigin(),uo=this.parseSessionName(),vs=this.parseInformation(),Tl=this.parseUri(),sm=this.parseEmail(),Dm=this.parsePhone(),rC=this.parseConnection(),B0=this.parseBandWidth(),ZS=this.parseTimeFields(),x1=this.parseKey(),O1=this.parseSessionAttribute(),am=this.parseMediaDescription();if(this.currentLine!==this.records.length)throw new Error("parsing failed, non exhaustive sdp lines.");return{version:En,origin:fr,sessionName:uo,information:vs,uri:Tl,emails:sm,phones:Dm,connection:rC,bandwidths:B0,timeFields:ZS,key:x1,attributes:O1,mediaDescriptions:am}}getCurrentRecord(){const Gt=this.records[this.currentLine];if(!Gt)throw new Error("Record doesn't exit.");return Gt}probeEOL(Gt){for(let ln=0;ln<Gt.length;ln++)if(Gt[ln]===mt)return Gt[ln-1]==="\r"?_t:mt;throw new Error("Invalid newline character.")}parseLine(Gt,ln){if(Gt.length<2)throw new Error("Invalid sdp line, sdp line should be of form <type>=<value>.");const En=Gt[0];if(Gt[1]!=="=")throw new Error('Invalid sdp line, <type> should be a single character followed by an "=" sign.');return{type:En,value:Gt.slice(2),line:ln,cur:0}}parseSessionAttribute(){const Gt=new go;for(;this.currentLine<this.records.length;){const ln=this.getCurrentRecord();if(ln.type!==Tt.ATTRIBUTE)break;const En={attField:this.extractOneOrMore(ln,fr=>Dt(fr)&&fr!==":"),_cur:0};ln.value[ln.cur]===":"&&(ln.cur+=1,En.attValue=this.extractOneOrMore(ln,en)),Gt.parse(En),this.currentLine++}return Gt.digest()}parseMediaAttributes(Gt){const ln=new Eo(Gt);for(;this.currentLine<this.records.length;){const En=this.getCurrentRecord();if(En.type!==Tt.ATTRIBUTE)break;const fr={attField:this.extractOneOrMore(En,uo=>Dt(uo)&&uo!==":"),_cur:0};En.value[En.cur]===":"&&(En.cur+=1,fr.attValue=this.extractOneOrMore(En,en)),ln.parse(fr),this.currentLine++}return ln.digest()}parseKey(){const Gt=this.getCurrentRecord();if(Gt.type===Tt.KEY){if(Gt.value==="prompt"||Gt.value==="clear:"||Gt.value==="base64:"||Gt.value==="uri:")return Gt.value;throw this.currentLine++,new Error("Invalid key.")}}parseZone(){const Gt=this.getCurrentRecord();if(Gt.type===Tt.ZONE_ADJUSTMENTS){const ln=[];for(;;)try{const En=this.extract(Gt,this.consumeTime);this.consumeSpaceForRecord(Gt);let fr=!1;Gt.value[Gt.cur]==="-"&&(fr=!0,Gt.cur+=1);const uo=this.extract(Gt,this.consumeTypedTime);ln.push({time:En,typedTime:uo,back:fr})}catch{break}if(ln.length===0)throw new Error("Invalid zone adjustments");return this.currentLine++,ln}return[]}parseRepeat(){const Gt=[];for(;;){const ln=this.getCurrentRecord();if(ln.type!==Tt.REPEAT)break;{const En=this.extract(ln,this.consumeRepeatInterval),fr=this.parseTypedTime(ln);Gt.push({repeatInterval:En,typedTimes:fr}),this.currentLine++}}return Gt}parseTypedTime(Gt){const ln=[];for(;;)try{this.consumeSpaceForRecord(Gt),ln.push(this.extract(Gt,this.consumeTypedTime))}catch{break}if(ln.length===0)throw new Error("Invalid typed time.");return ln}parseTime(){const Gt=this.getCurrentRecord(),ln=this.extract(Gt,this.consumeTime);this.consumeSpaceForRecord(Gt);const En=this.extract(Gt,this.consumeTime);return this.currentLine++,{startTime:ln,stopTime:En}}parseBandWidth(){const Gt=[];for(;this.currentLine<this.records.length;){const ln=this.getCurrentRecord();if(ln.type!==Tt.BANDWIDTH)break;{const En=this.extractOneOrMore(ln,Dt);if(ln.value[ln.cur]!==":")throw new Error("Invalid bandwidth field.");ln.cur++;const fr=this.extractOneOrMore(ln,bt);Gt.push({bwtype:En,bandwidth:fr}),this.currentLine++}}return Gt}parseVersion(){const Gt=this.getCurrentRecord();if(Gt.type!==Tt.VERSION)throw new Error("first sdp record must be version");const ln=Gt.value.slice(0,this.consumeOneOrMore(Gt.value,0,bt));if(ln.length!==Gt.value.length)throw new Error('invalid proto version, "v='.concat(Gt.value,'"'));return this.currentLine++,ln}parseOrigin(){const Gt=this.getCurrentRecord();if(Gt.type!==Tt.ORIGIN)throw new Error("second line of sdp must be origin");const ln=this.extractOneOrMore(Gt,Mt);this.consumeSpaceForRecord(Gt);const En=this.extractOneOrMore(Gt,bt);this.consumeSpaceForRecord(Gt);const fr=this.extractOneOrMore(Gt,bt);this.consumeSpaceForRecord(Gt);const uo=this.extractOneOrMore(Gt,Dt);this.consumeSpaceForRecord(Gt);const vs=this.extractOneOrMore(Gt,Dt);this.consumeSpaceForRecord(Gt);const Tl=this.extract(Gt,this.consumeUnicastAddress);return this.currentLine++,{username:ln,sessId:En,sessVersion:fr,nettype:uo,addrtype:vs,unicastAddress:Tl}}parseSessionName(){const Gt=this.getCurrentRecord();if(Gt.type===Tt.SESSION_NAME){const ln=this.extract(Gt,this.consumeText);return this.currentLine++,ln}}parseInformation(){const Gt=this.getCurrentRecord();if(Gt.type!==Tt.INFORMATION)return;const ln=this.extract(Gt,this.consumeText);return this.currentLine++,ln}parseUri(){const Gt=this.getCurrentRecord();if(Gt.type===Tt.URI)return this.currentLine++,Gt.value}parseEmail(){const Gt=[];for(;;){const ln=this.getCurrentRecord();if(ln.type!==Tt.EMAIL)break;Gt.push(ln.value),this.currentLine++}return Gt}parsePhone(){const Gt=[];for(;;){const ln=this.getCurrentRecord();if(ln.type!==Tt.PHONE)break;Gt.push(ln.value),this.currentLine++}return Gt}parseConnection(){const Gt=this.getCurrentRecord();if(Gt.type===Tt.CONNECTION){const ln=this.extractOneOrMore(Gt,Dt);this.consumeSpaceForRecord(Gt);const En=this.extractOneOrMore(Gt,Dt);this.consumeSpaceForRecord(Gt);const fr=this.extract(Gt,this.consumeAddress);return this.currentLine++,{nettype:ln,addrtype:En,address:fr}}}parseMedia(){const Gt=this.getCurrentRecord(),ln=this.extract(Gt,this.consumeToken);this.consumeSpaceForRecord(Gt);let En=this.extract(Gt,this.consumePort);Gt.value[Gt.cur]==="/"&&(Gt.cur+=1,En+=this.extract(Gt,this.consumeInteger)),this.consumeSpaceForRecord(Gt);const fr=[];for(fr.push(this.extract(Gt,this.consumeToken));Gt.value[Gt.cur]==="/";)Gt.cur+=1,fr.push(this.extract(Gt,this.consumeToken));if(fr.length===0)throw new Error("Invalid proto");const uo=this.parseFmt(Gt);return this.currentLine++,{mediaType:ln,port:En,protos:fr,fmts:uo}}parseTimeFields(){const Gt=[];for(;this.getCurrentRecord().type===Tt.TIME;){const ln=this.parseTime(),En=this.parseRepeat(),fr=this.parseZone();Gt.push({time:ln,repeats:En,zones:fr})}return Gt}parseMediaDescription(){const Gt=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===Tt.MEDIA;){const ln=this.parseMedia(),En=this.parseInformation(),fr=this.parseConnections(),uo=this.parseBandWidth(),vs=this.parseKey(),Tl=this.parseMediaAttributes(ln);Gt.push({media:ln,information:En,connections:fr,bandwidths:uo,key:vs,attributes:Tl})}return Gt}parseConnections(){const Gt=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===Tt.CONNECTION;)Gt.push(this.parseConnection());return Gt}parseFmt(Gt){const ln=[];for(;;)try{this.consumeSpaceForRecord(Gt),ln.push(this.extract(Gt,this.consumeToken))}catch{break}if(ln.length===0)throw new Error("Invalid fmts");return ln}extract(Gt,ln){for(var En=arguments.length,fr=new Array(En>2?En-2:0),uo=2;uo<En;uo++)fr[uo-2]=arguments[uo];const vs=ln.call(this,Gt.value,Gt.cur,...fr),Tl=Gt.value.slice(Gt.cur,vs);return Gt.cur=vs,Tl}extractOneOrMore(Gt,ln){const En=this.consumeOneOrMore(Gt.value,Gt.cur,ln),fr=Gt.value.slice(Gt.cur,En);return Gt.cur=En,fr}consumeSpaceForRecord(Gt){if(Gt.value[Gt.cur]!==vt)throw new Error("Invalid space at ".concat(Gt.cur,"."));Gt.cur+=1}}class ur extends Xn{constructor(){super(...arguments),Ln(this,"attributes",void 0),Ln(this,"digested",!1)}extractOneOrMore(Gt,ln,En){const fr=this.consumeOneOrMore(Gt.attValue,Gt._cur,ln),uo=Gt.attValue.slice(Gt._cur,fr),[vs,Tl]=En||[];if(typeof vs=="number"&&uo.length<vs)throw new Error("error in length, should be more or equal than ".concat(vs," characters."));if(typeof Tl=="number"&&uo.length>Tl)throw new Error("error in length, should be less or equal than ".concat(Tl," characters."));return Gt._cur=fr,uo}consumeAttributeSpace(Gt){if(Gt.attValue[Gt._cur]!==vt)throw new Error("Invalid space at ".concat(Gt._cur,"."));Gt._cur+=1}extract(Gt,ln){if(!Gt.attValue)throw new Error("Nothing to extract from attValue.");for(var En=arguments.length,fr=new Array(En>2?En-2:0),uo=2;uo<En;uo++)fr[uo-2]=arguments[uo];const vs=ln.call(this,Gt.attValue,Gt._cur,...fr),Tl=Gt.attValue.slice(Gt._cur,vs);return Gt._cur=vs,Tl}atEnd(Gt){if(!Gt.attValue)throw new Error;return Gt._cur>=Gt.attValue.length}peekChar(Gt){if(!Gt.attValue)throw new Error;return Gt.attValue[Gt._cur]}peek(Gt,ln){if(!Gt.attValue)throw new Error;for(let En=0;En<ln.length;En++)if(ln[En]!==Gt.attValue[Gt._cur+En])return!1;return!0}parseIceUfrag(Gt){if(this.attributes.iceUfrag)throw new Error("Invalid ice-ufrag, should be only a single line if 'a=ice-ufrag'");this.attributes.iceUfrag=this.extractOneOrMore(Gt,Qt,[4,256])}parseIcePwd(Gt){if(this.attributes.icePwd)throw new Error("Invalid ice-pwd, should be only a single line if 'a=ice-pwd'");this.attributes.icePwd=this.extractOneOrMore(Gt,Qt,[22,256])}parseIceOptions(Gt){if(this.attributes.iceOptions)throw new Error("Invalid ice-options, should be only one 'ice-options' line");const ln=[];for(;!this.atEnd(Gt);){ln.push(this.extractOneOrMore(Gt,Qt));try{this.consumeAttributeSpace(Gt)}catch(En){if(this.atEnd(Gt))break;throw En}}this.attributes.iceOptions=ln}parseFingerprint(Gt){const ln=this.extract(Gt,this.consumeToken);this.consumeAttributeSpace(Gt);const En=this.extract(Gt,this.consumeTill);this.attributes.fingerprints.push({hashFunction:ln,fingerprint:En})}parseExtmap(Gt){const ln=this.extractOneOrMore(Gt,bt);let En;this.peekChar(Gt)==="/"&&(this.extract(Gt,this.consume,"/"),En=this.extract(Gt,this.consumeToken)),this.consumeAttributeSpace(Gt);const fr=this.extract(Gt,this.consumeTill,vt),uo=hn(hn({entry:parseInt(ln,10)},En&&{direction:En}),{},{extensionName:fr});this.peekChar(Gt)===vt&&(this.consumeAttributeSpace(Gt),uo.extensionAttributes=this.extract(Gt,this.consumeTill)),this.attributes.extmaps.push(uo)}parseSetup(Gt){if(this.attributes.setup)throw new Error("must only be one single 'a=setup' line.");const ln=this.extract(Gt,this.consumeTill);if(ln!=="active"&&ln!=="passive"&&ln!=="actpass"&&ln!=="holdconn")throw new Error("role must be one of 'active', 'passive', 'actpass', 'holdconn'.");this.attributes.setup=ln}}class go extends ur{constructor(){super(...arguments),Ln(this,"attributes",{unrecognized:[],groups:[],extmaps:[],fingerprints:[],identities:[]})}parse(Gt){if(this.digested)throw new Error("already digested");try{switch(Gt.attField){case"group":this.parseGroup(Gt);break;case"ice-lite":this.parseIceLite();break;case"ice-ufrag":this.parseIceUfrag(Gt);break;case"ice-pwd":this.parseIcePwd(Gt);break;case"ice-options":this.parseIceOptions(Gt);break;case"fingerprint":this.parseFingerprint(Gt);break;case"setup":this.parseSetup(Gt);break;case"tls-id":this.parseTlsId(Gt);break;case"identity":this.parseIdentity(Gt);break;case"extmap":this.parseExtmap(Gt);break;case"msid-semantic":this.parseMsidSemantic(Gt);break;default:Gt.ignored=!0,this.attributes.unrecognized.push(Gt)}}catch(ln){throw console.error("parsing session attribute ".concat(Gt.attField,' error, "a=').concat(Gt.attField,":").concat(Gt.attValue,'"')),ln}if(!Gt.ignored&&Gt.attValue&&!this.atEnd(Gt))throw new Error("attribute parsing error")}digest(){return this.digested=!0,this.attributes}parseGroup(Gt){const ln=this.extract(Gt,this.consumeToken),En=[];for(;!this.atEnd(Gt)&&this.peekChar(Gt)===vt;)this.consumeAttributeSpace(Gt),En.push(this.extract(Gt,this.consumeToken));this.attributes.groups.push({semantic:ln,identificationTag:En})}parseIceLite(){if(this.attributes.iceLite)throw new Error("Invalid ice-lite, should be only a single line of 'a=ice-lite'");this.attributes.iceLite=!0}parseTlsId(Gt){if(this.attributes.tlsId)throw new Error("must be only one tld-id line");this.attributes.tlsId=this.extractOneOrMore(Gt,on)}parseIdentity(Gt){const ln=this.extractOneOrMore(Gt,Tn),En=[];for(;!this.atEnd(Gt)&&this.peekChar(Gt)===vt;){this.consumeAttributeSpace(Gt);const fr=this.extract(Gt,this.consumeToken);this.extract(Gt,this.consume,"=");const uo=this.extractOneOrMore(Gt,vs=>vs!==vt&&en(vs));En.push({name:fr,value:uo})}this.attributes.identities.push({assertionValue:ln,extensions:En})}parseMsidSemantic(Gt){this.peekChar(Gt)===vt&&this.consumeAttributeSpace(Gt);const ln={semantic:this.extract(Gt,this.consumeToken),identifierList:[]};for(;;){try{this.consumeAttributeSpace(Gt)}catch{break}if(this.peekChar(Gt)==="*"){this.extract(Gt,this.consume,"*"),ln.applyForAll=!0;break}{const En=this.extract(Gt,this.consumeTill,vt);ln.identifierList.push(En)}}this.attributes.msidSemantic=ln}}class Eo extends ur{constructor(Gt){super(),Ln(this,"attributes",void 0),Gt.protos.indexOf("RTP")!==-1||Gt.protos.indexOf("rtp"),this.attributes={unrecognized:[],candidates:[],extmaps:[],fingerprints:[],imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[]}}parse(Gt){if(this.digested)throw new Error("already digested");try{switch(Gt.attField){case"extmap":this.parseExtmap(Gt);break;case"setup":this.parseSetup(Gt);break;case"ice-ufrag":this.parseIceUfrag(Gt);break;case"ice-pwd":this.parseIcePwd(Gt);break;case"ice-options":this.parseIceOptions(Gt);break;case"candidate":this.parseCandidate(Gt);break;case"remote-candidate":this.parseRemoteCandidate(Gt);break;case"end-of-candidates":this.parseEndOfCandidates();break;case"fingerprint":this.parseFingerprint(Gt);break;case"rtpmap":this.parseRtpmap(Gt);break;case"ptime":this.parsePtime(Gt);break;case"maxptime":this.parseMaxPtime(Gt);break;case"sendrecv":case"recvonly":case"sendonly":case"inactive":this.parseDirection(Gt);break;case"ssrc":this.parseSSRC(Gt);break;case"fmtp":this.parseFmtp(Gt);break;case"rtcp-fb":this.parseRtcpFb(Gt);break;case"rtcp-mux":this.parseRTCPMux();break;case"rtcp-mux-only":this.parseRTCPMuxOnly();break;case"rtcp-rsize":this.parseRTCPRsize();break;case"rtcp":this.parseRTCP(Gt);break;case"mid":this.parseMid(Gt);break;case"msid":this.parseMsid(Gt);break;case"imageattr":this.parseImageAttr(Gt);break;case"rid":this.parseRid(Gt);break;case"simulcast":this.parseSimulcast(Gt);break;case"sctp-port":this.parseSctpPort(Gt);break;case"max-message-size":this.parseMaxMessageSize(Gt);break;case"ssrc-group":this.parseSSRCGroup(Gt);break;default:Gt.ignored=!0,this.attributes.unrecognized.push(Gt)}}catch(ln){throw console.error("parsing media attribute ".concat(Gt.attField,' error, "a=').concat(Gt.attField,":").concat(Gt.attValue,'"')),ln}if(!Gt.ignored&&Gt.attValue&&!this.atEnd(Gt))throw new Error("attribute parsing error")}parseCandidate(Gt){const ln=this.extractOneOrMore(Gt,Qt,[1,32]);this.consumeAttributeSpace(Gt);const En=this.extractOneOrMore(Gt,bt,[1,5]);this.consumeAttributeSpace(Gt);const fr=this.extract(Gt,this.consumeToken);this.consumeAttributeSpace(Gt);const uo=this.extractOneOrMore(Gt,bt,[1,10]);this.consumeAttributeSpace(Gt);const vs=this.extract(Gt,this.consumeAddress);this.consumeAttributeSpace(Gt);const Tl=this.extract(Gt,this.consumePort);this.consumeAttributeSpace(Gt),this.extract(Gt,this.consume,"typ"),this.consumeAttributeSpace(Gt);const sm={foundation:ln,componentId:En,transport:fr,priority:uo,connectionAddress:vs,port:Tl,type:this.extract(Gt,this.consumeToken),extension:{}};for(this.peek(Gt," raddr")&&(this.extract(Gt,this.consume," raddr"),this.consumeAttributeSpace(Gt),sm.relAddr=this.extract(Gt,this.consumeAddress)),this.peek(Gt," rport")&&(this.extract(Gt,this.consume," rport"),this.consumeAttributeSpace(Gt),sm.relPort=this.extract(Gt,this.consumePort));this.peekChar(Gt)===vt;){this.consumeAttributeSpace(Gt);const Dm=this.extract(Gt,this.consumeToken);this.consumeAttributeSpace(Gt),sm.extension[Dm]=this.extractOneOrMore(Gt,Ot)}this.attributes.candidates.push(sm)}parseRemoteCandidate(Gt){const ln=[];for(;;){const En=this.extractOneOrMore(Gt,bt,[1,5]);this.consumeAttributeSpace(Gt);const fr=this.extract(Gt,this.consumeAddress);this.consumeAttributeSpace(Gt);const uo=this.extract(Gt,this.consumePort);ln.push({componentId:En,connectionAddress:fr,port:uo});try{this.consumeAttributeSpace(Gt)}catch{break}}this.attributes.remoteCandidatesList.push(ln)}parseEndOfCandidates(){if(this.attributes.endOfCandidates)throw new Error("must be only one line of end-of-candidates");this.attributes.endOfCandidates=!0}parseRtpmap(Gt){const ln=this.extract(Gt,this.consumeToken);this.consumeAttributeSpace(Gt);const En=this.extract(Gt,this.consumeTill,"/");this.extract(Gt,this.consume,"/");const fr={encodingName:En,clockRate:this.extractOneOrMore(Gt,bt)};this.atEnd(Gt)||this.peekChar(Gt)!=="/"||(this.extract(Gt,this.consume,"/"),fr.encodingParameters=parseInt(this.extract(Gt,this.consumeTill),10));const uo=this.attributes.payloads.find(vs=>vs.payloadType===parseInt(ln,10));uo?uo.rtpMap=fr:this.attributes.payloads.push({payloadType:parseInt(ln,10),rtpMap:fr,rtcpFeedbacks:[]})}parsePtime(Gt){if(this.attributes.ptime)throw new Error("must be only one line of ptime");this.attributes.ptime=this.extract(Gt,this.consumeTill)}parseMaxPtime(Gt){if(this.attributes.maxPtime)throw new Error("must be only one line of ptime");this.attributes.maxPtime=this.extract(Gt,this.consumeTill)}parseDirection(Gt){if(this.attributes.direction)throw new Error("must be only one line of direction info");this.attributes.direction=Gt.attField}parseSSRC(Gt){const ln=this.extractOneOrMore(Gt,bt);this.consumeAttributeSpace(Gt);const En=this.extract(Gt,this.consumeTill,":");let fr;this.peekChar(Gt)===":"&&(this.extract(Gt,this.consume,":"),fr=this.extract(Gt,this.consumeTill));const uo=this.attributes.ssrcs.find(vs=>vs.ssrcId===parseInt(ln,10));uo?uo.attributes[En]=fr:this.attributes.ssrcs.push({ssrcId:parseInt(ln,10),attributes:{[En]:fr}})}parseFmtp(Gt){const ln=this.extract(Gt,this.consumeTill,vt);this.consumeAttributeSpace(Gt);const En=this.extract(Gt,this.consumeTill),fr={};En.split(";").forEach(vs=>{let[Tl,sm]=vs.split("=");Tl=wu(Tl).call(Tl);const Dm=typeof sm=="string"?wu(sm).call(sm):null;typeof Tl=="string"&&Tl.length>0&&(fr[Tl]=Dm)});const uo=this.attributes.payloads.find(vs=>vs.payloadType===parseInt(ln,10));uo?uo.fmtp={parameters:fr}:this.attributes.payloads.push({payloadType:parseInt(ln,10),rtcpFeedbacks:[],fmtp:{parameters:fr}})}parseFmtParameters(Gt){const ln={},En=this.extract(Gt,this.consumeTill,"=");Gt._cur++;const fr=this.extract(Gt,this.consumeTill,";");for(ln[En]=fr;Gt.attValue[Gt._cur]===";";){const uo=this.extract(Gt,this.consumeTill,"=");Gt._cur++;const vs=this.extract(Gt,this.consumeTill,";");ln[uo]=vs}return ln}parseRtcpFb(Gt){let ln="";ln=this.peekChar(Gt)==="*"?this.extract(Gt,this.consume,"*"):this.extract(Gt,this.consumeTill,vt),this.consumeAttributeSpace(Gt);const En=this.extract(Gt,this.consumeTill,vt);let fr;if(En==="trr-int")fr={type:En,interval:this.extract(Gt,this.consumeTill)};else{const uo={type:En};this.peekChar(Gt)===vt&&(this.consumeAttributeSpace(Gt),uo.parameter=this.extract(Gt,this.consumeToken),this.peekChar(Gt)===vt&&(uo.additional=this.extract(Gt,this.consumeTill))),fr=uo}if(ln==="*")this.attributes.rtcpFeedbackWildcards.push(fr);else{const uo=this.attributes.payloads.find(vs=>vs.payloadType===parseInt(ln,10));uo?uo.rtcpFeedbacks.push(fr):this.attributes.payloads.push({payloadType:parseInt(ln,10),rtcpFeedbacks:[fr]})}}parseRTCPMux(){if(this.attributes.rtcpMux)throw new Error("must be single line of rtcp-mux");this.attributes.rtcpMux=!0}parseRTCPMuxOnly(){if(this.attributes.rtcpMuxOnly)throw new Error("must be single line of rtcp-only");this.attributes.rtcpMuxOnly=!0}parseRTCPRsize(){if(this.attributes.rtcpRsize)throw new Error("must be single line of rtcp-rsize");this.attributes.rtcpRsize=!0}parseRTCP(Gt){if(this.attributes.rtcp)throw new Error("must be single line of rtcp");const ln={port:this.extract(Gt,this.consumePort)};this.peekChar(Gt)===vt&&(this.consumeAttributeSpace(Gt),ln.netType=this.extractOneOrMore(Gt,Dt),this.consumeAttributeSpace(Gt),ln.addressType=this.extractOneOrMore(Gt,Dt),this.consumeAttributeSpace(Gt),ln.address=this.extract(Gt,this.consumeAddress)),this.attributes.rtcp=ln}parseMsid(Gt){const ln={id:this.extractOneOrMore(Gt,Dt,[1,64])};this.peekChar(Gt)===vt&&(this.consumeAttributeSpace(Gt),ln.appdata=this.extractOneOrMore(Gt,Dt,[1,64])),this.attributes.msids.push(ln)}parseImageAttr(Gt){this.attributes.imageattr.push(Gt.attValue)}parseRid(Gt){const ln=this.extractOneOrMore(Gt,fr=>$t(fr)||bt(fr)||fr==="_"||fr==="-");this.consumeAttributeSpace(Gt);const En={id:ln,direction:this.extract(Gt,this.consumeToken),params:[]};if(this.peekChar(Gt)===vt){if(this.consumeAttributeSpace(Gt),this.peek(Gt,"pt=")){this.extract(Gt,this.consume,"pt=");const fr=[];for(;;){const uo=this.extract(Gt,this.consumeToken);fr.push(uo);try{this.extract(Gt,this.consume,",")}catch{break}}En.payloads=fr,this.peekChar(Gt)===vt&&this.extract(Gt,this.consume,vt)}for(;;){const fr=this.extract(Gt,this.consumeToken);switch(fr){case"depend":{const uo={type:fr,rids:this.extract(Gt,this.consume,"=").split(",")};En.params.push(uo);break}default:{const uo={type:fr};this.peekChar(Gt)==="="&&(this.extract(Gt,this.consume,"="),uo.val=this.extract(Gt,this.consumeTill,";")),En.params.push(uo)}}try{this.extract(Gt,this.consume,";")}catch{break}}}this.attributes.rids.push(En)}parseSimulcast(Gt){if(this.attributes.simulcast)throw new Error("must be single line of simulcast");this.attributes.simulcast=Gt.attValue,this.extract(Gt,this.consumeTill)}parseSctpPort(Gt){this.attributes.sctpPort=this.extractOneOrMore(Gt,bt,[1,5])}parseMaxMessageSize(Gt){this.attributes.maxMessageSize=this.extractOneOrMore(Gt,bt,[1,void 0])}digest(){return this.digested=!0,this.attributes}parseMid(Gt){this.attributes.mid=this.extract(Gt,this.consumeToken)}parseSSRCGroup(Gt){const ln=this.extract(Gt,this.consumeToken),En=[];for(;;)try{this.consumeAttributeSpace(Gt);const fr=this.extract(Gt,this.consumeInteger);En.push(parseInt(fr,10))}catch{break}this.attributes.ssrcGroups.push({semantic:ln,ssrcIds:En})}}function no(nr,Gt,ln){return Gt in nr?Object.defineProperty(nr,Gt,{value:ln,enumerable:!0,configurable:!0,writable:!0}):nr[Gt]=ln,nr}class Yo{constructor(){no(this,"eol",_t)}print(Gt,ln){let En="";return ln&&(this.eol=ln),En+=this.printVersion(Gt.version),En+=this.printOrigin(Gt.origin),En+=this.printSessionName(Gt.sessionName),En+=this.printInformation(Gt.information),En+=this.printUri(Gt.uri),En+=this.printEmail(Gt.emails),En+=this.printPhone(Gt.phones),En+=this.printConnection(Gt.connection),En+=this.printBandwidth(Gt.bandwidths),En+=this.printTimeFields(Gt.timeFields),En+=this.printKey(Gt.key),En+=this.printSessionAttributes(Gt.attributes),En+=this.printMediaDescription(Gt.mediaDescriptions),En}printVersion(Gt){return"v=".concat(Gt).concat(this.eol)}printOrigin(Gt){return"o=".concat(Gt.username," ").concat(Gt.sessId," ").concat(Gt.sessVersion," ").concat(Gt.nettype," ").concat(Gt.addrtype," ").concat(Gt.unicastAddress).concat(this.eol)}printSessionName(Gt){return Gt?"s=".concat(Gt).concat(this.eol):""}printInformation(Gt){return Gt?"i=".concat(Gt).concat(this.eol):""}printUri(Gt){return Gt?"u=".concat(Gt).concat(this.eol):""}printEmail(Gt){let ln="";for(const En of Gt)ln+="e=".concat(En).concat(this.eol);return ln}printPhone(Gt){let ln="";for(const En of Gt)ln+="e=".concat(En).concat(this.eol);return ln}printConnection(Gt){return Gt?"c=".concat(Gt.nettype," ").concat(Gt.addrtype," ").concat(Gt.address).concat(this.eol):""}printBandwidth(Gt){let ln="";for(const En of Gt)ln+="b=".concat(En.bwtype,":").concat(En.bandwidth).concat(this.eol);return ln}printTimeFields(Gt){let ln="";for(const En of Gt){ln+="t=".concat(En.time.startTime," ").concat(En.time.startTime).concat(this.eol);for(const fr of En.repeats)ln+="r=".concat(fr.repeatInterval," ").concat(fr.typedTimes.join(" ")).concat(this.eol);En.zoneAdjustments&&(ln+="z=",ln+="z=".concat(En.zoneAdjustments.map(fr=>"".concat(fr.time," ").concat(fr.back?"-":""," ").concat(fr.typedTime)).join(" ")).concat(this.eol),ln+=this.eol)}return ln}printKey(Gt){return Gt?"k=".concat(Gt).concat(this.eol):""}printAttributes(Gt){let ln="";for(const En of Gt)ln+="a=".concat(En.attField).concat(En.attValue?":".concat(En.attValue):"").concat(this.eol);return ln}printMediaDescription(Gt){let ln="";for(const En of Gt)ln+=this.printMedia(En.media),ln+=this.printInformation(En.information),ln+=this.printConnections(En.connections),ln+=this.printBandwidth(En.bandwidths),ln+=this.printKey(En.key),ln+=this.printMediaAttributes(En);return ln}printConnections(Gt){let ln="";for(const En of Gt)ln+=this.printConnection(En);return ln}printMedia(Gt){return"m=".concat(Gt.mediaType," ").concat(Gt.port," ").concat(Gt.protos.join("/")," ").concat(Gt.fmts.join(" ")).concat(this.eol)}printSessionAttributes(Gt){return new fu(this.eol).print(Gt)}printMediaAttributes(Gt){return new Jn(this.eol).print(Gt)}}class jo{constructor(Gt){no(this,"eol",void 0),this.eol=Gt}printIceUfrag(Gt){return Gt===void 0?"":"a=ice-ufrag:".concat(Gt).concat(this.eol)}printIcePwd(Gt){return Gt===void 0?"":"a=ice-pwd:".concat(Gt).concat(this.eol)}printIceOptions(Gt){return Gt===void 0?"":"a=ice-options:".concat(Gt.join(vt)).concat(this.eol)}printFingerprints(Gt){return Gt.length>0?Gt.map(ln=>"a=fingerprint:".concat(ln.hashFunction).concat(vt).concat(ln.fingerprint)).join(this.eol)+this.eol:""}printExtmap(Gt){return Gt.map(ln=>"a=extmap:".concat(ln.entry).concat(ln.direction?"/".concat(ln.direction):"").concat(vt).concat(ln.extensionName).concat(ln.extensionAttributes?"".concat(vt).concat(ln.extensionAttributes):"").concat(this.eol)).join("")}printSetup(Gt){return Gt===void 0?"":"a=setup:".concat(Gt).concat(this.eol)}printUnrecognized(Gt){return Gt.map(ln=>"a=".concat(ln.attField).concat(ln.attValue?":".concat(ln.attValue):"").concat(this.eol)).join("")}}class fu extends jo{print(Gt){let ln="";return ln+=this.printGroups(Gt.groups),ln+=this.printMsidSemantic(Gt.msidSemantic),ln+=this.printIceLite(Gt.iceLite),ln+=this.printIceUfrag(Gt.iceUfrag),ln+=this.printIcePwd(Gt.icePwd),ln+=this.printIceOptions(Gt.iceOptions),ln+=this.printFingerprints(Gt.fingerprints),ln+=this.printSetup(Gt.setup),ln+=this.printTlsId(Gt.tlsId),ln+=this.printIdentity(Gt.identities),ln+=this.printExtmap(Gt.extmaps),ln+=this.printUnrecognized(Gt.unrecognized),ln}printGroups(Gt){let ln="";return Gt.length>0&&(ln+=Gt.map(En=>"a=group:".concat(En.semantic).concat(En.identificationTag.map(fr=>"".concat(vt).concat(fr)).join("")).concat(this.eol)).join("")),ln}printIceLite(Gt){return Gt===void 0?"":"a=ice-lite"+this.eol}printTlsId(Gt){return Gt?"a=tls-id:".concat(Gt).concat(this.eol):""}printIdentity(Gt){return Gt.length===0?"":Gt.map(ln=>"a=identity:".concat(ln.assertionValue).concat(ln.extensions.map(En=>"".concat(vt).concat(En.name).concat(En.value?"=".concat(En.value):"")))).join(this.eol)+this.eol}printMsidSemantic(Gt){if(!Gt)return"";let ln="a=msid-semantic:".concat(Gt.semantic);return Gt.applyForAll?ln+="".concat(vt,"*"):Gt.identifierList.length>0&&(ln+=Gt.identifierList.map(En=>"".concat(vt).concat(En))),ln+this.eol}}class Jn extends jo{print(Gt){const ln=Gt.attributes;let En="";return En+=this.printRTCP(ln.rtcp),En+=this.printIceUfrag(ln.iceUfrag),En+=this.printIcePwd(ln.icePwd),En+=this.printIceOptions(ln.iceOptions),En+=this.printCandidates(ln.candidates),En+=this.printRemoteCandidatesList(ln.remoteCandidatesList),En+=this.printEndOfCandidates(ln.endOfCandidates),En+=this.printFingerprints(ln.fingerprints),En+=this.printSetup(ln.setup),En+=this.printMid(ln.mid),En+=this.printExtmap(ln.extmaps),En+=this.printRTPRelated(ln),En+=this.printPtime(ln.ptime),En+=this.printMaxPtime(ln.maxPtime),En+=this.printDirection(ln.direction),En+=this.printSSRCGroups(ln.ssrcGroups),En+=this.printSSRC(ln.ssrcs),En+=this.printRTCPMux(ln.rtcpMux),En+=this.printRTCPMuxOnly(ln.rtcpMuxOnly),En+=this.printRTCPRsize(ln.rtcpRsize),En+=this.printMSId(ln.msids),En+=this.printImageattr(ln.imageattr),En+=this.printRid(ln.rids),En+=this.printSimulcast(ln.simulcast),En+=this.printSCTPPort(ln.sctpPort),En+=this.printMaxMessageSize(ln.maxMessageSize),En+=this.printUnrecognized(ln.unrecognized),En}printCandidates(Gt){return Gt.map(ln=>"a=candidate:".concat(ln.foundation).concat(vt).concat(ln.componentId).concat(vt).concat(ln.transport).concat(vt).concat(ln.priority).concat(vt).concat(ln.connectionAddress).concat(vt).concat(ln.port).concat(vt,"typ").concat(vt).concat(ln.type).concat(ln.relAddr?"".concat(vt,"raddr").concat(vt).concat(ln.relAddr):"").concat(ln.relPort?"".concat(vt,"rport").concat(vt).concat(ln.relPort):"").concat(Object.keys(ln.extension).map(En=>"".concat(vt).concat(En).concat(vt).concat(ln.extension[En])).join("")).concat(this.eol)).join("")}printRemoteCandidatesList(Gt){return Gt.map(ln=>"a=remote-candidates:".concat(ln.join(vt)).concat(this.eol)).join("")}printEndOfCandidates(Gt){return Gt===void 0?"":"a=end-of-candidates"+this.eol}printRTPRelated(Gt){if(!Gt.payloads)return"";const ln=Gt.payloads;let En="";En+=Gt.rtcpFeedbackWildcards.map(fr=>this.printRTCPFeedback("*",fr)).join("");for(const fr of ln)En+=this.printRtpMap(fr.payloadType,fr.rtpMap),En+=this.printFmtp(fr.payloadType,fr.fmtp),En+=fr.rtcpFeedbacks.map(uo=>this.printRTCPFeedback(fr.payloadType,uo)).join("");return En}printFmtp(Gt,ln){if(!ln)return"";const En=Object.keys(ln.parameters);return En.length===1&&ln.parameters[En[0]]===null?"a=fmtp:".concat(Gt).concat(vt).concat(En[0]).concat(this.eol):"a=fmtp:".concat(Gt).concat(vt).concat(Object.keys(ln.parameters).map(fr=>"".concat(fr,"=").concat(ln.parameters[fr])).join(";")).concat(this.eol)}printRtpMap(Gt,ln){return ln?"a=rtpmap:".concat(Gt).concat(vt).concat(ln.encodingName,"/").concat(ln.clockRate).concat(ln.encodingParameters?"/".concat(ln.encodingParameters):"").concat(this.eol):""}printRTCPFeedback(Gt,ln){let En="a=rtcp-fb:".concat(Gt).concat(vt),fr=ln;return fr.type==="trr-int"?En+="ttr-int".concat(vt).concat(fr.interval):(En+="".concat(fr.type),fr.parameter&&(En+="".concat(vt).concat(fr.parameter),fr.additional&&(En+="".concat(vt).concat(fr.additional)))),En+this.eol}printPtime(Gt){return Gt===void 0?"":"a=ptime:".concat(Gt).concat(this.eol)}printMaxPtime(Gt){return Gt===void 0?"":"a=maxptime:".concat(Gt).concat(this.eol)}printDirection(Gt){return Gt===void 0?"":"a=".concat(Gt).concat(this.eol)}printSSRC(Gt){return Gt.map(ln=>Object.keys(ln.attributes).map(En=>"a=ssrc:".concat(ln.ssrcId.toString(10)).concat(vt).concat(En).concat(ln.attributes[En]?":".concat(ln.attributes[En]):"").concat(this.eol)).join("")).join("")}printRTCPMux(Gt){return Gt===void 0?"":"a=rtcp-mux".concat(this.eol)}printRTCPMuxOnly(Gt){return Gt===void 0?"":"a=rtcp-mux-only".concat(this.eol)}printRTCPRsize(Gt){return Gt===void 0?"":"a=rtcp-rsize".concat(this.eol)}printRTCP(Gt){if(Gt===void 0)return"";let ln="a=rtcp:".concat(Gt.port);return Gt.netType&&(ln+="".concat(vt).concat(Gt.netType)),Gt.addressType&&(ln+="".concat(vt).concat(Gt.addressType)),Gt.address&&(ln+="".concat(vt).concat(Gt.address)),ln+this.eol}printMSId(Gt){return Gt.map(ln=>"a=msid:".concat(ln.id).concat(ln.appdata?"".concat(vt).concat(ln.appdata):"").concat(this.eol)).join("")}printImageattr(Gt){return Gt.map(ln=>"a=imageattr:".concat(ln).concat(this.eol)).join("")}printRid(Gt){return Gt.map(ln=>{let En="a=rid:".concat(ln.id).concat(vt).concat(ln.direction);return ln.payloads&&(En+="".concat(vt,"pt=").concat(ln.payloads.join(","))),ln.params.length>0&&(En+="".concat(vt).concat(ln.params.map(fr=>fr.type==="depend"?"depend=".concat(fr.rids.join(",")):"".concat(fr.type,"=").concat(fr.val)).join(";"))),En+this.eol}).join("")}printSimulcast(Gt){return Gt===void 0?"":"a=simulcast:".concat(Gt).concat(this.eol)}printSCTPPort(Gt){return Gt===void 0?"":"a=sctp-port:".concat(Gt).concat(this.eol)}printMaxMessageSize(Gt){return Gt===void 0?"":"a=max-message-size:".concat(Gt).concat(this.eol)}printMid(Gt){return Gt===void 0?"":"a=mid:".concat(Gt).concat(this.eol)}printSSRCGroups(Gt){return Gt.map(ln=>"a=ssrc-group:".concat(ln.semantic).concat(ln.ssrcIds.map(En=>"".concat(vt).concat(En.toString(10))).join("")).concat(this.eol)).join("")}}function _r(nr){return new Qn().parse(nr)}function Dr(nr,Gt){return new Yo().print(nr,Gt)}}},rt={};function it(ct){if(rt[ct])return rt[ct].exports;var ut=rt[ct]={exports:{}};return _e[ct](ut,ut.exports,it),ut.exports}return it.d=(ct,ut)=>{for(var pt in ut)it.o(ut,pt)&&!it.o(ct,pt)&&Object.defineProperty(ct,pt,{enumerable:!0,get:ut[pt]})},it.o=(ct,ut)=>Object.prototype.hasOwnProperty.call(ct,ut),it.r=ct=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(ct,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(ct,"__esModule",{value:!0})},it(8)})();function op(_e){return Q3.parse(_e)}function rv(_e,rt){return Q3.print(_e,rt)}var gY=tp("Array","keys"),_Y=bu,EY=$r,vY=yt,yY=gY,kO=Array.prototype,SY={DOMTokenList:!0,NodeList:!0},TY=function(_e){var rt=_e.keys;return _e===kO||vY(kO,_e)&&rt===kO.keys||EY(SY,_Y(_e))?yY:rt},sp=st(TY);function Hs(_e,rt,it){return(rt=function(ct){var ut=function(pt,mt){if(typeof pt!="object"||!pt)return pt;var _t=pt[Symbol.toPrimitive];if(_t!==void 0){var vt=_t.call(pt,"string");if(typeof vt!="object")return vt;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(pt)}(ct);return typeof ut=="symbol"?ut:ut+""}(rt))in _e?Object.defineProperty(_e,rt,{value:it,enumerable:!0,configurable:!0,writable:!0}):_e[rt]=it,_e}function eB(_e,rt){var it=Object.keys(_e);if(Object.getOwnPropertySymbols){var ct=Object.getOwnPropertySymbols(_e);rt&&(ct=ct.filter(function(ut){return Object.getOwnPropertyDescriptor(_e,ut).enumerable})),it.push.apply(it,ct)}return it}function po(_e){for(var rt=1;rt<arguments.length;rt++){var it=arguments[rt]!=null?arguments[rt]:{};rt%2?eB(Object(it),!0).forEach(function(ct){Hs(_e,ct,it[ct])}):Object.getOwnPropertyDescriptors?Object.defineProperties(_e,Object.getOwnPropertyDescriptors(it)):eB(Object(it)).forEach(function(ct){Object.defineProperty(_e,ct,Object.getOwnPropertyDescriptor(it,ct))})}return _e}const tB=new class extends Fs{constructor(){super(...arguments),Hs(this,"currentUploadLogID",0)}reportLogUploadError(_e){const{errorRange:rt}=_e;rt[rt.length-1]&&rt[rt.length-1]>this.currentUploadLogID&&(this.currentUploadLogID=rt[rt.length-1],this.emit("REPORT_LOG_UPLOAD",_e))}};class AY{constructor(rt){Hs(this,"logger",void 0),Hs(this,"prefixLists",[]),this.logger=rt}debug(){for(var rt=arguments.length,it=new Array(rt),ct=0;ct<rt;ct++)it[ct]=arguments[ct];this.logger.debug(...this.prefixLists,...it)}info(){for(var rt=arguments.length,it=new Array(rt),ct=0;ct<rt;ct++)it[ct]=arguments[ct];this.logger.info(...this.prefixLists,...it)}warning(){for(var rt=arguments.length,it=new Array(rt),ct=0;ct<rt;ct++)it[ct]=arguments[ct];this.logger.warning(...this.prefixLists,...it)}error(){for(var rt=arguments.length,it=new Array(rt),ct=0;ct<rt;ct++)it[ct]=arguments[ct];this.logger.error(...this.prefixLists,...it)}prefix(rt){return this.prefixLists.push(rt),this}popPrefix(){return this.prefixLists.pop(),this}}function UO(){const _e=new Date;return _e.toTimeString().split(" ")[0]+":"+_e.getMilliseconds()}function nB(){const _e=new Date,rt=/((\d+:){2}\d+)/.exec(new Date().toUTCString());return rt?(rt==null?void 0:rt[0])+":"+_e.getUTCMilliseconds():_e.toTimeString().split(" ")[0]+":"+_e.getMilliseconds()}const Qp={DEBUG:0,INFO:1,WARNING:2,ERROR:3,NONE:4},vw=Date.now(),vA=_e=>{for(const rt in Qp)if(Object.prototype.hasOwnProperty.call(Qp,rt)&&Qp[rt]===_e)return rt;return"DEFAULT"},Ut=new class{constructor(){Hs(this,"proxyServerURL",void 0),Hs(this,"logLevel",Qp.DEBUG),Hs(this,"uploadState","collecting"),Hs(this,"uploadLogWaitingList",[]),Hs(this,"uploadLogUploadingList",[]),Hs(this,"uploadErrorCount",0),Hs(this,"currentLogID",0),Hs(this,"url",void 0),Hs(this,"extLog",(_e,rt)=>{this.appendLogToWaitingList(_e,...rt)})}debug(){for(var _e=arguments.length,rt=new Array(_e),it=0;it<_e;it++)rt[it]=arguments[it];const ct=[Qp.DEBUG].concat(rt);this.log.apply(this,ct)}info(){for(var _e=arguments.length,rt=new Array(_e),it=0;it<_e;it++)rt[it]=arguments[it];const ct=[Qp.INFO].concat(rt);this.log.apply(this,ct)}warning(){for(var _e=arguments.length,rt=new Array(_e),it=0;it<_e;it++)rt[it]=arguments[it];const ct=[Qp.WARNING].concat(rt);this.log.apply(this,ct)}warn(){this.warning(...arguments)}error(){for(var _e=arguments.length,rt=new Array(_e),it=0;it<_e;it++)rt[it]=arguments[it];const ct=[Qp.ERROR].concat(rt);this.log.apply(this,ct)}upload(){for(var _e=arguments.length,rt=new Array(_e),it=0;it<_e;it++)rt[it]=arguments[it];const ct=[Qp.DEBUG].concat(rt);this.uploadLog.apply(this,ct)}setLogLevel(_e){_e=Math.min(Math.max(0,_e),4),this.logLevel=_e}enableLogUpload(){ns("UPLOAD_LOG",!0)}disableLogUpload(){ns("UPLOAD_LOG",!1),this.uploadLogUploadingList=[],this.uploadLogWaitingList=[]}setProxyServer(_e){this.proxyServerURL=_e}prefix(_e){return new AY(this).prefix(_e)}log(){for(var _e=arguments.length,rt=new Array(_e),it=0;it<_e;it++)rt[it]=arguments[it];if(Date.now()-vw<100)return void setTimeout(()=>{this.log(...rt)},Date.now()-vw);const ct=Math.max(0,Math.min(4,rt[0]));if(rt[0]=UO()+" Agora-SDK [".concat(vA(ct),"]:"),this.appendLogToWaitingList(ct,...rt),ct<this.logLevel)return;const ut=UO()+" %cAgora-SDK [".concat(vA(ct),"]:");let pt=[];if(!rn("USE_NEW_LOG"))switch(ct){case Qp.DEBUG:pt=[ut,"color: #64B5F6;"].concat(rt.slice(1)),console.log.apply(console,pt);break;case Qp.INFO:pt=[ut,"color: #1E88E5; font-weight: bold;"].concat(rt.slice(1)),console.log.apply(console,pt);break;case Qp.WARNING:pt=[ut,"color: #FB8C00; font-weight: bold;"].concat(rt.slice(1)),console.warn.apply(console,pt);break;case Qp.ERROR:pt=[ut,"color: #B00020; font-weight: bold;"].concat(rt.slice(1)),console.error.apply(console,pt)}}uploadLog(){for(var _e=arguments.length,rt=new Array(_e),it=0;it<_e;it++)rt[it]=arguments[it];if(Date.now()-vw<100)return void setTimeout(()=>{this.uploadLog(...rt)},Date.now()-vw);const ct=Math.max(0,Math.min(4,rt[0]));rt[0]=UO()+" Agora-SDK [".concat(vA(ct),"]:"),this.appendLogToWaitingList(ct,...rt)}appendLogToWaitingList(_e){if(!rn("UPLOAD_LOG"))return;for(var rt=arguments.length,it=new Array(rt>1?rt-1:0),ct=1;ct<rt;ct++)it[ct-1]=arguments[ct];Array.isArray(it[0])?it[0][0]=nB()+" Agora-SDK [".concat(vA(_e),"]:"):it[0]=nB()+" Agora-SDK [".concat(vA(_e),"]:");let ut="";it.forEach(pt=>{typeof pt=="object"&&(pt=JSON.stringify(pt)),ut+="".concat(pt," ")}),this.uploadLogWaitingList.push({payload_str:ut,log_level:_e,log_item_id:this.currentLogID++}),this.uploadState==="uploading"&&this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}startUpload(){this.uploadState="uploading",this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}async uploadLogs(){const _e=this.uploadLogUploadingList,rt={sdk_version:Zp,process_id:rn("PROCESS_ID"),payload:JSON.stringify(_e)};return n_(async()=>{const it=await Xu.post(this.url||(this.proxyServerURL?"https://".concat(this.proxyServerURL,"/ls/?h=").concat(rn("LOG_UPLOAD_SERVER"),"&p=443&d=upload/v1"):"https://".concat(rn("LOG_UPLOAD_SERVER"),"/upload/v1")),rt,{responseType:"text"});if(it.data!=="OK"){const ct=new Error("unexpected upload log response");throw ct.response=it,ct}},()=>(this.uploadLogUploadingList=[],!1),it=>{const ct={status:-1,message:it.message,errorRange:_e.map(ut=>ut.log_item_id)};return it.response?(ct.status=it.response.status,ct.data=it.response.data,ct.headers=it.response.headers):it.request&&(ct.status=it.request.status),tB.reportLogUploadError(ct),!0},{timeout:rn("UPLOAD_LOG_REQUEST_RETRY_INTERVAL"),maxRetryTimeout:rn("UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL")})}uploadLogInterval(){this.uploadLogUploadingList.length===0&&this.uploadLogWaitingList.length===0||(this.uploadLogUploadingList.length===0&&(this.uploadLogUploadingList=this.uploadLogWaitingList.splice(0,rn("UPLOAD_LOG_LENGTH_EACH_TIME"))),this.uploadLogs().then(()=>{this.uploadErrorCount=0,this.uploadLogWaitingList.length>0&&window.setTimeout(()=>this.uploadLogInterval(),rn("UPLOAD_LOG_INTERVAL"))}).catch(_e=>{this.uploadErrorCount+=1,this.uploadErrorCount<2?window.setTimeout(()=>this.uploadLogInterval(),rn("UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1")):window.setTimeout(()=>this.uploadLogInterval(),rn("UPLOAD_LOG_RETRY_INTERVAL_V1"))}))}};var rB;function CY(_e){return Hl(_e.reportId,"params.reportId",0,100,!1),Hl(_e.category,"params.category",0,100,!1),Hl(_e.event,"params.event",0,100,!1),Hl(_e.label,"params.label",0,100,!1),us(_e.value,"params.value",Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,!1),!0}(rB={}).FREE="free",rB.UPLOADING="uploading",function(_e){_e[_e.MISC=0]="MISC",_e[_e.INTERNAL_EVENT=1]="INTERNAL_EVENT",_e[_e.PUBLIC_EVENT=2]="PUBLIC_EVENT",_e[_e.WEB_EVENT=3]="WEB_EVENT",_e[_e.INTERNAL_API=4]="INTERNAL_API",_e[_e.WEB_API=5]="WEB_API",_e[_e.PUBLIC_API=6]="PUBLIC_API"}({});const bY={sid:"",lts:0,success:null,cname:null,uid:null,peer:null,cid:null,elapse:null,extend:null,vid:0};let Rl=function(_e){return _e.PUBLISH="publish",_e.SUBSCRIBE="subscribe",_e.WS_COMPRESSOR_INIT="ws_compressor_init",_e.SESSION_INIT="session_init",_e.JOIN_CHOOSE_SERVER="join_choose_server",_e.REQ_USER_ACCOUNT="req_user_account",_e.JOIN_GATEWAY="join_gateway",_e.REJOIN_GATEWAY="rejoin_gateway",_e.STREAM_SWITCH="stream_switch",_e.REQUEST_PROXY_WORKER_MANAGER="request_proxy_worker_manager",_e.REQUEST_PROXY_APPCENTER="request_proxy_appcenter",_e.FIRST_VIDEO_RECEIVED="first_video_received",_e.FIRST_AUDIO_RECEIVED="first_audio_received",_e.FIRST_VIDEO_DECODE="first_video_decode",_e.FIRST_AUDIO_DECODE="first_audio_decode",_e.XLA_PEER_FIRST_VIDEO_FRAME="xla_peer_first_video_frame",_e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",_e.ON_ADD_VIDEO_STREAM="on_add_video_stream",_e.ON_UPDATE_STREAM="on_update_stream",_e.ON_REMOVE_STREAM="on_remove_stream",_e.USER_ANALYTICS="req_user_analytics",_e.PC_STATS="pc_stats",_e.UPDATE_REMOTE_RTPCAPABILITIES="update_remote_rtpCapabilities",_e.AB_TEST="ab_test",_e}({}),Os=function(_e){return _e.SESSION="io.agora.pb.Wrtc.Session",_e.JOIN_CHOOSE_SERVER="io.agora.pb.Wrtc.JoinChooseServer",_e.REQ_USER_ACCOUNT="io.agora.pb.Wrtc.ReqUserAccount",_e.JOIN_GATEWAY="io.agora.pb.Wrtc.JoinGateway",_e.RE_JOIN_GATEWAY="io.agora.pb.Wrtc.ReJoinGateway",_e.PUBLISH="io.agora.pb.Wrtc.Publish",_e.SUBSCRIBE="io.agora.pb.Wrtc.Subscribe",_e.WS_COMPRESSOR_INIT="io.agora.pb.Wrtc.WsCompressorInit",_e.STREAM_SWITCH="io.agora.pb.Wrtc.StreamSwitch",_e.AUDIO_SENDING_STOPPED="io.agora.pb.Wrtc.AudioSendingStopped",_e.VIDEO_SENDING_STOPPED="io.agora.pb.Wrtc.VideoSendingStopped",_e.REQUEST_PROXY_APPCENTER="io.agora.pb.Wrtc.RequestProxyAppCenter",_e.REQUEST_PROXY_WORKER_MANAGER="io.agora.pb.Wrtc.RequestProxyWorkerManager",_e.API_INVOKE="io.agora.pb.Wrtc.ApiInvoke",_e.FIRST_VIDEO_RECEIVED="io.agora.pb.Wrtc.FirstVideoReceived",_e.FIRST_AUDIO_RECEIVED="io.agora.pb.Wrtc.FirstAudioReceived",_e.FIRST_VIDEO_DECODE="io.agora.pb.Wrtc.FirstVideoDecode",_e.FIRST_AUDIO_DECODE="io.agora.pb.Wrtc.FirstAudioDecode",_e.XLA_PEER_FIRST_VIDEO_FRAME="io.agora.pb.Wrtc.XLAPeerFirstVideoFrame",_e.ON_ADD_AUDIO_STREAM="io.agora.pb.Wrtc.OnAddAudioStream",_e.ON_ADD_VIDEO_STREAM="io.agora.pb.Wrtc.OnAddVideoStream",_e.ON_UPDATE_STREAM="io.agora.pb.Wrtc.OnUpdateStream",_e.ON_REMOVE_STREAM="io.agora.pb.Wrtc.OnRemoveStream",_e.JOIN_CHANNEL_TIMEOUT="io.agora.pb.Wrtc.JoinChannelTimeout",_e.PEER_PUBLISH_STATUS="io.agora.pb.Wrtc.PeerPublishStatus",_e.WORKER_EVENT="io.agora.pb.Wrtc.WorkerEvent",_e.AP_WORKER_EVENT="io.agora.pb.Wrtc.APWorkerEvent",_e.JOIN_WEB_PROXY_AP="io.agora.pb.Wrtc.JoinWebProxyAP",_e.WEBSOCKET_QUIT="io.agora.pb.Wrtc.WebSocketQuit",_e.USER_ANALYTICS="io.agora.pb.Wrtc.UserAnalytics",_e.AUTOPLAY_FAILED="io.agora.pb.Wrtc.AutoplayFailed",_e.PC_STATS="io.agora.pb.Wrtc.PCStats",_e.UPDATE_REMOTE_RTPCAPABILITIES="io.agora.pb.Wrtc.UpdateRemoteRTPCapabilities",_e.AB_TEST="io.agora.pb.Wrtc.ABTest",_e}({});(function(_e){_e[_e.WORKER_EVENT=156]="WORKER_EVENT",_e[_e.AP_WORKER_EVENT=160]="AP_WORKER_EVENT"})({});let RY=function(_e){return _e[_e.SESSION=26]="SESSION",_e[_e.JOIN_CHOOSE_SERVER=27]="JOIN_CHOOSE_SERVER",_e[_e.REQ_USER_ACCOUNT=196]="REQ_USER_ACCOUNT",_e[_e.JOIN_GATEWAY=28]="JOIN_GATEWAY",_e[_e.PUBLISH=30]="PUBLISH",_e[_e.SUBSCRIBE=29]="SUBSCRIBE",_e[_e.WS_COMPRESSOR_INIT=9430]="WS_COMPRESSOR_INIT",_e[_e.STREAM_SWITCH=32]="STREAM_SWITCH",_e[_e.AUDIO_SENDING_STOPPED=33]="AUDIO_SENDING_STOPPED",_e[_e.VIDEO_SENDING_STOPPED=34]="VIDEO_SENDING_STOPPED",_e[_e.REQUEST_PROXY_APPCENTER=35]="REQUEST_PROXY_APPCENTER",_e[_e.REQUEST_PROXY_WORKER_MANAGER=36]="REQUEST_PROXY_WORKER_MANAGER",_e[_e.API_INVOKE=41]="API_INVOKE",_e[_e.FIRST_VIDEO_RECEIVED=348]="FIRST_VIDEO_RECEIVED",_e[_e.FIRST_AUDIO_RECEIVED=349]="FIRST_AUDIO_RECEIVED",_e[_e.FIRST_VIDEO_DECODE=350]="FIRST_VIDEO_DECODE",_e[_e.FIRST_AUDIO_DECODE=351]="FIRST_AUDIO_DECODE",_e[_e.ON_ADD_AUDIO_STREAM=352]="ON_ADD_AUDIO_STREAM",_e[_e.ON_ADD_VIDEO_STREAM=353]="ON_ADD_VIDEO_STREAM",_e[_e.ON_UPDATE_STREAM=356]="ON_UPDATE_STREAM",_e[_e.ON_REMOVE_STREAM=355]="ON_REMOVE_STREAM",_e[_e.JOIN_CHANNEL_TIMEOUT=407]="JOIN_CHANNEL_TIMEOUT",_e[_e.PEER_PUBLISH_STATUS=408]="PEER_PUBLISH_STATUS",_e[_e.WORKER_EVENT=156]="WORKER_EVENT",_e[_e.AP_WORKER_EVENT=160]="AP_WORKER_EVENT",_e[_e.JOIN_WEB_PROXY_AP=700]="JOIN_WEB_PROXY_AP",_e[_e.WEBSOCKET_QUIT=671]="WEBSOCKET_QUIT",_e[_e.USER_ANALYTICS=1e4]="USER_ANALYTICS",_e[_e.AUTOPLAY_FAILED=9178]="AUTOPLAY_FAILED",_e}({});function Jr(){let _e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return function(rt,it,ct){const ut=ct.value;if(typeof ut=="function"){const pt=_e.className||rt.__className__||(rt.constructor.name==="AgoraRTCClient"?"Client":rt.constructor.name);ct.value=function(){for(var mt,_t=arguments.length,vt=new Array(_t),Tt=0;Tt<_t;Tt++)vt[Tt]=arguments[Tt];let bt=vt;if(_e.argsMap)try{bt=_e.argsMap(this,...vt)}catch(Mt){Ut.warning(Mt),bt=[]}try{JSON.stringify(bt)}catch{Ut.warning("arguments for method ".concat(pt,".").concat(String(it)," not serializable for apiInvoke.")),bt=[]}const Ot=(_e.report||Vr).reportApiInvoke(this._sessionId||null,{id:this._clientId||((mt=this.store)===null||mt===void 0?void 0:mt.clientId)||this._ID,name:"".concat(pt,".").concat(String(it)),options:bt,tag:Ns.TRACER,reportResult:_e.reportResult},_e.throttleTime);try{const Mt=ut.apply(this,vt);return Mt instanceof Ir?Mt.then(Dt=>(Ot.onSuccess(_e.reportResult&&Dt),Dt)).catch(Dt=>{throw Ot.onError(Dt),Dt}):(Ot.onSuccess(_e.reportResult&&Mt),Mt)}catch(Mt){throw Ot.onError(Mt),Mt}}}return ct}}const Vr=new class{constructor(){Hs(this,"baseInfoMap",new Map),Hs(this,"proxyServer",void 0),Hs(this,"eventUploadTimer",void 0),Hs(this,"setSessionIdTimer",void 0),Hs(this,"url",void 0),Hs(this,"sids",new Set),Hs(this,"backupUrl",void 0),Hs(this,"_appId",void 0),Hs(this,"_aid",0),Hs(this,"keyEventUploadPendingItems",[]),Hs(this,"normalEventUploadPendingItems",[]),Hs(this,"apiInvokeUploadPendingItems",[]),Hs(this,"apiInvokeCount",0),Hs(this,"apiInvokeLoggedCount",0),Hs(this,"ltsList",[]),Hs(this,"lastSendNormalEventTime",Date.now()),Hs(this,"customReportCounterTimer",void 0),Hs(this,"customReportCount",0),Hs(this,"extApiInvoke",async _e=>{for(const rt of _e){const it=po(po({},rt),{},{sid:null,invokeId:++this.apiInvokeCount,tag:Ns.TRACER});this.sendApiInvoke(it)}}),this.eventUploadTimer=window.setInterval(this.doSend.bind(this),rn("EVENT_REPORT_SEND_INTERVAL")),this.setSessionIdTimer=window.setInterval(this.appendSessionId.bind(this),rn("EVENT_REPORT_SEND_INTERVAL"))}getBaseInfoBySessionId(_e){return this.baseInfoMap.get(_e)}setAppId(_e){this._appId=_e,this._aid=parseInt(_e.replace(/[a-fA-F0-9]{8}/g,rt=>{let[it,ct]=rt;return it+ct}),16)||0}reportApiInvoke(_e,rt,it){rt.timeout=rt.timeout||6e4,rt.reportResult=rt.reportResult===void 0||rt.reportResult;const ct=Date.now();this.apiInvokeCount+=1;const ut=this.apiInvokeCount,pt=!!rn("SHOW_REPORT_INVOKER_LOG"),mt=!!rn("SHOW_REPORT_USER_INVOKER_LOG"),_t=pt||mt&&rt.id;_t&&(this.apiInvokeLoggedCount+=1);const vt=this.apiInvokeLoggedCount;function Tt(Dt,jt){if(_t){let $t="[apiInvoke-".concat(vt,"]");if(rt.id&&($t+="[".concat(rt.id,"]")),rt.name&&($t+="[".concat(rt.name,"]"),rt.name===Ks.JOIN))return Ut.info("".concat($t," ").concat(Dt));Ut.info("".concat($t," ").concat(Dt),Dt==="start"?rt.options:jt||"")}}const bt=()=>({tag:rt.tag,invokeId:ut,sid:_e,name:rt.name,apiInvokeTime:ct,options:rt.options,states:rt.states||null});Tt("start");let Ot=!1;zl(rt.timeout).then(()=>{Ot||(this.sendApiInvoke(po(po({},bt()),{},{error:tn.API_INVOKE_TIMEOUT,success:!1})),Tt("timeout"))});const Mt=new Yn(tn.UNEXPECTED_ERROR,"".concat(rt.name,": this api invoke is end"));return{onSuccess:Dt=>{const jt=()=>{if(Ot)throw Mt;return Ot=!0,this.sendApiInvoke(po(po({},bt()),{},{success:!0},rt.reportResult&&{result:Dt})),Tt("onSuccess"),Dt};return it?k3(jt,rt.name+"Success",it,()=>Ot=!0):jt()},onError:Dt=>{const jt=()=>{if(Ot)throw Dt;Ot=!0,this.sendApiInvoke(po(po({},bt()),{},{success:!1,error:Dt})),Tt("onFailure",Dt.toString())};return it?k3(jt,rt.name+"Error",it,()=>Ot=!0):jt()}}}sessionInit(_e,rt){if(this.baseInfoMap.has(_e))return;const it=Date.now(),ct=this.createBaseInfo(_e,it);ct.cname=rt.cname;const ut=Object.assign({},{willUploadConsoleLog:rn("UPLOAD_LOG"),maxTouchPoints:navigator.maxTouchPoints,areaVersion:PO?"global":"oversea",areas:rn("AREAS")&&rn("AREAS").join(",")},rt.extend),{stringUid:pt,channelProfile:mt,channelMode:_t,isABTestSuccess:vt,lsid:Tt,clientRole:bt}=rt,Ot=Date.now(),Mt=po(po({},ct),{},{eventType:Rl.SESSION_INIT,appid:rt.appid,browser:navigator.userAgent,buildFormat:rt.buildFormat,build:DO,lts:Ot,elapse:Ot-it,extend:JSON.stringify(ut),mode:rt.mode,process:rn("PROCESS_ID"),appType:rn("APP_TYPE"),success:!0,version:Zp,stringUid:pt,channelProfile:mt,channelMode:_t,isABTestSuccess:vt,lsid:Tt,clientType:Er(Dt=window.navigator.userAgent).call(Dt,"AgoraWebView")?42:20,clientRole:bt,serviceId:rn("PROCESS_ID"),extensionID:rn("PLUGIN_INFO").join(",")||""});var Dt;this.send({type:Os.SESSION,data:Mt},!0)}joinChooseServer(_e,rt){const it=this.baseInfoMap.get(_e);if(!it)return;const ct=it.info,ut=Date.now(),pt=po(po({},ct),{},{role:rt.role,eventType:Rl.JOIN_CHOOSE_SERVER,lts:ut,eventElapse:rt.elapse||ut-rt.lts,chooseServerAddr:rt.csAddr,errorCode:rt.ec,elapse:ut-it.startTime,success:rt.succ,chooseServerAddrList:JSON.stringify(rt.serverList),uid:rt.uid?parseInt(rt.uid):null,cid:rt.cid?parseInt(rt.cid):null,chooseServerIp:rt.csIp||"",opid:rt.opid,unilbsServerIds:rt.unilbsServerIds,extend:rt.extend||void 0,isHttp3:rt.isHttp3,corssRegionTagReq:rt.corssRegionTagReq||void 0,corssRegionTagRes:rt.corssRegionTagRes||void 0,resourceTimingInfo:rt.resourceTimingInfo||void 0});this.send({type:Os.JOIN_CHOOSE_SERVER,data:pt},!0)}reqUserAccount(_e,rt){const it=this.baseInfoMap.get(_e);if(!it)return;const ct=it.info,ut=Date.now(),pt=po(po({},ct),{},{eventType:Rl.REQ_USER_ACCOUNT,lts:ut,success:rt.success,serverAddress:rt.serverAddr,stringUid:rt.stringUid,uid:rt.uid,errorCode:rt.errorCode,elapse:rt.elapse||ut-it.startTime,eventElapse:ut-rt.lts,extend:JSON.stringify(rt.extend)});this.send({type:Os.REQ_USER_ACCOUNT,data:pt},!0)}joinGateway(_e,rt){const it=this.baseInfoMap.get(_e);if(!it)return;const ct=it.info;rt.vid&&(ct.vid=rt.vid),ct.uid=rt.uid,ct.cid=rt.cid;const ut=Date.now(),{firstSuccess:pt,addr:mt,isProxy:_t}=rt,vt=ut-it.startTime,Tt=po(po({},ct),{},{eventType:Rl.JOIN_GATEWAY,lts:ut,gatewayAddr:rt.addr,success:rt.succ,errorCode:rt.ec,errorMsg:rt.errorMsg||"",elapse:vt,eventElapse:ut-rt.lts,firstSuccess:pt,signalChannel:rt.signalChannel,preload:rt.preload?1:0,installId:MO(),isABTestSuccess:rt.isABTestSuccess?1:0}),bt=Tt.success?1:0;if(rt.succ&&(it.lastJoinSuccessTime=ut),pt)this.send({type:Os.JOIN_GATEWAY,data:Tt},!0);else{let Ot;if(mt)if(_t){const Dt=mt.match(/h=(\d{1,3}-){3}\d{1,3}/g),jt=mt.match(/p=[0-9]{1,6}/g);Ot={isSuccess:bt,gatewayIp:Dt&&Dt.length?Dt[0].split("=")[1].replace(/-/g,"."):"",port:jt&&jt.length?jt[0].split("=")[1]:"",isProxy:_t?1:0}}else{const Dt=mt.match(/wss:\/\/(\d{1,3}-){3}\d{1,3}/g),jt=mt.match(/(:|p=)[0-9]{1,6}/g);Ot={isSuccess:bt,gatewayIp:Dt&&Dt.length?Dt[0].split("//")[1].replace(/-/g,"."):"",port:jt&&jt.length?jt[0].split(/:|p=/g)[1]:"",isProxy:_t?1:0}}else Ot={isSuccess:bt,gatewayIp:"",port:"",isProxy:_t?1:0};delete Tt.success,delete Tt.eventType,delete Tt.firstSuccess,Tt.vid=Number(Tt.vid);const Mt=Object.assign({},Tt,Ot,{eventType:Rl.REJOIN_GATEWAY});this.send({type:Os.RE_JOIN_GATEWAY,data:Mt},!0)}}joinChannelTimeout(_e,rt){const it=this.baseInfoMap.get(_e);if(!it)return;const ct=Date.now(),ut=po(po({},it.info),{},{lts:ct,timeout:rt,elapse:ct-it.startTime});this.send({type:Os.JOIN_CHANNEL_TIMEOUT,data:ut},!0)}publish(_e,rt){const it=this.baseInfoMap.get(_e);if(!it)return;const ct=it.info,ut=Date.now(),pt=po(po({},ct),{},{eventType:Rl.PUBLISH,lts:ut,eventElapse:rt.eventElapse,elapse:ut-it.startTime,success:rt.succ,errorCode:rt.ec,videoName:rt.videoName,audioName:rt.audioName,screenName:rt.screenName,screenshare:rt.screenshare,audio:rt.audio,video:rt.video,p2pid:rt.p2pid,publishRequestid:rt.publishRequestid});this.send({type:Os.PUBLISH,data:pt},!0)}subscribe(_e,rt,it){const ct=this.baseInfoMap.get(_e);if(!ct)return;const ut=ct.info,pt=Date.now(),mt=po(po({},ut),{},{eventType:Rl.SUBSCRIBE,lts:pt,eventElapse:rt.eventElapse,elapse:pt-ct.startTime,success:rt.succ,errorCode:rt.ec,video:rt.video,audio:rt.audio,subscribeRequestid:rt.subscribeRequestid,p2pid:rt.p2pid,preSsrc:rt.preSsrc?1:0},it&&{extend:JSON.stringify({isMassSubscribe:!0})});typeof rt.peerid=="string"?mt.peerSuid=rt.peerid:mt.peer=rt.peerid,this.send({type:Os.SUBSCRIBE,data:mt},!0)}wsCompressorInit(_e){var rt;const it=[...sp(rt=this.baseInfoMap).call(rt)],ct=it.length?it[0]:"UnableToGetSid",ut=this.baseInfoMap.get(ct);if(!ut)return;const pt=ut.info,mt=Date.now(),_t=po(po({},pt),{},{eventType:Rl.WS_COMPRESSOR_INIT,lts:mt,eventElapse:_e.eventElapse,elapse:mt-ut.startTime,status:_e.status?1:2});this.send({type:Os.WS_COMPRESSOR_INIT,data:_t},!0)}firstXLAPeerFirstVideoFrame(_e,rt){const it=this.baseInfoMap.get(_e);if(!it)return;const ct=it.info,ut=Date.now(),pt=rt.peerPubStatusMs-(it.lastJoinSuccessTime||ut),mt=po(po({},ct),{},{elapse:ut-it.startTime,eventType:Rl.XLA_PEER_FIRST_VIDEO_FRAME,lts:ut,peer:rt.peer,width:rt.width,height:rt.height,ssrc:rt.ssrc,p2pid:rt.p2pid,peerPublishDuration:rt.peerPublishDuration,joinChannelSuccessElapse:pt,peerPubStatusMs:rt.peerPubStatusMs-rt.joinChannelStart,availablePublish:rt.peerPublishDuration>pt?1:0,preloadStart:Math.max(rt.preloadStart-rt.joinChannelStart,0),preloadEnd:Math.max(rt.preloadEnd-rt.joinChannelStart,0),encrypt:Math.max(rt.apStart-rt.joinChannelStart,0),ap:Math.max(rt.apEnd-rt.joinChannelStart,0),sua:Math.max(rt.suaEnd-rt.joinChannelStart,0),beforeConnect:Math.max(rt.beforeConnect-rt.joinChannelStart,0),peerRecevier:Math.max(rt.peerReceiver-rt.joinChannelStart,0),ice:Math.max(rt.ice-rt.joinChannelStart,0),pc:Math.max(rt.pc-rt.joinChannelStart,0),signalConnected:Math.max(rt.signalConnected-rt.joinChannelStart,0),joinReq:Math.max(rt.joinReq-rt.joinChannelStart,0),joinRes:Math.max(rt.joinRes-rt.joinChannelStart,0),userJoinNotify:Math.max(rt.userJoinNotify-rt.joinChannelStart,0),videoSsrcNotify:Math.max(rt.videoAddNotify-rt.joinChannelStart,0),subscribeDelayMs:Math.max(rt.subscribeStart-rt.videoAddNotify,0),subscribeStart:Math.max(rt.subscribeStart-rt.joinChannelStart,0),subscribeEnd:Math.max(rt.subscribeEnd-rt.joinChannelStart,0),firstReceived:Math.max(rt.firstReceived-rt.joinChannelStart,0),firstDecoded:Math.max(rt.firstDecoded-rt.joinChannelStart,0),firstPreRender:Math.max(rt.firstPreRender-rt.joinChannelStart,0),firstRender:Math.max(rt.firstRender-rt.joinChannelStart,0),playDelayMs:Math.max(rt.playStart-rt.subscribeEnd,0),playStart:Math.max(rt.playStart-rt.joinChannelStart,0),playEnd:Math.max(rt.playEnd-rt.joinChannelStart,0),isPreSub:rt.isPreSub?1:0,isPrePc:rt.isPrePc?1:0,isPreInstantVideo:rt.isPreInstantVideo?1:0});this.send({type:Os.XLA_PEER_FIRST_VIDEO_FRAME,data:mt},!0)}firstRemoteVideoDecode(_e,rt,it,ct){const ut=this.baseInfoMap.get(_e);if(!ut)return;const pt=ut.info,mt=Date.now(),_t=po(po(po({},pt),ct),{},{elapse:mt-ut.startTime,eventType:rt,lts:mt,firstDecodeFrame:Math.max((ct.firstFrame||mt)-ut.startTime,0),apEnd:Math.max(ct.apEnd-ut.startTime,0),apStart:Math.max(ct.apStart-ut.startTime,0),joinGwEnd:Math.max(ct.joinGwEnd-ut.startTime,0),joinGwStart:Math.max(ct.joinGwStart-ut.startTime,0),pcEnd:Math.max(ct.pcEnd-ut.startTime,0),pcStart:Math.max(ct.pcStart-ut.startTime,0),subscriberEnd:Math.max(ct.subscriberEnd-ut.startTime,0),subscriberStart:Math.max(ct.subscriberStart-ut.startTime,0),videoAddNotify:Math.max(ct.videoAddNotify-ut.startTime,0)});this.send({type:it,data:_t},!0)}firstRemoteFrame(_e,rt,it,ct){const ut=this.baseInfoMap.get(_e);if(!ut)return;const pt=ut.info,mt=Date.now(),_t=po(po(po({},pt),ct),{},{elapse:mt-ut.startTime,eventType:rt,lts:mt});this.send({type:it,data:_t},!0)}abTest(_e,rt){const it=this.baseInfoMap.get(_e);if(!it)return;const ct=it.info,ut=Date.now(),pt=po(po(po({},ct),rt),{},{vid:ct.vid===void 0?0:Number(ct.vid),elapse:ut-it.startTime,eventType:Rl.AB_TEST,lts:ut});this.send({type:Os.AB_TEST,data:pt},!0)}pcStats(_e,rt){const it=this.baseInfoMap.get(_e);if(!it)return;const ct=it.info,ut=Date.now(),pt=po(po(po({},ct),rt),{},{vid:ct.vid===void 0?0:Number(ct.vid),elapse:ut-it.startTime,eventType:Rl.PC_STATS,lts:ut,preallocation:rt.preallocation?1:0});this.send({type:Os.PC_STATS,data:pt},!0)}updateRemoteRTPCapabilities(_e,rt){if(_e){const it=this.baseInfoMap.get(_e);if(!it)return;const ct=it.info,ut=Date.now(),pt=po(po(po({},ct),rt),{},{vid:ct.vid===void 0?0:Number(ct.vid),eventType:Rl.UPDATE_REMOTE_RTPCAPABILITIES,lts:ut});this.send({type:Os.UPDATE_REMOTE_RTPCAPABILITIES,data:pt},!0)}}onGatewayStream(_e,rt,it,ct){const ut=this.baseInfoMap.get(_e);if(!ut)return;const pt=ut.info,mt=Date.now(),_t=po(po(po({},pt),ct),{},{eventType:rt,lts:mt});this.send({type:it,data:_t},!0)}streamSwitch(_e,rt){const it=this.baseInfoMap.get(_e);if(!it)return;const ct=it.info,ut=Date.now(),pt=po(po({},ct),{},{eventType:Rl.STREAM_SWITCH,lts:ut,isDual:rt.isdual,elapse:ut-it.startTime,success:rt.succ});this.send({type:Os.STREAM_SWITCH,data:pt},!0)}requestProxyAppCenter(_e,rt){const it=this.baseInfoMap.get(_e);if(!it)return;const ct=it.info,ut=Date.now(),pt=po(po({},ct),{},{eventType:Rl.REQUEST_PROXY_APPCENTER,lts:ut,eventElapse:ut-rt.lts,elapse:ut-it.startTime,APAddr:rt.APAddr,workerManagerList:rt.workerManagerList,response:rt.response,errorCode:rt.ec,success:rt.succ});this.send({type:Os.REQUEST_PROXY_APPCENTER,data:pt},!0)}requestProxyWorkerManager(_e,rt){const it=this.baseInfoMap.get(_e);if(!it)return;const ct=it.info,ut=Date.now(),pt=po(po({},ct),{},{eventType:Rl.REQUEST_PROXY_WORKER_MANAGER,lts:ut,eventElapse:ut-rt.lts,elapse:ut-it.startTime,workerManagerAddr:rt.workerManagerAddr,response:rt.response,errorCode:rt.ec,success:rt.succ});this.send({type:Os.REQUEST_PROXY_WORKER_MANAGER,data:pt},!0)}setProxyServer(_e){this.proxyServer=_e,_e?Ut.debug("reportProxyServerurl: ".concat(_e)):Ut.debug("disable reportProxyServerurl: ".concat(_e))}peerPublishStatus(_e,rt){const it=this.baseInfoMap.get(_e);if(!it)return;const ct=it.info,ut=Date.now(),pt=po(po({},ct),{},{subscribeElapse:rt.subscribeElapse,peer:rt.peer,peerPublishDuration:Math.max(rt.audioPublishDuration,rt.videoPublishDuration),audiotag:rt.audioPublishDuration>0?1:-1,videotag:rt.videoPublishDuration>0?1:-1,lts:ut,elapse:ut-it.startTime,joinChannelSuccessElapse:ut-(it.lastJoinSuccessTime||ut),peerPublishDurationVideo:rt.videoPublishDuration,peerPublishDurationAudio:rt.audioPublishDuration});this.send({type:Os.PEER_PUBLISH_STATUS,data:pt},!0)}workerEvent(_e,rt){const it=this.baseInfoMap.get(_e);if(!it)return;const ct=it.info,ut=Date.now();(function(pt,mt,_t){const vt=pt[mt];if(!vt||typeof vt!="string")return[pt];pt[mt]="";const Tt=M_(JSON.stringify(pt));let bt=0;const Ot=[];let Mt=0;for(let Dt=0;Dt<vt.length;Dt++)Mt+=vt.charCodeAt(Dt)<=127?1:3,Mt<=_t-Tt||(Ot[Ot.length]=hr(hr({},pt),{},{[mt]:vt.substring(bt,Dt)}),bt=Dt,Mt=vt.charCodeAt(Dt)<=127?1:3);return bt!==vt.length-1&&(Ot[Ot.length]=hr(hr({},pt),{},{[mt]:vt.substring(bt)})),Ot})(po(po(po({},ct),rt),{},{elapse:ut-it.startTime,lts:ut,productType:"WebRTC"}),"payload",1300).forEach(pt=>this.send({type:Os.WORKER_EVENT,data:pt},!0))}apworkerEvent(_e,rt){const it=this.baseInfoMap.get(_e);if(!it)return;const ct=it.info,ut=Date.now(),pt=po(po(po({},ct),rt),{},{elapse:ut-it.startTime,lts:ut});this.send({type:Os.AP_WORKER_EVENT,data:pt},!0)}joinWebProxyAP(_e,rt){const it=this.baseInfoMap.get(_e);if(!it)return;const ct=it.info,ut=Date.now(),pt=po(po(po({},ct),rt),{},{elapse:ut-it.startTime,lts:ut,extend:rt.extend||void 0});this.send({type:Os.JOIN_WEB_PROXY_AP,data:pt},!0)}WebSocketQuit(_e,rt){const it=this.baseInfoMap.get(_e);if(!it)return;const ct=it.info,ut=Date.now(),pt=po(po(po({},ct),rt),{},{elapse:ut-it.startTime,lts:ut});this.send({type:Os.WEBSOCKET_QUIT,data:pt},!0)}async sendCustomReportMessage(_e,rt){if(this.customReportCount+=rt.length,this.customReportCount>rn("CUSTOM_REPORT_LIMIT"))throw new Yn(tn.CUSTOM_REPORT_FREQUENCY_TOO_HIGH);this.customReportCounterTimer||(this.customReportCounterTimer=window.setInterval(()=>{this.customReportCount=0},5e3));const it=Date.now(),ct=rt.map(ut=>({type:Os.USER_ANALYTICS,data:po(po({sid:_e},ut),{},{lts:it})}));try{rn("NEW_REPORT_SERVER")?await this.postDataToStatsCollector2(ct):await this.postDataToStatsCollector(ct)}catch(ut){throw Ut.error("send custom report message failed",ut.toString()),new Yn(tn.CUSTOM_REPORT_SEND_FAILED,ut.message)}}sendApiInvoke(_e){const rt=rn("NOT_REPORT_EVENT");if(_e.tag&&Er(rt)&&Er(rt).call(rt,_e.tag))return!1;if(_e.sid===null)return this.apiInvokeUploadPendingItems.push(_e),!1;const it=this.baseInfoMap.get(_e.sid);if(!it)return this.apiInvokeUploadPendingItems.push(_e),!1;const{cname:ct,uid:ut,cid:pt}=it.info;let mt;if(_e.lts=_e.lts||Date.now(),_e.error)if(_e.error instanceof Yn){const{code:vt,message:Tt}=_e.error;mt=vt||Tt||_e.error.toString()}else mt=_e.error.toString();const _t={invokeId:_e.invokeId,sid:_e.sid,cname:ct,cid:pt,uid:ut,lts:_e.lts,success:_e.success,elapse:_e.lts-it.startTime,execElapse:_e.lts-_e.apiInvokeTime,apiName:_e.name,options:_e.options?JSON.stringify(_e.options):void 0,execStates:_e.states?JSON.stringify(_e.states):void 0,execResult:_e.result?JSON.stringify(_e.result):void 0,errorCode:_e.error?mt:void 0,errorMsg:_e.error?JSON.stringify(_e.error):void 0};return this.send({type:Os.API_INVOKE,data:_t},!1),!0}addSid(_e){this.sids.add(_e)}removeSid(_e){this.sids.delete(_e)}appendSessionId(){const _e=this.apiInvokeUploadPendingItems;if(_e.length===0)return;const rt=Array.from(this.sids).find(it=>it!==null);rt&&_e.forEach(it=>{it&&(it.sid=rt,this.sendApiInvoke(Object.assign({},it)))}),_e.length=0}send(_e,rt){if(rt)return this.keyEventUploadPendingItems.push(_e),void this.sendItems(this.keyEventUploadPendingItems,!0);this.normalEventUploadPendingItems.push(_e),this.normalEventUploadPendingItems.length>rn("NORMAL_EVENT_QUEUE_CAPACITY")&&this.normalEventUploadPendingItems.splice(0,1),this.normalEventUploadPendingItems.length>=10&&this.sendItems(this.normalEventUploadPendingItems,!1)}doSend(){this.keyEventUploadPendingItems.length>0&&this.sendItems(this.keyEventUploadPendingItems,!0),this.normalEventUploadPendingItems.length>0&&Date.now()-this.lastSendNormalEventTime>=5e3&&this.sendItems(this.normalEventUploadPendingItems,!1)}sendItems(_e,rt){const it=[],ct=[];for(;_e.length;){const pt=_e.shift();it.length<20?it.push(pt):ct.push(pt)}_e.push(...ct);for(const pt of[...it]){var ut;this.ltsList.indexOf(pt.data.lts)!==-1?(pt.data.lts=this.ltsList[this.ltsList.length-1]+1,this.ltsList.push(pt.data.lts)):(this.ltsList.push(pt.data.lts),s0(ut=this.ltsList).call(ut,(mt,_t)=>mt-_t))}return rt||(this.lastSendNormalEventTime=Date.now()),rn("ENABLE_EVENT_REPORT")&&it.length&&(rn("NEW_REPORT_SERVER")?this.postDataToStatsCollector2(it):this.postDataToStatsCollector(it)).catch((pt=>mt=>{rn("EVENT_REPORT_RETRY")&&(rt?this.keyEventUploadPendingItems=this.keyEventUploadPendingItems.concat(pt):(this.normalEventUploadPendingItems=this.normalEventUploadPendingItems.concat(pt),this.normalEventUploadPendingItems.length>rn("NORMAL_EVENT_QUEUE_CAPACITY")&&(this.normalEventUploadPendingItems.splice(0,this.normalEventUploadPendingItems.length-rn("NORMAL_EVENT_QUEUE_CAPACITY")),Ut.warning("report: drop normal events"))))})(it)),_e}async postDataToStatsCollector2(_e){Qs.networkState===Cp.OFFLINE&&await Ir.race([Qs.onlineWaiter,zl(2*xa.maxRetryTimeout)]);const rt=ut=>{let pt=new Uint8Array;return ut.forEach(mt=>{const _t=vO(JSON.stringify(mt.data)),vt=new ArrayBuffer(5),Tt=(Ot=>{let Mt=0;return Object.entries(Os).forEach(Dt=>{let[jt,$t]=Dt;$t===Ot.type&&(Mt=RY[jt])}),Mt})(mt),bt=new DataView(vt);bt.setUint16(0,_t.byteLength,!0),bt.setUint8(2,255&Tt),bt.setUint8(3,Tt>>>8&255),bt.setUint8(4,Tt>>>16&255),pt=w3(pt,new Uint8Array(vt)),pt=w3(pt,_t)}),pt},it="event";let ct=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(rn("NEW_REPORT_SERVER_DOMAINS")[0],"&p=443&d=").concat(it):"https://".concat(rn("NEW_REPORT_SERVER_DOMAINS")[0],"/").concat(it);for(let ut=0;ut<2;ut+=1){ut===1&&(ct=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(rn("NEW_REPORT_SERVER_DOMAINS")[1],"&p=443&d=").concat(it):"https://".concat(rn("NEW_REPORT_SERVER_DOMAINS")[1],"/").concat(it));try{await RO(ct,{timeout:1e4,data:rt(_e),headers:po(po({biz:"webrtc",sendts:Math.round(Date.now()/1e3),debug:"false"},this._appId&&{appid:this._appId}),{},{"Content-Type":"application/octet-stream"})},!0)}catch(pt){if(ut===1)throw pt;continue}return}}async postDataToStatsCollector(_e){let rt=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const it=(_t=>{const vt=_t&&_t.data.sid&&this.baseInfoMap.get(_t.data.sid);return vt&&vt.info.vid&&+vt.info.vid||0})(_e[0]),ct=it?void 0:this._aid,ut={msgType:"EventMessages",sentTs:Math.round(Date.now()/1e3),payloads:_e.map(_t=>JSON.stringify(_t)),vid:it,aid:ct};Qs.networkState===Cp.OFFLINE&&await Ir.race([Qs.onlineWaiter,zl(2*xa.maxRetryTimeout)]);const pt=rt?"/events/proto-raws":"/events/messages";let mt=this.url||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(rn("EVENT_REPORT_DOMAIN"),"&p=").concat(rn("STATS_COLLECTOR_PORT"),"&d=").concat(pt):"https://".concat(rn("EVENT_REPORT_DOMAIN"),":").concat(rn("STATS_COLLECTOR_PORT")).concat(pt));for(let _t=0;_t<2;_t+=1){_t===1&&(mt=this.backupUrl||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(rn("EVENT_REPORT_BACKUP_DOMAIN"),"&p=").concat(rn("STATS_COLLECTOR_PORT"),"&d=").concat(pt):"https://".concat(rn("EVENT_REPORT_BACKUP_DOMAIN"),":").concat(rn("STATS_COLLECTOR_PORT")).concat(pt)));try{rt?await dY(mt,{timeout:1e4,data:ut}):await RO(mt,{timeout:1e4,data:ut})}catch(vt){if(_t===1)throw vt;continue}return}}createBaseInfo(_e,rt){const it=Object.assign({},bY);return it.sid=_e,this.baseInfoMap.set(_e,{info:it,startTime:rt}),it}reportResourceTiming(_e,rt){const it=performance.getEntriesByName(_e),ct=it[it.length-1];ct&&this.reportApiInvoke(rt,{name:"Client.resourceTiming",options:ct,tag:Ns.TRACER}).onSuccess()}};tB.on("REPORT_LOG_UPLOAD",_e=>{_e.networkState=Qs.networkState,Vr.reportApiInvoke(null,{name:"logUploadError",options:_e,tag:Ns.TRACER}).onSuccess("logUploadError")});class $n extends Yn{constructor(rt){super(rt,arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",arguments.length>2?arguments[2]:void 0),Hs(this,"name","AgoraRTCException")}print(){let rt=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error";return super.print(rt,Ut)}throw(){super.throw(Ut)}}const Wl={getDisplayMedia:!1,getStreamFromExtension:!1,supportUnifiedPlan:!1,supportMinBitrate:!1,supportSetRtpSenderParameters:!1,supportDualStream:!0,webAudioMediaStreamDest:!1,supportReplaceTrack:!1,supportWebGL:!1,webAudioWithAEC:!1,supportRequestFrame:!1,supportShareAudio:!1,supportDualStreamEncoding:!1,supportDataChannel:!1,supportPCSetConfiguration:!1,supportWebRTCEncodedTransform:!1,supportWebRTCInsertableStream:!1,supportRequestVideoFrameCallback:!1,supportWebCrypto:!1};function Fo(){return Wl}function iB(){return"setSinkId"in HTMLAudioElement.prototype&&(!rn("RESTRICTION_SET_PLAYBACK_DEVICE")||(dE()||m3())&&!gO())}function yw(){return!Wl.supportUnifiedPlan||rn("CHROME_FORCE_PLAN_B")&&hE()}function BO(_e){return!(Gs()||g3(87)||yw()||!rn("ENABLE_PRE_SUB")&&(_e==null||!_e.autoSubscribe||rn("FORCE_DISABLE_AUTO_SUB")))}function oB(_e){return!!rn("ENABLE_INSTANT_VIDEO")||!(_e==null||!_e.autoSubscribe||rn("FORCE_DISABLE_AUTO_SUB"))}let Kl=function(_e){return _e.IOS_15_16_INTERRUPTION_START="ios15_16-interruption-start",_e.IOS_15_16_INTERRUPTION_END="ios15_16-interruption-end",_e.IOS_INTERRUPTION_START="ios-interruption-start",_e.IOS_INTERRUPTION_END="ios-interruption-end",_e.STATE_CHANGE="state-change",_e}({});function vS(_e,rt,it){return{sampleRate:_e,stereo:rt,bitrate:it}}function Vo(_e,rt,it,ct,ut){return{width:_e,height:rt,frameRate:it,bitrateMin:ct,bitrateMax:ut}}function Am(_e,rt,it,ct,ut){return{width:{max:_e},height:{max:rt},frameRate:it,bitrateMin:ct,bitrateMax:ut}}function FO(_e,rt){return{numSpatialLayers:_e,numTemporalLayers:rt}}const wY={"90p":Vo(160,90),"90p_1":Vo(160,90),"120p":Vo(160,120,15,30,65),"120p_1":Vo(160,120,15,30,65),"120p_3":Vo(120,120,15,30,50),"120p_4":Vo(212,120),"180p":Vo(320,180,15,30,140),"180p_1":Vo(320,180,15,30,140),"180p_3":Vo(180,180,15,30,100),"180p_4":Vo(240,180,15,30,120),"240p":Vo(320,240,15,40,200),"240p_1":Vo(320,240,15,40,200),"240p_3":Vo(240,240,15,40,140),"240p_4":Vo(424,240,15,40,220),"360p":Vo(640,360,15,80,400),"360p_1":Vo(640,360,15,80,400),"360p_3":Vo(360,360,15,80,260),"360p_4":Vo(640,360,30,80,600),"360p_6":Vo(360,360,30,80,400),"360p_7":Vo(480,360,15,80,320),"360p_8":Vo(480,360,30,80,490),"360p_9":Vo(640,360,15,80,800),"360p_10":Vo(640,360,24,80,800),"360p_11":Vo(640,360,24,80,1e3),"480p":Vo(640,480,15,100,500),"480p_1":Vo(640,480,15,100,500),"480p_2":Vo(640,480,30,100,1e3),"480p_3":Vo(480,480,15,100,400),"480p_4":Vo(640,480,30,100,750),"480p_6":Vo(480,480,30,100,600),"480p_8":Vo(848,480,15,100,610),"480p_9":Vo(848,480,30,100,930),"480p_10":Vo(640,480,10,100,400),"720p":Vo(1280,720,15,120,1130),"720p_auto":Vo(1280,720,30,900,3e3),"720p_1":Vo(1280,720,15,120,1130),"720p_2":Vo(1280,720,30,120,2e3),"720p_3":Vo(1280,720,30,120,1710),"720p_5":Vo(960,720,15,120,910),"720p_6":Vo(960,720,30,120,1380),"1080p":Vo(1920,1080,15,120,2080),"1080p_1":Vo(1920,1080,15,120,2080),"1080p_2":Vo(1920,1080,30,120,3e3),"1080p_3":Vo(1920,1080,30,120,3150),"1080p_5":Vo(1920,1080,60,120,4780),"1440p":Vo(2560,1440,30,120,4850),"1440p_1":Vo(2560,1440,30,120,4850),"1440p_2":Vo(2560,1440,60,120,7350),"4k":Vo(3840,2160,30,120,8910),"4k_1":Vo(3840,2160,30,120,8910),"4k_3":Vo(3840,2160,60,120,13500)},IY={"480p":Am(640,480,5),"480p_1":Am(640,480,5),"480p_2":Am(640,480,30),"480p_3":Am(640,480,15),"720p":Am(1280,720,5),"720p_auto":Vo(1280,720,30,900,3e3),"720p_1":Am(1280,720,5),"720p_2":Am(1280,720,30),"720p_3":Am(1280,720,15),"1080p":Am(1920,1080,5),"1080p_1":Am(1920,1080,5),"1080p_2":Am(1920,1080,30),"1080p_3":Am(1920,1080,15)},xY={"1SL1TL":FO(1,1),"3SL3TL":FO(3,3),"2SL3TL":FO(2,3)};function Cm(_e){return _e||(_e="480p_1"),typeof _e=="string"?Object.assign({},wY[_e]):_e}function VO(_e){return typeof _e=="string"?Object.assign({},IY[_e]):_e}function Sw(_e){return typeof _e=="string"?Object.assign({},xY[_e]):_e}const OY={speech_low_quality:vS(16e3,!1),speech_standard:vS(32e3,!1,18),music_standard:vS(48e3,!1),standard_stereo:vS(48e3,!0,56),high_quality:vS(48e3,!1,128),high_quality_stereo:vS(48e3,!0,192)};function Tw(_e){return typeof _e=="string"?Object.assign({},OY[_e]):_e}const yS=[];function sB(_e){return Cl(_e,"mediaSource",["screen","window","application"]),!0}let Lr=function(_e){return _e.NEED_RENEGOTIATE="@need_renegotiate",_e.NEED_REPLACE_TRACK="@need_replace_track",_e.NEED_REPLACE_MIXING_TRACK="@need_replace_mixing_track",_e.NEED_CLOSE="@need_close",_e.NEED_ENABLE_TRACK="@need_enable_track",_e.NEED_DISABLE_TRACK="@need_disable_track",_e.NEED_SESSION_ID="@need_sid",_e.SET_OPTIMIZATION_MODE="@set_optimization_mode",_e.GET_STATS="@get_stats",_e.GET_RTC_STATS="@get_rtc_stats",_e.GET_LOW_VIDEO_TRACK="@get_low_video_track",_e.NEED_RESET_REMOTE_SDP="@need_reset_remote_sdp",_e.NEED_UPDATE_VIDEO_ENCODER="@need_update_video_encoder",_e.NEED_UPDATE_VIDEO_SEND_PARAMETERS="@need_update_video_send_parameters",_e.NEED_MUTE_TRACK="@need_mute_track",_e.NEED_UNMUTE_TRACK="@need_unmute_track",_e}({}),ds=function(_e){return _e.SCREEN_TRACK="screen_track",_e.CUSTOM_TRACK="custome_track",_e.LOW_STREAM="low_stream",_e.SCREEN_LOW_TRACK="screen_low_track",_e}({}),SS=function(_e){return _e[_e.HIGH_STREAM=0]="HIGH_STREAM",_e[_e.LOW_STREAM=1]="LOW_STREAM",_e}({}),MY=function(_e){return _e[_e.HIGH_STREAM=0]="HIGH_STREAM",_e[_e.LOW_STREAM=1]="LOW_STREAM",_e[_e.HIGH_STREAM_LAYER1=4]="HIGH_STREAM_LAYER1",_e[_e.HIGH_STREAM_LAYER2=5]="HIGH_STREAM_LAYER2",_e[_e.HIGH_STREAM_LAYER3=6]="HIGH_STREAM_LAYER3",_e[_e.HIGH_STREAM_LAYER4=7]="HIGH_STREAM_LAYER4",_e[_e.HIGH_STREAM_LAYER5=8]="HIGH_STREAM_LAYER5",_e[_e.HIGH_STREAM_LAYER6=9]="HIGH_STREAM_LAYER6",_e}({}),PY=function(_e){return _e[_e.DISABLE=0]="DISABLE",_e[_e.LOW_STREAM=1]="LOW_STREAM",_e[_e.AUDIO_ONLY=2]="AUDIO_ONLY",_e[_e.HIGH_STREAM_LAYER1=3]="HIGH_STREAM_LAYER1",_e[_e.HIGH_STREAM_LAYER2=4]="HIGH_STREAM_LAYER2",_e[_e.HIGH_STREAM_LAYER3=5]="HIGH_STREAM_LAYER3",_e[_e.HIGH_STREAM_LAYER4=6]="HIGH_STREAM_LAYER4",_e[_e.HIGH_STREAM_LAYER5=7]="HIGH_STREAM_LAYER5",_e[_e.HIGH_STREAM_LAYER6=8]="HIGH_STREAM_LAYER6",_e}({}),v0=function(_e){return _e.TRANSCEIVER_UPDATED="transceiver-updated",_e.SEI_TO_SEND="sei-to-send",_e.SEI_RECEIVED="sei-received",_e.TRACK_UPDATED="track-updated",_e}({}),TS=function(_e){return _e.SOURCE_STATE_CHANGE="source-state-change",_e.TRACK_ENDED="track-ended",_e.BEAUTY_EFFECT_OVERLOAD="beauty-effect-overload",_e.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",_e.CLOSED="closed",_e}({}),_f=function(_e){return _e.FIRST_FRAME_DECODED="first-frame-decoded",_e.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",_e.VIDEO_STATE_CHANGED="video-state-changed",_e.PLAY_START="play-start",_e.PLAY_END="play-end",_e.FIRST_FRAME_RENDER="first-frame-render",_e}({}),AS=function(_e){return _e.AUDIO="audio",_e.VIDEO="video",_e.DATA="data",_e}({}),kp=function(_e){return _e.AUDIO_SOURCE_STATE_CHANGE="audio_source_state_change",_e.RECEIVE_TRACK_BUFFER="receive_track_buffer",_e.ON_AUDIO_BUFFER="on_audio_buffer",_e.UPDATE_SOURCE="update_source",_e}({});(function(_e){_e.UPDATE_TRACK_SOURCE="update-track-source"})({});const GO={sendVolumeLevel:0,sendBitrate:0,sendBytes:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,currentPacketLossRate:0},$O={sendBytes:0,sendBitrate:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,sendResolutionHeight:0,sendResolutionWidth:0,captureResolutionHeight:0,captureResolutionWidth:0,targetSendBitrate:0,totalDuration:0,totalFreezeTime:0,currentPacketLossRate:0},aB={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveLevel:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receivePacketsDiscarded:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},NY={uplinkNetworkQuality:0,downlinkNetworkQuality:0},cB={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receiveResolutionHeight:0,receiveResolutionWidth:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1};let Fu=function(_e){return _e.ON_TRACK="on_track",_e.ON_NODE="on_node",_e}({}),Up=function(_e){return _e.REQUEST_UPDATE_CONSTRAINTS="request_update_constraints",_e.REQUEST_CONSTRAINTS="request_constraints",_e}({}),yA=function(_e){return _e.IDLE="IDLE",_e.INITING="INITING",_e.INITEND="INITEND",_e}({}),y0=function(_e){return _e.STATE_CHANGE="state_change",_e.RECORDING_DEVICE_CHANGED="recordingDeviceChanged",_e.PLAYOUT_DEVICE_CHANGED="playoutDeviceChanged",_e.CAMERA_DEVICE_CHANGED="cameraDeviceChanged",_e}({}),uu=function(_e){return _e.NONE="none",_e.INIT="init",_e.CANPLAY="canplay",_e.PLAYING="playing",_e.PAUSED="paused",_e.SUSPEND="suspend",_e.STALLED="stalled",_e.WAITING="waiting",_e.ERROR="error",_e.DESTROYED="destroyed",_e.ABORT="abort",_e.ENDED="ended",_e.EMPTIED="emptied",_e.LOADEDDATA="loadeddata",_e}({}),N_=function(_e){return _e[_e.VideoStateStopped=0]="VideoStateStopped",_e[_e.VideoStateStarting=1]="VideoStateStarting",_e[_e.VideoStateDecoding=2]="VideoStateDecoding",_e[_e.VideoStateFrozen=3]="VideoStateFrozen",_e}({});const HO={uninit:100,none:110,init:120,loadeddata:130,canplay:200,playing:210,paused:220,suspend:300,stalled:310,waiting:320,error:330,destroyed:340,abort:350,ended:360,emptied:370};let Aw=function(_e){return _e.OPEN="open",_e.MESSAGE="message",_e.CLOSE="close",_e.CLOSING="closing",_e.ERROR="error",_e}({});function Po(_e,rt,it,ct,ut){var pt,mt,_t={};return Object.keys(ct).forEach(function(vt){_t[vt]=ct[vt]}),_t.enumerable=!!_t.enumerable,_t.configurable=!!_t.configurable,("value"in _t||_t.initializer)&&(_t.writable=!0),_t=_p(pt=pT(mt=it.slice()).call(mt)).call(pt,function(vt,Tt){return Tt(_e,rt,vt)||vt},_t),ut&&_t.initializer!==void 0&&(_t.value=_t.initializer?_t.initializer.call(ut):void 0,_t.initializer=void 0),_t.initializer===void 0?(Object.defineProperty(_e,rt,_t),null):_t}function Fn(_e,rt,it){return(rt=function(ct){var ut=function(pt,mt){if(typeof pt!="object"||!pt)return pt;var _t=pt[Symbol.toPrimitive];if(_t!==void 0){var vt=_t.call(pt,"string");if(typeof vt!="object")return vt;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(pt)}(ct);return typeof ut=="symbol"?ut:ut+""}(rt))in _e?Object.defineProperty(_e,rt,{value:it,enumerable:!0,configurable:!0,writable:!0}):_e[rt]=it,_e}function lB(_e,rt){var it=Object.keys(_e);if(Object.getOwnPropertySymbols){var ct=Object.getOwnPropertySymbols(_e);rt&&(ct=ct.filter(function(ut){return Object.getOwnPropertyDescriptor(_e,ut).enumerable})),it.push.apply(it,ct)}return it}function Ss(_e){for(var rt=1;rt<arguments.length;rt++){var it=arguments[rt]!=null?arguments[rt]:{};rt%2?lB(Object(it),!0).forEach(function(ct){Fn(_e,ct,it[ct])}):Object.getOwnPropertyDescriptors?Object.defineProperties(_e,Object.getOwnPropertyDescriptors(it)):lB(Object(it)).forEach(function(ct){Object.defineProperty(_e,ct,Object.getOwnPropertyDescriptor(it,ct))})}return _e}class uB extends Fs{set _mediaStreamTrack(rt){rt!==this.mediaStreamTrack&&(this.safeEmit(v0.TRACK_UPDATED,rt),this.mediaStreamTrack=rt)}get _mediaStreamTrack(){return this.mediaStreamTrack}constructor(rt,it){super(),Fn(this,"trackMediaType",void 0),Fn(this,"_ID",void 0),Fn(this,"_rtpTransceiver",void 0),Fn(this,"_lowRtpTransceiver",void 0),Fn(this,"_hints",[]),Fn(this,"_isClosed",!1),Fn(this,"_originMediaStreamTrack",void 0),Fn(this,"mediaStreamTrack",void 0),Fn(this,"_external",{}),this._ID=it||ms(8,"track-"),this._originMediaStreamTrack=rt,this.mediaStreamTrack=rt,function(ct){Er(yS).call(yS,ct)||yS.push(ct)}(this)}toString(){return this._ID}getTrackId(){return this._ID}getMediaStreamTrack(rt){return rt||tv(()=>{var it;Vr.reportApiInvoke(null,{name:Ks.GET_MEDIA_STREAM_TRACK,options:[],tag:Ns.TRACER}).onSuccess(((it=this._mediaStreamTrack)===null||it===void 0?void 0:it.label)||"")},this.mediaStreamTrack.id||this.getTrackId()),this._mediaStreamTrack}getRTCRtpTransceiver(rt){return rt===SS.LOW_STREAM?this._lowRtpTransceiver:this._rtpTransceiver}getMediaStreamTrackSettings(){return this.getMediaStreamTrack(!0).getSettings()}close(){this._isClosed=!0,this._lowRtpTransceiver=void 0,this._rtpTransceiver=void 0,function(rt){const it=yS.indexOf(rt);it!==-1&&yS.splice(it,1)}(this),this.emit(TS.CLOSED),this.removeAllListeners(v0.SEI_RECEIVED)}_updateRtpTransceiver(rt,it){if(it===SS.LOW_STREAM){if(this._lowRtpTransceiver===rt)return;this._lowRtpTransceiver=rt}else{if(this._rtpTransceiver===rt)return;this._rtpTransceiver=rt}this.emit(v0.TRANSCEIVER_UPDATED,rt,it)}}class CS extends uB{get isExternalTrack(){return this._isExternalTrack}get muted(){return this._muted}get enabled(){return this._enabled}get processorContext(){return this._processorContext}constructor(rt,it){super(rt,it),Fn(this,"_enabled",!0),Fn(this,"_muted",!1),Fn(this,"_isExternalTrack",!1),Fn(this,"_isClosed",!1),Fn(this,"_enabledMutex",void 0),Fn(this,"processor",void 0),Fn(this,"_processorContext",void 0),Fn(this,"_handleTrackEnded",()=>{this.onTrackEnded()}),this._enabledMutex=new lu("".concat(this.getTrackId())),rt.addEventListener("ended",this._handleTrackEnded)}getTrackLabel(){var rt,it;return(rt=(it=this._originMediaStreamTrack)===null||it===void 0?void 0:it.label)!==null&&rt!==void 0?rt:""}close(){this._isClosed||(this.stop(),this._originMediaStreamTrack.stop(),this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack.stop(),this._mediaStreamTrack=null),this._originMediaStreamTrack=null,this._enabledMutex=null,Ut.debug("[".concat(this.getTrackId(),"] close")),this.emit(Lr.NEED_CLOSE),super.close())}async _updateOriginMediaStreamTrack(rt,it){let ct=arguments.length>2&&arguments[2]!==void 0&&arguments[2];this._isExternalTrack=ct,rt!==this._originMediaStreamTrack&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),it&&this._originMediaStreamTrack.stop()),rt.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=rt,this._muted&&(this._originMediaStreamTrack.enabled=!1),this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await ps(this,Lr.NEED_REPLACE_TRACK,this),this.processor&&this._processorContext&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this._processorContext}))}_getDefaultPlayerConfig(){return{}}onTrackEnded(){Ut.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(TS.TRACK_ENDED)}stateCheck(rt,it){if(Ut.debug("check track state, [muted: ".concat(this._muted,", enabled: ").concat(this._enabled,"] to [").concat(rt,": ").concat(it,"]")),t_(it,rt),this._enabled&&this._muted&&rt==="enabled"&&it===!1)throw new Yn(tn.TRACK_STATE_UNREACHABLE,"cannot set enabled while the track is muted").print("error",Ut);if(!this._enabled&&!this._muted&&rt==="muted"&&it===!0)throw new Yn(tn.TRACK_STATE_UNREACHABLE,"cannot set muted while the track is disabled").print("error",Ut)}getProcessorStats(){return this._processorContext&&this._processorContext.gatherStats()||[]}getProcessorUsage(){return this._processorContext?this._processorContext.gatherUsage():Ir.resolve([])}}const dB=window.AudioContext||window.webkitAudioContext;let Bp=null;const rs=new class extends Fs{constructor(){super(...arguments),Fn(this,"prevState",void 0),Fn(this,"curState",void 0),Fn(this,"currentTime",void 0),Fn(this,"currentTimeStuckAt",void 0),Fn(this,"interruptDetectorTrack",void 0),Fn(this,"onLocalAudioTrackMute",()=>{Ut.info("ios15-interruption-start"),this.emit(Kl.IOS_15_16_INTERRUPTION_START)}),Fn(this,"onLocalAudioTrackUnmute",async()=>{Ut.info("ios15-interruption-end"),this.curState!=="running"||this.duringInterruption?Ut.info("ios15-interruption-end-canceled"):(Bp&&await Bp.suspend(),this.emit(Kl.IOS_15_16_INTERRUPTION_END))})}get duringInterruption(){return this.prevState==="running"&&this.curState==="interrupted"}bindInterruptDetectorTrack(_e){Ut.debug("webaudio bindInterruptDetectorTrack ".concat(_e.getTrackId())),this.interruptDetectorTrack||(this.interruptDetectorTrack=_e,this.interruptDetectorTrack._mediaStreamTrack.onmute=this.onLocalAudioTrackMute,this.interruptDetectorTrack._mediaStreamTrack.onunmute=this.onLocalAudioTrackUnmute)}unbindInterruptDetectorTrack(_e){Ut.debug("webaudio unbindInterruptDetectorTrack ".concat(_e.getTrackId())),this.interruptDetectorTrack&&this.interruptDetectorTrack===_e&&(this.interruptDetectorTrack._mediaStreamTrack&&(this.interruptDetectorTrack._mediaStreamTrack.onmute=null,this.interruptDetectorTrack._mediaStreamTrack.onunmute=null),this.interruptDetectorTrack=void 0)}};function bS(){if(!Bp){if(function(){if(!dB)return void Ut.error("your browser is not support web audio");Ut.info("create audio context");const _e=Ss({},rn("WEBAUDIO_INIT_OPTIONS"));Ut.debug("audio context init option:",JSON.stringify(_e)),Bp=new dB(_e),rs.curState=Bp.state,Bp.onstatechange=()=>{rs.prevState=rs.curState,rs.curState=Bp?Bp.state:void 0;const{prevState:rt,curState:it}=rs,ct=it==="running",ut=it==="interrupted",pt=rt==="running",mt=rt==="suspended",_t=rt==="interrupted",vt=No().osVersion;(Tu()||Sm())&&pt&&ut&&(Ut.info("ios".concat(vt,"-interruption-start")),rs.emit(Kl.IOS_INTERRUPTION_START)),(Tu()||Sm())&&(mt||_t)&&ct&&(Ut.info("ios".concat(vt,"-interruption-end")),rs.emit(Kl.IOS_INTERRUPTION_END)),rt!==it&&rs.emit(Kl.STATE_CHANGE,it,rt)},setInterval(()=>{var rt;const it=(rt=Bp)===null||rt===void 0?void 0:rt.currentTime;rs.currentTime!==it?(rs.currentTimeStuckAt&&(Ut.debug("AudioContext current time resume at ".concat(it)),rs.currentTimeStuckAt=void 0),rs.currentTime=it):(it!==rs.currentTimeStuckAt&&(Vr.reportApiInvoke(null,{name:"WEB_AUDIO_CURRENT_TIME_STUCK",options:{currentTime:it},tag:Ns.TRACER}).onSuccess(),Ut.warning("AudioContext current time stuck at ".concat(it))),rs.currentTimeStuckAt=it)},5e3),async function(rt){const it=["click","contextmenu","auxclick","dblclick","mousedown","mouseup","touchend","keydown","keyup"];let ct,ut=!1,pt=!1,mt=!1;function _t($t){rt.state==="running"?vt(!1):Tu()||Sm()?rt.state==="suspended"&&(vt(!0),$t&&rt.resume().then(Tt,Tt)):rt.state!=="closed"&&(vt(!0),$t&&rt.resume().then(Tt,Tt))}function vt($t){if(ut!==$t){ut=$t;for(let Ht=0,en=it;Ht<en.length;Ht+=1){const Qt=en[Ht];$t?window.addEventListener(Qt,bt,{capture:!0,passive:!0}):window.removeEventListener(Qt,bt,{capture:!0,passive:!0})}}}function Tt(){_t(!1)}function bt(){_t(!0)}function Ot($t){if(!mt)if(ct.paused)if($t){let Ht;Mt(!1),mt=!0;try{Ht=ct.play(),Ht?Ht.then(Dt,Dt):(ct.addEventListener("playing",Dt),ct.addEventListener("abort",Dt),ct.addEventListener("error",Dt))}catch{Dt()}}else Mt(!0);else Mt(!1)}function Mt($t){if(pt!==$t){pt=$t;for(let Ht=0,en=it;Ht<en.length;Ht++){const Qt=en[Ht];$t?window.addEventListener(Qt,jt,{capture:!0,passive:!0}):window.removeEventListener(Qt,jt,{capture:!0,passive:!0})}}}function Dt(){ct.removeEventListener("playing",Dt),ct.removeEventListener("abort",Dt),ct.removeEventListener("error",Dt),mt=!1,Ot(!1)}function jt(){Ot(!0)}if(Tu()){const $t=rt.createMediaStreamDestination(),Ht=document.createElement("div");Ht.innerHTML="<audio x-webkit-airplay='deny'></audio>",ct=Ht.children.item(0),ct.controls=!1,ct.disableRemotePlayback=!0,ct.preload="auto",ct.srcObject=$t.stream,Ot(!0)}rs.on(Kl.STATE_CHANGE,function(){_t(!0)}),_t(!1)}(Bp)}(),!Bp)throw new Yn(tn.NOT_SUPPORTED,"can not create audio context");return Bp}return Bp}function S0(_e){if(function(){if(jO!==null)return jO;const ct=bS(),ut=ct.createBufferSource(),pt=ct.createGain(),mt=ct.createGain();ut.connect(pt),ut.connect(mt),ut.disconnect(pt);let _t=!1;try{ut.disconnect(pt)}catch{_t=!0}return ut.disconnect(),jO=_t,_t}())return;const rt=_e.connect,it=_e.disconnect;_e.connect=(ct,ut,pt)=>{var mt;return _e._inputNodes||(_e._inputNodes=[]),Er(mt=_e._inputNodes).call(mt,ct)||(ct instanceof AudioNode?(_e._inputNodes.push(ct),rt.call(_e,ct,ut,pt)):rt.call(_e,ct,ut)),_e},_e.disconnect=(ct,ut,pt)=>{it.call(_e),ct?hw(_e._inputNodes,ct):_e._inputNodes=[];for(const mt of _e._inputNodes)rt.call(_e,mt)}}let jO=null;function zO(_e,rt){let it=!1;const ct=1/rt;if(rn("DISABLE_WEBAUDIO")){const ut=window.setInterval(()=>{it?window.clearInterval(ut):_e(performance.now()/1e3)},1e3*ct)}else{const ut=bS();let pt=ut.createGain();pt.gain.value=0,pt.connect(ut.destination);const mt=()=>{if(it)return void(pt=null);const _t=ut.createOscillator();_t.onended=mt,_t.connect(pt),_t.start(0),_t.stop(ut.currentTime+ct),_e(ut.currentTime)};mt()}return()=>{it=!0}}class hB{constructor(){Fn(this,"context",void 0),Fn(this,"analyserNode",void 0),Fn(this,"sourceNode",void 0),this.context=bS(),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4}updateSource(rt){if(rt!==this.sourceNode){if(this.sourceNode)try{this.sourceNode.disconnect(this.analyserNode)}catch{}this.sourceNode=rt,rt==null||rt.connect(this.analyserNode)}}getVolumeLevel(){if(!this.sourceNode||(!this.context||Tu()||Sm()||this.context.state!=="running"&&this.context.resume(),!this.analyserNode))return 0;const rt=new Float32Array(this.analyserNode.fftSize);if(this.analyserNode.getFloatTimeDomainData)this.analyserNode.getFloatTimeDomainData(rt);else{const ct=new Uint8Array(this.analyserNode.fftSize);this.analyserNode.getByteTimeDomainData(ct);for(let ut=0;ut<rt.length;++ut)rt[ut]=ct[ut]/128-1}const it=_p(rt).call(rt,(ct,ut)=>ct+ut*ut,0)/rt.length;return Math.max(10*Math.log10(it)+100,0)/100}getAnalyserNode(){return this.analyserNode}rebuildAnalyser(){try{var rt,it;(rt=this.sourceNode)===null||rt===void 0||rt.disconnect(this.analyserNode),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4,(it=this.sourceNode)===null||it===void 0||it.connect(this.analyserNode)}catch{Ut.warning("rebuild analyser node failed.")}}destroy(){this.updateSource(void 0)}}class pB extends Fs{get processSourceNode(){return this.sourceNode}set processedNode(rt){var it;if(!this.isDestroyed&&this._processedNode!==rt){try{var ct;(ct=this.sourceNode)===null||ct===void 0||ct.disconnect(this.outputNode)}catch{}(it=this._processedNode)===null||it===void 0||it.disconnect(),this._processedNode=rt,this.connect()}}get processedNode(){return this._processedNode}constructor(){super(),Fn(this,"outputNode",void 0),Fn(this,"outputTrack",void 0),Fn(this,"isPlayed",!1),Fn(this,"sourceNode",void 0),Fn(this,"context",void 0),Fn(this,"audioBufferNode",void 0),Fn(this,"destNode",void 0),Fn(this,"audioOutputLevel",0),Fn(this,"volumeLevelAnalyser",void 0),Fn(this,"_processedNode",void 0),Fn(this,"playNode",void 0),Fn(this,"isDestroyed",!1),Fn(this,"onNoAudioInput",void 0),Fn(this,"isNoAudioInput",!1),Fn(this,"_noAudioInputCount",0),this.context=bS(),this.playNode=this.context.destination,this.outputNode=this.context.createGain(),S0(this.outputNode),this.volumeLevelAnalyser=new hB}startGetAudioBuffer(rt){this.audioBufferNode||(this.audioBufferNode=this.context.createScriptProcessor(rt),this.outputNode.connect(this.audioBufferNode),this.audioBufferNode.connect(this.context.destination),this.audioBufferNode.onaudioprocess=it=>{this.emit(kp.ON_AUDIO_BUFFER,function(ct){for(let ut=0;ut<ct.outputBuffer.numberOfChannels;ut+=1){const pt=ct.outputBuffer.getChannelData(ut);for(let mt=0;mt<pt.length;mt+=1)pt[mt]=0}return ct.inputBuffer}(it))})}stopGetAudioBuffer(){this.audioBufferNode&&(this.audioBufferNode.onaudioprocess=null,this.outputNode.disconnect(this.audioBufferNode),this.audioBufferNode=void 0)}createOutputTrack(){if(!Fo().webAudioMediaStreamDest)throw new Yn(tn.NOT_SUPPORTED,"your browser is not support audio processor");return this.destNode&&this.outputTrack||(this.destNode=this.context.createMediaStreamDestination(),this.outputNode.connect(this.destNode),this.outputTrack=this.destNode.stream.getAudioTracks()[0]),this.outputTrack}play(rt){this.context.state!=="running"&&pw(()=>{rs.emit("autoplay-failed")}),this.isPlayed=!0,this.playNode=rt||this.context.destination,this.outputNode.connect(this.playNode)}stop(){if(this.isPlayed)try{this.outputNode.disconnect(this.playNode)}catch{}this.isPlayed=!1}getAccurateVolumeLevel(){return this.volumeLevelAnalyser.getVolumeLevel()}async checkHasAudioInput(){let rt=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;if(rt>5)return this.isNoAudioInput=!0,this.onNoAudioInput&&this.onNoAudioInput(),!1;Tu()||Sm()?this.context.state==="suspended"&&this.context.resume():this.context.state!=="running"&&this.context.resume();const it=this.volumeLevelAnalyser.getAnalyserNode();let ct;it.getFloatTimeDomainData?(ct=new Float32Array(it.fftSize),it.getFloatTimeDomainData(ct)):(ct=new Uint8Array(it.fftSize),it.getByteTimeDomainData(ct));let ut=!1;for(let pt=0;pt<ct.length;pt++)ct[pt]!==0&&(ut=!0);return ut?(this.isNoAudioInput=!1,!0):(await zl(200),await this.checkHasAudioInput(rt?rt+1:1)&&ut)}getAudioVolume(){return this.outputNode.gain.value}setVolume(rt){this.outputNode.gain.setValueAtTime(rt,this.context.currentTime)}destroy(){this.disconnect(),this.stop(),this.isDestroyed=!0,this.onNoAudioInput=void 0}disconnect(){var rt,it;(rt=this.processedNode)===null||rt===void 0||rt.disconnect(),(it=this.sourceNode)===null||it===void 0||it.disconnect(),this.outputNode&&this.outputNode.disconnect()}connect(){var rt;this.processedNode?(rt=this.processedNode)===null||rt===void 0||rt.connect(this.outputNode):this.sourceNode&&this.sourceNode.connect(this.outputNode),this.volumeLevelAnalyser.updateSource(this.outputNode)}}class fB extends pB{get isFreeze(){return!1}constructor(rt,it,ct){var ut;if(super(),Fn(this,"sourceNode",void 0),Fn(this,"track",void 0),Fn(this,"clonedTrack",void 0),Fn(this,"audioElement",void 0),Fn(this,"isCurrentTrackCloned",!1),Fn(this,"isRemoteTrack",!1),Fn(this,"originVolumeLevelAnalyser",void 0),Fn(this,"rebuildWebAudio",async()=>{if(Ut.debug("ready to rebuild web audio, state:",this.context.state),this.isNoAudioInput&&await this.checkHasAudioInput(),!this.isNoAudioInput||this.isDestroyed)return document.body.removeEventListener("click",this.rebuildWebAudio,!0),void Ut.debug("rebuild web audio success, current volume status",this.getAccurateVolumeLevel());this.context.resume().then(()=>Ut.info("resume success")),Ut.debug("rebuild web audio because of ios 12 bugs"),this.disconnect();const _t=this.track;this.track=this.track.clone(),this.isCurrentTrackCloned?_t.stop():this.isCurrentTrackCloned=!0;const vt=new MediaStream([this.track]);this.sourceNode=this.context.createMediaStreamSource(vt),S0(this.sourceNode),this.volumeLevelAnalyser.rebuildAnalyser();const Tt=this.outputNode.gain.value;this.outputNode=this.context.createGain(),this.outputNode.gain.setValueAtTime(Tt,this.context.currentTime),S0(this.outputNode),this.emit(kp.UPDATE_SOURCE),this.connect(),this.audioElement.srcObject=vt,this.isPlayed&&this.play(this.playNode),this.checkHasAudioInput()}),rt.kind!=="audio")throw new Yn(tn.UNEXPECTED_ERROR);this.track=rt;const pt=new MediaStream([this.track]);if(this.isRemoteTrack=!!it,this.sourceNode=this.context.createMediaStreamSource(pt),S0(this.sourceNode),ct){const _t=ct.clone();_t.enabled=!0,this.clonedTrack=_t,Ut.debug("create an unmuted track ".concat(_t.id," from the original track ").concat(ct.id," to get the volume"));const vt=this.context.createMediaStreamSource(new MediaStream([_t]));S0(vt),this.originVolumeLevelAnalyser=new hB,this.originVolumeLevelAnalyser.updateSource(vt)}this.connect(),this.audioElement=document.createElement("audio"),this.audioElement.srcObject=pt;const mt=No();it&&mt.os===Nl.IOS&&Number((ut=mt.osVersion)===null||ut===void 0?void 0:ut.split(".")[0])<15&&(rs.on(Kl.STATE_CHANGE,()=>{this.context.state==="suspended"?document.body.addEventListener("click",this.rebuildWebAudio,!0):this.context.state==="running"&&this.rebuildWebAudio()}),this.checkHasAudioInput().then(_t=>{_t||document.body.addEventListener("click",this.rebuildWebAudio,!0)}))}updateTrack(rt){this.sourceNode.disconnect(),this.track=rt,this.isCurrentTrackCloned=!1;const it=new MediaStream([rt]);this.sourceNode=this.context.createMediaStreamSource(it),S0(this.sourceNode),this.processedNode||this.sourceNode.connect(this.outputNode),this.emit(kp.UPDATE_SOURCE),this.audioElement.srcObject=it}destroy(){var rt;this.audioElement.srcObject=null,this.audioElement.remove(),rs.off("state-change",this.rebuildWebAudio),(rt=this.originVolumeLevelAnalyser)===null||rt===void 0||rt.destroy(),this.clonedTrack=void 0,super.destroy()}createMediaStreamSourceNode(rt){return this.context.createMediaStreamSource(new MediaStream([rt]))}updateOriginTrack(rt){const it=rt.clone();it.enabled=!0,this.clonedTrack&&(this.clonedTrack.stop(),this.clonedTrack=it),Ut.debug("create an unmuted track ".concat(it.id," from the original track ").concat(rt.id," to get the volume"));const ct=this.context.createMediaStreamSource(new MediaStream([it]));S0(ct),this.originVolumeLevelAnalyser&&this.originVolumeLevelAnalyser.updateSource(ct)}getOriginVolumeLevel(){return this.originVolumeLevelAnalyser?this.originVolumeLevelAnalyser.getVolumeLevel():this.getAccurateVolumeLevel()}}async function mB(_e,rt,it){const ct=(pt,mt)=>pt?typeof pt!="number"?pt.max||pt.exact||pt.ideal||pt.min||mt:pt:mt,ut={audio:!!it&&{mandatory:{chromeMediaSource:"desktop"}},video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:_e,maxHeight:ct(rt.height,1080),maxWidth:ct(rt.width,1920)}}};return rt.frameRate&&typeof rt.frameRate!="number"?(ut.video.mandatory.maxFrameRate=rt.frameRate.max,ut.video.mandatory.minFrameRate=rt.frameRate.min):typeof rt.frameRate=="number"&&(ut.video.mandatory.maxFrameRate=rt.frameRate),await navigator.mediaDevices.getUserMedia(ut)}async function DY(_e,rt){const it=await gB(_e.mediaSource),{sourceId:ct,audio:ut}=await function(pt){let mt=arguments.length>1&&arguments[1]!==void 0&&arguments[1];return new Ir((_t,vt)=>{const Tt=document.createElement("div");Tt.innerText="share screen",Tt.setAttribute("style","text-align: center; height: 25px; line-height: 25px; border-radius: 4px 4px 0 0; background: #D4D2D4; border-bottom:  solid 1px #B9B8B9;");const bt=document.createElement("div");bt.setAttribute("style","width: 100%; height: 500px; padding: 15px 25px ; box-sizing: border-box;");const Ot=document.createElement("div");Ot.innerText="Agora Web Screensharing wants to share the contents of your screen with webdemo.agorabeckon.com. Choose what you'd like to share.",Ot.setAttribute("style","height: 12%;");const Mt=document.createElement("div");Mt.setAttribute("style","width: 100%; height: 80%; background: #FFF; border:  solid 1px #CBCBCB; display: flex; flex-wrap: wrap; justify-content: space-around; overflow-y: scroll; padding: 0 15px; box-sizing: border-box;");const Dt=document.createElement("div");Dt.setAttribute("style","display: flex; justify-content: space-between; padding: 16px 0;");const jt=document.createElement("button");jt.innerHTML="cancel",jt.setAttribute("style","width: 85px;"),jt.onclick=()=>{document.body.removeChild(en);const Qt=new Error("NotAllowedError");Qt.name="NotAllowedError",vt(Qt)};let $t=mt;const Ht=document.createElement("div");if(mt){const Qt=document.createElement("input");Qt.setAttribute("type","checkbox");const on=document.createElement("span");Qt.setAttribute("style","margin-right: 6px;"),on.innerText="Share audio",Qt.checked=$t,Qt.onchange=()=>{$t=Qt.checked},Ht.appendChild(Qt),Ht.appendChild(on)}Dt.appendChild(Ht),Dt.appendChild(jt),bt.appendChild(Ot),bt.appendChild(Mt),bt.appendChild(Dt);const en=document.createElement("div");en.setAttribute("style","position: fixed; z-index: 99999999; top: 50%; left: 50%; width: 620px; height: 525px; background: #ECECEC; border-radius: 4px; -webkit-transform: translate(-50%,-50%); transform: translate(-50%,-50%);"),en.appendChild(Tt),en.appendChild(bt),document.body.appendChild(en),pt.map(Qt=>{if(Qt.id){const on=document.createElement("div");on.setAttribute("style","width: 30%; height: 160px; padding: 20px 0; text-align: center;box-sizing: content-box;");let Tn=Qt.thumbnail;try{const{width:vn}=Tn.getSize();vn>1920&&(Tn=Tn.resize({width:1920}))}catch(vn){throw vn&&vn.message.startsWith("Illegal invocation")&&console.error("Operate thumbnail error, please try to set contextIsolation: false. (https://github.com/electron/electron/issues/34953)"),vn}on.innerHTML='<div style="height: 120px; display: table-cell; vertical-align: middle;"><img style="width: 100%; background: #333333; box-shadow: 1px 1px 1px 1px rgba(0, 0, 0, 0.2);" src='+Tn.toDataURL()+' /></div><span style="	height: 40px; line-height: 40px; display: inline-block; width: 70%; word-break: keep-all; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+Qt.name.replace(/[\u00A0-\u9999<>\&]/g,function(vn){return"&#"+vn.charCodeAt(0)+";"})+"</span>",on.onclick=()=>{document.body.removeChild(en),_t({sourceId:Qt.id,audio:$t})},Mt.appendChild(on)}})})}(it,rt);return await mB(ct,_e,ut)}async function gB(_e){let rt=["window","screen"];_e!=="application"&&_e!=="window"||(rt=["window"]),_e==="screen"&&(rt=["screen"]);const it=I3();if(!it)throw console.error("failed to fetch electron, please mount it to window"),new Yn(tn.ELECTRON_IS_NULL);let ct=null;try{var ut;ct=((ut=it.desktopCapturer)===null||ut===void 0?void 0:ut.getSources({types:rt}))||it.ipcRenderer.invoke("DESKTOP_CAPTURER_GET_SOURCES",{types:rt})}catch{ct=null}ct&&ct.then||(ct=new Ir((pt,mt)=>{it.desktopCapturer.getSources({types:rt},(_t,vt)=>{_t?mt(_t):pt(vt)})}));try{return await ct}catch(pt){throw new Yn(tn.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR,pt.toString())}}const WO=new lu("safari");let _B=!1,EB=!1;async function Fp(_e,rt){let it=0,ct=null;for(;it<2;)try{ct=await LY(_e,rt,it>0);break}catch(ut){if(ut instanceof Yn)throw Ut.error("[".concat(rt,"] ").concat(ut.toString())),ut;const pt=Cw(ut.name||ut.code||ut,ut.message);if(pt.code===tn.MEDIA_OPTION_INVALID){Ut.debug("[".concat(rt,"] detect media option invalid, retry")),it+=1,await zl(500);continue}throw Ut.error("[".concat(rt,"] ").concat(pt.toString())),pt}if(!ct)throw new Yn(tn.UNEXPECTED_ERROR,"can not find stream after getUserMedia");return ct}async function LY(_e,rt,it){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new Yn(tn.NOT_SUPPORTED,"can not find getUserMedia");it&&(_e.video&&(delete _e.video.width,delete _e.video.height),_e.screen&&(delete _e.screen.width,delete _e.screen.height));const ct=Fo(),ut=new MediaStream;if(_e.audioSource&&ut.addTrack(_e.audioSource),_e.videoSource&&ut.addTrack(_e.videoSource),!_e.audio&&!_e.video&&!_e.screen)return Ut.debug("Using Video Source/ Audio Source"),ut;if(_e.screen)if(I3())_e.screen.sourceId?RS(ut,await mB(_e.screen.sourceId,_e.screen,!!_e.screenAudio)):RS(ut,await DY(_e.screen,!!_e.screenAudio));else if(dE()&&_e.screen.extensionId&&_e.screen.mandatory){if(!ct.getStreamFromExtension)throw new Yn(tn.NOT_SUPPORTED,"This browser does not support screen sharing");Ut.debug("[".concat(rt,'] Screen access on chrome stable, looking for extension"'));const Mt=await(mt=_e.screen.extensionId,_t=rt,new Ir((Dt,jt)=>{try{chrome.runtime.sendMessage(mt,{getStream:!0},$t=>{if(!$t||!$t.streamId)return Ut.error("[".concat(_t,"] No response from Chrome Plugin. Plugin not installed properly"),$t),void jt(new Yn(tn.CHROME_PLUGIN_NO_RESPONSE,"No response from Chrome Plugin. Plugin not installed properly"));Dt($t.streamId)})}catch($t){Ut.error("[".concat(_t,"] AgoraRTC screensharing plugin is not accessible(").concat(mt,")"),$t.toString()),jt(new Yn(tn.CHROME_PLUGIN_NOT_INSTALL))}}));_e.screen.mandatory.chromeMediaSourceId=Mt,RS(ut,await navigator.mediaDevices.getUserMedia({video:{mandatory:_e.screen.mandatory}}))}else if(ct.getDisplayMedia){var pt;_e.screen.mediaSource&&sB(_e.screen.mediaSource);const Mt={width:_e.screen.width,height:_e.screen.height,frameRate:_e.screen.frameRate,displaySurface:(pt=_e.screen.displaySurface)!==null&&pt!==void 0?pt:_e.screen.mediaSource==="screen"?"monitor":_e.screen.mediaSource},{selfBrowserSurface:Dt,surfaceSwitching:jt,systemAudio:$t,preferCurrentTab:Ht}=_e.screen,en={selfBrowserSurface:Dt,surfaceSwitching:jt,systemAudio:$t,preferCurrentTab:Ht};!Dt&&delete en.selfBrowserSurface,!jt&&delete en.surfaceSwitching,!$t&&delete en.systemAudio,!Ht&&delete en.preferCurrentTab,Ut.debug("[".concat(rt,"] getDisplayMedia:"),JSON.stringify({video:Mt,audio:_e.screenAudio,controls:en})),RS(ut,await navigator.mediaDevices.getDisplayMedia(Ss({video:Mt,audio:_e.screenAudio},en)))}else{if(!Gs())throw Ut.error("[".concat(rt,"] This browser does not support screenSharing")),new Yn(tn.NOT_SUPPORTED,"This browser does not support screen sharing");{_e.screen.mediaSource&&sB(_e.screen.mediaSource);const Mt={video:{mediaSource:_e.screen.mediaSource,width:_e.screen.width,height:_e.screen.height,frameRate:_e.screen.frameRate}};Ut.debug("[".concat(rt,"] getUserMedia: ").concat(JSON.stringify(Mt))),RS(ut,await navigator.mediaDevices.getUserMedia(Mt))}}var mt,_t;if(!_e.video&&!_e.audio)return ut;let vt={video:_e.video,audio:_e.audio},Tt=rn("MEDIA_DEVICE_CONSTRAINTS");if(Tt)try{typeof Tt=="string"&&(Tt=JSON.parse(Tt)),vt=TO(vt,Tt)}catch{}Ut.debug("[".concat(rt,"] GetUserMedia"),JSON.stringify(vt)),No();let bt,Ot=null;(tu()||Tu()||uw())&&(Ot=await WO.lock());try{bt=await navigator.mediaDevices.getUserMedia(vt)}catch(Mt){throw Ot&&Ot(),Mt}return vt.audio&&(_B=!0),vt.video&&(EB=!0),RS(ut,bt),Ot&&Ot(),ut}function Cw(_e,rt){switch(_e){case"Starting video failed":case"OverconstrainedError":case"TrackStartError":return new Yn(tn.MEDIA_OPTION_INVALID,"".concat(_e,": ").concat(rt));case"NotFoundError":case"DevicesNotFoundError":return new Yn(tn.DEVICE_NOT_FOUND,"".concat(_e,": ").concat(rt));case"NotSupportedError":return new Yn(tn.NOT_SUPPORTED,"".concat(_e,": ").concat(rt));case"NotReadableError":return new Yn(tn.NOT_READABLE,"".concat(_e,": ").concat(rt));case"InvalidStateError":case"NotAllowedError":case"PERMISSION_DENIED":case"PermissionDeniedError":return new Yn(tn.PERMISSION_DENIED,"".concat(_e,": ").concat(rt));case"ConstraintNotSatisfiedError":return new Yn(tn.CONSTRAINT_NOT_SATISFIED,"".concat(_e,": ").concat(rt));default:return Ut.error("getUserMedia unexpected error",_e),new Yn(tn.UNEXPECTED_ERROR,"".concat(_e,": ").concat(rt))}}function RS(_e,rt){const it=_e.getVideoTracks()[0],ct=_e.getAudioTracks()[0],ut=rt.getVideoTracks()[0],pt=rt.getAudioTracks()[0];pt&&(ct&&_e.removeTrack(ct),_e.addTrack(pt)),ut&&(it&&_e.removeTrack(it),_e.addTrack(ut))}const Vp=new class extends Fs{get state(){return this._state}set state(_e){_e!==this._state&&(this.emit(y0.STATE_CHANGE,_e),this._state=_e)}constructor(){super(),Fn(this,"_state",yA.IDLE),Fn(this,"isAccessMicrophonePermission",!1),Fn(this,"isAccessCameraPermission",!1),Fn(this,"lastAccessMicrophonePermission",!1),Fn(this,"lastAccessCameraPermission",!1),Fn(this,"checkdeviceMatched",!1),Fn(this,"deviceInfoMap",new Map),this.init().then(()=>{navigator.mediaDevices.addEventListener&&navigator.mediaDevices.addEventListener("devicechange",this.updateDevicesInfo.bind(this)),window.setInterval(()=>{(rn("ENUMERATE_DEVICES_INTERVAL")||(dw()||lw()===Nl.HARMONY_OS)&&hE())&&this.updateDevicesInfo()},rn("ENUMERATE_DEVICES_INTERVAL_TIME"))}).catch(_e=>Ut.error(_e.toString()))}async enumerateDevices(_e,rt){let it=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)return new Yn(tn.NOT_SUPPORTED,"enumerateDevices() not supported.").throw();const ct=await navigator.mediaDevices.enumerateDevices(),ut=this.checkMediaDeviceInfoIsOk(ct);let pt=!this.isAccessMicrophonePermission&&_e,mt=!this.isAccessCameraPermission&&rt;ut.audio&&(pt=!1),ut.video&&(mt=!1);let _t=null,vt=null,Tt=null;if(!it&&(pt||mt)){if(WO.isLocked&&(Ut.debug("[device manager] wait GUM lock"),(await WO.lock())(),Ut.debug("[device manager] GUM unlock")),_B&&(pt=!1,this.isAccessMicrophonePermission=!0),EB&&(mt=!1,this.isAccessCameraPermission=!0),Ut.debug("[device manager] check media device permissions",_e,rt,pt,mt),pt&&mt){try{Tt=await navigator.mediaDevices.getUserMedia({audio:!0,video:!0})}catch(bt){const Ot=Cw(bt.name||bt.code||bt,bt.message);if(Ot.code===tn.PERMISSION_DENIED)throw Ot;Ut.warning("getUserMedia failed in getDevices",Ot)}this.isAccessCameraPermission=!0,this.isAccessMicrophonePermission=!0}else if(pt){try{_t=await navigator.mediaDevices.getUserMedia({audio:_e})}catch(bt){const Ot=Cw(bt.name||bt.code||bt,bt.message);if(Ot.code===tn.PERMISSION_DENIED)throw Ot;Ut.warning("getUserMedia failed in getDevices",Ot)}this.isAccessMicrophonePermission=!0}else if(mt){try{vt=await navigator.mediaDevices.getUserMedia({video:rt})}catch(bt){const Ot=Cw(bt.name||bt.code||bt,bt.message);if(Ot.code===tn.PERMISSION_DENIED)throw Ot;Ut.warning("getUserMedia failed in getDevices",Ot)}this.isAccessCameraPermission=!0}Ut.debug("[device manager] mic permission",_e,"cam permission",rt)}try{const bt=await navigator.mediaDevices.enumerateDevices();return _t&&_t.getTracks().forEach(Ot=>Ot.stop()),vt&&vt.getTracks().forEach(Ot=>Ot.stop()),Tt&&Tt.getTracks().forEach(Ot=>Ot.stop()),_t=null,vt=null,Tt=null,bt}catch(bt){return _t&&_t.getTracks().forEach(Ot=>Ot.stop()),vt&&vt.getTracks().forEach(Ot=>Ot.stop()),Tt&&Tt.getTracks().forEach(Ot=>Ot.stop()),_t=null,vt=null,Tt=null,new Yn(tn.ENUMERATE_DEVICES_FAILED,bt.toString()).throw()}}async getRecordingDevices(){let _e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,_e)).filter(rt=>rt.kind==="audioinput")}async getCamerasDevices(){let _e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!1,!0,_e)).filter(rt=>rt.kind==="videoinput")}async getSpeakers(){let _e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,_e)).filter(rt=>rt.kind==="audiooutput")}searchDeviceIdByName(_e){let rt=null;return this.deviceInfoMap.forEach(it=>{it.device.label===_e&&(rt=it.device.deviceId)}),rt}async getDeviceById(_e){const rt=(await this.enumerateDevices(!0,!0,!0)).find(it=>it.deviceId===_e);if(!rt)throw new Yn(tn.DEVICE_NOT_FOUND,"deviceId: ".concat(_e));return rt}async init(){this.state=yA.INITING;try{await this.updateDevicesInfo(),this.state=yA.INITEND}catch(_e){throw Ut.warning("Device Detection functionality cannot start properly.",_e.toString()),this.state=yA.IDLE,(typeof isSecureContext=="boolean"?isSecureContext:location.protocol==="https:"||location.protocol==="file:"||location.hostname==="localhost"||location.hostname==="127.0.0.1"||location.hostname==="::1")||new Yn(tn.WEB_SECURITY_RESTRICT,"Your context is limited by web security, please try using https protocol or localhost.").throw(),_e}}async updateDevicesInfo(){const _e=await this.enumerateDevices(!0,!0,!0),rt=Date.now(),it=[];if(_e[0]&&_e[0].label&&this.checkdeviceMatched===!1){this.checkdeviceMatched=!0;const ut=_e.find(mt=>mt.kind==="audioinput"&&mt.deviceId==="default"),pt=_e.find(mt=>mt.kind==="audiooutput"&&mt.deviceId==="default");ut&&pt?pt.groupId===ut.groupId?Ut.debug("[device-check] default input ".concat(ut.label," and output ").concat(pt.label," is the same group")):Ut.debug("[device-check] default input ".concat(ut.label," and output ").concat(pt.label," is not the same group")):Ut.debug("[device-check] default input or output not found")}const ct=this.checkMediaDeviceInfoIsOk(_e);if(_e.forEach(ut=>{if(!ut.deviceId)return;const pt=this.deviceInfoMap.get("".concat(ut.kind,"_").concat(ut.deviceId));if((pt?pt.state:"INACTIVE")!=="ACTIVE"){const mt={initAt:rt,updateAt:rt,device:ut,state:"ACTIVE"};this.deviceInfoMap.set("".concat(ut.kind,"_").concat(ut.deviceId),mt),it.push(mt)}pt&&(pt.updateAt=rt)}),this.deviceInfoMap.forEach((ut,pt)=>{ut.state==="ACTIVE"&&ut.updateAt!==rt&&(ut.state="INACTIVE",it.push(ut))}),this.state!==yA.INITEND)return ct.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),void(ct.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0));it.forEach(ut=>{switch(ut.device.kind){case"audioinput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(y0.RECORDING_DEVICE_CHANGED,ut);break;case"videoinput":this.lastAccessCameraPermission&&this.isAccessCameraPermission&&this.emit(y0.CAMERA_DEVICE_CHANGED,ut);break;case"audiooutput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(y0.PLAYOUT_DEVICE_CHANGED,ut)}}),ct.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),ct.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0)}checkMediaDeviceInfoIsOk(_e){const rt=_e.filter(ut=>ut.kind==="audioinput"),it=_e.filter(ut=>ut.kind==="videoinput"),ct={audio:!1,video:!1};for(const ut of rt)if(ut.label&&ut.deviceId){ct.audio=!0;break}for(const ut of it)if(ut.label&&ut.deviceId){ct.video=!0;break}return ct}};let KO=!1;const Gp=new class extends Fs{constructor(){super(...arguments),Fn(this,"onAutoplayFailed",void 0),Fn(this,"onAudioAutoplayFailed",void 0)}};function vB(){if(No(),!KO){const _e=rt=>{rt.preventDefault(),KO=!1,uA()?document.body.removeEventListener("click",_e,!0):(document.body.removeEventListener("touchstart",_e,!0),document.body.removeEventListener("mousedown",_e,!0))};KO=!0,uA()?document.body.addEventListener("click",_e,!0):(document.body.addEventListener("touchstart",_e,!0),document.body.addEventListener("mousedown",_e,!0)),Ut.info("detect media autoplay failed, document: https://docs.agora.io/cn/Voice/autoplay_policy_web_ng?platform=Web"),Gp.onAutoplayFailed?Gp.onAutoplayFailed():Gp.onAudioAutoplayFailed?Ut.warning(`AgoraRTC.onAudioAutoplayFailed has been deprecated in favor of AgoraRTC.onAutoplayFailed.

  Please refer to the Agora document to migrate the newer API, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`):Ut.warning(`We have detected a media autoplay failed event, and found out that you haven't implemented AgoraRTC.onAutoplayFailed callback yet.

  It will cause audio/video element not playing automatically on some browsers without user interaction, possibly hurting user experiences.

  Please refer to the Agora document to properly handle autoplay failed event, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`),Gp.emit("autoplay-failed")}}function yB(_e,rt,it,ct){if(!_e)return;const ut=Vr.getBaseInfoBySessionId(_e);if(!ut)return;const pt=ut.info,mt=Date.now(),_t=Ss(Ss({},pt),{},{vid:pt.vid===void 0?0:Number(pt.vid),lts:mt,elapse:mt-ut.startTime,cbRegistered:Gp.onAutoplayFailed||Gp.onAudioAutoplayFailed?1:-1,errorMsg:it,mediaType:rt,trackId:ct,extend:void 0});Vr.send({type:Os.AUTOPLAY_FAILED,data:_t},!0)}const kY=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","error"],qu=new class{constructor(){Fn(this,"onAutoplayFailed",void 0),Fn(this,"elementMap",new Map),Fn(this,"elementStateMap",new Map),Fn(this,"elementsNeedToResume",[]),Fn(this,"sinkIdMap",new Map),Fn(this,"autoResumeAfterInterruption",_e=>{Array.from(this.elementMap.entries()).forEach(rt=>{let[it,ct]=rt;const ut=this.elementStateMap.get(it),pt=ct.srcObject.getAudioTracks()[0],mt=pt&&pt.readyState;if(Ut.debug("resume after interrupted, ele: ".concat(ut," audio: ").concat(mt," ").concat(_e)),mt==="live"){if(_e)return ct.pause(),void ct.play();if(rs.curState==="running")return hS()?(ct.pause(),void ct.play()):void(ut&&ut==="paused"&&ct.play())}})}),Fn(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{Array.from(this.elementMap.entries()).forEach(_e=>{let[rt,it]=_e;const ct=it.srcObject.getAudioTracks()[0];ct&&ct.readyState==="live"&&(Ut.debug("auto resume after interruption inside autoResumeAfterInterruptionOnIOS15"),it.pause(),it.play())})}),this.autoResumeAudioElement(),rs.on(Kl.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),rs.on(Kl.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),rs.on(Kl.STATE_CHANGE,()=>{Tu()&&rs.prevState==="suspended"&&rs.curState==="running"&&this.autoResumeAfterInterruption()})}async setSinkID(_e,rt){const it=this.elementMap.get(_e);if(this.sinkIdMap.set(_e,rt),it)try{await it.setSinkId(rt)}catch(ct){throw new Yn(tn.PERMISSION_DENIED,"can not set sink id: "+ct.toString())}}play(_e,rt,it,ct){if(this.elementMap.has(rt))return;const ut=document.createElement("audio");ut.autoplay=!0,ut.srcObject=new MediaStream([_e]),this.bindAudioElementEvents(rt,ut),this.elementMap.set(rt,ut),this.elementStateMap.set(rt,uu.INIT),this.setVolume(rt,it);const pt=this.sinkIdMap.get(rt);if(pt)try{ut.setSinkId(pt).catch(_t=>{Ut.warning("[".concat(rt,"] set sink id failed"),_t.toString())})}catch(_t){Ut.warning("[".concat(rt,"] set sink id failed"),_t.toString())}const mt=ut.play();mt&&mt.then&&mt.catch(_t=>{ct&&yB(ct,"audio",_t.message,rt),Ut.warning("audio element play warning",_t.toString()),this.elementMap.has(rt)&&_t.name==="NotAllowedError"&&(Ut.warning("detected audio element autoplay failed"),this.elementsNeedToResume.push(ut),pw(()=>{this.onAutoplayFailed&&this.onAutoplayFailed(),vB()}))})}updateTrack(_e,rt){const it=this.elementMap.get(_e);it&&(it.srcObject=new MediaStream([rt]))}isPlaying(_e){return this.elementMap.has(_e)&&this.elementStateMap.get(_e)==="playing"}setVolume(_e,rt){const it=this.elementMap.get(_e);it&&(rt=Math.max(0,Math.min(100,rt)),it.volume=rt/100)}stop(_e){const rt=this.elementMap.get(_e);if(this.sinkIdMap.delete(_e),!rt)return;const it=this.elementsNeedToResume.indexOf(rt);this.elementsNeedToResume.splice(it,1),rt.srcObject=null,rt.remove(),this.elementMap.delete(_e),this.elementStateMap.delete(_e)}bindAudioElementEvents(_e,rt){kY.forEach(it=>{rt.addEventListener(it,ct=>{const ut=this.elementStateMap.get(_e),pt=ct.type==="pause"?"paused":ct.type;if(Ut.debug("[".concat(_e,"] audio-element-status change ").concat(ut," => ").concat(pt)),ct.type==="error"){const mt=rt==null?void 0:rt.error;mt&&Ut.error("[".concat(_e,"] media error, code: ").concat(mt.code,", message: ").concat(mt.message))}this.elementStateMap.set(_e,pt)})})}getPlayerState(_e){return this.elementStateMap.get(_e)||"uninit"}autoResumeAudioElement(){const _e=()=>{this.elementsNeedToResume.forEach(rt=>{rt.play().then(it=>{Ut.debug("Auto resume audio element success")}).catch(it=>{Ut.warning("Auto resume audio element failed!",it)})}),this.elementsNeedToResume=[]};new Ir(rt=>{document.body?rt():window.addEventListener("load",()=>rt())}).then(()=>{uA()?document.body.addEventListener("click",_e,!0):(document.body.addEventListener("touchstart",_e,!0),document.body.addEventListener("mousedown",_e,!0))})}};function zs(){return function(_e,rt,it){const ct=it.value;return typeof ct=="function"&&(it.value=function(){this._isClosed&&new Yn(tn.INVALID_OPERATION,"[".concat(this.getTrackId(),"] cannot operate a closed track")).print("warning",Ut);for(var ut=arguments.length,pt=new Array(ut),mt=0;mt<ut;mt++)pt[mt]=arguments[mt];const _t=ct.apply(this,pt);return _t instanceof Ir?new Ir((vt,Tt)=>{_t.then(vt).catch(Tt)}):_t}),it}}class SB extends Fs{constructor(rt){super(),Fn(this,"name","VideoProcessorDestination"),Fn(this,"ID","0"),Fn(this,"_source",void 0),Fn(this,"videoContext",void 0),Fn(this,"inputTrack",void 0),this.videoContext=rt}get kind(){return"video"}get enabled(){return!0}pipe(){throw new Yn(tn.NOT_SUPPORTED,"VideoProcessor cannot pipe to any other Processor")}unpipe(){throw new Yn(tn.NOT_SUPPORTED,"VideoProcessor cannot unpipe to any other Processor")}enable(){}disable(){}updateInput(rt){if(rt.context!==this.videoContext)throw new Error(`ProcessorContext passed to VideoTrack.processorDestination doesn't match it's belonging VideoTrack's context.
Probably you are making pipeline like this:
videoTrack1.pipe(processor).pipe(videoTrack2.processorDestination).`);rt.track&&rt.track!==this.inputTrack&&(this.videoContext.chained=!0,this.inputTrack=rt.track,this.emit(Fu.ON_TRACK,rt.track))}reset(){this.inputTrack=void 0,this.videoContext.chained=!1,this.emit(Fu.ON_TRACK,void 0)}}class TB extends Fs{set chained(rt){this._chained=rt}get chained(){return this._chained}constructor(rt,it){super(),Fn(this,"constraintsMap",new Map),Fn(this,"statsRegistry",[]),Fn(this,"usageRegistry",[]),Fn(this,"trackId",void 0),Fn(this,"direction",void 0),Fn(this,"_chained",!1),this.trackId=rt,this.direction=it}async getConstraints(){return await ru(this,Up.REQUEST_CONSTRAINTS)}async requestApplyConstraints(rt,it){var ct;return Ut.info("processor ".concat(it.name," requestApplyConstraints for ").concat(this.trackId)),rt&&this.constraintsMap.set(it,rt),ps(this,Up.REQUEST_UPDATE_CONSTRAINTS,Array.from(Sp(ct=this.constraintsMap).call(ct)))}async requestRevertConstraints(rt){var it;if(this.constraintsMap.has(rt))return Ut.info("processor ".concat(rt.name," requestRevertConstraints for ").concat(this.trackId)),this.constraintsMap.delete(rt),ps(this,Up.REQUEST_UPDATE_CONSTRAINTS,Array.from(Sp(it=this.constraintsMap).call(it)))}registerStats(rt,it,ct){this.statsRegistry.find(ut=>ut.processorID===rt.ID&&ut.processorName===rt.name&&ut.type===it)||this.statsRegistry.push({processorName:rt.name,processorID:rt.ID,type:it,cb:ct})}unregisterStats(rt,it){const ct=this.statsRegistry.findIndex(ut=>ut.processorID===rt.ID&&ut.processorName===rt.name&&ut.type===it);ct!==-1&&this.statsRegistry.splice(ct,1)}gatherStats(){const rt=[];for(const{processorID:it,processorName:ct,type:ut,cb:pt}of this.statsRegistry)try{const mt=pt();rt.push({processorID:it,processorName:ct,type:ut,stats:mt})}catch(mt){Ut.error(new Yn(tn.UNEXPECTED_ERROR,mt.message))}return rt}registerUsage(rt,it){this.usageRegistry.find(ct=>ct.processorID===rt.ID&&ct.processorName===rt.name)||this.usageRegistry.push({processorID:rt.ID,processorName:rt.name,cb:it})}unregisterUsage(rt){const it=this.usageRegistry.findIndex(ct=>ct.processorID===rt.ID&&ct.processorName===rt.name);it!==-1&&this.usageRegistry.splice(it,1)}async gatherUsage(){const rt=[];if(!this.chained)return[];for(const{cb:it}of this.usageRegistry)try{let ct=it();ct instanceof Ir&&(ct=await ct),rt.push(Ss(Ss({},ct),{},{direction:this.direction}))}catch(ct){Ut.error("gather extension usage error",ct)}return rt}getDirection(){return this.direction}}class AB extends Fs{constructor(rt){super(),Fn(this,"name","AudioProcessorDestination"),Fn(this,"ID","0"),Fn(this,"inputTrack",void 0),Fn(this,"inputNode",void 0),Fn(this,"audioProcessorContext",void 0),Fn(this,"_source",void 0),this.audioProcessorContext=rt}get kind(){return"audio"}get enabled(){return!0}pipe(){throw new Yn(tn.NOT_SUPPORTED,"AudioProcessorDestination cannot pipe to any other Processor")}unpipe(){throw new Yn(tn.NOT_SUPPORTED,"AudioProcessor cannot unpipe to any other Processor")}enable(){}disable(){}reset(){this.inputTrack=void 0,this.inputNode=void 0,this.audioProcessorContext.chained=!1,this.emit(Fu.ON_TRACK,void 0),this.emit(Fu.ON_NODE,void 0)}updateInput(rt){if(rt.context!==this.audioProcessorContext)throw new Error(`ProcessorContext passed to AudioTrack.processorDestination doesn't match it's belonging AudioTrack's context.
        Probably you are making pipeline like this: audioTrack1.pipe(processor).pipe(audioTrack2.processorDestination).`);rt.track&&this.inputTrack!==rt.track&&(this.audioProcessorContext.chained=!0,this.inputTrack=rt.track,this.emit(Fu.ON_TRACK,this.inputTrack)),rt.node&&this.inputNode!==rt.node&&(this.audioProcessorContext.chained=!0,this.inputNode=rt.node,this.emit(Fu.ON_NODE,this.inputNode))}}class CB extends Fs{set chained(rt){this._chained=rt}get chained(){return this._chained}constructor(rt,it,ct){super(),Fn(this,"constraintsMap",new Map),Fn(this,"statsRegistry",[]),Fn(this,"audioContext",void 0),Fn(this,"trackId",void 0),Fn(this,"direction",void 0),Fn(this,"usageRegistry",[]),Fn(this,"_chained",!1),this.audioContext=rt,this.trackId=it,this.direction=ct}async getConstraints(){return ru(this,Up.REQUEST_CONSTRAINTS)}getAudioContext(){return this.audioContext}async requestApplyConstraints(rt,it){var ct;return Ut.info("processor ".concat(it.name," requestApplyConstraints for ").concat(this.trackId)),rt&&this.constraintsMap.set(it,rt),ps(this,Up.REQUEST_UPDATE_CONSTRAINTS,Array.from(Sp(ct=this.constraintsMap).call(ct)))}async requestRevertConstraints(rt){var it;if(this.constraintsMap.has(rt))return this.constraintsMap.delete(rt),ps(this,Up.REQUEST_UPDATE_CONSTRAINTS,Array.from(Sp(it=this.constraintsMap).call(it)))}registerStats(rt,it,ct){this.statsRegistry.find(ut=>ut.processorID===rt.ID&&ut.processorName===rt.name&&ut.type===it)||this.statsRegistry.push({processorName:rt.name,processorID:rt.ID,type:it,cb:ct})}unregisterStats(rt,it){const ct=this.statsRegistry.findIndex(ut=>ut.processorID===rt.ID&&ut.processorName===rt.name&&ut.type===it);ct!==-1&&this.statsRegistry.splice(ct,1)}gatherStats(){const rt=[];for(const{processorID:it,processorName:ct,type:ut,cb:pt}of this.statsRegistry)try{const mt=pt();rt.push({processorID:it,processorName:ct,type:ut,stats:mt})}catch(mt){Ut.error(new Yn(tn.UNEXPECTED_ERROR,mt.message))}return rt}registerUsage(rt,it){this.usageRegistry.find(ct=>ct.processorID===rt.ID&&ct.processorName===rt.name)||this.usageRegistry.push({processorID:rt.ID,processorName:rt.name,cb:it})}unregisterUsage(rt){const it=this.usageRegistry.findIndex(ct=>ct.processorID===rt.ID&&ct.processorName===rt.name);it!==-1&&this.usageRegistry.splice(it,1)}async gatherUsage(){const rt=[];if(!this.chained)return[];for(const{cb:it}of this.usageRegistry)try{let ct=it();ct instanceof Ir&&(ct=await ct),rt.push(Ss(Ss({},ct),{},{direction:this.direction}))}catch(ct){Ut.error("gather extension usage error",ct)}return rt}getDirection(){return this.direction}}class YO extends Fs{get isPlayed(){return!0}get isFreeze(){return!1}constructor(){super(),Fn(this,"context",void 0),Fn(this,"processSourceNode",void 0),Fn(this,"outputTrack",void 0),Fn(this,"processedNode",void 0),Fn(this,"clonedTrack",void 0),Fn(this,"outputNode",void 0),this.outputNode=new UY}setVolume(){}createOutputTrack(){throw new Yn(tn.NOT_SUPPORTED,"can not create output MediaStreamTrack when WebAudio disabled")}getOriginVolumeLevel(){return 0}getAccurateVolumeLevel(){return 0}stopGetAudioBuffer(){}startGetAudioBuffer(){}play(){}stop(){}destroy(){}updateTrack(){}updateOriginTrack(){}createMediaStreamSourceNode(){}}class UY{disconnect(){}connect(){}}function bB(_e){return new Ir((rt,it)=>{let ct=!1;const ut=document.createElement("video");ut.setAttribute("autoplay",""),ut.setAttribute("muted",""),ut.muted=!0,ut.autoplay=!0,ut.setAttribute("playsinline",""),ut.setAttribute("style","position: fixed; top: 0; left: 0; width: 1px; height: 1px"),document.body.appendChild(ut);const pt=Tu()?"canplay":"playing";ut.addEventListener(pt,()=>{const mt=ut.videoWidth,_t=ut.videoHeight;!mt&&Gs()||(ct=!0,ut.srcObject=null,ut.remove(),rt([mt,_t]))}),ut.srcObject=new MediaStream([_e]),ut.play().catch(fw),setTimeout(()=>{ct||(ut.srcObject=null,ut.remove(),rt([ut.videoWidth,ut.videoHeight]))},4e3)})}function bw(_e){const rt={};_e.facingMode&&(rt.facingMode=_e.facingMode),_e.cameraId&&(rt.deviceId={exact:_e.cameraId});const it=Cm(_e.encoderConfig);return it.width!=null&&(rt.width=it.width),it.height!=null&&(rt.height=it.height),!A3()&&it.frameRate&&(rt.frameRate=it.frameRate),m3()&&typeof rt.frameRate=="object"&&(rt.frameRate.max=60),Gs()&&(rt.frameRate={ideal:30,max:30}),rt}function RB(_e){const rt={};return A3()||(_e.AGC!==void 0&&(rt.autoGainControl=_e.AGC),_e.AEC!==void 0&&(rt.echoCancellation=_e.AEC),_e.ANS!==void 0&&(rt.noiseSuppression=_e.ANS,dE()&&_e.ANS&&(rt.googHighpassFilter=_e.ANS))),rt}function wB(_e){const rt=RB(_e);if(_e.encoderConfig){const it=Tw(_e.encoderConfig);rt.channelCount=it.stereo?2:1,rt.sampleRate=it.sampleRate,rt.sampleSize=it.sampleSize}return _e.microphoneId&&(rt.deviceId={exact:_e.microphoneId}),dw()&&(rt.sampleRate=void 0),rt}const BY=_e=>{const rt=_e._encoderConfig;if(!rt)return;const{frameRate:it,width:ct,height:ut}=_e.getMediaStreamTrackSettings();let{frameRate:pt=it,width:mt=ct,height:_t=ut}=rt;if(!pt||!mt||!_t)return;mt=mS(mt),_t=mS(_t),pt=mS(pt);const{max:vt,min:Tt}=function(Dt,jt,$t){const Ht=200*Math.pow($t/15,.6)*Math.pow(Dt*jt/640/360,.75);return{min:Math.floor(Ht),max:Math.floor(4*Ht)}}(mt,_t,pt),{bitrateMax:bt,bitrateMin:Ot}=rt||{};bt||Ut.debug("calculate bitrate: [w: ".concat(mt,", h: ").concat(_t,", fps: ").concat(pt,"] => [brMax: ").concat(bt,", brMin: ").concat(Ot,"]"));const{maxFramerate:Mt}=rn("ENCODER_CONFIG_LIMIT");return Mt&&typeof Mt=="number"&&(pt=Math.min(pt,Mt)),{frameRate:pt,bitrateMax:bt||vt,bitrateMin:Ot||Tt,scaleResolutionDownBy:1,scale:0}},IB=async(_e,rt,it)=>await(async(ct,ut,pt)=>{const mt=function(Tt){const bt=[];for(let Ot=0;Ot<Tt.length;Ot+=2)bt.push(parseInt(Tt.slice(Ot,Ot+2),16));return Uint8Array.from(bt)}(F3(""+ut+pt)).slice(0,16),_t=mt.slice(0,12),vt=await window.crypto.subtle.importKey("raw",mt,"AES-GCM",!0,["encrypt"]);return new Uint8Array(await window.crypto.subtle.encrypt({name:"AES-GCM",iv:_t},vt,ct))})(_e.buffer,rt,it),XO=_e=>{const rt=document.createElement("canvas");return rt.width=2,rt.height=2,new Ir((it,ct)=>{rt.toBlob(async ut=>{if(rt.remove(),ut){const pt=await xB(ut);it({buffer:pt,width:rt.width,height:rt.height})}else ct(new Yn(tn.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},_e,1)})},xB=async _e=>{const rt=await _e.arrayBuffer();return new Uint8Array(rt)};var OB,MB,PB,NB,DB,LB,kB,UB,BB,FB,VB,GB,$B,HB,jB,zB,WB,KB,Vs,YB,XB,qB,JB,ZB,QB,D_,eF,tF,nF,rF,iF,oF,sF,aF,cF,lF,uF,dF,hF,ou;let Ws=(OB=Jr({argsMap:(_e,rt)=>[_e.getTrackId(),rt],throttleTime:300}),MB=Jr({argsMap:(_e,rt)=>[_e.getTrackId(),rt]}),PB=zs(),NB=gS("LocalAudioTrack","_enabledMutex"),DB=Jr({argsMap:(_e,rt)=>[_e.getTrackId(),rt]}),LB=zs(),kB=gS("LocalAudioTrack","_enabledMutex"),UB=Jr({argsMap:(_e,rt)=>[_e.getTrackId(),rt]}),BB=zs(),FB=zs(),VB=zs(),GB=Jr({argsMap:_e=>[_e.getTrackId()]}),$B=zs(),HB=Jr({argsMap:_e=>[_e.getTrackId()]}),jB=zs(),zB=Jr({argsMap:_e=>[_e.getTrackId()]}),WB=Jr({argsMap:(_e,rt)=>[_e.getTrackId(),rt.name]}),KB=Jr({argsMap:_e=>[_e.getTrackId()]}),Po((Vs=class extends CS{get _source(){return this.initWebAudio()}set _source(_e){this._trackSource=_e}get processorContext(){return this._processorContext||(this._processorContext=this.initProcessor().processorContext),this._processorContext}get processorDestination(){return this._processorDestination||(this._processorDestination=this.initProcessor().processorDestination),this._processorDestination}get isPlaying(){return this._useAudioElement?qu.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"LocalAudioTrack"}constructor(_e,rt,it,ct){super(_e,it),Fn(this,"trackMediaType",AS.AUDIO),Fn(this,"_encoderConfig",void 0),Fn(this,"_trackSource",void 0),Fn(this,"metadata",[]),Fn(this,"_enabled",!0),Fn(this,"_volume",100),Fn(this,"_useAudioElement",!0),Fn(this,"_bypassWebAudio",!1),Fn(this,"processor",void 0),Fn(this,"_processorContext",void 0),Fn(this,"_processorDestination",void 0),Fn(this,"_getOriginVolumeLevel",void 0),this._encoderConfig=rt,this._getOriginVolumeLevel=!!ct,this._trackSource=new YO,rn("DISABLE_WEBAUDIO")&&(this._bypassWebAudio=!0),rn("LOCAL_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1),tu()&&!Bp?setTimeout(()=>this.initWebAudio()):this.initWebAudio()}setVolume(_e){us(_e,"volume",0,1e3),this._volume=_e,this._source.setVolume(_e/100),this._useAudioElement&&qu.setVolume(this.getTrackId(),_e);try{if(this._bypassWebAudio)return void Ut.debug("[".concat(this.getTrackId(),"] setVolume returned because no pass through WebAudio."));const rt=this._source.createOutputTrack();this._mediaStreamTrack!==rt&&(this._mediaStreamTrack=rt,ps(this,Lr.NEED_REPLACE_TRACK,this).then(()=>{Ut.debug("[".concat(this.getTrackId(),"] replace web audio track success"))}).catch(it=>{Ut.warning("[".concat(this.getTrackId(),"] replace web audio track failed"),it)}))}catch{}}getVolumeLevel(){return this._muted&&this.enabled&&this._getOriginVolumeLevel?this._source.getOriginVolumeLevel():this._source.getAccurateVolumeLevel()}async setPlaybackDevice(_e){if(!this._useAudioElement||!iB())throw new Yn(tn.NOT_SUPPORTED,"your browser does not support setting the audio output device");await qu.setSinkID(this.getTrackId(),_e)}async setEnabled(_e,rt,it){return this._setEnabled(_e,rt,it)}async _setEnabled(_e,rt,it){if(!it){if(_e===this._enabled)return;this.stateCheck("enabled",_e)}if(Ut.info("[".concat(this.getTrackId(),"] start setEnabled"),_e),_e){this._originMediaStreamTrack.enabled=!0;try{it||(this._enabled=!0),await ps(this,Lr.NEED_ENABLE_TRACK,this),Ut.info("[".concat(this.getTrackId(),"] setEnabled to ").concat(_e," success"))}catch(ct){throw it||(this._enabled=!1),Ut.error("[".concat(this.getTrackId(),"] setEnabled to true error"),ct.toString()),ct}}else{this._originMediaStreamTrack.enabled=!1,it||(this._enabled=!1);try{await ps(this,Lr.NEED_DISABLE_TRACK,this)}catch(ct){throw it||(this._enabled=!0),Ut.error("[".concat(this.getTrackId(),"] setEnabled to false error"),ct.toString()),ct}}}async setMuted(_e){_e!==this._muted&&(this.stateCheck("muted",_e),this._muted=_e,this._originMediaStreamTrack.enabled=!_e,Ut.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(_e)),_e?await ps(this,Lr.NEED_MUTE_TRACK,this):await ps(this,Lr.NEED_UNMUTE_TRACK,this))}getStats(){return tv(()=>{Ut.warning("[deprecated] LocalAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalAudioStats instead")},"localAudioTrackGetStatsWarning"),Dp(this,Lr.GET_STATS)||Ss({},GO)}setAudioFrameCallback(_e){let rt=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!_e)return this._source.removeAllListeners(kp.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(rt),this._source.removeAllListeners(kp.ON_AUDIO_BUFFER),this._source.on(kp.ON_AUDIO_BUFFER,it=>_e(it))}play(){Ut.debug("[".concat(this.getTrackId(),"] start audio playback")),this._useAudioElement?(Ut.debug("[".concat(this.getTrackId(),"] start audio playback in element")),qu.play(this._mediaStreamTrack,this.getTrackId(),this._volume)):this._source.play()}stop(){Ut.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._useAudioElement?qu.stop(this.getTrackId()):this._source.stop()}close(){super.close(),this._processorDestination&&this.unbindProcessorDestinationEvents(this._processorDestination),this._processorContext&&this.unbindProcessorContextEvents(this._processorContext),this.unpipe(),this._processorDestination&&this._processorDestination._source&&this._processorDestination._source.unpipe(),this._source.destroy()}_updatePlayerSource(){let _e=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];Ut.debug("[".concat(this.getTrackId(),"] update player source track")),_e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&qu.updateTrack(this.getTrackId(),this._mediaStreamTrack)}async _updateOriginMediaStreamTrack(_e,rt){this._originMediaStreamTrack!==_e&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),rt&&this._originMediaStreamTrack.stop()),_e.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=_e,this._muted&&(this._originMediaStreamTrack.enabled=!1),this.processor&&this._processorContext&&this.processor.updateInput({track:_e,context:this._processorContext}),this._mediaStreamTrack!==this._source.outputTrack?(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await ps(this,Lr.NEED_REPLACE_TRACK,this)):this._source.updateTrack(this._originMediaStreamTrack),this._getOriginVolumeLevel&&this._source.updateOriginTrack(_e))}renewMediaStreamTrack(_e){return Ir.resolve(void 0)}pipe(_e){if(this._bypassWebAudio)throw new Yn(tn.INVALID_OPERATION,"Can not process AudioTrack when bypassWebAudio set to true.");if(this.processor===_e)return _e;if(_e._source)throw new Yn(tn.INVALID_OPERATION,"Processor ".concat(_e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=_e,this.processor._source=this,_e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),_e}unpipe(){var _e;if(!this.processor)return;const rt=this.processor;(_e=this._source.processSourceNode)===null||_e===void 0||_e.disconnect(),this.processor._source=!1,this.processor=void 0,rt.reset()}bindProcessorDestinationEvents(_e){_e.on(Fu.ON_TRACK,async rt=>{rt?rt!==this._mediaStreamTrack&&(this._mediaStreamTrack=rt,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(rt),await ps(this,Lr.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await ps(this,Lr.NEED_REPLACE_TRACK,this))}),_e.on(Fu.ON_NODE,rt=>{this._source.processedNode=rt})}unbindProcessorDestinationEvents(_e){_e.removeAllListeners(Fu.ON_TRACK),_e.removeAllListeners(Fu.ON_NODE)}bindProcessorContextEvents(_e){_e.on(Up.REQUEST_CONSTRAINTS,async rt=>{rt(this._originMediaStreamTrack.getSettings())})}unbindProcessorContextEvents(_e){_e.removeAllListeners(Up.REQUEST_CONSTRAINTS)}initWebAudio(){return this._trackSource instanceof YO&&(this._trackSource=new fB(this._mediaStreamTrack,!1,this._getOriginVolumeLevel?this._mediaStreamTrack:void 0)),this._trackSource}initProcessor(){const _e=new CB(this._source.context,this.getTrackId(),"local"),rt=new AB(_e);return this._processorContext=_e,this._processorDestination=rt,this.bindProcessorContextEvents(_e),this.bindProcessorDestinationEvents(rt),this._source.on(kp.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:_e})}),this._useAudioElement&&(this._useAudioElement=!1,this.isPlaying&&(qu.stop(this.getTrackId()),this._source.play()),ps(this,Lr.NEED_REPLACE_MIXING_TRACK,this).then(()=>{Ut.debug("[".concat(this.getTrackId(),"] replace from origin track to web audio track success"))}).catch(it=>{Ut.warning("[".concat(this.getTrackId(),"] replace from origin track to web audio track failed"),it)})),{processorContext:_e,processorDestination:rt}}}).prototype,"setVolume",[OB],Object.getOwnPropertyDescriptor(Vs.prototype,"setVolume"),Vs.prototype),Po(Vs.prototype,"setPlaybackDevice",[MB,PB],Object.getOwnPropertyDescriptor(Vs.prototype,"setPlaybackDevice"),Vs.prototype),Po(Vs.prototype,"setEnabled",[NB,DB,LB],Object.getOwnPropertyDescriptor(Vs.prototype,"setEnabled"),Vs.prototype),Po(Vs.prototype,"setMuted",[kB,UB,BB],Object.getOwnPropertyDescriptor(Vs.prototype,"setMuted"),Vs.prototype),Po(Vs.prototype,"getStats",[FB],Object.getOwnPropertyDescriptor(Vs.prototype,"getStats"),Vs.prototype),Po(Vs.prototype,"setAudioFrameCallback",[VB],Object.getOwnPropertyDescriptor(Vs.prototype,"setAudioFrameCallback"),Vs.prototype),Po(Vs.prototype,"play",[GB,$B],Object.getOwnPropertyDescriptor(Vs.prototype,"play"),Vs.prototype),Po(Vs.prototype,"stop",[HB,jB],Object.getOwnPropertyDescriptor(Vs.prototype,"stop"),Vs.prototype),Po(Vs.prototype,"close",[zB],Object.getOwnPropertyDescriptor(Vs.prototype,"close"),Vs.prototype),Po(Vs.prototype,"pipe",[WB],Object.getOwnPropertyDescriptor(Vs.prototype,"pipe"),Vs.prototype),Po(Vs.prototype,"unpipe",[KB],Object.getOwnPropertyDescriptor(Vs.prototype,"unpipe"),Vs.prototype),Vs),SA=(YB=Jr({argsMap:(_e,rt)=>[_e.getTrackId(),rt]}),XB=zs(),qB=gS("MicrophoneAudioTrack","_enabledMutex"),JB=Jr({argsMap:(_e,rt,it)=>[_e.getTrackId(),rt,it]}),ZB=zs(),QB=Jr({argsMap:_e=>[_e.getTrackId()]}),Po((D_=class extends Ws{get __className__(){return"MicrophoneAudioTrack"}constructor(_e,rt,it,ct){super(_e,rt.encoderConfig?Tw(rt.encoderConfig):{},ct,rn("GET_VOLUME_OF_MUTED_AUDIO_TRACK")),Fn(this,"_config",void 0),Fn(this,"_deviceName","default"),Fn(this,"_constraints",void 0),Fn(this,"_originalConstraints",void 0),Fn(this,"_enabled",!0),this._config=rt,this._constraints=it,this._originalConstraints=it,this._deviceName=_e.label,typeof rt.bypassWebAudio=="boolean"&&(this._bypassWebAudio=rt.bypassWebAudio),(hS()||mO())&&rs.bindInterruptDetectorTrack(this)}async setDevice(_e){if(Ut.info("[".concat(this.getTrackId(),"] start set device to ").concat(_e)),this._enabled)try{const rt=await Vp.getDeviceById(_e),it={};it.audio=Ss({},this._constraints),it.audio.deviceId={exact:_e},this._originMediaStreamTrack.stop();let ct=null;try{ct=await Fp(it,this.getTrackId())}catch(ut){throw Ut.error("[".concat(this.getTrackId(),"] setDevice failed"),ut.toString()),ct=await Fp({audio:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(ct.getAudioTracks()[0],!1),ut}await this._updateOriginMediaStreamTrack(ct.getAudioTracks()[0],!1),this._deviceName=rt.label,this._config.microphoneId=_e,this._constraints.deviceId={exact:_e}}catch(rt){throw Ut.error("[".concat(this.getTrackId(),"] setDevice error"),rt.toString()),rt}else try{const rt=await Vp.getDeviceById(_e);this._deviceName=rt.label,this._config.microphoneId=_e,this._constraints.deviceId={exact:_e}}catch(rt){throw Ut.error("[".concat(this.getTrackId(),"] setDevice error"),rt.toString()),rt}Ut.info("[".concat(this.getTrackId(),"] set device to ").concat(_e," success"))}async setEnabled(_e,rt,it){if(rt)return Ut.debug("[".concat(this.getTrackId(),"] setEnabled false (do not close microphone)")),await super._setEnabled(_e);if(!it){if(_e===this._enabled)return;this.stateCheck("enabled",_e)}if(Ut.info("[".concat(this.getTrackId(),"] start setEnabled"),_e),rn("AUTO_RESET_AUDIO_ROUTE")&&(Tu()||Sm())){const mt=navigator.audioSession;mt&&(_e||(mt.type="playback"),mt.type="auto")}if(!_e){var ct;this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop(),(ct=this._source.clonedTrack)===null||ct===void 0||ct.stop(),it||(this._enabled=!1);try{await ps(this,Lr.NEED_DISABLE_TRACK,this)}catch(mt){throw Ut.error("[".concat(this.getTrackId(),"] setEnabled false failed"),mt.toString()),mt}return}const ut=Ss({},this._constraints),pt=Vp.searchDeviceIdByName(this._deviceName);pt&&!ut.deviceId&&(ut.deviceId=pt);try{it||(this._enabled=!0);const mt=await Fp({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(mt.getAudioTracks()[0],!1),await ps(this,Lr.NEED_ENABLE_TRACK,this)}catch(mt){throw it||(this._enabled=!1),Ut.error("[".concat(this.getTrackId(),"] setEnabled true failed"),mt.toString()),mt}Ut.info("[".concat(this.getTrackId(),"] setEnabled success"))}close(){super.close(),(hS()||mO())&&rs.unbindInterruptDetectorTrack(this)}onTrackEnded(){if((Tu()||Sm())&&this._enabled&&!this._isClosed&&rs.duringInterruption){const _e=async()=>{rs.off(Kl.IOS_INTERRUPTION_END,_e),this._enabled&&!this._isClosed&&(Ut.debug("[".concat(this.getTrackId(),"] try capture microphone media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};rs.on(Kl.IOS_INTERRUPTION_END,_e)}else Ut.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(TS.TRACK_ENDED)}async renewMediaStreamTrack(_e){const rt=_e||this._constraints,it=Vp.searchDeviceIdByName(this._deviceName);if(it&&!rt.deviceId&&(rt.deviceId=it),this._constraints=rt,this._enabled){this._originMediaStreamTrack.stop();const ct=await Fp({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(ct.getAudioTracks()[0],!0)}}bindProcessorContextEvents(_e){super.bindProcessorContextEvents(_e),_e.on(Up.REQUEST_UPDATE_CONSTRAINTS,async(rt,it,ct)=>{try{const ut=Object.assign({},this._originalConstraints,...rt);await this.renewMediaStreamTrack(ut),it()}catch(ut){ct(ut)}})}unbindProcessorContextEvents(_e){super.unbindProcessorContextEvents(_e),_e.removeAllListeners(Up.REQUEST_UPDATE_CONSTRAINTS)}}).prototype,"setDevice",[YB,XB],Object.getOwnPropertyDescriptor(D_.prototype,"setDevice"),D_.prototype),Po(D_.prototype,"setEnabled",[qB,JB,ZB],Object.getOwnPropertyDescriptor(D_.prototype,"setEnabled"),D_.prototype),Po(D_.prototype,"close",[QB],Object.getOwnPropertyDescriptor(D_.prototype,"close"),D_.prototype),D_),FY=(eF=Jr({argsMap:(_e,rt)=>[_e.getTrackId(),rt,_e.duration]}),tF=zs(),nF=Jr({argsMap:_e=>[_e.getTrackId()]}),rF=zs(),iF=Jr({argsMap:_e=>[_e.getTrackId()]}),oF=zs(),sF=Jr({argsMap:_e=>[_e.getTrackId()]}),aF=zs(),cF=Jr({argsMap:_e=>[_e.getTrackId()]}),lF=zs(),uF=Jr({argsMap:_e=>[_e.getTrackId()]}),dF=Jr({argsMap:_e=>[_e.getTrackId()]}),hF=zs(),Po((ou=class extends Ws{get __className__(){return"BufferSourceAudioTrack"}constructor(_e,rt,it,ct){super(rt.createOutputTrack(),it,ct),Fn(this,"source",void 0),Fn(this,"_bufferSource",void 0),this._useAudioElement=!1,this.source=_e,this._bufferSource=rt,this._bufferSource.on(kp.AUDIO_SOURCE_STATE_CHANGE,ut=>{this.safeEmit(TS.SOURCE_STATE_CHANGE,ut)});try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}}get currentState(){return this._bufferSource.currentState}get duration(){return this._bufferSource.duration}get playbackSpeed(){return this._bufferSource.playbackSpeed}getCurrentTime(){return this._bufferSource.currentTime}startProcessAudioBuffer(_e){_e&&this._bufferSource.updateOptions(_e),this._bufferSource.startProcessAudioBuffer()}pauseProcessAudioBuffer(){this._bufferSource.pauseProcessAudioBuffer()}seekAudioBuffer(_e){this._bufferSource.seekAudioBuffer(_e)}resumeProcessAudioBuffer(){this._bufferSource.resumeProcessAudioBuffer()}stopProcessAudioBuffer(){this._bufferSource.stopProcessAudioBuffer()}close(){this.source=null,this._bufferSource.destroy(),super.close()}setAudioBufferPlaybackSpeed(_e){us(_e,"speed",0),this._bufferSource.setAudioBufferPlaybackSpeed(_e)}}).prototype,"startProcessAudioBuffer",[eF,tF],Object.getOwnPropertyDescriptor(ou.prototype,"startProcessAudioBuffer"),ou.prototype),Po(ou.prototype,"pauseProcessAudioBuffer",[nF,rF],Object.getOwnPropertyDescriptor(ou.prototype,"pauseProcessAudioBuffer"),ou.prototype),Po(ou.prototype,"seekAudioBuffer",[iF,oF],Object.getOwnPropertyDescriptor(ou.prototype,"seekAudioBuffer"),ou.prototype),Po(ou.prototype,"resumeProcessAudioBuffer",[sF,aF],Object.getOwnPropertyDescriptor(ou.prototype,"resumeProcessAudioBuffer"),ou.prototype),Po(ou.prototype,"stopProcessAudioBuffer",[cF,lF],Object.getOwnPropertyDescriptor(ou.prototype,"stopProcessAudioBuffer"),ou.prototype),Po(ou.prototype,"close",[uF],Object.getOwnPropertyDescriptor(ou.prototype,"close"),ou.prototype),Po(ou.prototype,"setAudioBufferPlaybackSpeed",[dF,hF],Object.getOwnPropertyDescriptor(ou.prototype,"setAudioBufferPlaybackSpeed"),ou.prototype),ou);class yl extends Ws{get __className__(){return"MixingAudioTrack"}get isActive(){for(const rt of this.trackList)if(rt._enabled&&!rt._isClosed&&!rt.muted)return!0;return!1}constructor(){const rt=bS().createMediaStreamDestination();super(rt.stream.getAudioTracks()[0],void 0,ms(8,"track-mix-")),Fn(this,"trackList",void 0),Fn(this,"destNode",void 0),this._useAudioElement=!1;try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}this.destNode=rt,this.trackList=[]}hasAudioTrack(rt){return this.trackList.indexOf(rt)!==-1}addAudioTrack(rt){this.trackList.indexOf(rt)===-1?(Ut.debug("add ".concat(rt.getTrackId()," to mixing track")),rt._source.outputNode.connect(this.destNode),this.trackList.push(rt),this.updateEncoderConfig()):Ut.debug("track ".concat(rt.getTrackId()," is already added"))}removeAudioTrack(rt){if(this.trackList.indexOf(rt)!==-1){Ut.debug("remove ".concat(rt.getTrackId()," from mixing track"));try{rt._source.outputNode.disconnect(this.destNode)}catch{}hw(this.trackList,rt),this.updateEncoderConfig()}}updateEncoderConfig(){const rt={};this.trackList.forEach(it=>{it._encoderConfig&&((it._encoderConfig.bitrate||0)>(rt.bitrate||0)&&(rt.bitrate=it._encoderConfig.bitrate),(it._encoderConfig.sampleRate||0)>(rt.sampleRate||0)&&(rt.sampleRate=it._encoderConfig.sampleRate),(it._encoderConfig.sampleSize||0)>(rt.sampleSize||0)&&(rt.sampleSize=it._encoderConfig.sampleSize),it._encoderConfig.stereo&&(rt.stereo=!0))}),this._encoderConfig=rt}_updateRtpTransceiver(rt){this._rtpTransceiver!==rt&&(this._rtpTransceiver=rt,this.trackList.forEach(it=>{it instanceof yl?it.emit(v0.TRANSCEIVER_UPDATED,rt):it._updateRtpTransceiver(rt)}))}}class VY extends pB{set currentState(rt){rt!==this._currentState&&(this._currentState=rt,this.safeEmit(kp.AUDIO_SOURCE_STATE_CHANGE,this._currentState))}get currentState(){return this._currentState}constructor(rt){let it=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),Fn(this,"audioBuffer",void 0),Fn(this,"sourceNode",void 0),Fn(this,"startPlayTime",0),Fn(this,"startPlayOffset",0),Fn(this,"pausePlayTime",0),Fn(this,"options",void 0),Fn(this,"currentLoopCount",0),Fn(this,"currentPlaybackSpeed",100),Fn(this,"_currentState","stopped"),this.audioBuffer=rt,this.options=it,this.startPlayOffset=this.options.startPlayTime||0}createWebAudioDiagram(){return this.context.createGain()}get duration(){return this.audioBuffer?this.audioBuffer.duration:0}get playbackSpeed(){return this.currentPlaybackSpeed}get currentTime(){return this.audioBuffer?this.currentState==="stopped"?0:this.currentState==="paused"?this.pausePlayTime:((this.context.currentTime-this.startPlayTime)*(this.playbackSpeed/100)+this.startPlayOffset)%this.audioBuffer.duration:0}updateOptions(rt){this.currentState==="stopped"?(this.options=rt,this.startPlayOffset=this.options.startPlayTime||0):Ut.warning("can not set audio source options")}startProcessAudioBuffer(){this.sourceNode&&this.stopProcessAudioBuffer(),this.sourceNode=this.createSourceNode(),this.startSourceNode(),this.currentState="playing"}pauseProcessAudioBuffer(){this.sourceNode&&this.currentState==="playing"&&(this.pausePlayTime=this.currentTime,this.sourceNode.onended=null,this.sourceNode.stop(),this.sourceNode.buffer=null,this.sourceNode=this.createSourceNode(),this.currentState="paused")}seekAudioBuffer(rt){this.sourceNode&&(this.sourceNode.onended=null,this.currentState==="playing"&&this.sourceNode.stop(),this.sourceNode=this.createSourceNode(),this.currentState==="playing"?(this.startPlayOffset=rt,this.startSourceNode()):this.currentState==="paused"&&(this.pausePlayTime=rt))}resumeProcessAudioBuffer(){this.currentState==="paused"&&this.sourceNode&&(this.startPlayOffset=this.pausePlayTime,this.pausePlayTime=0,this.startSourceNode(),this.currentState="playing")}stopProcessAudioBuffer(){if(this.sourceNode){this.sourceNode.onended=null;try{this.sourceNode.stop()}catch{}this.reset()}}destroy(){this.audioBuffer=null,super.destroy()}setAudioBufferPlaybackSpeed(rt){this.sourceNode&&(this.currentState==="playing"&&(this.startPlayOffset=this.currentTime,this.startPlayTime=this.context.currentTime),this.sourceNode.playbackRate.value=rt/100),this.currentPlaybackSpeed=rt}startSourceNode(){this.sourceNode&&this.sourceNode.buffer&&(this.sourceNode.start(0,this.startPlayOffset),this.startPlayTime=this.context.currentTime,this.sourceNode.onended=this.handleSourceNodeEnded.bind(this))}createSourceNode(){const rt=this.context.createBufferSource();return rt.buffer=this.audioBuffer,rt.loop=!!this.options.loop,rt.connect(this.outputNode),rt.playbackRate.value=this.currentPlaybackSpeed/100,rt}handleSourceNodeEnded(){if(this.currentLoopCount+=1,this.options.cycle&&this.options.cycle>this.currentLoopCount)return this.startPlayOffset=0,this.sourceNode=void 0,void this.startProcessAudioBuffer();this.reset()}reset(){this.startPlayOffset=this.options.startPlayTime||0,this.currentState="stopped",this.sourceNode&&(this.sourceNode.disconnect(),this.sourceNode=void 0),this.currentLoopCount=0}}const pF=new Map;function fF(_e,rt){if(_e.length===0||rt.length===0)return 1/0;const it=AO(_e),ct=AO(rt);return Math.floor(ct/it)}class qO{get rendFrameRate(){const rt=Math.max(1,fF(this._render_interframe_delays_sizes,this._render_interframe_delays));return Math.floor(1e3/rt)}get videoElementStatus(){return this._isInPage?this._videoElementStatus:uu.DESTROYED}set videoElementStatus(rt){rt!==this._videoElementStatus&&(Ut.debug("[".concat(this.trackId,"] video-element-status change ").concat(this._videoElementStatus," => ").concat(rt)),this._videoElementStatus=rt)}get videoState(){return this._videoState}set videoState(rt){var it;rt!==this._videoState&&(this._videoState=rt,(it=this.onVideoStateChanged)===null||it===void 0||it.call(this,this.videoState))}constructor(rt){Fn(this,"trackId",void 0),Fn(this,"config",void 0),Fn(this,"onFirstVideoFrameDecoded",void 0),Fn(this,"onFirstVideoFrameRender",void 0),Fn(this,"onVideoStateChanged",void 0),Fn(this,"freezeTimeCounterList",[]),Fn(this,"renderFreezeAccTime",0),Fn(this,"renderFreezeAccTime2",0),Fn(this,"isKeepLastFrame",!1),Fn(this,"isDestroyed",!1),Fn(this,"timeUpdatedCount",0),Fn(this,"freezeTime",0),Fn(this,"playbackTime",0),Fn(this,"lastTimeUpdatedTime",0),Fn(this,"autoplayFailed",!1),Fn(this,"videoTrack",void 0),Fn(this,"videoElement",void 0),Fn(this,"cacheVideoElement",void 0),Fn(this,"internal",!1),Fn(this,"_render_interframe_delays",[]),Fn(this,"_render_interframe_delays_sizes",[]),Fn(this,"_videoState",N_.VideoStateStopped),Fn(this,"videoElementCheckInterval",void 0),Fn(this,"videoElementFreezeTimeout",void 0),Fn(this,"_videoElementStatus",uu.NONE),Fn(this,"_isInPage",!0),Fn(this,"isGettingVideoDimensions",!1),Fn(this,"startGetVideoDimensions",()=>{const it=()=>{if(this.isGettingVideoDimensions=!0,this.videoElement.videoWidth*this.videoElement.videoHeight>4)return Ut.debug("[".concat(this.trackId,"] current video dimensions:"),this.videoElement.videoWidth,this.videoElement.videoHeight),void(this.isGettingVideoDimensions=!1);setTimeout(it,500)};!this.isGettingVideoDimensions&&it()}),Fn(this,"autoResumeAfterInterruption",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&rs.curState==="running"&&(Ut.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(p3())),S3()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),Fn(this,"handleVideoEvents",it=>{switch(it.type){case"play":case"playing":it.type==="play"&&Ut.debug("[".concat(this.trackId,"] video element status: play")),this.startGetVideoDimensions(),this.videoElementStatus=uu.PLAYING;break;case"loadeddata":if(this.videoState=N_.VideoStateStarting,this.onFirstVideoFrameRender&&this.onFirstVideoFrameRender(),this.onFirstVideoFrameDecoded&&this.onFirstVideoFrameDecoded(),this.cacheVideoElement){try{this.cacheVideoElement.srcObject=null,this.cacheVideoElement.remove()}catch{}this.cacheVideoElement=void 0}break;case"canplay":this.videoElementStatus=uu.CANPLAY;break;case"stalled":this.videoElementStatus=uu.STALLED;break;case"suspend":this.videoElementStatus=uu.SUSPEND;break;case"pause":this.videoElementStatus=uu.PAUSED,Tu()||Sm()||tu()&&this.autoplayFailed||!this.videoTrack||this.videoTrack.readyState!=="live"||(Ut.debug("[track-".concat(this.trackId,"] video element paused, auto resume")),this.videoElement.play());break;case"waiting":this.videoElementStatus=uu.WAITING;break;case"abort":this.videoElementStatus=uu.ABORT;break;case"ended":this.videoElementStatus=uu.ENDED;break;case"emptied":this.videoElementStatus=uu.EMPTIED;break;case"error":{const ct=this.videoElement.error;ct&&(this.videoElementStatus=uu.ERROR,Ut.error("[".concat(this.trackId,"] media error: ").concat(ct.message," (").concat(ct.code,")")));break}case"timeupdate":{const ct=performance.now();if(this.timeUpdatedCount+=1,this.timeUpdatedCount<10)return void(this.lastTimeUpdatedTime=ct);const ut=ct-this.lastTimeUpdatedTime,pt=this.lastTimeUpdatedTime;if(this.lastTimeUpdatedTime=ct,L_.lastVisibleTime<L_.lastHiddenTime||pt<L_.lastHiddenTime||pt<L_.lastVisibleTime||this.isSkipCalcRenderFreezeTime())return;for(ut>rn("VIDEO_FREEZE_DURATION")&&(this.freezeTime+=ut),this.playbackTime+=ut;this.playbackTime>=6e3;){this.playbackTime-=6e3;const mt=Math.min(6e3,this.freezeTime);this.freezeTimeCounterList.push(mt),this.freezeTime=Math.max(0,this.freezeTime-6e3)}break}}}),Fn(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&(Ut.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(p3())),S3()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),this.trackId=rt.trackId,this.config=rt,rt.element instanceof HTMLVideoElement?this.videoElement=rt.element:this.videoElement=document.createElement("video"),rs.on(Kl.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),rs.on(Kl.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16)}getVideoElement(){return this.videoElement}getContainerElement(){var rt;return(rt=this.videoElement.parentElement)!==null&&rt!==void 0?rt:void 0}updateConfig(rt){this.config=rt,this.trackId=rt.trackId,rt.element!==this.videoElement&&(this.destroy(),this.videoElement=rt.element),this.videoTrack&&this.initVideoElement()}updateVideoTrack(rt){this.videoTrack!==rt&&(this.videoTrack=rt,this.initVideoElement())}play(rt){const it=this.videoElement.play();it&&it.catch&&it.catch(ut=>{rt&&yB(rt,"video",ut.message,this.trackId),ut.name==="NotAllowedError"?(Ut.warning("detected video element autoplay failed",ut),this.autoplayFailed=!0,this.handleAutoPlayFailed()):Ut.warning("[".concat(this.trackId,"] play warning: "),ut)});const ct=No();if((ct.name==="Safari"&&Number(ct.version)===15||hS())&&it&&it.then){const ut=()=>{this.config.mirror&&(this.videoElement.style.transform="rotateY(180deg)")};it.then(ut).catch(ut)}}getCurrentFrame(){const rt=document.createElement("canvas");rt.width=this.videoElement.videoWidth,rt.height=this.videoElement.videoHeight;const it=rt.getContext("2d");if(!it)return Ut.error("create canvas context failed!"),new ImageData(2,2);it.drawImage(this.videoElement,0,0,rt.width,rt.height);const ct=it.getImageData(0,0,rt.width,rt.height);return rt.remove(),ct}async getCurrentFrameToUint8Array(rt){let it=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;const ct=document.createElement("canvas");ct.width=this.videoElement.videoWidth,ct.height=this.videoElement.videoHeight;const ut=ct.getContext("2d");return ut?(ut.drawImage(this.videoElement,0,0,ct.width,ct.height),new Ir((pt,mt)=>{ct.toBlob(async _t=>{if(ct.remove(),_t){const vt=await xB(_t);pt({buffer:vt,width:ct.width,height:ct.height})}else mt(new Yn(tn.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},rt,it<0?.1:it>1?1:it)})):await XO(rt)}destroy(){this.isDestroyed=!0,rs.off(Kl.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),rs.off(Kl.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),this.videoElement.srcObject=null,this.resetVideoElement(),this.freezeTimeCounterList=[],this.videoState=N_.VideoStateStopped}initVideoElement(){if(this.videoElementStatus=uu.INIT,!this.videoElementCheckInterval&&(mF.forEach(pt=>{this.videoElement.addEventListener(pt,this.handleVideoEvents)}),this.videoElementCheckInterval=window.setInterval(()=>{this._isInPage=function(pt){return pt!==document.body&&document.body.contains(pt)}(this.videoElement)},1e3),rn("ENABLE_VIDEO_FRAME_CALLBACK"))){var rt,it;let pt;const mt=()=>{document.visibilityState==="visible"&&(document.removeEventListener("visibilitychange",mt),this.videoElementFreezeTimeout=window.setTimeout(_t,rn("VIDEO_FREEZE_DURATION")))},_t=()=>{this.videoElementFreezeTimeout=void 0,this.videoState===N_.VideoStateDecoding&&(document.visibilityState==="visible"?this.videoState=N_.VideoStateFrozen:document.addEventListener("visibilitychange",mt))},vt=(Tt,bt)=>{if(this.videoElementStatus===uu.PLAYING){if(pt){const Dt=bt.presentationTime-pt.presentationTime,jt=bt.presentedFrames-pt.presentedFrames;this._render_interframe_delays_sizes.push(jt),this._render_interframe_delays.push(Dt);const $t=AO(this._render_interframe_delays_sizes),Ht=$t-this._render_interframe_delays_sizes[0];if($t>30&&Ht>5&&(this._render_interframe_delays_sizes.shift(),this._render_interframe_delays.shift()),this.videoState===N_.VideoStateStarting&&(this.videoState=N_.VideoStateDecoding),this.videoState===N_.VideoStateDecoding&&this.onVideoStateChanged&&(this.videoElementFreezeTimeout&&window.clearTimeout(this.videoElementFreezeTimeout),this.videoElementFreezeTimeout=window.setTimeout(_t,rn("VIDEO_FREEZE_DURATION"))),Dt<rn("VIDEO_FREEZE_DURATION")&&this.videoState===N_.VideoStateFrozen&&(this.videoState=N_.VideoStateDecoding),Dt>rn("VIDEO_FREEZE_DURATION")&&L_.lastVisibleTime>=L_.lastHiddenTime&&pt.timestamp>L_.lastVisibleTime&&pt.timestamp>L_.lastHiddenTime){const en=Math.min(66,fF(this._render_interframe_delays_sizes,this._render_interframe_delays)),Qt=Math.max(0,Dt-(jt-1)*en);this.renderFreezeAccTime2+=Qt>en?Qt:0,this.renderFreezeAccTime+=Dt}}pt=Ss(Ss({},bt),{},{timestamp:Tt})}else this.isSkipCalcRenderFreezeTime()&&(pt=Ss(Ss({},bt),{},{timestamp:Tt}));var Ot,Mt;rn("ENABLE_VIDEO_FRAME_CALLBACK")&&((Ot=(Mt=this.videoElement).requestVideoFrameCallback)===null||Ot===void 0||Ot.call(Mt,vt))};(rt=(it=this.videoElement).requestVideoFrameCallback)===null||rt===void 0||rt.call(it,vt)}this.videoElement.controls=!1,this.videoElement.setAttribute("playsinline",""),dw()&&!rn("HIDE_NO_POSTER")&&(this.videoElement.poster="noposter");const ct=No();ct.name==="Safari"&&Number(ct.version)===15||hS()||!this.config.mirror||(this.videoElement.style.transform="rotateY(180deg)"),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover",this.videoElement.setAttribute("muted",""),this.videoElement.muted=!0,this.videoElement.srcObject&&this.videoElement.srcObject instanceof MediaStream?this.videoElement.srcObject.getVideoTracks()[0]!==this.videoTrack&&(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,Gs()&&this.videoElement.load()):(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,Gs()&&this.videoElement.load());const ut=this.videoElement.play();ut!==void 0&&ut.catch(pt=>{Ut.debug("[".concat(this.trackId,"] playback interrupted"),pt.toString())})}resetVideoElement(){mF.forEach(rt=>{this.videoElement&&this.videoElement.removeEventListener(rt,this.handleVideoEvents)}),this.videoElementCheckInterval&&(window.clearInterval(this.videoElementCheckInterval),this.videoElementCheckInterval=void 0),this.videoElementStatus=uu.NONE}isSkipCalcRenderFreezeTime(){return this.videoElementStatus===uu.DESTROYED||this.internal}handleAutoPlayFailed(){const rt=it=>{it.preventDefault(),this.videoElement.play().then(()=>{Ut.debug("[".concat(this.trackId,"] Video element for trackId:").concat(this.trackId," autoplay resumed."))}).catch(ct=>{Ut.error(ct)}),this.autoplayFailed=!1,uA()?document.body.removeEventListener("click",rt,!0):(document.body.removeEventListener("touchstart",rt,!0),document.body.removeEventListener("mousedown",rt,!0))};uA()?document.body.addEventListener("click",rt,!0):(document.body.addEventListener("touchstart",rt,!0),document.body.addEventListener("mousedown",rt,!0)),vB()}}const mF=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","timeupdate","error"];class JO extends qO{constructor(rt){let it=arguments.length>1&&arguments[1]!==void 0&&arguments[1];super(rt),Fn(this,"container",void 0),Fn(this,"slot",void 0),this.slot=rt.element,this.internal=it,this.updateConfig(rt)}updateConfig(rt){this.config=rt,this.trackId=rt.trackId;const it=rt.element;var ct;!this.internal||this.slot?(it!==this.slot&&(this.destroy(),this.slot=it),this.createElements()):(this.slot=it,it&&this.container?(this.internal=!1,this.container.id="agora-video-player-".concat(this.trackId),this.videoElement.id="video_".concat(this.trackId),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover",(ct=this.slot)===null||ct===void 0||ct.appendChild(this.container)):this.createElements())}updateVideoTrack(rt){this.videoTrack!==rt&&(this.videoTrack=rt,this.createElements())}play(rt){var it;(it=this.container)!==null&&it!==void 0&&it.contains(this.videoElement)&&super.play(rt)}getCurrentFrame(){var rt;return(rt=this.container)!==null&&rt!==void 0&&rt.contains(this.videoElement)?super.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameToUint8Array(rt){var it;let ct=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return(it=this.container)!==null&&it!==void 0&&it.contains(this.videoElement)?await super.getCurrentFrameToUint8Array(rt,ct):await XO(rt)}destroy(){if(super.destroy(),this.videoElement.remove(),this.videoElement=document.createElement("video"),this.container){try{var rt;this.container.remove(),(rt=this.slot)===null||rt===void 0||rt.removeChild(this.container)}catch{}this.container=void 0}}createElements(){var rt;this.container||(this.container=document.createElement("div")),this.container.id="agora-video-player-".concat(this.trackId),this.container.style.width="100%",this.container.style.height="100%",this.container.style.position="relative",this.container.style.overflow="hidden",this.videoTrack?(this.container.style.backgroundColor="black",rn("KEEP_LAST_FRAME")&&this.isKeepLastFrame&&this.videoElement.paused&&this.resetVideoElement(),this.mountedVideoElement()):this.unmountedVideoElement(),(rt=this.slot)===null||rt===void 0||rt.appendChild(this.container)}mountedVideoElement(){var rt;!this.container||(rt=this.container)!==null&&rt!==void 0&&rt.contains(this.videoElement)||this.container.appendChild(this.videoElement),super.initVideoElement(),this.videoElement.id="video_".concat(this.trackId),this.videoElement.className="agora_video_player",this.videoElement.style.width="100%",this.videoElement.style.height="100%",this.videoElement.style.position="absolute",this.videoElement.style.left="0",this.videoElement.style.top="0"}unmountedVideoElement(){var rt;if((rt=this.container)!==null&&rt!==void 0&&rt.contains(this.videoElement)){super.resetVideoElement();try{this.container&&this.container.removeChild(this.videoElement)}catch{}this.videoElement=document.createElement("video")}}resetVideoElement(){var rt;(rt=this.container)!==null&&rt!==void 0&&rt.contains(this.videoElement)&&(super.resetVideoElement(),this.cacheVideoElement=this.videoElement,this.videoElement=document.createElement("video"))}getContainerElement(){return this.container}}var gF,_F,EF,vF,yF,SF,TF,AF,CF,bF,RF,wF,IF,xF,OF,MF,PF,NF,DF,LF,kF,UF,BF,FF,VF,GF,$F,HF,Ao,jF,zF,WF,KF,YF,XF,qF,JF,$p;let Cs=(gF=Jr({argsMap:(_e,rt,it)=>[_e.getTrackId(),typeof rt=="string"?rt:rt instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",it]}),_F=zs(),EF=Jr({argsMap:_e=>[_e.getTrackId()]}),vF=gS("LocalVideoTrack","_enabledMutex"),yF=Jr({argsMap:(_e,rt)=>[_e.getTrackId(),rt]}),SF=zs(),TF=gS("LocalVideoTrack","_enabledMutex"),AF=Jr({argsMap:(_e,rt)=>[_e.getTrackId(),rt]}),CF=zs(),bF=Jr({argsMap:(_e,rt)=>[_e.getTrackId(),rt,_e._saveEncodeBitrateRatio]}),RF=zs(),wF=Jr({argsMap:(_e,rt)=>[_e.getTrackId(),rt]}),IF=zs(),xF=zs(),OF=Jr({argsMap:(_e,rt,it)=>[_e.getTrackId(),rt,it]}),MF=zs(),PF=zs(),NF=zs(),DF=Jr({argsMap:_e=>[_e.getTrackId()]}),LF=zs(),kF=zs(),UF=zs(),BF=zs(),FF=zs(),VF=Jr({argsMap:(_e,rt)=>[_e.getTrackId(),rt.name]}),GF=Jr({argsMap:_e=>[_e.getTrackId()]}),$F=Jr({argsMap:_e=>[_e.getTrackId()]}),HF=Jr({argsMap:(_e,rt,it)=>[_e.getTrackId(),rt.label,it]}),Ao=class E$ extends CS{get videoHeight(){if(tu()){const{height:rt}=this._mediaStreamTrack.getSettings();return this._videoHeight=rt,this._videoHeight}return this._videoHeight}get videoWidth(){if(tu()){const{width:rt}=this._mediaStreamTrack.getSettings();return this._videoWidth=rt,this._videoWidth}return this._videoWidth}get isPlaying(){return!(!this._player||this._player.videoElementStatus!==uu.PLAYING)}get processorDestination(){return this._processorDestination}get processorContext(){return this._processorContext}set processorContext(rt){this._processorContext=rt}get __className__(){return"LocalVideoTrack"}constructor(rt,it,ct,ut,pt,mt){if(super(rt,pt),Fn(this,"trackMediaType",AS.VIDEO),Fn(this,"_player",void 0),Fn(this,"isUseScaleResolutionDownBy",!1),Fn(this,"_videoVisibleTimer",null),Fn(this,"_previousVideoVisibleStatus",void 0),Fn(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),Fn(this,"_encoderConfig",void 0),Fn(this,"_scalabilityMode",{numSpatialLayers:1,numTemporalLayers:1}),Fn(this,"_optimizationMode",void 0),Fn(this,"_saveEncodeBitrateRatio",1),Fn(this,"_videoHeight",void 0),Fn(this,"_videoWidth",void 0),Fn(this,"_forceBitrateLimit",void 0),Fn(this,"_enabled",!0),Fn(this,"_processorDestination",void 0),Fn(this,"_processorContext",void 0),tu()){const{width:_t,height:vt}=rt.getSettings();this._videoWidth=_t,this._videoHeight=vt}else this.updateMediaStreamTrackResolution();if(this._scalabilityMode=ct,this._optimizationMode=ut,this._hints=mt||[],it&&this._hints.indexOf(ds.CUSTOM_TRACK)!==-1?this._encoderConfig=Ds(it):this._encoderConfig=it,this._hints.indexOf(ds.SCREEN_TRACK)===-1)this.updateBitrateFromProfile();else if(uO(Ho.CHROME,115)&&lw().indexOf("Windows")!==-1){const _t=function(vt,Tt){if("VideoFrame"in window&&"TransformStream"in window&&Fo().supportWebRTCInsertableStream){const bt=new MediaStreamTrackProcessor(vt),Ot=new MediaStreamTrackGenerator({kind:"video"});let Mt,Dt,jt=Date.now();const $t=()=>{Ht&&(clearInterval(Ht),Ht=void 0),Mt&&(Mt.close(),Mt=void 0),vt.stop(),Dt=void 0,Ot.removeEventListener("ended",$t)};let Ht=window.setInterval(()=>{if(Dt&&Mt&&Date.now()-jt>(Tt??1e3))try{Ot.readyState==="live"?Dt.enqueue(Mt.clone()):$t()}catch{$t()}},Tt??1e3);const en=new TransformStream({transform:(Qt,on)=>{Ot.readyState==="live"?(Dt=on,jt=Date.now(),Mt===void 0?(Mt=Qt,on.enqueue(Qt.clone())):(on.enqueue(Mt),Mt=Qt)):Qt.close()}});return Ot.addEventListener("ended",$t),bt.readable.pipeThrough(en).pipeTo(Ot.writable),Ot}}(rt);_t&&(Ut.info("local screen video track begin to inject frame"),this._mediaStreamTrack=_t)}it&&this._hints.indexOf(ds.CUSTOM_TRACK)!==-1&&this.setEncoderConfiguration(it),this._processorContext=new TB(this.getTrackId(),"local"),this._processorDestination=new SB(this.processorContext),this.bindProcessorDestinationEvents()}play(rt){let it=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof rt=="string"){const ut=document.getElementById(rt);ut?rt=ut:(Ut.warning("[".concat(this.getTrackId(),'] can not find "#').concat(rt,'" element, use document.body')),rt=document.body)}Ut.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(rt instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(it));const ct=Ss(Ss(Ss({},this._getDefaultPlayerConfig()),it),{},{trackId:this.getTrackId(),element:rt});this._player?this._player.updateConfig(ct):(rt instanceof HTMLVideoElement?this._player=new qO(ct):this._player=new JO(ct),this._player.updateVideoTrack(this._mediaStreamTrack)),this._player.play(),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const ut=this.getVideoElementVisibleStatus();this.safeEmit(TS.VIDEO_ELEMENT_VISIBLE_STATUS,ut)}catch{}},rn("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,Ut.debug("[".concat(this.getTrackId(),"] stop video playback")))}async setEnabled(rt,it){if(!it){if(rt===this._enabled)return;this.stateCheck("enabled",rt)}if(Ut.info("[".concat(this.getTrackId(),"] start setEnabled"),rt),!rt){this._originMediaStreamTrack.enabled=!1;try{await ps(this,Lr.NEED_DISABLE_TRACK,this)}catch(ct){throw Ut.error("[".concat(this.getTrackId(),"] setEnabled to false error"),ct.toString()),ct}return it||(this._enabled=!1),void Ut.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}this._originMediaStreamTrack.enabled=!0;try{await ps(this,Lr.NEED_ENABLE_TRACK,this)}catch(ct){throw Ut.error("[".concat(this.getTrackId(),"] setEnabled to true error"),ct.toString()),ct}Ut.info("[".concat(this.getTrackId(),"] setEnabled to true success")),it||(this._enabled=!0)}async setMuted(rt){rt!==this._muted&&(this.stateCheck("muted",rt),this._muted=rt,this._originMediaStreamTrack.enabled=!rt,Ut.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(rt)),rt?await ps(this,Lr.NEED_MUTE_TRACK,this):await ps(this,Lr.NEED_UNMUTE_TRACK,this))}async setSaveEncodeBitrateRatio(){let rt=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this._saveEncodeBitrateRatio;if(this._saveEncodeBitrateRatio!==1&&this._encoderConfig&&this._encoderConfig.bitrateMax&&this._encoderConfig.bitrateMin){this._encoderConfig.bitrateMin=Math.floor(this._encoderConfig.bitrateMin*rt),this._encoderConfig.bitrateMax=Math.floor(this._encoderConfig.bitrateMax*rt),Ut.debug("[".concat(this.getTrackId(),"] set save encode bitrate ratio, ").concat(rt)),this._saveEncodeBitrateRatio=1;try{await ps(this,Lr.NEED_UPDATE_VIDEO_ENCODER,this)}catch(it){return it.throw(Ut)}}}async setEncoderConfiguration(rt,it){if(!this._enabled)throw new Yn(tn.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");if(rt=Cm(rt),rn("USE_STANDARD_BITRATE_DEFAULT")&&(delete rt.bitrateMax,delete rt.bitrateMin),this._forceBitrateLimit&&(rt.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:rt.bitrateMax,rt.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:rt.bitrateMin),rt.width||rt.height||rt.frameRate){const ct=bw({encoderConfig:rt});(tu()||Tu()||Sm())&&(ct.deviceId=void 0),Ut.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(rt),JSON.stringify(ct));try{await this._originMediaStreamTrack.applyConstraints(ct),this.updateMediaStreamTrackResolution()}catch(ut){const pt=new Yn(tn.UNEXPECTED_ERROR,ut.toString());throw Ut.error("[".concat(this.getTrackId(),"] applyConstraints error"),pt.toString()),pt}}this._encoderConfig=rt,this._hints.indexOf(ds.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await ps(this,Lr.NEED_UPDATE_VIDEO_ENCODER,this)}catch(ct){return ct.throw(Ut)}}getStats(){return tv(()=>{Ut.warning("[deprecated] LocalVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalVideoStats instead")},"localVideoTrackGetStatsWarning"),Dp(this,Lr.GET_STATS)||Ss({},$O)}async setBeautyEffect(rt){Ut.error("LocalVideoTrack.setBeautyEffect was deprecated, please migrate to agora-extension-beauty-effect")}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameImage(rt){let it=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return this._player?this._player.getCurrentFrameToUint8Array(rt,it):await XO(rt)}async findClosestProfile(){const{width:rt,height:it,frameRate:ct}=this.getMediaStreamTrackSettings(),{width:ut,height:pt,frameRate:mt}=this._encoderConfig||{},_t=mS(this._videoWidth||rt||ut||0),vt=mS(this._videoHeight||it||pt||0),Tt=function(bt,Ot,Mt){if(!Array.isArray(rn("VIDEO_ENCODER_CONFIG_LIST"))||rn("VIDEO_ENCODER_CONFIG_LIST").length===0)return!1;const Dt=Math.min(bt,Ot);return!(Dt>=480)&&Ss(Ss({},rn("VIDEO_ENCODER_CONFIG_LIST").find(jt=>jt.height>Dt)),{},{frameRate:Mt})}(_t,vt,mS(ct||mt||15));if(Tt)return Ut.debug("[".concat(this.getTrackId(),"] find closest profile, ").concat(_t,"x").concat(vt," => ").concat(JSON.stringify(Tt))),this.setEncoderConfiguration(Tt)}async setBitrateLimit(rt){Ut.debug("[".concat(this.getTrackId(),"] set bitrate limit, ").concat(JSON.stringify(rt))),rt&&(this._forceBitrateLimit=rt,this._encoderConfig&&(this._encoderConfig.bitrateMax?this._encoderConfig.bitrateMax=this._encoderConfig.bitrateMax<rt.max_bitrate?this._encoderConfig.bitrateMax:rt.max_bitrate:this._encoderConfig.bitrateMax=rt.max_bitrate,this._encoderConfig.bitrateMin,this._encoderConfig.bitrateMin=rt.min_bitrate))}async setOptimizationMode(rt){if(rt!=="motion"&&rt!=="detail"&&rt!=="balanced")return void Ut.error(tn.INVALID_PARAMS,"optimization mode must be motion, detail or balanced");const it=this._optimizationMode;try{this._optimizationMode=rt,await ps(this,Lr.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this)}catch(ct){throw this._optimizationMode=it,Ut.error("[".concat(this.getTrackId(),"] set optimization mode failed"),ct.toString()),ct}Ut.info("[".concat(this.getTrackId(),"] set optimization mode success (").concat(rt,")"))}setScalabiltyMode(rt){if(rt.numSpatialLayers===1&&rt.numTemporalLayers!==1)return Ut.error(tn.INVALID_PARAMS,"scalability mode currently not supported, no SVC."),void(this._scalabilityMode={numSpatialLayers:1,numTemporalLayers:1});this._scalabilityMode=rt,Ut.info("[".concat(this.getTrackId(),"] set scalability mode success (").concat(rt,")"))}updateMediaStreamTrackResolution(){bB(this._originMediaStreamTrack).then(rt=>{let[it,ct]=rt;this._videoHeight=ct,this._videoWidth=it}).catch(fw)}_updatePlayerSource(){this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}_getDefaultPlayerConfig(){return{fit:"contain"}}async setSenderConfiguration(rt){if(!this._enabled)throw new Yn(tn.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");Ut.debug("[".concat(this.getTrackId(),"] setSenderConfiguration applyConstraints"),JSON.stringify(rt)),rt=Cm(rt),this._forceBitrateLimit&&(rt.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:rt.bitrateMax,rt.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:rt.bitrateMin),this._encoderConfig=rt,this._hints.indexOf(ds.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await ps(this,Lr.NEED_UPDATE_VIDEO_ENCODER,this)}catch(it){return it.throw(Ut)}}updateBitrateFromProfile(){if(!this._encoderConfig)return;const{width:rt,height:it,frameRate:ct}=this.getMediaStreamTrackSettings();if(!rt||!it||!ct)return;const{bitrateMax:ut,bitrateMin:pt}=this._encoderConfig;if(pt==null||ut==null){const{max:mt,min:_t}=function(vt,Tt,bt,Ot,Mt){const Dt=rn("BITRATE_ADAPTER_TYPE");if(Dt==="DEFAULT_BITRATE")return{min:Ot,max:Mt};if(Mt===void 0){const jt=Math.floor(200*Math.pow(bt/15,.6)*Math.pow(vt*Tt/640/360,.75));Mt=Dt==="STANDARD_BITRATE"?4*jt:2*jt,Ot=Ot??jt}else Ot=Ot??Math.floor(Mt/10);return{min:Ot,max:Mt}}(rt,it,ct,pt,ut);if(this._encoderConfig.bitrateMin=_t,this._encoderConfig.bitrateMax=mt,rn("VIDEO_STANDARD_BITRATE_VERSION")&&pt==null&&ut==null){const[vt,Tt]=function(bt,Ot,Mt){const Dt=4*Math.floor(2e5*Math.pow(Mt/15,.6)*Math.pow(bt*Ot/230400,.75)),jt=bt*Ot,$t=new Map([[19200,.9],[230400,.85],[518400,.75],[921600,.7],[2073600,.6],[3686400,.5]]),Ht=new Map([[230400,.95],[518400,.9],[921600,.85],[2073600,.8]]);let en=Sp($t).call($t).next().value,Qt=1;if($t.has(jt))en=$t.get(jt);else{var on;const ur=s0(on=Array.from($t.entries())).call(on,(Eo,no)=>{let[Yo]=Eo,[jo]=no;return Yo-jo}),go=ur.find(Eo=>{let[no]=Eo;return no>jt});if(go){const Eo=ur.indexOf(go);if(Eo>0){const no=ur[Eo-1],Yo=(jt-no[0])/(go[0]-no[0]);en=no[1]+Yo*(go[1]-no[1])}else en=go[1]}else en=ur[ur.length-1][1]}if(Ht.has(jt))Qt=Ht.get(jt);else{var Tn;const ur=s0(Tn=Array.from(Ht.entries())).call(Tn,(Eo,no)=>{let[Yo]=Eo,[jo]=no;return Yo-jo}),go=ur.find(Eo=>{let[no]=Eo;return no>jt});if(go){const Eo=ur.indexOf(go);if(Eo>0){const no=ur[Eo-1],Yo=(jt-no[0])/(go[0]-no[0]);Qt=no[1]+Yo*(go[1]-no[1])}else Qt=go[1]}else Qt=ur[ur.length-1][1]}const vn=rn("VIDEO_NEW_BITRATE_RATIO");vn&&vn>0&&(en=vn/100);const hn=Math.floor(Dt*en),Ln=Math.floor(65e4*Math.pow(bt*Ot/230400,.5)*Math.pow(Mt/15,.69));let Xn=hn;const Qn=rn("VIDEO_STANDARD_BITRATE_VERSION");return Qn&&Qn>0&&(Qn===1?Xn=Dt:Qn===2?Xn=hn:Qn===3&&(Xn=Ln)),[Math.floor(Xn/1e3),Qt]}(rt,it,ct);this._encoderConfig.bitrateMax=vt,this._encoderConfig.bitrateMin=_t?Math.min(_t,vt):vt,this._saveEncodeBitrateRatio=Tt,Ut.debug("[".concat(this.getTrackId(),"] update new bitrate from profile, [w: ").concat(rt,", h: ").concat(it,", fps: ").concat(ct,"] => [brMax: ").concat(this._encoderConfig.bitrateMax,", brMin: ").concat(this._encoderConfig.bitrateMin,", save_bitrate_ratio: ").concat(this._saveEncodeBitrateRatio,"]"))}else Ut.debug("[".concat(this.getTrackId(),"] update bitrate from profile, [w: ").concat(rt,", h: ").concat(it,", fps: ").concat(ct,"] => [brMax: ").concat(mt,", brMin: ").concat(_t,"]")),this._saveEncodeBitrateRatio=1}}getVideoElementVisibleStatus(){try{var rt,it;const ct=this==null||(rt=this._player)===null||rt===void 0?void 0:rt.getContainerElement(),ut={track:this,element:this==null||(it=this._player)===null||it===void 0?void 0:it.getVideoElement(),slot:ct==null?void 0:ct.parentElement},{element:pt,slot:mt}=ut;if(this.isPlaying&&pt instanceof HTMLVideoElement&&mt instanceof HTMLElement){const _t=R3.checkOneElementVisible(pt),vt=Object.assign({},_t);if(vt.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=vt.visible;const Tt=Vr.reportApiInvoke(null,{tag:Ns.TRACER,name:Ks.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});vt.visible?Tt.onSuccess("Video is visible"):Tt.onSuccess("Invisible because of ".concat(vt.reason))}return vt}return}catch(ct){throw new Yn(tn.GET_VIDEO_ELEMENT_VISIBLE_ERROR,ct.message)}}async renewMediaStreamTrack(rt){}pipe(rt){if(this.processor===rt)return rt;if(rt._source)throw new Yn(tn.INVALID_OPERATION,"Processor ".concat(rt.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=rt,this.processor._source=this,rt.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),rt}unpipe(){if(!this.processor)return;const rt=this.processor;this.processor._source=void 0,this.processor=void 0,rt.reset()}close(){super.close(),this.unbindProcessorDestinationEvents(),this.unbindProcessorContextEvents(),this.unpipe(),this.processorDestination._source&&this.processorDestination._source.unpipe()}clone(rt){let it=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],ct=this._encoderConfig;rt&&(ct=Ss(Ss({},ct),Cm(rt))),ct=m0(ct);const ut=ms(8,"track-video-cloned-"),pt=new E$(it?this._mediaStreamTrack.clone():this._mediaStreamTrack,ct,m0(this._scalabilityMode),this._optimizationMode,ut,m0(this._hints));return rt&&ct&&pt.setEncoderConfiguration(ct),Ut.debug("clone video track from ".concat(this.getTrackId()," to ").concat(ut,", clone ").concat(it)),pt}async replaceTrack(rt,it){if(!(rt instanceof MediaStreamTrack))throw new Yn(tn.INVALID_PARAMS,"track should be an instance of MediaStreamTrack");if(rt.kind!=="video")throw new Yn(tn.INVALID_PARAMS,"track should be a video MediaStreamTrack");await this._updateOriginMediaStreamTrack(rt,it,!0),this.updateMediaStreamTrackResolution()}sendSeiData(rt){if(tv(()=>{Vr.reportApiInvoke(null,{name:Ks.LOCAL_VIDEO_SEND_SEI_DATA,options:[],tag:Ns.TRACER}).onSuccess("")},this._mediaStreamTrack.id||this.getTrackId()),!rn("ENABLE_VIDEO_SEI")||!rn("ENABLE_ENCODED_TRANSFORM"))return void Ut.warning('To send/receive SEI, please call AgoraRTC.setParameter("ENABLE_VIDEO_SEI", true) before instantiate IAgoraRtcClient');if(rt instanceof Uint8Array==0)return new Yn(tn.INVALID_PARAMS,"Invalid argument type, ILocalVideoTrack.sendSeiData() only accept Uint8Array argument.").throw();const it=this.getRTCRtpTransceiver();if(!it)return void Ut.warning("Video track is not published, SEI can not be send");const ct=it.sender.getParameters();if(ct.codecs.length===0)return;const ut=ct.codecs[0].mimeType.toLocaleLowerCase();ut==="video/h264"||ut==="video/h265"?this.safeEmit("sei-to-send",rt):Ut.warning("SEI is not supported by ".concat(ut))}bindProcessorDestinationEvents(){this.processorDestination.on(Fu.ON_TRACK,async rt=>{rt?rt!==this._mediaStreamTrack&&(this._mediaStreamTrack=rt,this._updatePlayerSource(),await ps(this,Lr.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await ps(this,Lr.NEED_REPLACE_TRACK,this))})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(Fu.ON_TRACK)}unbindProcessorContextEvents(){this.processorContext.removeAllListeners(Up.REQUEST_UPDATE_CONSTRAINTS),this.processorContext.removeAllListeners(Up.REQUEST_CONSTRAINTS)}},Po(Ao.prototype,"play",[gF,_F],Object.getOwnPropertyDescriptor(Ao.prototype,"play"),Ao.prototype),Po(Ao.prototype,"stop",[EF],Object.getOwnPropertyDescriptor(Ao.prototype,"stop"),Ao.prototype),Po(Ao.prototype,"setEnabled",[vF,yF,SF],Object.getOwnPropertyDescriptor(Ao.prototype,"setEnabled"),Ao.prototype),Po(Ao.prototype,"setMuted",[TF,AF,CF],Object.getOwnPropertyDescriptor(Ao.prototype,"setMuted"),Ao.prototype),Po(Ao.prototype,"setSaveEncodeBitrateRatio",[bF,RF],Object.getOwnPropertyDescriptor(Ao.prototype,"setSaveEncodeBitrateRatio"),Ao.prototype),Po(Ao.prototype,"setEncoderConfiguration",[wF,IF],Object.getOwnPropertyDescriptor(Ao.prototype,"setEncoderConfiguration"),Ao.prototype),Po(Ao.prototype,"getStats",[xF],Object.getOwnPropertyDescriptor(Ao.prototype,"getStats"),Ao.prototype),Po(Ao.prototype,"setBeautyEffect",[OF,MF],Object.getOwnPropertyDescriptor(Ao.prototype,"setBeautyEffect"),Ao.prototype),Po(Ao.prototype,"getCurrentFrameData",[PF],Object.getOwnPropertyDescriptor(Ao.prototype,"getCurrentFrameData"),Ao.prototype),Po(Ao.prototype,"getCurrentFrameImage",[NF],Object.getOwnPropertyDescriptor(Ao.prototype,"getCurrentFrameImage"),Ao.prototype),Po(Ao.prototype,"findClosestProfile",[DF,LF],Object.getOwnPropertyDescriptor(Ao.prototype,"findClosestProfile"),Ao.prototype),Po(Ao.prototype,"setBitrateLimit",[kF],Object.getOwnPropertyDescriptor(Ao.prototype,"setBitrateLimit"),Ao.prototype),Po(Ao.prototype,"setOptimizationMode",[UF],Object.getOwnPropertyDescriptor(Ao.prototype,"setOptimizationMode"),Ao.prototype),Po(Ao.prototype,"setScalabiltyMode",[BF],Object.getOwnPropertyDescriptor(Ao.prototype,"setScalabiltyMode"),Ao.prototype),Po(Ao.prototype,"updateMediaStreamTrackResolution",[FF],Object.getOwnPropertyDescriptor(Ao.prototype,"updateMediaStreamTrackResolution"),Ao.prototype),Po(Ao.prototype,"pipe",[VF],Object.getOwnPropertyDescriptor(Ao.prototype,"pipe"),Ao.prototype),Po(Ao.prototype,"unpipe",[GF],Object.getOwnPropertyDescriptor(Ao.prototype,"unpipe"),Ao.prototype),Po(Ao.prototype,"close",[$F],Object.getOwnPropertyDescriptor(Ao.prototype,"close"),Ao.prototype),Po(Ao.prototype,"replaceTrack",[HF],Object.getOwnPropertyDescriptor(Ao.prototype,"replaceTrack"),Ao.prototype),Ao),Rw=(jF=Jr({argsMap:(_e,rt)=>[_e.getTrackId(),rt]}),zF=zs(),WF=gS("CameraVideoTrack","_enabledMutex"),KF=Jr({argsMap:(_e,rt)=>[_e.getTrackId(),rt]}),YF=zs(),XF=Jr({argsMap:(_e,rt)=>[_e.getTrackId(),rt]}),qF=zs(),JF=Jr({argsMap:_e=>[_e.getTrackId()]}),$p=class v$ extends Cs{get __className__(){return"CameraVideoTrack"}constructor(rt,it,ct,ut,pt,mt){super(rt,Cm(it.encoderConfig),ut,pt,mt),Fn(this,"_config",void 0),Fn(this,"_originalConstraints",void 0),Fn(this,"_constraints",void 0),Fn(this,"_enabled",!0),Fn(this,"_deviceName","default"),Fn(this,"tryResumeVideoForIOS15_16WeChat",async()=>{(hS()||mO())&&!function(){const _t=No();if(_t.os!==Nl.IOS||!_t.osVersion)return!1;const vt=_t.osVersion.split(".");return Number(vt[0])===15&&Number(vt[1])>=2}()&&T3()&&this._enabled&&!this._isClosed&&(Ut.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS 15 device on WeChat.")),await this.renewMediaStreamTrack())}),this._config=it,this._originalConstraints=ct,this._constraints=ct,this._deviceName=rt.label,this._encoderConfig=Cm(this._config.encoderConfig),rs.on(Kl.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),rs.on(Kl.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),this.bindProcessorContextEvents()}async setDevice(rt){return typeof rt=="string"?this._setDeviceById(rt):rt.deviceId?this._setDeviceById(rt.deviceId):rt.facingMode?this._setDeviceByFacingModel(rt.facingMode):void 0}async _setDeviceById(rt){if(Ut.info("[".concat(this.getTrackId(),"] set device to ").concat(rt)),this._enabled)try{const it=await Vp.getDeviceById(rt),ct={};ct.video=Ss({},this._constraints),ct.video.deviceId={exact:rt},ct.video.facingMode=void 0,this._originMediaStreamTrack.stop();let ut=null;try{ut=await Fp(ct,this.getTrackId())}catch(pt){throw Ut.error("[".concat(this.getTrackId(),"] setDevice failed"),pt.toString()),ut=await Fp({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(ut.getVideoTracks()[0],!1),pt}await this._updateOriginMediaStreamTrack(ut.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution(),this._deviceName=it.label,this._config.cameraId=rt,this._constraints.deviceId={exact:rt}}catch(it){throw Ut.error("[".concat(this.getTrackId(),"] setDevice error"),it.toString()),it}else try{const it=await Vp.getDeviceById(rt);this._deviceName=it.label,this._config.cameraId=rt,this._constraints.deviceId={exact:rt}}catch(it){throw Ut.error("[".concat(this.getTrackId(),"] setDevice error"),it.toString()),it}Ut.info("[".concat(this.getTrackId(),"] setDevice success"))}async _setDeviceByFacingModel(rt){Ut.info("[".concat(this.getTrackId(),"] set facingMode ").concat(rt));const it={video:Ss(Ss({},this._constraints),{},{deviceId:void 0,facingMode:{exact:rt}})};if(this._enabled){this._originMediaStreamTrack.stop();let ct=null;try{ct=await Fp(it,this.getTrackId())}catch(ut){throw Ut.error("[".concat(this.getTrackId(),"] setDeviceByFacingModel failed"),ut.toString()),ct=await Fp({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(ct.getVideoTracks()[0],!1),ut}await this._updateOriginMediaStreamTrack(ct.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution()}this._deviceName="",this._config.facingMode=rt,this._config.cameraId=void 0,this._constraints=Ss({},it.video),Ut.info("[".concat(this.getTrackId(),"] setDeviceByFacingModel success"))}async setEnabled(rt,it){if(!it){if(rt===this._enabled)return;this.stateCheck("enabled",rt)}if(Ut.info("[".concat(this.getTrackId(),"] start setEnabled"),rt),rt){try{if(this.isExternalTrack)this._originMediaStreamTrack.enabled=!0;else{const ct=await Fp({video:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(ct.getVideoTracks()[0],!1)}await ps(this,Lr.NEED_ENABLE_TRACK,this)}catch(ct){throw Ut.error("[".concat(this.getTrackId(),"] setEnabled true error"),ct.toString()),ct}this.updateMediaStreamTrackResolution(),Ut.info("[".concat(this.getTrackId(),"] setEnabled to true success")),it||(this._enabled=!0)}else{this.isExternalTrack?this._originMediaStreamTrack.enabled=!1:(this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop()),it||(this._enabled=!1);try{await ps(this,Lr.NEED_DISABLE_TRACK,this)}catch(ct){throw Ut.error("[".concat(this.getTrackId(),"] setEnabled to false error"),ct.toString()),ct}Ut.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}}async setEncoderConfiguration(rt,it){if(!this._enabled)throw new Yn(tn.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");rt=Cm(rt),rn("USE_STANDARD_BITRATE_DEFAULT")&&(delete rt.bitrateMax,delete rt.bitrateMin),this._forceBitrateLimit&&(rt.bitrateMax=this._forceBitrateLimit.max_bitrate||rt.bitrateMax,rt.bitrateMin=this._forceBitrateLimit.min_bitrate||rt.bitrateMin);const ct=Ds(this._config);ct.encoderConfig=rt;const ut=bw(ct);(tu()||Tu()||Sm())&&(ut.deviceId=void 0),Ut.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(rt),JSON.stringify(ut));try{await this._originMediaStreamTrack.applyConstraints(ut),this.updateMediaStreamTrackResolution()}catch(pt){const mt=new Yn(tn.UNEXPECTED_ERROR,pt.toString());throw Ut.error("[".concat(this.getTrackId(),"] applyConstraints error"),mt.toString()),mt}this._config=ct,this._constraints=ut,this._originalConstraints=ut,this._encoderConfig=rt,this._hints.indexOf(ds.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await ps(this,Lr.NEED_UPDATE_VIDEO_ENCODER,this)}catch(pt){return pt.throw(Ut)}}_getDefaultPlayerConfig(){return{mirror:!0,fit:"cover"}}onTrackEnded(){if((Tu()||Sm())&&this._enabled&&!this._isClosed&&rs.duringInterruption){const rt=async()=>{rs.off(Kl.IOS_INTERRUPTION_END,rt),this._enabled&&!this._isClosed&&(Ut.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};rs.on(Kl.IOS_INTERRUPTION_END,rt)}else Ut.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(TS.TRACK_ENDED)}async renewMediaStreamTrack(rt){const it=rt||this._constraints,ct=Vp.searchDeviceIdByName(this._deviceName);if(ct&&!it.deviceId&&(it.deviceId={exact:ct}),this._enabled){const ut=await Fp({video:it},this.getTrackId());this._constraints=it,await this._updateOriginMediaStreamTrack(ut.getVideoTracks()[0],!0),this.updateMediaStreamTrackResolution()}}close(){super.close(),rs.off(Kl.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),rs.off(Kl.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat)}clone(rt){let it=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],ct=this._encoderConfig;rt&&(ct=Ss(Ss({},ct),Cm(rt))),ct=m0(ct);const ut=ms(8,"track-cam-cloned-"),pt=new v$(it?this._mediaStreamTrack.clone():this._mediaStreamTrack,m0(Ss(Ss({},this._config),{},{encoderConfig:ct})),m0(this._constraints),m0(this._scalabilityMode),this._optimizationMode,ut);return rt&&ct&&pt.setEncoderConfiguration(ct),Ut.debug("clone track from ".concat(this.getTrackId()," to ").concat(ut,", clone ").concat(it)),pt}bindProcessorContextEvents(){this.processorContext.on(Up.REQUEST_UPDATE_CONSTRAINTS,async(rt,it,ct)=>{try{const ut=Object.assign({},this._originalConstraints,...rt);await this.renewMediaStreamTrack(ut),it()}catch(ut){ct(ut)}}),this.processorContext.on(Up.REQUEST_CONSTRAINTS,async rt=>{rt(this._originMediaStreamTrack.getSettings())})}},Po($p.prototype,"setDevice",[jF,zF],Object.getOwnPropertyDescriptor($p.prototype,"setDevice"),$p.prototype),Po($p.prototype,"setEnabled",[WF,KF,YF],Object.getOwnPropertyDescriptor($p.prototype,"setEnabled"),$p.prototype),Po($p.prototype,"setEncoderConfiguration",[XF,qF],Object.getOwnPropertyDescriptor($p.prototype,"setEncoderConfiguration"),$p.prototype),Po($p.prototype,"close",[JF],Object.getOwnPropertyDescriptor($p.prototype,"close"),$p.prototype),$p);function ZO(_e,rt,it,ct){it.optimizationMode&&(ct&&ct.width&&ct.height?(it.encoderConfig=Ss(Ss({},ct),{},{bitrateMin:ct.bitrateMin,bitrateMax:ct.bitrateMax}),it.optimizationMode!=="motion"&&it.optimizationMode!=="detail"||(rt.contentHint=it.optimizationMode,rt.contentHint===it.optimizationMode?Ut.debug("[".concat(_e,"] set content hint to"),it.optimizationMode):Ut.debug("[".concat(_e,"] set content hint failed")))):Ut.warning("[".concat(_e,"] can not apply optimization mode bitrate config, no encoderConfig")))}var ZF,QF,eV,tV,em,nV,rV,iV,oV,sV,aV,Iu;class cV extends uB{getUserId(){return this._userId}constructor(rt,it,ct,ut){super(rt,"track-".concat(rt.kind,"-").concat(it,"-").concat(ut.clientId,"_").concat(ms(5,""))),Fn(this,"_userId",void 0),Fn(this,"_uintId",void 0),Fn(this,"_isDestroyed",!1),Fn(this,"store",void 0),Fn(this,"processor",void 0),Fn(this,"processorContext",void 0),this._userId=it,this._uintId=ct,this.store=ut}_updateOriginMediaStreamTrack(rt){this._originMediaStreamTrack=rt,this._mediaStreamTrack=rt,this._updatePlayerSource(),this.processor&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this.processorContext})}_destroy(){this._isDestroyed=!0,Ut.info("[".concat(this.getTrackId(),"] is destroyed")),this.stop(),super.close()}getProcessorStats(){return this.processorContext.gatherStats()}getProcessorUsage(){return this.processorContext.gatherUsage()}}let wS=(ZF=Jr({argsMap:(_e,rt,it)=>[_e.getTrackId(),typeof rt=="string"?rt:rt instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",it]}),QF=Jr({argsMap:_e=>[_e.getTrackId()]}),eV=Jr({argsMap:(_e,rt)=>[_e.getTrackId(),rt.name]}),tV=Jr({argsMap:_e=>[_e.getTrackId()]}),Po((em=class extends cV{get isPlaying(){return!(!this._player||this._player.videoElementStatus!==uu.PLAYING)}get __className__(){return"RemoteVideoTrack"}constructor(_e,rt,it,ct,ut){super(_e,rt,it,ct),Fn(this,"_videoVisibleTimer",null),Fn(this,"_previousVideoVisibleStatus",void 0),Fn(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),Fn(this,"trackMediaType",AS.VIDEO),Fn(this,"_videoWidth",void 0),Fn(this,"_videoHeight",void 0),Fn(this,"_player",void 0),Fn(this,"_prePlayer",void 0),Fn(this,"processorDestination",void 0),Fn(this,"processorContext",void 0),this._prePlayer=ut,this.updateMediaStreamTrackResolution(),this.processorContext=new TB(this.getTrackId(),"remote"),this.processorDestination=new SB(this.processorContext),this.bindProcessorDestinationEvents()}getStats(){return tv(()=>{Ut.warning("[deprecated] RemoteVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteVideoStats instead")},"remoteVideoTrackGetStatsWarning"),Dp(this,Lr.GET_STATS)||Ss({},cB)}play(_e){let rt=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(this.safeEmit(_f.PLAY_START),typeof _e=="string"){const ct=document.getElementById(_e);ct?_e=ct:(Ut.warning("[".concat(this.getTrackId(),'] can not find "#').concat(_e,'" element, use document.body')),_e=document.body)}Ut.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(_e instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(rt));const it=Ss(Ss({fit:"cover"},rt),{},{trackId:this.getTrackId(),element:_e});if(this._player)this._player.updateConfig(it);else{let ct=!1,ut=!1;_e instanceof HTMLVideoElement?(this._player=new qO(it),this._prePlayer&&(this._prePlayer.destroy(),this._prePlayer=void 0,ut=!0)):this._prePlayer&&!this._prePlayer.isDestroyed?(this._player=this._prePlayer,this._prePlayer=void 0,ct=this._player.videoState>0,this._player.updateConfig(it)):this._player=new JO(it),this._player.updateVideoTrack(this._mediaStreamTrack),this._player.onFirstVideoFrameDecoded=()=>{this.store.subscribe(this.getUserId(),"video",void 0,void 0,Date.now()),this.safeEmit(_f.FIRST_FRAME_DECODED),ut&&this.safeEmit(_f.FIRST_FRAME_RENDER)},this._player.onVideoStateChanged=pt=>{this.safeEmit(_f.VIDEO_STATE_CHANGED,pt)},ct&&(this._player.onFirstVideoFrameDecoded(),this._player.onVideoStateChanged(this._player.videoState))}this._player.play(this.store.sessionId||void 0),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const ct=this.getVideoElementVisibleStatus();this.safeEmit(_f.VIDEO_ELEMENT_VISIBLE_STATUS,ct)}catch{}},rn("CHECK_VIDEO_VISIBLE_INTERVAL")),this.safeEmit(_f.PLAY_END)}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,Ut.debug("[".concat(this.getTrackId(),"] stop video playback")))}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}updateMediaStreamTrackResolution(){bB(this._originMediaStreamTrack).then(_e=>{let[rt,it]=_e;this._videoHeight=it,this._videoWidth=rt}).catch(fw)}_updatePlayerSource(){Ut.debug("[".concat(this.getTrackId(),"] update player source track")),this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}getVideoElementVisibleStatus(){try{var _e,rt;const it=this==null||(_e=this._player)===null||_e===void 0?void 0:_e.getContainerElement(),ct={track:this,element:this==null||(rt=this._player)===null||rt===void 0?void 0:rt.getVideoElement(),slot:it==null?void 0:it.parentElement},{element:ut,slot:pt}=ct;if(this.isPlaying&&ut instanceof HTMLVideoElement&&pt instanceof HTMLElement){const mt=R3.checkOneElementVisible(ut),_t=Object.assign({},mt);if(_t.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=_t.visible;const vt=Vr.reportApiInvoke(null,{tag:Ns.TRACER,name:Ks.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});_t.visible?vt.onSuccess("Video is visible"):vt.onSuccess("Invisible because of ".concat(_t.reason))}return _t}return}catch(it){throw new Yn(tn.GET_VIDEO_ELEMENT_VISIBLE_ERROR,it.message)}}pipe(_e){if(this.processor===_e)return _e;if(_e._source)throw new Yn(tn.INVALID_OPERATION,"Processor ".concat(_e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=_e,this.processor._source=this,_e.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),_e}unpipe(){if(!this.processor)return;const _e=this.processor;this.processor._source=void 0,this.processor=void 0,_e.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(Fu.ON_TRACK,async _e=>{_e?_e!==this._mediaStreamTrack&&(this._mediaStreamTrack=_e,this._updatePlayerSource()):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(Fu.ON_TRACK)}_destroy(){this._prePlayer&&(this._prePlayer.destroy(),this._prePlayer=void 0),super._destroy(),this.unbindProcessorDestinationEvents()}_onSei(_e){this.emit(v0.SEI_RECEIVED,_e)}}).prototype,"play",[ZF],Object.getOwnPropertyDescriptor(em.prototype,"play"),em.prototype),Po(em.prototype,"stop",[QF],Object.getOwnPropertyDescriptor(em.prototype,"stop"),em.prototype),Po(em.prototype,"pipe",[eV],Object.getOwnPropertyDescriptor(em.prototype,"pipe"),em.prototype),Po(em.prototype,"unpipe",[tV],Object.getOwnPropertyDescriptor(em.prototype,"unpipe"),em.prototype),em),IS=(nV=Jr({argsMap:(_e,rt)=>[_e.getTrackId(),rt],throttleTime:300}),rV=Jr({argsMap:(_e,rt)=>[_e.getTrackId(),rt]}),iV=Jr({argsMap:_e=>[_e.getTrackId()]}),oV=Jr({argsMap:_e=>[_e.getTrackId()]}),sV=Jr({argsMap:(_e,rt)=>[_e.getTrackId(),rt.name]}),aV=Jr({argsMap:_e=>[_e.getTrackId()]}),Po((Iu=class extends cV{get isPlaying(){return this._useAudioElement?qu.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"RemoteAudioTrack"}constructor(_e,rt,it,ct){super(_e,rt,it,ct),Fn(this,"trackMediaType",AS.AUDIO),Fn(this,"_source",void 0),Fn(this,"_useAudioElement",!0),Fn(this,"_volume",100),Fn(this,"processorContext",void 0),Fn(this,"processorDestination",void 0),Fn(this,"_played",!1),Fn(this,"_bypassWebAudio",!1),rn("DISABLE_WEBAUDIO")?(this._source=new YO,this._bypassWebAudio=!0,this._useAudioElement=!0):(this._source=new fB(_e,!0),rn("REMOTE_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1)),this._source.once(kp.RECEIVE_TRACK_BUFFER,()=>{this.safeEmit(_f.FIRST_FRAME_DECODED)}),this.processorContext=new CB(this._source.context,this.getTrackId(),"remote"),this.processorDestination=new AB(this.processorContext),this.bindProcessorDestinationEvents(),this._source.on(kp.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:this.processorContext})})}setAudioFrameCallback(_e){let rt=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!_e)return this._source.removeAllListeners(kp.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(rt),this._source.removeAllListeners(kp.ON_AUDIO_BUFFER),this._source.on(kp.ON_AUDIO_BUFFER,it=>_e(it))}setVolume(_e){this._volume=_e,this._useAudioElement?qu.setVolume(this.getTrackId(),_e):this._source.setVolume(_e/100)}async setPlaybackDevice(_e){if(!this._useAudioElement||!iB())throw new Yn(tn.NOT_SUPPORTED,"your browser does not support setting the audio output device");await qu.setSinkID(this.getTrackId(),_e)}getVolumeLevel(){return this._source.getAccurateVolumeLevel()}getStats(){return tv(()=>{Ut.warning("[deprecated] RemoteAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteAudioStats instead")},"remoteAudioTrackGetStatsWarning"),Dp(this,Lr.GET_STATS)||Ss({},aB)}play(){Ut.debug("[".concat(this.getTrackId(),"] start audio playback")),this._played=!0,this._useAudioElement?(Ut.debug("[".concat(this.getTrackId(),"] use audio element to play")),qu.play(this._mediaStreamTrack,this.getTrackId(),this._volume,this.store.sessionId||void 0)):this._source.play()}stop(){Ut.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._played=!1,this._useAudioElement?qu.stop(this.getTrackId()):this._source.stop()}_destroy(){super._destroy(),this._played=!1,this.unbindProcessorDestinationEvents(),this._source.destroy()}_isFreeze(){return this._source.isFreeze}_updatePlayerSource(){let _e=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];Ut.debug("[".concat(this.getTrackId(),"] update player source track")),_e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&qu.updateTrack(this.getTrackId(),this._mediaStreamTrack)}pipe(_e){if(this._bypassWebAudio)throw new Yn(tn.NOT_SUPPORTED,"can not pipe extension when WebAudio disabled");if(this.processor===_e)return _e;if(_e._source)throw new Yn(tn.INVALID_OPERATION,"Processor ".concat(_e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=_e,this.processor._source=this,_e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),_e}unpipe(){var _e;if(this._bypassWebAudio)throw new Yn(tn.NOT_SUPPORTED,"can not unpipe extension when WebAudio disabled");if(!this.processor)return;const rt=this.processor;(_e=this._source.processSourceNode)===null||_e===void 0||_e.disconnect(),this.processor._source=!1,this.processor=void 0,rt.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(Fu.ON_TRACK,async _e=>{_e?_e!==this._mediaStreamTrack&&(this._mediaStreamTrack=_e,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(_e)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())}),this.processorDestination.on(Fu.ON_NODE,_e=>{this._source.processedNode=_e;const rt=!_e;this._useAudioElement!==rt&&(this._played?(this.stop(),this._useAudioElement=rt,this.play()):this._useAudioElement=rt)})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(Fu.ON_TRACK),this.processorDestination.removeAllListeners(Fu.ON_NODE)}}).prototype,"setVolume",[nV],Object.getOwnPropertyDescriptor(Iu.prototype,"setVolume"),Iu.prototype),Po(Iu.prototype,"setPlaybackDevice",[rV],Object.getOwnPropertyDescriptor(Iu.prototype,"setPlaybackDevice"),Iu.prototype),Po(Iu.prototype,"play",[iV],Object.getOwnPropertyDescriptor(Iu.prototype,"play"),Iu.prototype),Po(Iu.prototype,"stop",[oV],Object.getOwnPropertyDescriptor(Iu.prototype,"stop"),Iu.prototype),Po(Iu.prototype,"pipe",[sV],Object.getOwnPropertyDescriptor(Iu.prototype,"pipe"),Iu.prototype),Po(Iu.prototype,"unpipe",[aV],Object.getOwnPropertyDescriptor(Iu.prototype,"unpipe"),Iu.prototype),Iu);const L_=new class extends Fs{get visibility(){return document.visibilityState}get lastHiddenTime(){return this._lastHiddenTime}get lastVisibleTime(){return this._lastVisibleTime}constructor(){super(),Fn(this,"_lastHiddenTime",0),Fn(this,"_lastVisibleTime",0),document.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"?this._lastHiddenTime=performance.now():this._lastVisibleTime=performance.now(),Ut.debug("current web page is ".concat(document.visibilityState)),this.emit("VISIBILITY_CHANGE",document.visibilityState)})}};class lV extends Fs{constructor(rt,it){super(),Fn(this,"trackMediaType",AS.DATA),Fn(this,"_version",1),Fn(this,"_type",3),Fn(this,"_config",void 0),Fn(this,"_originDataChannel",void 0),Fn(this,"_dataStreamPacketHeader",new ArrayBuffer(4)),Fn(this,"_dataStreamPacketHandler",{serialize:ct=>ct,deserialize:ct=>ct}),Fn(this,"_datachannelEventMap",new Map),this._config=rt,it&&(this._originDataChannel=it,this._bandDataChannelEvents(it)),this._initPacketHeader()}useDataStream(rt){this._dataStreamPacketHandler=rt}get id(){return this._config.id}get ordered(){return this._config.ordered}get maxRetransmits(){return rn("DATASTREAM_MAX_RETRANSMITS")}get metadata(){return this._config.metadata}get readyState(){var rt,it;return(rt=(it=this._originDataChannel)===null||it===void 0?void 0:it.readyState)!==null&&rt!==void 0?rt:"connecting"}get _originDataChannelId(){var rt,it;return(rt=(it=this._originDataChannel)===null||it===void 0?void 0:it.id)!==null&&rt!==void 0?rt:null}getChannelId(){return this.id}getConfig(){return this._config}_close(){this._originDataChannel&&(this._unbindDataChannelEvents(this._originDataChannel),this._originDataChannel=void 0)}async _waitTillOpen(){return new Ir((rt,it)=>{if(this._originDataChannel){this._originDataChannel.readyState==="open"&&rt();const ct=setTimeout(()=>{var ut;it(new Yn(tn.DATACHANNEL_CONNECTION_TIMEOUT,"Cannot create datachannel, id: ".concat((ut=this._originDataChannel)===null||ut===void 0?void 0:ut.id)))},1e4);this._originDataChannel.onopen=()=>{clearTimeout(ct),this._originDataChannel&&this._bandDataChannelEvents(this._originDataChannel),rt()},this._originDataChannel.onerror=()=>{throw clearTimeout(ct),new Yn(tn.DATACHANNEL_CONNECTION_TIMEOUT)}}else it(new Yn(tn.DATACHANNEL_CONNECTION_TIMEOUT,"cannot find dataChannel"))})}_updateOriginDataChannel(rt){this._originDataChannel=rt,this._bandDataChannelEvents(rt)}_initPacketHeader(){const rt=new DataView(this._dataStreamPacketHeader);rt.setUint16(0,this._version),rt.setUint8(2,this._type),rt.setUint8(3,this._config.id)}_bandDataChannelEvents(rt){this._unbindDataChannelEvents(rt),[Aw.OPEN,Aw.CLOSE,Aw.ERROR].forEach(it=>{const ct=()=>{this.emit(it)};this._datachannelEventMap.set(it,ct),rt.addEventListener(it,ct)})}_unbindDataChannelEvents(rt){Array.from(this._datachannelEventMap.entries()).forEach(it=>{let[ct,ut]=it;rt.removeEventListener(ct,ut)}),this._datachannelEventMap.clear()}}class GY extends lV{constructor(rt){super(rt),Fn(this,"_messageListener",void 0),this._messageListener=it=>{if(it.data.byteLength<this._dataStreamPacketHeader.byteLength)throw Error("invalid byteLength: the byte length must exceed "+this._dataStreamPacketHeader.byteLength);const ct=it.data.slice(0,this._dataStreamPacketHeader.byteLength),ut=new DataView(ct).getUint8(3);if(ut!==this.id)return void(rn("SHOW_DATASTREAM2_LOG")&&Ut.debug("invalid datachannel id: ".concat(ut," !== ").concat(this.id)));let pt=it.data.slice(this._dataStreamPacketHeader.byteLength);pt=this._dataStreamPacketHandler.deserialize(pt),this.emit(Aw.MESSAGE,pt)}}_updateOriginDataChannel(rt){super._updateOriginDataChannel(rt),this._bandRemoteDataChannelEvents()}_close(){this._originDataChannel&&(this._originDataChannel.removeEventListener("message",this._messageListener),super._close())}_bandRemoteDataChannelEvents(){this._originDataChannel&&this._originDataChannel.addEventListener("message",this._messageListener)}}class $Y extends lV{send(rt){if(this._originDataChannel){let it=rt;it=this._dataStreamPacketHandler.serialize(rt);const ct=new Uint8Array(this._dataStreamPacketHeader.byteLength+it.byteLength);ct.set(new Uint8Array(this._dataStreamPacketHeader),0),ct.set(new Uint8Array(it),this._dataStreamPacketHeader.byteLength),this._originDataChannel.send(ct.buffer)}}}function ww(){const _e=new Blob([atob("Y29uc3QgdD0idmlkZW8vaDI2NCIsZT0idmlkZW8vaDI2NSI7ZnVuY3Rpb24gbih0LGUsbil7bGV0IGE9bmV3IFVpbnQ4QXJyYXkodCxlLG4pLHI9W10sbz0wO2Zvcig7ci5sZW5ndGg8bjspbyszPG4mJjA9PT1hW29dJiYwPT09YVtvKzFdJiYzPT09YVtvKzJdJiYoMD09PWFbbyszXXx8MT09PWFbbyszXXx8Mj09PWFbbyszXXx8Mz09PWFbbyszXSk/KHIucHVzaChhW29dLGFbbysxXSxhW28rM10pLG8rPTQpOihyLnB1c2goYVtvXSksbysrKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkocil9ZnVuY3Rpb24gYShhLHIpe3N3aXRjaChyKXtjYXNlIHQ6cmV0dXJuIGZ1bmN0aW9uKHQpe2NvbnN0IGU9bmV3IERhdGFWaWV3KHQuZGF0YSk7bGV0IGE9MDtmb3IoO2ErNDx0LmRhdGEuYnl0ZUxlbmd0aDspe2lmKDA9PT1lLmdldFVpbnQ4KGErMCkmJjA9PT1lLmdldFVpbnQ4KGErMSkmJjA9PT1lLmdldFVpbnQ4KGErMikmJjE9PT1lLmdldFVpbnQ4KGErMykmJjY9PT1lLmdldFVpbnQ4KGErNCkpe2xldCByPWErNixvPTAsaT0wO2Zvcig7MjU1PT09KGk9ZS5nZXRVaW50OChyKyspKTspbys9MjU1O28rPWk7Y29uc3Qgcz1uKHQuZGF0YSxyLG8pO3JldHVybiBuZXcgVWludDhBcnJheShzKX1hKyt9cmV0dXJuIG51bGx9KGEpO2Nhc2UgZTpyZXR1cm4gZnVuY3Rpb24odCl7Y29uc3QgZT1uZXcgRGF0YVZpZXcodC5kYXRhKTtsZXQgYT0wO2Zvcig7YSs1PHQuZGF0YS5ieXRlTGVuZ3RoOyl7aWYoMD09PWUuZ2V0VWludDgoYSswKSYmMD09PWUuZ2V0VWludDgoYSsxKSYmMD09PWUuZ2V0VWludDgoYSsyKSYmMT09PWUuZ2V0VWludDgoYSszKSYmNzg9PT1lLmdldFVpbnQ4KGErNCkmJjE9PT1lLmdldFVpbnQ4KGErNSkmJjEwMT09PWUuZ2V0VWludDgoYSs2KSl7bGV0IHI9YSs3LG89MCxpPTA7Zm9yKDsyNTU9PT0oaT1lLmdldFVpbnQ4KHIrKykpOylvKz0yNTU7bys9aTtjb25zdCBzPW4odC5kYXRhLHIsbyk7cmV0dXJuIG5ldyBVaW50OEFycmF5KHMpfWErK31yZXR1cm4gbnVsbH0oYSk7ZGVmYXVsdDpyZXR1cm4gbnVsbH19ZnVuY3Rpb24gcih0KXtjb25zdCBlPXQubGVuZ3RoO2xldCBuPVtdLGE9MDtmb3IoO2E8ZTspYSsyPGUmJjA9PT10W2FdJiYwPT09dFthKzFdJiYoMD09PXRbYSsyXXx8MT09PXRbYSsyXXx8Mj09PXRbYSsyXXx8Mz09PXRbYSsyXSk/KG4ucHVzaCh0W2FdLHRbYSsxXSwzLHRbYSsyXSksYSs9Myk6KG4ucHVzaCh0W2FdKSxhKyspO3JldHVybiBuZXcgVWludDhBcnJheShuKX1mdW5jdGlvbiBvKG4sYSxvKXtzd2l0Y2gobyl7Y2FzZSB0OnJldHVybiBmdW5jdGlvbih0LGUpe2NvbnN0IG49cihlKSxhPW4ubGVuZ3RoLG89TWF0aC5mbG9vcihhLzI1NSksaT1hJTI1NSxzPW5ldyBVaW50OEFycmF5KDYrbysxK2ErdC5ieXRlTGVuZ3RoKTtzWzBdPTAsc1sxXT0wLHNbMl09MCxzWzNdPTEsc1s0XT02LHNbNV09MTAxO2xldCBmPTA7Zm9yKDtmPG87KXNbNitmXT0yNTUsZisrO3JldHVybiBzWzYrZl09aSxmKysscy5zZXQobiw2K2YpLHMuc2V0KG5ldyBVaW50OEFycmF5KHQpLDYrZithKSxzLmJ1ZmZlcn0obixhKTtjYXNlIGU6cmV0dXJuIGZ1bmN0aW9uKHQsZSl7Y29uc3Qgbj1yKGUpLGE9bi5sZW5ndGgsbz1NYXRoLmZsb29yKGEvMjU1KSxpPWElMjU1LHM9bmV3IFVpbnQ4QXJyYXkoNytvKzErYSsxK3QuYnl0ZUxlbmd0aCk7c1swXT0wLHNbMV09MCxzWzJdPTAsc1szXT0xLHNbNF09Nzgsc1s1XT0xLHNbNl09MTAxO2xldCBmPTA7Zm9yKDtmPG87KXNbNytmXT0yNTUsZisrO3JldHVybiBzWzcrZl09aSxmKysscy5zZXQobiw3K2YpLGYrPWEsc1s3K2ZdPTEyOCxmKysscy5zZXQobmV3IFVpbnQ4QXJyYXkodCksNytmKSxzLmJ1ZmZlcn0obixhKTtkZWZhdWx0OnJldHVybiBudWxsfX1mdW5jdGlvbiBpKG4pe2lmKG4ubGVuZ3RoPDUpcmV0dXJuIiI7bGV0IGE9LTE7Zm9yKGxldCB0PTA7dDxuLmxlbmd0aC0zO3QrKyl7aWYoMD09PW5bdF0mJjA9PT1uW3QrMV0mJjE9PT1uW3QrMl0pe2E9dDticmVha31pZih0PG4ubGVuZ3RoLTQmJjA9PT1uW3RdJiYwPT09blt0KzFdJiYwPT09blt0KzJdJiYxPT09blt0KzNdKXthPXQ7YnJlYWt9fWlmKC0xPT09YSlyZXR1cm4iIjtjb25zdCByPWErKDA9PT1uW2ErMl0/NDozKTtpZihyPj1uLmxlbmd0aClyZXR1cm4iIjtjb25zdCBvPW5bcl07aWYoMTI4Jm8pcmV0dXJuIiI7aWYoKG8+PjEmNjMpPj0zMilyZXR1cm4gZTtpZihyKzE8bi5sZW5ndGgpe2lmKDA9PSgyNDgmbltyKzFdKSlyZXR1cm4gZX1yZXR1cm4oMzEmbyk8PTMxP3Q6IiJ9Y29uc3Qgcz03MSxmPTEsbD0yLHU9MSxnPTI7dmFyIGM7ZnVuY3Rpb24gZCh0LGU9ITEpe2NvbnN0IG49dC5nZXRVaW50OCgwKTtpZihuIT09cylyZXR1cm47Y29uc3QgYT10LmdldFVpbnQxNigxKSxyPWYrbCthLG89bmV3IFVpbnQ4QXJyYXkodC5ieXRlTGVuZ3RoLXIpO28uc2V0KG5ldyBVaW50OEFycmF5KHQuYnVmZmVyLHIsdC5ieXRlTGVuZ3RoLXIpKTtjb25zdCBpPXttOm4sdGx2TGVuOmEsdGx2OltdLGZyYW1lOm99O2xldCBkPWYrbDtmb3IoO2Q8cjspe2NvbnN0IG49dC5nZXRVaW50OChkKSxhPXQuZ2V0VWludDE2KGQrdSkscj11K2c7aWYobj09PWMuQVVESU9fTEVWRUwpe2xldCBvPXQuZ2V0VWludDgoZCtyKTtmb3IobGV0IGU9MTtlPGE7ZSsrKW89bzw8OHx0LmdldFVpbnQ4KGQrcitlKTtpLnRsdi5wdXNoKHt0YWc6bixsZW5ndGg6YSx2YWx1ZTplPzEyN15vPj4xOjEyNyZvfSl9ZWxzZSBpZihuPT09Yy5NRVRBREFUQXx8bj09PWMuQVVESU9fNjRfQklUX1BUUyl7Y29uc3QgZT1uZXcgVWludDhBcnJheShhKTtmb3IobGV0IG49MDtuPGE7bisrKWVbbl09dC5nZXRVaW50OChkK3Irbik7aS50bHYucHVzaCh7dGFnOm4sbGVuZ3RoOmEsdmFsdWU6ZX0pfWQrPXIrYX1yZXR1cm4gaX0hZnVuY3Rpb24odCl7dFt0LkFVRElPX0xFVkVMPTFdPSJBVURJT19MRVZFTCIsdFt0Lk1FVEFEQVRBPTJdPSJNRVRBREFUQSIsdFt0LkFVRElPXzY0X0JJVF9QVFM9M109IkFVRElPXzY0X0JJVF9QVFMifShjfHwoYz17fSkpLHNlbGYub25ydGN0cmFuc2Zvcm09dD0+e2NvbnN0IGU9dC50cmFuc2Zvcm1lcjtsZXQgbj1bXSxyPVtdO2Uub3B0aW9ucy5wb3J0Lm9ubWVzc2FnZT10PT57dC5kYXRhLnNlaSYmbi5wdXNoKHQuZGF0YS5zZWkpLHQuZGF0YS5tZXRhZGF0YSYmci5wdXNoKHQuZGF0YS5tZXRhZGF0YSl9LHNlbGYucG9zdE1lc3NhZ2UoInN0YXJ0ZWQiKTtjb25zdCBoPWUucmVhZGFibGUuZ2V0UmVhZGVyKCksVT1lLndyaXRhYmxlLmdldFdyaXRlcigpOyJzZWktcngiPT09ZS5vcHRpb25zLm5hbWU/ZnVuY3Rpb24gdChlKXtoLnJlYWQoKS50aGVuKChuPT57aWYoIW4uZG9uZSl7aWYobi52YWx1ZSBpbnN0YW5jZW9mIFJUQ0VuY29kZWRWaWRlb0ZyYW1lKXtjb25zdCB0PWkobmV3IFVpbnQ4QXJyYXkobi52YWx1ZS5kYXRhKSkscj1hKG4udmFsdWUsdCk7ciYmZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3NlaTpyfSl9VS53cml0ZShuLnZhbHVlKSxlLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSx0KGUpfX0pKX0oZSk6InNlaS10eCI9PT1lLm9wdGlvbnMubmFtZT9mdW5jdGlvbiB0KGUpe2gucmVhZCgpLnRoZW4oKGE9PntpZighYS5kb25lKXtpZihhLnZhbHVlIGluc3RhbmNlb2YgUlRDRW5jb2RlZFZpZGVvRnJhbWUpe2NvbnN0IHQ9aShuZXcgVWludDhBcnJheShhLnZhbHVlLmRhdGEpKSxlPW4uc2hpZnQoKTtpZihlKXtjb25zdCBuPW8oYS52YWx1ZS5kYXRhLGUsdCk7biYmKGEudmFsdWUuZGF0YT1uKX19VS53cml0ZShhLnZhbHVlKSxlLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSx0KGUpfX0pKX0oZSk6ImF1ZGlvLW1ldGFkYXRhLXJ4Ij09PWUub3B0aW9ucy5uYW1lP2Z1bmN0aW9uIHQoZSl7aC5yZWFkKCkudGhlbigobj0+e2lmKCFuLmRvbmUpe2lmKG4udmFsdWUgaW5zdGFuY2VvZiBSVENFbmNvZGVkQXVkaW9GcmFtZSl7Y29uc3QgdD1uZXcgRGF0YVZpZXcobi52YWx1ZS5kYXRhKSxhPXQuZ2V0VWludDgoMCk7bGV0IHI7aWYoMCE9KDEyOCZhKSYmNzEhPT1hKXtsZXQgZT1mdW5jdGlvbih0KXtpZih0LmJ5dGVMZW5ndGg8PTApcmV0dXJuW107Y29uc3QgZT1bXTtsZXQgbj0wO2Zvcig7bjx0LmJ5dGVMZW5ndGg7KXtjb25zdCBhPSgxMjgmdC5nZXRVaW50OChuKSk+Pjcscj0xMjcmdC5nZXRVaW50OChuKTtpZighKGEmJm4rNDw9dC5ieXRlTGVuZ3RoKSl7bisrO2JyZWFrfXtjb25zdCBhPXQuZ2V0VWludDMyKG4sITEpLG89KDE2Nzc2MTkyJmEpPj4xMCxpPTEwMjMmYTtlLnB1c2goe3B0OnIsdHNfb2Zmc2V0Om8sbGVuZ3RoOmksZGF0YTpuZXcgVWludDhBcnJheX0pLG4rPTR9fWxldCBhPXQuYnl0ZUxlbmd0aC1uO2Zvcihjb25zdCByIG9mIGUpe2lmKHIubGVuZ3RoPmEpcmV0dXJuIGNvbnNvbGUud2FybigiQnJva2VuIHJlZCBwYXlsb2FkIiksW107ci5sZW5ndGg+MCYmKHIuZGF0YT1uZXcgVWludDhBcnJheSh0LmJ1ZmZlcix0LmJ5dGVPZmZzZXQrbixyLmxlbmd0aCksbis9ci5sZW5ndGgsYS09ci5sZW5ndGgpfWlmKGE+MCl7Y29uc3Qgcj17cHQ6ZS5sZW5ndGg+MD9lW2UubGVuZ3RoLTFdLnB0OjAsdHNfb2Zmc2V0OjAsbGVuZ3RoOmEsZGF0YTpuZXcgVWludDhBcnJheSh0LmJ1ZmZlcix0LmJ5dGVPZmZzZXQrbixhKX07ZS5wdXNoKHIpfXJldHVybiBlfSh0KTtpZihlLmxlbmd0aD4wKXtjb25zdCB0PWZ1bmN0aW9uKHQpe2xldCBlPTA7Zm9yKGxldCBuPTA7bjx0Lmxlbmd0aDtuKyspZSs9bjx0Lmxlbmd0aC0xPzQ6MSxlKz10W25dLmxlbmd0aDtjb25zdCBuPW5ldyBVaW50OEFycmF5KGUpO2xldCBhPTA7Zm9yKGxldCBlPTA7ZTx0Lmxlbmd0aDtlKyspaWYoZTx0Lmxlbmd0aC0xKXtjb25zdCByPSgyMTQ3NDgzNjQ4fCgxMjcmdFtlXS5wdCk8PDI0fCgyNjIxNDMmdFtlXS50c19vZmZzZXQpPDwxMHwxMDIzJnRbZV0ubGVuZ3RoKT4+PjA7blthKytdPXI+PjI0JjI1NSxuW2ErK109cj4+MTYmMjU1LG5bYSsrXT1yPj44JjI1NSxuW2ErK109MjU1JnJ9ZWxzZSBuW2ErK109MTI3JnRbZV0ucHQ7Zm9yKGNvbnN0IGUgb2YgdCluLnNldChlLmRhdGEsYSksYSs9ZS5sZW5ndGg7cmV0dXJuIG59KGUubWFwKCh0PT57bGV0IGU9bmV3IFVpbnQ4QXJyYXkodC5sZW5ndGgpO2Uuc2V0KHQuZGF0YSk7Y29uc3Qgbj1kKG5ldyBEYXRhVmlldyhlLmJ1ZmZlcikpO3JldHVybiBuPy5mcmFtZSYmKHQuZGF0YT1uPy5mcmFtZSkscj1uLHR9KSkpO24udmFsdWUuZGF0YT10LmJ1ZmZlcn19ZWxzZSByPWQodCksciYmKG4udmFsdWUuZGF0YT1yLmZyYW1lLmJ1ZmZlcik7aWYocil7bGV0IHQ9ci50bHYuZmluZCgodD0+dC50YWc9PT1jLk1FVEFEQVRBKSk7aWYodCYmdC52YWx1ZSBpbnN0YW5jZW9mIFVpbnQ4QXJyYXkmJmUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHttZXRhZGF0YTp0LnZhbHVlfSksdD1yLnRsdi5maW5kKCh0PT50LnRhZz09PWMuQVVESU9fNjRfQklUX1BUUykpLHQmJnQudmFsdWUgaW5zdGFuY2VvZiBVaW50OEFycmF5JiY4PT10LnZhbHVlLmxlbmd0aCl7Y29uc3Qgbj1uZXcgRGF0YVZpZXcodC52YWx1ZS5idWZmZXIpLmdldEJpZ1VpbnQ2NCgwLCEwKTt0JiZ0LnZhbHVlIGluc3RhbmNlb2YgVWludDhBcnJheSYmZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3B0czpufSl9fX1VLndyaXRlKG4udmFsdWUpLGUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHt0cmFuc2Zvcm1lZDohMH0pLHQoZSl9fSkpfShlKToiYXVkaW8tbWV0YWRhdGEtdHgiPT09ZS5vcHRpb25zLm5hbWUmJmZ1bmN0aW9uIHQoZSl7aC5yZWFkKCkudGhlbigobj0+e2lmKCFuLmRvbmUpe2lmKGUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHtnZXRNZXRhZGF0YTohMH0pLG4udmFsdWUgaW5zdGFuY2VvZiBSVENFbmNvZGVkQXVkaW9GcmFtZSl7Y29uc3QgdD1yLnNoaWZ0KCk7dCYmKG4udmFsdWUuZGF0YT1mdW5jdGlvbih0LGUsbil7Y29uc3QgYT1uLmJ5dGVMZW5ndGgscj1hK3UrZyxvPWYrbCtyLGk9bmV3IEFycmF5QnVmZmVyKHQuYnl0ZUxlbmd0aCtvKSxjPW5ldyBEYXRhVmlldyhpKTtjLnNldFVpbnQ4KDAscyksYy5zZXRVaW50MTYoMSxyKSxjLnNldFVpbnQ4KDMsZSksYy5zZXRVaW50MTYoNCxhKTtmb3IobGV0IHQ9MDt0PGE7dCsrKWMuc2V0VWludDgoNit0LG5bdF0pO2NvbnN0IGQ9bmV3IFVpbnQ4QXJyYXkoYy5idWZmZXIpO3JldHVybiBkLnNldChuZXcgVWludDhBcnJheSh0KSxvKSxkLmJ1ZmZlcn0obi52YWx1ZS5kYXRhLGMuQVVESU9fNjRfQklUX1BUUyx0KSl9VS53cml0ZShuLnZhbHVlKSxlLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSx0KGUpfX0pKX0oZSl9LHNlbGYucG9zdE1lc3NhZ2UoInJlZ2lzdGVyZWQiKTsK")],{type:"text/javascript"});return setTimeout(()=>RR.revokeObjectURL(_e),0),new Worker(RR.createObjectURL(_e))}const uV=71,QO=1,eM=2,tM=1,dV=2;var iv=function(_e){return _e[_e.AUDIO_LEVEL=1]="AUDIO_LEVEL",_e[_e.METADATA=2]="METADATA",_e[_e.AUDIO_64_BIT_PTS=3]="AUDIO_64_BIT_PTS",_e}(iv||{});function nM(_e){let rt=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const it=_e.getUint8(0);if(it!==uV)return;const ct=_e.getUint16(1),ut=QO+eM+ct,pt=new Uint8Array(_e.byteLength-ut);pt.set(new Uint8Array(_e.buffer,ut,_e.byteLength-ut));const mt={m:it,tlvLen:ct,tlv:[],frame:pt};let _t=QO+eM;for(;_t<ut;){const vt=_e.getUint8(_t),Tt=_e.getUint16(_t+tM),bt=tM+dV;if(vt===iv.AUDIO_LEVEL){let Ot=_e.getUint8(_t+bt);for(let Mt=1;Mt<Tt;Mt++)Ot=Ot<<8|_e.getUint8(_t+bt+Mt);mt.tlv.push({tag:vt,length:Tt,value:rt?127^Ot>>1:127&Ot})}else if(vt===iv.METADATA||vt===iv.AUDIO_64_BIT_PTS){const Ot=new Uint8Array(Tt);for(let Mt=0;Mt<Tt;Mt++)Ot[Mt]=_e.getUint8(_t+bt+Mt);mt.tlv.push({tag:vt,length:Tt,value:Ot})}_t+=bt+Tt}return mt}const Iw=new Map,xw=127,T0=1e-10,rM=139/13,Ow=new Map;function iM(_e,rt,it){const ct="".concat(_e,"-").concat(rt,"-").concat(it);let ut=0;return Ow.has(ct)?ut=Ow.get(ct):(ut=Math.log(function(mt,_t){const vt=mt-_t;_t<vt&&(_t=vt);let Tt=1;for(let bt=mt,Ot=1;bt>_t;bt--,Ot++)Tt=Tt*bt/Ot;return Tt}(rt,_e))+_e*Math.log(.5)+(rt-_e)*Math.log(1-.5)-Math.log(it)+it*_e,Ow.set(ct,ut)),ut<T0&&(ut=T0),ut}function hV(_e,rt,it){const ct=rt.length,ut=_e.length/ct;let pt=!1;for(let mt=0,_t=0;mt<ct;mt++){let vt=0;for(let Tt=_t+ut;_t<Tt;_t++)_e[_t]>it&&vt++;rt[mt]!==vt&&(rt[mt]=vt,pt=!0)}return pt}window.cache=Ow;let HY=0;class pV{constructor(rt){Fn(this,"id",void 0),Fn(this,"immediates",[]),Fn(this,"lastNonSilence",-1),Fn(this,"immediateSpeechActivityScore",T0),Fn(this,"lastLevelChangedTime",Date.now()),Fn(this,"levels",[]),Fn(this,"longs",[]),Fn(this,"longSpeechActivityScore",T0),Fn(this,"mediums",[]),Fn(this,"mediumSpeechActivityScore",T0),Fn(this,"minLevel",0),Fn(this,"nextMinLevel",0),Fn(this,"nextMinLevelWindowLength",0),Fn(this,"energyScore",0),this.id=rt||"".concat(HY++),this.immediates.length=50,this.mediums.length=10,this.longs.length=1,this.levels.length=this.immediates.length}computeImmediates(){const rt=this.immediates,it=this.levels,ct=this.minLevel+rM;let ut=!1;for(let pt=0;pt<rt.length;++pt){let mt=it[pt];mt<ct&&(mt=0);const _t=Math.floor(mt/rM);rt[pt]!==_t&&(rt[pt]=_t,ut=!0)}return ut}computeLongs(){return hV(this.mediums,this.longs,4)}computeMediums(){return hV(this.immediates,this.mediums,7)}evaluateImmediateSpeechActivityScore(){this.immediateSpeechActivityScore=iM(this.immediates[0],13,.78)}evaluateLongSpeechActivityScore(rt){this.longSpeechActivityScore=iM(this.longs[0],10,47),this.longSpeechActivityScore>T0&&(this.lastNonSilence=rt)}evaluateMediumSpeechActivityScore(){this.mediumSpeechActivityScore=iM(this.mediums[0],5,24)}evaluateSpeechActivityScores(rt){this.computeImmediates()&&(this.evaluateImmediateSpeechActivityScore(),this.computeMediums()&&(this.evaluateMediumSpeechActivityScore(),this.computeLongs()&&this.evaluateLongSpeechActivityScore(rt)))}getLastLevelChangedTime(){return this.lastLevelChangedTime}getLevels(){var rt;return"[".concat(pT(rt=[...this.levels]).call(rt).join(),"]")}getSpeechActivityScore(rt){switch(rt){case 0:return this.immediateSpeechActivityScore;case 1:return this.mediumSpeechActivityScore;case 2:return this.longSpeechActivityScore;default:throw new Error("interval "+rt)}}levelChanged(rt,it){if(this.lastLevelChangedTime<=it){this.lastLevelChangedTime=it;let ct=rt;return rt<0&&(ct=0),rt>xw&&(ct=xw),this.levels.unshift(ct),this.levels.length>this.immediates.length&&this.levels.pop(),this.updateMinLevel(ct),ct>=this.minLevel+rM?ct:ct/2}return-1}levelTimedOut(){this.levelChanged(0,this.lastLevelChangedTime)}updateMinLevel(rt){if(rt!==0){if(this.minLevel===0||this.minLevel>rt)return this.minLevel=rt,this.nextMinLevel=0,void(this.nextMinLevelWindowLength=0);if(this.nextMinLevel===0)return this.nextMinLevel=rt,void(this.nextMinLevelWindowLength=1);if(this.nextMinLevel>rt&&(this.nextMinLevel=rt),this.nextMinLevelWindowLength++,this.nextMinLevelWindowLength>=750){let it=Math.sqrt(this.minLevel*this.nextMinLevel);it<0?it=0:it>xw&&(it=xw),this.minLevel=it,this.nextMinLevel=0,this.nextMinLevelWindowLength=0}}}}class jY{constructor(rt){Fn(this,"algorithm",void 0),this.algorithm=rt}execute(){let rt=!this.algorithm;if(!rt)try{const it=this.algorithm.runInDecisionMaker(this);it<=0?rt=!0:setTimeout(this.execute.bind(this),it)}catch{rt=!0}rt&&this.algorithm&&this.algorithm.decisionMakerExited(this)}}class oM{constructor(rt,it,ct){Fn(this,"isDominant",void 0),Fn(this,"energyRanking",void 0),Fn(this,"energyScore",void 0),this.isDominant=rt,this.energyRanking=it,this.energyScore=ct}}class zY extends Fs{constructor(rt){super(),Fn(this,"dominantId",null),Fn(this,"lastDecisionTime",0),Fn(this,"lastLevelChangedTime",0),Fn(this,"lastLevelIdleTime",0),Fn(this,"relativeSpeechActivities",[]),Fn(this,"speakers",new Map),Fn(this,"enableSilence",!1),Fn(this,"timeoutToSilenceInterval",0),Fn(this,"decisionMaker",null),Fn(this,"loudest",[]),Fn(this,"numLoudestToTrack",3),Fn(this,"energyExpireTimeMs",250),Fn(this,"energyAlphaPct",50),this.timeoutToSilenceInterval=rt,this.enableSilence=rt>0,this.relativeSpeechActivities.length=3}setLoudestConfig(){let rt=arguments.length>0&&arguments[0]!==void 0?arguments[0]:3,it=arguments.length>1?arguments[1]:void 0,ct=arguments.length>2?arguments[2]:void 0;this.numLoudestToTrack=rt,it!=null&&(this.energyExpireTimeMs=it),ct!=null&&(this.energyAlphaPct=ct),this.loudest.length>rt&&this.loudest.splice(rt)}getDominantSpeaker(){return this.dominantId}isAmongLoudest(rt){return this.loudest.some(it=>it.id===rt)}levelChanged(rt,it){const ct=Date.now(),ut=this.getOrCreateSpeaker(rt);this.lastLevelChangedTime<ct&&(this.lastLevelChangedTime=ct,this.maybeStartDecisionMaker());const pt=ut.levelChanged(it,ct);return this.updateLoudestList(ut,pt,ct)}runInDecisionMaker(rt){return this.decisionMaker!==rt||this.lastDecisionTime>0&&this.lastDecisionTime-this.lastLevelChangedTime>=15e3?-1:this._runInDecisionMaker()}decisionMakerExited(rt){this.decisionMaker===rt&&(this.decisionMaker=null)}destroy(){this.decisionMaker=null,this.loudest.length=0,this.speakers.clear(),this.removeAllListeners()}addSpeakers(rt){rt.forEach(it=>{this.speakers.has(it.id)||this.speakers.set(it.id,it)})}removeSpeakers(rt){rt.forEach(it=>{this.speakers.delete(it.id)})}getOrCreateSpeaker(rt){let it=this.speakers.get(rt);return it||(it=new pV(rt),this.speakers.set(rt,it),this.maybeStartDecisionMaker()),it}updateLoudestList(rt,it,ct){const ut=rt.id===this.dominantId;if(it<0){let vt=0;for(;vt<this.loudest.length&&this.loudest[vt]!==rt;)++vt;return new oM(ut,vt,rt.energyScore)}if(rt.energyScore=Math.floor((this.energyAlphaPct*it+(100-this.energyAlphaPct)*rt.energyScore+50)/100),this.numLoudestToTrack===0)return new oM(ut,0,rt.energyScore);const pt=ct-this.energyExpireTimeMs;let mt=0;for(;mt<this.loudest.length;){const vt=this.loudest[mt];if(vt.getLastLevelChangedTime()<pt&&this.loudest.length>=this.numLoudestToTrack)this.loudest.splice(mt,1);else if(vt.id!==rt.id)++mt;else if(this.loudest.splice(mt,1),this.loudest.length<this.numLoudestToTrack)break}let _t=0;for(;_t<this.loudest.length&&!(this.loudest[_t].energyScore<rt.energyScore);)++_t;return _t<this.numLoudestToTrack&&(this.loudest.splice(_t,0,rt),this.loudest.length>this.numLoudestToTrack&&this.loudest.splice(this.numLoudestToTrack,1)),new oM(ut,_t,rt.energyScore)}maybeStartDecisionMaker(){!this.decisionMaker&&this.speakers.size>0&&(this.decisionMaker=new jY(this),this.decisionMaker.execute())}makeDecision(rt){let it=null,ct=null;const ut=this.speakers.size;let pt=null;if(ut===0)pt=null;else if(ut===1){var mt;const _t=Sp(mt=this.speakers).call(mt).next().value;this.enableSilence&&_t&&(pt=_t.id,_t.evaluateSpeechActivityScores(rt),rt-_t.lastNonSilence>this.timeoutToSilenceInterval&&(pt=null))}else{let _t=this.dominantId==null?null:this.speakers.get(this.dominantId);if(_t==null){const bt=this.speakers.entries().next();bt.value&&(pt=bt.value[0],_t=bt.value[1])}else pt=_t.id;_t!=null&&_t.evaluateSpeechActivityScores(rt);const vt=this.relativeSpeechActivities;let Tt=2;for(const bt of this.speakers.entries()){const[Ot,Mt]=bt;if(Mt===_t)continue;Mt.evaluateSpeechActivityScores(rt);for(let Ht=0;Ht<vt.length;++Ht){const en=_t==null?T0:_t.getSpeechActivityScore(Ht);vt[Ht]=Math.log(Mt.getSpeechActivityScore(Ht)/en)}const Dt=vt[0],jt=vt[1],$t=vt[2];Dt>3&&jt>2&&$t>0&&jt>Tt&&(Tt=jt,pt=Ot)}this.enableSilence&&_t!=null&&pt===_t.id&&rt-_t.lastNonSilence>this.timeoutToSilenceInterval&&(pt=null)}pt==null&&!this.enableSilence||pt===this.dominantId||(it=this.dominantId,this.dominantId=pt,ct=this.dominantId),ct==null&&!this.enableSilence||ct===it||this.emit("ActiveSpeakerChanged",ct)}_runInDecisionMaker(){const rt=Date.now(),it=300-(rt-this.lastLevelIdleTime);let ct=0;it<=0?(this.lastLevelIdleTime!==0&&this.timeoutIdleLevels(rt),this.lastLevelIdleTime=rt):ct=it;let ut=300-(rt-this.lastDecisionTime);return ut<=0&&(this.lastDecisionTime=rt,this.makeDecision(rt),ut=300-(Date.now()-rt)),ut>0&&ct>ut&&(ct=ut),ct}timeoutIdleLevels(rt){const it=[];for(const ut of Sp(ct=this.speakers).call(ct)){var ct;const pt=rt-ut.getLastLevelChangedTime();36e5<pt&&(this.dominantId==null||ut.id!==this.dominantId)?it.push(ut.id):300<pt&&ut.levelTimedOut()}it.forEach(ut=>this.speakers.delete(ut))}}const xS=new Map;let i_=null,Mw=null;const fV=3;let A0=[];const o_=new Map,Pw=new Map;class WY{get samples(){return this.actives+this.inactives}get activeRate(){return this.actives/this.samples}constructor(rt,it){Fn(this,"id",void 0),Fn(this,"track",void 0),Fn(this,"score",0),Fn(this,"active",!0),Fn(this,"muted",!1),Fn(this,"timer",0),Fn(this,"actives",0),Fn(this,"inactives",0),this.id=rt,this.track=it,this.setActive(o_.size<3)}autoCheckActive(){this.autoSetActive(),this.autoAdjustActive(),this.resetTimer(),this.actives=0,this.inactives=0}autoSetActive(){const rt=this.active;this.active=this.activeRate>=.8;const{actives:it,inactives:ct}=function(){const ut=[],pt=[];return Array.from(Sp(o_).call(o_)).forEach(mt=>{mt.active?ut.push(mt):pt.push(mt)}),{actives:ut,inactives:pt}}();if(it.length>3){let ut;it.forEach(pt=>{(!ut||ut.score>pt.score)&&(ut=pt)}),ut&&ut.setActive(!1)}if(it.length<3&&ct.length>0){let ut;ct.forEach(pt=>{(!ut||ut.score<pt.score)&&pt.id!==this.id&&(ut=pt)}),ut&&rt&&!this.active&&(ut.samples>40&&ut.activeRate-this.activeRate>.4?ut.setActive(!0):this.active=!0)}this.setMuted(!this.active)}setActive(rt){this.active=rt,this.resetTimer(),this.setMuted(!rt)}autoAdjustActive(){this.active?this.autoSwitchToInactive():this.autoSwitchToActive()}autoSwitchToActive(){const rt=function(it){let ct;return Array.from(Sp(o_).call(o_)).forEach(ut=>{!ut.active||ut.id===it||ut.samples<40||(!ct||ut.score<ct.score)&&(ct=ut)}),ct}(this.id);rt&&this.activeRate-rt.activeRate>.4&&(rt.setActive(!1),this.setActive(!0))}autoSwitchToInactive(){const rt=function(it){let ct;return Array.from(Sp(o_).call(o_)).forEach(ut=>{ut.active||ut.id===it||ut.samples<40||(!ct||ut.score>ct.score)&&(ct=ut)}),ct}(this.id);rt&&rt.activeRate-this.activeRate>.4&&(rt.setActive(!0),this.setActive(!1))}addSample(rt){rt?this.actives+=1:this.inactives+=1,this.samples>66.66666666666667&&this.autoCheckActive()}setMuted(rt){this.track&&(this.track.enabled=!rt,this.muted=rt)}resetTimer(){this.clearTimer(),this.timer=window.setTimeout(()=>{if(this.samples!==0)return this.samples<50?this.resetTimer():void this.autoCheckActive()},1e3)}clearTimer(){this.timer&&(clearTimeout(this.timer),this.timer=0)}}let Nw;function mV(_e){const rt=o_.get(_e);rt&&(o_.delete(_e),rt.clearTimer())}const Dw=new Map,KY=new Map,sM="video/h264",aM="video/h265";function gV(_e,rt,it){let ct=new Uint8Array(_e,rt,it),ut=[],pt=0;for(;ut.length<it;)pt+3<it&&ct[pt]===0&&ct[pt+1]===0&&ct[pt+2]===3&&(ct[pt+3]===0||ct[pt+3]===1||ct[pt+3]===2||ct[pt+3]===3)?(ut.push(ct[pt],ct[pt+1],ct[pt+3]),pt+=4):(ut.push(ct[pt]),pt++);return new Uint8Array(ut)}function _V(_e){const rt=_e.length;let it=[],ct=0;for(;ct<rt;)ct+2<rt&&_e[ct]===0&&_e[ct+1]===0&&(_e[ct+2]===0||_e[ct+2]===1||_e[ct+2]===2||_e[ct+2]===3)?(it.push(_e[ct],_e[ct+1],3,_e[ct+2]),ct+=3):(it.push(_e[ct]),ct++);return new Uint8Array(it)}function EV(_e){if(_e.length<5)return"";let rt=-1;for(let ut=0;ut<_e.length-3;ut++){if(_e[ut]===0&&_e[ut+1]===0&&_e[ut+2]===1){rt=ut;break}if(ut<_e.length-4&&_e[ut]===0&&_e[ut+1]===0&&_e[ut+2]===0&&_e[ut+3]===1){rt=ut;break}}if(rt===-1)return"";const it=rt+(_e[rt+2]===0?4:3);if(it>=_e.length)return"";const ct=_e[it];return 128&ct?"":(ct>>1&63)>=32||it+1<_e.length&&!(248&_e[it+1])?aM:(31&ct)<=31?sM:""}const Lw=new Map,TA=new Map;(function(){const _e=No();Wl.getDisplayMedia=!(!navigator.mediaDevices||!navigator.mediaDevices.getDisplayMedia),Wl.getStreamFromExtension=_e.name===Ho.CHROME&&Number(_e.version)>34,Wl.supportUnifiedPlan=function(){if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;const rt=new RTCPeerConnection;let it=!1;try{rt.addTransceiver("audio"),it=!0}catch{}return rt.close(),it}(),Wl.supportMinBitrate=_e.name===Ho.CHROME||_e.name===Ho.EDGE,Wl.supportSetRtpSenderParameters=function(){const rt=No();return!!(window.RTCRtpSender&&window.RTCRtpSender.prototype.setParameters&&window.RTCRtpSender.prototype.getParameters)&&(!!hE()||!(!tu()&&!uw())||rt.name===Ho.FIREFOX&&Number(rt.version)>=64)}(),_e.name===Ho.SAFARI&&(Number(_e.version)>=14?Wl.supportDualStream=!0:Wl.supportDualStream=!1),Wl.webAudioMediaStreamDest=function(){const rt=No();return!(rt.name===Ho.SAFARI&&Number(rt.version)<12)}(),Wl.supportReplaceTrack=!!window.RTCRtpSender&&typeof RTCRtpSender.prototype.replaceTrack=="function",Wl.supportWebGL=typeof WebGLRenderingContext<"u",Wl.supportRequestFrame=!!window.CanvasCaptureMediaStreamTrack,hE()||(Wl.webAudioWithAEC=!0),Wl.supportShareAudio=function(){const rt=No();return(rt.os===Nl.WIN_10||rt.os===Nl.WIN_81||rt.os===Nl.WIN_7||rt.os===Nl.LINUX||rt.os===Nl.MAC_OS||rt.os===Nl.CHROMIUM_OS)&&rt.name===Ho.CHROME&&Number(rt.version)>=74}(),Wl.supportDataChannel=!!(dS(76)||hO(68)||_3(14)),Wl.supportPCSetConfiguration=function(){const rt=window.RTCPeerConnection;return!Gs()&&!!rt&&rt.prototype.setConfiguration instanceof Function}(),Wl.supportWebRTCEncodedTransform=dS(87)||f3()||hO(117),Wl.supportWebRTCInsertableStream=function(){const rt=No();return(rt.name===Ho.CHROME||rt.name===Ho.EDGE)&&Number(rt.version)>=94&&"MediaStreamTrackGenerator"in window&&"MediaStreamTrackProcessor"in window}(),Wl.supportRequestVideoFrameCallback="requestVideoFrameCallback"in HTMLVideoElement.prototype,Wl.supportWebCrypto=typeof window<"u"&&window.crypto!==void 0&&window.crypto.subtle!==void 0,pw(()=>{Wl.supportDualStreamEncoding=function(){const rt=No();return!!rn("DISABLE_WEBAUDIO")||rt.name==="Safari"&&Number(rt.version)>=14||!!(rt.name==="Chrome"&&/Windows/i.test(rt.os||"")&&Number(rt.version)>=100&&rn("CHROME_DUAL_STREAM_USE_ENCODING"))}(),Ut.debug("browser ua: ",navigator.userAgent),Ut.info("browser info: ",_e),Ut.info("browser compatibility: ",Wl)})})();const YY=["CHINA","GLOBAL"],vV=[[0,1,2,3,4,5,5],[0,2,2,3,4,5,5],[0,3,3,3,4,5,5],[0,4,4,4,4,5,5],[0,5,5,5,5,5,5]],C0=[],OS=[];function b0(_e,rt){return!!rt&&C0.some(it=>it.uid===_e&&it.channelName===rt)}function cM(){return OS.length>0}var XY=L2.forEach,yV=Dv("forEach")?[].forEach:function(_e){return XY(this,_e,arguments.length>1?arguments[1]:void 0)};Ko({target:"Array",proto:!0,forced:[].forEach!==yV},{forEach:yV});var qY=tp("Array","forEach"),JY=bu,ZY=$r,QY=yt,eX=qY,lM=Array.prototype,tX={DOMTokenList:!0,NodeList:!0},nX=function(_e){var rt=_e.forEach;return _e===lM||QY(lM,_e)&&rt===lM.forEach||ZY(tX,JY(_e))?eX:rt},rX=st(nX),iX=wr,SV=nE;Ko({target:"Object",stat:!0,forced:at(function(){SV(1)})},{keys:function(_e){return SV(iX(_e))}});var oX=st(rr.Object.keys),sX=st(uT),aX=st(hT),cX=Ko,TV=VE,lX=iR,uX=Wn,AV=$m,dX=hm,hX=Bn,pX=HI,fX=xo,mX=KE,gX=b2("slice"),_X=fX("species"),uM=Array,EX=Math.max;cX({target:"Array",proto:!0,forced:!gX},{slice:function(_e,rt){var it,ct,ut,pt=hX(this),mt=dX(pt),_t=AV(_e,mt),vt=AV(rt===void 0?mt:rt,mt);if(TV(pt)&&(it=pt.constructor,(lX(it)&&(it===uM||TV(it.prototype))||uX(it)&&(it=it[_X])===null)&&(it=void 0),it===uM||it===void 0))return mX(pt,_t,vt);for(ct=new(it===void 0?uM:it)(EX(vt-_t,0)),ut=0;_t<vt;_t++,ut++)_t in pt&&pX(ct,ut,pt[_t]);return ct.length=ut,ct}});var vX=tp("Array","slice"),yX=yt,SX=vX,dM=Array.prototype,TX=function(_e){var rt=_e.slice;return _e===dM||yX(dM,_e)&&rt===dM.slice?SX:rt},AX=st(TX);function Br(_e,rt,it,ct,ut){var pt,mt,_t,vt={};return rX(pt=oX(ct)).call(pt,function(Tt){vt[Tt]=ct[Tt]}),vt.enumerable=!!vt.enumerable,vt.configurable=!!vt.configurable,("value"in vt||vt.initializer)&&(vt.writable=!0),vt=sX(mt=aX(_t=AX(it).call(it)).call(_t)).call(mt,function(Tt,bt){return bt(_e,rt,Tt)||Tt},vt),ut&&vt.initializer!==void 0&&(vt.value=vt.initializer?vt.initializer.call(ut):void 0,vt.initializer=void 0),vt.initializer===void 0?(S2(_e,rt,vt),null):vt}let kw=function(_e){return _e[_e.ACCESS_POINT=101]="ACCESS_POINT",_e[_e.UNILBS=201]="UNILBS",_e[_e.STRING_UID_ALLOCATOR=901]="STRING_UID_ALLOCATOR",_e}({}),hM=function(_e){return _e[_e.IIIEGAL_APPID=1]="IIIEGAL_APPID",_e[_e.IIIEGAL_UID=2]="IIIEGAL_UID",_e[_e.INTERNAL_ERROR=3]="INTERNAL_ERROR",_e}({}),bm=function(_e){return _e[_e.INVALID_VENDOR_KEY=5]="INVALID_VENDOR_KEY",_e[_e.INVALID_CHANNEL_NAME=7]="INVALID_CHANNEL_NAME",_e[_e.INTERNAL_ERROR=8]="INTERNAL_ERROR",_e[_e.NO_AUTHORIZED=9]="NO_AUTHORIZED",_e[_e.DYNAMIC_KEY_TIMEOUT=10]="DYNAMIC_KEY_TIMEOUT",_e[_e.NO_ACTIVE_STATUS=11]="NO_ACTIVE_STATUS",_e[_e.DYNAMIC_KEY_EXPIRED=13]="DYNAMIC_KEY_EXPIRED",_e[_e.STATIC_USE_DYNAMIC_KEY=14]="STATIC_USE_DYNAMIC_KEY",_e[_e.DYNAMIC_USE_STATIC_KEY=15]="DYNAMIC_USE_STATIC_KEY",_e[_e.USER_OVERLOAD=16]="USER_OVERLOAD",_e[_e.FORBIDDEN_REGION=18]="FORBIDDEN_REGION",_e[_e.CANNOT_MEET_AREA_DEMAND=19]="CANNOT_MEET_AREA_DEMAND",_e}({}),Vu=function(_e){return _e[_e.NO_FLAG_SET=100]="NO_FLAG_SET",_e[_e.FLAG_SET_BUT_EMPTY=101]="FLAG_SET_BUT_EMPTY",_e[_e.INVALID_FALG_SET=102]="INVALID_FALG_SET",_e[_e.FLAG_SET_BUT_NO_RE=103]="FLAG_SET_BUT_NO_RE",_e[_e.INVALID_SERVICE_ID=104]="INVALID_SERVICE_ID",_e[_e.NO_SERVICE_AVAILABLE=200]="NO_SERVICE_AVAILABLE",_e[_e.NO_SERVICE_AVAILABLE_P2P=201]="NO_SERVICE_AVAILABLE_P2P",_e[_e.NO_SERVICE_AVAILABLE_VOICE=202]="NO_SERVICE_AVAILABLE_VOICE",_e[_e.NO_SERVICE_AVAILABLE_WEBRTC=203]="NO_SERVICE_AVAILABLE_WEBRTC",_e[_e.NO_SERVICE_AVAILABLE_CDS=204]="NO_SERVICE_AVAILABLE_CDS",_e[_e.NO_SERVICE_AVAILABLE_CDN=205]="NO_SERVICE_AVAILABLE_CDN",_e[_e.NO_SERVICE_AVAILABLE_TDS=206]="NO_SERVICE_AVAILABLE_TDS",_e[_e.NO_SERVICE_AVAILABLE_REPORT=207]="NO_SERVICE_AVAILABLE_REPORT",_e[_e.NO_SERVICE_AVAILABLE_APP_CENTER=208]="NO_SERVICE_AVAILABLE_APP_CENTER",_e[_e.NO_SERVICE_AVAILABLE_ENV0=209]="NO_SERVICE_AVAILABLE_ENV0",_e[_e.NO_SERVICE_AVAILABLE_VOET=210]="NO_SERVICE_AVAILABLE_VOET",_e[_e.NO_SERVICE_AVAILABLE_STRING_UID=211]="NO_SERVICE_AVAILABLE_STRING_UID",_e[_e.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS=212]="NO_SERVICE_AVAILABLE_WEBRTC_UNILBS",_e[_e.NO_SERVICE_AVAILABLE_UNILBS_FLV=213]="NO_SERVICE_AVAILABLE_UNILBS_FLV",_e}({}),Xr=function(_e){return _e[_e.K_TIMESTAMP_EXPIRED=2]="K_TIMESTAMP_EXPIRED",_e[_e.K_CHANNEL_PERMISSION_INVALID=3]="K_CHANNEL_PERMISSION_INVALID",_e[_e.K_CERTIFICATE_INVALID=4]="K_CERTIFICATE_INVALID",_e[_e.K_CHANNEL_NAME_EMPTY=5]="K_CHANNEL_NAME_EMPTY",_e[_e.K_CHANNEL_NOT_FOUND=6]="K_CHANNEL_NOT_FOUND",_e[_e.K_TICKET_INVALID=7]="K_TICKET_INVALID",_e[_e.K_CHANNEL_CONFLICTED=8]="K_CHANNEL_CONFLICTED",_e[_e.K_SERVICE_NOT_READY=9]="K_SERVICE_NOT_READY",_e[_e.K_SERVICE_TOO_HEAVY=10]="K_SERVICE_TOO_HEAVY",_e[_e.K_UID_BANNED=14]="K_UID_BANNED",_e[_e.K_IP_BANNED=15]="K_IP_BANNED",_e[_e.K_CHANNEL_BANNED=16]="K_CHANNEL_BANNED",_e[_e.DATASTREAM2_NOT_AVAILABLE=27]="DATASTREAM2_NOT_AVAILABLE",_e[_e.K_AUTO_REBALANCE=28]="K_AUTO_REBALANCE",_e[_e.WARN_NO_AVAILABLE_CHANNEL=103]="WARN_NO_AVAILABLE_CHANNEL",_e[_e.WARN_LOOKUP_CHANNEL_TIMEOUT=104]="WARN_LOOKUP_CHANNEL_TIMEOUT",_e[_e.WARN_LOOKUP_CHANNEL_REJECTED=105]="WARN_LOOKUP_CHANNEL_REJECTED",_e[_e.WARN_OPEN_CHANNEL_TIMEOUT=106]="WARN_OPEN_CHANNEL_TIMEOUT",_e[_e.WARN_OPEN_CHANNEL_REJECTED=107]="WARN_OPEN_CHANNEL_REJECTED",_e[_e.WARN_REQUEST_DEFERRED=108]="WARN_REQUEST_DEFERRED",_e[_e.ERR_DYNAMIC_KEY_TIMEOUT=109]="ERR_DYNAMIC_KEY_TIMEOUT",_e[_e.ERR_NO_AUTHORIZED=110]="ERR_NO_AUTHORIZED",_e[_e.ERR_VOM_SERVICE_UNAVAILABLE=111]="ERR_VOM_SERVICE_UNAVAILABLE",_e[_e.ERR_NO_CHANNEL_AVAILABLE_CODE=112]="ERR_NO_CHANNEL_AVAILABLE_CODE",_e[_e.ERR_MASTER_VOCS_UNAVAILABLE=114]="ERR_MASTER_VOCS_UNAVAILABLE",_e[_e.ERR_INTERNAL_ERROR=115]="ERR_INTERNAL_ERROR",_e[_e.ERR_NO_ACTIVE_STATUS=116]="ERR_NO_ACTIVE_STATUS",_e[_e.ERR_INVALID_UID=117]="ERR_INVALID_UID",_e[_e.ERR_DYNAMIC_KEY_EXPIRED=118]="ERR_DYNAMIC_KEY_EXPIRED",_e[_e.ERR_STATIC_USE_DYANMIC_KE=119]="ERR_STATIC_USE_DYANMIC_KE",_e[_e.ERR_DYNAMIC_USE_STATIC_KE=120]="ERR_DYNAMIC_USE_STATIC_KE",_e[_e.ERR_NO_VOCS_AVAILABLE=2e3]="ERR_NO_VOCS_AVAILABLE",_e[_e.ERR_NO_VOS_AVAILABLE=2001]="ERR_NO_VOS_AVAILABLE",_e[_e.ERR_JOIN_CHANNEL_TIMEOUT=2002]="ERR_JOIN_CHANNEL_TIMEOUT",_e[_e.ERR_REPEAT_JOIN_CHANNEL=2003]="ERR_REPEAT_JOIN_CHANNEL",_e[_e.ERR_JOIN_BY_MULTI_IP=2004]="ERR_JOIN_BY_MULTI_IP",_e[_e.ERR_NOT_JOINED=2011]="ERR_NOT_JOINED",_e[_e.ERR_REPEAT_JOIN_REQUEST=2012]="ERR_REPEAT_JOIN_REQUEST",_e[_e.ERR_INVALID_VENDOR_KEY=2013]="ERR_INVALID_VENDOR_KEY",_e[_e.ERR_INVALID_CHANNEL_NAME=2014]="ERR_INVALID_CHANNEL_NAME",_e[_e.ERR_INVALID_STRINGUID=2015]="ERR_INVALID_STRINGUID",_e[_e.ERR_TOO_MANY_USERS=2016]="ERR_TOO_MANY_USERS",_e[_e.ERR_SET_CLIENT_ROLE_TIMEOUT=2017]="ERR_SET_CLIENT_ROLE_TIMEOUT",_e[_e.ERR_SET_CLIENT_ROLE_NO_PERMISSION=2018]="ERR_SET_CLIENT_ROLE_NO_PERMISSION",_e[_e.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE=2019]="ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",_e[_e.ERR_PUBLISH_REQUEST_INVALID=2020]="ERR_PUBLISH_REQUEST_INVALID",_e[_e.ERR_SUBSCRIBE_REQUEST_INVALID=2021]="ERR_SUBSCRIBE_REQUEST_INVALID",_e[_e.ERR_NOT_SUPPORTED_MESSAGE=2022]="ERR_NOT_SUPPORTED_MESSAGE",_e[_e.ERR_ILLEAGAL_PLUGIN=2023]="ERR_ILLEAGAL_PLUGIN",_e[_e.ERR_REJOIN_TOKEN_INVALID=2024]="ERR_REJOIN_TOKEN_INVALID",_e[_e.ERR_REJOIN_USER_NOT_JOINED=2025]="ERR_REJOIN_USER_NOT_JOINED",_e[_e.ERR_INVALID_OPTIONAL_INFO=2027]="ERR_INVALID_OPTIONAL_INFO",_e[_e.ILLEGAL_AES_PASSWORD=2028]="ILLEGAL_AES_PASSWORD",_e[_e.ILLEGAL_CLIENT_ROLE_LEVEL=2029]="ILLEGAL_CLIENT_ROLE_LEVEL",_e[_e.ERR_TOO_MANY_BROADCASTERS=2031]="ERR_TOO_MANY_BROADCASTERS",_e[_e.ERR_TOO_MANY_SUBSCRIBERS=2032]="ERR_TOO_MANY_SUBSCRIBERS",_e[_e.ERR_LICENSE_MISSING=32769]="ERR_LICENSE_MISSING",_e[_e.ERR_LICENSE_EXPIRED=32771]="ERR_LICENSE_EXPIRED",_e[_e.ERR_LICENSE_MINUTES_EXCEEDED=32773]="ERR_LICENSE_MINUTES_EXCEEDED",_e[_e.ERR_LICENSE_PERIOD_INVALID=32774]="ERR_LICENSE_PERIOD_INVALID",_e[_e.ERR_LICENSE_MULTIPLE_SDK_SERVICE=32778]="ERR_LICENSE_MULTIPLE_SDK_SERVICE",_e[_e.ERR_LICENSE_ILLEGAL=32783]="ERR_LICENSE_ILLEGAL",_e[_e.ERR_TEST_RECOVER=9e3]="ERR_TEST_RECOVER",_e[_e.ERR_TEST_TRYNEXT=9001]="ERR_TEST_TRYNEXT",_e[_e.ERR_TEST_RETRY=9002]="ERR_TEST_RETRY",_e}({}),Ts=function(_e){return _e.CONNECTING="connecting",_e.CONNECTED="connected",_e.RECONNECTING="reconnecting",_e.CLOSED="closed",_e}({}),io=function(_e){return _e.WS_CONNECTED="ws_connected",_e.WS_RECONNECTING="ws_reconnecting",_e.WS_CLOSED="ws_closed",_e.WS_RECONNECT_CREATE_CONNECTION="ws_reconnect_create_connection",_e.ON_BINARY_DATA="on_binary_data",_e.REQUEST_RECOVER="request_recover",_e.REQUEST_JOIN_INFO="request_join_info",_e.REQUEST_REJOIN_INFO="req_rejoin_info",_e.IS_P2P_DISCONNECTED="is_p2p_dis",_e.DISCONNECT_P2P="dis_p2p",_e.ABORT_P2P_EXECUTION="abort_p2p_execution",_e.NEED_RENEW_SESSION="need-sid",_e.REPORT_JOIN_GATEWAY="report_join_gateway",_e.REQUEST_TIMEOUT="request_timeout",_e.REQUEST_SUCCESS="request_success",_e.JOIN_RESPONSE="join_response",_e.PRE_CONNECT_PC="pre_connect_pc",_e.P2P_CONNECTION="p2p_connection",_e.P2P_REMOTE_CANDIDATE_UPDATE="p2p_remote_candidate_update",_e.P2P_SUBSCRIBE="p2p_subscribe",_e.P2P_UNSUBSCRIBE="p2p_unsubscribe",_e.P2P_EXCHANGE_SDP="p2p_exchange_sdp",_e.P2P_ON_ADD_VIDEO_STREAM="p2p_on_add_video_stream",_e.P2P_ON_ADD_AUDIO_STREAM="p2p_on_add_audio_stream",_e.RECOVER_NOTIFICATION="recover_notification",_e}({}),_i=function(_e){return _e.PING="ping",_e.PING_BACK="ping_back",_e.JOIN="join_v3",_e.REJOIN="rejoin_v3",_e.LEAVE="leave",_e.SET_CLIENT_ROLE="set_client_role",_e.PUBLISH="publish",_e.PUBLISH_DATASTREAM="publish_datastream",_e.UNPUBLISH="unpublish",_e.UNPUBLISH_DATASTREAM="unpublish_datastream",_e.SUBSCRIBE="subscribe",_e.PRE_SUBSCRIBE="pre_subscribe",_e.SUBSCRIBE_DATASTREAM="subscribe_datastream",_e.SUBSCRIBE_STREAMS="subscribe_streams",_e.UNSUBSCRIBE="unsubscribe",_e.UNSUBSCRIBE_DATASTREAM="unsubscribe_datastream",_e.UNSUBSCRIBE_STREAMS="unsubscribe_streams",_e.SUBSCRIBE_CHANGE="subscribe_change",_e.TRAFFIC_STATS="traffic_stats",_e.RENEW_TOKEN="renew_token",_e.SWITCH_VIDEO_STREAM="switch_video_stream",_e.DEFAULT_VIDEO_STREAM="default_video_stream",_e.SET_FALLBACK_OPTION="set_fallback_option",_e.GATEWAY_INFO="gateway_info",_e.CONTROL="control",_e.SEND_METADATA="send_metadata",_e.DATA_STREAM="data_stream",_e.PICK_SVC_LAYER="pick_svc_layer",_e.RESTART_ICE="restart_ice",_e.CONNECT_PC="connect_pc",_e.SET_VIDEO_PROFILE="set_video_profile",_e.SET_PARAMETER="set_parameter",_e.SET_RTM2_FLAG="set_rtm2_flag",_e.DOWNGRADE_CODEC="downgrade_codec",_e}({}),AA=function(_e){return _e.WRTC_STATS="wrtc_stats",_e.WS_INFLATE_DATA_LENGTH="ws_inflate_data_length",_e.DENOISER_STATS="denoiser_stats",_e.EXTENSION_USAGE_STATS="extension_usage_stats",_e}({}),Oo=function(_e){return _e.ON_USER_ONLINE="on_user_online",_e.ON_USER_OFFLINE="on_user_offline",_e.ON_STREAM_FALLBACK_UPDATE="on_stream_fallback_update",_e.ON_PUBLISH_STREAM="on_publish_stream",_e.ON_UPLINK_STATS="on_uplink_stats",_e.ON_P2P_LOST="on_p2p_lost",_e.ON_REMOVE_STREAM="on_remove_stream",_e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",_e.ON_ADD_VIDEO_STREAM="on_add_video_stream",_e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="on_token_privilege_will_expire",_e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="on_token_privilege_did_expire",_e.ON_USER_BANNED="on_user_banned",_e.ON_USER_LICENSE_BANNED="on_user_license_banned",_e.ON_NOTIFICATION="on_notification",_e.ON_CRYPT_ERROR="on_crypt_error",_e.MUTE_AUDIO="mute_audio",_e.MUTE_VIDEO="mute_video",_e.UNMUTE_AUDIO="unmute_audio",_e.UNMUTE_VIDEO="unmute_video",_e.ON_P2P_OK="on_p2p_ok",_e.RECEIVE_METADATA="receive_metadata",_e.ON_DATA_STREAM="on_data_stream",_e.ON_RTP_CAPABILITY_CHANGE="on_rtp_capability_change",_e.ON_REMOTE_DATASTREAM_UPDATE="on_remote_datastream_update",_e.ON_REMOTE_FULL_DATASTREAM_INFO="on_remote_full_datastream_info",_e.ENABLE_LOCAL_VIDEO="enable_local_video",_e.DISABLE_LOCAL_VIDEO="disable_local_video",_e.ENABLE_LOCAL_AUDIO="enable_local_audio",_e.DISABLE_LOCAL_AUDIO="disable_local_audio",_e.ON_PUBLISHED_USER_LIST="on_published_user_list",_e}({}),Gu=function(_e){return _e.SEND_ONLY="SEND_ONLY",_e.RECEIVE_ONLY="RECEIVE_ONLY",_e}({}),ho=function(_e){return _e.CONNECTED="websocket:connected",_e.RECONNECTING="websocket:reconnecting",_e.WILL_RECONNECT="websocket:will_reconnect",_e.CLOSED="websocket:closed",_e.FAILED="websocket:failed",_e.ON_MESSAGE="websocket:on_message",_e.REQUEST_NEW_URLS="websocket:request_new_urls",_e.RECONNECT_CREATE_CONNECTION="websocket:reconnect_create_connection",_e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="websocket:on_token_privilege_did_expire",_e}({});function Uw(_e){if(typeof _e!="string"||!/^[a-zA-Z0-9 \!\#\$\%\&\(\)\+\-\:\;\<\=\.\>\?\@\[\]\^\_\{\}\|\~\,]{1,64}$/.test(_e))throw Ut.error("Invalid Channel Name ".concat(_e)),new $n(tn.INVALID_PARAMS,"The length must be within 64 bytes. The supported characters: a-z,A-Z,0-9,space,!, #, $, %, &, (, ), +, -, :, ;, <, =, ., >, ?, @, [, ], ^, _,  {, }, |, ~, ,")}function Bw(_e){if(rt=_e,!(typeof rt=="number"&&Math.floor(rt)===rt&&0<=rt&&rt<=4294967295||b3(_e,1,255)))throw new $n(tn.INVALID_PARAMS,"[String uid] Length of the string: [1,255]. ASCII characters only. [Number uid] The value range is [0,10000]");var rt;typeof _e=="string"&&Ut.warn("You input a string as the user ID, to ensure better end-user experience, Agora highly suggests not using a string as the user ID.")}let k_=function(_e){return _e.TRANSCODE="mix_streaming",_e.RAW="raw_streaming",_e}({});const CX={alpha:1,height:640,width:360,x:0,y:0,zOrder:0,audioChannel:0},pM={x:0,y:0,width:160,height:160,zOrder:255,alpha:1};function fM(_e,rt){Hl(_e.url,"".concat(rt,".url"),1,1e3,!1),$s(_e.x)||us(_e.x,"".concat(rt,".x"),0,1e4),$s(_e.y)||us(_e.y,"".concat(rt,".y"),0,1e4),$s(_e.width)||us(_e.width,"".concat(rt,".width"),0,1e4),$s(_e.height)||us(_e.height,"".concat(rt,".height"),0,1e4),$s(_e.zOrder)||us(_e.zOrder,"".concat(rt,".zOrder"),0,255),$s(_e.alpha)||us(_e.alpha,"".concat(rt,".alpha"),0,1,!1)}const bX={audioBitrate:48,audioChannels:1,audioSampleRate:48e3,backgroundColor:0,height:360,lowLatency:!1,videoBitrate:400,videoCodecProfile:100,videoCodecType:1,videoFrameRate:15,videoGop:30,width:640,images:[],userConfigs:[],userConfigExtraInfo:""};let ov=function(_e){return _e.WARNING="@live_uap-warning",_e.ERROR="@line_uap-error",_e.PUBLISH_STREAM_STATUS="@live_uap-publish-status",_e.WORKER_STATUS="@live_uap-worker-status",_e.REQUEST_NEW_ADDRESS="@live_uap-request-address",_e}({}),mM=function(_e){return _e.REQUEST_WORKER_MANAGER_LIST="@live_req_worker_manager",_e}({}),Sl=function(_e){return _e[_e.LIVE_STREAM_RESPONSE_SUCCEED=200]="LIVE_STREAM_RESPONSE_SUCCEED",_e[_e.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM=454]="LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM",_e[_e.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR=450]="LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR",_e[_e.LIVE_STREAM_RESPONSE_BAD_STREAM=451]="LIVE_STREAM_RESPONSE_BAD_STREAM",_e[_e.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR=400]="LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR",_e[_e.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST=404]="LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST",_e[_e.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED=456]="LIVE_STREAM_RESPONSE_NOT_AUTHORIZED",_e[_e.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE=457]="LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE",_e[_e.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN=429]="LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN",_e[_e.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH=452]="LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH",_e[_e.LIVE_STREAM_RESPONSE_NOT_SUPPORTED=453]="LIVE_STREAM_RESPONSE_NOT_SUPPORTED",_e[_e.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM=455]="LIVE_STREAM_RESPONSE_MAX_STREAM_NUM",_e[_e.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR=500]="LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR",_e[_e.LIVE_STREAM_RESPONSE_WORKER_LOST=501]="LIVE_STREAM_RESPONSE_WORKER_LOST",_e[_e.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT=502]="LIVE_STREAM_RESPONSE_RESOURCE_LIMIT",_e[_e.LIVE_STREAM_RESPONSE_WORKER_QUIT=503]="LIVE_STREAM_RESPONSE_WORKER_QUIT",_e[_e.ERROR_FAIL_SEND_MESSAGE=504]="ERROR_FAIL_SEND_MESSAGE",_e[_e.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE=30]="PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE",_e[_e.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT=31]="PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT",_e[_e.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH=32]="PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH",_e[_e.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN=33]="PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN",_e}({});function CV(_e){if(!_e.channelName)throw new $n(tn.INVALID_PARAMS,"invalid channelName in info");if(typeof _e.uid!="number")throw new $n(tn.INVALID_PARAMS,"invalid uid in info, uid must be a number");return _e.token&&Hl(_e.token,"info.token",1,2047),Bw(_e.uid),Uw(_e.channelName),!0}let $u=function(_e){return _e[_e.SetSdkProfile=0]="SetSdkProfile",_e[_e.SetSourceChannel=1]="SetSourceChannel",_e[_e.SetSourceUserId=2]="SetSourceUserId",_e[_e.SetDestChannel=3]="SetDestChannel",_e[_e.StartPacketTransfer=4]="StartPacketTransfer",_e[_e.StopPacketTransfer=5]="StopPacketTransfer",_e[_e.UpdateDestChannel=6]="UpdateDestChannel",_e[_e.Reconnect=7]="Reconnect",_e[_e.SetVideoProfile=8]="SetVideoProfile",_e}({}),fE=function(_e){return _e.NETWORK_DISCONNECTED="NETWORK_DISCONNECTED",_e.NETWORK_CONNECTED="NETWORK_CONNECTED",_e.PACKET_JOINED_SRC_CHANNEL="PACKET_JOINED_SRC_CHANNEL",_e.PACKET_JOINED_DEST_CHANNEL="PACKET_JOINED_DEST_CHANNEL",_e.PACKET_SENT_TO_DEST_CHANNEL="PACKET_SENT_TO_DEST_CHANNEL",_e.PACKET_RECEIVED_VIDEO_FROM_SRC="PACKET_RECEIVED_VIDEO_FROM_SRC",_e.PACKET_RECEIVED_AUDIO_FROM_SRC="PACKET_RECEIVED_AUDIO_FROM_SRC",_e.PACKET_UPDATE_DEST_CHANNEL="PACKET_UPDATE_DEST_CHANNEL",_e.PACKET_UPDATE_DEST_CHANNEL_REFUSED="PACKET_UPDATE_DEST_CHANNEL_REFUSED",_e.PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE="PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE",_e}({}),ap=function(_e){return _e.RELAY_STATE_IDLE="RELAY_STATE_IDLE",_e.RELAY_STATE_CONNECTING="RELAY_STATE_CONNECTING",_e.RELAY_STATE_RUNNING="RELAY_STATE_RUNNING",_e.RELAY_STATE_FAILURE="RELAY_STATE_FAILURE",_e}({}),MS=function(_e){return _e.RELAY_OK="RELAY_OK",_e.SERVER_CONNECTION_LOST="SERVER_CONNECTION_LOST",_e.SRC_TOKEN_EXPIRED="SRC_TOKEN_EXPIRED",_e.DEST_TOKEN_EXPIRED="DEST_TOKEN_EXPIRED",_e}({}),es=function(_e){return _e.High="high",_e.Low="low",_e.Audio="audio",_e.Screen="screen",_e.ScreenLow="screen_low",_e}({}),Ul=function(_e){return _e.DISCONNECT="disconnect",_e.CONNECTION_STATE_CHANGE="connection-state-change",_e.NETWORK_QUALITY="network-quality",_e.STREAM_TYPE_CHANGE="stream-type-change",_e.IS_P2P_DISCONNECTED="is-p2p-dis",_e.DISCONNECT_P2P="dis-p2p",_e.REQUEST_NEW_GATEWAY_LIST="req-gate-url",_e.NEED_RENEW_SESSION="need-sid",_e.REQUEST_P2P_CONNECTION_PARAMS="request-p2p-connection-params",_e.JOIN_RESPONSE="join-response",_e.RESET_CONNECTION_EVENTS="reset-connection-events",_e.PRE_CONNECT_PC="pre-connect_pc",_e.UPDATE_GATEWAY_CONFIG="update-gateway-config",_e}({}),Fw=function(_e){return _e.P2P_DISCONNECTED="P2P_DISCONNECTED",_e.A_ROUND_WS_FAILED="A_ROUND_WS_FAILED",_e.TIMEOUT="TIMEOUT",_e.UNKNOWN_REASON="UNKNOWN_REASON",_e}({}),Dl=function(_e){return _e[_e.Nothing=0]="Nothing",_e[_e.Audio=1]="Audio",_e[_e.LwoVideo=2]="LwoVideo",_e[_e.Video=4]="Video",_e[_e.Data=8]="Data",_e[_e.DataStream0=256]="DataStream0",_e[_e.DataStream1=512]="DataStream1",_e[_e.DataStream2=1024]="DataStream2",_e[_e.DataStream3=2048]="DataStream3",_e[_e.DataStream4=4096]="DataStream4",_e[_e.DataStream5=8192]="DataStream5",_e[_e.DataStream6=16384]="DataStream6",_e[_e.DataStream7=32768]="DataStream7",_e}({}),Wo=function(_e){return _e.CHINA="CHINA",_e.ASIA="ASIA",_e.NORTH_AMERICA="NORTH_AMERICA",_e.EUROPE="EUROPE",_e.JAPAN="JAPAN",_e.INDIA="INDIA",_e.KOREA="KOREA",_e.HKMC="HKMC",_e.US="US",_e.OCEANIA="OCEANIA",_e.SOUTH_AMERICA="SOUTH_AMERICA",_e.AFRICA="AFRICA",_e.OVERSEA="OVERSEA",_e.GLOBAL="GLOBAL",_e.EXTENSIONS="EXTENSIONS",_e}({});const bV=[Wo.AFRICA,Wo.ASIA,Wo.CHINA,Wo.EUROPE,Wo.GLOBAL,Wo.INDIA,Wo.JAPAN,Wo.NORTH_AMERICA,Wo.OCEANIA,Wo.OVERSEA,Wo.SOUTH_AMERICA];let du=function(_e){return _e.CHINA="CN",_e.ASIA="AS",_e.NORTH_AMERICA="NA",_e.EUROPE="EU",_e.JAPAN="JP",_e.INDIA="IN",_e.KOREA="KR",_e.HKMC="HK",_e.US="US",_e.OCEANIA="OC",_e.SOUTH_AMERICA="SA",_e.AFRICA="AF",_e.OVERSEA="OVERSEA",_e.GLOBAL="GLOBAL",_e.EXTENSIONS="GLOBAL",_e}({});const Vw={CHINA:{},ASIA:{CODE:du.ASIA,WEBCS_DOMAIN:["ap-web-1-asia.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-asia.agora.io"],PROXY_CS:["proxy-ap-web-asia.agora.io"],CDS_AP:["cds-ap-web-asia.agora.io","cds-ap-web-asia2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-asia.agora.io","sua-ap-web-asia2.agora.io"],UAP_AP:["uap-ap-web-asia.agora.io","uap-ap-web-asia2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],PROXY_SERVER_TYPE3:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]},NORTH_AMERICA:{CODE:du.NORTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-north-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-north-america.agora.io"],PROXY_CS:["proxy-ap-web-america.agora.io"],CDS_AP:["cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],UAP_AP:["uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],PROXY_SERVER_TYPE3:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]},EUROPE:{CODE:du.EUROPE,WEBCS_DOMAIN:["ap-web-1-europe.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-europe.agora.io"],PROXY_CS:["proxy-ap-web-europe.agora.io"],CDS_AP:["cds-ap-web-europe.agora.io","cds-ap-web-europe2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-europe.agora.io","sua-ap-web-europe.agora.io"],UAP_AP:["uap-ap-web-europe.agora.io","uap-ap-web-europe2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],PROXY_SERVER_TYPE3:["europe.webrtc-cloud-proxy.sd-rtn.com"]},JAPAN:{CODE:du.JAPAN,WEBCS_DOMAIN:["ap-web-1-japan.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-japan.agora.io"],PROXY_CS:["proxy-ap-web-japan.agora.io"],CDS_AP:["cds-ap-web-japan.agora.io","cds-ap-web-japan2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-japan.agora.io","sua-ap-web-japan2.agora.io"],UAP_AP:["uap-ap-web-japan.agora.io","uap-ap-web-japan2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],PROXY_SERVER_TYPE3:["japan.webrtc-cloud-proxy.sd-rtn.com"]},INDIA:{CODE:du.INDIA,WEBCS_DOMAIN:["ap-web-1-india.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-india.agora.io"],PROXY_CS:["proxy-ap-web-india.agora.io"],CDS_AP:["cds-ap-web-india.agora.io","cds-ap-web-india2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-india.agora.io","sua-ap-web-india2.agora.io"],UAP_AP:["uap-ap-web-india.agora.io","uap-ap-web-india2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],PROXY_SERVER_TYPE3:["india.webrtc-cloud-proxy.sd-rtn.com"]},KOREA:{CODE:du.KOREA,WEBCS_DOMAIN:["ap-web-1-korea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-korea.agora.io"],PROXY_CS:["proxy-ap-web-korea.agora.io"],CDS_AP:["cds-ap-web-korea.agora.io","cds-ap-web-korea2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-korea.agora.io","sua-ap-web-korea2.agora.io"],UAP_AP:["uap-ap-web-korea.agora.io","uap-ap-web-korea2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-korea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-korea.agora.io"],LOG_UPLOAD_SERVER:["logservice-korea.agora.io"],PROXY_SERVER_TYPE3:["korea.webrtc-cloud-proxy.sd-rtn.com"]},HKMC:{CODE:du.HKMC,WEBCS_DOMAIN:["ap-web-1-hkmc.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-hkmc.agora.io"],PROXY_CS:["proxy-ap-web-hkmc.agora.io"],CDS_AP:["cds-ap-web-hkmc.agora.io","cds-ap-web-hkmc2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-hkmc.agora.io","sua-ap-web-hkmc2.agora.io"],UAP_AP:["uap-ap-web-hkmc.agora.io","uap-ap-web-hkmc2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-hkmc.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-hkmc.agora.io"],LOG_UPLOAD_SERVER:["logservice-hkmc.agora.io"],PROXY_SERVER_TYPE3:["hkmc.webrtc-cloud-proxy.sd-rtn.com"]},US:{CODE:du.US,WEBCS_DOMAIN:["ap-web-1-us.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-us.agora.io"],PROXY_CS:["proxy-ap-web-us.agora.io"],CDS_AP:["cds-ap-web-us.agora.io","cds-ap-web-us2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-us.agora.io","sua-ap-web-us2.agora.io"],UAP_AP:["uap-ap-web-us.agora.io","uap-ap-web-us2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-us.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-us.agora.io"],LOG_UPLOAD_SERVER:["logservice-us.agora.io"],PROXY_SERVER_TYPE3:["us.webrtc-cloud-proxy.sd-rtn.com"]},OVERSEA:{CODE:du.OVERSEA,WEBCS_DOMAIN:["ap-web-1-oversea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oversea.agora.io"],PROXY_CS:["proxy-ap-web-oversea.agora.io"],CDS_AP:["cds-ap-web-oversea.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oversea.agora.io"],UAP_AP:["uap-ap-web-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.agora.io"]},GLOBAL:{CODE:du.GLOBAL,WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-ap-web-3.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-ap-web-3.agora.io"],UAP_AP:["uap-ap-web-1.agora.io","uap-ap-web-3.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2.agora.io"],LOG_UPLOAD_SERVER:["logservice.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com"]},OCEANIA:{CODE:du.OCEANIA,WEBCS_DOMAIN:["ap-web-1-oceania.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oceania.agora.io"],PROXY_CS:["proxy-ap-web-oceania.agora.io"],CDS_AP:["cds-ap-web-oceania.agora.io","cds-ap-web-oceania2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oceania.agora.io","sua-ap-web-oceania2.agora.io"],UAP_AP:["uap-ap-web-oceania.agora.io","uap-ap-web-oceania2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],PROXY_SERVER_TYPE3:["oceania.webrtc-cloud-proxy.sd-rtn.com"]},SOUTH_AMERICA:{CODE:du.SOUTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-south-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-south-america.agora.io"],PROXY_CS:["proxy-ap-web-south-america.agora.io"],CDS_AP:["cds-ap-web-south-america.agora.io","cds-ap-web-south-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-south-america.agora.io","sua-ap-web-south-america2.agora.io"],UAP_AP:["uap-ap-web-south-america.agora.io","uap-ap-web-south-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],PROXY_SERVER_TYPE3:["south-america.webrtc-cloud-proxy.sd-rtn.com"]},AFRICA:{CODE:du.AFRICA,WEBCS_DOMAIN:["ap-web-1-africa.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-africa.agora.io"],PROXY_CS:["proxy-ap-web-africa.agora.io"],CDS_AP:["cds-ap-web-africa.agora.io","cds-ap-web-africa2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-africa.agora.io","sua-ap-web-africa2.agora.io"],UAP_AP:["uap-ap-web-africa.agora.io","uap-ap-web-africa2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],PROXY_SERVER_TYPE3:["africa.webrtc-cloud-proxy.sd-rtn.com"]},EXTENSIONS:{}};PO&&(Vw.CHINA={CODE:du.CHINA,WEBCS_DOMAIN:["webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["proxy-web.ap.sd-rtn.com"],CDS_AP:["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-web-2.ap.sd-rtn.com","uap-web-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],PROXY_SERVER_TYPE3:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]});let CA=function(_e){return _e.UPDATE_BITRATE_LIMIT="update_bitrate_limit",_e.UPDATE_CLIENT_ROLE_OPTIONS="update_client_role_options",_e}({});function RV(_e){return!!_e&&!(!_e.uplink||!_e.id)&&_e.uplink.max_bitrate!==void 0&&_e.uplink.min_bitrate!==void 0}class wV extends Fs{constructor(rt,it){super(),Jt(this,"onICEConnectionStateChange",void 0),Jt(this,"onConnectionStateChange",void 0),Jt(this,"onDTLSTransportStateChange",void 0),Jt(this,"onDTLSTransportError",void 0),Jt(this,"onICETransportStateChange",void 0),Jt(this,"onFirstAudioReceived",void 0),Jt(this,"onFirstVideoReceived",void 0),Jt(this,"onFirstAudioDecoded",void 0),Jt(this,"onFirstVideoDecoded",void 0),Jt(this,"onFirstVideoRender",void 0),Jt(this,"onFirstVideoDecodedTimeout",void 0),Jt(this,"onSelectedLocalCandidateChanged",void 0),Jt(this,"onSelectedRemoteCandidateChanged",void 0),Jt(this,"onICECandidateError",void 0),Jt(this,"getLocalVideoStats",void 0)}}class IV extends wV{constructor(rt,it){super(rt,it),Jt(this,"establishPromise",void 0)}}let Pr=function(_e){return _e.VIDEO="video",_e.AUDIO="audio",_e}({}),hu=function(_e){return _e.UDP_RELAY="udp_relay",_e.UDP_TCP_RELAY="udp_tcp_relay",_e.TCP_RELAY="tcp_relay",_e.RELAY="relay",_e}({}),mE=function(_e){return _e[_e.FIRST_CONNECTION=0]="FIRST_CONNECTION",_e[_e.UDP_TCP_RESTART=1]="UDP_TCP_RESTART",_e[_e.RELAY_RESTART=2]="RELAY_RESTART",_e[_e.TCP_RESTART=3]="TCP_RESTART",_e[_e.OLD_FIRST_CONNECTION=10]="OLD_FIRST_CONNECTION",_e[_e.OLD_RESTART=11]="OLD_RESTART",_e[_e.DISCONNECTED_OR_FAILED=20]="DISCONNECTED_OR_FAILED",_e}({});const xV=["disconnected","failed"];let or=function(_e){return _e.LocalVideoTrack="videoTrack",_e.LocalAudioTrack="audioTrack",_e.LocalVideoLowTrack="videoLowTrack",_e}({}),qo=function(_e){return _e.New="new",_e.Connected="connected",_e.Reconnecting="reconnecting",_e.Disconnected="disconnected",_e}({}),jr=function(_e){return _e.AudioMetadata="audioMetadata",_e.AudioPts="audioPts",_e.StateChange="stateChange",_e.IceConnectionStateChange="iceConnectionStateChange",_e.RequestMuteLocal="requestMuteLocal",_e.RequestUnmuteLocal="requestUnmuteLocal",_e.RequestRePublish="requestRePublish",_e.RequestRePublishDataChannel="requestRePublishDataChannel",_e.RequestReSubscribe="requestReSubscribe",_e.RequestUploadStats="requestUploadStats",_e.RequestUpload="requestUpload",_e.MediaReconnectStart="MediaReconnectStart",_e.MediaReconnectEnd="MediaReconnectEnd",_e.NeedSignalRTT="NeedSignalRTT",_e.RequestRestartICE="RequestRestartIce",_e.PeerConnectionStateChange="PeerConnectionStateChange",_e.RequestReconnect="RequestReconnect",_e.RequestReconnectPC="RequestReconnectPC",_e.RequestUnpublishForReconnectPC="RequestUnpublishForReconnectPC",_e.P2PLost="P2PLost",_e.UpdateVideoEncoder="UpdateVideoEncoder",_e.ConnectionTypeChange="ConnectionTypeChange",_e.RequestLowStreamParameter="RequestLowStreamParameter",_e.QueryClientConnectionState="QueryClientConnectionState",_e.LocalCandidate="LocalCandidate",_e.RequestP2PMuteLocal="requestP2PMuteLocal",_e.RequestP2PUnPublish="RequestP2PUnPublish",_e.RequestP2PUnmuteRemote="RequestP2PUnmuteRemote",_e.RequestP2PMuteRemote="RequestP2PMuteRemote",_e.RequestP2PRestartICE="RequestP2PRestartICE",_e}({}),Rm=function(_e){return _e.CONNECTING="CONNECTING",_e.RECONNECTING="RECONNECTING",_e.CONNECTED="CONNECTED",_e.CLOSED="CLOSED",_e}({}),wm=function(_e){return _e[_e.CONNECT_AP=0]="CONNECT_AP",_e[_e.AP_CONNECTED=1]="AP_CONNECTED",_e[_e.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",_e[_e.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",_e[_e.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",_e[_e.CONNECT_WORKER=5]="CONNECT_WORKER",_e[_e.WORKER_CONNECTED=6]="WORKER_CONNECTED",_e[_e.CLOSED=7]="CLOSED",_e}({}),Bl=function(_e){return _e.CONNECTION_STATE_CHANGE="connection-state-change",_e.STATE_CHANGE="state-change",_e.INSPECT_RESULT="inspect-result",_e.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",_e.REQUEST_NEW_WORKER_URL="request-new-worker-url",_e}({}),OV=function(_e){return _e.CONNECTED="transmitter:connected",_e.RECONNECTING="transmitter:reconnecting",_e.WILL_RECONNECT="transmitter:will_reconnect",_e.CLOSED="transmitter:closed",_e.FAILED="transmitter:failed",_e.ON_MESSAGE="transmitter:on_message",_e.REQUEST_NEW_URLS="transmitter:request_new_urls",_e.RECONNECT_CREATE_CONNECTION="transmitter:reconnect_create_connection",_e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="transmitter:on_token_privilege_did_expire",_e.TO_CONNECT_DATACHANNEL="transmitter:to_connect_datachannel",_e.FAILBACK="transmitter:failback",_e.PRE_CONNECT_PC="transmitter:pre_connect_pc",_e}({}),U_=function(_e){return _e.CAMERA_CHANGED="camera-changed",_e.MICROPHONE_CHANGED="microphone-changed",_e.PLAYBACK_DEVICE_CHANGED="playback-device-changed",_e.AUDIO_AUTOPLAY_FAILED="audio-autoplay-failed",_e.AUTOPLAY_FAILED="autoplay-failed",_e.AUDIO_CONTEXT_STATE_CHANGED="audio-context-state-changed",_e.SECURITY_POLICY_VIOLATION="security-policy-violation",_e}({}),tm=function(_e){return _e.CONNECTING="CONNECTING",_e.RECONNECTING="RECONNECTING",_e.CONNECTED="CONNECTED",_e.CLOSED="CLOSED",_e}({}),s_=function(_e){return _e.CONNECTION_STATE_CHANGE="connection-state-change",_e.STATE_CHANGE="state-change",_e.INSPECT_RESULT="inspect-result",_e.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",_e.REQUEST_NEW_WORKER_URL="request-new-worker-url",_e}({}),PS=function(_e){return _e[_e.CONNECT_AP=0]="CONNECT_AP",_e[_e.AP_CONNECTED=1]="AP_CONNECTED",_e[_e.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",_e[_e.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",_e[_e.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",_e[_e.CONNECT_WORKER=5]="CONNECT_WORKER",_e[_e.WORKER_CONNECTED=6]="WORKER_CONNECTED",_e[_e.CLOSED=7]="CLOSED",_e}({}),qs=function(_e){return _e.CALL="call",_e.CANDIDATE="candidate",_e.PUBLISH="publish",_e.UNPUBLISH="unpublish",_e.CONTROL="control",_e.RESTART_ICE="restart_ice",_e.ACK="ack",_e.RESPONSE="response",_e.JOIN="join",_e.CHECK="check",_e}({}),NS=function(_e){return _e.ABORT="abort",_e}({}),sv=function(_e){return _e.MUTE_LOCAL_AUDIO="mute_local_audio",_e.MUTE_LOCAL_VIDEO="mute_local_video",_e.UNMUTE_LOCAL_AUDIO="unmute_local_audio",_e.UNMUTE_LOCAL_VIDEO="unmute_local_video",_e}({}),RX=function(_e){return _e.P2P_TOKEN_TIMEOUT="p2p_token_timeout",_e.P2P_TOKEN_CHANGED="p2p_token_changed",_e}({});const wX={[kw.ACCESS_POINT]:{[Vu.NO_FLAG_SET]:{desc:"flag is zero",retry:!1},[Vu.FLAG_SET_BUT_EMPTY]:{desc:"flag is empty",retry:!1},[Vu.INVALID_FALG_SET]:{desc:"invalid flag",retry:!1},[Vu.FLAG_SET_BUT_NO_RE]:{desc:"flag set unilbs but no request",retry:!1},[Vu.INVALID_SERVICE_ID]:{desc:"invalid service id",retry:!1},[Vu.NO_SERVICE_AVAILABLE]:{desc:"no service available",retry:!0},[Vu.NO_SERVICE_AVAILABLE_P2P]:{desc:"no unilbs p2p service available",retry:!0},[Vu.NO_SERVICE_AVAILABLE_VOICE]:{desc:"no unilbs voice service available",retry:!0},[Vu.NO_SERVICE_AVAILABLE_WEBRTC]:{desc:"no unilbs webrtc service available",retry:!0},[Vu.NO_SERVICE_AVAILABLE_CDS]:{desc:"no cds service available",retry:!0},[Vu.NO_SERVICE_AVAILABLE_CDN]:{desc:"no cdn dispatcher service available",retry:!0},[Vu.NO_SERVICE_AVAILABLE_TDS]:{desc:"no tds service available",retry:!0},[Vu.NO_SERVICE_AVAILABLE_REPORT]:{desc:"no unilbs report service available",retry:!0},[Vu.NO_SERVICE_AVAILABLE_APP_CENTER]:{desc:"no app center service available",retry:!0},[Vu.NO_SERVICE_AVAILABLE_ENV0]:{desc:"no unilbs sig env0 service available",retry:!0},[Vu.NO_SERVICE_AVAILABLE_VOET]:{desc:"no unilbs voet service available",retry:!0},[Vu.NO_SERVICE_AVAILABLE_STRING_UID]:{desc:"no string uid service available",retry:!0},[Vu.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS]:{desc:"no webrtc unilbs service available",retry:!0}},[kw.UNILBS]:{[bm.INVALID_VENDOR_KEY]:{desc:"invalid vendor key, can not find appid",retry:!1},[bm.INVALID_CHANNEL_NAME]:{desc:"invalid channel name",retry:!1},[bm.INTERNAL_ERROR]:{desc:"unilbs internal error",retry:!1},[bm.NO_AUTHORIZED]:{desc:"invalid token, authorized failed",retry:!1},[bm.DYNAMIC_KEY_TIMEOUT]:{desc:"dynamic key or token timeout",retry:!1},[bm.NO_ACTIVE_STATUS]:{desc:"no active status",retry:!1},[bm.DYNAMIC_KEY_EXPIRED]:{desc:"dynamic key expired",retry:!1},[bm.STATIC_USE_DYNAMIC_KEY]:{desc:"static use dynamic key",retry:!1},[bm.DYNAMIC_USE_STATIC_KEY]:{desc:"dynamic use static key",retry:!1},[bm.USER_OVERLOAD]:{desc:"amount of users over load",retry:!1},[bm.FORBIDDEN_REGION]:{desc:"the request is forbidden in this area",retry:!1},[bm.CANNOT_MEET_AREA_DEMAND]:{desc:"unable to allocate services in this area",retry:!1}},[kw.STRING_UID_ALLOCATOR]:{[hM.IIIEGAL_APPID]:{desc:"invalid appid",retry:!1},[hM.IIIEGAL_UID]:{desc:"invalid string uid",retry:!1},[hM.INTERNAL_ERROR]:{desc:"string uid allocator internal error",retry:!0}}};function DS(_e){const rt=wX[Math.floor(_e/1e4)];if(!rt)return{desc:"unknown error",retry:!1};const it=rt[_e%1e4];if(!it){if(Math.floor(_e/1e4)===kw.ACCESS_POINT){const ct=_e%1e4;if(ct.toString()[0]==="1")return{desc:_e.toString(),retry:!1};if(ct.toString()[0]==="2")return{desc:_e.toString(),retry:!0}}return{desc:"unknown error",retry:!1}}return it}const IX={[Xr.K_TIMESTAMP_EXPIRED]:{desc:"K_TIMESTAMP_EXPIRED",action:"failed"},[Xr.K_CHANNEL_PERMISSION_INVALID]:{desc:"K_CHANNEL_PERMISSION_INVALID",action:"failed"},[Xr.K_CERTIFICATE_INVALID]:{desc:"K_CERTIFICATE_INVALID",action:"failed"},[Xr.K_CHANNEL_NAME_EMPTY]:{desc:"K_CHANNEL_NAME_EMPTY",action:"failed"},[Xr.K_CHANNEL_NOT_FOUND]:{desc:"K_CHANNEL_NOT_FOUND",action:"failed"},[Xr.K_TICKET_INVALID]:{desc:"K_TICKET_INVALID",action:"failed"},[Xr.K_CHANNEL_CONFLICTED]:{desc:"K_CHANNEL_CONFLICTED",action:"failed"},[Xr.K_SERVICE_NOT_READY]:{desc:"K_SERVICE_NOT_READY",action:"tryNext"},[Xr.K_SERVICE_TOO_HEAVY]:{desc:"K_SERVICE_TOO_HEAVY",action:"tryNext"},[Xr.K_UID_BANNED]:{desc:"K_UID_BANNED",action:"failed"},[Xr.K_IP_BANNED]:{desc:"K_IP_BANNED",action:"failed"},[Xr.DATASTREAM2_NOT_AVAILABLE]:{desc:"DATASTREAM2_NOT_AVAILABLE",action:"quit"},[Xr.K_AUTO_REBALANCE]:{desc:"k_AUTO_REBALANCE",action:"recover"},[Xr.ERR_INVALID_VENDOR_KEY]:{desc:"ERR_INVALID_VENDOR_KEY",action:"failed"},[Xr.ERR_INVALID_CHANNEL_NAME]:{desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"},[Xr.WARN_NO_AVAILABLE_CHANNEL]:{desc:"WARN_NO_AVAILABLE_CHANNEL",action:"failed"},[Xr.WARN_LOOKUP_CHANNEL_TIMEOUT]:{desc:"WARN_LOOKUP_CHANNEL_TIMEOUT",action:"tryNext"},[Xr.WARN_LOOKUP_CHANNEL_REJECTED]:{desc:"WARN_LOOKUP_CHANNEL_REJECTED",action:"failed"},[Xr.WARN_OPEN_CHANNEL_TIMEOUT]:{desc:"WARN_OPEN_CHANNEL_TIMEOUT",action:"tryNext"},[Xr.WARN_OPEN_CHANNEL_REJECTED]:{desc:"WARN_OPEN_CHANNEL_REJECTED",action:"failed"},[Xr.WARN_REQUEST_DEFERRED]:{desc:"WARN_REQUEST_DEFERRED",action:"failed"},[Xr.ERR_DYNAMIC_KEY_TIMEOUT]:{desc:"ERR_DYNAMIC_KEY_TIMEOUT",action:"failed"},[Xr.ERR_NO_AUTHORIZED]:{desc:"ERR_NO_AUTHORIZED",action:"failed"},[Xr.ERR_VOM_SERVICE_UNAVAILABLE]:{desc:"ERR_VOM_SERVICE_UNAVAILABLE",action:"tryNext"},[Xr.ERR_NO_CHANNEL_AVAILABLE_CODE]:{desc:"ERR_NO_CHANNEL_AVAILABLE_CODE",action:"failed"},[Xr.ERR_MASTER_VOCS_UNAVAILABLE]:{desc:"ERR_MASTER_VOCS_UNAVAILABLE",action:"tryNext"},[Xr.ERR_INTERNAL_ERROR]:{desc:"ERR_INTERNAL_ERROR",action:"tryNext"},[Xr.ERR_NO_ACTIVE_STATUS]:{desc:"ERR_NO_ACTIVE_STATUS",action:"failed"},[Xr.ERR_INVALID_UID]:{desc:"ERR_INVALID_UID",action:"failed"},[Xr.ERR_DYNAMIC_KEY_EXPIRED]:{desc:"ERR_DYNAMIC_KEY_EXPIRED",action:"failed"},[Xr.ERR_STATIC_USE_DYANMIC_KE]:{desc:"ERR_STATIC_USE_DYANMIC_KE",action:"failed"},[Xr.ERR_DYNAMIC_USE_STATIC_KE]:{desc:"ERR_DYNAMIC_USE_STATIC_KE",action:"failed"},[Xr.ERR_NO_VOCS_AVAILABLE]:{desc:"ERR_NO_VOCS_AVAILABLE",action:"tryNext"},[Xr.ERR_NO_VOS_AVAILABLE]:{desc:"ERR_NO_VOS_AVAILABLE",action:"tryNext"},[Xr.ERR_JOIN_CHANNEL_TIMEOUT]:{desc:"ERR_JOIN_CHANNEL_TIMEOUT",action:"tryNext"},[Xr.ERR_JOIN_BY_MULTI_IP]:{desc:"ERR_JOIN_BY_MULTI_IP",action:"recover"},[Xr.ERR_NOT_JOINED]:{desc:"ERR_NOT_JOINED",action:"failed"},[Xr.ERR_REPEAT_JOIN_REQUEST]:{desc:"ERR_REPEAT_JOIN_REQUEST",action:"quit"},[Xr.ERR_REPEAT_JOIN_CHANNEL]:{desc:"ERR_REPEAT_JOIN_CHANNEL",action:"quit"},[Xr.ERR_INVALID_STRINGUID]:{desc:"ERR_INVALID_STRINGUID",action:"failed"},[Xr.ERR_TOO_MANY_USERS]:{desc:"ERR_TOO_MANY_USERS",action:"tryNext"},[Xr.ERR_SET_CLIENT_ROLE_TIMEOUT]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[Xr.ERR_SET_CLIENT_ROLE_NO_PERMISSION]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[Xr.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE]:{desc:"ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",action:"success"},[Xr.ERR_PUBLISH_REQUEST_INVALID]:{desc:"ERR_PUBLISH_REQUEST_INVALID",action:"failed"},[Xr.ERR_SUBSCRIBE_REQUEST_INVALID]:{desc:"ERR_SUBSCRIBE_REQUEST_INVALID",action:"failed"},[Xr.ERR_NOT_SUPPORTED_MESSAGE]:{desc:"ERR_NOT_SUPPORTED_MESSAGE",action:"failed"},[Xr.ERR_ILLEAGAL_PLUGIN]:{desc:"ERR_ILLEAGAL_PLUGIN",action:"failed"},[Xr.ILLEGAL_CLIENT_ROLE_LEVEL]:{desc:"ILLEGAL_CLIENT_ROLE_LEVEL",action:"failed"},[Xr.ERR_REJOIN_TOKEN_INVALID]:{desc:"ERR_REJOIN_TOKEN_INVALID",action:"failed"},[Xr.ERR_REJOIN_USER_NOT_JOINED]:{desc:"ERR_REJOIN_NOT_JOINED",action:"failed"},[Xr.ERR_INVALID_OPTIONAL_INFO]:{desc:"ERR_INVALID_OPTIONAL_INFO",action:"quit"},[Xr.ERR_TEST_RECOVER]:{desc:"ERR_TEST_RECOVER",action:"recover"},[Xr.ERR_TEST_TRYNEXT]:{desc:"ERR_TEST_TRYNEXT",action:"recover"},[Xr.ERR_TEST_RETRY]:{desc:"ERR_TEST_RETRY",action:"recover"},[Xr.ILLEGAL_AES_PASSWORD]:{desc:"ERR_TEST_RETRY",action:"failed"},[Xr.ERR_TOO_MANY_BROADCASTERS]:{desc:"ERR_TOO_MANY_BROADCASTERS",action:"failed"},[Xr.ERR_TOO_MANY_SUBSCRIBERS]:{desc:"ERR_TOO_MANY_SUBSCRIBERS",action:"failed"},[Xr.ERR_LICENSE_ILLEGAL]:{desc:"ERR_LICENSE_ILLEGAL",action:"quit"},[Xr.ERR_LICENSE_MISSING]:{desc:"ERR_LICENSE_MISSING",action:"quit"},[Xr.ERR_LICENSE_EXPIRED]:{desc:"ERR_LICENSE_EXPIRED",action:"quit"},[Xr.ERR_LICENSE_MINUTES_EXCEEDED]:{desc:"ERR_LICENSE_MINUTES_EXCEEDED",action:"quit"},[Xr.ERR_LICENSE_PERIOD_INVALID]:{desc:"ERR_LICENSE_PERIOD_INVALID",action:"quit"},[Xr.ERR_LICENSE_MULTIPLE_SDK_SERVICE]:{desc:"ERR_LICENSE_MULTIPLE_SDK_SERVICE",action:"quit"}};function bA(_e){return IX[_e]||{desc:"UNKNOWN_ERROR_".concat(_e),action:"failed"}}function MV(_e,rt){var it=Object.keys(_e);if(Object.getOwnPropertySymbols){var ct=Object.getOwnPropertySymbols(_e);rt&&(ct=ct.filter(function(ut){return Object.getOwnPropertyDescriptor(_e,ut).enumerable})),it.push.apply(it,ct)}return it}function gM(_e){for(var rt=1;rt<arguments.length;rt++){var it=arguments[rt]!=null?arguments[rt]:{};rt%2?MV(Object(it),!0).forEach(function(ct){Jt(_e,ct,it[ct])}):Object.getOwnPropertyDescriptors?Object.defineProperties(_e,Object.getOwnPropertyDescriptors(it)):MV(Object(it)).forEach(function(ct){Object.defineProperty(_e,ct,Object.getOwnPropertyDescriptor(it,ct))})}return _e}function _M(_e,rt){if(typeof _e=="string")return _e;const{proxy:it,host:ct,port:ut}=_e;if(rt){const pt=rn("JOIN_GATEWAY_FALLBACK_PORT")||443;return pt===443?"wss://".concat(ct,"/ws/?p=").concat(Number(ut)+150):"wss://".concat(ct,":").concat(pt,"/ws/?p=").concat(Number(ut)+150)}return it?"wss://".concat(it,"/ws/?h=").concat(ct,"&p=").concat(ut):"wss://".concat(ct,":").concat(ut)}const xX=/wss:\/\/(.+)\/ws\/\?h=(.+)&p=([0-9]+)\/?/,OX=/wss:\/\/(.+)\/ws\/\?p=([0-9]+)\/?/,MX=/wss:\/\/(.+):([0-9]+)\/?/,PX=/wss:\/\/(.[^\/]+)\/?/;let NX=0;class DX{constructor(rt,it){Jt(this,"id",0),Jt(this,"store",void 0),Jt(this,"recordIndex",void 0),Jt(this,"websockets",[]),Jt(this,"try443PortDuration",2e3),Jt(this,"forceCloseWSDuration",5e3),Jt(this,"try443PortTimeout",null),Jt(this,"forceCloseTimeout",null),Jt(this,"isTry443PortFailed",!1),Jt(this,"isNormalPortFailed",!1),Jt(this,"useDoubleDomain",!1),Jt(this,"useProxy",!1),Jt(this,"startTime",Date.now()),this.id=++NX,this.try443PortDuration=rn("JOIN_GATEWAY_TRY_443PORT_DURATION")||2e3,this.forceCloseWSDuration=rt||5e3,this.store=it}closeAllWebsockets(){this.websockets.forEach(rt=>{rt.onopen=null,rt.onclose=null,rt.onmessage=null,rt.close()}),this.websockets.length=0}clearTimeout(){this.forceCloseTimeout&&clearTimeout(this.forceCloseTimeout),this.try443PortTimeout&&clearTimeout(this.try443PortTimeout),this.forceCloseTimeout=null,this.try443PortTimeout=null}logger(){var rt;const it=Date.now()-this.startTime;for(var ct=arguments.length,ut=new Array(ct),pt=0;pt<ct;pt++)ut[pt]=arguments[pt];Ut.debug("[choose-best-ws ".concat((rt=this.store)===null||rt===void 0?void 0:rt.clientId," ").concat(this.id,"] ").concat(it,"ms:"),...ut)}createWebSocket(rt,it,ct){this.logger("createWebSocket:",rt,{isTry443Port:it,hasTimeoutDetection:ct});const ut=rn("GATEWAY_DOMAINS"),pt=Date.now(),mt=[],_t=ut.find(Mt=>{var Dt;return Er(Dt=rt.host).call(Dt,Mt)});_t||(this.useDoubleDomain=!1);const vt=[];if(this.useDoubleDomain)ut.forEach(Mt=>{vt.push(_M(gM(gM({},rt),{},{host:rt.host.replace(_t,Mt)}),it))});else{const Mt=gM({},rt);if(it&&_t){const Dt=ut.find(jt=>jt!==_t);Dt&&(Mt.host=Mt.host.replace(_t,Dt))}vt.push(_M(Mt,it))}try{vt.forEach(Mt=>{const Dt=new WebSocket(Mt);Dt.binaryType="arraybuffer",mt.push(Dt),this.logger("ws is connecting:",Dt.url)})}catch(Mt){if(this.logger("ws create failed"),mt.forEach(Dt=>Dt.close()),mt.length=0,this.useDoubleDomain)return this.useDoubleDomain=!1,this.createWebSocket(rt,it,ct);if(!it&&Number(rt.port)!==443)return this.createWebSocket(rt,!0,ct);throw new $n(tn.WS_ERR,"init websocket failed! Error: ".concat(Mt.toString()))}const Tt=lA();this.store&&this.store.recordJoinChannelService({urls:mt.map(Mt=>Mt.url),service:"gateway"},this.recordIndex),mt.forEach(Mt=>{Mt.onopen=()=>{this.logger("onopen: ws ".concat(Mt.url," open cost ").concat(Date.now()-pt,"ms")),this.websockets.forEach(Dt=>{Dt!==Mt&&(Dt.onopen=null,Dt.onclose=null,Dt.onmessage=null,Dt.close(),this.logger("close backup websocket: ".concat(Dt.url)))}),this.websockets.length=0,Tt.resolve(Mt)},Mt.onclose=Dt=>{this.logger("onclose: ws ".concat(Mt.url," closed cost ").concat(Date.now()-pt,"ms state: ").concat(Mt.readyState));const jt=mt.every($t=>$t.readyState===WebSocket.CLOSED||$t.readyState===WebSocket.CLOSING);this.logger("".concat(it?"443":"47xx"," websocket closed, all failed: ").concat(jt)),jt&&(it||this.isTry443PortFailed||this.useProxy)?(this.logger("onclose: all websocket is closed, ".concat(Dt.reason)),Tt.reject({code:Dt.code,reason:Fw.A_ROUND_WS_FAILED})):!it&&jt&&!this.isNormalPortFailed&&this.try443PortTimeout&&(this.logger("all 47xx websocket is closed, try 443 port"),this.clearTimeout(),Ot()),it?this.isTry443PortFailed=jt:this.isNormalPortFailed=jt},Mt.onmessage=Dt=>this.logger("".concat(Mt.url," onmessage: ").concat(Dt.data))}),this.websockets.push(...mt);const bt=()=>{this.websockets.forEach(Mt=>Mt.readyState!==WebSocket.OPEN&&Mt.close())},Ot=()=>{if(Tt.isResolved)return bt();No().os===Nl.MAC_OS&&Gs()&&bt(),this.createWebSocket(rt,!0,!0).then(Mt=>{Tt.resolve(Mt)}).catch(Mt=>{this.isNormalPortFailed&&Tt.reject(Mt),this.logger("try 443 port to create ws failed")}),this.forceCloseTimeout=window.setTimeout(()=>{this.logger("5s timeout close un-opens, isWebsocket created: ",Tt.isResolved),this.forceCloseTimeout=null,bt()},this.forceCloseWSDuration)};return ct||(()=>{if(it||this.useProxy)return this.logger("add 5s timeout at ".concat(it?"try-443":"proxy"," condition")),this.forceCloseTimeout=window.setTimeout(()=>{this.forceCloseTimeout=null,bt()},this.forceCloseWSDuration);this.try443PortTimeout=window.setTimeout(()=>{this.logger("2s timeout, isWebsocket created: ",Tt.isResolved),this.try443PortTimeout=null,Ot()},this.try443PortDuration)})(),Tt.promise}chooseBestWebsocket(rt,it,ct,ut){return this.useDoubleDomain=!!it,typeof rt=="string"&&(rt=function(pt){let mt,_t,vt;return[,mt,_t,vt]=pt.match(xX)||[],mt||([,_t,vt]=pt.match(OX)||[]),_t&&vt||([,_t,vt]=pt.match(MX)||[]),_t&&vt||([,_t]=pt.match(PX)||[]),_t||Ut.warning("un-destructible url: ",pt),{proxy:mt,host:_t,port:vt||"443"}}(rt)),this.recordIndex=ut,this.useProxy=!!rt.proxy,ct&&this.useProxy&&(Ut.warn("cannot use 443 only when use proxy"),ct=!1),this.createWebSocket(rt,!!ct,!1).finally(()=>this.clearTimeout())}}function PV(_e,rt){var it=Object.keys(_e);if(Object.getOwnPropertySymbols){var ct=Object.getOwnPropertySymbols(_e);rt&&(ct=ct.filter(function(ut){return Object.getOwnPropertyDescriptor(_e,ut).enumerable})),it.push.apply(it,ct)}return it}class NV extends Fs{get url(){return this.websocket&&this.websocket.url||this._websocketUrl}get reconnectMode(){return this._reconnectMode}set reconnectMode(rt){var it;Er(it=["tryNext","recover"]).call(it,rt)&&this.resetReconnectCount(rt),this._reconnectMode=rt}get state(){return this._state}set state(rt){rt!==this._state&&(this._state=rt,this._state==="reconnecting"?this.emit(ho.RECONNECTING,this.reconnectReason):this._state==="connected"?this.emit(ho.CONNECTED):this._state==="closed"?this.emit(ho.CLOSED):this._state==="failed"&&this.emit(ho.FAILED))}resetReconnectCount(rt){Ut.debug("websocket reset reconnect count, reason: "+rt),this.reconnectCount=0}constructor(rt,it){let ct=arguments.length>2&&arguments[2]!==void 0&&arguments[2],ut=arguments.length>3&&arguments[3]!==void 0&&arguments[3],pt=arguments.length>4&&arguments[4]!==void 0&&arguments[4],mt=arguments.length>5?arguments[5]:void 0;super(),Jt(this,"_websocketUrl",null),Jt(this,"connectionID",0),Jt(this,"currentURLIndex",0),Jt(this,"urls",[]),Jt(this,"_reconnectMode","tryNext"),Jt(this,"reconnectReason",void 0),Jt(this,"_initMutex",void 0),Jt(this,"name",void 0),Jt(this,"_state","closed"),Jt(this,"reconnectInterrupter",void 0),Jt(this,"websocket",void 0),Jt(this,"retryConfig",void 0),Jt(this,"reconnectCount",0),Jt(this,"forceCloseTimeout",5e3),Jt(this,"onlineReconnectListener",void 0),Jt(this,"useCompress",void 0),Jt(this,"tryDoubleDomain",!1),Jt(this,"use443PortOnly",!1),Jt(this,"wsInflateLength",0),Jt(this,"wsDeflateLength",0),Jt(this,"closeEstablishingWs",()=>{}),Jt(this,"store",void 0),Jt(this,"joinGatewayRecordIndex",void 0),this.store=mt,this.name=rt,this.retryConfig=function(Ot){for(var Mt=1;Mt<arguments.length;Mt++){var Dt=arguments[Mt]!=null?arguments[Mt]:{};Mt%2?PV(Object(Dt),!0).forEach(function(jt){Jt(Ot,jt,Dt[jt])}):Object.getOwnPropertyDescriptors?Object.defineProperties(Ot,Object.getOwnPropertyDescriptors(Dt)):PV(Object(Dt)).forEach(function(jt){Object.defineProperty(Ot,jt,Object.getOwnPropertyDescriptor(Dt,jt))})}return Ot}({},it),this.useCompress=ct,this.tryDoubleDomain=ut,this.use443PortOnly=pt,this._initMutex=new lu("websocket",mt?mt.clientId:void 0);const{timeout:_t,timeoutFactor:vt}=it,Tt=Math.max(300,Math.floor(3*_t/5)),bt=Math.max(1.2,Math.floor(8*vt)/10);Cp.ONLINE&&(this.retryConfig.timeout=Tt,this.retryConfig.timeoutFactor=bt),Qs.on(pS.NETWORK_STATE_CHANGE,(Ot,Mt)=>{Ot!==Mt&&(this.resetReconnectCount("network state change: ".concat(Mt," -> ").concat(Ot)),Ot===Cp.ONLINE?(this.retryConfig.timeout=Tt,this.retryConfig.timeoutFactor=bt):(this.retryConfig.timeout=_t,this.retryConfig.timeoutFactor=vt))})}getConnection(){return this.websocket||void 0}async init(rt){let it=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const ct=await this._initMutex.lock();this._reconnectMode="tryNext",this.forceCloseTimeout=it,this.urls=rt,this.state="connecting";try{var ut;const pt=lA(),mt=this.urls[this.currentURLIndex];(ut=this.store)===null||ut===void 0||ut.beforeConnect(),function(_t){return!(yw()||rn("USE_NEW_TOKEN")||!rn("ENABLE_PREALLOC_PC")&&(_t==null||!_t.autoSubscribe||rn("FORCE_DISABLE_AUTO_SUB")))}(this.store)&&this.emit(OV.PRE_CONNECT_PC),this.createWebSocketConnection(mt).then(pt.resolve).catch(pt.reject),this.once(ho.CLOSED,()=>{pt.reject(new Yn(tn.WS_DISCONNECT))}),this.once(ho.CONNECTED,pt.resolve),await pt.promise}catch{}finally{ct()}}close(rt,it){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this.reconnectInterrupter&&this.reconnectInterrupter(),this.websocket){this.websocket.onclose=null,this.websocket.onopen=null,this.websocket.onmessage=null;const ct=this.websocket;it?setTimeout(()=>ct.close(),500):ct.close(),this.websocket=void 0,this._websocketUrl=null}this.state=rt?"failed":"closed",this.closeEstablishingWs&&this.closeEstablishingWs()}reconnect(rt,it){if(!this.websocket)return void Ut.warning("[".concat(this.name,"] can not reconnect, no websocket"));rt!==void 0&&(this.reconnectMode=rt),Ut.debug("[".concat(this.name,"] reconnect is triggered initiative")),typeof this.joinGatewayRecordIndex=="number"&&this.store&&this.store.recordJoinChannelService({status:"error",errors:[new Error(it)]},this.joinGatewayRecordIndex);const ct=this.websocket.onclose;this.websocket.onclose=null,this.websocket.close(),ct&&ct.bind(this.websocket)({code:9999,reason:it})}sendMessage(rt){let it=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!this.websocket||this.websocket.readyState!==WebSocket.OPEN)throw new Yn(tn.WS_ABORT,"websocket is not ready");try{it||(rt=JSON.stringify(rt)),this.websocket.send(rt)}catch(ct){throw new Yn(tn.WS_ERR,"send websocket message error"+ct.toString())}}setWsInflateData(rt){this.wsDeflateLength=this.wsDeflateLength+rt.originLength,this.wsInflateLength=this.wsInflateLength+rt.compressedLength}getWsInflateData(){const rt=this.wsInflateLength,it=this.wsDeflateLength;return this.clearWsInflateData(),{wsInflateLength:rt,wsDeflateLength:it}}clearWsInflateData(){this.wsInflateLength=0,this.wsDeflateLength=0}async createWebSocketConnection(rt){var it;const ct=lA();this.connectionID+=1,this.joinGatewayRecordIndex=void 0;const ut=bt=>{var Ot;(Ot=this.store)===null||Ot===void 0||Ot.signalChannelOpen(),Ut.debug("[".concat(this.name,"] websocket opened:"),bt),this.reconnectMode="retry",this.state="connected",this.resetReconnectCount("opened"),ct.resolve()},pt=async bt=>{var Ot;if(Ut.debug("[".concat(this.name,"] websocket close ").concat((Ot=this.websocket)===null||Ot===void 0?void 0:Ot.url,", code: ").concat(bt.code,", reason: ").concat(bt.reason,", current mode: ").concat(this.reconnectMode)),this.reconnectCount>=this.retryConfig.maxRetryCount)ct.reject(new Yn(tn.WS_DISCONNECT,"websocket close: ".concat(bt.code))),this.close();else{this.state==="connected"&&(this.reconnectReason=bt.reason,this.state="reconnecting");const Mt=Dp(this,ho.WILL_RECONNECT,this.reconnectMode,bt.reason)||this.reconnectMode,Dt=await this.reconnectWithAction(Mt);if(this.state==="closed")return void Ut.debug("[".concat(this.connectionID,"] ws is closed, no need to reconnect"));if(!Dt)return ct.reject(new Yn(tn.WS_DISCONNECT,"websocket reconnect failed: ".concat(bt.code))),this.close(!0);ct.resolve()}},mt=bt=>{this.emit(ho.ON_MESSAGE,bt)},_t=bt=>{Ut.warn("[".concat(this.connectionID,"] ws open error ").concat(bt))};this.websocket&&(this.websocket.onclose=null,this.websocket.close()),rn("GATEWAY_WSS_ADDRESS")&&this.name.startsWith("gateway")&&(rt=rn("GATEWAY_WSS_ADDRESS")),Ut.debug("[".concat(this.name,"] start connect, url:"),rt);const vt=(it=this.store)===null||it===void 0?void 0:it.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"});try{var Tt;this._websocketUrl=_M(rt);const bt=await this.chooseBestWebsocketConnection(rt);this.websocket=bt,ut&&ut(this.websocket.url),this.websocket.onclose=pt,this.websocket.onmessage=mt,this.websocket.onerror=_t,(Tt=this.store)===null||Tt===void 0||Tt.recordJoinChannelService({endTs:Date.now(),status:"success"},vt),this.joinGatewayRecordIndex=vt}catch(bt){const Ot=this.state==="closed",Mt=bt instanceof Yn,Dt=Mt&&bt.code===tn.WS_ABORT,jt=Mt&&bt.code===tn.WS_ERR,$t=Mt?bt.message:bt&&(bt.reason||bt.toString());Ut.warning("[choose-best-ws] chooseBestWebsocket error: ".concat($t)),this.store&&this.store.recordJoinChannelService({endTs:Date.now(),status:Dt?"aborted":"error",errors:[bt]},vt),Ot||jt?(ct.reject(Ot?new Yn(tn.WS_DISCONNECT,"websocket is closed: ".concat($t)):new Yn(tn.WS_ERR,"init websocket failed: ".concat($t))),jt&&Ut.error("[".concat(this.name,"] init websocket failed: ").concat($t))):pt&&pt(bt)}return ct.promise}async reconnectWithAction(rt){let it=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(this.reconnectCount>=this.retryConfig.maxRetryCount||this.urls.length===0||this.state==="closed")return!1;Ut.warning("[choose-best-ws] action: =>",rt),this.onlineReconnectListener||Qs.isOnline||!Qs.onlineWaiter||(this.onlineReconnectListener=Qs.onlineWaiter.then(()=>{this.onlineReconnectListener=void 0}));let ct=!0;if(this.reconnectInterrupter=()=>ct=!1,it){const mt=CO(this.reconnectCount,this.retryConfig);Ut.debug("[".concat(this.name,"] wait ").concat(mt,"ms to reconnect websocket, mode: ").concat(rt)),await Ir.race([zl(mt),this.onlineReconnectListener||new Ir(()=>{})])}if(this._state==="closed"||!ct)return!1;this.reconnectCount+=1;const ut=async(mt,_t)=>{this.emit(ho.RECONNECT_CREATE_CONNECTION,_t),await this.createWebSocketConnection(mt)};try{if(rt==="retry")await ut(this.urls[this.currentURLIndex],rt);else if(rt==="tryNext"){if(this.currentURLIndex+=1,this.currentURLIndex>=this.urls.length)return this.reconnectWithAction("recover",!1);Ut.debug("[".concat(this.name,"] websocket url length: ").concat(this.urls.length," current index: ").concat(this.currentURLIndex)),await ut(this.urls[this.currentURLIndex],rt)}else rt==="recover"&&(Ut.debug("[".concat(this.name,"] request new urls")),this.resetReconnectCount("recover mode"),this.urls=await ru(this,ho.REQUEST_NEW_URLS),this.currentURLIndex=0,await ut(this.urls[this.currentURLIndex],rt))}catch(mt){var pt;Ut.error("[".concat(this.name,"] reconnect failed ").concat(mt&&mt.toString()));const _t=mt==null||(pt=mt.data)===null||pt===void 0?void 0:pt.desc;return Array.isArray(_t)&&Er(_t).call(_t,"dynamic key expired")?(this.emit(ho.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):this.reconnectWithAction(rt,it)}return!0}}class EM extends NV{constructor(rt,it){super(rt,it,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(rt,it){const ct=lA(),ut=function(mt,_t){return new DX(mt,_t)}(this.forceCloseTimeout,this.store);this.closeEstablishingWs=()=>{Ut.debug("[choose-best-ws] close establishing websockets"),ut.closeAllWebsockets(),ct.reject(new Yn(tn.WS_ABORT,"choose best websocket aborted"))};const pt=rn("GATEWAY_DOMAINS");return Ut.debug("[choose-best-ws] currentDomain: ",rt,", domains: ",pt,"total: ".concat(this.urls.length),"current: ".concat(this.currentURLIndex+1)),ut.chooseBestWebsocket(rt,this.tryDoubleDomain,this.use443PortOnly,it).then(ct.resolve).catch(ct.reject),ct.promise.finally(()=>{this.closeEstablishingWs=void 0})}}class RA extends NV{constructor(rt,it){super(rt,it,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(rt,it){return new Ir((ct,ut)=>{let pt=!1;const mt=[];this.closeEstablishingWs=()=>{Ut.debug("[choose-best-ws] close establishing websockets"),mt.forEach(jt=>{jt.onclose=null,jt.onopen=null,jt.onmessage=null,jt.close()}),ut(new Yn(tn.WS_ABORT,"choose best websocket aborted"))};const _t=rn("GATEWAY_DOMAINS");let vt;const Tt=rt.indexOf("?h="),bt=_t.find(jt=>Tt!==-1?Er(rt).call(rt,jt,Tt):Er(rt).call(rt,jt));Ut.debug("[choose-best-ws] currentDomain: ",bt,", domains: ",_t);let Ot=!this.tryDoubleDomain||!bt;if(!Ot&&bt){var Mt;const jt=Date.now();try{_t.forEach($t=>{const Ht=Tt===-1?rt.replace(bt,$t):rt.substr(0,Tt)+rt.substr(Tt).replace(bt,$t),en=new WebSocket(Ht);en.binaryType="arraybuffer",mt.push(en),Ut.debug("[choose-best-ws] ws is connecting:",en.url)})}catch{for(Ut.debug("[choose-best-ws] ws create failed, fallback to single url"),mt.forEach(Ht=>Ht.close());mt.length;)mt.pop();Ot=!0}(Mt=this.store)===null||Mt===void 0||Mt.recordJoinChannelService({urls:mt.map($t=>$t.url),service:"gateway"},it),mt.forEach($t=>{$t.onopen=()=>{if(pt)return;const Ht=Date.now()-jt;Ut.debug("[choose-best-ws] ws open cost ".concat(Ht,"ms")),mt.filter(en=>en!==$t).forEach(en=>{Ut.debug("[choose-best-ws]close backup websocket: ".concat(en.url)),en.close()}),pt=!0,ct($t)},$t.onclose=Ht=>{vt=Ht,!pt&&(mt.find(en=>!(en.readyState===WebSocket.CLOSED||en.readyState===WebSocket.CLOSING))||(Ut.debug("[choose-best-ws] all websocket is closed"),pt=!0,ut(vt)))},$t.onmessage=Ht=>{Ut.debug("[choose-best-ws]".concat($t.url," onmessage: ").concat(Ht.data))}}),zl(this.forceCloseTimeout).then(()=>{mt.forEach($t=>{$t.readyState!==WebSocket.OPEN&&$t.close()})})}if(Ot){var Dt;let jt;Ut.debug("[choose-best-ws] use single url: ",rt),(Dt=this.store)===null||Dt===void 0||Dt.recordJoinChannelService({urls:[rt],service:"gateway"},it);try{jt=new WebSocket(rt),mt.push(jt),jt.binaryType="arraybuffer"}catch($t){const Ht=new Yn(tn.WS_ERR,"init websocket failed! Error: ".concat($t.toString()));return Ut.error("[".concat(this.name,"]").concat(Ht)),void ut(Ht)}jt.onopen=()=>{ct(jt)},jt.onclose=$t=>{ut($t)},jt.onmessage=$t=>{Ut.debug("[choose-best-ws]".concat(jt.url," onmessage: ").concat($t.data))},zl(this.forceCloseTimeout).then(()=>{jt&&jt.readyState!==WebSocket.OPEN&&jt.close()})}}).then(ct=>(this.closeEstablishingWs=void 0,ct)).catch(ct=>{throw this.closeEstablishingWs=void 0,ct})}}class LX extends Fs{get connectionState(){return this._connectionState}set connectionState(rt){rt!==this._connectionState&&(this._connectionState=rt,rt===Ts.CONNECTED?this.emit(io.WS_CONNECTED):rt===Ts.RECONNECTING?this.emit(io.WS_RECONNECTING,this._websocketReconnectReason):rt===Ts.CLOSED&&this.emit(io.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(rt,it){super(),Jt(this,"_disconnectedReason",void 0),Jt(this,"_websocketReconnectReason",void 0),Jt(this,"_connectionState",Ts.CLOSED),Jt(this,"reconnectToken",void 0),Jt(this,"websocket",void 0),Jt(this,"openConnectionTime",void 0),Jt(this,"clientId",void 0),Jt(this,"lastMsgTime",Date.now()),Jt(this,"uploadCache",[]),Jt(this,"uploadCacheInterval",void 0),Jt(this,"rttRolling",new G3(5)),Jt(this,"pingpongTimer",void 0),Jt(this,"wsInflateDataTimer",void 0),Jt(this,"pingpongTimeoutCount",0),Jt(this,"ortc",void 0),Jt(this,"joinResponse",void 0),Jt(this,"multiIpOption",void 0),Jt(this,"initError",void 0),Jt(this,"spec",void 0),Jt(this,"store",void 0),Jt(this,"onWebsocketMessage",ct=>{if(ct.data instanceof ArrayBuffer)return void this.emit(io.ON_BINARY_DATA,ct.data);const ut=JSON.parse(ct.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(ut,"_id")){const pt="res-@".concat(ut._id);this.emit(pt,ut._result,ut._message)}else if(Object.prototype.hasOwnProperty.call(ut,"_type")){if(this.emit(ut._type,ut._message),ut._type===Oo.ON_NOTIFICATION&&this.handleNotification(ut._message),ut._type===Oo.ON_USER_BANNED)switch(ut._message.error_code){case 14:this.close(Xo.UID_BANNED);break;case 15:this.close(Xo.IP_BANNED);break;case 16:this.close(Xo.CHANNEL_BANNED)}if(ut._type===Oo.ON_USER_LICENSE_BANNED)switch(ut._message.error_code){case Xr.ERR_LICENSE_MISSING:this.close(Xo.LICENSE_MISSING);break;case Xr.ERR_LICENSE_EXPIRED:this.close(Xo.LICENSE_EXPIRED);break;case Xr.ERR_LICENSE_MINUTES_EXCEEDED:this.close(Xo.LICENSE_MINUTES_EXCEEDED);break;case Xr.ERR_LICENSE_PERIOD_INVALID:this.close(Xo.LICENSE_PERIOD_INVALID);break;case Xr.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(Xo.LICENSE_MULTIPLE_SDK_SERVICE);break;case Xr.ERR_LICENSE_ILLEGAL:this.close(Xo.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=rt.clientId,this.spec=rt,this.store=it,this.websocket=new EM("gateway-".concat(this.clientId),this.spec.retryConfig,!0,rn("JOIN_GATEWAY_USE_DUAL_DOMAIN"),rn("JOIN_GATEWAY_USE_443PORT_ONLY"),it),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===Ts.CONNECTED&&this.reconnect("retry",nu.OFFLINE)})}async request(rt,it,ct,ut){const pt=ms(6,""),mt={_id:pt,_type:rt,_message:it},_t=this.websocket.connectionID,vt=()=>new Ir((jt,$t)=>{if(this.connectionState===Ts.CONNECTED)return jt();const Ht=()=>{this.off(io.WS_CLOSED,en),jt()},en=()=>{this.off(io.WS_CONNECTED,Ht),$t(new $n(tn.WS_ABORT))};this.once(io.WS_CONNECTED,Ht),this.once(io.WS_CLOSED,en),rt!==_i.PUBLISH&&rt!==_i.PUBLISH_DATASTREAM&&rt!==_i.SUBSCRIBE&&rt!==_i.SUBSCRIBE_DATASTREAM&&rt!==_i.UNSUBSCRIBE&&rt!==_i.UNSUBSCRIBE_DATASTREAM&&rt!==_i.UNPUBLISH&&rt!==_i.UNPUBLISH_DATASTREAM&&rt!==_i.CONTROL&&rt!==_i.RESTART_ICE||this.once(io.DISCONNECT_P2P,()=>{$t(new $n(tn.DISCONNECT_P2P))}),rt!==_i.PUBLISH&&rt!==_i.RESTART_ICE||this.once(io.ABORT_P2P_EXECUTION,()=>{$t(new $n(tn.DISCONNECT_P2P))})});if(this.connectionState!==Ts.CONNECTING&&this.connectionState!==Ts.RECONNECTING||rt===_i.JOIN||rt===_i.REJOIN||await vt(),this.websocket.sendMessage(mt,!0),ut)return;const Tt=new Ir((jt,$t)=>{let Ht=!1;const en=(on,Tn)=>{Ht=!0,jt({isSuccess:on==="success",message:Tn||{}}),this.off(io.WS_CLOSED,Qt),this.off(io.WS_RECONNECTING,Qt),this.emit(io.REQUEST_SUCCESS,rt,it)};this.once("res-@".concat(pt),en);const Qt=()=>{$t(new $n(tn.WS_ABORT,"type: ".concat(rt))),this.off(io.WS_CLOSED,Qt),this.off(io.WS_RECONNECTING,Qt),this.off("res-@".concat(pt),en)};this.once(io.WS_CLOSED,Qt),this.once(io.WS_RECONNECTING,Qt),zl(rn("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==_t||Ht||(Ut.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(rt)),this.emit(io.REQUEST_TIMEOUT,rt,it))})});let bt=null;try{bt=await Tt}catch(jt){if(this.connectionState===Ts.CLOSED||rt===_i.LEAVE)throw new $n(tn.WS_ABORT);return!this.spec.forceWaitGatewayResponse||ct?jt.throw():rt===_i.JOIN||rt===_i.REJOIN?null:(await vt(),await this.request(rt,it))}if(bt.isSuccess)return bt.message;const Ot=Number(bt.message.error_code||bt.message.code),Mt=bA(Ot),Dt=new $n(tn.UNEXPECTED_RESPONSE,"".concat(Mt.desc,": ").concat(bt.message.error_str),{code:Ot,data:bt.message,desc:Mt.desc});return Mt.action==="success"?bt.message:(Ut.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(rt,", error_code: ").concat(Ot,", message: ").concat(Mt.desc,", action: ").concat(Mt.action)),Ot===Xr.ERR_TOO_MANY_BROADCASTERS?((rt===_i.JOIN||rt===_i.REJOIN)&&(this.initError=Dt,this.close()),Dt.throw()):Mt.action==="failed"?Dt.throw():Mt.action==="quit"?(this.initError=Dt,this.close(),Dt.throw()):(Ot===Xr.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=bt.message.option,Ut.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",nu.MULTI_IP)):this.reconnect(Mt.action,nu.SERVER_ERROR),rt===_i.JOIN||rt===_i.REJOIN?null:await this.request(rt,it)))}waitMessage(rt,it){return new Ir(ct=>{const ut=pt=>{(!it||it(pt))&&(this.off(rt,ut),ct(pt))};this.on(rt,ut)})}uploadWRTCStats(rt){if(!this.store.sessionId)return void Ut.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const it={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:rt};this.upload(AA.WRTC_STATS,it)}upload(rt,it){const ct={_type:rt,_message:it};try{this.websocket.sendMessage(ct)}catch{const pt=rn("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(ct),this.uploadCache.length>pt&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==Ts.CONNECTED)return;const mt=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(mt._type,mt._message)},rn("UPLOAD_CACHE_INTERVAL")||2e3))}}send(rt,it){const ct={_type:rt,_message:it};this.websocket.sendMessage(ct)}init(rt){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new Ir((it,ct)=>{this.once(io.WS_CONNECTED,()=>it(this.joinResponse)),this.once(io.WS_CLOSED,ut=>ct(this.initError||new $n(tn.WS_ABORT,ut))),this.connectionState=Ts.CONNECTING,this.websocket.init(rt).catch(ct),this.wsInflateDataTimer&&window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=window.setInterval(()=>{this.handleWsInflateData()},2e4)})}close(rt){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.wsInflateDataTimer&&(this.handleWsInflateData(),window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=rt||Xo.LEAVE,this.connectionState=Ts.CLOSED,Ut.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close()}async join(){if(!this.joinResponse){this.emit(io.ABORT_P2P_EXECUTION),this.store.signalConnected();const rt=await ru(this,io.REQUEST_JOIN_INFO);this.store.joinReq();const it=await this.request(_i.JOIN,rt);if(this.ortc=rt==null?void 0:rt.ortc,this.store.joinRep(),!it)return this.emit(io.REPORT_JOIN_GATEWAY,Fw.TIMEOUT,this.url||""),!1;this.joinResponse=it,this.emit(io.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=Ts.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}async rejoin(){if(!this.reconnectToken)throw new $n(tn.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const rt=fA(this,io.REQUEST_REJOIN_INFO);rt.token=this.reconnectToken;const it=await this.request(_i.REJOIN,rt);return!!it&&(this.connectionState=Ts.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),it.peers&&it.peers.forEach(ct=>{this.emit(Oo.ON_USER_ONLINE,{uid:ct.uid}),ct.audio&&this.emit(Oo.ON_ADD_AUDIO_STREAM,{uid:ct.uid,uint_id:ct.uint_id,audio:!0,ssrcId:ct.audio_ssrc}),ct.video&&this.emit(Oo.ON_ADD_VIDEO_STREAM,{uid:ct.uid,uint_id:ct.uint_id,video:!0,ssrcId:ct.video_ssrc}),ct.audio_mute?this.emit(Oo.MUTE_AUDIO,{uid:ct.uid}):this.emit(Oo.UNMUTE_AUDIO,{uid:ct.uid}),ct.video_mute?this.emit(Oo.MUTE_VIDEO,{uid:ct.uid}):this.emit(Oo.UNMUTE_VIDEO,{uid:ct.uid}),ct.audio_enable_local?this.emit(Oo.ENABLE_LOCAL_AUDIO,{uid:ct.uid}):this.emit(Oo.DISABLE_LOCAL_AUDIO,{uid:ct.uid}),ct.video_enable_local?this.emit(Oo.ENABLE_LOCAL_VIDEO,{uid:ct.uid}):this.emit(Oo.DISABLE_LOCAL_VIDEO,{uid:ct.uid}),ct.audio||ct.video||this.emit(Oo.ON_REMOVE_STREAM,{uid:ct.uid,uint_id:ct.uint_id})}),!0)}reconnect(rt,it){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(rt,it)}async downgradeCodec(rt){if(!this.ortc)return!1;const it={downgrade_codec:rt,ortc:this.ortc};return!!await this.request(_i.DOWNGRADE_CODEC,it)}handleNotification(rt){Ut.debug("[".concat(this.clientId,"] receive notification: "),rt);const it=bA(rt.code);if(rt.code===28&&"detail"in rt&&(Ut.info("[".concat(this.clientId,"] receive recover notification: "),rt.detail),this.emit(io.RECOVER_NOTIFICATION,rt.detail)),it.action!=="success"){if(it.action!=="failed")return it.action==="quit"?(it.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(Xo.UID_BANNED),void this.close()):void this.reconnect(it.action,nu.SERVER_ERROR);Ut.error("[".concat(this.clientId,"] ignore error: "),it.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const rt=rn("PING_PONG_TIME_OUT"),it=Date.now();this.pingpongTimeoutCount>=rt&&(Ut.warning("[".concat(this.clientId,"] PING-PONG Timeout. Last Socket Message: ").concat(it-this.lastMsgTime,"ms")),it-this.lastMsgTime>rn("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",nu.TIMEOUT):this.request(_i.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const ct=Date.now()-it;this.rttRolling.add(ct),rn("REPORT_STATS")&&this.send(_i.PING_BACK,{pingpongElapse:ct})}).catch(ct=>{})}handleWsInflateData(){const{wsInflateLength:rt,wsDeflateLength:it}=this.websocket.getWsInflateData();rt!==0&&it!==0&&this.upload(AA.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:it,ws_inflate_length:rt})}handleWebsocketEvents(){this.websocket.on(ho.RECONNECT_CREATE_CONNECTION,rt=>{this.emit(io.WS_RECONNECT_CREATE_CONNECTION,rt)}),this.websocket.on(ho.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(ho.CLOSED,()=>{this.connectionState=Ts.CLOSED}),this.websocket.on(ho.FAILED,()=>{this._disconnectedReason=Xo.NETWORK_ERROR,this.connectionState=Ts.CLOSED}),this.websocket.on(ho.RECONNECTING,rt=>{this._websocketReconnectReason=rt,this.joinResponse=void 0,this.connectionState===Ts.CONNECTED?this.connectionState=Ts.RECONNECTING:this.connectionState=Ts.CONNECTING}),this.websocket.on(ho.WILL_RECONNECT,(rt,it,ct)=>{const ut=fA(this,io.IS_P2P_DISCONNECTED),pt=ut||rt!=="retry";ut&&rt==="retry"&&(Ut.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),rt="tryNext",it=Fw.P2P_DISCONNECTED),pt&&(Ut.debug("".concat(this.clientId," will renewSession, reconnect mode: ").concat(rt)),this.emit(io.REPORT_JOIN_GATEWAY,it||Fw.UNKNOWN_REASON,this.url||""),this.reconnectToken=void 0,this.emit(io.DISCONNECT_P2P)),ct(rt)}),this.websocket.on(ho.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(rt=>{Ut.warning("[".concat(this.clientId,"] rejoin failed ").concat(rt)),this.reconnect("tryNext",nu.SERVER_ERROR)}):this.join().catch(rt=>{if(this.emit(io.REPORT_JOIN_GATEWAY,rt,this.url||""),rt instanceof $n){if(rt.code===tn.UNEXPECTED_RESPONSE&&rt.data.code===Xr.ERR_NO_AUTHORIZED)return this.initError=new $n(tn.TOKEN_EXPIRE,"dynamic key expired"),void this.close(Xo.TOKEN_EXPIRE);Ut.error("[".concat(this.clientId,"] join gateway request failed"),rt.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",nu.SERVER_ERROR):(this.initError=rt,this.close())}})}),this.websocket.on(ho.REQUEST_NEW_URLS,(rt,it)=>{ru(this,io.REQUEST_RECOVER,this.multiIpOption).then(rt).catch(it)}),this.websocket.on(ho.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(Oo.ON_TOKEN_PRIVILEGE_DID_EXPIRE)}),this.websocket.on(OV.PRE_CONNECT_PC,()=>{this.emit(io.PRE_CONNECT_PC)})}}let kX=function(_e){return _e.NATIVE_RTC="native_rtc",_e.NATIVE_RTM="native_rtm",_e.WEB_RTC="web_rtc",_e.WEB_RTM="web_rtm",_e}({}),na=function(_e){return _e[_e.CHOOSE_SERVER=11]="CHOOSE_SERVER",_e[_e.CLOUD_PROXY=18]="CLOUD_PROXY",_e[_e.CLOUD_PROXY_5=20]="CLOUD_PROXY_5",_e[_e.CLOUD_PROXY_FALLBACK=26]="CLOUD_PROXY_FALLBACK",_e}({});function DV(_e,rt){var it=Object.keys(_e);if(Object.getOwnPropertySymbols){var ct=Object.getOwnPropertySymbols(_e);rt&&(ct=ct.filter(function(ut){return Object.getOwnPropertyDescriptor(_e,ut).enumerable})),it.push.apply(it,ct)}return it}function Gw(_e){for(var rt=1;rt<arguments.length;rt++){var it=arguments[rt]!=null?arguments[rt]:{};rt%2?DV(Object(it),!0).forEach(function(ct){Jt(_e,ct,it[ct])}):Object.getOwnPropertyDescriptors?Object.defineProperties(_e,Object.getOwnPropertyDescriptors(it)):DV(Object(it)).forEach(function(ct){Object.defineProperty(_e,ct,Object.getOwnPropertyDescriptor(it,ct))})}return _e}function av(_e){return _e.match(/^[\.\:\d]+$/)?"".concat(_e.replace(/[^\d]/g,"-"),".").concat(rn("TURN_DOMAIN")):(Ut.debug("Cannot recognized as ip address: ".concat(_e,", use as host2")),_e)}function $w(_e){try{const rt=rn("GATEWAY_DOMAINS").concat(rn("TURN_DOMAIN")).find(it=>Er(_e).call(_e,it));return rt?_e.split(".".concat(rt))[0].replace(/-/g,"."):_e}catch{return Ut.debug("serverUrlToIp error, fallback to url",_e),_e}}function vM(_e,rt){_e.addresses||(_e.addresses=[]);const it=function(_t,vt){if(rn("CONNECT_GATEWAY_WITHOUT_DOMAIN"))return _t.map(Ot=>{let{ip:Mt,port:Dt}=Ot;return{address:"".concat(Mt,":").concat(Dt)}});const Tt=rn("GATEWAY_DOMAINS");let bt=Tt[1]&&Er(vt).call(vt,Tt[1])?1:0;return _t.map(Ot=>{let{domain_prefix:Mt,port:Dt,ip:jt}=Ot;if(Mt)return{address:"".concat(Mt,".").concat(Tt[bt++%Tt.length],":").concat(Dt)};const $t=/^[\.\:\d]+$/.test(jt),Ht=$t?"".concat(jt.replace(/[^\d]/g,"-"),".").concat(Tt[bt++%Tt.length],":").concat(Dt):"".concat(jt,":").concat(Dt);return $t||Ut.debug("Cannot recognized as ip address: ".concat(jt,", use as host3")),{ip:jt,port:Dt,address:Ht}})}(_e.addresses,rt),ct=Array.isArray(_e.detail)&&_e.detail[18];if(ct&&typeof ct=="string"){const _t=ct.split(";");for(let vt=0;vt<_t.length;vt++){var ut;const Tt=wu(ut=_t[vt]).call(ut);it[vt]&&Tt&&(it[vt].ip6=Tt)}}const pt=_e.detail&&_e.detail.candidate;let mt;if(pt){const[_t,vt]=pt.split(":");_t&&vt&&(mt={port:Number(vt),ip:_t,address:"".concat(_t,":").concat(vt)})}return{gatewayAddrs:it,apGatewayAddress:mt,uid:_e.uid,cid:_e.cid,cert:_e.cert,vid:_e.detail&&_e.detail[8],uni_lbs_ip:_e.detail&&_e.detail[1],res:_e,csIp:_e.detail&&_e.detail[502]}}function bp(_e){return typeof _e=="number"?_e:_e.exact||_e.ideal||_e.max||_e.min||0}function LV(_e){const rt=_e._encoderConfig;if(!rt)return{};const it={resolution:rt.width&&rt.height?"".concat(bp(rt.width),"x").concat(bp(rt.height)):void 0,maxVideoBW:rt.bitrateMax,minVideoBW:rt.bitrateMin};return typeof rt.frameRate=="number"?(it.maxFrameRate=rt.frameRate,it.minFrameRate=rt.frameRate):rt.frameRate&&(it.maxFrameRate=rt.frameRate.max||rt.frameRate.ideal||rt.frameRate.exact||rt.frameRate.min,it.minFrameRate=rt.frameRate.min||rt.frameRate.ideal||rt.frameRate.exact||rt.frameRate.max),it}function kV(_e){return _e>=0&&_e<.17?1:_e>=.17&&_e<.36?2:_e>=.36&&_e<.59?3:_e>=.59&&_e<=1?4:_e>1?5:0}function wA(_e,rt){let it,ct,ut;switch(rt){case na.CHOOSE_SERVER:ct=4096,ut="choose server";break;case na.CLOUD_PROXY:ct=1048576,ut="proxy";break;case na.CLOUD_PROXY_5:ct=4194304,ut="proxy5";break;case na.CLOUD_PROXY_FALLBACK:ct=4194310,ut="proxy fallback";break;default:throw new $n(tn.UNEXPECTED_ERROR,"multi unlibs response transformer get unknown service id",{csIp:_e.detail&&_e.detail[502],retry:!1})}if(_e.response_body.forEach(pt=>{pt.buffer&&pt.buffer.flag===ct&&(it={code:pt.buffer.code,addresses:(pt.buffer.edges_services||[]).map(mt=>Gw(Gw({},mt),{},{ticket:pt.buffer.cert})),server_ts:_e.enter_ts,uid:pt.buffer.uid,cid:pt.buffer.cid,cname:pt.buffer.cname,detail:Gw(Gw({},pt.buffer.detail),_e.detail),flag:pt.buffer.flag,opid:_e.opid,cert:pt.buffer.cert})}),!it)throw new $n(tn.MULTI_UNILBS_RESPONSE_ERROR,"cannot parse response ".concat(ut," from multi unilbs response"),{csIp:_e.detail&&_e.detail[502]});return it}async function UV(_e,rt){return await Ir.all(_e.addresses.map(async it=>({address:av(it.ip),tcpport:it.port,udpport:it.port,username:rt&&rn("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?rt.toString():iu.username,password:rt&&rn("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?await yO(rt.toString()):iu.password})))}function yM(_e,rt){const it=rt.getMediaStreamTrack(!0).getSettings(),ct=rt.videoHeight||it.height,ut=rt.videoWidth||it.width;return ct&&ut?Math.max(Math.min(ct,ut)/Math.min(bp(_e.height),bp(_e.width)),1):(Ut.warning("can't get ori-track's height, default scale down 4 times for low stream"),4)}function cv(_e){let{candidateType:rt,relayProtocol:it,type:ct,address:ut,port:pt,protocol:mt}=_e;const _t={candidateType:rt,relayProtocol:it,protocol:mt};if(ct!=="local-candidate"){const vt=ut.split(".");vt.length>=4&&(vt[1]="*",vt[2]="*"),_t.address=vt.join("."),_t.port=pt}return _t}function R0(_e){const rt=_e.split(":"),it=_e.split(/[-.]/),ct=Er(_e).call(_e,"-")?"-":".";let ut=_e;return rt.length>1?it.length>1?(it[1]="**",ut=it[0]+ct+"**:"+rt[rt.length-1]):ut=rt.length>2?rt[0]+ct+"**:"+rt[rt.length-1]:"**:"+rt[rt.length-1]:it.length>1&&(ut=it[0]+ct+"**"),ut}function Hw(){let _e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:rn("SVC_MODE");if(rn("ENABLE_SVC"))return function(rt){return rt in _w}(_e)?_e:_w.L1T3}const BV={[Pr.VIDEO]:[{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"},{key:"video-orientation",extensionName:"urn:3gpp:video-orientation"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"playout-delay",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/playout-delay"},{key:"video-content-type",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-content-type"},{key:"color-space",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/color-space"},{key:"video-timing",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-timing"}],[Pr.AUDIO]:[{key:"ssrc-audio-level",extensionName:"urn:ietf:params:rtp-hdrext:ssrc-audio-level"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"}]};function jw(_e,rt,it){rt.forEach(ct=>{var ut;const pt=BV[_e].find(_t=>{var vt;let{key:Tt}=_t;return Er(vt=ct.extensionName).call(vt,Tt)});if(!pt)return;const mt=it.find(_t=>{let{extensionName:vt}=_t;return Er(vt).call(vt,pt.key)});mt&&Er(ut=mt.extensionName).call(ut,"gdpr_forbidden")&&(ct.extensionName=mt.extensionName)})}function LS(_e,rt){rt.forEach(it=>{var ct;const ut=BV[_e].find(pt=>{var mt;let{key:_t}=pt;return Er(mt=it.extensionName).call(mt,_t)});Er(ct=it.extensionName).call(ct,"gdpr_forbidden")&&ut&&(it.extensionName=ut.extensionName)})}function FV(_e){return _e==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"||Er(_e).call(_e,"abs-send-time")}function zw(_e){return _e==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"||Er(_e).call(_e,"draft-holmer-rmcat-transport-wide-cc-extensions-01")}function VV(_e,rt){var it=Object.keys(_e);if(Object.getOwnPropertySymbols){var ct=Object.getOwnPropertySymbols(_e);rt&&(ct=ct.filter(function(ut){return Object.getOwnPropertyDescriptor(_e,ut).enumerable})),it.push.apply(it,ct)}return it}function GV(_e){for(var rt=1;rt<arguments.length;rt++){var it=arguments[rt]!=null?arguments[rt]:{};rt%2?VV(Object(it),!0).forEach(function(ct){Jt(_e,ct,it[ct])}):Object.getOwnPropertyDescriptors?Object.defineProperties(_e,Object.getOwnPropertyDescriptors(it)):VV(Object(it)).forEach(function(ct){Object.defineProperty(_e,ct,Object.getOwnPropertyDescriptor(it,ct))})}return _e}function IA(_e){let rt=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},it=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},ct=arguments.length>3?arguments[3]:void 0;const{filterRTX:ut,filterVideoFec:pt,filterAudioFec:mt,filterAudioCodec:_t,filterVideoCodec:vt,unsupportedVideoUplinkCodec:Tt,unsupportedVideoDownlinkCodec:bt}=rt,{useXR:Ot}=it;let Mt=[],Dt=[],jt=[],$t=[],Ht=!1,en=!1;if(op(_e).mediaDescriptions.forEach(on=>{ct&&ct!==on.attributes.direction||(on.media.mediaType!=="video"||Ht||(Dt=on.attributes.payloads,$t=on.attributes.extmaps,Ht=!0),on.media.mediaType!=="audio"||en||(Mt=on.attributes.payloads,jt=on.attributes.extmaps,en=!0))}),!$t||Dt.length===0)throw new Error("Cannot get video capabilities from SDP.");if(!jt||Mt.length===0)throw new Error("Cannot get audio capabilities from SDP.");if(Dt.forEach(on=>{var Tn;(Tn=on.rtpMap)!==null&&Tn!==void 0&&Tn.clockRate&&(on.rtpMap.clockRate=parseInt(on.rtpMap.clockRate)),Ot&&on.rtcpFeedbacks.push({type:"rrtr"})}),Mt.forEach(on=>{var Tn;(Tn=on.rtpMap)!==null&&Tn!==void 0&&Tn.clockRate&&(on.rtpMap.clockRate=parseInt(on.rtpMap.clockRate)),Ot&&on.rtcpFeedbacks.push({type:"rrtr"})}),ut&&(Mt=Mt.filter(on=>{var Tn;return((Tn=on.rtpMap)===null||Tn===void 0?void 0:Tn.encodingName.toLowerCase())!=="rtx"}),Dt=Dt.filter(on=>{var Tn;return((Tn=on.rtpMap)===null||Tn===void 0?void 0:Tn.encodingName.toLowerCase())!=="rtx"})),pt){const on=Dt.filter(hn=>{var Ln;return/(red)|(ulpfec)|(flexfec)/i.test(((Ln=hn.rtpMap)===null||Ln===void 0?void 0:Ln.encodingName)||"")}),Tn=uv(on,Dt).map(hn=>hn.payloadType),vn=[...on.map(hn=>hn.payloadType),...Tn];Dt=Dt.filter(hn=>!Er(vn).call(vn,hn.payloadType))}if(mt&&(Mt=Mt.filter(on=>{var Tn;return!/(red)|(ulpfec)|(flexfec)/i.test(((Tn=on.rtpMap)===null||Tn===void 0?void 0:Tn.encodingName)||"")})),_t&&(_t==null?void 0:_t.length)>0&&(Mt=Mt.filter(on=>{var Tn;return Er(_t).call(_t,((Tn=on.rtpMap)===null||Tn===void 0?void 0:Tn.encodingName.toLowerCase())||"")})),vt&&(vt==null?void 0:vt.length)>0){const on=Dt.filter(Tn=>{var vn;return Er(vt).call(vt,((vn=Tn.rtpMap)===null||vn===void 0?void 0:vn.encodingName.toLowerCase())||"")});Dt=on.concat(ut?[]:uv(on,Dt))}const Qt=rn("UNSUPPORTED_VIDEO_CODEC");if(Qt&&Qt.length>0){const on=Dt.filter(hn=>hn.rtpMap&&Er(Qt).call(Qt,hn.rtpMap.encodingName.toLowerCase())),Tn=uv(on,Dt),vn=on.concat(Tn).map(hn=>hn.payloadType);Dt=Dt.filter(hn=>!Er(vn).call(vn,hn.payloadType)),Ut.debug("unsupportedVideoCodec: ".concat(Qt,", toBeRemoved: ").concat(vn))}if(Tt&&Tt.length>0&&ct==="sendonly"){const on=Dt.filter(hn=>hn.rtpMap&&Er(Tt).call(Tt,hn.rtpMap.encodingName.toLowerCase())),Tn=uv(on,Dt),vn=on.concat(Tn).map(hn=>hn.payloadType);Dt=Dt.filter(hn=>!Er(vn).call(vn,hn.payloadType)),Ut.debug("unsupportedVideoUplinkCodec: ".concat(Tt,", toBeRemoved: ").concat(vn))}if(bt&&bt.length>0&&ct==="recvonly"){const on=Dt.filter(hn=>hn.rtpMap&&Er(bt).call(bt,hn.rtpMap.encodingName.toLowerCase())),Tn=uv(on,Dt),vn=on.concat(Tn).map(hn=>hn.payloadType);Dt=Dt.filter(hn=>!Er(vn).call(vn,hn.payloadType)),Ut.debug("unsupportedVideoDownlinkCodec: ".concat(bt,", toBeRemoved: ").concat(vn))}return{audioCodecs:Mt,videoCodecs:Dt,audioExtensions:jt,videoExtensions:$t}}function lv(_e){const rt=op(_e);let it,ct;for(const ut of rt.mediaDescriptions){if(!it){const pt=ut.attributes.iceUfrag,mt=ut.attributes.icePwd;if(!pt||!mt)throw new Error("Cannot get iceUfrag or icePwd from SDP.");it={iceUfrag:pt,icePwd:mt}}if(!ct){const pt=ut.attributes.fingerprints;pt.length>0&&(ct={fingerprints:pt})}}if(!ct&&rt.attributes.fingerprints.length>0&&(ct={fingerprints:rt.attributes.fingerprints}),!ct||!it)throw new Error("Cannot get iceParameters or dtlsParameters from SDP.");return{iceParameters:it,dtlsParameters:ct}}function $V(_e,rt){const it=[],ct=_e.attributes.ssrcGroups.filter(mt=>mt.semantic==="FID"),ut=_e.attributes.ssrcGroups.find(mt=>mt.semantic==="SIM"),pt=_e.attributes.ssrcs;if(ut)ut.ssrcIds.forEach(mt=>{var _t;const vt=(_t=ct.find(Tt=>Tt.ssrcIds[0]===mt))===null||_t===void 0?void 0:_t.ssrcIds[1];it.push({ssrcId:mt,rtx:rt?vt:void 0})});else if(ct.length>0){const mt=ct[0].ssrcIds[0],_t=ct[0].ssrcIds[1];it.push({ssrcId:mt,rtx:rt?_t:void 0})}else{if(pt.length===0)throw new Error("No ssrcs found on local media description.");it.push({ssrcId:pt[0].ssrcId})}return it}function HV(_e,rt,it){const{cname:ct}=_e;let ut=[];rt&&(ut=jV(rt)),ut.length===0&&(ut=_e.iceParameters.candidates.map(bt=>({foundation:bt.foundation,componentId:"1",transport:bt.protocol,priority:bt.priority.toString(),connectionAddress:bt.ip,port:bt.port.toString(),type:bt.type,extension:{}})),Ut.debug("Using candidates from gateway."));const pt={fingerprints:_e.dtlsParameters.fingerprints.map(bt=>({hashFunction:bt.algorithm,fingerprint:bt.fingerprint}))},mt={iceUfrag:_e.iceParameters.iceUfrag,icePwd:_e.iceParameters.icePwd};let _t;switch(_e.dtlsParameters.role){case"server":_t="passive";break;case"client":_t="active";break;case"auto":_t="actpass"}const vt=Kw(_e.rtpCapabilities),Tt=[];return Array.isArray(it)&&it.length>0&&it.forEach(bt=>{Tt.push({kind:Pr.VIDEO,ssrcMsg:[{ssrcId:bt.v,rtx:bt.v_rtx}],mslabel:"".concat(bt.v,"_").concat(bt.a)},{kind:Pr.AUDIO,ssrcMsg:[{ssrcId:bt.a}],mslabel:"".concat(bt.v,"_").concat(bt.a)})}),{dtlsParameters:pt,iceParameters:mt,candidates:ut,rtpCapabilities:vt,setup:_t,cname:ct,preSSRCs:Tt}}function jV(_e){let rt=[];return _e.ip&&typeof _e.port=="number"&&(rt=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:_e.ip,port:_e.port.toString(),type:"host",extension:{}}],Ut.debug("Using remote candidate from AP ".concat(R0(_e.ip),":").concat(_e.port)),_e.ip6&&(rt.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:_e.ip6,port:_e.port.toString(),type:"host",extension:{}}),Ut.debug("Using IPV6 remote candidate from AP ".concat(R0(_e.ip6),":").concat(_e.port)))),rt}function xA(_e,rt,it){const ct=[],ut=[];return _e.forEach(pt=>{let{ssrcId:mt,rtx:_t}=pt;const vt=ms(8,"track-"),Tt={ssrcId:mt,attributes:GV({label:vt,mslabel:it=it||ms(10,""),msid:"".concat(it," ").concat(vt)},rt&&{cname:rt})};if(ct.push(Tt),_t!==void 0){const bt={ssrcId:_t,attributes:GV({label:vt,mslabel:it,msid:"".concat(it," ").concat(vt)},rt&&{cname:rt})};ct.push(bt),ut.push({semantic:"FID",ssrcIds:[mt,_t]})}}),_e.length>1&&ut.push({semantic:"SIM",ssrcIds:_e.map(pt=>{let{ssrcId:mt}=pt;return mt})}),{ssrcs:ct,ssrcGroups:ut}}function kS(_e,rt){rt instanceof Ws&&_e.attributes.payloads.forEach(it=>{var ct;const ut=(ct=it.rtpMap)===null||ct===void 0?void 0:ct.encodingName.toLowerCase();if(!ut||["opus","pcmu","pcma","g722"].indexOf(ut)===-1)return;it.fmtp||(it.fmtp={parameters:{}}),ut==="opus"&&typeof rn("OPUS_PTIME")=="number"?it.fmtp.parameters.ptime=rn("OPUS_PTIME"):it.fmtp.parameters.minptime="10",it.fmtp.parameters.useinbandfec="1";const pt=rt._encoderConfig;pt&&(ut!=="pcmu"&&ut!=="pcma"&&ut!=="g722"&&(pt.bitrate&&!Gs()&&(it.fmtp.parameters.maxaveragebitrate="".concat(Math.floor(1e3*pt.bitrate))),pt.sampleRate&&(it.fmtp.parameters.maxplaybackrate="".concat(pt.sampleRate),it.fmtp.parameters["sprop-maxcapturerate"]="".concat(pt.sampleRate)),pt.stereo&&(it.fmtp.parameters.stereo="1",it.fmtp.parameters["sprop-stereo"]="1")),rt instanceof SA&&ut==="opus"&&rt._config.DTX&&(it.fmtp.parameters.usedtx="1"))})}function SM(_e){const rt=_e.attributes.unrecognized.findIndex(it=>it.attField==="x-google-flag"&&it.attValue==="conference");rt!==-1&&_e.attributes.unrecognized.splice(rt,1)}function TM(_e,rt){var it;if(!(rt instanceof Cs&&rt._encoderConfig&&rt._hints.indexOf(ds.SCREEN_TRACK)===-1))return;const ct=rt._encoderConfig;Fo().supportMinBitrate&&ct.bitrateMin&&_e.attributes.payloads.forEach(ut=>{var pt,mt;Er(pt=["h264","h265","vp8","vp9","av1"]).call(pt,((mt=ut.rtpMap)===null||mt===void 0?void 0:mt.encodingName.toLowerCase())||"")&&(ut.fmtp||(ut.fmtp={parameters:{}}),ut.fmtp.parameters["x-google-min-bitrate"]="".concat(ct.bitrateMin))}),Fo().supportMinBitrate&&!Er(it=rt._hints).call(it,ds.LOW_STREAM)&&ct.bitrateMax&&_e.attributes.payloads.forEach(ut=>{var pt,mt;Er(pt=["h264","h265","vp8","vp9","av1"]).call(pt,((mt=ut.rtpMap)===null||mt===void 0?void 0:mt.encodingName.toLowerCase())||"")&&(ut.fmtp||(ut.fmtp={parameters:{}}),ut.fmtp.parameters["x-google-start-bitrate"]="".concat(rn("X_GOOGLE_START_BITRATE")||Math.floor(ct.bitrateMax)))})}function zV(_e){if(_e.media.mediaType!=="video")return;const rt=No();if(rt.name!==Ho.SAFARI&&rt.os!==Nl.IOS)return;const it=_e.attributes.extmaps.findIndex(ct=>/video-orientation/g.test(ct.extensionName));it!==-1&&_e.attributes.extmaps.splice(it,1)}function Ww(_e,rt,it){if(!rt)return;let ct,ut;if(_e.media.mediaType==="video"?(ct=it.videoExtensions,ut=it.videoCodecs):(ct=it.audioExtensions,ut=it.audioCodecs),rt.twcc===!0){const pt=ct.find(mt=>zw(mt.extensionName));if(pt){const mt=pt.extensionName;_e.attributes.extmaps.find(vt=>zw(vt.extensionName))||_e.attributes.extmaps.push({entry:pt.entry,extensionName:mt}),function(vt,Tt){return Tt.filter(bt=>!!vt.find(Ot=>Ot.payloadType===bt.payloadType&&!!Ot.rtcpFeedbacks.find(Mt=>Mt.type==="transport-cc")))}(ut,_e.attributes.payloads).forEach(vt=>{vt.rtcpFeedbacks.find(Tt=>Tt.type==="transport-cc")||vt.rtcpFeedbacks.push({type:"transport-cc"})})}}else if(rt.twcc===!1){const pt=_e.attributes.extmaps.findIndex(mt=>zw(mt.extensionName));pt!==-1&&_e.attributes.extmaps.splice(pt,1),_e.attributes.payloads.forEach(mt=>{const _t=mt.rtcpFeedbacks.findIndex(vt=>vt.type==="transport-cc");_t!==-1&&mt.rtcpFeedbacks.splice(_t,1)})}if(rt.remb===!0){const pt=ct.find(mt=>FV(mt.extensionName));if(pt){const mt=pt.extensionName;_e.attributes.extmaps.find(vt=>vt.extensionName===mt)||_e.attributes.extmaps.push({entry:pt.entry,extensionName:mt}),function(vt,Tt){return Tt.filter(bt=>!!vt.find(Ot=>Ot.payloadType===bt.payloadType&&!!Ot.rtcpFeedbacks.find(Mt=>Mt.type==="goog-remb")))}(ut,_e.attributes.payloads).forEach(vt=>{vt.rtcpFeedbacks.find(Tt=>Tt.type==="goog-remb")||vt.rtcpFeedbacks.push({type:"goog-remb"})})}}else if(rt.remb===!1){const pt=_e.attributes.extmaps.findIndex(mt=>FV(mt.extensionName));pt!==-1&&_e.attributes.extmaps.splice(pt,1),_e.attributes.payloads.forEach(mt=>{const _t=mt.rtcpFeedbacks.findIndex(vt=>vt.type==="goog-remb");_t!==-1&&mt.rtcpFeedbacks.splice(_t,1)})}}function WV(_e,rt,it){if(Gs()||_e.media.mediaType!=="video"||!(rt instanceof Cs)||it!=="vp9"&&it!=="vp8"||it==="vp8"&&!rn("SIMULCAST")||it==="vp9"&&rn("ENABLE_SVC")||rt._scalabilityMode===void 0||rt._scalabilityMode.numSpatialLayers<=1)return;const ct=it==="vp8"?2:rt._scalabilityMode.numSpatialLayers,ut=_e.attributes.ssrcs[0],pt=_e.attributes.ssrcGroups.find(_t=>_t.semantic==="FID"&&_t.ssrcIds[0]===ut.ssrcId),mt={semantic:"SIM",ssrcIds:[ut.ssrcId]};for(let _t=1;_t<ct;_t++)_e.attributes.ssrcs.push({ssrcId:ut.ssrcId+_t,attributes:Ds(ut.attributes)}),mt.ssrcIds.push(ut.ssrcId+_t),pt&&(_e.attributes.ssrcs.push({ssrcId:pt.ssrcIds[1]+_t,attributes:Ds(ut.attributes)}),_e.attributes.ssrcGroups.push({semantic:"FID",ssrcIds:[ut.ssrcId+_t,pt.ssrcIds[1]+_t]}));_e.attributes.ssrcGroups.unshift(mt)}async function KV(){let _e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},rt=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const it=new RTCPeerConnection;it.addTransceiver("video",{direction:"sendonly"}),it.addTransceiver("audio",{direction:"sendonly"}),it.addTransceiver("video",{direction:"recvonly"}),it.addTransceiver("audio",{direction:"recvonly"});const ct=(await it.createOffer()).sdp,{send:ut,recv:pt,sendrecv:mt}=function(){let _t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},vt=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},Tt=arguments.length>2?arguments[2]:void 0;const bt=IA(Tt,_t,vt,"sendonly"),Ot=IA(Tt,_t,vt,"recvonly"),Mt={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},Dt={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},jt={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(Im(bt,Ot,"videoExtensions",Mt,Dt,jt),Im(bt,Ot,"videoCodecs",Mt,Dt,jt),Im(bt,Ot,"audioExtensions",Mt,Dt,jt),Im(bt,Ot,"audioCodecs",Mt,Dt,jt),rn("RAISE_H264_BASELINE_PRIORITY")){const $t=[],Ht=[];if(jt.videoCodecs.forEach((en,Qt)=>{var on;if(((on=en.rtpMap)===null||on===void 0?void 0:on.encodingName.toLocaleLowerCase())==="h264"){var Tn,vn;const hn=jt.videoCodecs[Qt+1],Ln=hn&&ZV(en,hn),Xn=(Tn=en.fmtp)===null||Tn===void 0?void 0:Tn.parameters["profile-level-id"],Qn=(vn=en.fmtp)===null||vn===void 0?void 0:vn.parameters["packetization-mode"];!Xn||Xn!==rn("FIRST_H264_PROFILE_LEVEL_ID")||rn("FIRST_PACKETIZATION_MODE")&&Qn!==rn("FIRST_PACKETIZATION_MODE")?Ln?Ht.push([en,hn]):Ht.push([en]):Ln?$t.push([en,hn]):$t.push([en])}}),$t.length>0&&Ht.length>0){Ut.debug("raising H264 baseline profile priority"),jt.videoCodecs.forEach((Qt,on)=>{var Tn;if(((Tn=Qt.rtpMap)===null||Tn===void 0?void 0:Tn.encodingName.toLocaleLowerCase())==="h264"){const vn=ZV(Qt,jt.videoCodecs[on+1]),hn=$t.shift()||Ht.shift()||[];hn.length>0&&(vn?jt.videoCodecs.splice(on,2,...hn):jt.videoCodecs.splice(on,1,...hn))}});const en=Dt.videoCodecs.filter(Qt=>{var on,Tn;return((on=Qt.rtpMap)===null||on===void 0?void 0:on.encodingName.toLocaleLowerCase())==="h264"&&((Tn=Qt.fmtp)===null||Tn===void 0?void 0:Tn.parameters["profile-level-id"])!==rn("FIRST_H264_PROFILE_LEVEL_ID")});if(en.length>0){const Qt=uv(en,Dt.videoCodecs).map(Tn=>Tn.payloadType),on=[...en.map(Tn=>Tn.payloadType),...Qt];Dt.videoCodecs=Dt.videoCodecs.filter(Tn=>!Er(on).call(on,Tn.payloadType))}rn("FILTER_SEND_H264_BASELINE")&&(Mt.videoCodecs=Mt.videoCodecs.filter(Qt=>{var on,Tn;return!(((on=Qt.rtpMap)===null||on===void 0?void 0:on.encodingName.toLocaleLowerCase())==="h264"&&((Tn=Qt.fmtp)===null||Tn===void 0?void 0:Tn.parameters["profile-level-id"])!==rn("FIRST_H264_PROFILE_LEVEL_ID"))}))}return{send:Mt,recv:Dt,sendrecv:jt}}return{send:Mt,recv:Dt,sendrecv:jt}}(_e,rt,ct);try{it.close()}catch{}return{send:ut,recv:pt,sendrecv:mt}}function YV(){const _e={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},rt=IA(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"recvonly"),it={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},ct={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},ut={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(Im(_e,rt,"videoExtensions",it,ct,ut),Im(_e,rt,"videoCodecs",it,ct,ut),Im(_e,rt,"audioExtensions",it,ct,ut),Im(_e,rt,"audioCodecs",it,ct,ut),rn("RAISE_H264_BASELINE_PRIORITY")){const pt=ut.videoCodecs.findIndex(mt=>mt.rtpMap&&mt.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&mt.fmtp&&mt.fmtp.parameters["profile-level-id"]==="42001f");if(pt!==-1){const mt=ut.videoCodecs.findIndex(_t=>_t.rtpMap&&_t.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(mt<pt){Ut.debug("raising H264 baseline profile priority");const _t=ut.videoCodecs[pt];ut.videoCodecs.splice(pt,1),ut.videoCodecs.splice(mt,0,_t)}mt!==-1&&(ct.videoCodecs=ct.videoCodecs.filter(_t=>!(_t.rtpMap&&_t.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&_t.fmtp&&_t.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:it,recv:ct,sendrecv:ut}}function Im(_e,rt,it,ct,ut,pt){if(it==="videoExtensions"||it==="audioExtensions"){const mt=[];return _e[it].forEach(_t=>{rt[it].some((vt,Tt)=>{if(_t.entry===vt.entry&&_t.extensionName===vt.extensionName)return mt.push(Tt),!0})?pt[it].push(_t):ct[it].push(_t)}),void rt[it].forEach((_t,vt)=>{mt.indexOf(vt)===-1&&ut[it].push(_t)})}if(it==="videoCodecs"||it==="audioCodecs"){const mt=[];return _e[it].forEach(_t=>{rt[it].some((vt,Tt)=>{if(_t.payloadType===vt.payloadType&&JSON.stringify(_t)===JSON.stringify(vt))return mt.push(Tt),!0})?pt[it].push(_t):ct[it].push(_t)}),void rt[it].forEach((_t,vt)=>{mt.indexOf(vt)===-1&&ut[it].push(_t)})}}function Kw(_e){const{send:rt,recv:it,sendrecv:ct}=_e;if(!ct){if(!rt||!it)throw new Error("cannot merge rtp capabilities because one of send or recv is empty!");return{send:rt,recv:it}}let ut,pt;return rt?(ut={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},ut.audioCodecs=[...rt.audioCodecs,...ct.audioCodecs],ut.videoCodecs=[...rt.videoCodecs,...ct.videoCodecs],ut.audioExtensions=[...rt.audioExtensions,...ct.audioExtensions],ut.videoExtensions=[...rt.videoExtensions,...ct.videoExtensions]):ut=ct,it?(pt={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},pt.audioCodecs=[...it.audioCodecs,...ct.audioCodecs],pt.videoCodecs=[...it.videoCodecs,...ct.videoCodecs],pt.audioExtensions=[...it.audioExtensions,...ct.audioExtensions],pt.videoExtensions=[...it.videoExtensions,...ct.videoExtensions]):pt=ct,{send:ut,recv:pt}}function US(_e){_e.media.mediaType==="audio"&&_e.attributes.payloads.filter(rt=>{var it;return((it=rt.rtpMap)===null||it===void 0?void 0:it.encodingName.toLowerCase())==="opus"}).forEach(rt=>{rt.fmtp||(rt.fmtp={parameters:{}}),rt.fmtp.parameters.stereo="1",rt.fmtp.parameters["sprop-stereo"]="1"})}function OA(_e,rt,it,ct){let ut=[];if(_e===Pr.VIDEO){if(rn("H264_PROFILE_LEVEL_ID")&&ct==="h264"&&(ut=rt.videoCodecs.filter(pt=>{var mt;return Er(mt=pt.rtpMap&&pt.rtpMap.encodingName.toLowerCase()||"").call(mt,ct)&&pt&&pt.fmtp&&pt.fmtp.parameters["profile-level-id"]===rn("H264_PROFILE_LEVEL_ID")})),!Array.isArray(ut)||ut.length===0){let pt=[];const mt=[],_t=[],vt=[];if(it.videoCodecs.forEach(Tt=>{const bt=Tt.rtpMap&&Tt.rtpMap.encodingName.toLowerCase()||"";Er(bt).call(bt,ct)?pt.push(Tt):Er(bt).call(bt,"vp9")?mt.push(Tt):Er(bt).call(bt,"vp8")?_t.push(Tt):Er(bt).call(bt,"h264")&&vt.push(Tt)}),pt.length===0){let Tt="";mt.length!==0?(pt=mt,Tt="vp9"):_t.length!==0?(pt=_t,Tt="vp8"):vt.length!==0&&(pt=vt,Tt="h264"),Ut.warning("codec ".concat(ct," not included in rtpCapabilities, fallback to default payloads: ").concat(Tt))}pt.length!==0&&(ut=rt.videoCodecs.filter(Tt=>pt.some(bt=>bt.payloadType===Tt.payloadType)))}if(ut.length===0&&(Ut.warning("codec ".concat(ct," not included in rtpCapabilities, fallback to default payloads: ").concat(rt.videoCodecs[0].rtpMap&&rt.videoCodecs[0].rtpMap.encodingName)),ut=rt.videoCodecs),rn("USE_PUB_RTX")||rn("USE_SUB_RTX")){const pt=uv(ut,rt.videoCodecs);ut=[...ut,...pt]}}else{ut=rt.audioCodecs.filter(mt=>{var _t;return Er(_t=mt.rtpMap&&mt.rtpMap.encodingName.toLowerCase()||"").call(_t,ct)});const pt=rt.audioCodecs.filter(mt=>{var _t;return Er(_t=mt.rtpMap&&mt.rtpMap.encodingName.toLowerCase()||"").call(_t,"red")});ut.length===0&&(Ut.warning("codec ".concat(ct," not included in rtpCapabilities, fallback to opus")),ut=rt.audioCodecs.filter(mt=>{var _t;return Er(_t=mt.rtpMap&&mt.rtpMap.encodingName.toLowerCase()||"").call(_t,"opus")})),rn("ENABLE_AUDIO_RED")&&pt.length!==0&&(ut=[...pt,...ut])}return ut}function uv(_e,rt){const it=_e.map(ct=>ct.payloadType.toString());return rt.filter(ct=>ct.rtpMap&&ct.rtpMap.encodingName==="rtx"&&ct.fmtp&&ct.fmtp.parameters.apt&&Er(it).call(it,ct.fmtp&&ct.fmtp.parameters.apt))}async function dv(_e,rt,it){const ct=rt.toString(),ut=qV(ct,"offer","remote","exchangeSDP");await _e.setRemoteDescription({type:"offer",sdp:ct});const pt=await _e.createAnswer();if(!pt.sdp)throw new Error("cannot get answer sdp");let mt=pt.sdp;mt=XV(mt,it||{}),ut==null||ut(mt||""),await _e.setLocalDescription({type:"answer",sdp:mt})}function XV(_e,rt,it){const ct=op(_e),{useXR:ut}=rt;return ct.mediaDescriptions.forEach(pt=>{var mt;pt.attributes.mid&&(Array.isArray(it)&&!Er(it).call(it,pt.attributes.mid)||(pt.media.mediaType==="audio"&&US(pt),ut&&Er(mt=["audio","video"]).call(mt,pt.media.mediaType)&&pt.attributes.payloads.forEach(_t=>{_t.rtcpFeedbacks.findIndex(vt=>vt.type==="rrtr")===-1&&_t.rtcpFeedbacks.push({type:"rrtr"})})))}),rv(ct)}function qV(_e,rt,it,ct){if(rn("SDP_LOGGING"))return Ut.upload("exchanging ".concat(it," ").concat(rt," SDP during P2PConnection.").concat(ct,`
`),_e),rt==="offer"?ut=>{qV(ut,"answer",it==="local"?"remote":"local",ct)}:void 0}function JV(_e){const rt=rn("COMPATIBLE_SDP_EXTENSION");return!!(Array.isArray(rt)&&rt.length>0)&&rt.some(it=>Er(_e).call(_e,it))}function ZV(_e,rt){try{var it;return((it=_e.fmtp)===null||it===void 0?void 0:it.parameters.apt)===rt.payloadType.toString()}catch{return!1}}function QV(_e,rt){var it=Object.keys(_e);if(Object.getOwnPropertySymbols){var ct=Object.getOwnPropertySymbols(_e);rt&&(ct=ct.filter(function(ut){return Object.getOwnPropertyDescriptor(_e,ut).enumerable})),it.push.apply(it,ct)}return it}function Hp(_e,rt){return typeof rn(_e)===rt?rn(_e):void 0}function UX(){try{const _e=rn("EXPERIMENTS")||{};return typeof _e=="string"||Array.isArray(_e)?{}:function(rt){for(var it=1;it<arguments.length;it++){var ct=arguments[it]!=null?arguments[it]:{};it%2?QV(Object(ct),!0).forEach(function(ut){Jt(rt,ut,ct[ut])}):Object.getOwnPropertyDescriptors?Object.defineProperties(rt,Object.getOwnPropertyDescriptors(ct)):QV(Object(ct)).forEach(function(ut){Object.defineProperty(rt,ut,Object.getOwnPropertyDescriptor(ct,ut))})}return rt}({},_e)}catch(_e){return Ut.debug("handle gateway attributes failed: ",_e),{}}}const e4={};function hv(_e){(!(arguments.length>1&&arguments[1]!==void 0)||arguments[1])&&Ut.debug("install service ".concat(_e.name)),e4[_e.name]=_e}function gE(_e){const rt=e4[_e];if(!rt)throw new Yn(tn.INVALID_OPERATION,"".concat(_e," not found, please use AgoraRTC.use(").concat(_e,"Service) to load it first"));return rt}function t4(_e,rt){return gE("DataStream").create(_e,rt)}function Yw(){return gE("InterceptFrame").create()}function n4(_e,rt){var it=Object.keys(_e);if(Object.getOwnPropertySymbols){var ct=Object.getOwnPropertySymbols(_e);rt&&(ct=ct.filter(function(ut){return Object.getOwnPropertyDescriptor(_e,ut).enumerable})),it.push.apply(it,ct)}return it}function Au(_e){for(var rt=1;rt<arguments.length;rt++){var it=arguments[rt]!=null?arguments[rt]:{};rt%2?n4(Object(it),!0).forEach(function(ct){Jt(_e,ct,it[ct])}):Object.getOwnPropertyDescriptors?Object.defineProperties(_e,Object.getOwnPropertyDescriptors(it)):n4(Object(it)).forEach(function(ct){Object.defineProperty(_e,ct,Object.getOwnPropertyDescriptor(it,ct))})}return _e}const AM=new Map;class BX extends Fs{get state(){return this._state}set state(rt){if(rt===this._state)return;const it=this._state;this._state=rt,rt==="DISCONNECTED"&&this._disconnectedReason?this.emit(Ul.CONNECTION_STATE_CHANGE,rt,it,this._disconnectedReason):this.emit(Ul.CONNECTION_STATE_CHANGE,rt,it)}get joinGatewayStartTime(){return this._joinGatewayStartTime}set joinGatewayStartTime(rt){Ut.debug("[".concat(this.store.clientId,"] set joinGatewayStartTime at ").concat(rt)),this._joinGatewayStartTime=rt}constructor(rt,it){var ct,ut,pt;super(),Jt(this,"store",void 0),Jt(this,"joinInfo",void 0),Jt(this,"key",void 0),Jt(this,"ntpOffset",0),Jt(this,"signal",void 0),Jt(this,"role",void 0),Jt(this,"isPreallocation",void 0),Jt(this,"isPreSub",void 0),Jt(this,"inChannelInfo",{joinAt:null,duration:0}),Jt(this,"spec",void 0),Jt(this,"_state","DISCONNECTED"),Jt(this,"_statsCollector",void 0),Jt(this,"_disconnectedReason",void 0),Jt(this,"isSignalRecover",!1),Jt(this,"hasChangeBGPAddress",!1),Jt(this,"trafficStatsInterval",void 0),Jt(this,"networkQualityInterval",void 0),Jt(this,"_joinGatewayStartTime",0),Jt(this,"_signalTimeout",!1),Jt(this,"_clientRoleOptions",void 0),Jt(this,"_isProactiveJoin",!1),this.store=rt,this.spec=it,this.signal=this.store.useP2P?(ct={spec:Au(Au({},it),{},{retryConfig:it.websocketRetryConfig}),store:rt},(ut=(pt=gE("P2PChannel")).createSubmodule)===null||ut===void 0?void 0:ut.call(pt,ct)):new LX(Au(Au({},it),{},{retryConfig:it.websocketRetryConfig}),rt),this._statsCollector=it.statsCollector,this.role=it.role||"audience",this._clientRoleOptions=it.clientRoleOptions,this.handleSignalEvents()}async join(rt,it,ct){this.store.joinGatewayStart(),rt.cloudProxyServer!=="disabled"&&(this.hasChangeBGPAddress=!0);const ut=Date.now();let pt=AM.get(rt.cname);if(pt||(pt=new Map,AM.set(rt.cname,pt)),this._isProactiveJoin=!0,pt.has(rt.uid)){const Tt=new $n(tn.UID_CONFLICT);throw Vr.joinGateway(rt.sid,{lts:ut,succ:!1,ec:Tt.code,addr:null,uid:rt.uid,cid:rt.cid,firstSuccess:this._isProactiveJoin,isProxy:!!rt.proxyServer,signalChannel:"0",preload:rt.preload}),Tt}pt.set(rt.uid,!0),this.joinInfo=rt,this.key=it;let mt=0;this.joinGatewayStartTime=ut;const _t=rt.proxyServer;try{Ut.debug("[".concat(this.store.clientId,"] use websocket join uid ").concat(mt));const Tt=rt.gatewayAddrs.map(bt=>{let{address:Ot}=bt;const[Mt,Dt]=Ot.split(":"),jt={host:Mt,port:Dt};return rt.proxyServer&&(jt.proxy=rt.proxyServer),jt});mt=(await this.signal.init(Tt)).uid,Ut.debug("[".concat(this.store.clientId,"] websocket join uid ").concat(mt," cost ").concat(Date.now()-this.joinGatewayStartTime))}catch(Tt){var vt;throw Ut.error("[".concat(this.store.clientId,"] User join failed"),Tt.toString()),Vr.joinGateway(rt.sid,{lts:ut,succ:!1,ec:((vt=Tt.data)===null||vt===void 0?void 0:vt.desc)||Tt.code,errorMsg:Tt.message,addr:this.signal.url,uid:rt.uid,cid:rt.cid,firstSuccess:this._isProactiveJoin,isProxy:!!_t,signalChannel:"0",preload:rt.preload}),pt.delete(rt.uid),this.signal.close(),Tt}return this.state="CONNECTED",this.inChannelInfo.joinAt=Date.now(),Ut.debug("[".concat(this.store.clientId,"] Connected to gateway server")),this.trafficStatsInterval=window.setInterval(()=>{this.updateTrafficStats().catch(Tt=>{Ut.warning("[".concat(this.store.clientId,"] get traffic stats error"),Tt.toString())})},3e3),this.networkQualityInterval=window.setInterval(()=>{navigator&&navigator.onLine!==void 0&&!navigator.onLine?this.emit(Ul.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6}):this._signalTimeout?this.emit(Ul.NETWORK_QUALITY,{downlinkNetworkQuality:5,uplinkNetworkQuality:5}):this.state==="CONNECTED"&&this._statsCollector.trafficStats?this.emit(Ul.NETWORK_QUALITY,{uplinkNetworkQuality:kV(this._statsCollector.trafficStats.B_unq),downlinkNetworkQuality:kV(this._statsCollector.trafficStats.B_dnq)}):this.emit(Ul.NETWORK_QUALITY,{uplinkNetworkQuality:0,downlinkNetworkQuality:0})},2e3),this.store.joinGatewayEnd(),mt}async leave(){let rt=arguments.length>0&&arguments[0]!==void 0&&arguments[0],it=arguments.length>1?arguments[1]:void 0;if(this.state!=="DISCONNECTED"){it!==Xo.FALLBACK&&(this.state="DISCONNECTING");try{rt||this.signal.connectionState!==Ts.CONNECTED||await function(ct,ut){return ut===1/0?ct:Ir.race([ct,lY(ut)])}(this.signal.request(_i.LEAVE,void 0,!0),3e3)}catch(ct){Ut.warning("[".concat(this.store.clientId,"] leave request failed, ignore"),ct)}this.signal.close(it),it!==Xo.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}}async publish(rt,it,ct){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new $n(tn.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const ut={state:"offer",p2p_id:this.store.p2pId,ortc:it,mode:this.spec.mode,extend:rn("PUB_EXTEND"),twcc:!!rn("PUBLISH_TWCC"),rtx:!!rn("USE_PUB_RTX")};try{return(await this.signal.request(_i.PUBLISH,ut,!0))._message}catch(pt){if(ct&&pt.data&&pt.data.code===Xr.ERR_PUBLISH_REQUEST_INVALID)return Ut.warning("[".concat(this.store.clientId,"] receive publish error code, retry"),pt.toString()),await this.tryUnpubBeforeRepub(rt,it),this.publish(rt,it,!1);throw pt}}async publishDataChannel(rt,it,ct){var ut;if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new $n(tn.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const pt={stream_id:it.streamId,ordered:it.ordered?1:0,max_retrans_times:(ut=it.maxRetransmits)!==null&&ut!==void 0?ut:10,channel_id:it.channelId,metadata:it.metadata};try{await this.signal.request(_i.PUBLISH_DATASTREAM,pt,!0)}catch(mt){if(ct&&mt.data&&mt.data.code===Xr.ERR_PUBLISH_REQUEST_INVALID)return Ut.warning("[".concat(this.store.clientId,"] receive publish datachannels error code, retry"),mt.toString()),await this.tryUnpubDataChannelBeforeRepub(rt,it),this.publishDataChannel(rt,it,!1);throw mt}}async unpublish(rt,it){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new $n(tn.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await this.signal.request(_i.UNPUBLISH,{stream_id:it,ortc:rt},!0)}catch(ct){Ut.warning("[".concat(this.store.clientId,"] unpublish warning: "),ct)}}async unpublishDataChannel(rt){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new $n(tn.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await Ir.all(rt.map(it=>this.signal.request(_i.UNPUBLISH_DATASTREAM,{channel_id:it},!0)))}catch(it){Ut.warning("unpublish datachannels warning: ",it)}}async presubscribe(rt,it,ct){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new $n(tn.INVALID_OPERATION,"can not presubscribe when connection state is ".concat(this.state));const ut={stream_id:rt,stream_type:it,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!rn("SUBSCRIBE_TWCC"),rtx:!!rn("USE_SUB_RTX")||void 0,extend:rn("SUB_EXTEND"),svc:Array.isArray(rn("SVC"))&&rn("SVC").length!==0?rn("SVC"):void 0};try{return await this.signal.request(_i.PRE_SUBSCRIBE,ut,!0)}catch(pt){if(ct&&pt.data&&pt.data.code===Xr.ERR_SUBSCRIBE_REQUEST_INVALID)return Ut.warning("[".concat(this.store.clientId,"] pre-subscribe error, retry"),pt.toString()),this.presubscribe(rt,it,!1);throw pt}}async subscribe(rt,it,ct){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new $n(tn.INVALID_OPERATION,"can not subscribe when connection state is ".concat(this.state));const ut={stream_id:rt,stream_type:it.stream_type,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!rn("SUBSCRIBE_TWCC"),rtx:!!rn("USE_SUB_RTX"),extend:rn("SUB_EXTEND"),ssrcId:it.ssrcId,svc:Array.isArray(rn("SVC"))&&rn("SVC").length!==0?rn("SVC"):void 0};try{return(await this.signal.request(_i.SUBSCRIBE,ut,!0))._message}catch(pt){if(ct&&pt.data&&pt.data.code===Xr.ERR_SUBSCRIBE_REQUEST_INVALID)return Ut.warning("[".concat(this.store.clientId,"] receiver subscribe error code, retry"),pt.toString()),await this.tryUnsubBeforeResub(rt,it),await this.subscribe(rt,it,!1);throw pt}}async subscribeDataChannel(rt,it,ct){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new $n(tn.INVALID_OPERATION,"can not subscribe datachannel when connection state is ".concat(this.state));const ut={uid:rt,stream_id:it.id,channel_id:it.datachannelId};try{return void await this.signal.request(_i.SUBSCRIBE_DATASTREAM,ut,!0)}catch(pt){if(ct&&pt.data&&pt.data.code===Xr.ERR_SUBSCRIBE_REQUEST_INVALID)return Ut.warning("[".concat(this.store.clientId,"] receiver subscribe datachannel error code, retry"),pt.toString()),await this.tryUnsubDataChannelBeforeResub(rt,it),await this.subscribeDataChannel(rt,it,!1);throw pt}}async subscribeAll(rt,it){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new $n(tn.INVALID_OPERATION,"can not massSubscribe when connection state is ".concat(this.state));const ct={p2p_id:this.store.p2pId,users:rt,dtx:!1,rtx:!!rn("USE_SUB_RTX"),twcc:!!rn("SUBSCRIBE_TWCC"),svc:Array.isArray(rn("SVC"))&&rn("SVC").length!==0?rn("SVC"):void 0};try{return await this.signal.request(_i.SUBSCRIBE_STREAMS,ct,!0)}catch(ut){if(it&&ut.data&&ut.data.code===Xr.ERR_SUBSCRIBE_REQUEST_INVALID)return Ut.warning("[".concat(this.store.clientId,"] receiver massSubscribe error code, retry"),ut.toString()),await this.tryMassUnsubBeforeResub(rt),await this.subscribeAll(rt,!1);throw ut}}async setVideoProfile(rt){const it=function(ct){if(!(ct.bitrateMax&&ct.bitrateMin&&ct.frameRate&&ct.height&&ct.width))return;let ut=ct.frameRate,pt=ct.width,mt=ct.height,_t=!0;return typeof ut!="number"&&(ut=ut.exact||ut.ideal||ut.max||ut.min||0,ut||(_t=!1)),typeof pt!="number"&&(pt=pt.exact||pt.ideal||pt.max||pt.min||0,pt||(_t=!1)),typeof mt!="number"&&(mt=mt.exact||mt.ideal||mt.max||mt.min||0,ut||(_t=!1)),_t?{stream_type:0,width:pt,height:mt,fps:ut,start_bps:1e3*ct.bitrateMax,min_bps:1e3*ct.bitrateMin,target_bps:1e3*ct.bitrateMax}:void 0}(rt);if(it)return this.signal.request(_i.SET_VIDEO_PROFILE,it);Ut.debug("[".concat(this.store.clientId,"] encoder config is not complete, do not report to gateway"))}async unsubscribe(rt,it){try{await this.signal.request(_i.UNSUBSCRIBE,{p2p_id:this.store.p2pId,ortc:rt,stream_id:it},!0)}catch(ct){Ut.warning("[".concat(this.store.clientId,"] unsubscribe warning: "),ct)}}async unsubscribeDataChannel(rt,it){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new $n(tn.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await Ir.all(rt.map(ct=>this.signal.request(_i.UNSUBSCRIBE_DATASTREAM,{stream_id:ct,uid:it},!0)))}catch(ct){Ut.warning("unsubscribeDataChannel warning: ",ct)}}async massUnsubscribe(rt){try{await this.signal.request(_i.UNSUBSCRIBE_STREAMS,rt,!0)}catch(it){Ut.warning("[".concat(this.store.clientId,"] massUnsubscribeAll warning: "),it)}}async reconnectPC(rt){const{iceParameters:it,dtlsParameters:ct,rtpCapabilities:ut}=rt;return{gatewayEstablishParams:await this.signal.request(_i.CONNECT_PC,{p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:{iceParameters:it,dtlsParameters:ct,rtpCapabilities:ut}},!0),gatewayAddress:this.getCurrentGatewayAddress()}}getGatewayInfo(){return this.signal.request(_i.GATEWAY_INFO)}async renewToken(rt){await this.signal.request(_i.RENEW_TOKEN,rt),this.key=rt.token}updateClientRole(rt,it){it&&(this._clientRoleOptions=Object.assign({},it)),rn("CLIENT_ROLE_OPTIONS")&&(Ut.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(rn("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," ")),this._clientRoleOptions=Object.assign({},rn("CLIENT_ROLE_OPTIONS"))),this.role=rt}async setClientRole(rt,it){if(it&&(this._clientRoleOptions=Object.assign({},it)),rn("CLIENT_ROLE_OPTIONS")&&(this._clientRoleOptions=Object.assign({},rn("CLIENT_ROLE_OPTIONS")),Ut.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(rn("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," "))),this.state!=="CONNECTED")return void(this.role=rt);let ct,ut=0;rt==="audience"?this._clientRoleOptions&&this._clientRoleOptions.delay?(ct=this._clientRoleOptions.delay,ut=1):ut=this._clientRoleOptions&&this._clientRoleOptions.level?this._clientRoleOptions.level:2:ut=0;const pt=Object.assign({},it);delete pt.delay,delete pt.level,await this.signal.request(_i.SET_CLIENT_ROLE,Au(Au({role:rt,level:ut,delay:ct},pt),{},{client_ts:Date.now()})),this.role=rt}async setRemoteVideoStreamType(rt,it){await this.signal.request(_i.SWITCH_VIDEO_STREAM,{stream_id:rt,stream_type:it})}async setDefaultRemoteVideoStreamType(rt){await this.signal.request(_i.DEFAULT_VIDEO_STREAM,{stream_type:rt})}async setStreamFallbackOption(rt,it){await this.signal.request(_i.SET_FALLBACK_OPTION,{stream_id:rt,fallback_type:it})}async pickSVCLayer(rt,it){await this.signal.request(_i.PICK_SVC_LAYER,{stream_id:rt,spatial_layer:it.spatialLayer,temporal_layer:it.temporalLayer})}async setRTM2Flag(rt){await this.signal.request(_i.SET_RTM2_FLAG,{rtm2_flag:rt})}async sendExtensionMessage(rt,it,ct){if(this.store.useP2P)return this.signal.sendExtensionMessage(rt,it,ct)}getInChannelInfo(){return this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt),Au({},this.inChannelInfo)}async getGatewayVersion(){return(await this.signal.request(_i.GATEWAY_INFO)).version}reset(){if(this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt,this.inChannelInfo.joinAt=null),this.trafficStatsInterval&&(window.clearInterval(this.trafficStatsInterval),this.trafficStatsInterval=void 0),this.joinInfo){const rt=AM.get(this.joinInfo.cname);rt&&rt.delete(this.joinInfo.uid)}this.joinInfo=void 0,this.key=void 0,this.networkQualityInterval&&(window.clearInterval(this.networkQualityInterval),this.networkQualityInterval=void 0)}updateTurnConfigFromSignal(){if(!this.joinInfo)return;const rt=function(it){let ct;return ct=it.startsWith("dc")?it.match(/(dc\:\/\/)?([^:]+):(\d+)/):it.match(/(wss\:\/\/)?([^:]+):(\d+)/),ct?{username:iu.username,password:iu.password,turnServerURL:ct[2],tcpport:parseInt(ct[3])+30,udpport:parseInt(ct[3])+30,forceturn:!1}:null}((this.joinInfo.cloudProxyServer==="disabled"?this.signal.url:this.joinInfo.gatewayAddrs[this.signal.currentURLIndex].address)||"");this.joinInfo.turnServer.serversFromGateway=[],rt&&this.joinInfo.turnServer.mode!=="off"&&this.joinInfo.cloudProxyServer==="disabled"&&this.joinInfo.turnServer.serversFromGateway.push(Au(Au({},iu),{},{turnServerURL:rt.turnServerURL,tcpport:rt.tcpport,udpport:rt.udpport,username:this.joinInfo.uid.toString(),password:this.joinInfo.token}))}async updateTrafficStats(){if(this.state!=="CONNECTED")return;const rt=await this.signal.request(_i.TRAFFIC_STATS,void 0,!0);rt.timestamp=Date.now(),rt.ntp_offset!=null&&(this.ntpOffset=rt.ntp_offset),rt.peer_delay.forEach(it=>{const ct=this._statsCollector.trafficStats&&this._statsCollector.trafficStats.peer_delay.find(ut=>ut.peer_uid===it.peer_uid);ct&&ct.B_st!==it.B_st&&pw(()=>{this.emit(Ul.STREAM_TYPE_CHANGE,it.peer_uid,it.B_st)})}),this._statsCollector.updateTrafficStats(rt)}getJoinMessage(rt){var it,ct;if(!this.joinInfo||!this.key)throw new $n(tn.UNEXPECTED_ERROR,"can not generate join message, no join info");const ut=Object.assign({},this.joinInfo.apResponse);let pt=rn("REPORT_APP_SCENARIO");if(typeof pt!="string")try{pt=JSON.stringify(pt)}catch{pt=void 0}var mt;pt&&pt.length>128&&(pt=void 0),this.store.hasStartJoinChannel=!0,this.store.isABTestSuccess||this.emit(Ul.UPDATE_GATEWAY_CONFIG),mt=this.store.clientId,Er(OS).call(OS,mt)||OS.push(mt);const _t=BO(this.store),vt=!((it=this.isPreallocation)===null||it===void 0||!it.call(this)),Tt=oB(this.store),bt=UX(),Ot=dS(87)||f3()||hO(117),Mt=(function(){const jt=No();if(jt.name!==Ho.SAFARI||!jt.browserVersion)return!1;const $t=jt.browserVersion.split(".");return Number($t[0])>18||Number($t[0])===18&&Number($t[1])>=4}()||E3(18,4,!1))&&pO(18,6,!0)&&this.spec.codec==="h264"&&rn("ENABLE_ABSSENDTIME_AS_SENTTS"),Dt=Au({license:this.joinInfo.license,p2p_id:this.store.p2pId,session_id:this.joinInfo.sid,app_id:this.joinInfo.appId,channel_key:this.key,channel_name:this.joinInfo.cname,sdk_version:Zp,browser:navigator.userAgent,process_id:rn("PROCESS_ID"),mode:this.store.useP2P?"p2p":this.spec.mode,codec:this.spec.codec,role:this.role,has_changed_gateway:this.hasChangeBGPAddress,ap_response:ut,extend:rn("JOIN_EXTEND"),details:{6:this.joinInfo.stringUid,cservice_map:this.joinInfo.cloudProxyServer==="proxy3"?"1":this.joinInfo.cloudProxyServer==="proxy5"?"2":void 0},features:{rejoin:!0},optionalInfo:this.joinInfo.optionalInfo,appScenario:pt,attributes:{userAttributes:Au(Au({enableEncodedTransform:(!!rn("ENABLE_AUDIO_METADATA")||!!rn("ENABLE_AUDIO_PTS"))&&Ot||!!rn("ENABLE_AUDIO_TOPN")&&uO(Ho.CHROME,87,116)||void 0,enableAudioMetadata:!!rn("ENABLE_AUDIO_METADATA")&&Ot,enableAudioPts:!!rn("ENABLE_AUDIO_PTS")&&Ot,topnSmoothLevel:rn("TOPN_SMOOTH_LEVEL"),topnNewSpeakerDelay:rn("TOPN_NEW_SPEAKER_DELAY"),topnSwitchHoldMs:rn("TOPN_SWITCH_HOLD_MS"),topnAudioGain:rn("TOPN_AUDIO_GAIN"),enablePublishedUserList:rn("ENABLE_PUBLISHED_USER_LIST"),maxSubscription:rn("MAX_SUBSCRIPTION"),subscribeAudioFilterTopN:Hp("SUBSCRIBE_AUDIO_FILTER_TOPN","number"),enablePublishAudioFilter:Hp("ENABLE_PUBLISH_AUDIO_FILTER","boolean"),enableUserLicenseCheck:Hp("ENABLE_USER_LICENSE_CHECK","boolean"),enableRTX:rn("USE_PUB_RTX")===!0||rn("USE_SUB_RTX")===!0||void 0,disableFEC:rn("DISABLE_FEC"),enableNTPReport:!!rn("ENABLE_NTP_REPORT")||void 0,enableInstantVideo:Tt,enableFulllinkAvSync:!!rn("ENABLE_FULL_LINK_AV_SYNC")||void 0,enableDataStream2:Hp("ENABLE_DATASTREAM_2","boolean"),enableAutFeedback:!!rn("FORCE_ENABLE_AUT_CC")||!yw()&&(!!rn("ENABLE_AUT_FEEDBACK")||void 0),rtm2Flag:typeof this.joinInfo.rtmFlag=="number"?this.joinInfo.rtmFlag:void 0,enableUserAutoRebalanceCheck:!!rn("ENABLE_USER_AUTO_REBALANCE_CHECK"),enableXR:Hp("USE_XR","boolean"),enableLossbasedBwe:Hp("ENABLE_LOSSBASED_BWE","boolean"),enableAutCC:!!rn("FORCE_ENABLE_AUT_CC")||!yw()&&(!!rn("ENABLE_AUT_CC")||void 0),enableCCFallback:Hp("ENABLE_CC_FALLBACK","boolean"),enablePreallocPC:vt,preSubNum:_t?Hp("PRE_SUB_NUM","number"):void 0,enablePubTWCC:Hp("PUBLISH_TWCC","boolean"),enableSubTWCC:Hp("SUBSCRIBE_TWCC","boolean"),enablePubRTX:Hp("USE_PUB_RTX","boolean"),enableSubRTX:Hp("USE_SUB_RTX","boolean"),enableSubSVC:rn("ENABLE_SVC")?rn("ENABLE_SVC_DEFAULT_CODECS"):Array.isArray(rn("SVC"))&&rn("SVC").length!==0?rn("SVC"):void 0,enableSvcExtended:rn("ENABLE_SVC")&&Array.isArray(rn("SVC_EXTENDED"))&&rn("SVC_EXTENDED").length!==0?rn("SVC_EXTENDED"):void 0},bt),{},{audioDuplicate:Hp("ENABLE_AUDIO_RED","boolean")?(ct=Hp("AUDIO_DUPLICATE_NUM","number"))!==null&&ct!==void 0?ct:2:void 0,senttsUsesAbsSendTime:!!Mt||void 0})},join_ts:this.joinGatewayStartTime},rt);return this.joinInfo.stringUid&&(Dt.string_uid=this.joinInfo.stringUid),this.joinInfo.aesmode&&this.joinInfo.aespassword&&(Dt.aes_mode=this.joinInfo.aesmode,rn("ENCRYPT_AES")?(Dt.aes_secret=this.joinInfo.aespassword,Dt.aes_encrypt=!0):Dt.aes_secret=this.joinInfo.aespassword,this.joinInfo.aessalt&&(Dt.aes_salt=this.joinInfo.aessalt)),ut.addresses[this.signal.websocket.currentURLIndex]&&(Dt.ap_response.ticket=ut.addresses[this.signal.websocket.currentURLIndex].ticket,delete ut.addresses),this.joinInfo.defaultVideoStream!==void 0&&(Dt.default_video_stream=this.joinInfo.defaultVideoStream),Dt}getRejoinMessage(){if(!this.joinInfo)throw new $n(tn.UNEXPECTED_ERROR,"can not generate rejoin message, no join info");return{session_id:this.joinInfo.sid,channel_name:this.joinInfo.cname,cid:this.joinInfo.cid,uid:this.joinInfo.uid,vid:Number(this.joinInfo.vid)}}handleSignalEvents(){this.signal.on(io.WS_RECONNECT_CREATE_CONNECTION,rt=>{this.joinGatewayStartTime=Date.now()}),this.signal.on(io.WS_RECONNECTING,rt=>{this.joinInfo&&Vr.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:rt||nu.NETWORK_ERROR}),this.joinInfo&&(this.state="RECONNECTING",Vr.sessionInit(this.joinInfo.sid,{lts:new Date().getTime(),extend:this.isSignalRecover?{recover:!0}:{rejoin:!0},cname:this.joinInfo.cname,appid:this.joinInfo.appId,mode:this.spec.mode,stringUid:this.joinInfo.stringUid,channelProfile:this.spec.mode==="live"?1:0,channelMode:0,lsid:this.joinInfo.sid,clientRole:this.role==="audience"?2:1,buildFormat:1}),this.isSignalRecover=!1,this.joinGatewayStartTime=Date.now())}),this.signal.on(io.WS_CLOSED,rt=>{let it;switch(rt){case Xo.LEAVE:it=nu.LEAVE;break;case Xo.UID_BANNED:case Xo.IP_BANNED:case Xo.CHANNEL_BANNED:case Xo.SERVER_ERROR:it=nu.SERVER_ERROR;break;case Xo.FALLBACK:it=nu.FALLBACK;break;case Xo.LICENSE_MISSING:case Xo.LICENSE_EXPIRED:case Xo.LICENSE_MINUTES_EXCEEDED:case Xo.LICENSE_PERIOD_INVALID:case Xo.LICENSE_MULTIPLE_SDK_SERVICE:case Xo.LICENSE_ILLEGAL:case Xo.TOKEN_EXPIRE:it=rt;break;default:it=nu.NETWORK_ERROR}Ut.debug("[".concat(this.store.clientId,"] [signal] websocket closed, reason: ").concat(it||"undefined -> "+nu.NETWORK_ERROR)),this.joinInfo&&Vr.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:rt===Xo.LEAVE?1:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:it}),this._disconnectedReason=rt,rt!==Xo.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}),this.signal.on(io.WS_CONNECTED,()=>{if(this.updateTurnConfigFromSignal(),this.state="CONNECTED",this.joinInfo){if(this.role==="audience"){const rt=rn("CLIENT_ROLE_OPTIONS")||this._clientRoleOptions;rt&&(rt.level||rt.delay)&&(Ut.debug("[".concat(this.store.clientId,"] patch to send set client role, role: ").concat(this.role,", mode: ").concat(this.spec.mode,", level: ").concat(rt.level,", delay: ").concat(rt.delay)),this.setClientRole(this.role,rt))}if(Vr.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!0,ec:null,vid:this.joinInfo.vid,addr:this.signal.url,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload,isABTestSuccess:this.store.isABTestSuccess}),this._isProactiveJoin=!1,this.joinInfo.useLocalAccessPoint&&this.joinInfo.setLocalAPVersion===1){const rt=this.signal.url&&this.signal.url.match(/wss\:\/\/([^:]+):(\d+)/);if(!rt)return void Ut.error("[".concat(this.store.clientId,"] set local access point after joined failed: ").concat(rt));ns("EVENT_REPORT_DOMAIN",rt[1]),ns("EVENT_REPORT_BACKUP_DOMAIN",rt[1]),ns("LOG_UPLOAD_SERVER","".concat(rt[1],":6444"))}}}),this.signal.on(Oo.ON_UPLINK_STATS,rt=>{this._statsCollector.updateUplinkStats(rt)}),this.signal.on(io.REQUEST_RECOVER,(rt,it,ct)=>{if(!this.joinInfo)return ct(new $n(tn.UNEXPECTED_ERROR,"gateway: can not recover, no join info"));rt&&(this.joinInfo.multiIP=rt,this.hasChangeBGPAddress=!0),this.isSignalRecover=!0,ru(this,Ul.REQUEST_NEW_GATEWAY_LIST).then(it).catch(ct)}),this.signal.on(io.REQUEST_JOIN_INFO,async(rt,it,ct)=>{var ut,pt,mt;if(this.updateTurnConfigFromSignal(),this.store.useP2P)return void rt(this.getJoinMessage({ortc:{}}));const _t=Ds((ut=this.joinInfo)===null||ut===void 0?void 0:ut.turnServer);if(rn("NEW_TURN_MODE")&&_t&&((pt=this.joinInfo)===null||pt===void 0?void 0:pt.cloudProxyServer)==="disabled"){var vt;let Mt=_t.servers.map($t=>"turnServerURL"in $t&&rn("USE_TURN_IP")?Au(Au({},$t),{},{turnServerURL:$w($t.turnServerURL)}):$t),Dt=(vt=_t.serversFromGateway)===null||vt===void 0?void 0:vt.map($t=>rn("USE_TURN_IP")?Au(Au({},$t),{},{turnServerURL:$w($t.turnServerURL)}):$t);const jt=this.signal.currentURLIndex;Mt.length>0&&(Mt=[Mt[jt%Mt.length]],_t.servers=Mt),Array.isArray(Dt)&&Dt.length>0&&(Dt=[Dt[0]],_t.serversFromGateway=Dt),Ut.debug("[".concat(this.store.clientId,"] use single turn, use turn server index: ").concat(jt))}const{iceParameters:Tt,dtlsParameters:bt,rtpCapabilities:Ot}=await ru(this,Ul.REQUEST_P2P_CONNECTION_PARAMS,{turnServer:_t,cloudProxyServer:(mt=this.joinInfo)===null||mt===void 0?void 0:mt.cloudProxyServer});try{rt(this.getJoinMessage({ortc:{iceParameters:Tt,dtlsParameters:bt,rtpCapabilities:Ot,version:"2"}}))}catch(Mt){it(Mt)}}),this.signal.on(io.REQUEST_REJOIN_INFO,rt=>{rt(this.getRejoinMessage())}),this.signal.on(io.REPORT_JOIN_GATEWAY,(rt,it)=>{if(!this.joinInfo)return;let ct,ut="";var pt;rt instanceof $n?(ct=((pt=rt.data)===null||pt===void 0?void 0:pt.desc)||rt.code,ut=rt.message):ct=rt,Vr.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!1,ec:ct,errorMsg:ut,addr:it,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload})}),this.signal.on(io.IS_P2P_DISCONNECTED,rt=>{rt(fA(this,Ul.IS_P2P_DISCONNECTED))}),this.signal.on(io.DISCONNECT_P2P,()=>{this.emit(Ul.DISCONNECT_P2P)}),this.signal.on(io.REQUEST_SUCCESS,()=>{this._signalTimeout=!1}),this.signal.on(io.REQUEST_TIMEOUT,()=>{this._signalTimeout=!0}),this.signal.on(io.JOIN_RESPONSE,rt=>{const it=this.getCurrentGatewayAddress();this.emit(Ul.JOIN_RESPONSE,rt,it)}),this.signal.on(io.PRE_CONNECT_PC,async()=>{if(this.joinInfo){var rt,it;this.updateTurnConfigFromSignal();const ut=this.getCurrentGatewayAddress(),pt=Ds((rt=this.joinInfo)===null||rt===void 0?void 0:rt.turnServer);if(rn("NEW_TURN_MODE")&&pt&&((it=this.joinInfo)===null||it===void 0?void 0:it.cloudProxyServer)==="disabled"){var ct;let _t=pt.servers.map(bt=>"turnServerURL"in bt&&rn("USE_TURN_IP")?Au(Au({},bt),{},{turnServerURL:$w(bt.turnServerURL)}):bt),vt=(ct=pt.serversFromGateway)===null||ct===void 0?void 0:ct.map(bt=>rn("USE_TURN_IP")?Au(Au({},bt),{},{turnServerURL:$w(bt.turnServerURL)}):bt);const Tt=this.signal.currentURLIndex;_t.length>0&&(_t=[_t[Tt%_t.length]],pt.servers=_t),Array.isArray(vt)&&vt.length>0&&(vt=[vt[0]],pt.serversFromGateway=vt),Ut.debug("[".concat(this.store.clientId,"] use single turn, use turn server index: ").concat(Tt,",in pre pc"))}const mt=rn("FINGERPRINT")||this.joinInfo.apResponse.addresses[this.signal.currentURLIndex].fingerprint;if(ut&&mt){const _t=jV(ut);this.emit(Ul.PRE_CONNECT_PC,{candidates:_t,fingerprint:mt,turnServer:pt})}}}),this.signal.on(io.RECOVER_NOTIFICATION,rt=>{this.joinInfo&&typeof rn("AP_REQUEST_DETAIL")=="string"&&(this.joinInfo.apRequestDetail="".concat(rn("AP_REQUEST_DETAIL"),";").concat(rt))})}async tryUnsubBeforeResub(rt,it){try{await this.signal.request(_i.UNSUBSCRIBE,{p2p_id:this.store.p2pId,stream_id:rt,ortc:[it]},!0)}catch(ct){throw Ut.warning("[".concat(this.store.clientId,"] tryUnsubBeforeResub warning"),ct),ct}}async tryUnsubDataChannelBeforeResub(rt,it){try{await this.signal.request(_i.UNSUBSCRIBE,{stream_id:it.id},!0)}catch(ct){throw Ut.warning("unsubscribe datachannel warning",ct),ct}}async tryUnpubBeforeRepub(rt,it){try{await this.signal.request(_i.UNPUBLISH,{stream_id:rt,ortc:it},!0)}catch(ct){throw Ut.warning("[".concat(this.store.clientId,"] tryUnpubBeforeRepub warning: "),ct),ct}}async tryUnpubDataChannelBeforeRepub(rt,it){try{await this.signal.request(_i.UNPUBLISH_DATASTREAM,{channnel_id:it.channelId},!0)}catch(ct){throw Ut.warning("unpublish datastream warning: ",ct),ct}}async tryMassUnsubBeforeResub(rt){const it={users:rt.map(ct=>({stream_id:ct.stream_id,stream_type:ct.stream_type}))};try{await this.signal.request(_i.UNSUBSCRIBE_STREAMS,it,!0)}catch(ct){throw Ut.warning("[".concat(this.store.clientId,"] tryMassUnsubBeforeResub warning"),ct),ct}}async muteLocal(rt,it){const ct={action:rt.find(ut=>ut.stream_type===es.Audio)?"mute_local_audio":"mute_local_video",p2p_id:this.store.p2pId,ortc:rt,stream_id:it};try{await this.signal.request(_i.CONTROL,ct,!0,!0)}catch(ut){throw Ut.warning("[".concat(this.store.clientId,"] gateway muteLocal warning: "),ut),ut}}async unmuteLocal(rt,it){const ct={action:rt.find(ut=>ut.stream_type===es.Audio)?"unmute_local_audio":"unmute_local_video",p2p_id:this.store.p2pId,ortc:rt,stream_id:it};try{await this.signal.request(_i.CONTROL,ct,!0,!0)}catch(ut){throw Ut.warning("[".concat(this.store.clientId,"] gateway unmuteLocal warning: "),ut),ut}}async muteRemote(rt,it){const ct={action:rt===Pr.AUDIO?"mute_remote_audio":"mute_remote_video",p2p_id:this.store.p2pId,stream_id:it};try{await this.signal.request(_i.CONTROL,ct,!0,!0)}catch(ut){throw Ut.warning("[".concat(this.store.clientId,"] gateway muteRemote warning: "),ut),ut}}async unmuteRemote(rt,it){const ct={action:rt===Pr.AUDIO?"unmute_remote_audio":"unmute_remote_video",p2p_id:this.store.p2pId,stream_id:it};try{await this.signal.request(_i.CONTROL,ct,!0,!0)}catch(ut){throw Ut.warning("[".concat(this.store.clientId,"] gateway unmuteRemote warning: "),ut),ut}}uploadWRTCStats(rt){this.signal.uploadWRTCStats(rt)}upload(rt,it){this.signal.upload(rt,it)}getSignalRTT(){return this.signal.rtt}async restartICE(rt){const it={p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:rt};try{return await this.signal.request(_i.RESTART_ICE,it,!0)}catch(ct){throw Ut.warning("[".concat(this.store.clientId,"] P2PChannel.restartICE warning: "),ct),ct}}reconnect(rt,it){this.state==="CONNECTED"&&this.signal.reconnect(rt||void 0,it||nu.P2P_FAILED)}getCurrentGatewayAddress(){var rt,it;if(!rn("GATEWAY_WSS_ADDRESS"))return rn("USE_CANDIDATE_FROM_AP_DETAIL")&&(rt=this.joinInfo)!==null&&rt!==void 0&&rt.apGatewayAddress?(Ut.debug("[".concat(this.store.clientId,"] use candidate from ap detail, ").concat(JSON.stringify(this.joinInfo.apGatewayAddress))),this.joinInfo.apGatewayAddress):(it=this.joinInfo)!==null&&it!==void 0&&it.gatewayAddrs?this.joinInfo.gatewayAddrs[this.signal.currentURLIndex]:void 0}async setPublishAudioFilterEnabled(rt){await this.signal.request(_i.SET_PARAMETER,{enablePublishAudioFilter:rt})}downgradeCodec(rt){this.signal.downgradeCodec(rt)}}let Xw=0,CM=0;function a_(_e,rt,it,ct){return new Ir((ut,pt)=>{rt.timeout=rt.timeout||rn("HTTP_CONNECT_TIMEOUT"),rt.responseType=rt.responseType||"json",rt.data&&!it?(rt.data=JSON.stringify(rt.data),Xw+=M_(rt.data)):it&&(rt.data.size?Xw+=rt.data.size:rt.data instanceof FormData?Xw+=D3(rt.data):Xw+=M_(JSON.stringify(rt.data))),rt.headers=rt.headers||{},rt.headers["Content-Type"]=rt.headers["Content-Type"]||"application/json",rt.method="POST",rt.url=_e,Xu.request(rt).then(mt=>{typeof mt.data=="string"?CM+=M_(mt.data):mt.data instanceof ArrayBuffer||mt.data instanceof Uint8Array?CM+=mt.data.byteLength:CM+=M_(JSON.stringify(mt.data)),ct&&ut({data:mt.data,headers:mt.headers}),ut(mt.data)}).catch(mt=>{Xu.isCancel(mt)?pt(new $n(tn.OPERATION_ABORTED,"cancel token canceled")):mt.code==="ECONNABORTED"?pt(new $n(tn.NETWORK_TIMEOUT,mt.message)):mt.response?pt(new $n(tn.NETWORK_RESPONSE_ERROR,mt.response.status)):pt(new $n(tn.NETWORK_ERROR,mt.message))})})}/*! formdata-polyfill. MIT License. Jimmy W?rting <https://jimmy.warting.se/opensource> */(function(){var _e;function rt(Jn){var _r=0;return function(){return _r<Jn.length?{done:!1,value:Jn[_r++]}:{done:!0}}}var it=typeof Object.defineProperties=="function"?Object.defineProperty:function(Jn,_r,Dr){return Jn==Array.prototype||Jn==Object.prototype||(Jn[_r]=Dr.value),Jn},ct,ut=function(Jn){Jn=[typeof globalThis=="object"&&globalThis,Jn,typeof window=="object"&&window,typeof self=="object"&&self,typeof ot=="object"&&ot];for(var _r=0;_r<Jn.length;++_r){var Dr=Jn[_r];if(Dr&&Dr.Math==Math)return Dr}throw Error("Cannot find global object")}(this);function pt(Jn,_r){if(_r)e:{var Dr=ut;Jn=Jn.split(".");for(var nr=0;nr<Jn.length-1;nr++){var Gt=Jn[nr];if(!(Gt in Dr))break e;Dr=Dr[Gt]}(_r=_r(nr=Dr[Jn=Jn[Jn.length-1]]))!=nr&&_r!=null&&it(Dr,Jn,{configurable:!0,writable:!0,value:_r})}}function mt(Jn){return(Jn={next:Jn})[Symbol.iterator]=function(){return this},Jn}function _t(Jn){var _r=typeof Symbol<"u"&&Symbol.iterator&&Jn[Symbol.iterator];return _r?_r.call(Jn):{next:rt(Jn)}}if(pt("Symbol",function(Jn){function _r(Gt,ln){this.A=Gt,it(this,"description",{configurable:!0,writable:!0,value:ln})}if(Jn)return Jn;_r.prototype.toString=function(){return this.A};var Dr="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",nr=0;return function Gt(ln){if(this instanceof Gt)throw new TypeError("Symbol is not a constructor");return new _r(Dr+(ln||"")+"_"+nr++,ln)}}),pt("Symbol.iterator",function(Jn){if(Jn)return Jn;Jn=Symbol("Symbol.iterator");for(var _r="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),Dr=0;Dr<_r.length;Dr++){var nr=ut[_r[Dr]];typeof nr=="function"&&typeof nr.prototype[Jn]!="function"&&it(nr.prototype,Jn,{configurable:!0,writable:!0,value:function(){return mt(rt(this))}})}return Jn}),typeof Object.setPrototypeOf=="function")ct=Object.setPrototypeOf;else{var vt;e:{var Tt={};try{Tt.__proto__={a:!0},vt=Tt.a;break e}catch{}vt=!1}ct=vt?function(Jn,_r){if(Jn.__proto__=_r,Jn.__proto__!==_r)throw new TypeError(Jn+" is not extensible");return Jn}:null}var bt=ct;function Ot(){this.m=!1,this.j=null,this.v=void 0,this.h=1,this.u=this.C=0,this.l=null}function Mt(Jn){if(Jn.m)throw new TypeError("Generator is already running");Jn.m=!0}function Dt(Jn,_r){return Jn.h=3,{value:_r}}function jt(Jn){this.g=new Ot,this.G=Jn}function $t(Jn,_r,Dr,nr){try{var Gt=_r.call(Jn.g.j,Dr);if(!(Gt instanceof Object))throw new TypeError("Iterator result "+Gt+" is not an object");if(!Gt.done)return Jn.g.m=!1,Gt;var ln=Gt.value}catch(En){return Jn.g.j=null,Jn.g.s(En),Ht(Jn)}return Jn.g.j=null,nr.call(Jn.g,ln),Ht(Jn)}function Ht(Jn){for(;Jn.g.h;)try{var _r=Jn.G(Jn.g);if(_r)return Jn.g.m=!1,{value:_r.value,done:!1}}catch(Dr){Jn.g.v=void 0,Jn.g.s(Dr)}if(Jn.g.m=!1,Jn.g.l){if(_r=Jn.g.l,Jn.g.l=null,_r.F)throw _r.D;return{value:_r.return,done:!0}}return{value:void 0,done:!0}}function en(Jn){this.next=function(_r){return Jn.o(_r)},this.throw=function(_r){return Jn.s(_r)},this.return=function(_r){return function(Dr,nr){Mt(Dr.g);var Gt=Dr.g.j;return Gt?$t(Dr,"return"in Gt?Gt.return:function(ln){return{value:ln,done:!0}},nr,Dr.g.return):(Dr.g.return(nr),Ht(Dr))}(Jn,_r)},this[Symbol.iterator]=function(){return this}}function Qt(Jn,_r){return _r=new en(new jt(_r)),bt&&Jn.prototype&&bt(_r,Jn.prototype),_r}if(Ot.prototype.o=function(Jn){this.v=Jn},Ot.prototype.s=function(Jn){this.l={D:Jn,F:!0},this.h=this.C||this.u},Ot.prototype.return=function(Jn){this.l={return:Jn},this.h=this.u},jt.prototype.o=function(Jn){return Mt(this.g),this.g.j?$t(this,this.g.j.next,Jn,this.g.o):(this.g.o(Jn),Ht(this))},jt.prototype.s=function(Jn){return Mt(this.g),this.g.j?$t(this,this.g.j.throw,Jn,this.g.o):(this.g.s(Jn),Ht(this))},pt("Array.prototype.entries",function(Jn){return Jn||function(){return function(_r,Dr){_r instanceof String&&(_r+="");var nr=0,Gt=!1,ln={next:function(){if(!Gt&&nr<_r.length){var En=nr++;return{value:Dr(En,_r[En]),done:!1}}return Gt=!0,{done:!0,value:void 0}}};return ln[Symbol.iterator]=function(){return ln},ln}(this,function(_r,Dr){return[_r,Dr]})}}),typeof Blob<"u"&&(typeof FormData>"u"||!FormData.prototype.keys)){var on=function(Jn,_r){for(var Dr=0;Dr<Jn.length;Dr++)_r(Jn[Dr])},Tn=function(Jn){return Jn.replace(/\r?\n|\r/g,`\r
`)},vn=function(Jn,_r,Dr){return _r instanceof Blob?(Dr=Dr!==void 0?Dr+"":typeof _r.name=="string"?_r.name:"blob",_r.name===Dr&&Object.prototype.toString.call(_r)!=="[object Blob]"||(_r=new File([_r],Dr)),[String(Jn),_r]):[String(Jn),String(_r)]},hn=function(Jn,_r){if(Jn.length<_r)throw new TypeError(_r+" argument required, but only "+Jn.length+" present.")},Ln=typeof globalThis=="object"?globalThis:typeof window=="object"?window:typeof self=="object"?self:this,Xn=Ln.FormData,Qn=Ln.XMLHttpRequest&&Ln.XMLHttpRequest.prototype.send,ur=Ln.Request&&Ln.fetch,go=Ln.navigator&&Ln.navigator.sendBeacon,Eo=Ln.Element&&Ln.Element.prototype,no=Ln.Symbol&&Symbol.toStringTag;no&&(Blob.prototype[no]||(Blob.prototype[no]="Blob"),"File"in Ln&&!File.prototype[no]&&(File.prototype[no]="File"));try{new File([],"")}catch{Ln.File=function(_r,Dr,nr){return _r=new Blob(_r,nr||{}),Object.defineProperties(_r,{name:{value:Dr},lastModified:{value:+(nr&&nr.lastModified!==void 0?new Date(nr.lastModified):new Date)},toString:{value:function(){return"[object File]"}}}),no&&Object.defineProperty(_r,no,{value:"File"}),_r}}var Yo=function(Jn){return Jn.replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22")},jo=function(Jn){this.i=[];var _r=this;Jn&&on(Jn.elements,function(Dr){if(Dr.name&&!Dr.disabled&&Dr.type!=="submit"&&Dr.type!=="button"&&!Dr.matches("form fieldset[disabled] *"))if(Dr.type==="file"){var nr=Dr.files&&Dr.files.length?Dr.files:[new File([],"",{type:"application/octet-stream"})];on(nr,function(Gt){_r.append(Dr.name,Gt)})}else Dr.type==="select-multiple"||Dr.type==="select-one"?on(Dr.options,function(Gt){!Gt.disabled&&Gt.selected&&_r.append(Dr.name,Gt.value)}):Dr.type==="checkbox"||Dr.type==="radio"?Dr.checked&&_r.append(Dr.name,Dr.value):(nr=Dr.type==="textarea"?Tn(Dr.value):Dr.value,_r.append(Dr.name,nr))})};if((_e=jo.prototype).append=function(Jn,_r,Dr){hn(arguments,2),this.i.push(vn(Jn,_r,Dr))},_e.delete=function(Jn){hn(arguments,1);var _r=[];Jn=String(Jn),on(this.i,function(Dr){Dr[0]!==Jn&&_r.push(Dr)}),this.i=_r},_e.entries=function Jn(){var _r,Dr=this;return Qt(Jn,function(nr){if(nr.h==1&&(_r=0),nr.h!=3)return _r<Dr.i.length?nr=Dt(nr,Dr.i[_r]):(nr.h=0,nr=void 0),nr;_r++,nr.h=2})},_e.forEach=function(Jn,_r){hn(arguments,1);for(var Dr=_t(this),nr=Dr.next();!nr.done;nr=Dr.next()){var Gt=_t(nr.value);nr=Gt.next().value,Gt=Gt.next().value,Jn.call(_r,Gt,nr,this)}},_e.get=function(Jn){hn(arguments,1);var _r=this.i;Jn=String(Jn);for(var Dr=0;Dr<_r.length;Dr++)if(_r[Dr][0]===Jn)return _r[Dr][1];return null},_e.getAll=function(Jn){hn(arguments,1);var _r=[];return Jn=String(Jn),on(this.i,function(Dr){Dr[0]===Jn&&_r.push(Dr[1])}),_r},_e.has=function(Jn){hn(arguments,1),Jn=String(Jn);for(var _r=0;_r<this.i.length;_r++)if(this.i[_r][0]===Jn)return!0;return!1},_e.keys=function Jn(){var _r,Dr,nr,Gt,ln=this;return Qt(Jn,function(En){if(En.h==1&&(_r=_t(ln),Dr=_r.next()),En.h!=3)return Dr.done?void(En.h=0):(nr=Dr.value,Gt=_t(nr),Dt(En,Gt.next().value));Dr=_r.next(),En.h=2})},_e.set=function(Jn,_r,Dr){hn(arguments,2),Jn=String(Jn);var nr=[],Gt=vn(Jn,_r,Dr),ln=!0;on(this.i,function(En){En[0]===Jn?ln&&(ln=!nr.push(Gt)):nr.push(En)}),ln&&nr.push(Gt),this.i=nr},_e.values=function Jn(){var _r,Dr,nr,Gt,ln=this;return Qt(Jn,function(En){if(En.h==1&&(_r=_t(ln),Dr=_r.next()),En.h!=3)return Dr.done?void(En.h=0):(nr=Dr.value,(Gt=_t(nr)).next(),Dt(En,Gt.next().value));Dr=_r.next(),En.h=2})},jo.prototype._asNative=function(){for(var Jn=new Xn,_r=_t(this),Dr=_r.next();!Dr.done;Dr=_r.next()){var nr=_t(Dr.value);Dr=nr.next().value,nr=nr.next().value,Jn.append(Dr,nr)}return Jn},jo.prototype._blob=function(){var Jn="----formdata-polyfill-"+Math.random(),_r=[],Dr="--"+Jn+`\r
Content-Disposition: form-data; name="`;return this.forEach(function(nr,Gt){return typeof nr=="string"?_r.push(Dr+Yo(Tn(Gt))+`"\r
\r
`+Tn(nr)+`\r
`):_r.push(Dr+Yo(Tn(Gt))+'"; filename="'+Yo(nr.name)+`"\r
Content-Type: `+(nr.type||"application/octet-stream")+`\r
\r
`,nr,`\r
`)}),_r.push("--"+Jn+"--"),new Blob(_r,{type:"multipart/form-data; boundary="+Jn})},jo.prototype[Symbol.iterator]=function(){return this.entries()},jo.prototype.toString=function(){return"[object FormData]"},Eo&&!Eo.matches&&(Eo.matches=Eo.matchesSelector||Eo.mozMatchesSelector||Eo.msMatchesSelector||Eo.oMatchesSelector||Eo.webkitMatchesSelector||function(Jn){for(var _r=(Jn=(this.document||this.ownerDocument).querySelectorAll(Jn)).length;0<=--_r&&Jn.item(_r)!==this;);return-1<_r}),no&&(jo.prototype[no]="FormData"),Qn){var fu=Ln.XMLHttpRequest.prototype.setRequestHeader;Ln.XMLHttpRequest.prototype.setRequestHeader=function(Jn,_r){fu.call(this,Jn,_r),Jn.toLowerCase()==="content-type"&&(this.B=!0)},Ln.XMLHttpRequest.prototype.send=function(Jn){Jn instanceof jo?(Jn=Jn._blob(),this.B||this.setRequestHeader("Content-Type",Jn.type),Qn.call(this,Jn)):Qn.call(this,Jn)}}ur&&(Ln.fetch=function(Jn,_r){return _r&&_r.body&&_r.body instanceof jo&&(_r.body=_r.body._blob()),ur.call(this,Jn,_r)}),go&&(Ln.navigator.sendBeacon=function(Jn,_r){return _r instanceof jo&&(_r=_r._asNative()),go.call(this,Jn,_r)}),Ln.FormData=jo}})();const MA=()=>{const _e=rn("AREAS");return _e.length===0&&_e.push(Wo.GLOBAL),_p(_e).call(_e,(rt,it,ct)=>{const ut=r4(it);return ut?ct===0?ut:"".concat(rt,",").concat(ut):rt},"")},r4=_e=>_e===Wo.OVERSEA?"".concat(du.ASIA,",").concat(du.EUROPE,",").concat(du.AFRICA,",").concat(du.NORTH_AMERICA,",").concat(du.SOUTH_AMERICA,",").concat(du.OCEANIA):du[_e],FX=_e=>{const rt={CODE:"",WEBCS_DOMAIN:[],WEBCS_DOMAIN_BACKUP_LIST:[],PROXY_CS:[],CDS_AP:[],ACCOUNT_REGISTER:[],UAP_AP:[],EVENT_REPORT_DOMAIN:[],EVENT_REPORT_BACKUP_DOMAIN:[],LOG_UPLOAD_SERVER:[],PROXY_SERVER_TYPE3:[]};return _e.map(it=>{const ct=Vw[it],ut=Object.keys(ct);ut&&ut.map(pt=>{pt!=="CODE"&&(rt[pt]=rt[pt].concat(ct[pt]))})}),rt},qw={GLOBAL:{ASIA:[Wo.CHINA,Wo.JAPAN,Wo.INDIA,Wo.KOREA,Wo.HKMC],EUROPE:[],NORTH_AMERICA:[Wo.US],SOUTH_AMERICA:[],OCEANIA:[],AFRICA:[]}},Jw=Object.keys(qw[Wo.GLOBAL]),bM=[Wo.CHINA,Wo.NORTH_AMERICA,Wo.EUROPE,Wo.ASIA,Wo.JAPAN,Wo.INDIA,Wo.OCEANIA,Wo.SOUTH_AMERICA,Wo.AFRICA,Wo.KOREA,Wo.HKMC,Wo.US],VX=function(_e,rt){let it=[];if(Er(_e).call(_e,Wo.GLOBAL)){const pt=[Wo.GLOBAL,Wo.OVERSEA],mt=Object.keys(Vw);if(rt===Wo.GLOBAL)throw new $n(tn.INVALID_PARAMS,"GLOBAL is an invalid excludedArea value");if(rt===Wo.CHINA)it=[Wo.OVERSEA];else if(ut=rt,Er(Jw).call(Jw,ut)){const _t=(ct=rt,qw[Wo.GLOBAL][ct]||[]),vt=[...pt,rt,..._t];it=mt.filter(Tt=>!Er(vt).call(vt,Tt))}else if(function(_t){let vt=!1;return Jw.forEach(Tt=>{var bt;Er(bt=qw[Wo.GLOBAL][Tt]).call(bt,_t)&&(vt=!0)}),vt}(rt)){const _t=function(Tt){let bt;return Jw.forEach(Ot=>{var Mt;Er(Mt=qw[Wo.GLOBAL][Ot]).call(Mt,Tt)&&(bt=Ot)}),bt}(rt),vt=[...pt,_t,rt];it=mt.filter(Tt=>!Er(vt).call(vt,Tt))}else it=_e;it=function(_t){const vt=[];return bM.forEach(Tt=>{Er(_t).call(_t,Tt)&&vt.push(Tt)}),vt.concat(_t.filter(Tt=>!Er(bM).call(bM,Tt)))}(it)}else it=_e;var ct,ut;return it};function i4(_e){var rt,it;if(!_e&&Er(rt=rn("AREAS")).call(rt,Wo.EXTENSIONS))return Ut.debug("update area from ap : reset"),void RM(YY,!0);if(!Er(it=rn("AREAS")).call(it,Wo.GLOBAL)||!_e)return;let ct=Vw.EXTENSIONS;ct&&(ct={CODE:r4(Wo.EXTENSIONS),WEBCS_DOMAIN:["ap-web-1-".concat(_e,".agora.io")],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-".concat(_e,".ap.sd-rtn.com")],PROXY_CS:["proxy-ap-web-".concat(_e,".agora.io")],CDS_AP:["cds-ap-web-1-".concat(_e,".agora.io"),"cds-ap-web-2-".concat(_e,".ap.sd-rtn.com")],ACCOUNT_REGISTER:["sua-ap-web-1-".concat(_e,".agora.io"),"sua-ap-web-2-".concat(_e,".ap.sd-rtn.com")],UAP_AP:["uap-ap-web-1-".concat(_e,".agora.io"),"uap-ap-web-2-".concat(_e,".ap.sd-rtn.com")],EVENT_REPORT_DOMAIN:["statscollector-1-".concat(_e,".agora.io")],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-".concat(_e,".agora.io")],LOG_UPLOAD_SERVER:["logservice-".concat(_e,".agora.io")],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy-".concat(_e,".agora.io")]},Ut.debug("update area from ap success: ".concat(_e,",config is "),ct),ns("AREAS",[Wo.EXTENSIONS],!0),Object.keys(ct).map(ut=>{ut==="LOG_UPLOAD_SERVER"||ut==="EVENT_REPORT_DOMAIN"||ut==="EVENT_REPORT_BACKUP_DOMAIN"||ut==="PROXY_SERVER_TYPE3"?ns(ut,ct[ut][0]):ns(ut,ct[ut])}))}function RM(_e){let rt=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const it=Vr.reportApiInvoke(null,{name:Ks.SET_AREA,options:_e,tag:Ns.TRACER});try{let ct=[];if(typeof _e=="string"&&(ct=[_e]),Array.isArray(_e)&&(_e.forEach(pt=>{if(!Er(bV).call(bV,pt))throw new $n(tn.INVALID_PARAMS,"invalid area code")}),ct=_e),Object.prototype.toString.call(_e)==="[object Object]"){const{areaCode:pt,excludedArea:mt}=_e;if(!pt)throw new $n(tn.INVALID_PARAMS,"area code is needed");let _t=pt;typeof pt=="string"&&(_t=[pt]),ct=mt?VX(_t,mt):_t}if(!rt){if(r_.AREAS){const pt=new $n(tn.PROHIBITED_OPERATION,"setArea is prohibited because of config-distribute");return it.onError(pt),void Ut.warning("setArea is prohibited because of config-distribute")}if(Er(ct).call(ct,Wo.GLOBAL)&&rn("AREAS")===Wo.EXTENSIONS){const pt=new $n(tn.PROHIBITED_OPERATION,"setArea is prohibited because of ap extensions");return it.onError(pt),void Ut.warning("setArea is prohibited because of ap extensions")}}ns("AREAS",ct,rt);const ut=FX(ct);Object.keys(ut).map(pt=>{pt==="LOG_UPLOAD_SERVER"||pt==="EVENT_REPORT_DOMAIN"||pt==="EVENT_REPORT_BACKUP_DOMAIN"||pt==="PROXY_SERVER_TYPE3"?ns(pt,ut[pt][0]):ns(pt,ut[pt])}),Ut.debug("set area success:",ct.join(","))}catch(ct){throw it.onError(ct),ct}it.onSuccess()}function o4(_e,rt){var it=Object.keys(_e);if(Object.getOwnPropertySymbols){var ct=Object.getOwnPropertySymbols(_e);rt&&(ct=ct.filter(function(ut){return Object.getOwnPropertyDescriptor(_e,ut).enumerable})),it.push.apply(it,ct)}return it}function B_(_e){for(var rt=1;rt<arguments.length;rt++){var it=arguments[rt]!=null?arguments[rt]:{};rt%2?o4(Object(it),!0).forEach(function(ct){Jt(_e,ct,it[ct])}):Object.getOwnPropertyDescriptors?Object.defineProperties(_e,Object.getOwnPropertyDescriptors(it)):o4(Object(it)).forEach(function(ct){Object.defineProperty(_e,ct,Object.getOwnPropertyDescriptor(it,ct))})}return _e}let wM=1;function GX(_e,rt,it,ct,ut){wM+=1;const pt={sid:it.sid,command:"convergeAllocateEdge",uid:"666",appId:it.appId,ts:Math.floor(Date.now()/1e3),seq:wM,requestId:wM,version:Zp,cname:it.cname},mt={service_name:rt,json_body:JSON.stringify(pt)};let _t,vt,Tt=_e[0];return n_(async()=>{_t=Date.now();const bt=await a_(Tt,{data:mt,cancelToken:ct,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"}});if(vt=Date.now()-_t,bt.code!==0){const Dt=new $n(tn.UNEXPECTED_RESPONSE,"live streaming ap error, code"+bt.code,{retry:!0,responseTime:vt});throw Ut.error(Dt.toString()),Dt}const Ot=JSON.parse(bt.json_body);if(Ot.code!==200){const Dt=new $n(tn.UNEXPECTED_RESPONSE,"live streaming app center error, code: ".concat(Ot.code,", reason: ").concat(Ot.reason),{code:Ot.code,responseTime:vt});throw Ut.error(Dt.toString()),Dt}if(!Ot.servers||Ot.servers.length===0){const Dt=new $n(tn.UNEXPECTED_RESPONSE,"live streaming app center empty server",{code:Ot.code,responseTime:vt});throw Ut.error(Dt.toString()),Dt}const Mt=function(Dt,jt){return{addressList:Dt.servers.map($t=>"wss://".concat($t.address.replace(/\./g,"-"),".").concat(rn("WORKER_DOMAIN"),":").concat($t.wss,"?serviceName=").concat(encodeURIComponent(jt))),workerToken:Dt.workerToken,vid:Dt.vid}}(Ot,rt);return rn("LIVE_STREAMING_ADDRESS")&&(Mt.addressList=rn("LIVE_STREAMING_ADDRESS")instanceof Array?rn("LIVE_STREAMING_ADDRESS"):[rn("LIVE_STREAMING_ADDRESS")]),B_(B_({},Mt),{},{responseTime:vt})},(bt,Ot)=>(Vr.apworkerEvent(it.sid,{success:!0,sc:200,serviceName:rt,responseDetail:JSON.stringify(bt.addressList),firstSuccess:Ot===0,responseTime:vt,serverIp:_e[Ot%_e.length]}),!1),(bt,Ot)=>(Vr.apworkerEvent(it.sid,{success:!1,sc:bt.data&&bt.data.code||200,serviceName:rt,responseTime:vt,serverIp:_e[Ot%_e.length]}),!!(bt.code!==tn.OPERATION_ABORTED&&bt.code!==tn.UNEXPECTED_RESPONSE||bt.data&&bt.data.retry)&&(Tt=_e[(Ot+1)%_e.length],!0)),ut)}let IM=1;function s4(_e,rt,it,ct){let{url:ut,areaCode:pt}=_e;const{clientId:mt,sid:_t}=rt,vt=Date.now();let Tt;const bt=rt.role,[Ot,Mt]=OM(rt,pt,[na.CHOOSE_SERVER]);let Dt=Qs.networkState;return n_(async()=>{Dt&&Qs.networkState===Cp.OFFLINE&&Qs.onlineWaiter&&await Ir.race([Qs.onlineWaiter,zl(ct&&ct.maxRetryTimeout||xa.maxRetryTimeout)]),Dt=Qs.networkState;const{data:jt,headers:$t}=await a_(ut,{data:Ot,cancelToken:it,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);Tt=$t.http3==="1"?1:-1,Vr.reportResourceTiming(ut,_t),c4(jt,ut,rt,vt,[na.CHOOSE_SERVER],Tt);const Ht=wA(jt,na.CHOOSE_SERVER);return xM(Ht),vM(Ht,ut)},jt=>(jt&&Vr.joinChooseServer(_t,{role:bt,lts:vt,succ:!0,csAddr:ut,opid:Mt,serverList:jt.gatewayAddrs.map($t=>$t.address),ec:null,cid:jt.cid.toString(),uid:jt.uid.toString(),csIp:jt.csIp,unilbsServerIds:[na.CHOOSE_SERVER].toString(),isHttp3:Tt,corssRegionTagReq:rt.apRequestDetail,corssRegionTagRes:jt.res.detail&&jt.res.detail[38]}),!1),jt=>jt.code!==tn.OPERATION_ABORTED&&(jt.code===tn.CAN_NOT_GET_GATEWAY_SERVER?jt.data.retry:(Vr.joinChooseServer(_t,{role:bt,lts:vt,succ:!1,csAddr:ut,serverList:null,opid:Mt,ec:jt.code,csIp:jt.data&&jt.data.csIp,unilbsServerIds:[na.CHOOSE_SERVER].toString(),extend:JSON.stringify({networkState:Dt}),isHttp3:Tt,corssRegionTagReq:rt.apRequestDetail}),Ut.warning("[".concat(mt||"sid-".concat(_t.slice(0,6)),"] Choose server network error, retry"),jt),!0)),ct)}function a4(_e,rt,it,ct){let ut,{url:pt,areaCode:mt,serviceIds:_t}=_e;const vt=Date.now(),Tt=rt.role,[bt,Ot]=OM(rt,mt,_t);let Mt;return n_(async()=>{Mt&&Qs.networkState===Cp.OFFLINE&&Qs.onlineWaiter&&await Ir.race([Qs.onlineWaiter,zl(ct&&ct.maxRetryTimeout||xa.maxRetryTimeout)]),Mt=Qs.networkState;const{data:Dt,headers:jt}=await a_(pt,{data:bt,cancelToken:it,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);ut=jt.http3==="1"?1:-1,Vr.reportResourceTiming(pt,rt.sid),c4(Dt,pt,rt,vt,_t,ut);const $t=wA(Dt,na.CHOOSE_SERVER),Ht=wA(Dt,rt.cloudProxyServer==="proxy5"?na.CLOUD_PROXY_5:rt.cloudProxyServer==="proxy3"||rt.cloudProxyServer==="proxy4"?na.CLOUD_PROXY:na.CLOUD_PROXY_FALLBACK),en=performance.getEntriesByName(pt),Qt=en[en.length-1];let on;return Qt&&(on={name:Qt.name,protocol:"nextHopProtocol"in Qt?Qt.nextHopProtocol:"",dnscost:"domainLookupEnd"in Qt&&"domainLookupStart"in Qt&&typeof Qt.domainLookupEnd=="number"&&typeof Qt.domainLookupStart=="number"?Qt.domainLookupEnd-Qt.domainLookupStart:-1,tcpTlsCost:"connectEnd"in Qt&&"connectStart"in Qt&&typeof Qt.connectEnd=="number"&&typeof Qt.connectStart=="number"?Qt.connectEnd-Qt.connectStart:-1,reqCost:"requestStart"in Qt&&typeof Qt.requestStart=="number"&&"responseEnd"in Qt&&typeof Qt.responseEnd=="number"?Qt.responseEnd-Qt.requestStart:-1,handleCost:"leave_ts"in Dt&&"enter_ts"in Dt&&typeof Dt.leave_ts=="number"&&typeof Dt.enter_ts=="number"?Dt.leave_ts-Dt.enter_ts:-1}),xM($t),{gatewayInfo:vM($t,pt),proxyInfo:Ht,url:pt,resourceTimingInfo:on}},Dt=>(Dt.gatewayInfo&&Vr.joinChooseServer(rt.sid,{role:Tt,lts:vt,succ:!0,csAddr:pt,serverList:Dt.gatewayInfo.gatewayAddrs.map(jt=>jt.address),ec:null,opid:Ot,cid:Dt.gatewayInfo.cid.toString(),uid:Dt.gatewayInfo.uid.toString(),csIp:Dt.gatewayInfo.csIp,unilbsServerIds:_t.toString(),isHttp3:ut,corssRegionTagReq:rt.apRequestDetail,corssRegionTagRes:Dt.gatewayInfo.res.detail&&Dt.gatewayInfo.res.detail[38],resourceTimingInfo:Dt.resourceTimingInfo?JSON.stringify(Dt.resourceTimingInfo):void 0}),Dt.proxyInfo&&Vr.joinWebProxyAP(rt.sid,{lts:vt,sucess:1,apServerAddr:pt,turnServerAddrList:Dt.proxyInfo.addresses.map(jt=>jt.ip).join(","),errorCode:null,eventType:rt.cloudProxyServer,unilbsServerIds:_t.toString()}),!1),Dt=>Dt.code!==tn.OPERATION_ABORTED&&(Dt.code===tn.CAN_NOT_GET_GATEWAY_SERVER?Dt.data.retry:(Vr.joinWebProxyAP(rt.sid,{lts:vt,sucess:0,apServerAddr:pt,turnServerAddrList:null,errorCode:Dt.code,eventType:rt.cloudProxyServer,unilbsServerIds:_t.toString(),extend:JSON.stringify({networkState:Mt})}),Ut.warning("[".concat(rt.clientId,"] multi unilbs network error, retry"),Dt),!0)),ct)}const c4=(_e,rt,it,ct,ut,pt)=>{const{sid:mt,clientId:_t,cloudProxyServer:vt}=it,Tt=[],bt=Ot=>{Ot.flag===4096?Vr.joinChooseServer(mt,{role:it.role,lts:ct,succ:!1,csAddr:rt,opid:_e.opid,serverList:null,ec:Ot.error.message,csIp:Ot.error.data&&Ot.error.data.csIp,unilbsServerIds:ut.toString(),isHttp3:pt,corssRegionTagReq:it.apRequestDetail}):Ot.flag!==1048576&&Ot.flag!==4194304&&Ot.flag!==4194310||Vr.joinWebProxyAP(mt,{lts:ct,sucess:0,apServerAddr:rt,turnServerAddrList:null,errorCode:Ot.error.code,eventType:vt,unilbsServerIds:ut.toString()})};if(_e.response_body.forEach(Ot=>{const Mt=Ot.buffer.code;if(Ot.uri===23&&Mt===0&&!Ot.buffer.edges_services)if(Ot.buffer.flag===4194310)Ut.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers"),Ot.buffer.edges_services=[];else{const Dt={error:new $n(tn.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:_e.detail[502]}),flag:Ot.buffer.flag};Tt.push(Dt),bt(Dt)}if(Mt!==0){const Dt=DS(Mt),jt={error:new $n(tn.CAN_NOT_GET_GATEWAY_SERVER,Dt.desc,{desc:Dt.desc,retry:Dt.retry,csIp:_e.detail[502]}),flag:Ot.buffer.flag};Ot.buffer.flag===4194310?Ut.warning(jt.error.toString()):Tt.push(jt),bt(jt)}}),Tt.length)throw Ut.warning("[".concat(_t||"sid-".concat(mt.slice(0,6)),"] multi unilbs ").concat(rt," failed, ").concat(Tt.map(Ot=>"flag: ".concat(Ot.flag,", message: ").concat(Ot.error.message,", retry: ").concat(Ot.error.data.retry)).join(" | "))),new $n(tn.CAN_NOT_GET_GATEWAY_SERVER,Tt.map(Ot=>"flag: ".concat(Ot.flag,", message: ").concat(Ot.error.message)).join(" | "),{retry:!!Tt.find(Ot=>Ot.error.data.retry),csIp:_e.detail[502],desc:[...new Set(Tt.map(Ot=>{var Mt;return Ot==null||(Mt=Ot.error)===null||Mt===void 0||(Mt=Mt.data)===null||Mt===void 0?void 0:Mt.desc}).filter(Ot=>!!Ot))]})},xM=_e=>{var rt,it,ct,ut;if(_e.addresses&&_e.addresses.length===0&&_e.code===0)throw new $n(tn.CAN_NOT_GET_GATEWAY_SERVER,"void gateway address",{retry:!0,csIp:_e.detail&&_e.detail[502]});if(rn("AP_AREA")&&((ct=_e.detail)!==null&&ct!==void 0&&ct[23]&&typeof((ut=_e.detail)===null||ut===void 0?void 0:ut[23])=="string"?i4(_e.detail[23].toLowerCase()):i4()),(rt=_e.detail)!==null&&rt!==void 0&&rt[19]&&typeof((it=_e.detail)===null||it===void 0?void 0:it[19])=="string"){const mt=_e.detail[19],_t=mt==null?void 0:mt.split(";");for(let vt=0;vt<_t.length;vt++){var pt;const Tt=wu(pt=_t[vt]).call(pt);_e.addresses[vt]&&_t&&(_e.addresses[vt].fingerprint=Tt)}}if(rn("GATEWAY_ADDRESS")&&rn("GATEWAY_ADDRESS").length>0){Ut.debug("assign gateway address to",rn("GATEWAY_ADDRESS"));const mt=rn("GATEWAY_ADDRESS").map(_t=>{var vt,Tt;const bt=(vt=(Tt=_e.addresses.find(Ot=>Ot.ip===_t.ip&&Ot.port===_t.port))===null||Tt===void 0?void 0:Tt.fingerprint)!==null&&vt!==void 0?vt:"";return{ip:_t.ip,port:_t.port,ticket:_e.addresses[0]&&_e.addresses[0].ticket,fingerprint:bt}});_e.addresses=mt}},$X=(_e,rt)=>{if(_e.response_body&&_e.response_body.length){const it=_e.response_body[0];if(it.buffer.code!==0){const ct=DS(it.buffer.code);throw new $n(tn.UPDATE_TICKET_FAILED,"[".concat(it.buffer.code,"]: ").concat(ct.desc),{retry:ct.retry})}return it.buffer.ticket}throw Ut.debug("update ticket request received ap response without response body:",rt),new $n(tn.UPDATE_TICKET_FAILED,"cannot find response body from ap response",{retry:!1})},OM=(_e,rt,it)=>{const ct=Math.floor(Math.random()*1e12),ut=_e.role==="host"?"1":_e.role==="audience"?"2":void 0,pt={appid:_e.appId,client_ts:Date.now(),opid:ct,sid:_e.sid,request_bodies:[{uri:22,buffer:{cname:_e.cname,detail:B_(B_(B_({6:_e.stringUid,11:rt,12:rn("USE_NEW_TOKEN")?"1":void 0},ut?{17:ut}:{}),{},{22:rt},_e.apRequestDetail?{33:_e.apRequestDetail}:{}),_e.apRTM?{26:"RTM2"}:{}),key:_e.token,service_ids:it,uid:_e.uid||0}}]};pt.request_bodies.forEach(_t=>{_e.multiIP&&_e.multiIP.gateway_ip&&(_t.buffer.detail[5]=JSON.stringify({vocs_ip:[_e.multiIP.uni_lbs_ip],vos_ip:[_e.multiIP.gateway_ip]}))});const mt=new FormData;return mt.append("request",JSON.stringify(pt)),[mt,ct]},HX=(_e,rt)=>{const it=Math.floor(Math.random()*1e12),ct={appid:_e.appId,client_ts:Date.now(),opid:it,sid:_e.sid,request_bodies:[{uri:28,buffer:{cname:_e.cname,detail:{1:"",6:_e.stringUid,12:"1"},token:_e.token,service_ids:rt,uid:_e.uid||0,edges_services:_e.apResponse.addresses.map(pt=>({ip:pt.ip,port:pt.port}))}}]},ut=new FormData;return ut.append("request",JSON.stringify(ct)),[ut,it]};let BS=0;function FS(_e){return Ir.all(_e.map(rt=>rt.then(it=>{throw it},it=>it))).then(rt=>{throw rt},rt=>rt)}const PA=async _e=>{let{fragementLength:rt,referenceList:it,asyncMapHandler:ct,allFailedhandler:ut,promisesCollector:pt}=_e,mt=0;const _t=rt;let vt,Tt=0;const bt=async()=>{const Ot=(()=>{const Mt=mt*_t,Dt=Mt+_t;return it.slice(Mt,Dt).map(ct)})();pt&&pt.push(...Ot);try{vt=await FS(Ot)}catch(Mt){if(Tt+=_t,mt++,!(Tt>=it.length))return void await bt();ut(Mt)}Ot.forEach(Mt=>Mt.cancel())};return await bt(),vt},l4=async _e=>{let{referenceList:rt,asyncMapHandler:it,closeFn:ct}=_e;const ut=rt.length;let pt=0;const mt=async()=>{const _t=it(rt.shift());try{return await _t}catch(vt){if(pt++,pt>=ut||ct!=null&&ct(vt))throw vt;return mt()}};return mt()};async function jX(){if(typeof VideoDecoder>"u")return!0;let _e;const rt=[18,0,10,13,0,0,0,3,180,253,144,6,136,8,8,8,32,50,85,16,66,128,2,8,32,132,0,8,0,180,90,204,169,166,242,109,241,190,143,149,160,133,4,144,43,122,168,159,120,159,205,39,82,131,57,52,87,187,68,23,248,134,204,226,97,17,49,183,55,236,219,249,221,98,208,215,190,59,179,167,213,47,1,246,150,14,194,245,159,83,35,64,103,218,38,21,82,3,135,21,185,84,248,134],it=[18,0,10,13,0,0,0,3,180,253,144,6,136,8,8,8,32,50,87,16,66,128,2,8,32,132,0,8,0,180,90,204,169,166,242,109,241,190,143,148,62,134,140,92,172,141,77,35,94,181,164,65,169,65,156,154,43,221,162,11,252,67,102,113,48,136,137,219,62,43,113,239,23,126,250,186,252,10,138,218,25,193,244,74,68,194,209,107,23,52,206,199,78,72,98,103,151,71,96,62,51,210,158,72,231,158],ct=[18,0,10,13,0,0,0,3,180,253,144,6,136,8,8,8,32,50,87,16,66,128,2,8,32,132,0,8,0,180,90,204,169,166,242,109,241,190,143,143,233,163,51,196,98,95,151,224,22,134,33,240,150,248,67,18,34,196,142,81,238,173,140,80,205,232,132,144,67,12,131,157,4,171,243,86,122,35,6,166,184,243,85,126,13,206,103,152,62,168,160,187,2,241,138,52,211,72,121,128,151,63,147,128,19,42],ut=[18,0,50,138,1,48,192,64,253,248,65,17,67,192,32,0,16,0,0,0,0,0,0,0,195,12,48,144,64,32,0,209,75,61,9,204,25,115,79,226,115,63,63,208,70,210,220,153,126,241,237,37,107,195,153,1,99,112,230,189,209,169,130,10,11,22,167,215,159,205,197,7,183,162,26,48,254,141,134,103,32,16,235,45,1,15,18,119,169,110,206,251,51,115,202,60,148,1,46,39,109,25,28,86,168,15,77,211,239,2,58,43,146,26,230,184,81,48,140,226,226,250,222,146,171,133,164,13,188,180,64,122,142,146,32,208,238,170,193,35,53,44,225],pt=[18,0,50,107,48,0,133,125,248,65,26,195,64,62,32,31,16,0,0,0,0,0,1,4,16,64,144,64,32,0,204,24,122,65,56,165,18,52,206,218,4,187,51,97,9,29,191,90,253,106,185,31,197,155,52,205,245,185,203,131,20,226,25,124,95,113,220,113,141,15,15,104,211,144,152,237,150,157,127,51,143,24,231,218,171,255,176,241,128,229,149,150,148,66,245,228,91,27,182,228,136,61,182,237,133,45,220,24,103,214,152],mt=[18,0,50,122,48,1,9,253,248,65,26,67,64,62,32,31,16,0,0,0,0,0,1,4,16,64,144,64,32,0,198,182,231,242,220,235,163,140,12,36,36,166,46,132,210,4,71,23,218,132,27,30,17,45,244,79,31,243,195,136,100,169,76,88,142,85,204,217,121,168,29,163,198,17,251,223,73,12,212,244,139,123,151,179,75,216,96,208,136,40,229,42,59,149,10,116,228,85,99,93,221,108,255,140,248,20,30,167,122,109,206,164,108,197,110,251,23,243,133,160,63,13,207,177,12,128];return await new Ir((vt,Tt)=>{let bt;(async function(){_e&&_e.state!=="closed"||await async function(){_e=new VideoDecoder({output:Mt=>{Mt.close(),clearTimeout(bt),vt(!0)},error:Mt=>{clearTimeout(bt),vt(!1)}}),await _e.configure({codec:"av01.0.05M.08",width:160,height:90})}();const Ot=[rt,it,ct,ut,pt,mt];for(let Mt=0;Mt<Ot.length;Mt++){const Dt=new EncodedVideoChunk({type:Mt==0?"key":"delta",timestamp:33333*Mt,duration:33333,data:new Uint8Array(Ot[Mt])});try{await _e.decode(Dt)}catch{return void vt(!1)}}})(),bt=setTimeout(()=>{vt(!1)},5e3)})}async function MM(_e,rt,it,ct){return{gatewayInfo:await async function(pt,mt,_t,vt){let Tt=null;const bt=[],Ot=async()=>{const Dt=rn("WEBCS_DOMAIN").slice(0,rn("AJAX_REQUEST_CONCURRENT")).map(Ht=>({url:pt.proxyServer?"https://".concat(pt.proxyServer,"/ap/?url=").concat(Ht+"/api/v2/transpond/webrtc?v=2"):"https://".concat(Ht,"/api/v2/transpond/webrtc?v=2"),areaCode:MA()})),jt=vt.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:Dt.map(Ht=>Ht.url)}),$t=await PA({fragementLength:rn("FRAGEMENT_LENGTH"),referenceList:Dt,asyncMapHandler:Ht=>(Ut.debug("[".concat(pt.clientId,"] Connect to choose_server:"),Ht.url),s4(Ht,pt,mt,_t)),allFailedhandler:Ht=>{throw vt.recordJoinChannelService({endTs:Date.now(),status:"error",errors:Ht},jt),Ht[0]},promisesCollector:bt});return vt.recordJoinChannelService({endTs:Date.now(),status:"success"},jt),$t},Mt=async()=>{if(await zl(1e3),Tt!==null)return Tt;const Dt=rn("WEBCS_DOMAIN_BACKUP_LIST").map(Ht=>({url:pt.proxyServer?"https://".concat(pt.proxyServer,"/ap/?url=").concat(Ht+"/api/v2/transpond/webrtc?v=2"):"https://".concat(Ht,"/api/v2/transpond/webrtc?v=2"),areaCode:MA()})),jt=vt.recordJoinChannelService({endTs:void 0,startTs:Date.now(),status:"pending",service:"chooseServer",urls:Dt.map(Ht=>Ht.url)}),$t=await PA({fragementLength:rn("FRAGEMENT_LENGTH"),referenceList:Dt,asyncMapHandler:Ht=>(Ut.debug("[".concat(pt.clientId,"] Connect to backup choose_server:"),Ht.url),s4(Ht,pt,mt,_t)),allFailedhandler:Ht=>{throw vt.recordJoinChannelService({endTs:Date.now(),status:"error",errors:Ht},jt),Ht[0]},promisesCollector:bt});return vt.recordJoinChannelService({endTs:Date.now(),status:"success"},jt),$t};try{return Tt=await FS([Ot(),Mt()]),bt.length&&bt.forEach(Dt=>Dt.cancel&&typeof Dt.cancel=="function"&&Dt.cancel()),Tt}catch(Dt){throw Dt[0]}}(_e,rt,it,ct)}}async function u4(_e,rt,it,ct,ut){const pt=_e.cloudProxyServer;if(pt==="disabled"){if(!ct)return;if(_e.useLocalAccessPoint)return await MM(_e,rt,it,ut);if(rn("JOIN_WITH_FALLBACK_MEDIA_PROXY")){const{gatewayInfo:Mt,proxyInfo:Dt}=await p4(_e,rt,it,ut);if(_e.turnServer&&_e.turnServer.mode!=="auto")return{gatewayInfo:Mt};const jt=Dt.map($t=>({turnServerURL:$t.address,tcpport:$t.tcpport||iu.tcpport,udpport:$t.udpport||iu.udpport,username:$t.username||iu.username,password:$t.password||iu.password,forceturn:!1,security:!0}));if(ut.useP2P){var mt;const $t=(mt=_e.uid)!==null&&mt!==void 0?mt:Mt.uid,Ht="glb:".concat($t.toString()),en=await yO(Ht),Qt=Dt.map(on=>({turnServerURL:on.address,tcpport:on.tcpport||iu.tcpport,udpport:on.udpport||iu.udpport,username:Ht,password:en,forceturn:!1,security:!0}));jt.push(...Qt)}return _e.turnServer={mode:"manual",servers:jt},{gatewayInfo:Mt}}return await MM(_e,rt,it,ut)}const{proxyInfo:_t,gatewayInfo:vt}=await p4(_e,rt,it,ut),Tt={gatewayInfo:vt},bt=_t.map(Mt=>({turnServerURL:Mt.address,tcpport:pt==="proxy3"?void 0:Mt.tcpport?Mt.tcpport:iu.tcpport,udpport:pt==="proxy4"?void 0:Mt.udpport?Mt.udpport:iu.udpport,username:Mt.username||iu.username,password:Mt.password||iu.password,forceturn:pt!=="proxy4",security:pt==="proxy5"}));if(ut.useP2P){var Ot;const Mt=(Ot=_e.uid)!==null&&Ot!==void 0?Ot:vt.uid,Dt="glb:".concat(Mt.toString()),jt=await yO(Dt),$t=_t.map(Ht=>({turnServerURL:Ht.address,tcpport:pt==="proxy3"?void 0:Ht.tcpport||iu.tcpport,udpport:pt==="proxy4"?void 0:Ht.udpport||iu.udpport,username:Dt,password:jt,forceturn:pt!=="proxy4",security:pt==="proxy5"}));bt.push(...$t)}return _e.turnServer={mode:"manual",servers:bt},Ut.debug("[".concat(_e.clientId,"] set proxy server: ").concat(_e.proxyServer,", mode: ").concat(pt)),Tt}async function d4(_e,rt,it,ct,ut){const pt=rn("ACCOUNT_REGISTER").slice(0,rn("AJAX_REQUEST_CONCURRENT"));let mt=[];mt=rt.proxyServer?pt.map(vt=>"https://".concat(rt.proxyServer,"/ap/?url=").concat(vt+"/api/v1")):pt.map(vt=>"https://".concat(vt,"/api/v1"));const _t=ut==null?void 0:ut.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"stringUID",urls:mt});try{const vt=await async function(Tt,bt,Ot,Mt,Dt){const jt=Date.now(),$t={sid:Ot.sid,opid:10,appid:Ot.appId,string_uid:bt};let Ht=Tt[0];const en=await n_(()=>a_(Ht+"".concat(Ht.indexOf("?")===-1?"?":"&","action=stringuid"),{data:$t,cancelToken:Mt,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}}),(Qt,on)=>{if(Qt.code===0){if(Qt.uid<=0||Qt.uid>=Math.pow(2,32))throw Ut.error("Invalid Uint Uid ".concat(bt," => ").concat(Qt.uid),Qt),Vr.reqUserAccount($t.sid,{lts:jt,success:!1,serverAddr:Ht,stringUid:$t.string_uid,uid:Qt.uid,errorCode:tn.INVALID_UINT_UID_FROM_STRING_UID,extend:$t}),new $n(tn.INVALID_UINT_UID_FROM_STRING_UID);return Vr.reqUserAccount($t.sid,{lts:jt,success:!0,serverAddr:Ht,stringUid:$t.string_uid,uid:Qt.uid,errorCode:null,extend:$t}),!1}const Tn=DS(Qt.code);return Tn.retry&&(Ht=Tt[(on+1)%Tt.length]),Vr.reqUserAccount($t.sid,{lts:jt,success:!1,serverAddr:Ht,stringUid:$t.string_uid,uid:Qt.uid,errorCode:Tn.desc,extend:$t}),Tn.retry},(Qt,on)=>Qt.code!==tn.OPERATION_ABORTED&&(Vr.reqUserAccount($t.sid,{lts:jt,success:!1,serverAddr:Ht,stringUid:$t.string_uid,uid:null,errorCode:Qt.code,extend:$t}),Ht=Tt[(on+1)%Tt.length],!0),Dt);if(en.code!==0){const Qt=DS(en.code);throw new $n(tn.UNEXPECTED_RESPONSE,Qt.desc)}return en}(mt,_e,rt,it,ct);return ut==null||ut.recordJoinChannelService({status:"success",endTs:Date.now()},_t),vt.uid}catch(vt){throw ut==null||ut.recordJoinChannelService({status:"error",endTs:Date.now(),errors:[vt]},_t),vt}}async function zX(_e,rt,it){const ct=rn("ACCOUNT_REGISTER");let ut=[];ut=rt.proxyServer?ct.map(pt=>"https://".concat(rt.proxyServer,"/ap/?url=").concat(pt+"/api/v1")):ct.map(pt=>"https://".concat(pt,"/api/v1"));try{return await l4({referenceList:ut,asyncMapHandler:mt=>async function(_t,vt,Tt,bt){const Ot=Date.now(),Mt={sid:Tt.sid,opid:10,appid:Tt.appId,string_uid:vt};try{const Dt=await a_(_t+"".concat(_t.indexOf("?")===-1?"?":"&","action=stringuid"),{data:Mt,cancelToken:bt,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}});if(Dt.code!==0){const jt=DS(Dt.code);throw new $n(tn.UNEXPECTED_RESPONSE,"preload sua error:".concat(jt.desc),jt)}if(Dt.uid<=0||Dt.uid>=Math.pow(2,32))throw new $n(tn.INVALID_UINT_UID_FROM_STRING_UID);return{requestTime:Ot,url:_t,req:Mt,uid:Dt.uid,elapse:Date.now()-Ot}}catch(Dt){throw Dt}}(mt,_e,rt,it),closeFn:mt=>mt.code===tn.OPERATION_ABORTED||mt.code===tn.UNEXPECTED_RESPONSE&&!mt.data.retry})}catch(pt){throw pt}}async function WX(_e,rt,it){const ct=rn("CDS_AP").slice(0,rn("AJAX_REQUEST_CONCURRENT")).map(vt=>_e.proxyServer?"https://".concat(_e.proxyServer,"/ap/?url=").concat(vt+"/api/v1"):"https://".concat(vt,"/api/v1?action=config")),ut=ct.map(vt=>function(Tt,bt,Ot,Mt){const Dt=No(),jt={flag:64,cipher_method:0,features:B_(B_(B_(B_(B_({install_id:MO(),device:Dt.name,system:Dt.os,system_general:navigator.userAgent,vendor:bt.appId,version:Zp,cname:bt.cname,session_id:bt.sid,proxyServer:bt.proxyServer,sdk_type:kX.WEB_RTC,browser_name:Dt.name,browser_version:Dt.version,user_agent:navigator.userAgent,channel_name:bt.cname},bt.stringUid&&{string_uid:bt.stringUid}),bt.uid&&{uid:bt.uid+""}),Dt.os&&{os_name:Dt.os}),Dt.osVersion&&{os_version:Dt.osVersion}),{},{detail:""})};return n_(()=>a_(Tt,{data:jt,timeout:1e3,cancelToken:Ot,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":54}}),void 0,$t=>$t.code!==tn.OPERATION_ABORTED,Mt)}(vt,_e,rt,it));let pt=null,mt=null,_t={};try{pt=await FS(ut)}catch(vt){if(vt.code===tn.OPERATION_ABORTED)throw vt;mt=vt}if(ut.forEach(vt=>vt.cancel()),Vr.reportApiInvoke(_e.sid,{name:Ks.REQUEST_CONFIG_DISTRIBUTE,options:{error:mt,res:pt}}).onSuccess(),pt&&pt.test_tags)try{_t=function(vt){if(!vt.test_tags)return{};const Tt=vt.test_tags,bt=Object.keys(Tt),Ot={};return bt.forEach(Mt=>{var Dt;const jt=wu(Dt=Mt.slice(4)).call(Dt),$t=JSON.parse(Tt[Mt]),Ht=$t[1];Ot[jt]={tag:$t[0]||"",value:Ht}}),Ot}(pt)}catch{}return _t}async function h4(_e,rt){const it=rn("WEBCS_DOMAIN").concat(rn("WEBCS_DOMAIN_BACKUP_LIST")).map(ct=>({url:"https://".concat(ct,"/api/v2/transpond/webrtc?v=2"),areaCode:MA(),serviceIds:[na.CHOOSE_SERVER,na.CLOUD_PROXY_FALLBACK]}));try{return await l4({referenceList:it,asyncMapHandler:ut=>async function(pt,mt,_t){let vt,{url:Tt,areaCode:bt,serviceIds:Ot}=pt;const Mt=Date.now(),[Dt,jt]=OM(mt,bt,Ot);let $t=Qs.networkState;try{$t&&Qs.networkState===Cp.OFFLINE&&Qs.onlineWaiter&&await Ir.race([Qs.onlineWaiter,zl(xa.maxRetryTimeout)]),$t=Qs.networkState;const{data:Ht,headers:en}=await a_(Tt,{data:Dt,cancelToken:_t,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);vt=en.http3==="1"?1:-1,(vn=>{const hn=[];if(vn.response_body.forEach(Ln=>{const Xn=Ln.buffer.code;if(Ln.uri===23&&Xn===0&&!Ln.buffer.edges_services)if(Ln.buffer.flag===4194310)Ln.buffer.edges_services=[];else{const Qn={error:new $n(tn.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:vn.detail[502]}),flag:Ln.buffer.flag};hn.push(Qn)}if(Xn!==0){const Qn=DS(Xn),ur={error:new $n(tn.CAN_NOT_GET_GATEWAY_SERVER,Qn.desc,{desc:Qn.desc,retry:Qn.retry,csIp:vn.detail[502]}),flag:Ln.buffer.flag};Ln.buffer.flag===4194310?Ut.warning(ur.error.toString()):hn.push(ur)}}),hn.length)throw new $n(tn.CAN_NOT_GET_GATEWAY_SERVER,hn.map(Ln=>"flag: ".concat(Ln.flag,", message: ").concat(Ln.error.message)).join(" | "),{retry:!!hn.find(Ln=>Ln.error.data.retry),csIp:vn.detail[502],desc:[...new Set(hn.map(Ln=>{var Xn;return Ln==null||(Xn=Ln.error)===null||Xn===void 0||(Xn=Xn.data)===null||Xn===void 0?void 0:Xn.desc}).filter(Ln=>!!Ln))]})})(Ht);const on=wA(Ht,na.CHOOSE_SERVER),Tn=wA(Ht,na.CLOUD_PROXY_FALLBACK);return xM(on),{gatewayInfo:vM(on,Tt),proxyInfo:Tn,opid:jt,requestTime:Mt,url:Tt,isHttp3:vt,elapse:Date.now()-Mt}}catch(Ht){throw Ht}}(ut,_e,rt),closeFn:ut=>ut.code===tn.OPERATION_ABORTED||ut.code===tn.CAN_NOT_GET_GATEWAY_SERVER&&!ut.data.retry})}catch(ct){throw ct}}async function p4(_e,rt,it,ct){const ut=rn("PROXY_SERVER_TYPE3"),pt=(Dt,jt,$t)=>{let Ht=$t||ut;return Array.isArray(Ht)&&(Ht=jt%2==0&&ut[1]||ut[0]),"https://".concat(Ht,"/ap/?url=").concat(Dt)};let mt=null;const _t=[],vt=async()=>{const Dt=rn("WEBCS_DOMAIN").slice(0,rn("AJAX_REQUEST_CONCURRENT")).map((Ht,en)=>{let Qt;return Qt=_e.cloudProxyServer==="disabled"&&_e.proxyServer?pt("".concat(Ht,"/api/v2/transpond/webrtc?v=2"),en,_e.proxyServer):_e.cloudProxyServer==="disabled"||_e.cloudProxyServer==="fallback"?"https://".concat(Ht,"/api/v2/transpond/webrtc?v=2"):pt("".concat(Ht,"/api/v2/transpond/webrtc?v=2"),en),{url:Qt,areaCode:MA(),serviceIds:[na.CHOOSE_SERVER,_e.cloudProxyServer==="proxy5"?na.CLOUD_PROXY_5:_e.cloudProxyServer==="proxy3"||_e.cloudProxyServer==="proxy4"?na.CLOUD_PROXY:na.CLOUD_PROXY_FALLBACK]}}),jt=ct.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:Dt.map(Ht=>Ht.url)}),$t=await PA({fragementLength:rn("FRAGEMENT_LENGTH"),referenceList:Dt,asyncMapHandler:Ht=>(Ut.debug("[".concat(_e.clientId,"] Connect to choose_server:"),Ht.url),a4(Ht,_e,rt,it)),allFailedhandler:Ht=>{throw ct.recordJoinChannelService({endTs:Date.now(),status:"error",errors:Ht},jt),Ht[0]},promisesCollector:_t});return ct.recordJoinChannelService({endTs:Date.now(),status:"success"},jt),$t},Tt=async()=>{if(await zl(1e3),mt!==null)return mt;const Dt=rn("WEBCS_DOMAIN_BACKUP_LIST").map((Ht,en)=>{let Qt;return Qt=_e.cloudProxyServer==="disabled"&&_e.proxyServer?pt("".concat(Ht,"/api/v2/transpond/webrtc?v=2"),en,_e.proxyServer):_e.cloudProxyServer==="disabled"||_e.cloudProxyServer==="fallback"?"https://".concat(Ht,"/api/v2/transpond/webrtc?v=2"):pt("".concat(Ht,"/api/v2/transpond/webrtc?v=2"),en),{url:Qt,areaCode:MA(),serviceIds:[na.CHOOSE_SERVER,_e.cloudProxyServer==="proxy5"?na.CLOUD_PROXY_5:_e.cloudProxyServer==="proxy3"||_e.cloudProxyServer==="proxy4"?na.CLOUD_PROXY:na.CLOUD_PROXY_FALLBACK]}}),jt=ct.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:Dt.map(Ht=>Ht.url)}),$t=await PA({fragementLength:rn("FRAGEMENT_LENGTH"),referenceList:Dt,asyncMapHandler:Ht=>(Ut.debug("[".concat(_e.clientId,"] Connect to backup choose_server:"),Ht.url),a4(Ht,_e,rt,it)),allFailedhandler:Ht=>{throw ct.recordJoinChannelService({endTs:Date.now(),status:"error",errors:Ht},jt),Ht[0]},promisesCollector:_t});return ct.recordJoinChannelService({endTs:Date.now(),status:"success"},jt),$t};let bt,Ot,Mt;try{({gatewayInfo:bt,proxyInfo:Ot,url:Mt}=await FS([vt(),Tt()]))}catch(Dt){throw Dt[0]}if(_t.length&&_t.forEach(Dt=>Dt.cancel&&typeof Dt.cancel=="function"&&Dt.cancel()),!bt||!Ot)throw new $n(tn.UNEXPECTED_ERROR,"missing gateway or proxy response").print();if(_e.apUrl=Mt,_e.cloudProxyServer!=="disabled"&&Array.isArray(ut)&&Mt){const Dt=/^https?:\/\/(.+?)(\/.*)?$/.exec(Mt)[1];Er(ut).call(ut,Dt)&&(_e.proxyServer=Dt,Ut.setProxyServer(Dt),Vr.setProxyServer(Dt))}return mt={gatewayInfo:bt,proxyInfo:await UV(Ot,bt.uid)},mt}async function KX(_e,rt,it){const ct=rn("UAP_AP").slice(0,rn("AJAX_REQUEST_CONCURRENT")).map(pt=>_e.proxyServer?"https://".concat(_e.proxyServer,"/ap/?url=").concat(pt+"/api/v1?action=uap"):"https://".concat(pt,"/api/v1?action=uap")),ut=ct.map(pt=>function(mt,_t,vt,Tt){const bt={command:"convergeAllocateEdge",sid:_t.sid,appId:_t.appId,token:_t.token,ts:Date.now(),version:Zp,cname:_t.cname,uid:_t.uid.toString(),requestId:IM,seq:IM};IM+=1;const Ot={service_name:"tele_channel",json_body:JSON.stringify(bt)};return n_(async()=>{const Mt=await a_(mt,{data:Ot,cancelToken:vt,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":61}});if(Mt.code!==0){const jt=new $n(tn.UNEXPECTED_RESPONSE,"cross channel ap error, code"+Mt.code,{retry:!0});throw Ut.error(jt.toString()),jt}const Dt=JSON.parse(Mt.json_body);if(Dt.code!==200){const jt=new $n(tn.UNEXPECTED_RESPONSE,"cross channel app center error, code: ".concat(Dt.code,", reason: ").concat(Dt.reason));throw Ut.error(jt.toString()),jt}if(!Dt.servers||Dt.servers.length===0){const jt=new $n(tn.UNEXPECTED_RESPONSE,"cross channel app center empty server");throw Ut.error(jt.toString()),jt}return{vid:Dt.vid,workerToken:Dt.workerToken,addressList:(rn("CHANNEL_MEDIA_RELAY_SERVERS")||Dt.servers).map(jt=>"wss://".concat(jt.address.replace(/\./g,"-"),".").concat(rn("WORKER_DOMAIN"),":").concat(jt.wss))}},void 0,Mt=>!!(Mt.code!==tn.OPERATION_ABORTED&&Mt.code!==tn.UNEXPECTED_RESPONSE||Mt.data&&Mt.data.retry),Tt)}(pt,_e,rt,it));try{const pt=await FS(ut);return ut.forEach(mt=>mt.cancel()),pt}catch(pt){throw pt[0]}}async function YX(_e,rt,it){let ct=null;const ut=[],pt=async mt=>{const _t=rn(mt?"WEBCS_DOMAIN_BACKUP_LIST":"WEBCS_DOMAIN").map(vt=>_e.proxyServer?"https://".concat(_e.proxyServer,"/ap/?url=").concat(vt+"/api/v2/transpond/webrtc?v=2"):"https://".concat(vt,"/api/v2/transpond/webrtc?v=2"));return mt&&(await zl(1e3),ct!==null)?ct:await PA({fragementLength:rn("FRAGEMENT_LENGTH"),referenceList:_t,asyncMapHandler:vt=>(Ut.debug("[".concat(_e.clientId,"] update ticket, Connect to ").concat(mt?"backup":""," choose_server:"),vt),function(Tt,bt,Ot,Mt){const[Dt]=HX(bt,[na.CHOOSE_SERVER]);let jt=Qs.networkState;return n_(async()=>{jt&&Qs.networkState===Cp.OFFLINE&&Qs.onlineWaiter&&await Ir.race([Qs.onlineWaiter,zl(Mt&&Mt.maxRetryTimeout||xa.maxRetryTimeout)]),jt=Qs.networkState;const $t=await a_(Tt,{data:Dt,cancelToken:Ot,headers:{"Content-Type":"multipart/form-data;"}},!0);return $X($t,Tt)},()=>!1,$t=>$t.code!==tn.OPERATION_ABORTED&&($t.code===tn.UPDATE_TICKET_FAILED?$t.data.retry:(Ut.warning("[".concat(bt.clientId,"] update ticket network error, retry"),$t),!0)),Mt)}(vt,_e,rt,it)),allFailedhandler:vt=>{throw vt[0]},promisesCollector:ut})};try{return ct=await FS([pt(!1),pt(!0)]),ut.length&&ut.forEach(mt=>mt.cancel&&typeof mt.cancel=="function"&&mt.cancel()),ct}catch(mt){throw mt[0]}}function f4(_e,rt){var it=Object.keys(_e);if(Object.getOwnPropertySymbols){var ct=Object.getOwnPropertySymbols(_e);rt&&(ct=ct.filter(function(ut){return Object.getOwnPropertyDescriptor(_e,ut).enumerable})),it.push.apply(it,ct)}return it}function PM(_e){for(var rt=1;rt<arguments.length;rt++){var it=arguments[rt]!=null?arguments[rt]:{};rt%2?f4(Object(it),!0).forEach(function(ct){Jt(_e,ct,it[ct])}):Object.getOwnPropertyDescriptors?Object.defineProperties(_e,Object.getOwnPropertyDescriptors(it)):f4(Object(it)).forEach(function(ct){Object.defineProperty(_e,ct,Object.getOwnPropertyDescriptor(it,ct))})}return _e}class XX extends Fs{get isSuccess(){return!!this.configs}constructor(rt,it){super(),Jt(this,"configs",void 0),Jt(this,"store",void 0),Jt(this,"joinInfo",void 0),Jt(this,"cancelToken",void 0),Jt(this,"retryConfig",{timeout:3e3,timeoutFactor:1.5,maxRetryCount:1,maxRetryTimeout:1e4}),Jt(this,"interval",void 0),Jt(this,"mutex",void 0),Jt(this,"mutableParamsRead",!1),Jt(this,"configCache",{}),Jt(this,"limit_bitrate",void 0),this.mutex=new lu("config-distribute",rt),this.store=it}startGetConfigDistribute(rt,it){this.joinInfo=rt,this.cancelToken=it,this.interval&&this.stopGetConfigDistribute(),rn("ENABLE_CONFIG_DISTRIBUTE")&&(this.updateConfigDistribute(),this.interval=window.setInterval(()=>{this.updateConfigDistribute()},rn("CONFIG_DISTRIBUTE_INTERVAL")))}stopGetConfigDistribute(){this.interval&&clearInterval(this.interval),this.interval=void 0,this.joinInfo=void 0,this.cancelToken=void 0,this.configs=void 0,this.limit_bitrate=void 0}async awaitConfigDistributeComplete(){this.mutex.isLocked&&(await this.mutex.lock())()}async updateConfigDistribute(){if(this.mutableParamsRead||(this.mutableParamsRead=!0,Vr.reportApiInvoke(null,{options:void 0,name:Ks.LOAD_CONFIG_FROM_LOCALSTORAGE,tag:Ns.TRACER}).onSuccess(JSON.stringify(r_))),!this.joinInfo||!this.cancelToken||!this.retryConfig)return void Ut.debug("[config-distribute] get config distribute interrupted have no joininfo");let rt;const it=await this.mutex.lock();try{rt=await WX(this.joinInfo,this.cancelToken,this.retryConfig),Ut.debug("[config-distribute] get config distribute",JSON.stringify(rt));const ct=function(ut){var pt;const mt=s0(pt=Object.keys(ut).filter(Tt=>/^webrtc_ng_global_parameter/.test(Tt))).call(pt);for(let Tt=0;Tt<mt.length;Tt++)for(let bt=mt.length-1;bt>Tt;bt--){const Ot=mt[bt],Mt=ut[Ot].value;if(typeof Mt.__priority=="number"){const Dt=Mt.__priority,jt=mt[bt-1],$t=ut[jt].value;if(typeof $t.__priority=="number"){if(!(Dt>$t.__priority))continue;{const Ht=Ot;mt[bt]=mt[bt-1],mt[bt-1]=Ht}}else{const Ht=Ot;mt[bt]=mt[bt-1],mt[bt-1]=Ht}}}const _t=Date.now();let vt={};return mt.forEach(Tt=>{const bt=ut[Tt].value.__expires;bt&&bt<=_t||(vt[Tt]=ut[Tt])}),vt}(rt);this.cacheGlobalParameterConfig(ct),this.store.hasStartJoinChannel||(this.store.isABTestSuccess=!0),this.configs=ct}catch(ct){const ut=new $n(tn.NETWORK_RESPONSE_ERROR,ct);Ut.warning("[config-distribute] ".concat(ut.toString()))}finally{it()}}getBitrateLimit(){return this.limit_bitrate||void 0}handleBitrateLimit(rt){RV(rt)&&(this.limit_bitrate?this.limit_bitrate&&this.limit_bitrate.id!==rt.id&&this.emit(CA.UPDATE_BITRATE_LIMIT,rt):this.emit(CA.UPDATE_BITRATE_LIMIT,rt))}getLowStreamConfigDistribute(){return this.limit_bitrate&&PM({},this.limit_bitrate.low_stream_uplink)}handleABTestConfigDistribute(rt){try{const it={},ct=Object.keys(rt),ut=[];ct.forEach(pt=>{const mt=rt[pt].value;it[pt]=mt;const _t=mt.__id;if(_t&&this.configCache[pt]&&this.configCache[pt].__id===_t)return;const vt=mt.__type,Tt=rt[pt].value,bt=rt[pt].tag;let Ot=0;vt?vt===q3.REALTIME&&(Ot=1):Object.keys(Tt).some(Mt=>Object.prototype.hasOwnProperty.call(LO,Mt)||!cM()&&Object.prototype.hasOwnProperty.call(Ew,Mt)?(Ot=1,!0):void 0),ut.push({tag:bt,isApplied:Ot,feature:pt,params:JSON.stringify(mt)})}),ut.forEach(pt=>{let{tag:mt,feature:_t,params:vt,isApplied:Tt}=pt;this.store.sessionId&&Vr.abTest(this.store.sessionId,{intSucc:1,isApplied:Tt,tag:mt,feature:_t,params:vt,cid:this.store.cid,uid:this.store.intUid})}),this.configCache=it}catch(it){Ut.debug("handleABTestConfigDistribute error",it)}}cacheGlobalParameterConfig(rt){const it=function(ut){const pt={};return Object.keys(ut).forEach(mt=>{const _t=ut[mt].value,vt=_t.__expires,Tt=_t.__type;Object.keys(_t).forEach(bt=>{bt==="__id"||bt==="__type"||bt==="__priority"||bt==="__expires"||Object.prototype.hasOwnProperty.call(pt,bt)||(pt[bt]=PM(PM({value:_t[bt]},vt&&{expires:vt}),Tt&&{type:Tt}))})}),pt}(rt);try{var ct;const ut=(ct=it.LIMIT_BITRATE)===null||ct===void 0?void 0:ct.value;delete it.LIMIT_BITRATE,ut&&RV(ut)&&this.handleBitrateLimit(ut),this.limit_bitrate=ut,this.handleGlobalParameterConfig(it),this.handleABTestConfigDistribute(rt),function(_t){try{const vt=Date.now();Object.keys(_t).forEach(Tt=>{const{value:bt,type:Ot,expires:Mt}=_t[Tt];Mt&&Mt<=vt||((Ot===q3.REALTIME||Object.prototype.hasOwnProperty.call(LO,Tt))&&(r_[Tt]=bt,xs[Tt]=bt,Ut.debug("Update realtime parameters from config distribute",Tt,bt)),Ot||cM()||!Object.prototype.hasOwnProperty.call(Ew,Tt)||(r_[Tt]=bt,xs[Tt]=bt,Ut.debug("Update gateway parameters from config distribute",Tt,bt)))})}catch(vt){Ut.error("Error update config immediately: ".concat(_t),vt.message)}}(it);const pt=JSON.stringify(it),mt=window.btoa(pt);window.localStorage.setItem("websdk_ng_global_parameter",mt),Ut.debug("Caching global parameters ".concat(pt))}catch(ut){Ut.error("Error caching global parameters:",ut.message)}}handleGlobalParameterConfig(rt){try{const it=Date.now();Object.keys(rt).forEach(ct=>{if(ct==="CLIENT_ROLE_OPTIONS"&&Object.prototype.hasOwnProperty.call(xs,ct)){const{value:ut,expires:pt}=rt[ct];if(pt&&pt<=it)return;(function(mt,_t){try{return typeof mt=="object"&&typeof _t=="object"&&JSON.stringify(mt)===JSON.stringify(_t)}catch{return!1}})(xs[ct],ut)||(r_[ct]=ut,xs[ct]=ut,this.emit(CA.UPDATE_CLIENT_ROLE_OPTIONS,ut),Ut.debug("Updating client role options: ".concat(JSON.stringify(ut))))}})}catch(it){Ut.error("Error handling global parameter config:",it.message)}}}class qX extends Fs{constructor(){super(...arguments),Jt(this,"resultStorage",new Map)}setLocalAudioStats(rt,it,ct){this.record("AUDIO_INPUT_LEVEL_TOO_LOW",rt,this.checkAudioInputLevel(ct,it)),this.record("SEND_AUDIO_BITRATE_TOO_LOW",rt,this.checkSendAudioBitrate(ct,it))}setLocalVideoStats(rt,it,ct){this.record("SEND_VIDEO_BITRATE_TOO_LOW",rt,this.checkSendVideoBitrate(ct,it)),this.record("FRAMERATE_INPUT_TOO_LOW",rt,this.checkFramerateInput(ct,it)),this.record("FRAMERATE_SENT_TOO_LOW",rt,this.checkFramerateSent(ct)),!it.muted&&this.record("VIDEO_ENCODE_FAILED",rt,this.checResolutionSent(ct))}setRemoteAudioStats(rt,it){const ct=rt.getUserId();this.record("AUDIO_OUTPUT_LEVEL_TOO_LOW",ct,this.checkAudioOutputLevel(it))}setRemoteVideoStats(rt,it){const ct=rt.getUserId();this.record("RECV_VIDEO_DECODE_FAILED",ct,this.checkVideoDecode(it))}record(rt,it,ct){if(rn("STATS_UPDATE_INTERVAL")>500)return;this.resultStorage.has(rt)||this.resultStorage.set(rt,{result:[],isPrevNormal:!0});const ut=this.resultStorage.get(rt);if(!ut)return;ut.result.push(ct);const pt=rt==="VIDEO_ENCODE_FAILED"?rn("ENCODE_EXCEPTION_TIMES"):5;if(ut.result.length>=pt){var mt;const _t=Er(mt=ut.result).call(mt,!0);ut.isPrevNormal&&!_t&&this.emit("exception",NM[rt],rt,it),!ut.isPrevNormal&&_t&&this.emit("exception",NM[rt]+2e3,rt+"_RECOVER",it),ut.isPrevNormal=_t,ut.result=[]}}checkAudioOutputLevel(rt){return!(rt.receiveBitrate>0&&rt.receiveLevel===0)}checkAudioInputLevel(rt,it){return it instanceof yl&&!it.isActive||!!it.muted||rt.sendVolumeLevel!==0}checkFramerateInput(rt,it){let ct=null;it._encoderConfig&&it._encoderConfig.frameRate&&(ct=bp(it._encoderConfig.frameRate));const ut=rt.captureFrameRate;return!ct||!ut||!(ct>10&&ut<5||ct<10&&ct>=5&&ut<=1)}checkFramerateSent(rt){return!(rt.captureFrameRate&&rt.sendFrameRate&&rt.captureFrameRate>5&&rt.sendFrameRate<=1)}checResolutionSent(rt){var it;return!(!rt.codecType||Er(it=rn("ENCODE_EXCEPTION_VALIDATE_CODEC")).call(it,rt.codecType.toLocaleLowerCase()))||!rt.captureFrameRate||rt.sendFrameRate!==0||rt.sendResolutionWidth!==0||rt.sendResolutionHeight!==0}checkSendVideoBitrate(rt,it){return!!it.muted||rt.sendBitrate!==0}checkSendAudioBitrate(rt,it){return it instanceof yl&&!it.isActive||!!it.muted||rt.sendBitrate!==0}checkVideoDecode(rt){return rt.receiveBitrate===0||rt.decodeFrameRate!==0}}const NM={FRAMERATE_INPUT_TOO_LOW:1001,FRAMERATE_SENT_TOO_LOW:1002,SEND_VIDEO_BITRATE_TOO_LOW:1003,RECV_VIDEO_DECODE_FAILED:1005,AUDIO_INPUT_LEVEL_TOO_LOW:2001,AUDIO_OUTPUT_LEVEL_TOO_LOW:2002,SEND_AUDIO_BITRATE_TOO_LOW:2003,VIDEO_ENCODE_FAILED:2004},pu=new class{markSubscribeStart(_e,rt){performance.mark("agora-web-sdk/".concat(_e,"/subscribe-").concat(rt))}markPublishStart(_e,rt){performance.mark("agora-web-sdk/".concat(_e,"/publish-").concat(rt))}measureFromSubscribeStart(_e,rt){const it=performance.getEntriesByName("agora-web-sdk/".concat(_e,"/subscribe-").concat(rt));if(it.length>0){const ct=it[it.length-1];return Math.round(performance.now()-ct.startTime)}return 0}measureFromPublishStart(_e,rt){const it=performance.getEntriesByName("agora-web-sdk/".concat(_e,"/publish-").concat(rt));if(it.length>0){const ct=it[it.length-1];return Math.round(performance.now()-ct.startTime)}return 0}};function m4(_e,rt){var it=Object.keys(_e);if(Object.getOwnPropertySymbols){var ct=Object.getOwnPropertySymbols(_e);rt&&(ct=ct.filter(function(ut){return Object.getOwnPropertyDescriptor(_e,ut).enumerable})),it.push.apply(it,ct)}return it}function w0(_e){for(var rt=1;rt<arguments.length;rt++){var it=arguments[rt]!=null?arguments[rt]:{};rt%2?m4(Object(it),!0).forEach(function(ct){Jt(_e,ct,it[ct])}):Object.getOwnPropertyDescriptors?Object.defineProperties(_e,Object.getOwnPropertyDescriptors(it)):m4(Object(it)).forEach(function(ct){Object.defineProperty(_e,ct,Object.getOwnPropertyDescriptor(it,ct))})}return _e}class NA{constructor(rt){Jt(this,"store",void 0),Jt(this,"onStatsException",void 0),Jt(this,"onUploadPublishDuration",void 0),Jt(this,"onStatsChanged",void 0),Jt(this,"onVideoCodecChanged",void 0),Jt(this,"localStats",new Map),Jt(this,"remoteStats",new Map),Jt(this,"updateStatsInterval",void 0),Jt(this,"trafficStats",void 0),Jt(this,"trafficStatsPeerList",[]),Jt(this,"uplinkStats",void 0),Jt(this,"exceptionMonitor",void 0),Jt(this,"p2pChannel",void 0),Jt(this,"scalabilityMode",_w.L1T1),Jt(this,"updateStats",()=>{this.p2pChannel&&(this.updateRemoteStats(this.p2pChannel),this.updateLocalStats(this.p2pChannel))}),this.store=rt,this.exceptionMonitor=new qX,this.exceptionMonitor.on("exception",(it,ct,ut)=>{this.onStatsException&&this.onStatsException(it,ct,ut)})}startUpdateStats(){this.updateStatsInterval||(this.updateStatsInterval=window.setInterval(this.updateStats,1e3))}stopUpdateStats(){this.updateStatsInterval&&(window.clearInterval(this.updateStatsInterval),this.updateStatsInterval=void 0)}reset(){this.localStats=new Map,this.remoteStats=new Map,this.trafficStats=void 0,this.trafficStatsPeerList=[],this.uplinkStats=void 0}getLocalAudioTrackStats(){return this.localStats.get(or.LocalAudioTrack)||w0({},GO)}getLocalVideoTrackStats(){return this.localStats.get(or.LocalVideoTrack)||w0({},$O)}getRemoteAudioTrackStats(rt){const it=(pt,mt)=>{if(!this.trafficStats)return mt;const _t=this.trafficStats.peer_delay.find(vt=>vt.peer_uid===pt);return _t&&(mt.publishDuration=_t.B_ppad+(Date.now()-this.trafficStats.timestamp)),mt},ct={};if(rt){var ut;const pt=(ut=this.remoteStats.get(rt))===null||ut===void 0?void 0:ut.audioStats;pt&&(ct[rt]=it(rt,pt))}else Array.from(this.remoteStats.entries()).forEach(pt=>{let[mt,{audioStats:_t}]=pt;_t&&(ct[mt]=it(mt,_t))});return ct}getRemoteNetworkQualityStats(rt){const it={};if(rt){var ct;const ut=(ct=this.remoteStats.get(rt))===null||ct===void 0?void 0:ct.networkStats;ut&&(it[rt]=ut)}else Array.from(this.remoteStats.entries()).forEach(ut=>{let[pt,{networkStats:mt}]=ut;mt&&(it[pt]=mt)});return it}getRemoteVideoTrackStats(rt){const it=(pt,mt)=>{if(!this.trafficStats)return mt;const _t=this.trafficStats.peer_delay.find(vt=>vt.peer_uid===pt);return _t&&(mt.publishDuration=_t.B_ppvd+(Date.now()-this.trafficStats.timestamp)),mt},ct={};if(rt){var ut;const pt=(ut=this.remoteStats.get(rt))===null||ut===void 0?void 0:ut.videoStats;pt&&(ct[rt]=it(rt,pt))}else Array.from(this.remoteStats.entries()).forEach(pt=>{let[mt,{videoStats:_t}]=pt;_t&&(ct[mt]=it(mt,_t))});return ct}getRTCStats(){let rt=0,it=0,ct=0,ut=0;const pt=this.localStats.get(or.LocalAudioTrack);pt&&(rt+=pt.sendBytes,it+=pt.sendBitrate);const mt=this.localStats.get(or.LocalVideoTrack);mt&&(rt+=mt.sendBytes,it+=mt.sendBitrate);const _t=this.localStats.get(or.LocalVideoLowTrack);_t&&(rt+=_t.sendBytes,it+=_t.sendBitrate),this.remoteStats.forEach(Tt=>{let{audioStats:bt,videoStats:Ot}=Tt;bt&&(ct+=bt.receiveBytes,ut+=bt.receiveBitrate),Ot&&(ct+=Ot.receiveBytes,ut+=Ot.receiveBitrate)});let vt=1;return this.trafficStats&&(vt+=this.trafficStats.peer_delay.length),{Duration:0,UserCount:vt,SendBitrate:it,SendBytes:rt,RecvBytes:ct,RecvBitrate:ut,OutgoingAvailableBandwidth:this.uplinkStats?this.uplinkStats.B_uab/1e3:0,RTT:this.trafficStats?2*this.trafficStats.B_acd:0}}addLocalStats(rt){this.localStats.set(rt,void 0)}removeLocalStats(rt){rt?this.localStats.delete(rt):this.localStats.clear()}addRemoteStats(rt){this.remoteStats.set(rt,{})}removeRemoteStats(rt){rt?this.remoteStats.delete(rt):this.remoteStats.clear()}addP2PChannel(rt){this.p2pChannel=rt}updateTrafficStats(rt){rt.peer_delay=rt.peer_delay.filter(it=>it.B_ppad!==void 0||it.B_ppvd!==void 0),rt.peer_delay.filter(it=>this.trafficStatsPeerList.indexOf(it.peer_uid)===-1).forEach(it=>{var ct;const ut=(ct=this.p2pChannel)===null||ct===void 0?void 0:ct.getRemoteMedia(it.peer_uid),pt=ut!=null&&ut.videoSSRC?pu.measureFromSubscribeStart(this.store.clientId,ut.videoSSRC):0,mt=ut!=null&&ut.audioSSRC?pu.measureFromSubscribeStart(this.store.clientId,ut.audioSSRC):0;it.B_ppad!==void 0&&it.B_ppvd!==void 0&&(this.onUploadPublishDuration&&this.onUploadPublishDuration(it.peer_uid,it.B_ppad,it.B_ppvd,pt>mt?pt:mt),this.trafficStatsPeerList.push(it.peer_uid))}),this.trafficStats=rt}updateUplinkStats(rt){this.uplinkStats&&this.uplinkStats.B_fir!==rt.B_fir&&Ut.debug("[".concat(this.store.clientId,"]: Period fir changes to ").concat(rt.B_fir)),this.uplinkStats=rt}static isRemoteVideoFreeze(rt,it,ct){if(!rt)return!1;const ut=!!ct&&it.framesDecodeFreezeTime>ct.framesDecodeFreezeTime,pt=!ct||it.framesDecodeCount>ct.framesDecodeCount;return ut||!pt}static isRemoteAudioFreeze(rt){return!!rt&&rt._isFreeze()}isLocalVideoFreeze(rt){return!(!rt.inputFrame||!rt.sentFrame)&&rt.inputFrame.frameRate>5&&rt.sentFrame.frameRate<3}updateLocalStats(rt){Array.from(this.localStats.entries()).forEach(it=>{let[ct,ut]=it;switch(ct){case or.LocalVideoTrack:case or.LocalVideoLowTrack:{const _t=ut,vt=w0({},$O),Tt=rt.getStats(),bt=rt.getLocalMedia(ct);if(Tt){const Ot=Tt.videoSend.find(Mt=>Mt.ssrc===(bt==null?void 0:bt.ssrcs[0].ssrcId));if(Ot){const Mt=rt.getLocalVideoSize(),Dt=rt.getEncoderConfig(or.LocalVideoTrack);var pt;(Ot.codec==="H264"||Ot.codec==="H265"||Ot.codec==="VP8"||Ot.codec==="VP9"||Ot.codec==="AV1X"||Ot.codec==="AV1")&&(vt.codecType=Ot.codec,(_t==null?void 0:_t.codecType)!==Ot.codec&&((pt=this.onVideoCodecChanged)===null||pt===void 0||pt.call(this,Ot.codec.toLocaleLowerCase()))),vt.sendBytes=Ot.bytes,vt.sendBitrate=_t?8*Math.max(0,vt.sendBytes-_t.sendBytes):0,Ot.inputFrame?(vt.captureFrameRate=Ot.inputFrame.frameRate,vt.captureResolutionHeight=Ot.inputFrame.height,vt.captureResolutionWidth=Ot.inputFrame.width):Mt&&(vt.captureResolutionWidth=Mt.width,vt.captureResolutionHeight=Mt.height),Ot.sentFrame?(vt.sendFrameRate=Ot.sentFrame.frameRate,vt.sendResolutionHeight=Ot.sentFrame.height,vt.sendResolutionWidth=Ot.sentFrame.width):Mt&&(vt.sendResolutionWidth=Mt.width,vt.sendResolutionHeight=Mt.height),Ot.avgEncodeMs&&(vt.encodeDelay=Ot.avgEncodeMs),Dt&&Dt.bitrateMax?vt.targetSendBitrate=1e3*Dt.bitrateMax:Ot.targetBitrate&&(vt.targetSendBitrate=Ot.targetBitrate),vt.sendPackets=Ot.packets,vt.sendPacketsLost=Ot.packetsLost,vt.sendJitterMs=Ot.jitterMs,vt.sendRttMs=Ot.rttMs,vt.totalDuration=_t?_t.totalDuration+1:1,vt.totalFreezeTime=_t?_t.totalFreezeTime:0,this.isLocalVideoFreeze(Ot)&&(vt.totalFreezeTime+=1),Ot.scalabilityMode&&this.scalabilityMode!==Ot.scalabilityMode&&(Ut.debug("[".concat(this.store.clientId,"]: The scalabilityMode of the video sending stream is ").concat(Ot.scalabilityMode)),this.scalabilityMode=Ot.scalabilityMode)}this.trafficStats&&(vt.currentPacketLossRate=(this.trafficStats.B_pvlr4||0)/100)}var mt;this.localStats.set(ct,vt),((_t==null?void 0:_t.sendResolutionWidth)!==vt.sendResolutionWidth||(_t==null?void 0:_t.sendResolutionHeight)!==vt.sendResolutionHeight)&&((mt=this.onStatsChanged)===null||mt===void 0||mt.call(this,"resolution",{width:vt.sendResolutionWidth,height:vt.sendResolutionHeight})),vt&&bt&&this.exceptionMonitor.setLocalVideoStats(this.store.uid,bt.track,vt);break}case or.LocalAudioTrack:{const _t=ut,vt=w0({},GO),Tt=rt.getStats(),bt=rt.getLocalMedia(ct);if(Tt){const Ot=Tt.audioSend.find(Mt=>Mt.ssrc===(bt==null?void 0:bt.ssrcs[0].ssrcId));if(Ot){if(Ot.codec!=="opus"&&Ot.codec!=="aac"&&Ot.codec!=="PCMU"&&Ot.codec!=="PCMA"&&Ot.codec!=="G722"||(vt.codecType=Ot.codec),Ot.inputLevel)vt.sendVolumeLevel=Math.round(32767*Ot.inputLevel);else{const Mt=rt.getLocalAudioVolume();Mt&&(vt.sendVolumeLevel=Math.round(32767*Mt))}vt.sendBytes=Ot.bytes,vt.sendPackets=Ot.packets,vt.sendPacketsLost=Ot.packetsLost,vt.sendJitterMs=Ot.jitterMs,vt.sendRttMs=Ot.rttMs,vt.sendBitrate=_t?8*Math.max(0,vt.sendBytes-_t.sendBytes):0}}this.trafficStats&&(vt.currentPacketLossRate=(this.trafficStats.B_palr4||0)/100),this.localStats.set(or.LocalAudioTrack,vt),vt&&bt&&this.exceptionMonitor.setLocalAudioStats(this.store.uid,bt.track,vt);break}}})}updateRemoteStats(rt){Array.from(this.remoteStats.entries()).forEach(it=>{var ct,ut;let[pt,{videoStats:mt,audioStats:_t,videoPcStats:vt}]=it;const Tt=_t,bt=mt,Ot=vt,Mt=w0({},aB),Dt=w0({},cB),jt=w0({},NY),{audioTrack:$t,videoTrack:Ht,audioSSRC:en,videoSSRC:Qt}=rt.getRemoteMedia(pt);let on;on=this.store.useP2P?rt.getStats(!0):rt.getStats();const Tn=(ct=on)===null||ct===void 0?void 0:ct.audioRecv.find(Xn=>Xn.ssrc===en),vn=(ut=on)===null||ut===void 0?void 0:ut.videoRecv.find(Xn=>Xn.ssrc===Qt),hn=this.trafficStats&&this.trafficStats.peer_delay.find(Xn=>Xn.peer_uid===pt);if(Tn&&(Tn.codec!=="opus"&&Tn.codec!=="aac"&&Tn.codec!=="PCMU"&&Tn.codec!=="PCMA"&&Tn.codec!=="G722"||(Mt.codecType=Tn.codec),Tn.outputLevel?Mt.receiveLevel=Math.round(32767*Tn.outputLevel):$t&&(Mt.receiveLevel=Math.round(32767*$t.getVolumeLevel())),Mt.receiveBytes=Tn.bytes,Mt.receivePackets=Tn.packets,Mt.receivePacketsLost=Tn.packetsLost,Mt.receivePacketsDiscarded=Tn.packetsDiscarded,Mt.packetLossRate=Mt.receivePacketsLost/(Mt.receivePackets+Mt.receivePacketsLost),Mt.receiveBitrate=Tt?8*Math.max(0,Mt.receiveBytes-Tt.receiveBytes):0,Mt.totalDuration=Tt?Tt.totalDuration+1:1,Mt.totalFreezeTime=Tt?Tt.totalFreezeTime:0,Mt.freezeRate=Mt.totalFreezeTime/Mt.totalDuration,Mt.receiveDelay=Tn.jitterBufferMs,Mt.totalDuration>10&&NA.isRemoteAudioFreeze($t)&&(Mt.totalFreezeTime+=1)),vn){var Ln;vn.codec!=="H264"&&vn.codec!=="H265"&&vn.codec!=="VP8"&&vn.codec!=="VP9"&&vn.codec!=="AV1X"&&vn.codec!=="AV1"||(Dt.codecType=vn.codec),Dt.receiveBytes=vn.bytes,Dt.receiveBitrate=bt?8*Math.max(0,Dt.receiveBytes-bt.receiveBytes):0,Dt.decodeFrameRate=vn.decodeFrameRate<0?0:vn.decodeFrameRate,Dt.renderFrameRate=vn.decodeFrameRate<0?0:vn.decodeFrameRate,vn.outputFrame&&(Dt.renderFrameRate=vn.outputFrame.frameRate),vn.receivedFrame?(Dt.receiveFrameRate=vn.receivedFrame.frameRate,Dt.receiveResolutionHeight=vn.receivedFrame.height,Dt.receiveResolutionWidth=vn.receivedFrame.width):Ht&&(Dt.receiveResolutionHeight=Ht._videoHeight||0,Dt.receiveResolutionWidth=Ht._videoWidth||0),vn.framesRateFirefox!==void 0&&(Dt.receiveFrameRate=Math.round(vn.framesRateFirefox)),Dt.receivePackets=vn.packets,Dt.receivePacketsLost=vn.packetsLost,Dt.packetLossRate=Dt.receivePacketsLost/(Dt.receivePackets+Dt.receivePacketsLost);const Xn=bt?bt.totalFreezeTime:0,Qn=bt?bt.totalDuration:0;Dt.totalDuration=bt?bt.totalDuration+1:1,Dt.totalFreezeTime=(Ln=vn.totalFreezesDuration)!==null&&Ln!==void 0?Ln:Xn||0,Dt.receiveDelay=vn.jitterBufferMs||0;const ur=!!Qt&&rt.getRemoteVideoIsReady(Qt);vn.totalFreezesDuration===void 0&&Ht&&ur&&NA.isRemoteVideoFreeze(Ht,vn,Ot)&&(Dt.totalFreezeTime+=1),Dt.freezeRate=Math.max(0,Math.min((Dt.totalFreezeTime-Xn)/(Dt.totalDuration-Qn),1))}hn&&(Mt.end2EndDelay=hn.B_ad,Dt.end2EndDelay=hn.B_vd,Mt.transportDelay=hn.B_ed,Dt.transportDelay=hn.B_ed,Mt.currentPacketLossRate=hn.B_ealr4/100,Dt.currentPacketLossRate=hn.B_evlr4/100,jt.uplinkNetworkQuality=hn.B_punq?hn.B_punq:0,jt.downlinkNetworkQuality=hn.B_pdnq?hn.B_pdnq:0),this.remoteStats.set(pt,{audioStats:Mt,videoStats:Dt,videoPcStats:vn,networkStats:jt}),$t&&this.exceptionMonitor.setRemoteAudioStats($t,Mt),Ht&&this.exceptionMonitor.setRemoteVideoStats(Ht,Dt)})}}class g4{constructor(){Jt(this,"destChannelMediaInfos",new Map),Jt(this,"srcChannelMediaInfo",void 0)}setSrcChannelInfo(rt){CV(rt),this.srcChannelMediaInfo=rt}addDestChannelInfo(rt){CV(rt),this.destChannelMediaInfos.set(rt.channelName,rt)}removeDestChannelInfo(rt){Uw(rt),this.destChannelMediaInfos.delete(rt)}getSrcChannelMediaInfo(){return this.srcChannelMediaInfo}getDestChannelMediaInfo(){return this.destChannelMediaInfos}}function _4(_e){if(!(_e instanceof g4))return new $n(tn.INVALID_PARAMS,"Config should be instance of [ChannelMediaRelayConfiguration]").throw();const rt=_e.getSrcChannelMediaInfo(),it=_e.getDestChannelMediaInfo();if(!rt)return new $n(tn.INVALID_PARAMS,"srcChannelMediaInfo should not be empty").throw();if(it.size===0)return new $n(tn.INVALID_PARAMS,"destChannelMediaInfo should not be empty").throw()}class pv{get hasVideo(){return this._video_enabled_&&!this._video_muted_&&this._video_added_}get hasAudio(){return this._audio_enabled_&&!this._audio_muted_&&this._audio_added_}get audioTrack(){if(this.hasAudio||this._audio_pre_subscribed)return this._audioTrack}get videoTrack(){if(this.hasVideo||this._video_pre_subscribed)return this._videoTrack}get dataChannels(){return this._dataChannels}constructor(rt,it){Jt(this,"uid",void 0),Jt(this,"_uintid",void 0),Jt(this,"_trust_in_room_",!0),Jt(this,"_trust_audio_enabled_state_",!0),Jt(this,"_trust_video_enabled_state_",!0),Jt(this,"_trust_audio_mute_state_",!0),Jt(this,"_trust_video_mute_state_",!0),Jt(this,"_audio_muted_",!1),Jt(this,"_video_muted_",!1),Jt(this,"_audio_enabled_",!0),Jt(this,"_video_enabled_",!0),Jt(this,"_audio_added_",!1),Jt(this,"_video_added_",!1),Jt(this,"_is_pre_created",!1),Jt(this,"_video_pre_subscribed",!1),Jt(this,"_audio_pre_subscribed",!1),Jt(this,"_trust_video_stream_added_state_",!0),Jt(this,"_trust_audio_stream_added_state_",!0),Jt(this,"_audioTrack",void 0),Jt(this,"_videoTrack",void 0),Jt(this,"_dataChannels",[]),Jt(this,"_audioSSRC",void 0),Jt(this,"_videoSSRC",void 0),Jt(this,"_audioOrtc",void 0),Jt(this,"_videoOrtc",void 0),Jt(this,"_cname",void 0),Jt(this,"_rtxSsrcId",void 0),Jt(this,"_videoMid",void 0),Jt(this,"_audioMid",void 0),this.uid=rt,this._uintid=it}}function E4(_e,rt){var it=Object.keys(_e);if(Object.getOwnPropertySymbols){var ct=Object.getOwnPropertySymbols(_e);rt&&(ct=ct.filter(function(ut){return Object.getOwnPropertyDescriptor(_e,ut).enumerable})),it.push.apply(it,ct)}return it}function DM(_e){for(var rt=1;rt<arguments.length;rt++){var it=arguments[rt]!=null?arguments[rt]:{};rt%2?E4(Object(it),!0).forEach(function(ct){Jt(_e,ct,it[ct])}):Object.getOwnPropertyDescriptors?Object.defineProperties(_e,Object.getOwnPropertyDescriptors(it)):E4(Object(it)).forEach(function(ct){Object.defineProperty(_e,ct,Object.getOwnPropertyDescriptor(it,ct))})}return _e}const Zw="9",LM=2e4,Qw=4e4;function v4(_e,rt){var it=Object.keys(_e);if(Object.getOwnPropertySymbols){var ct=Object.getOwnPropertySymbols(_e);rt&&(ct=ct.filter(function(ut){return Object.getOwnPropertyDescriptor(_e,ut).enumerable})),it.push.apply(it,ct)}return it}function _E(_e){for(var rt=1;rt<arguments.length;rt++){var it=arguments[rt]!=null?arguments[rt]:{};rt%2?v4(Object(it),!0).forEach(function(ct){Jt(_e,ct,it[ct])}):Object.getOwnPropertyDescriptors?Object.defineProperties(_e,Object.getOwnPropertyDescriptors(it)):v4(Object(it)).forEach(function(ct){Object.defineProperty(_e,ct,Object.getOwnPropertyDescriptor(it,ct))})}return _e}var VS=function(_e){return _e[_e.DOWN=0]="DOWN",_e[_e.UP=1]="UP",_e}(VS||{});const e1=new Map;function y4(_e,rt,it,ct){let{scale:ut}=_e;if(ut===0&&ct===VS.UP||ut>=rt.length-1&&ct===VS.DOWN)return _e;let pt=_E(_E({},_e),{},{scale:ct===VS.DOWN?++ut:--ut});switch(it){case"maintain-framerate":pt=_E(_E({},pt),rt[ut].motion);break;case"maintain-resolution":pt=_E(_E({},pt),rt[ut].detail);break;case"balanced":pt=_E(_E({},pt),rt[ut].balanced)}return pt}function S4(_e,rt){if(rt){const it={overUse:0,underUse:0,adaptationList:T4(rt)};e1.set(_e,it)}else e1.delete(_e)}function T4(_e){const rt=_E({},_e),{bitrateMax:it,frameRate:ct,scaleResolutionDownBy:ut,bitrateMin:pt}=rt,{MIN_FRAME_RATE:mt,MAX_THRESHOLD_FRAMERATE:_t,MAX_SCALE:vt,BITRATE_MIN_THRESHOLD:Tt,BITRATE_MAX_THRESHOLD:bt,BWE_SCALE_UP_THRESHOLD:Ot,BWE_SCALE_DOWN_THRESHOLD:Mt,PERF_SCALE_DOWN_THRESHOLD:Dt,PERF_SCALE_UP_THRESHOLD:jt,BALANCE_BITRATE_FACTOR:$t,BALANCE_FRAMERATE_FACTOR:Ht,BALANCE_RESOLUTION_FACTOR:en,MOTION_RESOLUTION_FACTOR:Qt,MOTION_BITRATE_FACTOR:on,DETAIL_FRAMERATE_FACTOR:Tn,DETAIL_BITRATE_FACTOR:vn}=NO,hn=Math.min(rt.frameRate,_t),Ln=[{scale:0,threshold:{bwe_down:Math.round(Math.pow(Mt,1)*it),bwe_up:it,fps_down:Math.round(Math.pow(Dt,1)*hn),fps_up:ct},balanced:{scaleResolutionDownBy:1,frameRate:ct,bitrateMax:it,bitrateMin:pt},motion:{scaleResolutionDownBy:1,frameRate:ct,bitrateMax:it,bitrateMin:pt},detail:{scaleResolutionDownBy:1,frameRate:ct,bitrateMax:it,bitrateMin:pt}}];for(let Xn=1;Xn<=vt;Xn++){const Qn={bwe_up:Math.round(Math.pow(Ot,Xn)*it),bwe_down:Math.round(Math.pow(Mt,Xn+1)*it),fps_up:Math.round(Math.pow(jt,Xn)*hn),fps_down:Math.round(Math.pow(Dt,Xn+1)*hn)},ur={scaleResolutionDownBy:ut/Math.pow(en,Xn),frameRate:Math.max(Math.round(Math.pow(Ht,Xn)*ct),mt),bitrateMax:Math.max(Math.round(Math.pow($t,Xn)*it),bt),bitrateMin:Math.max(Math.round(Math.pow($t,Xn)*pt),Tt)},go={scaleResolutionDownBy:ut/Math.pow(Qt,Xn),frameRate:ct,bitrateMax:Math.max(Math.round(Math.pow(on,Xn)*it),bt),bitrateMin:Math.max(Math.round(Math.pow(on,Xn)*pt),Tt)},Eo={scaleResolutionDownBy:1,frameRate:Math.max(Math.round(Math.pow(Tn,Xn)*ct),mt),bitrateMax:Math.max(Math.round(Math.pow(vn,Xn)*it),bt),bitrateMin:Math.max(Math.round(Math.pow(vn,Xn)*pt),Tt)};Ln.push({scale:Xn,threshold:Qn,balanced:ur,motion:go,detail:Eo})}return Ln}function JX(_e,rt,it,ct,ut,pt){const mt=e1.get(_e)||{overUse:0,underUse:0,adaptationList:T4(ut)},{adaptationList:_t}=mt;e1.set(_e,mt);const{OVERUSE_TIMES_THRESHOLD:vt,UNDERUSE_TIMES_THRESHOLD:Tt}=NO,{scale:bt}=ct;let Ot,Mt;return typeof rt=="number"&&rt>0&&function(Dt,jt,$t,Ht){if(jt>=$t.length)return!1;let{threshold:{fps_down:en}}=$t[jt];return rn("FORCE_AG_HIGH_FRAMERATE")&&Ht==="maintain-framerate"&&(en=$t[0].threshold.fps_down),Dt<en}(rt,bt,_t,pt)&&(mt.overUse++,Mt=gA.CPU,mt.overUse>vt)||typeof it=="number"&&it>0&&function(Dt,jt,$t){if(jt>=$t.length)return!1;const{threshold:{bwe_down:Ht}}=$t[jt];return Dt<Ht}(it,bt,_t)&&(mt.overUse++,Mt=gA.BANDWIDTH,mt.overUse>vt)?(mt.overUse=0,mt.underUse=0,Ot=y4(ct,_t,pt,VS.DOWN),[Ot,Mt]):(typeof rt=="number"&&rt>0&&typeof it=="number"&&it>0&&function(Dt,jt,$t,Ht){if(jt===0)return;let{threshold:{fps_up:en}}=$t[jt];return rn("FORCE_AG_HIGH_FRAMERATE")&&Ht==="maintain-framerate"&&(en=$t[1].threshold.fps_up),Dt>en}(rt,bt,_t,pt)&&function(Dt,jt,$t){if(jt===0)return;const{threshold:{bwe_up:Ht}}=$t[jt];return Dt>Ht}(it,bt,_t)&&(mt.underUse++,mt.underUse>Tt&&(mt.overUse=0,mt.underUse=0,Ot=y4(ct,_t,pt,VS.UP),Ot.scale===0&&(Mt=gA.NONE))),[Ot,Mt])}function A4(_e,rt){var it=Object.keys(_e);if(Object.getOwnPropertySymbols){var ct=Object.getOwnPropertySymbols(_e);rt&&(ct=ct.filter(function(ut){return Object.getOwnPropertyDescriptor(_e,ut).enumerable})),it.push.apply(it,ct)}return it}function kM(_e){for(var rt=1;rt<arguments.length;rt++){var it=arguments[rt]!=null?arguments[rt]:{};rt%2?A4(Object(it),!0).forEach(function(ct){Jt(_e,ct,it[ct])}):Object.getOwnPropertyDescriptors?Object.defineProperties(_e,Object.getOwnPropertyDescriptors(it)):A4(Object(it)).forEach(function(ct){Object.defineProperty(_e,ct,Object.getOwnPropertyDescriptor(it,ct))})}return _e}const t1=new Map;function n1(_e,rt){const it=t1.get(_e);if(it){const{timer:ct}=it;window.clearTimeout(ct),t1.delete(_e)}rt.qualityLimitationReason=gA.NONE,S4(_e)}function ZX(_e,rt){var it;let ct;switch(rt){case or.LocalAudioTrack:ct=es.Audio;break;case or.LocalVideoTrack:ct=Er(it=_e._hints).call(it,ds.SCREEN_TRACK)?es.Screen:es.High;break;case or.LocalVideoLowTrack:ct=es.Low}return ct}function UM(_e){const rt=Fo();if(_e.some(it=>it._bypassWebAudio))throw new Yn(tn.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");if(!rt.webAudioMediaStreamDest)throw new Yn(tn.NOT_SUPPORTED,"cannot publish multiple tracks because your browser does not support audio mixing")}function BM(_e,rt){UM(_e);const it=rt||new yl;return _e.forEach(ct=>it.addAudioTrack(ct)),it}const QX=!Fo().supportUnifiedPlan||rn("CHROME_FORCE_PLAN_B")&&hE();function r1(_e){let rt=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var it;return QX?(it={spec:rt,store:_e},gE("PlanBConnection").create(it)):new nm(rt,_e)}function FM(_e){return _e&&(_e.iceConnectionState==="disconnected"||_e.iceConnectionState==="checking"||_e.iceConnectionState==="failed")}function C4(_e){try{if(_e.iceServers)return!1;if(_e.turnServer&&_e.turnServer.mode!=="off"){if(pA(_e.turnServer.servers))return!1;if(rn("FORCE_TURN_TCP")||_e.turnServer.servers.concat(_e.turnServer.serversFromGateway||[]).some(rt=>rt.forceturn))return!0}return!1}catch{return!1}}var Do;function b4(_e,rt){var it=Object.keys(_e);if(Object.getOwnPropertySymbols){var ct=Object.getOwnPropertySymbols(_e);rt&&(ct=ct.filter(function(ut){return Object.getOwnPropertyDescriptor(_e,ut).enumerable})),it.push.apply(it,ct)}return it}function c_(_e){for(var rt=1;rt<arguments.length;rt++){var it=arguments[rt]!=null?arguments[rt]:{};rt%2?b4(Object(it),!0).forEach(function(ct){Jt(_e,ct,it[ct])}):Object.getOwnPropertyDescriptors?Object.defineProperties(_e,Object.getOwnPropertyDescriptors(it)):b4(Object(it)).forEach(function(ct){Object.defineProperty(_e,ct,Object.getOwnPropertyDescriptor(it,ct))})}return _e}let nm=(Do=class V0 extends IV{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var rt,it;return(rt=(it=this.peerConnection.getReceivers()[0])===null||it===void 0||(it=it.transport)===null||it===void 0?void 0:it.state)!==null&&rt!==void 0?rt:null}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.send.videoCodecs.map(rt=>rt.rtpMap&&rt.rtpMap.encodingName.toLowerCase()||"").filter(rt=>{var it;return Er(it=Object.keys(EA)).call(it,rt)}))]}constructor(rt,it){super(rt,it),Jt(this,"id",ms(5,"connection-")),Jt(this,"store",void 0),Jt(this,"peerConnection",void 0),Jt(this,"forceTurn",!1),Jt(this,"remoteSDP",void 0),Jt(this,"initialOffer",void 0),Jt(this,"transportEventReceiver",void 0),Jt(this,"statsFilter",void 0),Jt(this,"extension",{useXR:rn("USE_XR")}),Jt(this,"localCapabilities",void 0),Jt(this,"remoteCodecs",void 0),Jt(this,"localCandidateCount",0),Jt(this,"allCandidatesReceived",!1),Jt(this,"isPreallocation",!1),Jt(this,"preMediaMap",new Map),Jt(this,"dataStreamChannelMap",new Map),Jt(this,"establishPromise",void 0),Jt(this,"recoveredDataChannelIds",[]),Jt(this,"currentDataChannelId",1),Jt(this,"supportAV1RtpSpec",!1),Jt(this,"mutex",void 0),Jt(this,"qualityLimitationReason",gA.NONE),Jt(this,"isFirstConnected",!1),this.store=it,this.forceTurn=C4(rt),this.mutex=new lu("P2PConnection-mutex",it.clientId),this.peerConnection=new RTCPeerConnection(V0.resolvePCConfiguration(rt),{optional:[{googDscp:!0}]}),this.isFirstConnected=!1,this.statsFilter=OO(this.peerConnection,rn("STATS_UPDATE_INTERVAL"),void 0,Gs()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,rt.isPreallocation&&(this.isPreallocation=!0),this.establishPromise=this.establish()}getPreMedia(rt){return this.preMediaMap.get(rt)}isPreSub(){return this.preMediaMap.size>0}async updateRemoteRTPCapabilities(rt,it){if(this.remoteCodecs=it,!this.remoteSDP)return void Ut.debug("[P2PConnection] cannot updateRemoteRTPCapabilities before remote SDP created, local codecs: ".concat(this.localCodecs,", codecs: ").concat(it));if(this.remoteSDP.updateRemoteCodec(rt,it,this.store.codec)){const ct=await this.peerConnection.createOffer(),ut=this.logSDPExchange(ct.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(ct);const pt=this.remoteSDP.toString();ut==null||ut(pt),await this.peerConnection.setRemoteDescription({type:"answer",sdp:pt})}else Ut.debug("[P2PConnection] updateRemoteRTPCapabilities no need to exchange SDP.")}async establish(){try{this.peerConnection.addTransceiver("video",{direction:"recvonly"}),this.peerConnection.addTransceiver("audio",{direction:"recvonly"});const ct=await this.peerConnection.createOffer();if(!ct.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const ut=lv(ct.sdp),pt=await KV({filterRTX:!rn("USE_PUB_RTX")&&!rn("USE_SUB_RTX"),filterVideoFec:rn("FILTER_VIDEO_FEC"),filterAudioFec:rn("FILTER_AUDIO_FEC"),filterVideoCodec:rn("FILTER_VIDEO_CODEC"),unsupportedVideoUplinkCodec:rn("UNSUPPORTED_VIDEO_UPLINK_CODEC"),unsupportedVideoDownlinkCodec:rn("UNSUPPORTED_VIDEO_DOWNLINK_CODEC")},this.extension);if(this.localCapabilities=Kw(pt),this.initialOffer=ct,rn("ENABLE_SVC")&&this.store.codec=="av1"){const _t=await async function(){try{const vt=new RTCPeerConnection;vt.addTransceiver("video",{direction:"sendonly",sendEncodings:[{scalabilityMode:_w.L1T3}]});const Tt=await vt.createOffer();if(!Tt.sdp)return void vt.close();const bt=op(Tt.sdp).mediaDescriptions[0];if(!bt)return;const Ot=bt.attributes.extmaps.find(Mt=>Mt.extensionName==="https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension");return vt.close(),Ot}catch{return}}();var rt;_t&&(this.supportAV1RtpSpec=!0,(rt=pt.send)===null||rt===void 0||rt.videoExtensions.push(_t))}let mt;return ct.sdp&&JV(ct.sdp)&&(mt=Ds(pt),(it=mt).send&&(LS(Pr.VIDEO,it.send.videoExtensions),LS(Pr.AUDIO,it.send.audioExtensions)),it.recv&&(LS(Pr.VIDEO,it.recv.videoExtensions),LS(Pr.AUDIO,it.recv.audioExtensions)),it.sendrecv&&(LS(Pr.VIDEO,it.sendrecv.videoExtensions),LS(Pr.AUDIO,it.sendrecv.audioExtensions))),c_(c_({},ut),{},{rtpCapabilities:mt||pt,offerSDP:ct.sdp})}catch(ct){throw new Yn(tn.GET_LOCAL_CONNECTION_PARAMS_FAILED,ct.toString())}var it}async connect(rt){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.initialOffer.sdp&&JV(this.initialOffer.sdp)&&(it=rt.rtpCapabilities,ct=this.localCapabilities,it.send&&(jw(Pr.VIDEO,it.send.videoExtensions,ct.send.videoExtensions),jw(Pr.AUDIO,it.send.audioExtensions,ct.send.audioExtensions)),it.recv&&(jw(Pr.VIDEO,it.recv.videoExtensions,ct.recv.videoExtensions),jw(Pr.AUDIO,it.recv.audioExtensions,ct.recv.audioExtensions))),this.remoteSDP=new class{get localCapabilities(){return Ds(this._localCapabilities)}get rtpCapabilities(){return Ds(this._rtpCapabilities)}get candidates(){return Ds(this._candidates)}get iceParameters(){return Ds(this._iceParameters)}get dtlsParameters(){return Ds(this._dtlsParameters)}constructor(vt){let Tt=arguments.length>1&&arguments[1]!==void 0&&arguments[1],bt=arguments.length>2&&arguments[2]!==void 0&&arguments[2];Jt(this,"sessionDesc",void 0),Jt(this,"_localCapabilities",void 0),Jt(this,"_rtpCapabilities",void 0),Jt(this,"_candidates",void 0),Jt(this,"_originCandidates",void 0),Jt(this,"_iceParameters",void 0),Jt(this,"_isUseExtmapAllowMixed",void 0),Jt(this,"_isUseLocalCodecs",void 0),Jt(this,"_dtlsParameters",void 0),Jt(this,"setup",void 0),Jt(this,"currentMidIndex",void 0),Jt(this,"cname",void 0),Jt(this,"useLocalCodecsMids",[]),Jt(this,"preloadSsrcs",[]),Jt(this,"firefoxSsrcMidMap",new Map),this._isUseExtmapAllowMixed=Tt,this._isUseLocalCodecs=bt,vt=Ds(vt);const{iceParameters:Ot,dtlsParameters:Mt,candidates:Dt,rtpCapabilities:jt,setup:$t,localCapabilities:Ht,cname:en}=vt;this._rtpCapabilities=jt,this._candidates=Dt,this._originCandidates=Ds(Dt),this._iceParameters=Ot,this._dtlsParameters=Mt,this._localCapabilities=Ht,this.setup=$t,this.cname=en,[this.sessionDesc]=this.updateRemoteRTPCapabilities(jt),this.currentMidIndex=this.sessionDesc.mediaDescriptions.length-1}checkPreloadSsrcs(vt){return vt.length===this.preloadSsrcs.length&&vt.every(Tt=>{var bt;return Er(bt=this.preloadSsrcs).call(bt,Tt)})}preloadRemoteMedia(vt){let Tt=0;const bt=[],Ot=[];for(;vt>0;){const Mt=[DM({ssrcId:Qw+Tt},rn("USE_SUB_RTX")?{rtx:Qw+Tt+1}:{})],Dt="".concat(Qw+Tt,"_").concat(LM+Tt),{ssrcs:jt,ssrcGroups:$t}=xA(Mt,this.cname,rn("SYNC_GROUP")?Dt:void 0),Ht=this.preCreateOrRecycleSendMedia("video",jt,$t,void 0),en=[{ssrcId:LM+Tt}],Qt="".concat(Qw+Tt,"_").concat(LM+Tt),{ssrcs:on,ssrcGroups:Tn}=xA(en,this.cname,rn("SYNC_GROUP")?Qt:void 0),vn=this.preCreateOrRecycleSendMedia("audio",on,Tn,void 0);vt--,Tt+=2,bt.push(Ht,vn),Ot.push(jt[0].ssrcId,on[0].ssrcId)}return this.useLocalCodecsMids.push(...bt),this.preloadSsrcs=Ot,{mids:bt,preSSRCs:Ot,isAvailable:!0}}preCreateOrRecycleSendMedia(vt,Tt,bt,Ot){const Mt=this.rtpCapabilities.send.videoCodecs,Dt=this._isUseLocalCodecs||Mt.length===0?this.localCapabilities.recv:this.rtpCapabilities.send;Ut.debug("create or recycle send media without remote rtp capabilities, ssrcs ",Tt[0].ssrcId);const jt=vt===Pr.VIDEO?Dt.videoCodecs:Dt.audioCodecs,$t=vt===Pr.VIDEO?Dt.videoExtensions:Dt.audioExtensions;this.currentMidIndex+=1;const Ht="".concat(this.currentMidIndex);let en={media:{mediaType:vt,port:Zw,protos:["UDP","TLS","RTP","SAVPF"],fmts:jt.map(Qt=>Qt.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:$t,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:Tt,ssrcGroups:bt,rtcpFeedbackWildcards:[],payloads:jt,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(Ht)}};return en=this.mungSendMediaDesc(en,Ot),this.sessionDesc.mediaDescriptions.push(en),this.updateBundleMids(),Ht}toString(){return rv(this.sessionDesc)}send(vt,Tt,bt,Ot){const{ssrcs:Mt,ssrcGroups:Dt}=xA(Tt,this.cname,rn("SYNC_GROUP")?bt:void 0),jt=this.findPreloadMediaDesc(Mt);if(jt){if(Gs()&&this.firefoxSsrcMidMap.set(Mt[0].ssrcId,jt.attributes.mid),Ot&&(Ot.twcc||Ot.remb)){const $t=this.sessionDesc.mediaDescriptions.indexOf(jt);return this.sessionDesc.mediaDescriptions[$t]=this.mungSendMediaDesc(jt,Ot),{mid:jt.attributes.mid,needExchangeSDP:!0}}return{mid:jt.attributes.mid,needExchangeSDP:!1}}{const $t=this.findAvailableMediaIndex(vt,Mt);let Ht;return $t===-1||$t===1&&(tu()||function(){const en=No();return!(en.name!==Ho.CHROME||!en.osVersion)&&Number(en.version)<=90}()||rn("ENABLE_ENCODED_TRANSFORM")&&dE())||$t===0&&!function(en){const Qt=No();return!(Qt.name!==Ho.FIREFOX||!Qt.osVersion)&&Number(Qt.version)===en}(138)&&rn("USE_SUB_RTX")||y3()?(Ht=this.createOrRecycleSendMedia(vt,Mt,Dt,"sendonly",Ot),this.updateBundleMids()):(Ht=Ds(this.sessionDesc.mediaDescriptions[$t]),Ht.attributes.direction="sendonly",Ht.attributes.ssrcs=Mt,Ht.attributes.ssrcGroups=Dt,this.sessionDesc.mediaDescriptions[$t]=this.mungSendMediaDesc(Ht,Ot)),Gs()&&this.firefoxSsrcMidMap.set(Mt[0].ssrcId,Ht.attributes.mid),{mid:Ht.attributes.mid,needExchangeSDP:!0}}}sendDataChannel(){const{mediaDesc:vt,needExchangeSDP:Tt}=this.createOrRecycleDataChannel();return this.updateBundleMids(),{mid:vt.attributes.mid,needExchangeSDP:Tt}}batchSend(vt){const Tt=vt.map(Mt=>{let{kind:Dt,ssrcMsg:jt,mslabel:$t}=Mt;return this.send(Dt,jt,$t)}),bt=[];let Ot=!1;return Tt.forEach(Mt=>{let{mid:Dt,needExchangeSDP:jt}=Mt;jt&&(Ot=!0),bt.push(Dt)}),{mids:bt,needExchangeSDP:Ot}}stopSending(vt){const Tt=this.sessionDesc.mediaDescriptions.filter(bt=>bt.attributes.mid&&vt.indexOf(bt.attributes.mid)!==-1);if(Tt.length!==vt.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");Tt.forEach(bt=>{bt.attributes.mid==="0"||Gs()||y3()?bt.attributes.ssrcs=[]:(bt.attributes.ssrcs=[],bt.attributes.direction="inactive",bt.media.port="0")}),this.updateBundleMids()}mute(vt){const Tt=this.sessionDesc.mediaDescriptions.find(bt=>bt.attributes.mid===vt);if(!Tt)throw new Error("mediaDescription not found with ".concat(vt," in remote SDP when calling RemoteSDP.mute."));Tt.attributes.direction="inactive"}unmute(vt){const Tt=this.sessionDesc.mediaDescriptions.find(bt=>bt.attributes.mid===vt);if(!Tt)throw new Error("mediaDescription not found with ".concat(vt," in remote SDP when calling RemoteSDP.unmute."));Tt.attributes.direction="sendonly"}muteRemote(vt){const Tt=this.sessionDesc.mediaDescriptions.filter(bt=>Er(vt).call(vt,bt.attributes.mid||""));if(Tt.length!==vt.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");Tt.forEach(bt=>{bt.attributes.direction="inactive"})}unmuteRemote(vt){const Tt=this.sessionDesc.mediaDescriptions.filter(bt=>Er(vt).call(vt,bt.attributes.mid||""));if(Tt.length!==vt.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");Tt.forEach(bt=>{bt.attributes.direction="recvonly"})}receive(vt,Tt,bt,Ot){vt.forEach((Mt,Dt)=>{this.createOrRecycleRecvMedia(Mt,[],"recvonly",Tt,bt,Ot[Dt])}),this.updateBundleMids()}stopReceiving(vt){const Tt=this.sessionDesc.mediaDescriptions.filter(bt=>vt.indexOf(bt.attributes.mid)!==-1);if(Tt.length!==vt.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");Tt.forEach(bt=>{bt.media.port="0",bt.attributes.direction="inactive"}),this.updateBundleMids()}updateRemoteRTPCapabilities(vt){const Tt=this.sessionDesc||op((bt=this._isUseExtmapAllowMixed,`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=ice-lite`.concat(bt?`
a=extmap-allow-mixed`:"",`
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`)));var bt;this._rtpCapabilities=vt;let Ot=!1;const Mt=this.rtpCapabilities.send,Dt=this.localCapabilities.send,jt=this.localCapabilities.recv,$t=jt.videoCodecs,Ht=jt.audioCodecs,en=jt.videoExtensions,Qt=jt.audioExtensions;for(const hn of Tt.mediaDescriptions){var on;if(hn.attributes.direction!=="sendonly"||typeof hn.attributes.mid!="string"||!Er(on=this.useLocalCodecsMids).call(on,hn.attributes.mid)){if(Ot=!0,hn.attributes.iceUfrag=this._iceParameters.iceUfrag,hn.attributes.icePwd=this._iceParameters.icePwd,hn.attributes.fingerprints=this._dtlsParameters.fingerprints,hn.attributes.candidates=this._candidates,hn.attributes.setup=this.setup,hn.media.mediaType==="application"&&(hn.attributes.sctpPort="5000"),hn.media.mediaType==="video")if(this._isUseLocalCodecs&&hn.attributes.direction==="sendonly"){var Tn;hn.media.fmts=$t.map(Xn=>Xn.payloadType.toString(10)),hn.attributes.payloads=$t,hn.attributes.extmaps=en;const Ln=hn.attributes.mid;typeof Ln!="string"||Er(Tn=this.useLocalCodecsMids).call(Tn,Ln)||this.useLocalCodecsMids.push(Ln)}else if(Mt.videoCodecs.length===0){const Ln=Dt.videoCodecs.filter(Xn=>{var Qn,ur;return(Qn=Xn.rtpMap)===null||Qn===void 0?void 0:Er(ur=Qn.encodingName.toLowerCase()).call(ur,"vp8")})||[Dt.videoCodecs[0]];hn.media.fmts=Ln.map(Xn=>Xn.payloadType.toString(10)),hn.attributes.payloads=Ln,hn.attributes.extmaps=[]}else hn.media.fmts=Mt.videoCodecs.map(Ln=>Ln.payloadType.toString(10)),hn.attributes.payloads=Mt.videoCodecs,hn.attributes.extmaps=Mt.videoExtensions;if(hn.media.mediaType==="audio")if(this._isUseLocalCodecs&&hn.attributes.direction==="sendonly"){var vn;hn.media.fmts=Ht.map(Xn=>Xn.payloadType.toString(10)),hn.attributes.payloads=Ht,hn.attributes.extmaps=Qt;const Ln=hn.attributes.mid;typeof Ln!="string"||Er(vn=this.useLocalCodecsMids).call(vn,Ln)||this.useLocalCodecsMids.push(Ln)}else if(Mt.audioCodecs.length===0){const Ln=Dt.audioCodecs.filter(Xn=>{var Qn,ur;return(Qn=Xn.rtpMap)===null||Qn===void 0?void 0:Er(ur=Qn.encodingName.toLowerCase()).call(ur,"opus")})||[Dt.audioCodecs[0]];hn.media.fmts=Ln.map(Xn=>Xn.payloadType.toString(10)),hn.attributes.payloads=Ln,hn.attributes.extmaps=[]}else hn.media.fmts=Mt.audioCodecs.map(Ln=>Ln.payloadType.toString(10)),hn.attributes.payloads=Mt.audioCodecs,hn.attributes.extmaps=Mt.audioExtensions,US(hn)}}return this.sessionDesc=Tt,this.currentMidIndex=Tt.mediaDescriptions.length-1,[this.sessionDesc,Ot]}updateCandidates(vt){const Tt=this._originCandidates.filter(Ot=>Ot.transport==="udp"),bt=[];if(Tt.forEach(Ot=>{bt.push(DM(DM({},Ot),{},{foundation:"tcpcandidate",priority:Number(Ot.priority)-1+"",transport:"tcp",port:Number(Ot.port)+90+""}))}),Tt.length!==0){switch(vt){case hu.TCP_RELAY:this._candidates=bt;break;case hu.UDP_TCP_RELAY:case hu.RELAY:this._candidates=[...Tt,...bt];break;default:this._candidates=Tt}for(const Ot of this.sessionDesc.mediaDescriptions)Ot.attributes.candidates=this.candidates}}restartICE(vt){vt=Ds(vt),this._iceParameters=vt,this.sessionDesc.mediaDescriptions.forEach(Tt=>{Tt.attributes.iceUfrag=vt.iceUfrag,Tt.attributes.icePwd=vt.icePwd})}predictReceivingMids(vt){const Tt=[];for(let bt=0;bt<vt;bt++)Tt.push((this.currentMidIndex+bt+1).toString(10));return Tt}findAvailableMediaIndex(vt,Tt){return this.sessionDesc.mediaDescriptions.findIndex(bt=>{const Ot=bt.media.mediaType===vt&&bt.media.port!=="0"&&(bt.attributes.direction==="sendonly"||bt.attributes.direction==="sendrecv")&&bt.attributes.ssrcs.length===0;if(Gs()){if(Ot){const Mt=this.firefoxSsrcMidMap.get(Tt[0].ssrcId);return!(Mt||bt.attributes.mid!=="0"&&bt.attributes.mid!=="1")||!(!Mt||Mt!==bt.attributes.mid)}return!1}return Ot})}createOrRecycleDataChannel(){for(const bt of this.sessionDesc.mediaDescriptions)if(bt.media.mediaType==="application")return{mediaDesc:bt,needExchangeSDP:!1};this.currentMidIndex+=1;const vt="".concat(this.currentMidIndex),Tt={media:{mediaType:"application",port:Zw,protos:["UDP","DTLS","SCTP"],fmts:["webrtc-datachannel"]},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:[],fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[],rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,mid:"".concat(vt),sctpPort:"5000"}};return this.sessionDesc.mediaDescriptions.push(Tt),{mediaDesc:Tt,needExchangeSDP:!0}}createOrRecycleRecvMedia(vt,Tt,bt,Ot,Mt,Dt){const jt=vt._mediaStreamTrack.kind,$t=this.rtpCapabilities.recv,Ht=OA(jt,$t,this.localCapabilities.send,jt===Pr.VIDEO?Ot:Mt),en=jt===Pr.VIDEO?$t.videoExtensions:$t.audioExtensions;this.currentMidIndex+=1;const Qt="".concat(this.currentMidIndex);let on={media:{mediaType:jt,port:Zw,protos:["UDP","TLS","RTP","SAVPF"],fmts:Ht.map(vn=>vn.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:en,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:Tt,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:Ht,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:bt,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(Qt)}};on=this.mungRecvMediaDsec(on,vt,Dt);const Tn=this.findFirstClosedMedia(jt);if(Tn){const vn=this.sessionDesc.mediaDescriptions.indexOf(Tn);this.sessionDesc.mediaDescriptions[vn]=on}else this.sessionDesc.mediaDescriptions.push(on);return on}updateRemoteDtlsParameters(vt){const Tt=new Set(this._dtlsParameters.fingerprints.map(Mt=>Mt.fingerprint)),bt=new Set(vt.map(Mt=>Mt.fingerprint));let Ot=!1;Tt.size!==bt.size&&(Ot=!0);for(const Mt of Tt)bt.has(Mt)||(Ot=!0);return Ot}updateRemoteCodec(vt,Tt,bt){const Ot=[...new Set(this._rtpCapabilities.recv.videoCodecs.map(on=>on.rtpMap&&on.rtpMap.encodingName.toLowerCase()||"").filter(on=>{var Tn;return Er(Tn=Object.keys(EA)).call(Tn,on)}))],Mt=new Set(Tt);if(Ot.every(on=>Mt.has(on)))return Ut.debug("codecs has not changed, no need to updateRemoteCodec, codecs: ".concat(Tt)),!1;const Dt=this._rtpCapabilities.recv.videoCodecs.filter(on=>Tt.some(Tn=>{var vn;return Er(vn=on.rtpMap&&on.rtpMap.encodingName.toLowerCase()||"").call(vn,Tn)}));if(Dt.length===0)return Ut.debug("updateRemoteCodec failed, because cannot find matched codec, remoteCapabilities codecs: ".concat(Ot," codecs: ").concat(Tt)),!1;const jt=[...new Set(Dt.map(on=>on.rtpMap&&on.rtpMap.encodingName.toLowerCase()||""))];let $t;if(Ut.debug("updateRemoteCodec, from ".concat(Ot," to ").concat(jt)),vt.length===0)$t=this.sessionDesc.mediaDescriptions.filter(on=>on.media.mediaType==="video"&&on.attributes.direction==="recvonly");else if($t=this.sessionDesc.mediaDescriptions.filter(on=>on.attributes.mid&&on.media.mediaType==="video"&&Er(vt).call(vt,on.attributes.mid)&&on.attributes.direction==="recvonly"),$t.length!==vt.length)return Ut.debug("updateRemoteCodec failed, because cannot find mids, mids: ".concat(vt,", codecs: ").concat(Tt)),!1;if(rn("USE_PUB_RTX")||rn("USE_SUB_RTX")){const on=uv(Dt,this.rtpCapabilities.recv.videoCodecs);Dt.push(...on)}this._rtpCapabilities.recv.videoCodecs=Dt;const Ht=this.localCapabilities.send,en=this.rtpCapabilities.recv,Qt=OA(Pr.VIDEO,en,Ht,bt);return $t.forEach(on=>{const Tn=Qt.map(vn=>vn.payloadType.toString(10));Ut.debug("updateRemoteCodec mid: ".concat(on.attributes.mid,", from"),on.attributes.payloads,"to",Qt),on.attributes.payloads=Qt,on.media.fmts=Tn}),!0}createOrRecycleSendMedia(vt,Tt,bt,Ot,Mt){const Dt=this.rtpCapabilities.send.videoCodecs,jt=this._isUseLocalCodecs||Dt.length===0?this.localCapabilities.recv:this.rtpCapabilities.send,$t=vt===Pr.VIDEO?jt.videoCodecs:jt.audioCodecs,Ht=vt===Pr.VIDEO?jt.videoExtensions:jt.audioExtensions;this.currentMidIndex+=1;const en="".concat(this.currentMidIndex);let Qt={media:{mediaType:vt,port:Zw,protos:["UDP","TLS","RTP","SAVPF"],fmts:$t.map(Tn=>Tn.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:Ht,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:Tt,ssrcGroups:bt,rtcpFeedbackWildcards:[],payloads:$t,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:Ot,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(en)}};Qt=this.mungSendMediaDesc(Qt,Mt);const on=this.findFirstClosedMedia(vt);if(on){const Tn=this.sessionDesc.mediaDescriptions.indexOf(on);this.sessionDesc.mediaDescriptions[Tn]=Qt}else this.sessionDesc.mediaDescriptions.push(Qt);return Qt}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(vt=>vt.media.port!=="0").map(vt=>vt.attributes.mid)}mungRecvMediaDsec(vt,Tt,bt){const Ot=Ds(vt);return SM(Ot),kS(Ot,Tt),TM(Ot,Tt),zV(Ot),Ww(Ot,bt,this.localCapabilities.send),Ot}mungSendMediaDesc(vt,Tt){const bt=Ds(vt);return Ww(bt,Tt,this.localCapabilities.recv),US(bt),bt}updateRecvMedia(vt,Tt){const bt=this.sessionDesc.mediaDescriptions.findIndex(Ot=>Ot.attributes.mid===vt);if(bt!==-1){const Ot=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[bt],Tt);this.sessionDesc.mediaDescriptions[bt]=Ot}}bumpMid(vt){this.currentMidIndex+=vt}findFirstClosedMedia(vt){return this.sessionDesc.mediaDescriptions.find(Tt=>Gs()?Tt.media.port==="0"&&Tt.media.mediaType===vt:Tt.media.port==="0")}findPreloadMediaDesc(vt){return this.sessionDesc.mediaDescriptions.find(Tt=>{var bt;return((bt=Tt.attributes)===null||bt===void 0||(bt=bt.ssrcs[0])===null||bt===void 0?void 0:bt.ssrcId)===vt[0].ssrcId})}getSSRC(vt){var Tt;return(Tt=this.sessionDesc.mediaDescriptions.find(bt=>bt.attributes.mid===vt))===null||Tt===void 0?void 0:Tt.attributes.ssrcs}}(c_(c_({},rt),{},{localCapabilities:this.localCapabilities}),this.supportAV1RtpSpec,!(!rn("ENABLE_PRE_SUB_WITH_PRE_PC")||!rn("PRE_USE_LOCAL_CODECS"))&&BO(this.store)),rt.preallocation&&(this.isPreallocation=!0),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);const ut=this.remoteSDP.toString(),pt=XV(this.initialOffer.sdp,this.extension),mt=this.logSDPExchange(pt||"","offer","local","connect");this.store.descriptionStart(),await this.peerConnection.setLocalDescription({type:"offer",sdp:pt}),mt==null||mt(ut),await this.peerConnection.setRemoteDescription({type:"answer",sdp:ut});const _t=this.peerConnection.getTransceivers()[0];if(_t!=null&&_t.receiver&&this.tryBindTransportEvents(_t.receiver),BO(this.store))if(rt.preallocation&&rn("ENABLE_PRE_SUB_WITH_PRE_PC")){const vt=rn("PRE_SUB_NUM"),{mids:Tt,preSSRCs:bt}=this.remoteSDP.preloadRemoteMedia(vt);await dv(this.peerConnection,this.remoteSDP,this.extension),Ut.debug("[".concat(this.store.clientId,"] [P2PConnection] preload media, in pre pc,add preload ssrcs ").concat(bt)),this.presetMedia(Tt,bt)}else{const{preSSRCs:vt=[]}=rt,Tt=vt.map(Ot=>Ot.ssrcMsg[0].ssrcId);if(vt.length===0)return;const{mids:bt}=this.remoteSDP.batchSend(vt.map(Ot=>Object.assign({},Ot)));await dv(this.peerConnection,this.remoteSDP,this.extension),Ut.debug("[P2PConnection.connect] preload media, after join, add preload ssrcs ".concat(Tt)),this.presetMedia(bt,Tt)}}catch(ut){throw new Yn(tn.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(ut.toString()))}var it,ct}presetMedia(rt,it){rt.forEach((ct,ut)=>{this.peerConnection.getTransceivers().forEach(pt=>{if(pt.mid!=null&&ct===pt.mid&&pt.receiver.track){const mt=pt.receiver.track;let _t;mt.kind==="video"&&rn("ENABLE_PRE_RENDER")&&(_t=new JO({trackId:"track-".concat(mt.kind,"-unknown-").concat(this.store.clientId,"_").concat(ms(5,""))},!0),_t.updateVideoTrack(mt),_t.onFirstVideoFrameRender=()=>{var vt;const Tt=this.preMediaMap.get(it[ut]);Tt&&(Tt.firstVideoRender=Date.now()),(vt=this.onFirstVideoRender)===null||vt===void 0||vt.call(this,it[ut])},_t.play(this.store.sessionId||void 0)),this.preMediaMap.set(it[ut],{mid:ct,track:mt,player:_t,transceiver:pt})}}),this.store.peerReceiver()})}checkDtlsParameters(rt){return!!this.remoteSDP&&rt.length>0&&this.remoteSDP.updateRemoteDtlsParameters(rt)}async updateRemoteConnect(rt){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateRemoteConnect before remote SDP created");let it=!1;const{rtpCapabilities:ct}=rt;if([,it]=this.remoteSDP.updateRemoteRTPCapabilities(ct),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0){const mt=this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);it=it||mt}const{preSSRCs:ut=[]}=rt,pt=ut.map(mt=>mt.ssrcMsg[0].ssrcId);if(!this.remoteSDP.checkPreloadSsrcs(pt)){const mt=[],_t=[];if(Array.from(this.preMediaMap.entries()).every(vt=>{let[Tt,{mid:bt,player:Ot,track:Mt}]=vt;return mt.push(bt),_t.push(Tt),this.preMediaMap.delete(Tt),Ot&&Ot.destroy(),!0}),mt.length>0&&(this.remoteSDP.stopSending(mt),await dv(this.peerConnection,this.remoteSDP,this.extension),Ut.warn("[P2PConnection.updateRemoteConnect] preload media, failed, del preload ssrcs ".concat(_t)),Vr.reportApiInvoke(this.store.sessionId,{name:Ks.PRELOAD_MEDIA_FAILED,options:[ut,_t],tag:Ns.TRACER}).onSuccess()),ut.length>0){const{mids:vt}=this.remoteSDP.batchSend(ut.map(Tt=>Object.assign({},Tt)));await dv(this.peerConnection,this.remoteSDP,this.extension),Ut.debug("[P2PConnection.updateRemoteConnect] preload media, after join, add preload ssrcs ".concat(pt)),this.presetMedia(vt,pt)}}it?(await dv(this.peerConnection,this.remoteSDP,this.extension),Ut.debug("[P2PConnection] updateRemoteConnect by exchanging SDP.")):Ut.debug("[P2PConnection] updateRemoteConnect no need to exchange SDP, because no need to update remote codecs (use local codecs)")}catch(it){throw new Yn(tn.EXCHANGE_SDP_FAILED,"P2PConnection.updateRemoteConnect failed; ".concat(it.toString()))}}send(rt,it,ct){var ut=this;return Jp(function*(){const pt=yield Bo(ut.mutex.lock("From P2PConnection.send"));try{if(!ut.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const mt=[],_t=Hw();rt.forEach(Ht=>{const en=ut.peerConnection.addTransceiver(Ht._mediaStreamTrack,c_({direction:"sendonly"},Ht.trackMediaType==="video"&&ut.supportAV1RtpSpec&&_t?{sendEncodings:[{scalabilityMode:_t}]}:{}));mt.push(en),Ht._updateRtpTransceiver(en)}),Gs()&&rn("SIMULCAST")===!0&&(yield Bo(ut.applySimulcastForFirefox(mt,rt)));const vt=yield Bo(ut.peerConnection.createOffer()),Tt=ut.remoteSDP.predictReceivingMids(rt.length),bt=ut.mungSendOfferSDP(vt.sdp,rt,Tt),Ot=op(bt),Mt=Tt.map(Ht=>{const en=Ot.mediaDescriptions.find(Qt=>Qt.attributes.mid===Ht);if(!en)throw new Error("Cannot extract ssrc from mediaDescription.");return $V(en,rn("USE_PUB_RTX"))});let Dt;try{Dt=yield Mt}catch(Ht){Dt=[],ut.remoteSDP.receive(rt,it,ct,Dt);const en=ut.remoteSDP.toString();throw yield Bo(ut.peerConnection.setLocalDescription({type:"offer",sdp:bt})),yield Bo(ut.peerConnection.setRemoteDescription({type:"answer",sdp:en})),yield Bo(ut.stopSending(Tt,!0)),Ht}ut.remoteSDP.receive(rt,it,ct,Dt);const jt=ut.remoteSDP.toString(),$t=ut.logSDPExchange(bt,"offer","local","send");return yield Bo(ut.peerConnection.setLocalDescription({type:"offer",sdp:bt})),yield Bo(ut.applySimulcastEncodings(mt,rt)),yield Bo(ut.applySendEncodings(mt,rt)),$t==null||$t(jt),yield Bo(ut.peerConnection.setRemoteDescription({type:"answer",sdp:jt})),mt.map((Ht,en)=>{const Qt=Tt[en];return{localSSRC:Mt[en],id:Qt,transceiver:Ht}})}catch(mt){throw mt instanceof Yn?mt:new Yn(tn.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(mt.toString()))}finally{pt()}})()}async createDataChannels(rt,it){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.createDataChannels before remote SDP created");let ct=this.dataStreamChannelMap.get(rt);if(ct&&ct.readyState==="open")Ut.debug("[P2PConnection] Channels are already available and can be reused directly.");else{const pt=this.currentDataChannelId<1023?this.currentDataChannelId++:this.recoveredDataChannelIds.shift();if(typeof pt!="number")throw new Error("create DataChannel error, because cannot get dc id");ct=this.peerConnection.createDataChannel("datastream-channel",{id:pt,negotiated:!0,ordered:!1,maxRetransmits:rn("DATASTREAM_MAX_RETRANSMITS")}),ct.binaryType="arraybuffer",this.dataStreamChannelMap.set(rt,ct)}it.forEach(pt=>{pt._updateOriginDataChannel(ct)});const{needExchangeSDP:ut}=this.remoteSDP.sendDataChannel();if(ut){const pt=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:pt});const mt=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(mt),Ut.debug("[P2PConnection] createDataChannels by exchanging SDP.")}else Ut.debug("[P2PConnection] createDataChannels no need to exchange SDP.");return}catch(ct){throw ct instanceof Yn?ct:new Yn(tn.EXCHANGE_SDP_FAILED,"P2PConnection.createDataChannels failed; ".concat(ct.toString()))}}async stopDataChannels(rt){try{const it=this.dataStreamChannelMap.get(rt);return it&&(it.id&&this.recoveredDataChannelIds.push(it.id),it.close()),void this.dataStreamChannelMap.delete(rt)}catch(it){throw it instanceof Yn?it:new Yn(tn.DATACHANNEL_FAILED,"P2PConnection.stopDataChannels failed; ".concat(it.toString()))}}async stopSending(rt,it){const ct=it?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const ut=this.peerConnection.getTransceivers().filter(vt=>rt.indexOf(vt.mid)!==-1);if(ut.length!==rt.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");ut.map(vt=>{var Tt;n1(this.id+vt.mid,this),vt.direction="inactive",(Tt=vt.stop)===null||Tt===void 0||Tt.call(vt)});const pt=await this.peerConnection.createOffer(),mt=this.logSDPExchange(pt.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(pt),this.remoteSDP.stopReceiving(rt);const _t=this.remoteSDP.toString();mt==null||mt(_t),await this.peerConnection.setRemoteDescription({type:"answer",sdp:_t})}catch(ut){throw new Yn(tn.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(ut.toString()))}finally{ct&&ct()}}async receive(rt,it,ct,ut){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(rt," before remoteSDP created."));const{mid:pt,needExchangeSDP:mt}=this.remoteSDP.send(rt,it,ct,ut);mt&&(await dv(this.peerConnection,this.remoteSDP,this.extension),Ut.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(rt," by exchanging SDP.")));const _t=this.peerConnection.getTransceivers().find(vt=>vt.mid===pt);if(!_t)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:_t.receiver.track,id:pt,transceiver:_t}}catch(pt){throw new Yn(tn.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(pt.toString()))}}async batchReceive(rt){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const{mids:it,needExchangeSDP:ct}=this.remoteSDP.batchSend(rt);return ct&&(await dv(this.peerConnection,this.remoteSDP,this.extension),Ut.debug("[".concat(this.store.clientId,"] [P2PConnection] batchReceive by exchanging SDP."))),it.map(ut=>{const pt=this.peerConnection.getTransceivers().find(mt=>mt.mid===ut);if(!pt)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:pt.receiver.track,id:ut,transceiver:pt}})}catch(it){throw new Yn(tn.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(it.toString()))}}async stopReceiving(rt){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");rt.forEach(pt=>{Array.from(this.preMediaMap.entries()).some(mt=>{let[_t,{mid:vt,player:Tt}]=mt;if(vt===pt)return this.preMediaMap.delete(_t),Tt&&Tt.destroy(),!0})}),this.remoteSDP.stopSending(rt);const it=this.remoteSDP.toString(),ct=this.logSDPExchange(it,"offer","remote","stopReceiving");await this.peerConnection.setRemoteDescription({type:"offer",sdp:it});const ut=await this.peerConnection.createAnswer();ct==null||ct(ut.sdp||""),await this.peerConnection.setLocalDescription(ut)}catch(it){throw new Yn(tn.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(it.toString()))}}async muteRemote(rt){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteRemote mid=".concat(rt," before remote SDP created."));this.remoteSDP.mute(rt);const it=this.remoteSDP.toString(),ct=this.logSDPExchange(it,"offer","remote","muteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:it});const ut=await this.peerConnection.createAnswer();ct==null||ct(ut.sdp||""),await this.peerConnection.setLocalDescription(ut)}catch(it){throw new Yn(tn.EXCHANGE_SDP_FAILED,"P2PConnection.muteRemote failed; ".concat(it.toString()))}}async unmuteRemote(rt){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteRemote mid=".concat(rt," before remote SDP created."));this.remoteSDP.unmute(rt);const it=this.remoteSDP.toString(),ct=this.logSDPExchange(it,"offer","remote","unmuteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:it});const ut=await this.peerConnection.createAnswer();ct==null||ct(ut.sdp||""),await this.peerConnection.setLocalDescription(ut)}catch(it){throw new Yn(tn.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteRemote failed; ".concat(it.toString()))}}async muteLocal(rt){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const it=this.peerConnection.getTransceivers().filter(mt=>mt.mid&&rt.indexOf(mt.mid)!==-1);if(it.length!==rt.length)throw new Error("Transceivers' length doesn't match mids' length.");it.map(mt=>{mt.direction="inactive"});const ct=await this.peerConnection.createOffer(),ut=this.logSDPExchange(ct.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(ct),this.remoteSDP.muteRemote(rt);const pt=this.remoteSDP.toString();ut==null||ut(pt),await this.peerConnection.setRemoteDescription({type:"answer",sdp:pt})}catch(it){throw new Yn(tn.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(it.toString()))}}async unmuteLocal(rt){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const it=this.peerConnection.getTransceivers().filter(mt=>mt.mid&&rt.indexOf(mt.mid)!==-1);if(it.length!==rt.length)throw new Error("Transceivers' length doesn't match mids' length.");it.map(async(mt,_t)=>{mt.direction="sendonly"});const ct=await this.peerConnection.createOffer(),ut=this.logSDPExchange(ct.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(ct),this.remoteSDP.unmuteRemote(rt),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec(rt,this.remoteCodecs,this.store.codec);const pt=this.remoteSDP.toString();ut==null||ut(pt),await this.peerConnection.setRemoteDescription({type:"answer",sdp:pt})}catch(it){throw new Yn(tn.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(it.toString()))}}restartICE(rt){var it=this;return Jp(function*(){const ct=yield Bo(it.mutex.lock("From P2PConnection.restartICE"));try{if(!it.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");const ut=Fo().supportPCSetConfiguration,pt=rn("FORCE_TURN_TCP")||it.forceTurn;if(rt===hu.RELAY&&!ut)return;if(ut&&!pt){const Ot=rt===hu.RELAY?"relay":"all",Mt=it.peerConnection.getConfiguration();Mt.iceTransportPolicy!==Ot&&(Ut.debug("[".concat(it.store.clientId,"] restartICE change iceTransportPolicy from [").concat(Mt.iceTransportPolicy,"] to [").concat(Ot,"]")),Mt.iceTransportPolicy=Ot,it.peerConnection.setConfiguration(Mt))}it.remoteSDP.updateCandidates(rt);const mt=yield Bo(it.peerConnection.createOffer({iceRestart:!0}));if(!mt.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const _t=lv(mt.sdp),{remoteIceParameters:vt}=yield _t.iceParameters;it.remoteSDP.restartICE(vt);const Tt=it.remoteSDP.toString(),bt=it.logSDPExchange(mt.sdp||"","offer","local","restartICE");it.store.descriptionStart(),yield Bo(it.peerConnection.setLocalDescription(mt)),bt==null||bt(Tt),yield Bo(it.peerConnection.setRemoteDescription({type:"answer",sdp:Tt}))}catch(ut){Ut.warning("[".concat(it.store.clientId,"] restart ICE failed, abort operation"),ut)}finally{ct()}})()}async extendCandidate(){if(!this.remoteSDP||this.isFirstConnected)return;const rt=await this.mutex.lock("From P2PConnection.extendCandidate");try{this.remoteSDP.updateCandidates(hu.TCP_RELAY),await dv(this.peerConnection,this.remoteSDP,this.extension)}catch(it){Ut.warning("[".concat(this.store.clientId,"] extend candidate failed, abort operation"),it)}finally{rt()}}close(){var rt;this.peerConnection.getTransceivers().forEach(it=>{n1(this.id+it.mid,this)}),this.preMediaMap.forEach(it=>{let{player:ct}=it;ct&&ct.destroy()}),this.preMediaMap.clear(),this.peerConnection.close(),(rt=this.onConnectionStateChange)===null||rt===void 0||rt.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy(),this.dataStreamChannelMap.clear(),this.recoveredDataChannelIds=[],this.currentDataChannelId=1}getStats(){return c_(c_({},this.statsFilter.getStats()),{},{qualityLimitationReason:this.qualityLimitationReason})}getRemoteVideoIsReady(rt){return this.statsFilter.getVideoIsReady(rt)}async updateEncoderConfig(rt,it){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const ct=await this.peerConnection.createOffer(),ut=this.mungSendOfferSDP(ct.sdp,[it],[rt]);this.remoteSDP.updateRecvMedia(rt,it);const pt=this.remoteSDP.toString(),mt=this.logSDPExchange(ut,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:ut}),mt==null||mt(pt),await this.peerConnection.setRemoteDescription({type:"answer",sdp:pt})}catch(ct){throw new Yn(tn.EXCHANGE_SDP_FAILED,ct.toString())}}async updateSendParameters(rt,it){const ct=this.peerConnection.getTransceivers().filter(ut=>ut.mid===rt);ct.length===1&&(this.isVP8Simulcast(it)?Gs()||await this.applySimulcastEncodings(ct,[it]):await this.applySendEncodings(ct,[it]))}setStatsRemoteVideoIsReady(rt,it){this.statsFilter.setVideoIsReady2(rt,it)}async replaceTrack(rt,it){const ct=this.peerConnection.getTransceivers().find(ut=>ut.mid===it);ct&&await ct.sender.replaceTrack(rt._mediaStreamTrack)}async getSelectedCandidatePair(){const rt=this.peerConnection.getReceivers();if(rt.length>0&&rt[0].transport&&rt[0].transport.iceTransport&&rt[0].transport.iceTransport.getSelectedCandidatePair&&rt[0].transport.iceTransport.getSelectedCandidatePair()){const it=rt[0].transport.iceTransport,{local:ct,remote:ut}=it.getSelectedCandidatePair();return{local:c_(c_({},P_),{},{candidateType:ct.type,protocol:ct.protocol,address:ct.address,port:ct.port}),remote:c_(c_({},P_),{},{candidateType:ut.type,protocol:ut.protocol,address:ut.address,port:ut.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var rt;(rt=this.onICEConnectionStateChange)===null||rt===void 0||rt.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var rt;this.peerConnection.connectionState==="connected"&&(this.isFirstConnected=!0),(rt=this.onConnectionStateChange)===null||rt===void 0||rt.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidateerror=rt=>{if(rt&&(rt.errorCode||rt.errorText)){var it;const ct="code: ".concat(rt.errorCode,", message: ").concat(rt.errorText),ut=rt.port?"local: ".concat(rt.port):"",pt=R0(rt.url||"");Ut.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICECandidateError(").concat(ct,"), url: ").concat(pt||"",", host_candidate:").concat(ut)),(it=this.onICECandidateError)===null||it===void 0||it.call(this,ct)}},this.peerConnection.onicegatheringstatechange=rt=>{rt&&rt.target&&"iceGatheringState"in rt.target&&Ut.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] RTCPeerConnection.onicegatheringstatechange(").concat(rt.target.iceGatheringState,")"))},this.peerConnection.onicecandidate=rt=>{rt.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,Ut.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,Ut.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},rn("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(rt){const it={iceServers:[]},ct=rt.cloudProxyServer||"disabled";return rt.iceServers?it.iceServers=rt.iceServers:rt.turnServer&&(pA(rt.turnServer.servers)?it.iceServers=rt.turnServer.servers:rn("NEW_TURN_MODE")&&it.iceServers&&ct==="disabled"?(rn("USE_TURN_SERVER_OF_GATEWAY")?rt.turnServer.serversFromGateway&&it.iceServers.push(...V0.newTurnServerConfigToIceServers(rt.turnServer.serversFromGateway)):it.iceServers.push(...V0.newTurnServerConfigToIceServers(rt.turnServer.servers)),rn("NEW_FORCE_TURN")&&(it.iceTransportPolicy="relay")):rt.turnServer.mode!=="off"&&(it.iceServers&&it.iceServers.push(...V0.turnServerConfigToIceServers(rt.turnServer.servers)),rn("USE_TURN_SERVER_OF_GATEWAY")&&it.iceServers&&rt.turnServer.serversFromGateway&&it.iceServers.push(...V0.turnServerConfigToIceServers(rt.turnServer.serversFromGateway)),rn("FORCE_TURN_TCP")?it.iceTransportPolicy="relay":rt.turnServer.servers.concat(rt.turnServer.serversFromGateway||[]).forEach(ut=>{ut.forceturn&&(it.iceTransportPolicy="relay")}))),rn("ENABLE_ENCODED_TRANSFORM")&&Fo().supportWebRTCEncodedTransform&&(it.encodedInsertableStreams=!0),it}static turnServerConfigToIceServers(rt){const it=[];return rt.forEach(ct=>{ct.security?ct.tcpport&&it.push({username:ct.username,credential:ct.password,credentialType:"password",urls:"turns:".concat(av(ct.turnServerURL),":").concat(ct.tcpport,"?transport=tcp")}):(ct.udpport&&!rn("FORCE_TURN_TCP")&&it.push({username:ct.username,credential:ct.password,credentialType:"password",urls:"turn:".concat(ct.turnServerURL,":").concat(ct.udpport,"?transport=udp")}),ct.tcpport&&it.push({username:ct.username,credential:ct.password,credentialType:"password",urls:"turn:".concat(ct.turnServerURL,":").concat(ct.tcpport,"?transport=tcp")}))}),it}static newTurnServerConfigToIceServers(rt){const it=[];return rt.forEach(ct=>{const ut=rn("NEW_TURN_MODE");ut===1?it.push({username:ct.username,credential:ct.password,credentialType:"password",urls:"turn:".concat(ct.turnServerURL,":3478?transport=udp")}):ut===2?it.push({username:ct.username,credential:ct.password,credentialType:"password",urls:"turn:".concat(ct.turnServerURL,":3478?transport=tcp")}):ut===3?it.push({username:ct.username,credential:ct.password,credentialType:"password",urls:"turns:".concat(av(ct.turnServerURL),":443?transport=tcp")}):ut===4&&(it.push({username:ct.username,credential:ct.password,credentialType:"password",urls:"turn:".concat(ct.turnServerURL,":3478?transport=udp")}),it.push({username:ct.username,credential:ct.password,credentialType:"password",urls:"turn:".concat(ct.turnServerURL,":3478?transport=tcp")}),it.push({username:ct.username,credential:ct.password,credentialType:"password",urls:"turns:".concat(av(ct.turnServerURL),":443?transport=tcp")}))}),it}tryBindTransportEvents(rt){const it=rt.transport;if(it){this.transportEventReceiver=rt,it.onstatechange=()=>{var ut;it!=null&&it.state&&((ut=this.onDTLSTransportStateChange)===null||ut===void 0||ut.call(this,it.state))},it.onerror=ut=>{var pt;(pt=this.onDTLSTransportError)===null||pt===void 0||pt.call(this,"error"in ut?ut.error:ut)};const ct=it.iceTransport;ct&&(ct.onstatechange=()=>{const ut=it==null?void 0:it.iceTransport.state;var pt;ut&&((pt=this.onICETransportStateChange)===null||pt===void 0||pt.call(this,ut))},ct.getSelectedCandidatePair&&(ct.onselectedcandidatepairchange=()=>{if(ct.getSelectedCandidatePair()){const{local:ut,remote:pt}=ct.getSelectedCandidatePair()||{};if(ut&&pt){const mt=ut.address+":"+ut.port,_t=pt.address+":"+pt.port;Ut.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify(R0(mt)),", remote ").concat(JSON.stringify(R0(_t))))}}}))}}tryUnbindTransportEvents(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(rt,it){var ct,ut;if(it||(it=this.peerConnection.getSenders().find(Ht=>Ht.track===rt._mediaStreamTrack)),!it)return Ut.warn("[".concat(rt.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(rt))return Ut.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!Fo().supportSetRtpSenderParameters)return Ut.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const pt={},mt={};switch(rt._optimizationMode){case"motion":pt.degradationPreference="maintain-framerate";break;case"detail":pt.degradationPreference="maintain-resolution";break;case"balanced":pt.degradationPreference="balanced"}const _t=function($t,Ht){return $t.getTransceivers().find(en=>en.sender.track===Ht||en.receiver.track===Ht)}(this.peerConnection,rt._mediaStreamTrack),vt=BY(rt);if(function($t){var Ht;return!(!rn("ENABLE_AG_ADAPTATION")||!($t instanceof Rw||Er(Ht=$t._hints).call(Ht,ds.CUSTOM_TRACK))||!rn("FORCE_SUPPORT_AG_ADAPTATION")&&!(E3(14,0,!1)&&v3(17,4,!0)||_3(14)&&pO(17,4,!0)))}(rt)&&_t&&it&&vt&&this.getLocalVideoStats&&Er(ct=["vp8","vp9"]).call(ct,this.store.codec)){var Tt;const $t=pt.degradationPreference||(Er(Tt=rt._hints).call(Tt,ds.CUSTOM_TRACK)?rn("CUSTOM_ADAPTATION_DEFAULT_MODE"):"maintain-framerate");(function(Ht,en,Qt,on,Tn,vn){if(n1(Ht,Qt),Tn(en),on!=="balanced"&&on!=="maintain-framerate"&&on!=="maintain-resolution")return;let hn=-1;S4(Ht,en);const Ln=window.setInterval(()=>{const Qn=t1.get(Ht);if(!rn("ENABLE_AG_ADAPTATION")||!Qn)return n1(Ht,Qt),void Tn(en);const ur=vn();if(ur.sendPackets>0&&ur.OutgoingAvailableBandwidth>0){if(hn===-1)return void(hn=Date.now());if(Date.now()-hn<1e3)return;const go=ur.sendFrameRate,Eo=ur.OutgoingAvailableBandwidth,[no,Yo]=JX(Ht,go,Eo,Qn.adaptationConfig,en,on);Yo&&(Qt.qualityLimitationReason=Yo),no&&Qn.adaptationConfig.scale!==no.scale&&(Ut.debug("[".concat(Ht,"] applyAdaptation: ").concat(Qt.qualityLimitationReason,`
           sendFps `).concat(go,", bwe ").concat(Eo,", switch from ").concat(Qn.adaptationConfig.scale," to ").concat(no.scale," ")),Qn.adaptationConfig=kM(kM({},Qn.adaptationConfig),no),Tn(no))}},rn("CHECK_LOCAL_STATS_INTERVAL")),Xn=kM({},en);t1.set(Ht,{timer:Ln,adaptationConfig:Xn,originConfig:en,adaptationFunc:Tn}),Ut.debug("[".concat(Ht,"] start adaptation, originConfig: ").concat(JSON.stringify(en),", degradationPreference: ").concat(on))})(this.id+_t.mid,vt,this,$t,Ht=>{it&&this.updateAdaptation(it,Ht)},this.getLocalVideoStats.bind(this))}if(rt._encoderConfig){var bt;const{bitrateMax:$t,frameRate:Ht,scaleResolutionDownBy:en}=rt._encoderConfig;$t&&(mt.maxBitrate=1e3*$t),(Er(bt=rt._hints).call(bt,ds.LOW_STREAM)||rt.isUseScaleResolutionDownBy)&&(Ht&&(mt.maxFramerate=bp(Ht)),en&&en>=1&&(mt.scaleResolutionDownBy=en))}const{maxFramerate:Ot}=rn("ENCODER_CONFIG_LIMIT");if(Ot&&typeof Ot=="number"&&(mt.maxFramerate=mt.maxFramerate?Math.min(mt.maxFramerate,Ot):Ot),rn("DSCP_TYPE")&&hE()){var Mt;const $t=rn("DSCP_TYPE");Er(Mt=["very-low","low","medium","high"]).call(Mt,$t)&&(mt.networkPriority=$t)}const Dt=it.getParameters(),jt=(ut=Dt.encodings)===null||ut===void 0?void 0:ut[0];Gs()&&!jt&&(pt.encodings=[mt]),jt&&Object.assign(jt,mt),Object.assign(Dt,pt),Ut.debug("[".concat(rt.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(Dt.encodings))),await it.setParameters(Dt),await async function($t,Ht,en){try{var Qt;if(!Fo().supportSetRtpSenderParameters||!function(Ln){return Ln==="vp9"||Ln==="av1"}($t)||!rn("ENABLE_SVC"))return;const on={},Tn={},vn=Ht.getParameters(),hn=(Qt=vn.encodings)===null||Qt===void 0?void 0:Qt[0];Tn.scalabilityMode=Hw(en),hn&&Object.assign(hn,Tn),Object.assign(vn,on),await Ht.setParameters(vn),Ut.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode success: ".concat(JSON.stringify(vn.encodings)))}catch(on){Ut.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode failed",on)}}(this.store.codec,it,rn("SVC_MODE"))}async updateAdaptation(rt,it){var ct,ut;if(!rt)return Ut.debug("[updateAdaptation] no rtpSender found");if(!Fo().supportSetRtpSenderParameters)return Ut.debug("[updateAdaptation] Browser not support set rtp-sender parameters");const pt={},{bitrateMax:mt,frameRate:_t,scaleResolutionDownBy:vt}=it;mt&&(pt.maxBitrate=1e3*mt),_t&&(pt.maxFramerate=bp(_t)),vt&&vt>=1&&Er(ct=["vp8","vp9"]).call(ct,this.store.codec)&&(pt.scaleResolutionDownBy=vt);const Tt=rt.getParameters(),bt=(ut=Tt.encodings)===null||ut===void 0?void 0:ut[0];bt&&Object.assign(bt,pt),Object.assign(Tt,{});try{await rt.setParameters(Tt),Ut.debug("[updateAdaptation] updateRtpSenderEncodings: ".concat(JSON.stringify(Tt.encodings)))}catch(Ot){!("transport"in rt)||rt.transport&&rt.transport.state==="connected"?this.peerConnectionState!=="connected"?Ut.debug("[updateAdaptation] peerConnection not connected}"):Ut.debug("[updateAdaptation] updateRtpSenderEncodings failed",Ot):Ut.debug("[updateAdaptation] rtpSender transport not connected}")}}async applySendEncodings(rt,it){try{if(!Fo().supportSetRtpSenderParameters||rt.length!==it.length)return;for(let ct=0;ct<rt.length;ct++){const ut=rt[ct],pt=it[ct];pt instanceof Cs&&!this.isVP8Simulcast(pt)&&await this.updateRtpSenderEncodings(pt,ut.sender)}}catch{Ut.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(rt,it,ct){const ut=op(rt);return it.forEach((pt,mt)=>{const _t=ct[mt],vt=ut.mediaDescriptions.find(Tt=>Tt.attributes.mid===_t);vt&&(kS(vt,pt),WV(vt,pt,this.store.codec))}),rv(ut)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=rt=>{var it;(it=this.onFirstAudioReceived)===null||it===void 0||it.call(this,rt)},this.statsFilter.onFirstVideoReceived=rt=>{var it;(it=this.onFirstVideoReceived)===null||it===void 0||it.call(this,rt)},this.statsFilter.onFirstAudioDecoded=rt=>{var it;(it=this.onFirstAudioDecoded)===null||it===void 0||it.call(this,rt)},this.statsFilter.onFirstVideoDecoded=(rt,it,ct)=>{var ut;(ut=this.onFirstVideoDecoded)===null||ut===void 0||ut.call(this,rt,it,ct)},this.statsFilter.onSelectedLocalCandidateChanged=(rt,it)=>{var ct;(ct=this.onSelectedLocalCandidateChanged)===null||ct===void 0||ct.call(this,rt,it)},this.statsFilter.onSelectedRemoteCandidateChanged=(rt,it)=>{var ct;(ct=this.onSelectedRemoteCandidateChanged)===null||ct===void 0||ct.call(this,rt,it)},this.statsFilter.onFirstVideoDecodedTimeout=rt=>{var it;(it=this.onFirstVideoDecodedTimeout)===null||it===void 0||it.call(this,rt)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(rt,it){if(rt.length===it.length)for(let vt=0;vt<rt.length;vt++){var ct,ut,pt,mt,_t;const Tt=rt[vt],bt=it[vt];if(bt instanceof Cs&&!Er(ct=bt._hints).call(ct,ds.LOW_STREAM)&&(ut=bt._encoderConfig)!==null&&ut!==void 0&&ut.bitrateMax&&((pt=bt._encoderConfig)===null||pt===void 0?void 0:pt.bitrateMax)>200&&(mt=bt._scalabilityMode)!==null&&mt!==void 0&&mt.numSpatialLayers&&((_t=bt._scalabilityMode)===null||_t===void 0?void 0:_t.numSpatialLayers)>1&&this.store.codec==="vp8"){const Ot={},Mt={high:1e3*(bt._encoderConfig.bitrateMax-50),medium:5e4};Ot.encodings=[{rid:"m",active:!0,maxBitrate:Mt.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:Mt.high}];const Dt=Tt.sender.getParameters();await Tt.sender.setParameters(Object.assign(Dt,Ot))}}}async applySimulcastEncodings(rt,it){if(!Gs()&&rt.length===it.length)for(let ct=0;ct<rt.length;ct++){const ut=it[ct];if(ut instanceof Cs&&this.isVP8Simulcast(ut)){const pt=rt[ct],mt={},_t={high:1e3*(ut._encoderConfig.bitrateMax-50),medium:5e4};mt.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:_t.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:_t.medium,scaleResolutionDownBy:4}];const vt=pt.sender.getParameters();await pt.sender.setParameters(Object.assign(vt,mt))}}}isVP8Simulcast(rt){var it,ct,ut,pt,mt;return!!(rt instanceof Cs&&rn("SIMULCAST")&&this.store.codec==="vp8"&&!Er(it=rt._hints).call(it,ds.LOW_STREAM)&&(ct=rt._encoderConfig)!==null&&ct!==void 0&&ct.bitrateMax&&((ut=rt._encoderConfig)===null||ut===void 0?void 0:ut.bitrateMax)>200&&(pt=rt._scalabilityMode)!==null&&pt!==void 0&&pt.numSpatialLayers&&((mt=rt._scalabilityMode)===null||mt===void 0?void 0:mt.numSpatialLayers)>1)}logSDPExchange(rt,it,ct,ut){if(rn("SDP_LOGGING"))return Ut.upload("[".concat(this.store.clientId,"] exchanging ").concat(ct," ").concat(it," SDP during P2PConnection.").concat(ut,`
`),rt),it==="offer"?pt=>{this.logSDPExchange(pt,"answer",ct==="local"?"remote":"local",ut)}:void 0}async getRemoteSSRC(rt){if(!this.remoteSDP)return;const it=this.remoteSDP.getSSRC(rt);return it&&it.length!==0?it[0].ssrcId:void 0}setConfiguration(rt){if(Fo().supportPCSetConfiguration){const it=V0.resolvePCConfiguration(rt);this.peerConnection.setConfiguration(it)}rt.isPreallocation&&(this.isPreallocation=!0)}},Br(Do.prototype,"updateRemoteRTPCapabilities",[Ju],Object.getOwnPropertyDescriptor(Do.prototype,"updateRemoteRTPCapabilities"),Do.prototype),Br(Do.prototype,"connect",[Ju],Object.getOwnPropertyDescriptor(Do.prototype,"connect"),Do.prototype),Br(Do.prototype,"updateRemoteConnect",[Ju],Object.getOwnPropertyDescriptor(Do.prototype,"updateRemoteConnect"),Do.prototype),Br(Do.prototype,"createDataChannels",[Ju],Object.getOwnPropertyDescriptor(Do.prototype,"createDataChannels"),Do.prototype),Br(Do.prototype,"receive",[Ju],Object.getOwnPropertyDescriptor(Do.prototype,"receive"),Do.prototype),Br(Do.prototype,"batchReceive",[Ju],Object.getOwnPropertyDescriptor(Do.prototype,"batchReceive"),Do.prototype),Br(Do.prototype,"stopReceiving",[Ju],Object.getOwnPropertyDescriptor(Do.prototype,"stopReceiving"),Do.prototype),Br(Do.prototype,"muteRemote",[Ju],Object.getOwnPropertyDescriptor(Do.prototype,"muteRemote"),Do.prototype),Br(Do.prototype,"unmuteRemote",[Ju],Object.getOwnPropertyDescriptor(Do.prototype,"unmuteRemote"),Do.prototype),Br(Do.prototype,"muteLocal",[Ju],Object.getOwnPropertyDescriptor(Do.prototype,"muteLocal"),Do.prototype),Br(Do.prototype,"unmuteLocal",[Ju],Object.getOwnPropertyDescriptor(Do.prototype,"unmuteLocal"),Do.prototype),Br(Do.prototype,"close",[Ju],Object.getOwnPropertyDescriptor(Do.prototype,"close"),Do.prototype),Br(Do.prototype,"updateEncoderConfig",[Ju],Object.getOwnPropertyDescriptor(Do.prototype,"updateEncoderConfig"),Do.prototype),Br(Do.prototype,"updateSendParameters",[Ju],Object.getOwnPropertyDescriptor(Do.prototype,"updateSendParameters"),Do.prototype),Br(Do.prototype,"replaceTrack",[Ju],Object.getOwnPropertyDescriptor(Do.prototype,"replaceTrack"),Do.prototype),Br(Do.prototype,"updateAdaptation",[Ju],Object.getOwnPropertyDescriptor(Do.prototype,"updateAdaptation"),Do.prototype),Br(Do.prototype,"getRemoteSSRC",[Ju],Object.getOwnPropertyDescriptor(Do.prototype,"getRemoteSSRC"),Do.prototype),Do);function Ju(_e,rt,it){const ct=_e[rt];if(typeof ct!="function")throw new Error("Cannot use mutex on object property.");return it.value=async function(){const ut=this.mutex,pt=await ut.lock("From P2PConnection.".concat(rt));try{for(var mt=arguments.length,_t=new Array(mt),vt=0;vt<mt;vt++)_t[vt]=arguments[vt];return await ct.apply(this,_t)}finally{pt()}},it}function VM(_e,rt){let it=document.createElement("video"),ct=document.createElement("canvas");it.setAttribute("style","display:none"),ct.setAttribute("style","display:none"),it.setAttribute("muted",""),it.muted=!0,it.setAttribute("autoplay",""),it.autoplay=!0,it.setAttribute("playsinline",""),ct.width=bp(rt.width),ct.height=bp(rt.height);const ut=bp(rt.framerate||15);document.body.append(it),document.body.append(ct);let pt=_e._mediaStreamTrack;it.srcObject=new MediaStream([pt]),it.play();const mt=ct.getContext("2d");if(!mt)throw new $n(tn.UNEXPECTED_ERROR,"can not get canvas context");const _t=Fo(),vt=ct.captureStream(_t.supportRequestFrame?0:ut).getVideoTracks()[0];vt.canvas||(vt.canvas=ct),ct.startCapture=()=>{if(!it)return ct.stopCapture&&ct.stopCapture();if(it.paused&&it.play(),it.videoHeight>2&&it.videoWidth>2){const bt=it.videoWidth,Ot=it.videoHeight/bt,Mt=ct.width*Ot;Math.abs(Mt-ct.height)>=2&&(Ut.debug("adjust low stream resolution","".concat(ct.width,"x").concat(ct.height," -> ").concat(ct.width,"x").concat(Mt)),ct.height=Mt)}mt.drawImage(it,0,0,ct.width,ct.height),vt.requestFrame&&vt.requestFrame(),pt!==_e._mediaStreamTrack&&(pt=_e._mediaStreamTrack,it.srcObject=new MediaStream([pt]))},ct.stopCapture=zO(()=>ct.startCapture&&ct.startCapture(),ut);const Tt=vt.stop;return vt.stop=()=>{Tt.call(vt),it&&(it.remove(),it.srcObject=null,it=null),ct&&(ct.width=0,ct.remove(),ct.stopCapture&&ct.stopCapture(),ct.startCapture=void 0,ct.stopCapture=void 0,ct=null),Ut.debug("clean low stream renderer")},vt}var R4=function(_e){return _e[_e.Video_Send_Type=190]="Video_Send_Type",_e}(R4||{}),l_=function(_e){return _e[_e.Video_Send_Qp_Sum=2143]="Video_Send_Qp_Sum",_e[_e.Video_Send_Freeze=2082]="Video_Send_Freeze",_e[_e.Video_Recv_Qp_Sum=2144]="Video_Recv_Qp_Sum",_e[_e.Video_Recv_Freeze=2084]="Video_Recv_Freeze",_e[_e.Video_Render_Freeze_Time=2109]="Video_Render_Freeze_Time",_e[_e.Video_Render_Freeze_Time_Render=2147]="Video_Render_Freeze_Time_Render",_e[_e.Video_Render_Freeze_Time_Render2=2223]="Video_Render_Freeze_Time_Render2",_e[_e.Audio_Recv_Freeze=2083]="Audio_Recv_Freeze",_e}(l_||{}),lo=function(_e){return _e[_e.Video_Send_Retransmit=2062]="Video_Send_Retransmit",_e[_e.Video_Send_Target_Encoded=2064]="Video_Send_Target_Encoded",_e[_e.Video_Send_Actual_Encoded=2060]="Video_Send_Actual_Encoded",_e[_e.Video_Send_Transmit=2066]="Video_Send_Transmit",_e[_e.Video_Send_Bandwidth=2061]="Video_Send_Bandwidth",_e[_e.Video_Capture_Height=2033]="Video_Capture_Height",_e[_e.Video_Capture_Width=2035]="Video_Capture_Width",_e[_e.Video_Capture_Frame_Rate=2034]="Video_Capture_Frame_Rate",_e[_e.Video_Send_Low_Height=2073]="Video_Send_Low_Height",_e[_e.Video_Send_Low_Frame_Rate=2075]="Video_Send_Low_Frame_Rate",_e[_e.Video_Send_Low_Width=2077]="Video_Send_Low_Width",_e[_e.Video_Send_Low_Bitrate=2069]="Video_Send_Low_Bitrate",_e[_e.Video_Send_Low_Package_Lost=2070]="Video_Send_Low_Package_Lost",_e[_e.Video_Send_Low_Package_Rate=2071]="Video_Send_Low_Package_Rate",_e[_e.Video_Send_Frame_Rate=2002]="Video_Send_Frame_Rate",_e[_e.Video_Send_Width=2003]="Video_Send_Width",_e[_e.Video_Send_Height=2004]="Video_Send_Height",_e[_e.Video_Send_Disabled=2095]="Video_Send_Disabled",_e[_e.Video_Send_Adaptation=2032]="Video_Send_Adaptation",_e[_e.Video_Send_Player_Status=2128]="Video_Send_Player_Status",_e[_e.Video_Send_Nacks=2009]="Video_Send_Nacks",_e[_e.Video_Send_Plis=2010]="Video_Send_Plis",_e[_e.Video_Send_Firs=2011]="Video_Send_Firs",_e[_e.Video_Send_Avg_Encode=2007]="Video_Send_Avg_Encode",_e[_e.Video_Send_Huge_Frame_Sent=2174]="Video_Send_Huge_Frame_Sent",_e[_e.Video_Send_Bytes_Retransmit=2173]="Video_Send_Bytes_Retransmit",_e[_e.Video_Send_Packages_Retransmit=2172]="Video_Send_Packages_Retransmit",_e[_e.Video_Send_Key_Frames_Encoded=2207]="Video_Send_Key_Frames_Encoded",_e[_e.Video_Send_Bitrate=2012]="Video_Send_Bitrate",_e[_e.Video_Send_Package_Rate=2031]="Video_Send_Package_Rate",_e[_e.Video_Send_Package_Lost=2005]="Video_Send_Package_Lost",_e[_e.Audio_Capture_PCM_Level=2104]="Audio_Capture_PCM_Level",_e[_e.Audio_Send_Level=2038]="Audio_Send_Level",_e[_e.Audio_Send_Bitrate=2039]="Audio_Send_Bitrate",_e[_e.Audio_Send_Package_Rate=2040]="Audio_Send_Package_Rate",_e[_e.Audio_Send_AEC_Return_Loss=2041]="Audio_Send_AEC_Return_Loss",_e[_e.Audio_Send_AEC_Return_Loss_Enhancement=2042]="Audio_Send_AEC_Return_Loss_Enhancement",_e[_e.Audio_Send_Freeze=2081]="Audio_Send_Freeze",_e[_e.Audio_Send_Disabled=2096]="Audio_Send_Disabled",_e[_e.Audio_Send_Bytes_Retransmit=2179]="Audio_Send_Bytes_Retransmit",_e[_e.Audio_Send_Packages_Retransmit=2180]="Audio_Send_Packages_Retransmit",_e[_e.Video_Recv_Height=2019]="Video_Recv_Height",_e[_e.Video_Recv_Width=2018]="Video_Recv_Width",_e[_e.Video_Recv_Frame_Rate_Output=2155]="Video_Recv_Frame_Rate_Output",_e[_e.Video_Recv_Jitter_Buffer=2023]="Video_Recv_Jitter_Buffer",_e[_e.Video_Recv_Current_Delay=2024]="Video_Recv_Current_Delay",_e[_e.Video_Recv_Nacks=2026]="Video_Recv_Nacks",_e[_e.Video_Recv_Plis=2027]="Video_Recv_Plis",_e[_e.Video_Recv_Firs=2028]="Video_Recv_Firs",_e[_e.Video_Recv_Disabled=2101]="Video_Recv_Disabled",_e[_e.Video_Recv_Player_Status=2129]="Video_Recv_Player_Status",_e[_e.Video_Recv_I_Frame_Delay=2149]="Video_Recv_I_Frame_Delay",_e[_e.Video_Render_Frame_Rate_Render=2022]="Video_Render_Frame_Rate_Render",_e[_e.Video_Render_Freeze_Duration=2156]="Video_Render_Freeze_Duration",_e[_e.Audio_Render_Level=2043]="Audio_Render_Level",_e[_e.Audio_Render_Freeze_Time_80ms=2226]="Audio_Render_Freeze_Time_80ms",_e[_e.Audio_Render_Freeze_Time_200ms=2227]="Audio_Render_Freeze_Time_200ms",_e[_e.Audio_Render_Freeze_Samples_80ms=2228]="Audio_Render_Freeze_Samples_80ms",_e[_e.Audio_Render_Freeze_Samples_200ms=2229]="Audio_Render_Freeze_Samples_200ms",_e[_e.Audio_Recv_PCM_Level=2105]="Audio_Recv_PCM_Level",_e[_e.Audio_Recv_Disabled=2102]="Audio_Recv_Disabled",_e[_e.Audio_Recv_Jitter_Buffer=2054]="Audio_Recv_Jitter_Buffer",_e[_e.Audio_Recv_Current_Delay=2047]="Audio_Recv_Current_Delay",_e[_e.Audio_Recv_Player_Status=2130]="Audio_Recv_Player_Status",_e[_e.Audio_Recv_Bitrate=2044]="Audio_Recv_Bitrate",_e[_e.Audio_Recv_Concealed_Samples=2148]="Audio_Recv_Concealed_Samples",_e[_e.Audio_Recv_Total_Samples_Received=2224]="Audio_Recv_Total_Samples_Received",_e}(lo||{}),Yl=function(_e){return _e[_e.Video_Render_Frame_Rate_Decode=2021]="Video_Render_Frame_Rate_Decode",_e[_e.Video_Recv_Frame_Rate=2020]="Video_Recv_Frame_Rate",_e[_e.Video_Recv_Frame_Dropped=2181]="Video_Recv_Frame_Dropped",_e[_e.Video_Recv_Bytes_Retransmit=2175]="Video_Recv_Bytes_Retransmit",_e[_e.Video_Recv_Packages_Retransmit=2176]="Video_Recv_Packages_Retransmit",_e[_e.Video_Recv_Packages_Discarded=2198]="Video_Recv_Packages_Discarded",_e[_e.Video_Recv_Avg_Decode=2200]="Video_Recv_Avg_Decode",_e[_e.Video_Recv_Avg_Processing_Delay=2202]="Video_Recv_Avg_Processing_Delay",_e[_e.Video_Recv_Avg_Assembly_Time=2203]="Video_Recv_Avg_Assembly_Time",_e[_e.Video_Recv_Avg_Inter_Frame_Delay=2204]="Video_Recv_Avg_Inter_Frame_Delay",_e[_e.Video_Recv_Key_Frames_Decoded=2206]="Video_Recv_Key_Frames_Decoded",_e[_e.Video_Recv_Package_Lost=2014]="Video_Recv_Package_Lost",_e[_e.Video_Recv_Bitrate=2029]="Video_Recv_Bitrate",_e[_e.Video_Recv_Package_Rate=2078]="Video_Recv_Package_Rate",_e[_e.Audio_Recv_Jitter=2055]="Audio_Recv_Jitter",_e[_e.Audio_Recv_Bytes_Retransmit=2178]="Audio_Recv_Bytes_Retransmit",_e[_e.Audio_Recv_Packages_Retransmit=2177]="Audio_Recv_Packages_Retransmit",_e[_e.Audio_Recv_Packages_Discarded=2199]="Audio_Recv_Packages_Discarded",_e[_e.Audio_Recv_Avg_Processing_Delay=2201]="Audio_Recv_Avg_Processing_Delay",_e[_e.Audio_Recv_Package_Rate=2046]="Audio_Recv_Package_Rate",_e[_e.Audio_Recv_Package_Lost=2045]="Audio_Recv_Package_Lost",_e}(Yl||{}),Zu=function(_e){return _e[_e.RTT=2006]="RTT",_e[_e.CONN_TYPE=801]="CONN_TYPE",_e[_e.STATS_UPDATE_INTERVAL=2205]="STATS_UPDATE_INTERVAL",_e}(Zu||{}),i1=function(_e){return _e[_e.RTC_PEER_CONNECTION_STATE=2219]="RTC_PEER_CONNECTION_STATE",_e}(i1||{});const I0=1e3,o1=6,DA=3,eq=Math.max(o1,DA,60);function qr(_e,rt,it){it!=null&&Number.isFinite(it)&&(_e[rt]=Math.round(Math.max(0,it)))}function w4(_e){const rt={[Zu.CONN_TYPE]:0,[Zu.RTT]:_e.rtt,[Zu.STATS_UPDATE_INTERVAL]:_e.updateInterval?Math.round(Math.max(0,_e.updateInterval)):void 0};switch(_e.selectedCandidatePair.localCandidate.candidateType){case"relay":{const it=_e.selectedCandidatePair.localCandidate.relayProtocol;it==="udp"&&(rt[Zu.CONN_TYPE]=1),it==="tcp"&&(rt[Zu.CONN_TYPE]=3),it==="tls"&&(rt[Zu.CONN_TYPE]=4);break}case"srflx":rt[Zu.CONN_TYPE]=2;break;case"unknown":rt[Zu.CONN_TYPE]=5;break;default:rt[Zu.CONN_TYPE]=0}return rt}function I4(_e){let rt=0;switch(_e){case"none":rt=0;break;case"cpu":rt=1;break;case"bandwidth":rt=2;break;case"other":rt=3}return rt}class x4 extends Fs{constructor(rt){super(),Jt(this,"store",void 0),Jt(this,"uploadWRTCStatsTimer",void 0),Jt(this,"uploadOutboundDenoiserStatsTimer",void 0),Jt(this,"uploadExtStatsTimer",void 0),Jt(this,"uploadExtUsageStatsTimer",void 0),Jt(this,"uploadInboundExtStatsTimer",void 0),Jt(this,"requestStats",void 0),Jt(this,"requestTransportStats",void 0),Jt(this,"requestLocalMedia",void 0),Jt(this,"requestRemoteMedia",void 0),Jt(this,"requestAllTracks",void 0),Jt(this,"requestVideoIsReady",void 0),Jt(this,"requestUploadStats",void 0),Jt(this,"requestUpload",void 0),Jt(this,"uploadOutboundStarted",!1),Jt(this,"uploadInboundStarted",!1),Jt(this,"uploadTransportStarted",!1),Jt(this,"uploadBaseStatsStarted",!1),Jt(this,"uploadExtensionUsageStarted",!1),Jt(this,"lastRecvStats",void 0),Jt(this,"lastSendStats",void 0),Jt(this,"lastRefRecvStats",void 0),Jt(this,"lastRefSendStats",void 0),Jt(this,"lastNormalRecvStats",void 0),Jt(this,"lastNormalSendStats",void 0),Jt(this,"lastExtendStats",{}),Jt(this,"needUploadStats",{}),Jt(this,"needUploadRenderFreezeTime",!0),Jt(this,"lastUploadCompensateTime",-1),Jt(this,"uploadCompensateDeltaTime",0),this.store=rt}uploadWRTCStats(rt){if(!this.requestStats||!this.requestUploadStats)return;const it=rt%DA==0,ct=rt%o1==0,ut=rt%60==0;let pt,mt;if(this.uploadTransportStarted&&(pt=this.requestStats(),this.store.useP2P&&(mt=this.requestStats(!0))),!pt&&this.uploadOutboundStarted&&(pt=this.requestStats()),!mt&&this.uploadInboundStarted&&(mt=this.requestStats(!0)),pt||mt){var _t;const vt={};if(this.uploadTransportStarted&&pt){const bt=this.getTransportStats(pt,mt,it);bt&&(vt.misc=[bt])}if(this.uploadOutboundStarted&&pt){const bt=this.getOutboundStats(pt,ct?this.lastNormalSendStats:void 0,it?this.lastRefSendStats:void 0,this.lastSendStats,ut);bt&&(vt.outbound=[bt])}if(this.uploadInboundStarted&&mt){this.uploadCompensateStats(rt);const bt=this.getInboundStats(mt,ct?this.lastNormalRecvStats:void 0,it?this.lastRefRecvStats:void 0,this.lastRecvStats);bt&&(vt.inbound=bt)}const Tt=(_t=this.requestTransportStats)===null||_t===void 0?void 0:_t.call(this).connectState;Tt&&(Array.isArray(vt.misc)?vt.misc[0]&&vt.misc[0].addition&&(vt.misc[0].addition[i1.RTC_PEER_CONNECTION_STATE]=xO[Tt]):vt.misc=[{addition:{[i1.RTC_PEER_CONNECTION_STATE]:xO[Tt]}}]),this.needUploadStats.sendType&&(Array.isArray(vt.outbound)&&vt.outbound[0]&&vt.outbound[0].high&&(vt.outbound[0].high[R4.Video_Send_Type]=this.needUploadStats.sendType),this.needUploadStats.sendType=void 0),this.requestUploadStats(vt)}this.lastRecvStats=mt,this.lastSendStats=pt,ct&&(this.lastNormalRecvStats=mt,this.lastNormalSendStats=pt),it&&(this.lastRefRecvStats=mt,this.lastRefSendStats=pt)}startUploadWRTCStats(){if(this.uploadWRTCStatsTimer)return;this.uploadBaseStatsStarted=!0;let rt=1;this.uploadWRTCStatsTimer=window.setInterval(()=>{if(!this.uploadTransportStarted&&!this.uploadInboundStarted&&!this.uploadOutboundStarted){if(this.uploadBaseStatsStarted){var it,ct;const ut=(it=this.requestTransportStats)===null||it===void 0?void 0:it.call(this);return void(ut&&((ct=this.requestUploadStats)===null||ct===void 0||ct.call(this,{misc:[{addition:{[i1.RTC_PEER_CONNECTION_STATE]:xO[ut.connectState]}}]})))}return this.stopUploadWRTCStats()}this.uploadWRTCStats(rt),++rt===eq+1&&(rt=1)},I0)}uploadCompensateStats(rt){if(!this.requestStats||!this.requestUploadStats||!this.requestRemoteMedia)return;const it=rt%DA==0&&this.needUploadRenderFreezeTime;if(!this.uploadInboundStarted||!it)return;if(this.lastUploadCompensateTime===-1)return void(this.lastUploadCompensateTime=Date.now());const ct=Math.max(-6e3,Date.now()-this.lastUploadCompensateTime-6e3);if(this.uploadCompensateDeltaTime+=ct,this.lastUploadCompensateTime=Date.now(),this.uploadCompensateDeltaTime<6e3)return;const ut=Math.min(Math.floor(this.uploadCompensateDeltaTime/6e3),10);this.uploadCompensateDeltaTime-=6e3*ut;const pt=this.requestStats(!0);new Array(ut).fill(0).forEach(()=>{if(!this.requestStats||!this.requestUploadStats||!this.requestRemoteMedia)return;const mt={};if(this.uploadInboundStarted&&pt){const _t=this.requestRemoteMedia()||[],vt=[];_t.forEach(Tt=>{let[bt,Ot]=Tt;const Mt={peer:bt.uid};if(bt._videoSSRC&&this.requestVideoIsReady&&this.requestVideoIsReady(bt._videoSSRC)&&Ot.has(Pr.VIDEO)&&bt.videoTrack){const Dt=function(jt,$t,Ht){if(!$t.videoRecv.find(Qt=>Qt.ssrc===jt))return;const en={};if(Ht&&Ht._player){const Qt=Ht._player,{renderFreezeAccTime2:on,videoElementStatus:Tn}=Qt;if(L_.visibility==="visible"&&Tn===uu.PLAYING&&Fo().supportRequestVideoFrameCallback){const vn=Math.min(6e3,on);Qt.renderFreezeAccTime2=Math.max(0,on-vn),qr(en,l_.Video_Render_Freeze_Time_Render2,vn),rn("USE_NEW_RENDER_FREEZE_TIME")&&qr(en,l_.Video_Render_Freeze_Time_Render,vn)}}return en}(bt._videoSSRC,pt,bt.videoTrack);Dt&&(Mt.video=Dt)}Mt.video&&vt.push(Mt)}),vt.length>0&&(mt.inbound=vt,this.requestUploadStats(mt))}})}stopUploadWRTCStats(){window.clearInterval(this.uploadWRTCStatsTimer),this.uploadWRTCStatsTimer=void 0,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0),this.lastRefSendStats&&(this.lastRefSendStats.videoSend=[],this.lastRefSendStats.audioSend=[],this.lastRefSendStats=void 0),this.lastRefRecvStats&&(this.lastRefRecvStats.videoRecv=[],this.lastRefRecvStats.audioRecv=[],this.lastRefRecvStats=void 0),this.lastNormalSendStats&&(this.lastNormalSendStats.videoSend=[],this.lastNormalSendStats.audioSend=[],this.lastNormalSendStats=void 0),this.lastNormalRecvStats&&(this.lastNormalRecvStats.videoRecv=[],this.lastNormalRecvStats.audioRecv=[],this.lastNormalRecvStats=void 0),this.lastExtendStats={},this.needUploadStats={},this.lastUploadCompensateTime=-1,this.uploadCompensateDeltaTime=0,this.needUploadRenderFreezeTime=!0}getTransportStats(rt,it,ct){if(!this.requestStats)return;if(!ct)return rt.rtt==null?void 0:{addition:{[Zu.RTT]:rt.rtt,[Zu.CONN_TYPE]:void 0,[Zu.STATS_UPDATE_INTERVAL]:rt.updateInterval||void 0}};const ut=w4(rt);if(this.store.useP2P){if(it){const pt=w4(it);ut[Zu.CONN_TYPE]+=pt[Zu.CONN_TYPE]<<3}ut[Zu.CONN_TYPE]+=110}else ut[Zu.CONN_TYPE]+=100;return{addition:ut}}getOutboundStats(rt,it,ct,ut,pt){if(!this.requestUploadStats||!this.requestLocalMedia)return;const mt=this.requestLocalMedia();if(!mt||mt.length===0)return;let _t,vt,Tt;return mt.forEach(bt=>{let[Ot,{track:Mt,ssrcs:Dt}]=bt;switch(Ot){case or.LocalVideoLowTrack:case or.LocalVideoTrack:if(Ot===or.LocalVideoTrack){var jt;const $t=function(on,Tn,vn,hn,Ln,Xn){const Qn=Tn.videoSend.find(no=>no.ssrc===on);if(!Qn)return;const ur={},{sentFrame:go,inputFrame:Eo}=Qn;if(hn&&(qr(ur,l_.Video_Send_Qp_Sum,Qn.qpSumPerFrame),Eo&&go)){const no=Eo.frameRate,Yo=go.frameRate;ur[l_.Video_Send_Freeze]=function(jo,fu){let Jn=!0;return Jn=!(jo<=5)&&(jo<=10?fu<3:jo<=20?fu<4:fu<5),Jn}(no,Yo)?1:0}if(Ln){switch(go&&(qr(ur,lo.Video_Send_Height,go.height),qr(ur,lo.Video_Send_Width,go.width),qr(ur,lo.Video_Send_Frame_Rate,go.frameRate)),ur[lo.Video_Send_Disabled]=vn._originMediaStreamTrack&&!vn._originMediaStreamTrack.enabled||vn._mediaStreamTrack&&!vn._mediaStreamTrack.enabled?1:0,Qn.adaptionChangeReason){case"none":ur[lo.Video_Send_Adaptation]=0;break;case"cpu":ur[lo.Video_Send_Adaptation]=1;break;case"bandwidth":ur[lo.Video_Send_Adaptation]=2;break;case"other":ur[lo.Video_Send_Adaptation]=3}let no=0;Qn.adaptionChangeReason&&(no+=I4(Qn.adaptionChangeReason)),Tn.qualityLimitationReason&&(no+=I4(Tn.qualityLimitationReason)<<3),ur[lo.Video_Send_Adaptation]=no,ur[lo.Video_Send_Player_Status]=HO[vn._player?vn._player.videoElementStatus:"uninit"],qr(ur,lo.Video_Send_Nacks,Qn.nacksCount),qr(ur,lo.Video_Send_Plis,Qn.plisCount),qr(ur,lo.Video_Send_Firs,Qn.firsCount),qr(ur,lo.Video_Send_Avg_Encode,Qn.avgEncodeMs),qr(ur,lo.Video_Send_Huge_Frame_Sent,Qn.hugeFramesSent),qr(ur,lo.Video_Send_Bytes_Retransmit,Qn.retransmittedBytesSent),qr(ur,lo.Video_Send_Packages_Retransmit,Qn.retransmittedPacketsSent),qr(ur,lo.Video_Send_Key_Frames_Encoded,Qn.keyFramesEncoded);const Yo=Ln.videoSend.find(jo=>jo.ssrc===on);if(Yo){let jo=I0*DA;Yo.timestamp&&Qn.timestamp&&(jo=Qn.timestamp-Yo.timestamp),Yo.packets!=null&&Qn.packets!=null&&qr(ur,lo.Video_Send_Package_Rate,1e3*(Qn.packets-Yo.packets)/jo),Qn.packetsLost!=null&&Yo.packetsLost!=null&&qr(ur,lo.Video_Send_Package_Lost,Qn.packetsLost-Yo.packetsLost),Yo.bytes!=null&&Qn.bytes!=null&&qr(ur,lo.Video_Send_Bitrate,8*(Qn.bytes-Yo.bytes)/jo)}}return ur}(Dt[0].ssrcId,rt,Mt,it,ct),Ht=Mt.__className__==="CameraVideoTrack"?3:Er(jt=Mt._hints).call(jt,ds.SCREEN_TRACK)?7:10;(this.lastExtendStats.sendType!==Ht||pt)&&(this.needUploadStats={sendType:Ht},this.lastExtendStats.sendType=Ht);const en=Mt&&function(on,Tn,vn,hn){const Ln=Tn.videoSend.find(Qn=>Qn.ssrc===on);if(!Ln)return null;const Xn={};if(hn){const Qn=Ln.inputFrame,ur=Qn&&Qn.height||vn.videoHeight||0,go=Qn&&Qn.width||vn.videoWidth||0,Eo=Qn&&Qn.frameRate||0;qr(Xn,lo.Video_Capture_Height,ur),qr(Xn,lo.Video_Capture_Width,go),qr(Xn,lo.Video_Capture_Frame_Rate,Eo)}return Xn}(Dt[0].ssrcId,rt,Mt,!!ct),Qt=function(on,Tn){const vn={};return Tn&&(qr(vn,lo.Video_Send_Retransmit,on.bitrate.retransmit),qr(vn,lo.Video_Send_Target_Encoded,on.bitrate.targetEncoded),qr(vn,lo.Video_Send_Actual_Encoded,on.bitrate.actualEncoded),qr(vn,lo.Video_Send_Transmit,on.bitrate.transmit),qr(vn,lo.Video_Send_Bandwidth,on.sendBandwidth)),vn}(rt,!!ct);vt=Object.assign({},$t,en,Qt)}else Tt=function($t,Ht,en,Qt,on){const Tn=Ht.videoSend.find(hn=>hn.ssrc===$t);if(!Tn)return;const vn={};if(Qt){const hn=Tn.sentFrame;hn&&(qr(vn,lo.Video_Send_Low_Height,hn.height),qr(vn,lo.Video_Send_Low_Width,hn.width),qr(vn,lo.Video_Send_Low_Frame_Rate,hn.frameRate));const Ln=Qt.videoSend.find(Xn=>Xn.ssrc===$t);if(Ln){let Xn=I0*o1;Ln.timestamp&&Tn.timestamp&&(Xn=Tn.timestamp-Ln.timestamp),Ln.packets!=null&&Tn.packets!=null&&qr(vn,lo.Video_Send_Low_Package_Rate,1e3*(Tn.packets-Ln.packets)/Xn),Tn.packetsLost!=null&&Ln.packetsLost!=null&&qr(vn,lo.Video_Send_Low_Package_Lost,Tn.packetsLost-Ln.packetsLost),Ln.bytes!=null&&Tn.bytes!=null&&qr(vn,lo.Video_Send_Low_Bitrate,8*(Tn.bytes-Ln.bytes)/Xn)}}return vn}(Dt[0].ssrcId,rt,0,ct);break;case or.LocalAudioTrack:_t=Mt&&function($t,Ht,en,Qt,on,Tn){const vn=Ht.audioSend.find(Ln=>Ln.ssrc===$t);if(!vn)return;const hn={};if(on){hn[lo.Audio_Send_Disabled]=en._originMediaStreamTrack&&!en._originMediaStreamTrack.enabled||en._mediaStreamTrack&&!en._mediaStreamTrack.enabled?1:0;const Ln=100*en._source.getAccurateVolumeLevel(),Xn=vn.inputLevel;if(Xn!=null){const ur=Math.ceil(50*Math.log10(100*Xn+1));qr(hn,lo.Audio_Send_Level,ur)}qr(hn,lo.Audio_Capture_PCM_Level,Ln),qr(hn,lo.Audio_Send_AEC_Return_Loss,vn.aecReturnLoss),qr(hn,lo.Audio_Send_AEC_Return_Loss_Enhancement,vn.aecReturnLossEnhancement),qr(hn,lo.Audio_Send_Bytes_Retransmit,vn.retransmittedBytesSent),qr(hn,lo.Audio_Send_Packages_Retransmit,vn.retransmittedPacketsSent),hn[lo.Audio_Send_Freeze]=0;const Qn=on.audioSend.find(ur=>ur.ssrc===$t);if(Qn){let ur=I0*o1;Qn.timestamp&&vn.timestamp&&(ur=vn.timestamp-Qn.timestamp),Qn.bytes!=null&&vn.bytes!=null&&qr(hn,lo.Audio_Send_Bitrate,8*(vn.bytes-Qn.bytes)/ur),Qn.packets!=null&&vn.packets!=null&&qr(hn,lo.Audio_Send_Package_Rate,1e3*(vn.packets-Qn.packets)/ur)}}return hn}(Dt[0].ssrcId,rt,Mt,0,ct)}}),{high:vt,low:Tt,audio:_t}}getInboundStats(rt,it,ct,ut){if(!this.requestRemoteMedia)return;const pt=this.requestRemoteMedia()||[],mt=[];return pt.forEach(_t=>{let[vt,Tt]=_t;const bt={peer:vt.uid};if(Tt.has(Pr.VIDEO)&&vt.videoTrack){const Ot=vt._videoSSRC&&this.requestVideoIsReady&&this.requestVideoIsReady(vt._videoSSRC)||!1,Mt=vt.videoTrack?function(Dt,jt,$t,Ht,en,Qt,on,Tn){const vn=jt.videoRecv.find(no=>no.ssrc===Dt);if(!vn)return;const hn={},{receivedFrame:Ln,outputFrame:Xn,decodeFrameRate:Qn}=vn;qr(hn,Yl.Video_Render_Frame_Rate_Decode,Qn),vn.framesRateFirefox&&qr(hn,Yl.Video_Recv_Frame_Rate,vn.framesRateFirefox),Ln&&qr(hn,Yl.Video_Recv_Frame_Rate,Ln.frameRate),qr(hn,Yl.Video_Recv_Frame_Dropped,vn.framesDroppedCount),qr(hn,Yl.Video_Recv_Bytes_Retransmit,vn.retransmittedBytesReceived),qr(hn,Yl.Video_Recv_Packages_Retransmit,vn.retransmittedPacketsReceived),qr(hn,Yl.Video_Recv_Packages_Discarded,vn.packetsDiscarded),qr(hn,Yl.Video_Recv_Avg_Decode,vn.avgDecodeMs),qr(hn,Yl.Video_Recv_Avg_Processing_Delay,vn.avgProcessingDelayMs),qr(hn,Yl.Video_Recv_Avg_Assembly_Time,vn.avgFramesAssembledFromMultiplePacketsMs),qr(hn,Yl.Video_Recv_Avg_Inter_Frame_Delay,vn.avgInterFrameDelayMs),qr(hn,Yl.Video_Recv_Key_Frames_Decoded,vn.keyFramesDecoded);const ur=Tn&&Tn.videoRecv.find(no=>no.ssrc===Dt);if(ur){const no=jt.timestamp-Tn.timestamp||I0;vn.packetsLost!=null&&ur.packetsLost!=null&&qr(hn,Yl.Video_Recv_Package_Lost,vn.packetsLost-ur.packetsLost),ur.bytes!=null&&vn.bytes!=null&&qr(hn,Yl.Video_Recv_Bitrate,8*(vn.bytes-ur.bytes)/no),ur.packets!=null&&vn.packets!=null&&qr(hn,Yl.Video_Recv_Package_Rate,1e3*(vn.packets-ur.packets)/no)}const go=Qt&&Qt.videoRecv.find(no=>no.ssrc===Dt);if(go&&(qr(hn,l_.Video_Recv_Qp_Sum,vn.qpSumPerFrame),hn[l_.Video_Recv_Freeze]=Ht&&NA.isRemoteVideoFreeze($t,vn,go)?1:0),on){var Eo;const no=on.videoRecv.find(jo=>jo.ssrc===Dt);Ln?(qr(hn,lo.Video_Recv_Height,Ln.height),qr(hn,lo.Video_Recv_Width,Ln.width)):$t&&(qr(hn,lo.Video_Recv_Height,$t._videoHeight||0),qr(hn,lo.Video_Recv_Width,$t._videoWidth||0)),Xn&&qr(hn,lo.Video_Recv_Frame_Rate_Output,Xn.frameRate);const Yo=(Eo=$t._player)===null||Eo===void 0?void 0:Eo.rendFrameRate.toFixed(0);if(Yo&&qr(hn,lo.Video_Render_Frame_Rate_Render,+Yo),qr(hn,lo.Video_Recv_Jitter_Buffer,vn.jitterBufferMs),qr(hn,lo.Video_Recv_Current_Delay,vn.currentDelayMs),qr(hn,lo.Video_Recv_Firs,vn.firsCount),qr(hn,lo.Video_Recv_Nacks,vn.nacksCount),qr(hn,lo.Video_Recv_Plis,vn.plisCount),$t){hn[lo.Video_Recv_Disabled]=$t._originMediaStreamTrack.enabled&&$t._mediaStreamTrack.enabled?0:1;const jo=$t._player;if(jo){const{freezeTimeCounterList:fu,renderFreezeAccTime:Jn,renderFreezeAccTime2:_r,videoElementStatus:Dr}=jo;if(fu&&fu.length>0&&qr(hn,l_.Video_Render_Freeze_Time,fu.splice(0,1)[0]),en&&L_.visibility==="visible"&&Dr===uu.PLAYING&&Fo().supportRequestVideoFrameCallback){const nr=Math.min(6e3,_r);jo.renderFreezeAccTime2=Math.max(0,_r-nr),qr(hn,l_.Video_Render_Freeze_Time_Render2,nr);const Gt=Math.min(6e3,Jn);jo.renderFreezeAccTime=Math.max(0,Jn-Gt),qr(hn,l_.Video_Render_Freeze_Time_Render,rn("USE_NEW_RENDER_FREEZE_TIME")?nr:Gt)}if(typeof vn.totalFreezesDuration=="number"){const nr=no&&no.totalFreezesDuration?vn.totalFreezesDuration-no.totalFreezesDuration:vn.totalFreezesDuration;qr(hn,lo.Video_Render_Freeze_Duration,1e3*nr)}}}if(hn[lo.Video_Recv_Player_Status]=HO[$t._player?$t._player.videoElementStatus:"uninit"],no&&vn.totalInterFrameDelay!==void 0&&vn.totalSquaredInterFrameDelay!==void 0&&no.totalInterFrameDelay!==void 0&&no.totalSquaredInterFrameDelay!==void 0){const jo=vn.totalInterFrameDelay-no.totalInterFrameDelay,fu=vn.totalSquaredInterFrameDelay-no.totalSquaredInterFrameDelay,Jn=vn.framesDecodeCount-no.framesDecodeCount,_r=jo/Jn*1e3,Dr=Math.round(1e3*Math.sqrt((fu-Math.pow(jo,2)/Jn)/Jn));!isNaN(Dr)&&_r+Dr>Math.max(3*_r,_r+150)&&(hn[lo.Video_Recv_I_Frame_Delay]=Dr)}}return hn}(vt._videoSSRC,rt,vt.videoTrack,Ot===!0,this.needUploadRenderFreezeTime,it,ct,ut):void 0;Mt&&(bt.video=Mt)}if(Tt.has(Pr.AUDIO)&&vt.audioTrack){const Ot=vt.audioTrack?function(Mt,Dt,jt,$t,Ht,en){const Qt=Dt.audioRecv.find(hn=>hn.ssrc===Mt);if(!Qt)return;const on={};qr(on,Yl.Audio_Recv_Jitter,Qt.jitterMs),qr(on,Yl.Audio_Recv_Bytes_Retransmit,Qt.retransmittedBytesReceived),qr(on,Yl.Audio_Recv_Packages_Retransmit,Qt.retransmittedPacketsReceived),qr(on,Yl.Audio_Recv_Packages_Discarded,Qt.packetsDiscarded),qr(on,Yl.Audio_Recv_Avg_Processing_Delay,Qt.avgProcessingDelayMs);const Tn=en&&en.audioRecv.find(hn=>hn.ssrc===Mt);if(Tn){const hn=I0;Qt.packets!=null&&Tn.packets!=null&&qr(on,Yl.Audio_Recv_Package_Rate,1e3*(Qt.packets-Tn.packets)/hn),Qt.packetsLost!=null&&Tn.packetsLost!=null&&qr(on,Yl.Audio_Recv_Package_Lost,Qt.packetsLost-Tn.packetsLost)}if($t){const{receivedFrames:hn,droppedFrames:Ln}=Qt;hn!=null&&Ln!=null&&(on[l_.Audio_Recv_Freeze]=(vn=hn)===0||100*Ln/vn>20?1:0)}var vn;if(Ht){const hn=100*jt._source.getAccurateVolumeLevel(),Ln=Qt.outputLevel;if(Ln!=null){const Qn=Math.ceil(50*Math.log10(100*Ln+1));qr(on,lo.Audio_Render_Level,Qn)}qr(on,lo.Audio_Recv_PCM_Level,hn),jt&&(on[lo.Audio_Recv_Disabled]=jt._originMediaStreamTrack.enabled&&jt._mediaStreamTrack.enabled?0:1),qr(on,lo.Audio_Recv_Jitter_Buffer,Qt.jitterBufferMs),qr(on,lo.Audio_Recv_Current_Delay,Qt.jitterBufferMs),on[lo.Audio_Recv_Player_Status]=HO[qu.getPlayerState(jt.getTrackId())];const Xn=Ht.audioRecv.find(Qn=>Qn.ssrc===Mt);if(Xn){Xn.bytes!=null&&Qt.bytes!=null&&qr(on,lo.Audio_Recv_Bitrate,8*(Qt.bytes-Xn.bytes)/(I0*DA));const Qn=Qt.concealedSamples-Xn.concealedSamples;Qn>0&&qr(on,lo.Audio_Recv_Concealed_Samples,Qn);const ur=Qt.totalSamplesReceived-Xn.totalSamplesReceived;ur>0&&qr(on,lo.Audio_Recv_Total_Samples_Received,ur);const go=Qt.freezeSamples80-Xn.freezeSamples80;go>0&&qr(on,lo.Audio_Render_Freeze_Samples_80ms,go);const Eo=Qt.freezeSamples200-Xn.freezeSamples200;Eo>0&&qr(on,lo.Audio_Render_Freeze_Samples_200ms,Eo);const no=Qt.freezeMs80-Xn.freezeMs80;qr(on,lo.Audio_Render_Freeze_Time_80ms,no<0?0:no);const Yo=Qt.freezeMs200-Xn.freezeMs200;qr(on,lo.Audio_Render_Freeze_Time_200ms,Yo<0?0:Yo)}}return on}(vt._audioSSRC,rt,vt.audioTrack,it,ct,ut):void 0;Ot&&(bt.audio=Ot)}(bt.video||bt.audio)&&mt.push(bt)}),this.needUploadRenderFreezeTime=!this.needUploadRenderFreezeTime,mt}startUploadTransportStats(){this.uploadTransportStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats()}stopUploadTransportStats(){this.uploadTransportStarted=!1}startUploadOutboundStats(){this.uploadOutboundStarted||(this.uploadOutboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=window.setInterval(()=>{if(!this.requestAllTracks||!this.requestUpload)return;const rt=(this.requestAllTracks()||[]).find(it=>it instanceof SA);if(rt&&rt._external.getDenoiserStats){const it=rt._external.getDenoiserStats();it&&this.requestUpload(AA.DENOISER_STATS,it)}},2e3),this.uploadExtStatsTimer&&window.clearInterval(this.uploadExtStatsTimer),this.uploadExtStatsTimer=window.setInterval(()=>{!this.requestAllTracks||!this.requestUpload||this.requestAllTracks().forEach(rt=>{rt.getProcessorStats().forEach(it=>{this.requestUpload&&this.requestUpload(it.type,it.stats)})})},2e3))}stopUploadOutboundStats(){this.uploadOutboundStarted&&(this.uploadOutboundStarted=!1,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.lastRefSendStats&&(this.lastRefSendStats.videoSend=[],this.lastRefSendStats.audioSend=[],this.lastRefSendStats=void 0),this.lastNormalSendStats&&(this.lastNormalSendStats.videoSend=[],this.lastNormalSendStats.audioSend=[],this.lastNormalSendStats=void 0),this.lastExtendStats={},this.needUploadStats={},this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=void 0,this.uploadExtStatsTimer&&window.clearInterval(this.uploadExtStatsTimer),this.uploadExtStatsTimer=void 0)}startUploadInboundStats(){this.uploadInboundStarted||(this.uploadInboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadInboundExtStatsTimer&&window.clearInterval(this.uploadInboundExtStatsTimer),this.uploadInboundExtStatsTimer=window.setInterval(()=>{!this.requestUpload||!this.requestRemoteMedia||(this.requestRemoteMedia()||[]).forEach(rt=>{let[it,ct]=rt;ct.has(Pr.VIDEO)&&it.videoTrack&&it.videoTrack.getProcessorStats().forEach(ut=>{this.requestUpload&&this.requestUpload(ut.type,ut.stats)}),ct.has(Pr.AUDIO)&&it.audioTrack&&it.audioTrack.getProcessorStats().forEach(ut=>{this.requestUpload&&this.requestUpload(ut.type,ut.stats)})})},2e3))}stopUploadInboundStats(){this.uploadInboundStarted&&(this.uploadInboundStarted=!1,this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0),this.lastRefRecvStats&&(this.lastRefRecvStats.videoRecv=[],this.lastRefRecvStats.audioRecv=[],this.lastRefRecvStats=void 0),this.lastNormalRecvStats&&(this.lastNormalRecvStats.videoRecv=[],this.lastNormalRecvStats.audioRecv=[],this.lastNormalRecvStats=void 0),this.lastUploadCompensateTime=-1,this.uploadCompensateDeltaTime=0,this.needUploadRenderFreezeTime=!0,this.uploadInboundExtStatsTimer&&window.clearInterval(this.uploadInboundExtStatsTimer),this.uploadInboundExtStatsTimer=void 0)}startUploadExtensionUsageStats(){if(this.uploadExtensionUsageStarted)return;this.uploadExtensionUsageStarted=!0,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer);const rt=new Map;this.uploadExtUsageStatsTimer=window.setInterval(async()=>{const it=Date.now(),ct={connectionInterval:rn("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3,details:[],lts:it};let ut=[];const pt=this.requestAllTracks&&this.requestAllTracks()||[];for(const Tt of pt)!Tt.muted&&Tt.enabled&&(ut=ut.concat(await Tt.getProcessorUsage()));const mt=this.requestRemoteMedia&&this.requestRemoteMedia()||[];for(const[Tt,bt]of mt)bt.has(Pr.VIDEO)&&Tt.videoTrack&&(ut=ut.concat(await Tt.videoTrack.getProcessorUsage())),bt.has(Pr.AUDIO)&&Tt.audioTrack&&(ut=ut.concat(await Tt.audioTrack.getProcessorUsage()));if(ut.length===0)return;ct.details=function(Tt,bt){const Ot={};for(const{id:$t,value:Ht,level:en,direction:Qt}of Tt){var Mt;const on=(Mt=bt.get($t))!==null&&Mt!==void 0?Mt:0,Tn=Ht===2?on+rn("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3:on;var Dt,jt;bt.set($t,Tn),Ot[$t]?(Ht===2&&(Ot[$t].value=Ht),en>Ot[$t].level&&(Ot[$t].level=en),Qt==="remote"&&(Ot[$t].remoteUidCount+=1),Ot[$t].totalTs=(Dt=bt.get($t))!==null&&Dt!==void 0?Dt:0):Ot[$t]={value:Ht,level:en,remoteUidCount:Qt==="local"?0:1,totalTs:(jt=bt.get($t))!==null&&jt!==void 0?jt:0}}return Object.keys(Ot).map($t=>{const{level:Ht,value:en,totalTs:Qt}=Ot[$t];return{id:$t,level:Ht,value:en,totalTs:Qt}})}(ut,rt);const _t=Date.now(),vt=_t>it?_t:it+1;this.requestUpload&&this.requestUpload(AA.EXTENSION_USAGE_STATS,{usageStats:ct,sendTs:vt})},rn("EXTENSION_USAGE_UPLOAD_INTERVAL"))}stopUploadExtensionUsageStats(){this.uploadExtensionUsageStarted&&(this.uploadExtensionUsageStarted=!1,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer),this.uploadExtUsageStatsTimer=void 0)}stopUploadBaseStats(){this.uploadBaseStatsStarted=!1}}const tq=rn("ICE_RESTART_INTERVAL");let s1=new Map,GS=new Map,fv=[hu.UDP_TCP_RELAY,hu.TCP_RELAY,hu.RELAY],GM=rn("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&Fo().supportPCSetConfiguration;function O4(_e){let rt=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const it=s1.get(_e.id);it&&(window.clearTimeout(it),s1.delete(_e.id));const ct=GS.get(_e.id);rt&&ct&&ct.index===fv.length-1&&(Ut.debug("[".concat(_e.id,"] reset ICE restart policy")),GS.delete(_e.id))}function M4(_e,rt,it){if(s1.size===0&&GS.size===0&&(Array.isArray(rn("RESTART_SEQUENCE"))&&rn("RESTART_SEQUENCE").length>0&&!function(_t,vt){if(_t.length!==vt.length)return!1;for(let Tt=0;Tt<_t.length;Tt+=1){const bt=_t[Tt];if(_t.filter(Ot=>Ot===bt).length!==vt.filter(Ot=>Ot===bt).length)return!1}return!0}(fv,rn("RESTART_SEQUENCE"))&&(fv=rn("RESTART_SEQUENCE").filter(_t=>{var vt;if(Er(vt=Object.values(hu)).call(vt,_t))return!0}),Ut.debug("use reconnection policy from config distribution, queues: ".concat(fv.join(" => ")))),GM=rn("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&Fo().supportPCSetConfiguration),fv.length===0)return void it();let ct,{index:ut=0,type:pt}=GS.get(_e.id)||{};if(GM&&pt===hu.RELAY)return void it();let mt=pt&&ut>=fv.length-1;if(GM)pt=hu.RELAY;else{if(mt)return void it();pt?(ut++,pt=fv[ut]):(pt=fv[0],ut=0)}Ut.debug("[".concat(_e.id,"] choose ICE restart policy: ").concat(pt,", index: ").concat(ut)),rt(pt),GS.set(_e.id,{index:ut,type:pt}),ct=window.setTimeout(()=>M4(_e,rt,it),tq),s1.set(_e.id,ct)}var Co;function P4(_e,rt){var it=Object.keys(_e);if(Object.getOwnPropertySymbols){var ct=Object.getOwnPropertySymbols(_e);rt&&(ct=ct.filter(function(ut){return Object.getOwnPropertyDescriptor(_e,ut).enumerable})),it.push.apply(it,ct)}return it}function F_(_e){for(var rt=1;rt<arguments.length;rt++){var it=arguments[rt]!=null?arguments[rt]:{};rt%2?P4(Object(it),!0).forEach(function(ct){Jt(_e,ct,it[ct])}):Object.getOwnPropertyDescriptors?Object.defineProperties(_e,Object.getOwnPropertyDescriptors(it)):P4(Object(it)).forEach(function(ct){Object.defineProperty(_e,ct,Object.getOwnPropertyDescriptor(it,ct))})}return _e}function N4(_e){var rt,it,ct,ut=2;for(typeof Symbol<"u"&&(it=tO,ct=Symbol.iterator);ut--;){if(it&&(rt=_e[it])!=null)return rt.call(_e);if(ct&&(rt=_e[ct])!=null)return new a1(rt.call(_e));it="@@asyncIterator",ct="@@iterator"}throw new TypeError("Object is not async iterable")}function a1(_e){function rt(it){if(Object(it)!==it)return Ir.reject(new TypeError(it+" is not an object."));var ct=it.done;return Ir.resolve(it.value).then(function(ut){return{value:ut,done:ct}})}return a1=function(it){this.s=it,this.n=it.next},a1.prototype={s:null,n:null,next:function(){return rt(this.n.apply(this.s,arguments))},return:function(it){var ct=this.s.return;return ct===void 0?Ir.resolve({value:it,done:!0}):rt(ct.apply(this.s,arguments))},throw:function(it){var ct=this.s.return;return ct===void 0?Ir.reject(it):rt(ct.apply(this.s,arguments))}},new a1(_e)}let LA=(Co=class extends Fs{get state(){return this._state}set state(_e){const rt=this._state;this._state=_e,this.emit(jr.StateChange,rt,this._state)}constructor(_e,rt){super(),Jt(this,"isPlanB",void 0),Jt(this,"store",void 0),Jt(this,"statsUploader",void 0),Jt(this,"connection",void 0),Jt(this,"localTrackMap",new Map),Jt(this,"remoteUserMap",new Map),Jt(this,"localDataChannels",[]),Jt(this,"remoteDataChannelMap",new Map),Jt(this,"pendingLocalTracks",[]),Jt(this,"pendingRemoteTracks",[]),Jt(this,"pendingLocalDataChannels",[]),Jt(this,"pendingRemoteDataChannels",[]),Jt(this,"statsCollector",void 0),Jt(this,"shouldForwardP2PCreation",void 0),Jt(this,"iceFailedCount",0),Jt(this,"dtlsFailedCount",0),Jt(this,"mutex",void 0),Jt(this,"_state",qo.Disconnected),Jt(this,"_pcStatsUploadType",rn("NEW_ICE_RESTART")?mE.FIRST_CONNECTION:mE.OLD_FIRST_CONNECTION),Jt(this,"_isStartRestartIce",!1),Jt(this,"_restartTimer",void 0),Jt(this,"_isTryConnecting",!1),Jt(this,"_iceError",null),Jt(this,"_forceTurn",!1),Jt(this,"_isWaitPcToRePub",!1),Jt(this,"handleMuteLocalTrack",async(it,ct,ut)=>{const pt=await this.mutex.lock("Locking from P2PChannel.handleMuteLocalTrack");try{if(!this.connection||this.state!==qo.Connected)return void ut(new Yn(tn.INVALID_OPERATION,"Cannot call P2PChannel.handleMuteLocalTrack before connection established."));const mt=this.filterTobeMutedTracks(it);if(mt.length===0)return void ct();const _t=mt.find(Tt=>Tt[0]==="videoLowTrack");if(_t){const Tt=_t[1];this.store.enableInstantMuteRestore?(Tt.track._originMediaStreamTrack.enabled=!1,Ut.info("[".concat(this.store.clientId,"] P2PChannel muteLocalLowTrack without close sender because enableInstantMuteRestore is true"))):Tt.track._originMediaStreamTrack.stop()}this.store.enableInstantMuteRestore?Ut.info("[".concat(this.store.clientId,"] P2PChannel muteLocalTrack without close sender because enableInstantMuteRestore is true")):await this.connection.muteLocal(mt.map(Tt=>{let[,{id:bt}]=Tt;return bt}));const vt=this.createMuteMessage(mt);await ps(this,jr.RequestMuteLocal,vt),ct()}catch(mt){ut(mt)}finally{pt()}}),Jt(this,"handleUnmuteLocalTrack",async(it,ct,ut)=>{const pt=await this.mutex.lock("Locking from P2PChannel.handleUnmuteLocalTrack");try{if(!this.connection||this.state!==qo.Connected)return void ut(new Yn(tn.INVALID_OPERATION,"Cannot call P2PChannel.handleUnmuteLocalTrack before connection established."));const mt=this.filterTobeUnmutedTracks(it);if(mt.length===0)return void ct();const _t=mt.find(Tt=>Tt[0]==="videoLowTrack");if(_t){const Tt=_t[1];if(this.store.enableInstantMuteRestore)Tt.track._originMediaStreamTrack.enabled=!0,Ut.info("[".concat(this.store.clientId,"] P2PChannel unmuteLocalLowTrack without close sender because enableInstantMuteRestore is true"));else{if(Tt.track._originMediaStreamTrack.stop(),!rn("DISABLE_DUAL_STREAM_USE_ENCODING")&&Fo().supportDualStreamEncoding){const bt=it._mediaStreamTrack.clone();Tt.track._mediaStreamTrack=bt,Tt.track._originMediaStreamTrack=bt}else{const bt=VM(it,fA(this,jr.RequestLowStreamParameter));Tt.track._mediaStreamTrack=bt,Tt.track._originMediaStreamTrack=bt}await new Ir((bt,Ot)=>{this.handleReplaceTrack(Tt.track,bt,Ot,!0)})}}this.store.enableInstantMuteRestore?Ut.info("[".concat(this.store.clientId,"] P2PChannel unmuteLocalTrack without close sender because enableInstantMuteRestore is true")):await this.connection.unmuteLocal(mt.map(Tt=>{let[,{id:bt}]=Tt;return bt}));const vt=this.createUnmuteMessage(mt);await ps(this,jr.RequestUnmuteLocal,vt),ct()}catch(mt){ut(mt)}finally{pt()}}),Jt(this,"handleUpdateVideoEncoder",async(it,ct,ut,pt)=>{let mt;pt||(mt=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoEncoder"));try{const vt=this.localTrackMap.get(or.LocalVideoTrack);if(!this.connection||!vt||vt.track!==it||this.state!==qo.Connected)return void ct();const{id:Tt,track:bt}=vt;await this.connection.updateSendParameters(Tt,bt),await this.connection.updateEncoderConfig(Tt,bt),this.emit(jr.UpdateVideoEncoder,bt),ct()}catch(vt){ut(vt)}finally{var _t;(_t=mt)===null||_t===void 0||_t()}}),Jt(this,"handleUpdateVideoSendParameters",async(it,ct,ut)=>{const pt=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoSendParameters");try{const mt=this.localTrackMap.get(or.LocalVideoTrack);if(!this.connection||!mt||mt.track!==it||this.state!==qo.Connected)return void ct();const{id:_t,track:vt}=mt;await this.connection.updateSendParameters(_t,vt),ct()}catch(mt){ut(mt)}finally{pt()}}),Jt(this,"handleReplaceMixingTrack",async(it,ct,ut,pt)=>{if(!this.connection||this.state!==qo.Connected)return void ct();const mt=BM([it]);let _t;Ut.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(mt.getTrackId(),"]")),typeof pt=="boolean"&&pt||(_t=await this.mutex.lock("From P2PChannel.handleReplaceMixingTrack"));try{await this.replaceTrack(it,mt),ct()}catch(Tt){ut(Tt)}finally{var vt;(vt=_t)===null||vt===void 0||vt()}}),Jt(this,"handleReplaceTrack",async(it,ct,ut,pt)=>{let mt;Ut.debug("[".concat(this.store.clientId,"] P2PChannel handleReplaceTrack for [track-id-").concat(it.getTrackId(),"]")),typeof pt=="boolean"&&pt||(mt=await this.mutex.lock("From P2PChannel.handleReplaceTrack"));try{var _t;const Tt=Array.from(this.localTrackMap.entries()).find(bt=>{let[,{track:Ot}]=bt;return it===Ot});if(!this.connection||!Tt||this.state!==qo.Connected)return void ct();if(await((_t=this.connection)===null||_t===void 0?void 0:_t.replaceTrack(it,Tt[1].id)),this.isPlanB){const bt=Tt[1];bt.id=it._mediaStreamTrack.id,this.localTrackMap.set(Tt[0],bt)}if(Tt[0]===or.LocalVideoTrack&&!rn("DISABLE_DUAL_STREAM_USE_ENCODING")&&Fo().supportDualStreamEncoding){const bt=this.localTrackMap.get(or.LocalVideoLowTrack);if(bt){const Ot=it._mediaStreamTrack.clone();bt.track._originMediaStreamTrack.stop(),bt.track._mediaStreamTrack=Ot,bt.track._originMediaStreamTrack=Ot,await new Ir((Mt,Dt)=>{this.handleReplaceTrack(bt.track,Mt,Dt,!0)})}}ct()}catch(Tt){ut(Tt)}finally{var vt;(vt=mt)===null||vt===void 0||vt()}}),Jt(this,"handleGetRTCStats",it=>{it(this.statsCollector.getRTCStats())}),Jt(this,"handleGetLocalVideoStats",it=>{it(this.statsCollector.getLocalVideoTrackStats())}),Jt(this,"handleGetLocalAudioStats",it=>{it(this.statsCollector.getLocalAudioTrackStats())}),Jt(this,"handleGetRemoteVideoStats",it=>this.statsCollector.getRemoteVideoTrackStats(it.uid)[it.uid]),Jt(this,"handleGetRemoteAudioStats",it=>this.statsCollector.getRemoteAudioTrackStats(it.uid)[it.uid]),this.store=_e,this.statsCollector=rt,this.statsCollector.addP2PChannel(this),this.statsUploader=new x4(this.store),this.bindStatsUploaderEvents(),this.mutex=new lu("P2PChannel-mutex",this.store.clientId),this.isPlanB=!Fo().supportUnifiedPlan||rn("CHROME_FORCE_PLAN_B")&&hE(),this.shouldForwardP2PCreation=rn("FORWARD_P2P_CREATION")&&Fo().supportPCSetConfiguration&&gO(),this.shouldForwardP2PCreation&&(this.connection=r1(this.store),this.emit(jr.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection))}async startP2PConnection(_e,rt){var it;this.state=qo.New,this._forceTurn=C4(_e),Ut.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] forceTurn: ").concat(this._forceTurn));const ct=this.shouldForwardP2PCreation&&((it=this.connection)===null||it===void 0?void 0:it.peerConnectionState)==="closed";if((!this.shouldForwardP2PCreation||ct||rt)&&((ct||rt)&&this.connection&&(Ut.warning("[".concat(this.store.clientId,"] P2PChannel.startP2PConnection ForwardP2P closed.")),this.resetConnection(this.connection)),this.connection=r1(this.store,_e),this.emit(jr.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),!this.connection)throw new Yn(tn.UNEXPECTED_ERROR,"Cannot P2PChannel.startConnection before P2PConnection initialization .");return this._pcStatsUploadType=rn("NEW_ICE_RESTART")?mE.FIRST_CONNECTION:mE.OLD_FIRST_CONNECTION,this._isTryConnecting=!0,this._isStartRestartIce=!1,this._iceError=null,this.connection.setConfiguration(_e),this.connection.establishPromise}async connect(_e){if(!this.connection)throw new Yn(tn.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");if(this.isPreallocation()&&this.state===qo.Connected){if(this.connection instanceof nm&&this.connection.checkDtlsParameters(_e.dtlsParameters.fingerprints))return Ut.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] dtls parameters mismatch, try next.")),Vr.reportApiInvoke(this.store.sessionId,{name:Ks.MISMATCH_DTLS_PARAMETERS,options:[_e.dtlsParameters.fingerprints],tag:Ns.TRACER}).onSuccess(),void setTimeout(()=>{this.emit(jr.RequestReconnect)});await this.connection.updateRemoteConnect(_e)}else this.store.peerConnectionStart(),await this.connection.connect(_e),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=qo.Connected}updateRemoteRTPCapabilities(_e){const rt=Array.from(this.localTrackMap.entries()).filter(ut=>{var pt;let[mt]=ut;return Er(pt=[or.LocalVideoLowTrack,or.LocalVideoTrack]).call(pt,mt)}),it=rt.map(ut=>{let[,{id:pt}]=ut;return pt}),ct=rt.map(ut=>{let[pt]=ut;return pt});if(this.connection instanceof nm){if(Vr.updateRemoteRTPCapabilities(this.store.sessionId,{trackTypes:JSON.stringify(ct),localCodecs:JSON.stringify(this.connection.localCodecs),remoteCodecs:JSON.stringify(_e)}),!Er(_e).call(_e,this.store.codec)){const ut=["vp9","vp8","h264"].find(pt=>Er(_e).call(_e,pt));ut&&(this.store.codec=ut,Ut.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId," updateRemoteRTPCapabilities] default codec is not available, hence the fallback to ").concat(ut,".")))}this.connection.updateRemoteRTPCapabilities(it,_e)}}async getEstablishParams(){var _e;if(this.connection instanceof nm&&this.connection.peerConnectionState!=="closed"&&Er(_e=[qo.New,qo.Connected]).call(_e,this.state))return this.connection.establishPromise}async publishDataChannel(_e){if(!this.connection||this.state!==qo.Connected){if(this.state===qo.Disconnected)throw new Yn(tn.UNEXPECTED_ERROR,"PeerConnection already disconnected.");return _e.forEach(it=>{var ct;Er(ct=this.pendingLocalDataChannels).call(ct,it)||this.pendingLocalDataChannels.push(it)}),[]}const rt=this.filterTobePublishedDataChannels(_e);return rt.length===0?[]:(rt.forEach(it=>{const ct=Date.now();this.store.publish(it.id.toString(),"datachannel",ct)}),await this.connection.createDataChannels(this.store.uid,rt),rt.forEach(it=>{this.localDataChannels.push(it);const ct=Date.now();this.store.publish(it.id+"","datachannel",void 0,ct)}),_e.map(it=>({streamId:it.id,ordered:it.ordered,maxRetransmits:it.maxRetransmits,metadata:it.metadata,channelId:it._originDataChannelId})))}publish(_e,rt,it){var ct=this;return Jp(function*(){const ut=yield Bo(ct.mutex.lock("From P2PChannel.publish"));try{var pt;const mt=ct.connection&&Er(pt=["disconnected","failed"]).call(pt,ct.connection.peerConnectionState);if(!ct.connection||ct.state!==qo.Connected||mt){if(ct.state===qo.Disconnected)throw new Yn(tn.UNEXPECTED_ERROR,"PeerConnection already disconnected.");ct.throwIfTrackTypeNotMatch(_e);const vt=_e.filter(Tt=>ct.pendingLocalTracks.indexOf(Tt)===-1);return ct.pendingLocalTracks=ct.pendingLocalTracks.concat(vt),void(mt&&(ct._isWaitPcToRePub=!0))}ct.store.pubId=ct.store.pubId+1,pu.markPublishStart(ct.store.clientId,ct.store.pubId);const _t=ct.filterTobePublishedTracks(_e,rt,it);if(_t.length===0)return void(yield Bo(ct.tryToUnmuteAudio(_e)));yield*QR(N4(ct.doPublish(ct.connection,_t)))}finally{ut()}})()}doPublish(_e,rt){var it=this;return Jp(function*(){rt.forEach(Mt=>{let{track:Dt,type:jt}=Mt;const $t=Date.now();it.store.publish(Dt.getTrackId(),jt===or.LocalAudioTrack?"audio":"video",$t)}),it.bindLocalTrackEvents(rt);const ct=rt.map(Mt=>{let{track:Dt}=Mt;return Dt}),ut=yield Bo(_e.send(ct,it.store.codec,it.store.audioCodec)),pt=(yield Bo(ut.next())).value,mt=it.createGatewayPublishMessage(rt,pt);let _t;try{_t=yield mt}catch(Mt){throw ut.throw(Mt),(Mt==null?void 0:Mt.code)===tn.WS_ABORT&&rt.forEach(Dt=>{let{track:jt}=Dt;it.pendingLocalTracks.indexOf(jt)===-1&&it.pendingLocalTracks.push(jt)}),it.unbindLocalTrackEvents(rt),Mt}const vt=it.mapPubResToRemoteConfig(mt,_t,ct),Tt=(yield Bo(ut.next(vt))).value;if(it.state===qo.Disconnected)throw new Yn(tn.UNEXPECTED_ERROR,"PeerConnection already disconnected.");rn("ENABLE_VIDEO_SEI");const bt=rn("ENABLE_ENCODED_TRANSFORM"),Ot=rn("ENABLE_AUDIO_METADATA");ct.forEach(async Mt=>{const Dt=Mt.getRTCRtpTransceiver();if(!Dt||!bt)return;const{interceptLocalVideoFrame:jt,interceptLocalAudioFrame:$t}=Yw();Mt.trackMediaType===Pr.VIDEO?await jt(Dt.sender,Mt):Mt.trackMediaType===Pr.AUDIO&&await $t(Dt.sender,{metadata:Ot?()=>{const Ht=Mt.metadata.shift();return Ht&&Ht.value}:void 0})}),rt.forEach(Mt=>{let{type:Dt}=Mt;it.statsCollector.addLocalStats(Dt)}),it.assignLocalTracks(rt,Tt),it.statsUploader.startUploadOutboundStats(),rt.forEach(Mt=>{let{track:Dt,type:jt}=Mt;const $t=Date.now();it.store.publish(Dt.getTrackId(),jt===or.LocalAudioTrack?"audio":"video",void 0,$t)})})()}async updateVideoStreamParameter(_e,rt){const it=this.localTrackMap.get(rt);if(!it||!this.connection)return;if(!(it.track instanceof Cs))return Ut.warn("[updateVideoStreamParameter]: track is not an instance of LocalVideoTrack");const{track:ct}=it,ut=function(pt,mt){const _t={};return pt.height&&pt.width&&(_t.scaleResolutionDownBy=yM(pt,mt)),_t.maxFramerate=pt.framerate?bp(pt.framerate):void 0,_t.maxBitrate=pt.bitrate?1e3*pt.bitrate:void 0,_t}(_e,ct);if(ct._encoderConfig||(ct._encoderConfig={}),rt!==or.LocalVideoLowTrack||!rn("DISABLE_DUAL_STREAM_USE_ENCODING")&&Fo().supportDualStreamEncoding)ut.scaleResolutionDownBy!=null&&(ct._encoderConfig.scaleResolutionDownBy=ut.scaleResolutionDownBy);else{const pt=ct._originMediaStreamTrack;if(!pt.canvas)return Ut.warn("[".concat(ct.getTrackId(),"] no canvas on track"));(function(mt,_t){const vt=mt.canvas;_t.width&&(vt.width=bp(_t.width)),_t.height&&(vt.height=bp(_t.height)),_t.framerate&&(vt.stopCapture&&vt.stopCapture(),vt.stopCapture=zO(()=>{!vt.startCapture&&vt.stopCapture&&vt.stopCapture(),vt.startCapture&&vt.startCapture()},bp(_t.framerate)))})(pt,_e)}ut.maxBitrate!=null&&(ct._encoderConfig.bitrateMax=ut.maxBitrate/1e3),ut.maxFramerate!=null&&(ct._encoderConfig.frameRate&&typeof ct._encoderConfig.frameRate=="object"?ct._encoderConfig.frameRate.max=ut.maxFramerate:ct._encoderConfig.frameRate={max:ut.maxFramerate}),Ut.debug("[".concat(ct.getTrackId(),"] LowStreamEncoderConfig: , ").concat(JSON.stringify(ct._encoderConfig))),await this.connection.updateRtpSenderEncodings(ct)}publishLowStream(_e){var rt=this;return Jp(function*(){if(!rt.connection||rt.state!==qo.Connected)return;const it=yield Bo(rt.mutex.lock("Locking from P2PChannel.publishLowStream"));try{const ut=rt.localTrackMap.get(or.LocalVideoTrack);if(!ut)throw new Yn(tn.UNEXPECTED_ERROR,"Could not find high stream");if(rt.localTrackMap.has(or.LocalVideoLowTrack))throw new Yn(tn.UNEXPECTED_ERROR,"[".concat(rt.store.clientId,"] Can't publish low stream when stream already publish"));const pt=[{track:rt.getLowVideoTrack(ut.track,_e),type:or.LocalVideoLowTrack}];if(yield*QR(N4(rt.doPublish(rt.connection,pt))),ut.track.muted||!ut.track.enabled){var ct;const mt=(ct=rt.localTrackMap.get(or.LocalVideoLowTrack))===null||ct===void 0?void 0:ct.id;mt!==void 0&&(yield Bo(rt.connection.muteLocal([mt])))}}finally{it()}})()}async republish(){this.pendingLocalTracks.length>0&&(Ut.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await ru(this,jr.RequestRePublish,this.pendingLocalTracks),this.emit(jr.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[]),this.pendingLocalDataChannels.length>0&&(Ut.debug("Emit P2PChannelEvents.RequestRePublishDataChannel to republish datachannels."),await ru(this,jr.RequestRePublishDataChannel,this.pendingLocalDataChannels),this.pendingLocalDataChannels=[]),this._isWaitPcToRePub=!1}async reSubscribe(_e){for(let rt=this.pendingRemoteTracks.length-1;rt>=0;rt--){const{user:it,kind:ct}=this.pendingRemoteTracks[rt];(ct!==Pr.AUDIO||it._audio_added_&&it._audioSSRC)&&(ct!==Pr.VIDEO||it._video_added_&&it._videoSSRC)||this.pendingRemoteTracks.splice(rt,1)}if(_e)await ru(this,jr.RequestReSubscribe,this.pendingRemoteTracks);else for(const{user:rt,kind:it}of this.pendingRemoteTracks)await this.subscribe(rt,it,it===Pr.VIDEO?rt._videoSSRC:rt._audioSSRC);this.pendingRemoteTracks.forEach(rt=>{let{user:it}=rt;this.emit(jr.MediaReconnectEnd,it.uid)}),this.pendingRemoteTracks=[]}async unpublish(_e){if(!this.connection||this.state!==qo.Connected)return void _e.forEach(ct=>{const ut=this.pendingLocalTracks.indexOf(ct);ut!==-1&&this.pendingLocalTracks.splice(ut,1)});const rt=this.filterTobeUnpublishedTracks(_e);if(rt.length===0)return;const it=rt.find(ct=>ct[0]==="videoLowTrack");return it&&it[1].track.close(),this.doUnpublish(this.connection,rt)}async unpublishDataChannel(_e){if(!this.connection||this.state!==qo.Connected)return void _e.forEach(it=>{const ct=this.pendingLocalDataChannels.indexOf(it);ct!==-1&&this.pendingLocalDataChannels.splice(ct,1)});const rt=this.filterTobeUnpublishedDataChannels(_e);return rt.length!==0?(rt.forEach(it=>{const ct=this.localDataChannels.indexOf(it);ct!==-1&&this.localDataChannels.splice(ct,1)}),this.localDataChannels.length===0&&await this.connection.stopDataChannels(this.store.uid),rt.map(it=>it.id)):void 0}async unpublishLowStream(){if(!this.connection||this.state!==qo.Connected)return;const _e=this.localTrackMap.get(or.LocalVideoLowTrack);if(!_e)return;_e.track.close();const rt=[[or.LocalVideoLowTrack,_e]];return this.doUnpublish(this.connection,rt)}async doUnpublish(_e,rt){const it=this.createGatewayUnpublishMessage(rt);return await _e.stopSending(rt.map(ct=>{let[,{id:ut}]=ct;return ut})),this.withdrawLocalTracks(rt),this.unbindLocalTrackEvents(rt.map(ct=>{let[ut,{track:pt}]=ct;return{type:ut,track:pt}})),rt.forEach(ct=>{let[ut]=ct;this.statsCollector.removeLocalStats(ut)}),this.localTrackMap.size===0&&this.statsUploader.stopUploadOutboundStats(),it}async subscribeDataChannel(_e,rt){if(!this.connection||this.state!==qo.Connected)throw new Yn(tn.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");const it=rt.filter(ct=>{var ut;return!((ut=this.remoteDataChannelMap.get(_e))!==null&&ut!==void 0&&ut.get(ct.id))});if(it.length!==0)return await this.connection.createDataChannels(_e.uid,it),it.forEach(ct=>{var ut;this.remoteDataChannelMap.has(_e)?(ut=this.remoteDataChannelMap.get(_e))===null||ut===void 0||ut.set(ct.id,ct):this.remoteDataChannelMap.set(_e,new Map([[ct.id,ct]]));const pt=this.pendingRemoteDataChannels.findIndex(mt=>{let{user:_t,id:vt}=mt;return _t.uid===_e.uid&&vt===ct.id});pt!==-1&&this.pendingRemoteDataChannels.splice(pt,1)}),it.map(ct=>ct.id)}async subscribe(_e,rt,it,ct,ut){var pt;if(!this.connection||this.state!==qo.Connected)throw new Yn(tn.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");if((pt=this.remoteUserMap.get(_e))!==null&&pt!==void 0&&pt.has(rt))return;let mt,_t,vt,Tt;const bt=this.connection.getPreMedia(it);if(bt)Ut.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] preSSRCMap has ssrcId: ").concat(it,", no need to send sub to gateway.")),vt=bt.transceiver,mt=bt.track,_t=bt.mid,Tt=bt.player,bt.firstVideoRender&&this.store.firstVideoFrameDecoded(_e.uid,{firstPreRender:bt.firstVideoRender});else if(ut){const Dt=ut.find($t=>{let{stream_type:Ht}=$t;return Ht===rt});if(!Dt)throw new Yn(tn.UNEXPECTED_ERROR,"Cannot subscribe to remote ".concat(rt," for user: ").concat(_e.uid," because subscribe answer from gateway does not contain stream_type: ").concat(rt,"."));const jt=await this.connection.receive(rt,Dt.ssrcs,String(_e._uintid),Dt.attributes);this.connection instanceof nm&&(vt=jt.transceiver),mt=jt.track,_t=jt.id}else{const Dt=await this.connection.receive(rt,[{ssrcId:it,rtx:ct}],String(_e._uintid),void 0);this.connection instanceof nm&&(vt=Dt.transceiver),mt=Dt.track,_t=Dt.id}if(rt===Pr.AUDIO?(_e._audioTrack?_e._audioTrack._updateOriginMediaStreamTrack(mt):(_e._audioTrack=new IS(mt,_e.uid,_e._uintid,this.store),Ut.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(_e._audioTrack.getTrackId()))),vt&&_e._audioTrack._updateRtpTransceiver(vt),this.bindRemoteTrackEvents(_e,_e._audioTrack)):(_e._videoTrack?_e._videoTrack._updateOriginMediaStreamTrack(mt):(_e._videoTrack=new wS(mt,_e.uid,_e._uintid,this.store,Tt),Ut.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(_e._videoTrack.getTrackId())),_e._videoTrack.once(_f.PLAY_START,()=>{this.store.firstVideoFrameDecoded(_e.uid,{playStart:Date.now()})}),_e._videoTrack.once(_f.PLAY_END,()=>{this.store.firstVideoFrameDecoded(_e.uid,{playEnd:Date.now()}),this.reportVideoFirstFrameRender(_e)}),Tt?_e._videoTrack.once(_f.FIRST_FRAME_RENDER,()=>{this.store.firstVideoFrameDecoded(_e.uid,{firstRender:Date.now()}),this.reportVideoFirstFrameRender(_e)}):_e._videoTrack.once(_f.FIRST_FRAME_DECODED,()=>{this.store.firstVideoFrameDecoded(_e.uid,{firstRender:Date.now()}),this.reportVideoFirstFrameRender(_e)})),vt&&_e._videoTrack._updateRtpTransceiver(vt),this.bindRemoteTrackEvents(_e,_e._videoTrack)),vt&&rn("ENABLE_ENCODED_TRANSFORM")){const{interceptRemoteVideoFrame:Dt,interceptRemoteAudioFrame:jt}=Yw();rt==Pr.VIDEO?await Dt(vt.receiver,{onSei:rn("ENABLE_VIDEO_SEI")&&($t=>{var Ht;return(Ht=_e._videoTrack)===null||Ht===void 0?void 0:Ht._onSei($t)})}):rt==Pr.AUDIO&&await jt(vt.receiver,{enableTopn:!!rn("ENABLE_AUDIO_TOPN"),enableMetadata:!!rn("ENABLE_AUDIO_METADATA"),enablePts:!!rn("ENABLE_AUDIO_PTS"),onMetadata:$t=>{this.safeEmit(jr.AudioMetadata,$t)},onPts:$t=>{this.safeEmit(jr.AudioPts,$t)}})}const Ot=this.remoteUserMap.get(_e);Ot?Ot.set(rt,_t):this.remoteUserMap.set(_e,new Map([[rt,_t]])),this.statsCollector.addRemoteStats(_e.uid),this.statsUploader.startUploadInboundStats();const Mt=this.pendingRemoteTracks.findIndex(Dt=>{let{user:jt,kind:$t}=Dt;return jt.uid===_e.uid&&rt===$t});Mt!==-1&&(this.pendingRemoteTracks.splice(Mt,1),this.emit(jr.MediaReconnectEnd,_e.uid))}async massSubscribe(_e){return this.massSubscribeNoLock(_e)}async massSubscribeNoLock(_e){if(!this.connection||this.state!==qo.Connected)throw new Yn(tn.INVALID_OPERATION,"Cannot subscribeAll remote users when peerConnection disconnected.");_e=_e.filter(ut=>{var pt;let{user:mt,mediaType:_t}=ut;return!((pt=this.remoteUserMap.get(mt))!==null&&pt!==void 0&&pt.has(_t))});const rt=[],it=new Map;_e.forEach(ut=>{if(!this.connection)return;const pt=this.connection.getPreMedia(ut.ssrcId);if(pt){const{track:mt,mid:_t,transceiver:vt,player:Tt}=pt;it.set(ut.ssrcId,{track:mt,id:_t,transceiver:vt,player:Tt})}else rt.push(ut)});const ct=await this.connection.batchReceive(rt.map(ut=>{let{user:pt,mediaType:mt,ssrcId:_t,rtxSsrcId:vt}=ut;return{kind:mt,ssrcMsg:[{ssrcId:_t,rtx:vt}],mslabel:String(pt._uintid)}}));rt.forEach((ut,pt)=>{it.set(ut.ssrcId,ct[pt])});for(const{user:ut,mediaType:pt,ssrcId:mt}of _e){const _t=it.get(mt);if(!_t)return void Ut.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] cannot find ").concat(ut.uid," subscribe data,").concat(pt,", ").concat(mt));const{track:vt,id:Tt,transceiver:bt,player:Ot}=_t;if(bt&&rn("ENABLE_ENCODED_TRANSFORM")){const{interceptRemoteVideoFrame:jt,interceptRemoteAudioFrame:$t}=Yw();pt==Pr.VIDEO?await jt(bt.receiver,{onSei:rn("ENABLE_VIDEO_SEI")&&(Ht=>{var en;return(en=ut._videoTrack)===null||en===void 0?void 0:en._onSei(Ht)})}):pt==Pr.AUDIO&&await $t(bt.receiver,{enableTopn:!!rn("ENABLE_AUDIO_TOPN"),enableMetadata:!!rn("ENABLE_AUDIO_METADATA"),enablePts:!!rn("ENABLE_AUDIO_PTS"),onMetadata:Ht=>{this.safeEmit(jr.AudioMetadata,Ht)},onPts:Ht=>{this.safeEmit(jr.AudioPts,Ht)}})}if(pt===Pr.AUDIO?(ut._audioTrack?ut._audioTrack._updateOriginMediaStreamTrack(vt):(ut._audioTrack=new IS(vt,ut.uid,ut._uintid,this.store),Ut.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(ut._audioTrack.getTrackId()))),bt&&ut._audioTrack._updateRtpTransceiver(bt),this.bindRemoteTrackEvents(ut,ut._audioTrack)):(ut._videoTrack?ut._videoTrack._updateOriginMediaStreamTrack(vt):(ut._videoTrack=new wS(vt,ut.uid,ut._uintid,this.store,Ot),Ut.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(ut._videoTrack.getTrackId()))),bt&&ut._videoTrack._updateRtpTransceiver(bt),this.bindRemoteTrackEvents(ut,ut._videoTrack)),rn("ENABLE_VIDEO_SEI")&&bt){const{interceptRemoteVideoFrame:jt,interceptRemoteAudioFrame:$t}=Yw();pt==Pr.VIDEO?await jt(bt.receiver,{onSei:Ht=>{var en;(en=ut._videoTrack)===null||en===void 0||en._onSei(Ht)}}):pt==Pr.AUDIO&&await $t(bt.receiver)}const Mt=this.remoteUserMap.get(ut);Mt?Mt.set(pt,Tt):this.remoteUserMap.set(ut,new Map([[pt,Tt]])),this.statsCollector.addRemoteStats(ut.uid),this.statsUploader.startUploadInboundStats();const Dt=this.pendingRemoteTracks.findIndex(jt=>{let{user:$t,kind:Ht}=jt;return $t.uid===ut.uid&&pt===Ht});Dt!==-1&&(this.pendingRemoteTracks.splice(Dt,1),this.emit(jr.MediaReconnectEnd,ut.uid))}}async unsubscribe(_e,rt,it){const ct=this.pendingRemoteTracks.filter(mt=>{let{user:_t,kind:vt}=mt;return rt!==void 0?_t.uid===_e.uid&&rt===vt:_t.uid===_e.uid});if(ct.forEach(mt=>{const _t=this.pendingRemoteTracks.indexOf(mt);this.pendingRemoteTracks.splice(_t,1)}),this.connection&&this.state===qo.Connected||it||ct.forEach(mt=>{let{kind:_t}=mt;var vt;if(_t===Pr.AUDIO)(vt=_e._audioTrack)===null||vt===void 0||vt._destroy(),_e._audioTrack=void 0;else if(_t===Pr.VIDEO){var Tt;(Tt=_e._videoTrack)===null||Tt===void 0||Tt._destroy(),_e._videoTrack=void 0}}),!this.connection||this.state!==qo.Connected)return;const ut=this.filterTobeUnSubscribedTracks(_e,rt);if(ut.length===0)return;await this.connection.stopReceiving(ut.map(mt=>{let[,{id:_t}]=mt;return _t}));const pt=this.createUnsubscribeMessage(ut);return this.withdrawRemoteTracks(ut),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),ut.forEach(mt=>{let[_t,{kind:vt}]=mt;var Tt,bt;if(vt===Pr.VIDEO&&_t._videoSSRC&&((Tt=this.connection)===null||Tt===void 0||Tt.setStatsRemoteVideoIsReady(_t._videoSSRC,!1)),vt===Pr.VIDEO)this.unbindRemoteTrackEvents(_t._videoTrack),it||((bt=_t._videoTrack)===null||bt===void 0||bt._destroy(),_t._videoTrack=void 0);else if(vt===Pr.AUDIO){var Ot;this.unbindRemoteTrackEvents(_t._audioTrack),!it&&((Ot=_t._audioTrack)===null||Ot===void 0||Ot._destroy(),_t._audioTrack=void 0)}}),pt}async unsubscribeDataChannel(_e,rt){if(rt.forEach(ut=>{const pt=this.pendingRemoteDataChannels.findIndex(mt=>mt.id===ut.id);pt!==-1&&this.pendingRemoteDataChannels.splice(pt,1)}),!this.connection)return;const it=this.filterTobeUnSubscribedDataChannels(_e,rt);if(it.length===0)return;rt.forEach(ut=>{ut._close()});const ct=this.remoteDataChannelMap.get(_e);return it.forEach(ut=>{ct&&ct.delete(ut.id)}),ct&&ct.size===0&&(this.remoteDataChannelMap.delete(_e),await this.connection.stopDataChannels(_e.uid)),it.map(ut=>ut.id)}async massUnsubscribe(_e){return this.massUnsubscribeNoLock(_e)}async massUnsubscribeNoLock(_e){let rt=[];for(const{user:ut,mediaType:pt}of _e){const mt=this.pendingRemoteTracks.filter(_t=>{let{user:vt,kind:Tt}=_t;return pt!==void 0?vt.uid===ut.uid&&pt===Tt:vt.uid===ut.uid});mt.forEach(_t=>{const vt=this.pendingRemoteTracks.indexOf(_t);this.pendingRemoteTracks.splice(vt,1)}),rt=rt.concat(mt)}if(!this.connection||this.state!==qo.Connected)return void rt.forEach(ut=>{let{user:pt,kind:mt}=ut;var _t;if(mt===Pr.AUDIO)(_t=pt._audioTrack)===null||_t===void 0||_t._destroy(),pt._audioTrack=void 0;else if(mt===Pr.VIDEO){var vt;(vt=pt._videoTrack)===null||vt===void 0||vt._destroy(),pt._videoTrack=void 0}});const it=_p(_e).call(_e,(ut,pt)=>{let{user:mt,mediaType:_t}=pt;const vt=this.filterTobeUnSubscribedTracks(mt,_t);return ut.concat(vt)},[]);if(it.length===0)return;await this.connection.stopReceiving(it.map(ut=>{let[,{id:pt}]=ut;return pt}));const ct=this.createUnsubscribeAllMessage(it);return this.withdrawRemoteTracks(it),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),it.forEach(ut=>{let[pt,{kind:mt}]=ut;var _t,vt;if(mt===Pr.VIDEO&&pt._videoSSRC&&((_t=this.connection)===null||_t===void 0||_t.setStatsRemoteVideoIsReady(pt._videoSSRC,!1)),mt===Pr.VIDEO)this.unbindRemoteTrackEvents(pt._videoTrack),(vt=pt._videoTrack)===null||vt===void 0||vt._destroy(),pt._videoTrack=void 0;else if(mt===Pr.AUDIO){var Tt;this.unbindRemoteTrackEvents(pt._audioTrack),(Tt=pt._audioTrack)===null||Tt===void 0||Tt._destroy(),pt._audioTrack=void 0}}),ct}isPreSubScribe(_e){return!this.connection||this.state!==qo.Connected?!1:!!this.connection.getPreMedia(_e)}async muteRemote(_e,rt){if(!this.connection)return;const it=this.remoteUserMap.get(_e);if(!it)return void Ut.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(_e.uid,"."));if(!it.get(rt))return void Ut.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(_e.uid," media type ").concat(rt,"."));const ct=rt===Pr.VIDEO?_e._videoSSRC:_e._audioSSRC;ct!==void 0&&this.connection.setStatsRemoteVideoIsReady(ct,!1)}async unmuteRemote(_e,rt){return this.unmuteRemoteNoLock(_e,rt)}async unmuteRemoteNoLock(_e,rt){if(!this.connection)return;const it=this.remoteUserMap.get(_e);if(!it)return void Ut.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(_e.uid,"."));it.get(rt)||Ut.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(_e.uid," media type ").concat(rt,"."))}addAudioMetadata(_e){const rt=this.localTrackMap.get(or.LocalAudioTrack),it=rt&&rt.track;it&&it.metadata.push(_e)}getAllTracks(_e){const rt=this.localTrackMap.get(or.LocalAudioTrack);if((rt==null?void 0:rt.track)instanceof yl){const it=rt.track;return Array.from(this.localTrackMap.entries()).filter(ct=>{let[ut]=ct;return ut!==or.LocalAudioTrack}).filter(ct=>{let[ut]=ct;return!(_e&&ut===or.LocalVideoLowTrack)}).map(ct=>{let[,{track:ut}]=ct;return ut}).concat(it.trackList)}return Array.from(this.localTrackMap.entries()).filter(it=>{let[ct]=it;return!(_e&&ct===or.LocalVideoLowTrack)}).map(it=>{let[,{track:ct}]=it;return ct})}getAllDataChannels(){return this.localDataChannels}reportPublishEvent(_e,rt,it,ct,ut){if(_e){const mt=this.localTrackMap.get(or.LocalAudioTrack),_t=ct?this.localTrackMap.get(or.LocalVideoLowTrack):this.localTrackMap.get(or.LocalVideoTrack);Vr.publish(this.store.sessionId,{eventElapse:pu.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:_e,ec:rt,audioName:mt==null?void 0:mt.track.getTrackLabel(),videoName:_t==null?void 0:_t.track.getTrackLabel(),screenshare:(_t==null?void 0:_t.track._hints.indexOf(ds.SCREEN_TRACK))!==-1,audio:!!mt,video:!!_t,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:ut})}else{var pt;it||(it=[]);const mt=it.find(vt=>vt instanceof Ws),_t=ct?(pt=this.localTrackMap.get(or.LocalVideoTrack))===null||pt===void 0?void 0:pt.track:it.find(vt=>vt instanceof Cs);Vr.publish(this.store.sessionId,{eventElapse:pu.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:_e,ec:rt,audioName:mt==null?void 0:mt.getTrackLabel(),videoName:_t==null?void 0:_t.getTrackLabel(),screenshare:(_t==null?void 0:_t._hints.indexOf(ds.SCREEN_TRACK))!==-1,audio:!!mt,video:!!_t,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:ut})}}reportSubscribeEvent(_e,rt,it,ct){const ut=ct===Pr.VIDEO?it._videoSSRC:it._audioSSRC;ut&&Vr.subscribe(this.store.sessionId,{succ:_e,ec:rt,video:ct===Pr.VIDEO,audio:ct===Pr.AUDIO,peerid:it.uid,subscribeRequestid:ut,p2pid:this.store.p2pId,eventElapse:pu.measureFromSubscribeStart(this.store.clientId,ut),preSsrc:this.isPreSubScribe(ut)})}reset(){Ut.debug("[".concat(this.store.clientId,"] P2PChannel.reset")),this.mutex=new lu("P2PChannel-mutex",this.store.clientId),this.connection&&(this.resetConnection(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=r1(this.store),this.emit(jr.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.statsUploader.stopUploadBaseStats(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const _e=this.localTrackMap.get(or.LocalAudioTrack);if((_e==null?void 0:_e.track)instanceof yl){if(_e.track.trackList.length>0){const rt=_e.track;_e.track.trackList.forEach(it=>{rt.removeAudioTrack(it)})}_e.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.iceFailedCount=0,this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.localDataChannels=[],this.remoteDataChannelMap.clear(),this.pendingLocalDataChannels=[],this.pendingRemoteDataChannels=[],this.state=qo.Disconnected}getStats(){var _e;return(_e=this.connection)===null||_e===void 0?void 0:_e.getStats()}getRemoteVideoIsReady(_e){var rt;return((rt=this.connection)===null||rt===void 0?void 0:rt.getRemoteVideoIsReady(_e))||!1}getLocalAudioVolume(){const _e=this.localTrackMap.get(or.LocalAudioTrack);if(_e)return _e.track.getVolumeLevel()}getLocalVideoSize(){const _e=this.localTrackMap.get(or.LocalVideoTrack);if(_e)return{width:_e.track.videoWidth||0,height:_e.track.videoHeight||0}}getEncoderConfig(_e){const rt=this.localTrackMap.get(_e);return rt&&rt.track instanceof Cs||rt&&rt.track instanceof Ws?rt.track._encoderConfig:void 0}getLocalMedia(_e){return this.localTrackMap.get(_e)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(_e,rt){if(!_e)return this.remoteUserMap.size>0;const it=this.remoteUserMap.get(_e);return!!it&&(!rt||it.has(rt))}async hasRemoteMediaWithLock(_e,rt){if(!_e)return this.remoteUserMap.size>0;const it=this.remoteUserMap.get(_e);return!!it&&(!rt||it.has(rt))}getRemoteMedia(_e){var rt;const it=Array.from(sp(rt=this.remoteUserMap).call(rt)).find(ct=>ct.uid===_e);return it?{audioTrack:it.audioTrack,audioSSRC:it._audioSSRC,videoTrack:it.videoTrack,videoSSRC:it._videoSSRC}:{}}getAudioLevels(){let _e=Array.from(this.remoteUserMap.entries()).map(it=>{let[ct]=it;return{uid:ct.uid,level:ct.audioTrack?100*ct.audioTrack._source.getAccurateVolumeLevel():0}});const rt=this.localTrackMap.get(or.LocalAudioTrack);return rt&&_e.push({level:100*rt.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),_e=s0(_e).call(_e,(it,ct)=>it.level-ct.level),_e}async disconnectForReconnect(){this.connection&&(Ut.debug("[".concat(this.store.clientId,"] P2PChannel.disconnectForReconnect closing P2PConnection")),this.state=qo.Reconnecting,rn("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(_e=>{let[rt]=_e;var it;rt._videoTrack&&rt._videoTrack._player&&((it=rt._videoTrack._player.getVideoElement())===null||it===void 0||it.pause(),rt._videoTrack._player.isKeepLastFrame=!0,rt._videoTrack._originMediaStreamTrack.stop())}),this.resetConnection(this.connection),this.connection=void 0,this.shouldForwardP2PCreation&&(this.connection=r1(this.store),this.emit(jr.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(_e=>{var rt;let[it,{track:ct}]=_e;switch(it){case or.LocalVideoTrack:Er(rt=ct._hints).call(rt,ds.LOW_STREAM)?ct.close():this.pendingLocalTracks.push(ct);break;case or.LocalAudioTrack:ct instanceof yl?this.pendingLocalTracks=this.pendingLocalTracks.concat(ct.trackList):this.pendingLocalTracks.push(ct);case or.LocalVideoLowTrack:}}),this.emit(jr.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(_e=>{let[rt,it]=_e;Array.from(sp(it).call(it)).forEach(ct=>{this.setPendingRemoteMedia(rt,ct)}),this.emit(jr.MediaReconnectStart,rt.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.localDataChannels.length!==0&&(this.localDataChannels.forEach(_e=>{this.pendingLocalDataChannels.push(_e)}),this.localDataChannels.length=0),this.remoteDataChannelMap.size!==0&&(Array.from(this.remoteDataChannelMap.entries()).forEach(_e=>{let[rt,it]=_e;Array.from(sp(it).call(it)).forEach(ct=>{this.setPendingRemoteDataChannel(rt,ct)})}),this.remoteDataChannelMap.clear()),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),Ut.debug("[".concat(this.store.clientId,"] P2PChannel disconnected, waiting to reconnect.")))}hasPendingRemoteDataChannel(_e,rt){for(const it of this.pendingRemoteDataChannels){const{user:ct,id:ut}=it;if((_e instanceof pv?_e.uid:_e)===ct.uid&&ut===rt)return!0}return!1}setPendingRemoteDataChannel(_e,rt){this.hasPendingRemoteDataChannel(_e,rt)||this.pendingRemoteDataChannels.push({user:_e,id:rt})}hasPendingRemoteMedia(_e,rt){for(const it of this.pendingRemoteTracks){const{user:ct,kind:ut}=it;if((_e instanceof pv?_e.uid:_e)===ct.uid&&rt===ut)return!0}return!1}setPendingRemoteMedia(_e,rt){this.hasPendingRemoteMedia(_e,rt)||this.pendingRemoteTracks.push({user:_e,kind:rt})}restartICE(_e){var rt=this;return Jp(function*(){if(!rt.connection||rt.state!==qo.Connected)return;const it=yield Bo(rt.mutex.lock("From P2PChannel.restartICE"));let ct;try{ct=yield Bo(rt.connection.restartICE(_e));const pt=yield Bo(ct.next());if(pt.done)return;const mt=pt.value,_t=yield mt;switch(FM(rt.connection)&&rt.reportPCStats(Date.now(),!1,rt._pcStatsUploadType),_e){case hu.UDP_TCP_RELAY:rt._pcStatsUploadType=mE.UDP_TCP_RESTART;break;case hu.TCP_RELAY:rt._pcStatsUploadType=mE.TCP_RESTART;break;case hu.RELAY:rt._pcStatsUploadType=mE.RELAY_RESTART;break;default:rt._pcStatsUploadType=mE.OLD_RESTART}rt._isTryConnecting=!0,ct.next(_t)}catch(pt){var ut;(ut=ct)===null||ut===void 0||ut.throw(pt)}finally{it()}})()}getUplinkNetworkQuality(){if(!this.connection)return 0;const _e=this.connection.getStats(),rt=this.localTrackMap.get(or.LocalVideoTrack),it=this.localTrackMap.get(or.LocalAudioTrack),ct=_e.videoSend.find(Dt=>Dt.ssrc===(rt==null?void 0:rt.ssrcs[0].ssrcId)),ut=_e.audioSend.find(Dt=>Dt.ssrc===(it==null?void 0:it.ssrcs[0].ssrcId));if(!ct||!ut)return 1;const pt=Dp(this,jr.NeedSignalRTT),mt=ct?ct.rttMs:void 0,_t=ut?ut.rttMs:void 0,vt=mt&&_t?(mt+_t)/2:mt||_t,Tt=(vt&&pt?(vt+pt)/2:vt||pt)||0,bt=100*_e.sendPacketLossRate*.7/50+.3*Tt/1500,Ot=bt<.17?1:bt<.36?2:bt<.59?3:bt<.1?4:5,Mt=rt==null?void 0:rt.track;if(Mt&&Mt._encoderConfig&&Mt._hints.indexOf(ds.SCREEN_TRACK)===-1){const Dt=Mt._encoderConfig.bitrateMax,jt=_e.bitrate.actualEncoded;if(Dt&&jt){const $t=(1e3*Dt-jt)/(1e3*Dt);return vV[$t<.15?0:$t<.3?1:$t<.45?2:$t<.6?3:4][Ot]}}return Ot}getDownlinkNetworkQuality(){if(!this.connection)return 0;const _e=this.connection.getStats();let rt=0;return Array.from(this.remoteUserMap.entries()).forEach(it=>{let[ct]=it;const ut=ct._audioSSRC,pt=ct._videoSSRC,mt=_e.audioRecv.find(jt=>jt.ssrc===ut),_t=_e.videoRecv.find(jt=>jt.ssrc===pt);if(!mt&&!_t)return void(rt+=1);const vt=Dp(this,jr.NeedSignalRTT),Tt=_e.rtt,bt=(Tt&&vt?(Tt+vt)/2:Tt||vt)||0,Ot=mt?mt.jitterMs:void 0,Mt=_e.recvPacketLossRate;let Dt=.7*Mt*100/50+.3*bt/1500;Ot&&(Dt=.6*Mt*100/50+.2*bt/1500+.2*Ot/400),rt+=Dt<.1?1:Dt<.17?2:Dt<.36?3:Dt<.59?4:5}),this.remoteUserMap.size>0?Math.round(rt/this.remoteUserMap.size):rt}async muteLocalTrack(_e){return new Ir((rt,it)=>{this.handleMuteLocalTrack(_e,rt,it)})}async replaceTrack(_e,rt){var it;if(Ut.debug("[".concat(this.store.clientId,"] P2PChannel replaceTrack from [").concat(_e.getTrackId(),"] to [").concat(rt.getTrackId(),"]")),!this.connection||this.state!==qo.Connected)return;const ct=Array.from(this.localTrackMap.entries()).find(pt=>{let[,{track:mt}]=pt;return _e===mt});if(!ct)return;const ut=ct[0];if(_e!==rt&&(this.unbindLocalTrackEvents([{track:_e,type:ut}]),this.bindLocalTrackEvents([{track:rt,type:ut}]),ct[1].track=rt),await((it=this.connection)===null||it===void 0?void 0:it.replaceTrack(rt,ct[1].id)),this.isPlanB){const pt=ct[1];pt.id=rt._mediaStreamTrack.id,this.localTrackMap.set(ut,pt)}if(ut===or.LocalVideoTrack&&!rn("DISABLE_DUAL_STREAM_USE_ENCODING")&&Fo().supportDualStreamEncoding){const pt=this.localTrackMap.get(or.LocalVideoLowTrack);if(pt){const mt=_e._mediaStreamTrack.clone();pt.track._originMediaStreamTrack.stop(),pt.track._mediaStreamTrack=mt,pt.track._originMediaStreamTrack=mt,await new Ir((_t,vt)=>{this.handleReplaceTrack(pt.track,_t,vt,!0)})}}}filterTobePublishedTracks(_e,rt,it){const ct=[],ut=this.getAllTracks();_e=fS(_e=_e.filter(vt=>ut.indexOf(vt)===-1));let pt,mt=!1;const _t=this.localTrackMap.get(or.LocalAudioTrack);for(const vt of _e){if(vt instanceof Cs&&(this.localTrackMap.has(or.LocalVideoTrack)||mt?new Yn(tn.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(ct.push({track:vt,type:or.LocalVideoTrack}),mt=!0),rt)){const Tt=this.getLowVideoTrack(vt,it);ct.push({track:Tt,type:or.LocalVideoLowTrack})}if(vt instanceof Ws)if(_t){const Tt=_t.track;if(Tt instanceof yl)UM([vt]),Tt.addAudioTrack(vt),this.bindLocalAudioTrackEvents(vt,!0);else{const bt=BM([Tt,vt]);Ut.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(bt.getTrackId(),"]")),this.replaceTrack(Tt,bt)}}else pt instanceof yl?(UM([vt]),pt.addAudioTrack(vt)):pt||!vt._useAudioElement&&Fo().webAudioMediaStreamDest&&!vt._bypassWebAudio?pt=BM(pt?[vt,pt]:[vt]):pt=vt}return pt&&(Ut.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will send audioTrack [").concat(pt.getTrackId(),"]")),ct.push({track:pt,type:or.LocalAudioTrack})),ct}filterTobeUnpublishedTracks(_e){const rt=[],it=this.getAllTracks();_e=fS(_e=_e.filter(ct=>it.indexOf(ct)!==-1));for(const ct of _e){if(ct instanceof Ws){const ut=this.localTrackMap.get(or.LocalAudioTrack);if(!ut)continue;ut.track instanceof yl?(ut.track.removeAudioTrack(ct),this.unbindLocalAudioTrackEvents(ct),ut.track.trackList.length===0&&(rt.push([or.LocalAudioTrack,ut]),ut.track.close())):rt.push([or.LocalAudioTrack,ut])}if(ct instanceof Cs){const ut=this.localTrackMap.get(or.LocalVideoTrack);if(!ut)continue;rt.push([or.LocalVideoTrack,ut]);const pt=this.localTrackMap.get(or.LocalVideoLowTrack);pt&&rt.push([or.LocalVideoLowTrack,pt])}}return rt}filterTobePublishedDataChannels(_e){return _e=(_e=fS(_e)).filter(rt=>this.localDataChannels.findIndex(it=>it.id===rt.id)===-1)}filterTobeUnpublishedDataChannels(_e){return _e=(_e=(_e=fS(_e)).filter(rt=>this.localDataChannels.indexOf(rt)!==-1)).filter(rt=>rt._originDataChannel)}bindLocalTrackEvents(_e){_e.forEach(rt=>{let{track:it,type:ct}=rt;switch(ct){case or.LocalVideoTrack:it.addListener(Lr.GET_STATS,this.handleGetLocalVideoStats),it.addListener(Lr.GET_RTC_STATS,this.handleGetRTCStats),it.addListener(Lr.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),it.addListener(Lr.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),it.addListener(Lr.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),it.addListener(Lr.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),it.addListener(Lr.NEED_REPLACE_TRACK,this.handleReplaceTrack),it.addListener(Lr.NEED_MUTE_TRACK,this.handleMuteLocalTrack),it.addListener(Lr.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case or.LocalAudioTrack:this.bindLocalAudioTrackEvents(it);case or.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(_e,rt){_e instanceof yl?_e.trackList.forEach(it=>{it.addListener(Lr.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),it.addListener(Lr.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),it.addListener(Lr.GET_STATS,this.handleGetLocalAudioStats),it.addListener(Lr.NEED_MUTE_TRACK,this.handleMuteLocalTrack),it.addListener(Lr.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(_e.addListener(Lr.GET_STATS,this.handleGetLocalAudioStats),_e.addListener(Lr.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),_e.addListener(Lr.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),_e.addListener(Lr.NEED_MUTE_TRACK,this.handleMuteLocalTrack),_e.addListener(Lr.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),rt||(_e.addListener(Lr.NEED_REPLACE_TRACK,this.handleReplaceTrack),_e.addListener(Lr.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack)))}unbindLocalTrackEvents(_e){_e||(_e=Array.from(this.localTrackMap.entries()).map(rt=>{let[it,{track:ct}]=rt;return{track:ct,type:it}})),_e.forEach(rt=>{let{track:it,type:ct}=rt;switch(ct){case or.LocalVideoTrack:it.off(Lr.GET_STATS,this.handleGetLocalVideoStats),it.off(Lr.GET_RTC_STATS,this.handleGetRTCStats),it.off(Lr.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),it.off(Lr.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),it.off(Lr.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),it.off(Lr.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),it.off(Lr.NEED_REPLACE_TRACK,this.handleReplaceTrack),it.off(Lr.NEED_MUTE_TRACK,this.handleMuteLocalTrack),it.off(Lr.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case or.LocalAudioTrack:this.unbindLocalAudioTrackEvents(it);case or.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(_e){_e instanceof yl?_e.trackList.forEach(rt=>{rt.off(Lr.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),rt.off(Lr.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),rt.off(Lr.GET_STATS,this.handleGetLocalAudioStats),rt.off(Lr.NEED_MUTE_TRACK,this.handleMuteLocalTrack),rt.off(Lr.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(_e.off(Lr.GET_STATS,this.handleGetLocalAudioStats),_e.off(Lr.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),_e.off(Lr.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),_e.off(Lr.NEED_REPLACE_TRACK,this.handleReplaceTrack),_e.off(Lr.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack),_e.off(Lr.NEED_MUTE_TRACK,this.handleMuteLocalTrack),_e.off(Lr.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(_e,rt){rt instanceof wS&&rt.addListener(Lr.GET_STATS,it=>{it(this.handleGetRemoteVideoStats(_e))}),rt instanceof IS&&rt.addListener(Lr.GET_STATS,it=>{it(this.handleGetRemoteAudioStats(_e))})}unbindRemoteTrackEvents(_e){_e&&_e.removeAllListeners(Lr.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(_e=>{let[rt,it]=_e;it.has(Pr.AUDIO)&&this.unbindRemoteTrackEvents(rt._audioTrack),it.has(Pr.VIDEO)&&this.unbindRemoteTrackEvents(rt._videoTrack)})}createGatewayPublishMessage(_e,rt){return _e.map((it,ct)=>{var ut;let pt,mt,{track:_t,type:vt}=it;switch(vt){case or.LocalAudioTrack:pt=es.Audio,mt={dtx:_t instanceof SA&&_t._config.DTX,hq:!1,lq:!1,stereo:!1,speech:!1};break;case or.LocalVideoTrack:pt=Er(ut=_t._hints).call(ut,ds.SCREEN_TRACK)?es.Screen:es.High,mt=F_(F_({},LV(_t)),{},{codec:this.store.codec,svc_mode:Hw()});break;case or.LocalVideoLowTrack:pt=es.Low,mt=F_(F_({},LV(_t)),{},{codec:this.store.codec,svc_mode:Hw()})}return{stream_type:pt,attributes:mt,ssrcs:rt[ct]}})}createGatewayUnpublishMessage(_e){return _e.map(rt=>{var it;let ct,[ut,{track:pt,ssrcs:mt,id:_t}]=rt;switch(ut){case or.LocalVideoTrack:ct=Er(it=pt._hints).call(it,ds.SCREEN_TRACK)?es.Screen:es.High;break;case or.LocalAudioTrack:ct=es.Audio;break;case or.LocalVideoLowTrack:ct=es.Low}return{stream_type:ct,ssrcs:mt,mid:_t}})}assignLocalTracks(_e,rt){_e.forEach((it,ct)=>{let{track:ut,type:pt}=it;this.localTrackMap.set(pt,{track:ut,id:rt[ct].id,ssrcs:rt[ct].localSSRC})})}withdrawLocalTracks(_e){_e.forEach(rt=>{let[it]=rt;this.localTrackMap.delete(it)})}bindConnectionEvents(_e){_e.onConnectionStateChange=async rt=>{if(Ut.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onConnectionStateChange(").concat(rt,")")),this.emit(jr.PeerConnectionStateChange,rt),rt==="connecting"&&_e instanceof nm&&!Gs()&&rn("FIRST_TCP_CANDIDATE")&&window.setTimeout(()=>{rt==="connecting"&&_e.extendCandidate()},rn("FIRST_TCP_CANDIDATE_INTERVAL")),rt!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),rt==="connected"&&(this._restartTimer&&(window.clearTimeout(this._restartTimer),this._restartTimer=void 0),_e instanceof nm&&O4(_e,!0),this._isTryConnecting&&this.reportPCStats(Date.now(),!0,this._pcStatsUploadType),this._isTryConnecting=!1,this._isStartRestartIce=!1,this._pcStatsUploadType=mE.DISCONNECTED_OR_FAILED,Dp(this,jr.QueryClientConnectionState)==="CONNECTED"&&this._isWaitPcToRePub)){const it=this.pendingLocalTracks.map(ut=>ut.getTrackId()),ct=this.pendingLocalDataChannels.map(ut=>"dc_".concat(ut.id));Vr.reportApiInvoke(this.store.sessionId,{name:Ks.REPUB_AFTER_PC_CONNECTED,options:it.concat(ct),tag:Ns.TRACER}).onSuccess(),this.republish()}if(rn("NEW_ICE_RESTART")&&_e instanceof nm&&!Gs()&&!this._forceTurn){if(Er(xV).call(xV,rt)){if(this._isStartRestartIce)return;this._isStartRestartIce=!0;const it=ut=>{FM(_e)&&(Ut.debug("[".concat(this.store.clientId,"] [P2PChannel] try to restartICE, type is ").concat(ut)),Dp(this,jr.QueryClientConnectionState)==="CONNECTED"&&this.emit(jr.RequestRestartICE,ut))},ct=()=>{FM(_e)&&(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),Ut.debug("[".concat(this.store.clientId,"] P2PConnection disconnected timeout, force reconnect")),setTimeout(()=>this.emit(jr.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())};return void(this._restartTimer=window.setTimeout(()=>{M4(_e,it,ct)},800))}}else{if(rt==="disconnected"&&_e.iceConnectionState==="disconnected")return setTimeout(()=>{_e.iceConnectionState==="disconnected"&&rn("ICE_RESTART")&&Dp(this,jr.QueryClientConnectionState)==="CONNECTED"&&this.emit(jr.RequestRestartICE)},800),void setTimeout(()=>{_e.peerConnectionState==="disconnected"&&(Ut.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection disconnected timeout 4000ms, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isTryConnecting=!1,setTimeout(()=>this.emit(jr.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())},4e3);rt==="failed"&&(Ut.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection state failed, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),setTimeout(()=>this.emit(jr.P2PLost),0),this.iceFailedCount+=1,await this.requestReconnect())}},_e.onICEConnectionStateChange=rt=>{rt!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),Ut.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(rt,")")),Vr.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:rt,tag:Ns.TRACER}).onSuccess(),this.emit(jr.IceConnectionStateChange,rt)},_e.onICETransportStateChange=rt=>{Ut.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(rt,")"))},_e.onDTLSTransportStateChange=rt=>{Ut.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(rt,")"))},_e.onDTLSTransportError=rt=>{Ut.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(rt,")"))},_e.onFirstAudioDecoded=rt=>{var it;const ct=Array.from(sp(it=this.remoteUserMap).call(it)).find(pt=>pt._audioSSRC===rt);var ut;ct&&(this.store.subscribe(ct.uid,"audio",void 0,void 0,void 0,Date.now()),(ut=ct.audioTrack)===null||ut===void 0||ut.emit(_f.FIRST_FRAME_DECODED),Vr.firstRemoteFrame(this.store.sessionId,Rl.FIRST_AUDIO_DECODE,Os.FIRST_AUDIO_DECODE,{peer:ct._uintid,subscribeElapse:pu.measureFromSubscribeStart(this.store.clientId,rt),subscribeRequestid:rt,p2pid:this.store.p2pId}))},_e.onFirstAudioReceived=rt=>{var it;const ct=Array.from(sp(it=this.remoteUserMap).call(it)).find(ut=>ut._audioSSRC===rt);ct&&Vr.firstRemoteFrame(this.store.sessionId,Rl.FIRST_AUDIO_RECEIVED,Os.FIRST_AUDIO_RECEIVED,{peer:ct._uintid,subscribeElapse:pu.measureFromSubscribeStart(this.store.clientId,rt),subscribeRequestid:rt,p2pid:this.store.p2pId})},_e.onFirstVideoDecoded=(rt,it,ct)=>{var ut;const pt=Array.from(sp(ut=this.remoteUserMap).call(ut)).find(mt=>mt._videoSSRC===rt);pt&&this.store.firstVideoFrameDecoded(pt.uid,{firstDecoded:Date.now()}),this.reportVideoFirstFrameDecoded(rt,it,ct)},_e.onFirstVideoRender=rt=>{var it;const ct=Array.from(sp(it=this.remoteUserMap).call(it)).find(ut=>ut._videoSSRC===rt);ct&&(this.store.firstVideoFrameDecoded(ct.uid,{firstPreRender:Date.now()}),this.reportVideoFirstFrameRender(ct))},_e.onFirstVideoReceived=rt=>{var it;const ct=Array.from(sp(it=this.remoteUserMap).call(it)).find(ut=>ut._videoSSRC===rt);ct&&(this.store.firstVideoFrameDecoded(ct.uid,{firstReceived:Date.now()}),Vr.firstRemoteFrame(this.store.sessionId,Rl.FIRST_VIDEO_RECEIVED,Os.FIRST_VIDEO_RECEIVED,{peer:ct._uintid,subscribeElapse:pu.measureFromSubscribeStart(this.store.clientId,rt),subscribeRequestid:rt,p2pid:this.store.p2pId}))},_e.onSelectedLocalCandidateChanged=(rt,it)=>{const ct=rt.candidateType==="relay",ut=it.candidateType==="relay";it.candidateType!=="unknown"&&ct===ut||this.emit(jr.ConnectionTypeChange,ct),Ut.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(cv(it))," -> ").concat(JSON.stringify(cv(rt)),")"))},_e.onSelectedRemoteCandidateChanged=(rt,it)=>{Ut.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(cv(it))," -> ").concat(JSON.stringify(cv(rt)),")"))},_e.onFirstVideoDecodedTimeout=rt=>{this.reportVideoFirstFrameDecoded(rt,void 0,void 0,!0)},_e.getLocalVideoStats=()=>{const rt=this.statsCollector.getLocalVideoTrackStats(),it=this.statsCollector.getRTCStats();return F_(F_({},rt),it)},_e.onICECandidateError=rt=>{this._iceError=rt}}resetConnection(_e){_e instanceof nm&&function(rt){GS.delete(rt.id),O4(rt)}(_e),_e.close(),this.emit(jr.PeerConnectionStateChange,"closed"),function(rt){rt.onConnectionStateChange=void 0,rt.onICEConnectionStateChange=void 0,rt.onICETransportStateChange=void 0,rt.onDTLSTransportStateChange=void 0,rt.onDTLSTransportError=void 0,rt.onFirstAudioDecoded=void 0,rt.onFirstAudioReceived=void 0,rt.onFirstVideoDecoded=void 0,rt.onFirstVideoReceived=void 0,rt.onSelectedLocalCandidateChanged=void 0,rt.onSelectedRemoteCandidateChanged=void 0,rt.onFirstVideoDecodedTimeout=void 0,rt.getLocalVideoStats=void 0}(_e),this._isWaitPcToRePub=!1}filterTobeMutedTracks(_e){const rt=[];if(this.getAllTracks().indexOf(_e)===-1)return rt;const it=this.localTrackMap.get(or.LocalAudioTrack);if(_e instanceof Ws&&(it==null?void 0:it.track)instanceof yl)return it.track.isActive||rt.push([or.LocalAudioTrack,it]),rt;const ct=Array.from(this.localTrackMap.entries()).find(ut=>{let[,{track:pt}]=ut;return _e===pt});if(ct&&(rt.push(ct),ct[0]===or.LocalVideoTrack)){const ut=this.localTrackMap.get(or.LocalVideoLowTrack);ut&&rt.push([or.LocalVideoLowTrack,ut])}return rt}filterTobeUnmutedTracks(_e){const rt=[],it=this.localTrackMap.get(or.LocalAudioTrack);if(_e instanceof Ws&&(it==null?void 0:it.track)instanceof yl)return it.track.isActive&&rt.push([or.LocalAudioTrack,it]),rt;const ct=Array.from(this.localTrackMap.entries()).find(ut=>{let[,{track:pt}]=ut;return _e===pt});if(ct)if(ct[0]===or.LocalVideoTrack){rt.push(ct);const ut=this.localTrackMap.get(or.LocalVideoLowTrack);ut&&rt.push([or.LocalVideoLowTrack,ut])}else rt.push(ct);return rt}createMuteMessage(_e){return _e.map(rt=>{var it;let ct,[ut,{track:pt,ssrcs:mt,id:_t}]=rt;switch(ut){case or.LocalAudioTrack:ct=es.Audio;break;case or.LocalVideoTrack:ct=Er(it=pt._hints).call(it,ds.SCREEN_TRACK)?es.Screen:es.High;break;case or.LocalVideoLowTrack:ct=es.Low}return{stream_type:ct,ssrcs:mt,mid:_t}})}createUnmuteMessage(_e){return _e.map(rt=>{var it;let ct,[ut,{track:pt,ssrcs:mt,id:_t}]=rt;switch(ut){case or.LocalAudioTrack:ct=es.Audio;break;case or.LocalVideoTrack:ct=Er(it=pt._hints).call(it,ds.SCREEN_TRACK)?es.Screen:es.High;break;case or.LocalVideoLowTrack:ct=es.Low}return{stream_type:ct,ssrcs:mt,mid:_t}})}filterTobeUnSubscribedTracks(_e,rt){const it=[],ct=this.remoteUserMap.get(_e);if(!ct)return it;if(rt){const ut=ct.get(rt);if(!ut)return it;it.push([_e,{kind:rt,id:ut}])}else Array.from(ct.entries()).forEach(ut=>{let[pt,mt]=ut;it.push([_e,{kind:pt,id:mt}])});return it}filterTobeUnSubscribedDataChannels(_e,rt){const it=[];return rt.forEach(ct=>{var ut;(ut=this.remoteDataChannelMap.get(_e))!==null&&ut!==void 0&&ut.has(ct.id)&&it.push(ct)}),it}createUnsubscribeMessage(_e){const rt=[];return _e.forEach(it=>{let[ct,{kind:ut,id:pt}]=it;switch(ut){case Pr.VIDEO:return void(ct._videoSSRC&&rt.push({stream_type:Pr.VIDEO,ssrcId:ct._videoSSRC}));case Pr.AUDIO:return void(ct._audioSSRC&&rt.push({stream_type:Pr.AUDIO,ssrcId:ct._audioSSRC}))}}),rt}createUnsubscribeAllMessage(_e){const rt=new Map;return _e.forEach(it=>{let[ct,{kind:ut}]=it;if(rt.has(ct)){let pt=rt.get(ct);ut===Pr.VIDEO?pt|=Dl.Video:pt|=Dl.Audio,rt.set(ct,pt)}else ut===Pr.VIDEO?rt.set(ct,Dl.Video):rt.set(ct,Dl.Audio)}),{users:Array.from(rt.entries()).map(it=>{let[ct,ut]=it;return{stream_id:ct.uid,stream_type:ut}})}}withdrawRemoteTracks(_e){_e.forEach(rt=>{let[it,{kind:ct}]=rt;const ut=this.remoteUserMap.get(it);ut&&(ut.delete(ct),Array.from(ut.entries()).length===0&&this.remoteUserMap.delete(it))})}async updateBitrateLimit(_e){const rt=this.localTrackMap.get(or.LocalVideoTrack),it=this.localTrackMap.get(or.LocalVideoLowTrack);rt&&(await rt.track.setBitrateLimit(_e.uplink),await new Ir((ct,ut)=>{this.handleUpdateVideoEncoder(rt.track,ct,ut,!0)})),it&&_e.low_stream_uplink&&(await it.track.setBitrateLimit({max_bitrate:_e.low_stream_uplink.bitrate,min_bitrate:_e.low_stream_uplink.bitrate||0}),await new Ir((ct,ut)=>{this.handleUpdateVideoEncoder(it.track,ct,ut,!0)}))}isP2PDisconnected(){return this.connection?this.connection.peerConnectionState!=="connected":!0}isPreallocation(){return this.connection instanceof nm&&this.connection.isPreallocation}isPreSub(){return this.connection instanceof nm&&this.connection.isPreSub()}mapPubResToRemoteConfig(_e,rt,it){return _e.map((ct,ut)=>{var pt;let{stream_type:mt}=ct;const _t=(pt=rt.find(vt=>{let{stream_type:Tt}=vt;return mt===Tt}))===null||pt===void 0?void 0:pt.attributes;if(_t&&rn("DISABLE_SCREEN_SHARE_REMB")){const vt=it[ut]._hints;(Er(vt).call(vt,ds.SCREEN_TRACK)||Er(vt).call(vt,ds.SCREEN_LOW_TRACK))&&(_t.remb=!1,Ut.debug("disable remb for screen share, hints:",vt))}return _t})}async tryToUnmuteAudio(_e){for(let it=0;it<_e.length;it++)if(_e[it]instanceof Ws){var rt;const ct=this.filterTobeUnmutedTracks(_e[it]);if(ct.length===0)continue;await((rt=this.connection)===null||rt===void 0?void 0:rt.unmuteLocal(ct.map(pt=>{let[,{id:mt}]=pt;return mt})));const ut=this.createUnmuteMessage(ct);return void await ps(this,jr.RequestUnmuteLocal,ut)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=()=>this.getStats(),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=_e=>{var rt;return!((rt=this.connection)===null||rt===void 0||!rt.getRemoteVideoIsReady(_e))},this.statsUploader.requestUpload=(_e,rt)=>this.emit(jr.RequestUpload,_e,rt),this.statsUploader.requestUploadStats=_e=>this.emit(jr.RequestUploadStats,_e),this.statsUploader.requestAllTracks=()=>this.getAllTracks(),this.statsUploader.requestTransportStats=()=>{var _e;return{connectState:((_e=this.connection)===null||_e===void 0?void 0:_e.peerConnectionState)||"closed"}}}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await zl(CO(this.dtlsFailedCount,xa)),this.emit(jr.RequestReconnect)}async reconnectP2P(){const _e=Array.from(this.localTrackMap.entries()),rt=this.createGatewayUnpublishMessage(_e);Array.from(this.remoteUserMap.entries()),rt.length>0&&await ru(this,jr.RequestUnpublishForReconnectPC,rt),this.disconnectForReconnect(),this.emit(jr.RequestReconnectPC)}canPublishLowStream(){return this.localTrackMap.has(or.LocalVideoTrack)||this.pendingLocalTracks.some(_e=>_e instanceof Cs)}throwIfTrackTypeNotMatch(_e){if(_e.filter(rt=>rt instanceof Cs).length>1)throw new Yn(tn.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(_e.filter(rt=>rt instanceof Ws).length>1&&(_e.some(rt=>rt instanceof Ws&&rt._bypassWebAudio)||!Fo().webAudioMediaStreamDest))throw new Yn(tn.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const rt of _e){if(rt instanceof Cs&&this.pendingLocalTracks.some(it=>it instanceof Cs))throw new Yn(tn.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(rt instanceof Ws&&this.pendingLocalTracks.some(it=>it instanceof Ws)&&(!Fo().webAudioMediaStreamDest||rt._bypassWebAudio||this.pendingLocalTracks.some(it=>it instanceof Ws&&it._bypassWebAudio)))throw new Yn(tn.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(_e,rt){var it;const ct=!rn("DISABLE_DUAL_STREAM_USE_ENCODING")&&Fo().supportDualStreamEncoding,ut=F_(F_({},{width:160,height:120,framerate:15,bitrate:50}),rt);let pt;pt=ct?_e._mediaStreamTrack.clone():VM(_e,ut);const mt=ms(8,"track-low-"),_t=new Cs(pt,F_(F_({},ct&&{scaleResolutionDownBy:yM(ut,_e)}),{},{frameRate:ut.framerate,bitrateMax:ut.bitrate,bitrateMin:ut.bitrate}),void 0,void 0,mt);return _t.on(v0.TRANSCEIVER_UPDATED,vt=>{_e._updateRtpTransceiver(vt,SS.LOW_STREAM)}),_t._hints.push(ds.LOW_STREAM),Er(it=_e._hints).call(it,ds.SCREEN_TRACK)&&_t._hints.push(ds.SCREEN_LOW_TRACK),_e.on("sei-to-send",vt=>{_t.emit("sei-to-send",vt)}),_e.addListener(Lr.NEED_CLOSE,()=>{_t.close()}),_t}async globalLock(){return this.mutex.lock("From P2PChannel.globalLock")}async reportPCStats(_e,rt,it){let ct=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;if(this.connection&&this.connection instanceof nm){var ut,pt,mt,_t;const vt=this.store.keyMetrics.descriptionStart||0,{iceConnectionState:Tt,dtlsTransportState:bt,peerConnectionState:Ot}=this.connection,{local:Mt,remote:Dt}=await this.connection.getSelectedCandidatePair();Vr.pcStats(this.store.sessionId,{startTime:vt,eventElapse:_e-vt||0,iceconnectionsate:Tt,dtlsstate:bt,connectionstate:Ot,intSucc:rt?1:2,error:this._iceError||ct||"",selectedLocalCandidateProtocol:(ut=Mt==null?void 0:Mt.protocol)!==null&&ut!==void 0?ut:"",selectedLocalCandidateType:(pt=Mt.candidateType)!==null&&pt!==void 0?pt:"",selectedLocalCandidateAddress:"".concat(Mt.address,":").concat(Mt.port),selectedRemoteCandidateProtocol:(mt=Dt.protocol)!==null&&mt!==void 0?mt:"",selectedRemoteCandidateType:(_t=Dt.candidateType)!==null&&_t!==void 0?_t:"",selectedRemoteCandidateAddress:"".concat(Dt.address,":").concat(Dt.port),restartCnt:it,preallocation:this.connection.isPreallocation}),this._iceError=null}}reportVideoFirstFrameRender(_e){const rt=this.store.keyMetrics,it=rt.firstVideoFrameDecoded.find(bt=>bt.userId===_e.uid);if(!it)return;const{isInternalUpload:ct,isExternalUpload:ut}=it;if(ct&&ut)return;const{subscribeEnd:pt,firstPreRender:mt,peerPublishDuration:_t,peerPubStatusMs:vt}=it;let{firstRender:Tt=0}=it;if(pt&&(Tt||mt)&&_t&&vt){it.isInternalUpload=!0;const{playEnd:bt}=it;bt&&(it.isExternalUpload=!0);const{firstPreRender:Ot=0}=it;Tt=Ot||Tt;const Mt=_e.videoTrack,Dt={peer:_e._uintid,width:(Mt==null?void 0:Mt._videoWidth)||0,height:(Mt==null?void 0:Mt._videoHeight)||0,ssrc:_e._videoSSRC||0,p2pid:this.store.p2pId,peerPublishDuration:_t,peerPubStatusMs:vt,joinChannelStart:rt.joinStart||0,preloadStart:rt.preloadStart||0,preloadEnd:rt.preloadEnd||0,apStart:rt.requestAPStart||0,apEnd:rt.requestAPEnd||0,suaEnd:rt.requestSUAEnd||0,beforeConnect:rt.beforeConnect||0,peerReceiver:rt.peerReceiver||0,ice:rt.iceConnectionEnd||0,pc:rt.peerConnectionEnd||0,signalConnected:rt.signalConnected||0,joinReq:rt.joinReq||0,joinRes:rt.joinRep||0,userJoinNotify:it.userJoinNotify||0,videoAddNotify:it.videoAddNotify||0,subscribeStart:it.subscribeStart||0,subscribeEnd:it.subscribeEnd||0,firstReceived:it.firstReceived||0,firstDecoded:it.firstDecoded||0,firstPreRender:Ot||0,firstRender:bt?Math.max(Tt,bt):Math.max(Tt,pt),playStart:it.playStart||0,playEnd:it.playEnd||0,isPreSub:!(!_e._videoSSRC||!this.isPreSubScribe(_e._videoSSRC)),isPrePc:this.isPreallocation(),isPreInstantVideo:oB(this.store)};Vr.firstXLAPeerFirstVideoFrame(this.store.sessionId,Dt)}}reportVideoFirstFrameDecoded(_e,rt,it,ct){var ut;const pt=Array.from(sp(ut=this.remoteUserMap).call(ut)).find(mt=>mt._videoSSRC===_e);if(pt){ct||this.store.subscribe(pt.uid,"video",void 0,void 0,void 0,void 0,Date.now());const mt=this.store.keyMetrics,_t=mt.subscribe.find(vt=>vt.userId===pt.uid&&vt.type==="video");Vr.firstRemoteVideoDecode(this.store.sessionId,Rl.FIRST_VIDEO_DECODE,Os.FIRST_VIDEO_DECODE,{peer:pt._uintid,videowidth:rt,videoheight:it,subscribeElapse:pu.measureFromSubscribeStart(this.store.clientId,_e),subscribeRequestid:_e,p2pid:this.store.p2pId,apEnd:mt.requestAPEnd||0,apStart:mt.requestAPStart||0,joinGwEnd:mt.joinGatewayEnd||0,joinGwStart:mt.joinGatewayStart||0,pcEnd:mt.peerConnectionEnd||0,pcStart:mt.peerConnectionStart||0,subscriberEnd:(_t==null?void 0:_t.subscribeEnd)||0,subscriberStart:(_t==null?void 0:_t.subscribeStart)||0,videoAddNotify:(_t==null?void 0:_t.streamAdded)||0,state:ct?1:0,firstFrame:(_t==null?void 0:_t.firstFrame)||0})}}async remoteMediaSsrcChanged(_e,rt,it){if(!this.connection)return!1;const ct=this.remoteUserMap.get(_e);if(!ct)return!1;const ut=ct.get(rt);if(!ut)return!1;const pt=await this.connection.getRemoteSSRC(ut);return pt!==void 0&&pt!==it}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(_e=>{let[rt,{track:it}]=_e;rt===or.LocalVideoLowTrack?it._updateRtpTransceiver(void 0,SS.LOW_STREAM):it._updateRtpTransceiver(void 0)})}},Br(Co.prototype,"startP2PConnection",[xu],Object.getOwnPropertyDescriptor(Co.prototype,"startP2PConnection"),Co.prototype),Br(Co.prototype,"connect",[xu],Object.getOwnPropertyDescriptor(Co.prototype,"connect"),Co.prototype),Br(Co.prototype,"updateRemoteRTPCapabilities",[xu],Object.getOwnPropertyDescriptor(Co.prototype,"updateRemoteRTPCapabilities"),Co.prototype),Br(Co.prototype,"publishDataChannel",[xu],Object.getOwnPropertyDescriptor(Co.prototype,"publishDataChannel"),Co.prototype),Br(Co.prototype,"unpublish",[xu],Object.getOwnPropertyDescriptor(Co.prototype,"unpublish"),Co.prototype),Br(Co.prototype,"unpublishDataChannel",[xu],Object.getOwnPropertyDescriptor(Co.prototype,"unpublishDataChannel"),Co.prototype),Br(Co.prototype,"unpublishLowStream",[xu],Object.getOwnPropertyDescriptor(Co.prototype,"unpublishLowStream"),Co.prototype),Br(Co.prototype,"subscribeDataChannel",[xu],Object.getOwnPropertyDescriptor(Co.prototype,"subscribeDataChannel"),Co.prototype),Br(Co.prototype,"subscribe",[xu],Object.getOwnPropertyDescriptor(Co.prototype,"subscribe"),Co.prototype),Br(Co.prototype,"massSubscribe",[xu],Object.getOwnPropertyDescriptor(Co.prototype,"massSubscribe"),Co.prototype),Br(Co.prototype,"unsubscribe",[xu],Object.getOwnPropertyDescriptor(Co.prototype,"unsubscribe"),Co.prototype),Br(Co.prototype,"unsubscribeDataChannel",[xu],Object.getOwnPropertyDescriptor(Co.prototype,"unsubscribeDataChannel"),Co.prototype),Br(Co.prototype,"massUnsubscribe",[xu],Object.getOwnPropertyDescriptor(Co.prototype,"massUnsubscribe"),Co.prototype),Br(Co.prototype,"muteRemote",[xu],Object.getOwnPropertyDescriptor(Co.prototype,"muteRemote"),Co.prototype),Br(Co.prototype,"unmuteRemote",[xu],Object.getOwnPropertyDescriptor(Co.prototype,"unmuteRemote"),Co.prototype),Br(Co.prototype,"hasRemoteMediaWithLock",[xu],Object.getOwnPropertyDescriptor(Co.prototype,"hasRemoteMediaWithLock"),Co.prototype),Br(Co.prototype,"disconnectForReconnect",[xu],Object.getOwnPropertyDescriptor(Co.prototype,"disconnectForReconnect"),Co.prototype),Br(Co.prototype,"updateBitrateLimit",[xu],Object.getOwnPropertyDescriptor(Co.prototype,"updateBitrateLimit"),Co.prototype),Br(Co.prototype,"remoteMediaSsrcChanged",[xu],Object.getOwnPropertyDescriptor(Co.prototype,"remoteMediaSsrcChanged"),Co.prototype),Co);function xu(_e,rt,it){const ct=_e[rt];if(typeof ct!="function")throw new Error("Cannot use mutex on object property.");return it.value=async function(){const ut=this.mutex,pt=await ut.lock("From P2PChannel.".concat(rt));try{for(var mt=arguments.length,_t=new Array(mt),vt=0;vt<mt;vt++)_t[vt]=arguments[vt];return await ct.apply(this,_t)}finally{pt()}},it}function D4(_e,rt){var it=Object.keys(_e);if(Object.getOwnPropertySymbols){var ct=Object.getOwnPropertySymbols(_e);rt&&(ct=ct.filter(function(ut){return Object.getOwnPropertyDescriptor(_e,ut).enumerable})),it.push.apply(it,ct)}return it}function L4(_e){for(var rt=1;rt<arguments.length;rt++){var it=arguments[rt]!=null?arguments[rt]:{};rt%2?D4(Object(it),!0).forEach(function(ct){Jt(_e,ct,it[ct])}):Object.getOwnPropertyDescriptors?Object.defineProperties(_e,Object.getOwnPropertyDescriptors(it)):D4(Object(it)).forEach(function(ct){Object.defineProperty(_e,ct,Object.getOwnPropertyDescriptor(it,ct))})}return _e}const nq=Date.now(),rq=20,$M=new Map,c1=new Map;async function k4(_e){const rt=$M.get(_e),it=Array.isArray(rt)&&rt[rt.length-1],ct=c1.get(_e);if(!it)return void(ct.isSyncing=!1);const ut={uid:it.uid,payload:it.payload};ct.firstRecvTs===0&&(ct.firstRecvTs=it.recvTs,ct.firstSendTs=it.sendTs);const pt=it.sendTs-ct.firstSendTs,mt=pt-(Date.now()-ct.firstRecvTs);mt>0&&(ct.firstRecvTs=Date.now()-pt);let _t=it.mediaDelay+mt;_t<=0?(rt.pop(),U4(it.context,ut),_t=0):_t=Math.min(_t,rq),setTimeout(()=>rt.length&&k4(_e),_t)}function U4(_e,rt){_e.safeEmit(wo.STREAM_MESSAGE,rt.uid,rt.payload),_e.onStreamMessage&&_e.onStreamMessage(rt)}function iq(_e){let rt=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,it=arguments.length>2?arguments[2]:void 0;if(!_e.syncWithAudio)return U4(it,{uid:_e.uid,payload:_e.payload});const ct="".concat(it.id,"-").concat(_e.uid),ut=$M.get(ct)||[],pt=ut.findIndex(Tt=>_e.sendTs>=Tt.sendTs),mt=L4(L4({},_e),{},{context:it,mediaDelay:rt,recvTs:Date.now()});pt===-1?ut.push(mt):ut.splice(pt,0,mt),$M.set(ct,ut);let _t=!1;var vt;c1.has(ct)?_t=!((vt=c1.get(ct))===null||vt===void 0||!vt.isSyncing):c1.set(ct,{isSyncing:_t,firstRecvTs:0,firstSendTs:0}),_t||k4(ct)}const oq=No().name;function B4(_e,rt){var it=Object.keys(_e);if(Object.getOwnPropertySymbols){var ct=Object.getOwnPropertySymbols(_e);rt&&(ct=ct.filter(function(ut){return Object.getOwnPropertyDescriptor(_e,ut).enumerable})),it.push.apply(it,ct)}return it}function F4(_e){for(var rt=1;rt<arguments.length;rt++){var it=arguments[rt]!=null?arguments[rt]:{};rt%2?B4(Object(it),!0).forEach(function(ct){Jt(_e,ct,it[ct])}):Object.getOwnPropertyDescriptors?Object.defineProperties(_e,Object.getOwnPropertyDescriptors(it)):B4(Object(it)).forEach(function(ct){Object.defineProperty(_e,ct,Object.getOwnPropertyDescriptor(it,ct))})}return _e}const $S="websdk_ng_cache_parameter",sq=rn("MAX_PRELOAD_ASYNC_LENGTH"),aq=1e4,x0=new Map,O0=[];let HM=null,jM=0,zM=0;const l1=new Map,cq=function(_e,rt){const it=[];let ct=0;const ut=async()=>{const pt=it.shift();pt&&await pt(),it.length>0&&ct<rt?ut():ct--};return async function(){for(var pt=arguments.length,mt=new Array(pt),_t=0;_t<pt;_t++)mt[_t]=arguments[_t];return new Ir(async(vt,Tt)=>{it.push(async()=>{try{const bt=await _e(...mt);vt(bt)}catch(bt){Tt(bt)}}),ct<rt&&(ct++,ut())})}}(V4,sq),WM=Xu.CancelToken.source();async function V4(_e,rt,it,ct,ut,pt){try{if(!rn("ENABLE_PRELOAD"))return;if(!Fo().supportWebCrypto)return void tv(()=>{Ut.warn("Your browser does not support preloading, this feature  be run in a secure environment")},"preload_webcrypto_not_supported");if(!it&&it!==null)throw new Yn(tn.INVALID_PARAMS,"Invalid token: ".concat(it,". If you don not use token, set it to null"));it&&Hl(it,"token",1,2047),Hl(_e,"appid",1,2047),Uw(rt),ct&&Bw(ct);const mt=_0();Ut.debug("preload channel ".concat(rt,", uid is ").concat(ct));const _t={appId:_e,cname:rt,token:it||_e,uid:typeof ct!="string"?ct:null,sid:mt,proxyServer:ut};let vt,Tt;typeof ct=="string"?(_t.stringUid=ct,[Tt,vt]=await Ir.all([zX(ct,{sid:mt,appId:_e},WM.token),h4(F4(F4({},_t),{},{token:it||_e,uid:0}),WM.token)]),_t.uid=Tt.uid,vt.gatewayInfo.uid=_t.uid,vt.gatewayInfo.res.uid=_t.uid):(pt&&(_t.stringUid=pt),vt=await h4(_t,WM.token));const bt={sid:mt,appId:_e,cname:rt,token:it||_e,uid:_t.stringUid||ct,intUid:_t.uid||vt.gatewayInfo.uid,stringUid:_t.stringUid,ts:Date.now(),sua:Tt,ap:vt};await async function(Ot){let Mt;try{Ot.uid&&$4({appId:Ot.appId,cname:Ot.cname,token:Ot.token,uid:Ot.uid,stringUid:Ot.stringUid});const Dt=W4(Ot),jt=await async function(Ht,en){try{const Qt=await window.crypto.subtle.importKey("raw",P3(en),"AES-GCM",!1,["encrypt"]),on=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:new Uint8Array(1)},Qt,g0(window.btoa(JSON.stringify(Ht))));return nv(new Uint8Array(on))}catch{return}}(Ot,Ot.token||Ot.appId);if(!jt)return;Mt=z4($S);const $t=Mt?JSON.parse(Mt):[];$t.push({[Dt]:jt}),$t.length>rn("AP_CACHE_NUM")&&$t.shift(),u1($S,JSON.stringify($t))}catch(Dt){Ut.warn("Error caching server parameters:",Dt.message),u1($S,"")}}(bt),jM++}catch(mt){throw zM++,function(_t){HM||(HM=window.setTimeout(()=>{let Tt="";l1.forEach((bt,Ot)=>{Tt+="".concat(Ot,": ").concat(bt," ;")}),Vr.reportApiInvoke(null,{name:Ks.PRELOAD,options:{success:jM,failed:zM,err:Tt}}).onError(_t),jM=0,zM=0,l1.clear(),HM=null},aq));const vt=l1.get(_t.code)||0;l1.set(_t.code,vt+1)}(mt),mt}}async function G4(_e){try{if(rn("AP_REQUEST_DETAIL")||rn("ENABLE_ROLE_SELECT_EDGE"))return;const rt=$4(_e);if(!rt||_e.cloudProxyServer!=="disabled")return;const it=await async function(ct,ut){try{const pt=await window.crypto.subtle.importKey("raw",P3(ut),"AES-GCM",!1,["decrypt"]),mt=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:new Uint8Array(1)},pt,g0(ct));return JSON.parse(window.atob(nv(new Uint8Array(mt))))}catch{return}}(rt,_e.token||_e.appId);if(!it||!function(ct,ut){return ct.cname===ut.cname&&ct.appId===ut.appId&&ct.token===ut.token?ut.stringUid?ct.stringUid===ut.stringUid:typeof ut.uid=="number"?ct.uid===ut.uid:ct.uid==ut.uid:!1}(it,_e))return;if(it&&Date.now()-it.ts<rn("AP_CACHE_LIFETIME"))return it}catch(rt){Ut.warn("Error get preloadInfo",rt.message)}}function $4(_e){let rt;try{if(rt=z4($S),!rt)return;const it=JSON.parse(rt),ct=W4(_e),ut=function(mt,_t){for(let vt=mt.length-1;vt>=0;vt--)if(_t(mt[vt]))return vt;return-1}(it,mt=>ct in mt);if(ut===-1)return;const pt=it.splice(ut,1)[0];return u1($S,JSON.stringify(it)),pt[ct]}catch(it){Ut.warn("Error delete preload info: ".concat(rt),it.message),u1($S,"")}}function KM(_e){if(_e){let rt=x0.get(_e);rt&&(window.clearTimeout(rt),rt=null,x0.delete(_e)),Er(O0).call(O0,_e)||_e.cloudProxyServer!=="disabled"||O0.push(_e)}if(x0.size<rn("AP_CACHE_NUM")&&O0.length>0){const rt=O0.shift();x0.set(rt,window.setTimeout(async()=>{const{appId:it,cname:ct,token:ut,stringUid:pt,uid:mt,proxyServer:_t}=rt;try{await cq(it,ct,ut,mt,_t,pt),x0.has(rt)&&KM(rt)}catch(vt){Ut.warn("update preload failed",vt.message),H4(rt)}},rn("AP_UPDATE_INTERVAL")))}}function H4(_e){const rt=O0.indexOf(_e);rt!==-1&&O0.splice(rt,1);let it=x0.get(_e);it&&(window.clearTimeout(it),it=null,x0.delete(_e),KM())}function j4(_e,rt){const it=_e.sua,ct=_e.ap;rt&&it&&Vr.reqUserAccount(_e.sid,{lts:it.requestTime,elapse:it.elapse,success:!0,serverAddr:it.url,stringUid:rt,uid:_e.intUid,errorCode:null,extend:it.req}),Vr.reportResourceTiming(_e.ap.url,_e.sid),Vr.joinWebProxyAP(_e.sid,{lts:ct.requestTime,elapse:ct.elapse,sucess:1,apServerAddr:ct.url,turnServerAddrList:ct.proxyInfo.addresses.map(ut=>ut.ip).join(","),eventType:"disabled",unilbsServerIds:[na.CHOOSE_SERVER,na.CLOUD_PROXY_FALLBACK].toString()}),Vr.joinChooseServer(_e.sid,{lts:ct.requestTime,elapse:ct.elapse,succ:!0,csAddr:ct.url,opid:ct.opid,serverList:ct.gatewayInfo.gatewayAddrs.map(ut=>ut.address),ec:null,cid:ct.gatewayInfo.cid.toString(),uid:ct.gatewayInfo.uid.toString(),csIp:ct.gatewayInfo.csIp,unilbsServerIds:[na.CHOOSE_SERVER].toString(),isHttp3:ct.isHttp3})}function z4(_e){return window.atob(window.localStorage.getItem(_e)||"")}function u1(_e,rt){window.localStorage.setItem(_e,window.btoa(rt))}function W4(_e){let rt="".concat(_e.appId,"_").concat(_e.cname);return typeof _e.uid=="string"&&(rt+="_s_".concat(_e.uid)),typeof _e.uid=="number"&&(rt+="_".concat(_e.uid)),_e.token&&(rt+="_".concat(_e.token)),F3(rt)}function lq(_e){let rt=function(){const it=hq.pop();return it?(it.offset=it.limit=0,it):{bytes:new Uint8Array(64),offset:0,limit:0}}();return function(it,ct){let ut=it.appId;ut!==void 0&&(ga(ct,10),mv(ct,ut));let pt=it.cid;pt!==void 0&&(ga(ct,16),ga(ct,pt));let mt=it.cname;mt!==void 0&&(ga(ct,26),mv(ct,mt));let _t=it.deviceId;_t!==void 0&&(ga(ct,34),mv(ct,_t));let vt=it.elapse;vt!==void 0&&(ga(ct,40),gv(ct,vt));let Tt=it.fileSize;Tt!==void 0&&(ga(ct,48),gv(ct,HS(Tt)));let bt=it.height;bt!==void 0&&(ga(ct,56),gv(ct,HS(bt)));let Ot=it.jpg;Ot!==void 0&&(ga(ct,66),ga(ct,Ot.length),Y4(ct,Ot));let Mt=it.networkType;Mt!==void 0&&(ga(ct,72),gv(ct,HS(Mt)));let Dt=it.osType;Dt!==void 0&&(ga(ct,80),gv(ct,HS(Dt)));let jt=it.requestId;jt!==void 0&&(ga(ct,90),mv(ct,jt));let $t=it.sdkVersion;$t!==void 0&&(ga(ct,98),mv(ct,$t));let Ht=it.sequence;Ht!==void 0&&(ga(ct,104),gv(ct,HS(Ht)));let en=it.sid;en!==void 0&&(ga(ct,114),mv(ct,en));let Qt=it.timestamp;Qt!==void 0&&(ga(ct,120),gv(ct,Qt));let on=it.uid;on!==void 0&&(ga(ct,128),ga(ct,on));let Tn=it.vid;Tn!==void 0&&(ga(ct,136),ga(ct,Tn));let vn=it.width;vn!==void 0&&(ga(ct,144),gv(ct,HS(vn)));let hn=it.service;hn!==void 0&&(ga(ct,152),ga(ct,hn));let Ln=it.callbackData;Ln!==void 0&&(ga(ct,162),ga(ct,Ln.length),Y4(ct,Ln));let Xn=it.ticket;Xn!==void 0&&(ga(ct,170),mv(ct,Xn));let Qn=it.vendorConfigs;Qn!==void 0&&(ga(ct,178),mv(ct,Qn))}(_e,rt),function(it){let ct=it.bytes,ut=it.limit;return ct.length===ut?ct:ct.subarray(0,ut)}(rt)}function uq(_e){return function(it){let ct={};e:for(;!pq(it);){let ut=kA(it);switch(ut>>>3){case 0:break e;case 1:ct.code=kA(it);break;case 2:ct.msg=X4(it,kA(it));break;case 3:ct.requestId=X4(it,kA(it));break;case 4:ct.timestamp=fq(it,!1);break;default:dq(it,7&ut)}}return ct}({bytes:rt=_e,offset:0,limit:rt.length});var rt}function dq(_e,rt){switch(rt){case 0:for(;128&xm(_e););break;case 2:YM(_e,kA(_e));break;case 5:YM(_e,4);break;case 1:YM(_e,8);break;default:throw new Error("Unimplemented type: "+rt)}}function HS(_e){return{low:_e|=0,high:_e>>31,unsigned:_e>=0}}let hq=[];function YM(_e,rt){if(_e.offset+rt>_e.limit)throw new Error("Skip past limit");_e.offset+=rt}function pq(_e){return _e.offset>=_e.limit}function d1(_e,rt){let it=_e.bytes,ct=_e.offset,ut=_e.limit,pt=ct+rt;if(pt>it.length){let mt=new Uint8Array(2*pt);mt.set(it),_e.bytes=mt}return _e.offset=pt,pt>ut&&(_e.limit=pt),ct}function K4(_e,rt){let it=_e.offset;if(it+rt>_e.limit)throw new Error("Read past limit");return _e.offset+=rt,it}function Y4(_e,rt){let it=d1(_e,rt.length);_e.bytes.set(rt,it)}function X4(_e,rt){let it=K4(_e,rt),ct=String.fromCharCode,ut=_e.bytes,pt="",mt="";for(let _t=0;_t<rt;_t++){let vt,Tt,bt,Ot,Mt=ut[_t+it];128&Mt?(224&Mt)==192?_t+1>=rt?mt+=pt:(vt=ut[_t+it+1],(192&vt)!=128?mt+=pt:(Ot=(31&Mt)<<6|63&vt,Ot<128?mt+=pt:(mt+=ct(Ot),_t++))):(240&Mt)==224?_t+2>=rt?mt+=pt:(vt=ut[_t+it+1],Tt=ut[_t+it+2],(49344&(vt|Tt<<8))!=32896?mt+=pt:(Ot=(15&Mt)<<12|(63&vt)<<6|63&Tt,Ot<2048||Ot>=55296&&Ot<=57343?mt+=pt:(mt+=ct(Ot),_t+=2))):(248&Mt)==240?_t+3>=rt?mt+=pt:(vt=ut[_t+it+1],Tt=ut[_t+it+2],bt=ut[_t+it+3],(12632256&(vt|Tt<<8|bt<<16))!=8421504?mt+=pt:(Ot=(7&Mt)<<18|(63&vt)<<12|(63&Tt)<<6|63&bt,Ot<65536||Ot>1114111?mt+=pt:(Ot-=65536,mt+=ct(55296+(Ot>>10),56320+(1023&Ot)),_t+=3))):mt+=pt:mt+=ct(Mt)}return mt}function mv(_e,rt){let it=rt.length,ct=0;for(let mt=0;mt<it;mt++){let _t=rt.charCodeAt(mt);_t>=55296&&_t<=56319&&mt+1<it&&(_t=(_t<<10)+rt.charCodeAt(++mt)-56613888),ct+=_t<128?1:_t<2048?2:_t<65536?3:4}ga(_e,ct);let ut=d1(_e,ct),pt=_e.bytes;for(let mt=0;mt<it;mt++){let _t=rt.charCodeAt(mt);_t>=55296&&_t<=56319&&mt+1<it&&(_t=(_t<<10)+rt.charCodeAt(++mt)-56613888),_t<128?pt[ut++]=_t:(_t<2048?pt[ut++]=_t>>6&31|192:(_t<65536?pt[ut++]=_t>>12&15|224:(pt[ut++]=_t>>18&7|240,pt[ut++]=_t>>12&63|128),pt[ut++]=_t>>6&63|128),pt[ut++]=63&_t|128)}}function xm(_e){return _e.bytes[K4(_e,1)]}function q4(_e,rt){let it=d1(_e,1);_e.bytes[it]=rt}function kA(_e){let rt,it=0,ct=0;do rt=xm(_e),it<32&&(ct|=(127&rt)<<it),it+=7;while(128&rt);return ct}function ga(_e,rt){for(rt>>>=0;rt>=128;)q4(_e,127&rt|128),rt>>>=7;q4(_e,rt)}function fq(_e,rt){let it,ct=0,ut=0,pt=0;return it=xm(_e),ct=127&it,128&it&&(it=xm(_e),ct|=(127&it)<<7,128&it&&(it=xm(_e),ct|=(127&it)<<14,128&it&&(it=xm(_e),ct|=(127&it)<<21,128&it&&(it=xm(_e),ut=127&it,128&it&&(it=xm(_e),ut|=(127&it)<<7,128&it&&(it=xm(_e),ut|=(127&it)<<14,128&it&&(it=xm(_e),ut|=(127&it)<<21,128&it&&(it=xm(_e),pt=127&it,128&it&&(it=xm(_e),pt|=(127&it)<<7))))))))),{low:ct|ut<<28,high:ut>>>4|pt<<24,unsigned:rt}}function gv(_e,rt){let it=rt.low>>>0,ct=(rt.low>>>28|rt.high<<4)>>>0,ut=rt.high>>>24,pt=ut===0?ct===0?it<16384?it<128?1:2:it<1<<21?3:4:ct<16384?ct<128?5:6:ct<1<<21?7:8:ut<128?9:10,mt=d1(_e,pt),_t=_e.bytes;switch(pt){case 10:_t[mt+9]=ut>>>7&1;case 9:_t[mt+8]=pt!==9?128|ut:127&ut;case 8:_t[mt+7]=pt!==8?ct>>>21|128:ct>>>21&127;case 7:_t[mt+6]=pt!==7?ct>>>14|128:ct>>>14&127;case 6:_t[mt+5]=pt!==6?ct>>>7|128:ct>>>7&127;case 5:_t[mt+4]=pt!==5?128|ct:127&ct;case 4:_t[mt+3]=pt!==4?it>>>21|128:it>>>21&127;case 3:_t[mt+2]=pt!==3?it>>>14|128:it>>>14&127;case 2:_t[mt+1]=pt!==2?it>>>7|128:it>>>7&127;case 1:_t[mt]=pt!==1?128|it:127&it}}const J4={},Z4={},h1=4294967296,Q4=h1*h1,e5=Q4/2,XM=n5(0,!0),t5=n5(0),mq=jS(0,-2147483648,!1),gq=jS(-1,2147483647,!1),Eq=jS(-1,-1,!0);function n5(_e,rt){let it,ct,ut;return rt?(ut=0<=(_e>>>=0)&&_e<256)&&(ct=Z4[_e],ct)?ct:(it=jS(_e,0,!0),ut&&(Z4[_e]=it),it):(ut=-128<=(_e|=0)&&_e<128)&&(ct=J4[_e],ct)?ct:(it=jS(_e,_e<0?-1:0,!1),ut&&(J4[_e]=it),it)}function jS(_e,rt,it){return{low:0|_e,high:0|rt,unsigned:!!it}}function r5(_e,rt){if(isNaN(_e))return rt?XM:t5;if(rt){if(_e<0)return XM;if(_e>=Q4)return Eq}else{if(_e<=-e5)return mq;if(_e+1>=e5)return gq}return _e<0?rt?XM:t5:jS(_e%h1|0,_e/h1|0,rt)}function i5(_e,rt){var it=Object.keys(_e);if(Object.getOwnPropertySymbols){var ct=Object.getOwnPropertySymbols(_e);rt&&(ct=ct.filter(function(ut){return Object.getOwnPropertyDescriptor(_e,ut).enumerable})),it.push.apply(it,ct)}return it}class qM extends Fs{get connectionState(){return this._connectionState}set connectionState(rt){if(this._connectionState===rt)return;const it=this._connectionState;this._connectionState=rt,this.emit(s_.CONNECTION_STATE_CHANGE,rt,it)}get quality(){return this._quality}set quality(rt){this._quality=rt>1?1:rt<.1?.1:rt,this._qualityTimer&&(window.clearTimeout(this._qualityTimer),this._qualityTimer=null),this._quality>=1||(this._qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this._qualityRatio},6e4))}constructor(rt){var it;super(),Jt(this,"name","AgoraRTCImageModeration"),Jt(this,"_connectionState",tm.CONNECTING),Jt(this,"_sequence",0),Jt(this,"_moderationStartTime",void 0),Jt(this,"_workerConnection",void 0),Jt(this,"_workerMessageLengthLimit",void 0),Jt(this,"_qualityRatio",void 0),Jt(this,"_connectInfo",void 0),Jt(this,"_cancelTokenSource",Xu.CancelToken.source()),Jt(this,"_retryConfig",void 0),Jt(this,"_moderationInterval",void 0),Jt(this,"_moderationTimer",null),Jt(this,"_moderationMode",1),Jt(this,"_quality",1),Jt(this,"_qualityTimer",null),Jt(this,"_ticket",void 0),Jt(this,"_moderationIntervalMinimum",void 0),Jt(this,"_uploadFailedNum",0),Jt(this,"_uploadNum",0),Jt(this,"_uploadTimer",null),Jt(this,"_extraInfo",void 0),Jt(this,"_vendor",""),Jt(this,"_encoder",new TextEncoder),Jt(this,"_moderationId",void 0),Jt(this,"inspectImage",()=>{if(this.connectionState!==tm.CONNECTED)throw new $n(tn.OPERATION_ABORTED,"image moderation service connection status is ".concat(this.connectionState));this._moderationTimer&&(window.clearInterval(this._moderationTimer),this._moderationTimer=null),this._moderationTimer=window.setInterval(()=>{this.connectionState===tm.CONNECTED?this.requestToInspectImage():Ut.debug("[".concat(this._moderationId,"] Moderation State is not connected , "),this.connectionState)},this._moderationInterval<this._moderationIntervalMinimum?this._moderationIntervalMinimum:this._moderationInterval),this.requestToInspectImage()}),this._moderationId=ms(5,"image-moderation-"),this._workerMessageLengthLimit=rn("IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT"),this._moderationIntervalMinimum=rn("IMAGE_MODERATION_INTERVAL_MINIMUM"),this._moderationInterval=(it=rt.interval)!==null&&it!==void 0?it:1e3,rt.extraInfo&&(this._extraInfo=this._encoder.encode(rt.extraInfo)),rt.vendor&&(this._vendor=rt.vendor),this._qualityRatio=rn("IMAGE_MODERATION_QUALITY_RATIO"),this._moderationStartTime=Number(Date.now()),this._workerConnection=new RA("worker-"+this._moderationId,xa),this.on(s_.STATE_CHANGE,(ct,ut)=>{Ut.debug("[".concat(this._moderationId,"] Moderation operation :").concat(PS[ct]," ").concat(ut||""))}),this.handleWorkerEvents()}async init(rt,it){this.emit(s_.STATE_CHANGE,PS.CONNECT_AP),this._connectInfo=rt;const ct=this._cancelTokenSource.token;return this._retryConfig=it,new Ir((ut,pt)=>{this.on(s_.CONNECTION_STATE_CHANGE,(mt,_t)=>{mt===tm.CONNECTED&&ut()}),this.requestAP(rt,ct,it).then(mt=>{this.connectWorker(mt)}).catch(mt=>{pt(mt)})})}updateConfig(rt){var it;this._moderationInterval=(it=rt.interval)!==null&&it!==void 0?it:1e3,rt.extraInfo&&(this._extraInfo=this._encoder.encode(rt.extraInfo)),rt.vendor&&(this._vendor=rt.vendor),Ut.debug("[".concat(this._moderationId,"] updateConfig: ").concat(JSON.stringify(rt))),this.connectionState===tm.CONNECTED&&this.inspectImage()}async requestAP(rt,it,ct){const ut=rn("WEBCS_DOMAIN").map(vt=>"https://".concat(vt,"/api/v1")),pt=await function(vt,Tt,bt,Ot){let{appId:Mt,areaCode:Dt,cname:jt,sid:$t,token:Ht,uid:en}=Tt;BS++;const Qt="moderation_plugin",on={service_name:Qt,json_body:JSON.stringify({appId:Mt,areaCode:Dt,cname:jt,command:"allocateEdge",requestId:BS,seq:BS,sid:$t,appToken:Ht,ts:Date.now(),uid:en+""})};let Tn,vn,hn=vt[0];return n_(async()=>{Tn=Date.now();const Ln=await a_(hn,{data:on,cancelToken:bt,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(vn=Date.now()-Tn,Ln.code!==0){const ur=new $n(tn.UNEXPECTED_RESPONSE,"moderation plugin ap error, code"+Ln.code,{retry:!0,responseTime:vn});throw Ut.error(ur.toString()),ur}const Xn=JSON.parse(Ln.json_body);if(Xn.code!==200){const ur=new $n(tn.UNEXPECTED_RESPONSE,"moderation plugin ap error, code: ".concat(Xn.code,", reason: ").concat(Xn.reason),{code:Xn.code,responseTime:vn});throw Ut.error(ur.toString()),ur}if(!Xn.servers||!Array.isArray(Xn.servers)||Xn.servers.length===0){const ur=new $n(tn.UNEXPECTED_RESPONSE,"moderation plugin ap empty server",{code:Xn.code,responseTime:vn});throw Ut.error(ur.toString()),ur}if(!Xn.servers.some(ur=>!!ur.wss)){const ur=new $n(tn.UNEXPECTED_RESPONSE,"moderation plugin ap empty port",{code:Xn.code,responseTime:vn});throw Ut.error(ur.toString()),ur}const Qn=rn("IMAGE_MODERATION_WORKER_HOST");return{addressList:Xn.servers.map(ur=>{let{address:go,wss:Eo}=ur;if(go&&Eo)return"wss://".concat(go.replace(/\./g,"-"),".").concat(Qn,":").concat(Eo,"/moderation")}).filter(ur=>!!ur),workerToken:Xn.workerToken,vid:Xn.vid,ticket:Xn.appTicket,responseTime:vn}},(Ln,Xn)=>(Vr.apworkerEvent($t,{success:!0,sc:200,serviceName:Qt,responseDetail:JSON.stringify(Ln.addressList),firstSuccess:Xn===0,responseTime:vn,serverIp:vt[Xn%vt.length]}),!1),(Ln,Xn)=>(Vr.apworkerEvent($t,{success:!1,sc:Ln.data&&Ln.data.code||200,serviceName:Qt,responseTime:vn,serverIp:vt[Xn%vt.length]}),!!(Ln.code!==tn.OPERATION_ABORTED&&Ln.code!==tn.UNEXPECTED_RESPONSE||Ln.data&&Ln.data.retry)&&(hn=vt[(Xn+1)%vt.length],!0)),Ot)}(ut,rt,it,ct);this.emit(s_.STATE_CHANGE,PS.AP_CONNECTED);const{addressList:mt,ticket:_t}=pt;return this._ticket=_t,mt}async connectWorker(rt){this.emit(s_.STATE_CHANGE,PS.CONNECT_WORKER),await this._workerConnection.init(rt,1e4)}handleWorkerEvents(){this._workerConnection.on(ho.CONNECTED,async()=>{this.emit(s_.STATE_CHANGE,PS.WORKER_CONNECTED,this._workerConnection.url),this.connectionState=tm.CONNECTED}),this._workerConnection.on(ho.CLOSED,()=>{this.connectionState=tm.CLOSED}),this._workerConnection.on(ho.FAILED,()=>{this.connectionState=tm.CLOSED}),this._workerConnection.on(ho.RECONNECTING,()=>{this.connectionState=this.connectionState===tm.CONNECTED?tm.RECONNECTING:tm.CONNECTING}),this._workerConnection.on(ho.ON_MESSAGE,async rt=>{if(rt.data instanceof ArrayBuffer){const it=uq(new Uint8Array(rt.data));rn("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&Ut.debug("[".concat(this._moderationId,"] Response message for worker of image moderation "),JSON.stringify(it)),this._uploadNum++,it.code===void 0||it.code===0||(this._uploadFailedNum++,Ut.error("[".concat(this._moderationId,"] Error response from worke, code is ").concat(it.code,", msg is ").concat(it.msg)),this._uploadTimer||(this._uploadTimer=window.setTimeout(()=>{Vr.reportApiInvoke(this._connectInfo.sid||null,{name:Ks.IMAGE_MODERATION_UPLOAD,options:[this._uploadFailedNum,this._uploadNum,it.code],tag:Ns.TRACER}).onError(new $n(tn.IMAGE_MODERATION_UPLOAD_FAILED,it.msg)),this._uploadTimer=null},rn("IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL"))))}else Ut.error("[".concat(this._moderationId,"] Unexpected message type from worker"))}),this._workerConnection.on(ho.WILL_RECONNECT,(rt,it,ct)=>{rt==="recover"&&ct(rt),ct("tryNext")}),this._workerConnection.on(ho.REQUEST_NEW_URLS,(rt,it)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(rt).catch(it)})}static intToLong(rt){return{low:rt|=0,high:rt>>31,unsigned:rt>=0}}async requestToInspectImage(){const rt=Dp(this,s_.CLIENT_LOCAL_VIDEO_TRACK),it={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(rt){if(!rt.isPlaying)return void(rn("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&Ut.debug("Only the track being played can be inspected"));this._sequence++;const ct=await this.generateRequestData(rt,it);this._workerConnection.sendMessage(ct,!0,!0)}else rn("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&Ut.debug("Only the track being published can be inspected")}async generateRequestData(rt,it){let{appId:ct,cname:ut,cid:pt,vid:mt,sid:_t,uid:vt}=it;const Tt=Date.now(),bt=await rt.getCurrentFrameImage("image/jpeg",this.quality),Ot=await IB(bt,ct,ut),Mt=this._sequence+"-"+pt+"-"+vt+"-"+Tt+"-"+ms(12,""),Dt={appId:ct,cid:pt,cname:ut,deviceId:"",elapse:qM.intToLong(Number(Tt-this._moderationStartTime)),fileSize:bt.buffer.byteLength,height:bt.height,width:bt.width,jpg:Ot,networkType:6,osType:7,requestId:Mt,sdkVersion:"4.24.0",sequence:this._sequence,sid:_t,timestamp:r5(Tt),uid:vt,vid:mt,service:this._moderationMode,ticket:this._ticket,callbackData:this._extraInfo,vendorConfigs:this._vendor};this._extraInfo===void 0&&delete Dt.callbackData;const jt=lq(Dt);if(jt.byteLength<this._workerMessageLengthLimit){if(rn("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")){const $t=function(Ht){for(var en=1;en<arguments.length;en++){var Qt=arguments[en]!=null?arguments[en]:{};en%2?i5(Object(Qt),!0).forEach(function(on){Jt(Ht,on,Qt[on])}):Object.getOwnPropertyDescriptors?Object.defineProperties(Ht,Object.getOwnPropertyDescriptors(Qt)):i5(Object(Qt)).forEach(function(on){Object.defineProperty(Ht,on,Object.getOwnPropertyDescriptor(Qt,on))})}return Ht}({},Dt);delete $t.jpg,Ut.debug("[".concat(this._moderationId,"] Request message for worker of image moderation service: "),JSON.stringify($t))}return jt}{const $t=this.quality*this._qualityRatio;return this.quality=$t,await this.generateRequestData(rt,{appId:ct,cname:ut,cid:pt,vid:mt,sid:_t,uid:vt})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=Xu.CancelToken.source(),this._workerConnection&&this._workerConnection.close(),this._moderationTimer&&window.clearInterval(this._moderationTimer),this._moderationTimer=null,this._uploadTimer&&window.clearTimeout(this._uploadTimer),this._uploadTimer=null,this.connectionState=tm.CLOSED,this.emit(s_.STATE_CHANGE,PS.CLOSED)}}function o5(_e){if(us(_e.interval,"interval",1e3,1/0),_e&&_e.extraInfo&&_e.extraInfo.length>1024)throw new $n(tn.INVALID_PARAMS,"config.extraInfo length cannot exceed 1024 bytes");if(_e&&_e.vendor&&_e.vendor.length>1024)throw new $n(tn.INVALID_PARAMS,"config.vendor length cannot exceed 1024 bytes")}const vq={name:"ImageModeration",create:function(_e){let{config:rt}=_e;return o5(rt),new qM(rt)}};var s5,a5,c5,l5,u5,d5,h5,p5,f5,m5,g5,_5,E5,v5,y5,S5,T5,A5,C5,b5,R5,w5,I5,x5,O5,M5,P5,N5,D5,L5,k5,U5,B5,F5,V5,G5,$5,H5,j5,z5,W5,Mr;function K5(_e,rt){var it=Object.keys(_e);if(Object.getOwnPropertySymbols){var ct=Object.getOwnPropertySymbols(_e);rt&&(ct=ct.filter(function(ut){return Object.getOwnPropertyDescriptor(_e,ut).enumerable})),it.push.apply(it,ct)}return it}function Om(_e){for(var rt=1;rt<arguments.length;rt++){var it=arguments[rt]!=null?arguments[rt]:{};rt%2?K5(Object(it),!0).forEach(function(ct){Jt(_e,ct,it[ct])}):Object.getOwnPropertyDescriptors?Object.defineProperties(_e,Object.getOwnPropertyDescriptors(it)):K5(Object(it)).forEach(function(ct){Object.defineProperty(_e,ct,Object.getOwnPropertyDescriptor(it,ct))})}return _e}lu.setLogger(Ut);let yq=(s5=Jr(),a5=Jr({argsMap:(_e,rt)=>{if(!Array.isArray(rt)){if(!(rt instanceof CS))return[rt];rt=[rt]}return rt.map(it=>it?Object(it).toString():"null")}}),c5=Jr({argsMap:(_e,rt)=>(rt||(rt=[]),Array.isArray(rt)||rt.trackMediaType!==AS.DATA?(Array.isArray(rt)||(rt=[rt]),rt.map(it=>it.getTrackId())):[rt.getChannelId()])}),l5=Jr({argsMap:(_e,rt,it,ct)=>[typeof rt=="object"?rt.uid:rt,it,ct]}),u5=Jr({argsMap:(_e,rt,it)=>[rt,it]}),d5=Jr({argsMap:(_e,rt)=>rt.map(it=>{let{user:ct,mediaType:ut}=it;return[ct==null?void 0:ct.uid,ut]})}),h5=Jr({argsMap:(_e,rt,it,ct)=>[typeof rt=="object"?rt.uid:rt,it,ct]}),p5=Jr({argsMap:(_e,rt)=>rt.map(it=>{let{user:ct,mediaType:ut}=it;return{uid:ct==null?void 0:ct.uid,mediaType:ut}})}),f5=Jr(),m5=Jr(),g5=Jr(),_5=Jr(),E5=Jr(),v5=Jr(),y5=Jr(),S5=Jr(),T5=Jr(),A5=Jr(),C5=Jr(),b5=Jr(),R5=Jr(),w5=Jr(),I5=Jr(),x5=Jr({argsMap:(_e,rt)=>[rt]}),O5=Jr(),M5=Jr(),P5=Jr(),N5=Jr(),D5=Jr(),L5=Jr(),k5=Jr(),U5=Jr(),B5=Jr({argsMap:(_e,rt)=>(Array.isArray(rt)||(rt=[rt]),[JSON.stringify(rt)])}),F5=Jr(),V5=Jr(),G5=Jr(),$5=Jr(),H5=Jr(),j5=Jr(),z5=Jr({reportResult:!0}),W5=Jr(),Mr=class extends Fs{get connectionState(){return this._gateway.state}get remoteUsers(){return this._users}get localTracks(){return this._p2pChannel.getAllTracks(!0)}get uid(){return this._uid}get channelName(){return this._channelName}get localDataChannels(){return this._p2pChannel.getAllDataChannels()}get mode(){return this._config.mode}get role(){var _e;return((_e=this._config)===null||_e===void 0?void 0:_e.role)||"audience"}get codec(){return this._config.codec}get audioCodec(){return this._config.audioCodec||"opus"}get isStringUID(){return!!this._joinInfo&&!!this._joinInfo.stringUid}get __className__(){return"Client"}constructor(_e,rt){let it;if(super(),Jt(this,"store",void 0),Jt(this,"_uid",void 0),Jt(this,"_channelName",void 0),Jt(this,"_uintUid",void 0),Jt(this,"_users",[]),Jt(this,"_config",void 0),Jt(this,"_clientId",void 0),Jt(this,"_appId",void 0),Jt(this,"_sessionId",null),Jt(this,"_key",void 0),Jt(this,"_rtmConfig",{}),Jt(this,"_joinInfo",void 0),Jt(this,"_gateway",void 0),Jt(this,"_statsCollector",void 0),Jt(this,"_configDistribute",void 0),Jt(this,"_leaveMutex",void 0),Jt(this,"_publishMutex",void 0),Jt(this,"_renewTokenMutex",void 0),Jt(this,"_subscribeMutex",void 0),Jt(this,"_encryptionMode","none"),Jt(this,"_encryptionSecret",null),Jt(this,"_encryptionSalt",null),Jt(this,"_encryptDataStream",!1),Jt(this,"_encryptDataStreamKey",null),Jt(this,"_encryptDataStreamIv",null),Jt(this,"_proxyServer",void 0),Jt(this,"_turnServer",{servers:[],mode:"auto"}),Jt(this,"_cloudProxyServerMode","disabled"),Jt(this,"_isDualStreamEnabled",!1),Jt(this,"_defaultStreamFallbackType",void 0),Jt(this,"_lowStreamParameter",void 0),Jt(this,"_streamFallbackTypeCacheMap",new Map),Jt(this,"_remoteStreamTypeCacheMap",new Map),Jt(this,"_axiosCancelSource",Xu.CancelToken.source()),Jt(this,"_audioVolumeIndicationInterval",void 0),Jt(this,"_networkQualityInterval",void 0),Jt(this,"_userOfflineTimeout",void 0),Jt(this,"_streamRemovedTimeout",void 0),Jt(this,"_liveTranscodeStreamingClient",void 0),Jt(this,"_liveRawStreamingClient",void 0),Jt(this,"_channelMediaRelayClient",void 0),Jt(this,"_networkQualitySensitivity","normal"),Jt(this,"_p2pChannel",void 0),Jt(this,"_useLocalAccessPoint",!1),Jt(this,"_setLocalAPVersion",void 0),Jt(this,"_joinAndNotLeaveYet",!1),Jt(this,"_numberOfJoinCount",0),Jt(this,"_joinResponse",null),Jt(this,"_remoteDefaultVideoStreamType",void 0),Jt(this,"_inspect",void 0),Jt(this,"_moderation",void 0),Jt(this,"_license",void 0),Jt(this,"_pendingPublishedUsers",[]),Jt(this,"ntpAlignErrorCount",0),Jt(this,"remoteInboundOffset",0),Jt(this,"_peerConnectionState",void 0),Jt(this,"_handleLocalTrackEnable",(ut,pt,mt)=>{this.publish(ut,!1).then(pt).catch(mt)}),Jt(this,"_handleLocalTrackDisable",(ut,pt,mt)=>{this.unpublish(ut).then(pt).catch(mt)}),Jt(this,"_handleUserOnline",ut=>{if(rn("BLOCK_LOCAL_CLIENT")&&b0(ut.uid,this.channelName))return void Ut.debug("[".concat(ut.uid,"] will be ignored in local"));this.isStringUID&&typeof ut.uid!="string"&&Ut.error("[".concat(this._clientId,"] StringUID is Mixed with UintUID"));const pt=this._users.find(mt=>mt.uid===ut.uid);if(pt)pt._trust_in_room_=!0,pt._is_pre_created&&(pt._is_pre_created=!1,this.safeEmit(wo.USER_JOINED,pt));else{const mt=new pv(ut.uid,ut.uint_id||ut.uid);this._users.push(mt),Ut.debug("[".concat(this._clientId,"] user online"),ut.uid),this.store.firstVideoFrameDecoded(mt.uid,{userJoinNotify:Date.now()}),this.safeEmit(wo.USER_JOINED,mt)}}),Jt(this,"_handleUserOffline",ut=>{if(rn("BLOCK_LOCAL_CLIENT")&&b0(ut.uid,this.channelName))return;const pt=this._users.find(mt=>mt.uid===ut.uid);pt&&(this._handleRemoveStream(ut),this._handleRemoveDataChannels(ut),pt._audio_pre_subscribed||pt._video_pre_subscribed?pt._is_pre_created=!0:hw(this._users,pt),this._remoteStreamTypeCacheMap.delete(pt.uid),this._streamFallbackTypeCacheMap.delete(pt.uid),Ut.debug("[".concat(this._clientId,"] user offline"),ut.uid,"reason:",ut.reason),this.safeEmit(wo.USER_LEAVED,pt,ut.reason))}),Jt(this,"_handleAddAudioOrVideoStream",(ut,pt,mt,_t,vt,Tt,bt,Ot)=>{if(rn("BLOCK_LOCAL_CLIENT")&&b0(pt,this.channelName))return;const Mt=this._users.find(jt=>jt.uid===pt);if(!Mt)return void Ut.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));Ut.debug("[".concat(this._clientId,"] stream added with uid ").concat(pt,", type ").concat(ut)),this.store.subscribe(Mt.uid,ut,void 0,void 0,void 0,Date.now()),ut==="video"&&this.store.firstVideoFrameDecoded(Mt.uid,{videoAddNotify:Date.now()});const Dt=ut==="audio"?Mt.hasAudio:Mt.hasVideo;if(Mt._uintid||(Mt._uintid=Tt||pt),ut==="audio"?Mt._trust_audio_stream_added_state_=!0:Mt._trust_video_stream_added_state_=!0,ut==="audio"?(Mt._audio_added_=!0,mt!==void 0&&(Mt._audioSSRC=mt),_t!==void 0&&(Mt._cname=_t),bt&&(Mt._audioOrtc=bt)):(Mt._video_added_=!0,mt!==void 0&&(Mt._videoSSRC=mt),_t!==void 0&&(Mt._cname=_t),Ot!==void 0&&(Mt._rtxSsrcId=Ot),bt&&(Mt._videoOrtc=bt)),(ut==="audio"?Mt.hasAudio:Mt.hasVideo)&&!Dt&&(Ut.info("[".concat(this._clientId,"] remote user ").concat(Mt.uid," published ").concat(ut)),this.safeEmit(wo.USER_PUBLISHED,Mt,ut)),ut==="video"?Vr.onGatewayStream(this._sessionId,Rl.ON_ADD_VIDEO_STREAM,Os.ON_ADD_VIDEO_STREAM,{peer:Tt||pt,ssrc:Mt._videoSSRC}):Vr.onGatewayStream(this._sessionId,Rl.ON_ADD_AUDIO_STREAM,Os.ON_ADD_AUDIO_STREAM,{peer:Tt||pt,ssrc:Mt._audioSSRC}),this._p2pChannel.remoteMediaSsrcChanged(Mt,ut,mt).then(jt=>{if(jt&&(Ut.debug("[".concat(this._clientId,"] resubscribe ").concat(ut," for user ").concat(Mt.uid," after rejoin because SSRC id changed.")),this._p2pChannel instanceof LA))return this._p2pChannel.unsubscribe(Mt,ut,!0).then(()=>this._subscribe(Mt,ut,!0).catch($t=>{Ut.error("[".concat(this._clientId,"] resubscribe error"),$t.toString())}))}),this._p2pChannel.hasPendingRemoteMedia(Mt,ut)&&(Ut.debug("[".concat(this._clientId,"] resubscribe ").concat(ut," for user ").concat(Mt.uid," after reconnect.")),this._subscribe(Mt,ut,!0).catch(jt=>{Ut.error("[".concat(this._clientId,"] resubscribe error"),jt.toString())})),ut==="video"&&!tu()&&!Tu()){const jt=this._getEncodingName(vt);(jt==null?void 0:jt.toLocaleLowerCase())==EA.av1&&jX().then($t=>{$t||this._gateway.downgradeCodec(jt)})}}),Jt(this,"_handleRemoveStream",ut=>{if(rn("BLOCK_LOCAL_CLIENT")&&b0(ut.uid,this.channelName))return;const pt=this._users.find(_t=>_t.uid===ut.uid);if(!pt)return void Ut.warning("[".concat(this._clientId,"] can not find target user!(on_remove_stream)"));Ut.debug("[".concat(this._clientId,"] stream removed with uid ").concat(ut.uid));let mt=()=>{};pt.hasAudio&&pt.hasVideo?mt=()=>{Ut.info("[".concat(this._clientId,"] remote user ").concat(pt.uid," unpublished audio track")),this.safeEmit(wo.USER_UNPUBLISHED,pt,"audio"),Ut.info("[".concat(this._clientId,"] remote user ").concat(pt.uid," unpublished video track")),this.safeEmit(wo.USER_UNPUBLISHED,pt,"video")}:pt.hasVideo?mt=()=>{Ut.info("[".concat(this._clientId,"] remote user ").concat(pt.uid," unpublished video track")),this.safeEmit(wo.USER_UNPUBLISHED,pt,"video")}:pt.hasAudio&&(mt=()=>{Ut.info("[".concat(this._clientId,"] remote user ").concat(pt.uid," unpublished audio track")),this.safeEmit(wo.USER_UNPUBLISHED,pt,"audio")}),pt._video_pre_subscribed||pt._audio_pre_subscribed||(pt._trust_audio_stream_added_state_=!0,pt._trust_video_stream_added_state_=!0,pt._audio_added_=!1,pt._video_added_=!1,this._p2pChannel instanceof LA&&this._p2pChannel.unsubscribe(pt).then(_t=>{if(_t)return this._gateway.unsubscribe(_t,pt.uid)}),pt._audioSSRC=void 0,pt._videoSSRC=void 0,pt._audioOrtc=void 0,pt._videoOrtc=void 0,pt._rtxSsrcId=void 0),Vr.onGatewayStream(this._sessionId,Rl.ON_REMOVE_STREAM,Os.ON_REMOVE_STREAM,{peer:ut.uint_id||ut.uid}),mt()}),Jt(this,"_handleSetStreamLocalEnable",(ut,pt,mt)=>{if(rn("BLOCK_LOCAL_CLIENT")&&b0(pt,this.channelName))return;const _t=this._users.find(bt=>bt.uid===pt);if(!_t)return void Ut.error("[".concat(this._clientId,"] can not find target user!(disable_local)"));Ut.debug("[".concat(this._clientId,"] local ").concat(ut," ").concat(mt?"enabled":"disabled"," with uid ").concat(pt));const vt=ut==="audio"?_t.hasAudio:_t.hasVideo;if(ut==="audio"){_t._trust_audio_enabled_state_=!0;const bt=_t._audio_enabled_;if(_t._audio_enabled_=mt,_t._audio_enabled_===bt)return;{const Ot=_t._audio_enabled_?"enable-local-audio":"disable-local-audio";Ut.debug("[".concat(this._clientId,"] user-info-updated, uid: ").concat(pt,", msg: ").concat(Ot)),this.safeEmit(wo.USER_INFO_UPDATED,pt,Ot)}}else{_t._trust_video_enabled_state_=!0;const bt=_t._video_enabled_;if(_t._video_enabled_=mt,_t._video_enabled_===bt)return;{const Ot=_t._video_enabled_?"enable-local-video":"disable-local-video";Ut.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(pt,", msg: ").concat(Ot)),this.safeEmit(wo.USER_INFO_UPDATED,pt,Ot)}}const Tt=ut==="audio"?_t.hasAudio:_t.hasVideo;return vt!==Tt?!vt&&Tt?(Ut.info("[".concat(this._clientId,"] remote user ").concat(pt," published ").concat(ut)),void this.safeEmit(wo.USER_PUBLISHED,_t,ut)):(ut==="video"&&_t._videoTrack&&_t._videoTrack._destroy(),ut==="audio"&&_t._audioTrack,this._p2pChannel.muteRemote(_t,ut),Ut.info("[".concat(this._clientId,"] remote user ").concat(pt," unpublished ").concat(ut)),void this.safeEmit(wo.USER_UNPUBLISHED,_t,ut)):void 0}),Jt(this,"_handleMuteStream",(ut,pt,mt)=>{if(rn("BLOCK_LOCAL_CLIENT")&&b0(ut,this.channelName))return;Ut.debug("[".concat(this._clientId,"] receive mute message"),ut,pt,mt);const _t=this._users.find(bt=>bt.uid===ut);if(!_t)return void Ut.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(ut));const vt=pt==="audio"?_t.hasAudio:_t.hasVideo;if(pt==="audio"){_t._trust_audio_mute_state_=!0;const bt=_t._audio_muted_;if(_t._audio_muted_=mt,_t._audio_muted_===bt)return;{const Ot=_t._audio_muted_?"mute-audio":"unmute-audio";Ut.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(ut,", msg: ").concat(Ot)),this.safeEmit(wo.USER_INFO_UPDATED,ut,Ot)}}else{_t._trust_video_mute_state_=!0;const bt=_t._video_muted_;if(_t._video_muted_=mt,_t._video_muted_===bt)return;{const Ot=_t._video_muted_?"mute-video":"unmute-video";Ut.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(ut,", msg: ").concat(Ot)),this.safeEmit(wo.USER_INFO_UPDATED,ut,Ot)}}const Tt=pt==="audio"?_t.hasAudio:_t.hasVideo;if(vt!==Tt){if(!vt&&Tt)return(pt==="audio"?_t._audioSSRC:_t._videoSSRC)?(Ut.info("[".concat(this._clientId,"] remote user ").concat(ut," published ").concat(pt)),void this.safeEmit(wo.USER_PUBLISHED,_t,pt)):void Ut.warning("[".concat(this._clientId,"] remote user ").concat(ut," receive ").concat(pt," unmute message  before add stream message, ").concat(pt," SSRC doesn't exist yet."));pt==="video"&&_t._videoTrack&&!_t._video_pre_subscribed&&_t._videoTrack._destroy(),pt==="audio"&&_t._audioTrack,this._p2pChannel.muteRemote(_t,pt),Ut.info("[".concat(this._clientId,"] remote user ").concat(ut," unpublished ").concat(pt)),this.safeEmit(wo.USER_UNPUBLISHED,_t,pt)}}),Jt(this,"_handleP2PLost",async ut=>{Ut.debug("[".concat(this._clientId,"] receive p2p lost"),ut),parseInt(ut.p2pid,10)===this.store.p2pId?await this._p2pChannel.requestReconnect():Ut.warning("[".concat(this._clientId,"] P2PLost stream not found"),ut)}),Jt(this,"_handleTokenWillExpire",()=>{Ut.debug("[".concat(this._clientId,"] received message onTokenPrivilegeWillExpire")),this.safeEmit(wo.ON_TOKEN_PRIVILEGE_WILL_EXPIRE)}),Jt(this,"_handleBeforeUnload",ut=>{ut.type==="beforeunload"&&ut.returnValue!==void 0&&ut.returnValue!==""||(this.leave(),Ut.info("[".concat(this._clientId,"] auto leave onbeforeunload or pagehide")))}),Jt(this,"_handleUpdateNetworkQuality",()=>{if(this._networkQualitySensitivity==="normal")return;if(navigator&&navigator.onLine!==void 0&&!navigator.onLine)return void this.safeEmit(wo.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6});const ut={downlinkNetworkQuality:0,uplinkNetworkQuality:0};ut.uplinkNetworkQuality=this._p2pChannel.getUplinkNetworkQuality(),ut.downlinkNetworkQuality=this._p2pChannel.getDownlinkNetworkQuality(),this.safeEmit(wo.NETWORK_QUALITY,ut)}),Jt(this,"_handleP2PAddAudioOrVideoStream",(ut,pt,mt,_t)=>{const vt=this._users.find(bt=>bt.uid===pt);if(!vt)return void Ut.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));Ut.debug("[".concat(this._clientId,"] stream added with uid ").concat(pt,", type ").concat(ut)),this.store.subscribe(vt.uid,ut,void 0,void 0,void 0,Date.now());const Tt=ut==="audio"?vt.hasAudio:vt.hasVideo;ut==="audio"?vt._trust_audio_stream_added_state_=!0:vt._trust_video_stream_added_state_=!0,ut==="audio"?(vt._audio_added_=!0,mt!==void 0&&(vt._audioSSRC=mt),_t!==void 0&&(vt._audioMid=_t)):(vt._video_added_=!0,mt!==void 0&&(vt._videoSSRC=mt),_t!==void 0&&(vt._videoMid=_t)),(ut==="audio"?vt.hasAudio:vt.hasVideo)&&!Tt&&(Ut.info("[".concat(this._clientId,"] remote user ").concat(vt.uid," published ").concat(ut)),this.safeEmit(wo.USER_PUBLISHED,vt,ut)),this._p2pChannel.hasPendingRemoteMedia(vt,ut)&&(Ut.debug("[".concat(this._clientId,"] resubscribe ").concat(ut," for user ").concat(vt.uid," after reconnect.")),this._subscribe(vt,ut,!0).catch(bt=>{Ut.error("[".concat(this._clientId,"] resubscribe error"),bt.toString())}))}),this._config=_e,this._clientId=rt||ms(5,"client-"),this.store=new class{constructor(ut,pt,mt,_t){so(this,"state",void 0),this.state={codec:ut,audioCodec:pt,mode:mt,clientId:_t,sessionId:null,p2pId:0,dcId:0,pubId:0,subId:0,keyMetrics:{publish:[],subscribe:[],firstVideoFrameDecoded:[]},joinChannelServiceRecords:[],cloudProxyServerMode:"disabled",useP2P:!1,p2pTransport:E0.Default,hasStartJoinChannel:!1,isABTestSuccess:!1,autoSubscribe:!1,enableInstantMuteRestore:!1}}dispatch(ut){this.state=function(pt,mt){switch(mt.type){case co.SET_SESSION_ID:return hr(hr({},pt),{},{sessionId:mt.sessionId});case co.SET_P2P_ID:return hr(hr({},pt),{},{p2pId:mt.p2pId});case co.SET_UID:return hr(hr({},pt),{},{uid:mt.uid});case co.SET_INT_UID:return hr(hr({},pt),{},{intUid:mt.intUid});case co.SET_PUB_ID:return hr(hr({},pt),{},{pubId:mt.pubId});case co.KEY_METRIC_CLIENT_CREATED:return hr(hr({},pt),{},{keyMetrics:hr(hr({},pt.keyMetrics),{},{clientCreated:mt.metric})});case co.KEY_METRIC_JOIN_START:return hr(hr({},pt),{},{keyMetrics:hr(hr({},pt.keyMetrics),{},{joinStart:mt.metric})});case co.KEY_METRIC_PRELOAD_START:return hr(hr({},pt),{},{keyMetrics:hr(hr({},pt.keyMetrics),{},{preloadStart:mt.metric})});case co.KEY_METRIC_PRELOAD_END:return hr(hr({},pt),{},{keyMetrics:hr(hr({},pt.keyMetrics),{},{preloadEnd:mt.metric})});case co.KEY_METRIC_JOIN_END:return hr(hr({},pt),{},{keyMetrics:hr(hr({},pt.keyMetrics),{},{joinEnd:mt.metric})});case co.KEY_METRIC_REQUEST_AP_START:return hr(hr({},pt),{},{keyMetrics:hr(hr({},pt.keyMetrics),{},{requestAPStart:mt.metric})});case co.KEY_METRIC_REQUEST_AP_END:return hr(hr({},pt),{},{keyMetrics:hr(hr({},pt.keyMetrics),{},{requestAPEnd:mt.metric})});case co.KEY_METRIC_REQUEST_SUA_END:return hr(hr({},pt),{},{keyMetrics:hr(hr({},pt.keyMetrics),{},{requestSUAEnd:mt.metric})});case co.KEY_METRIC_BEFORE_CONNECT:return hr(hr({},pt),{},{keyMetrics:hr(hr({},pt.keyMetrics),{},{beforeConnect:mt.metric})});case co.KEY_METRIC_PEER_RECEIVER:return hr(hr({},pt),{},{keyMetrics:hr(hr({},pt.keyMetrics),{},{peerReceiver:mt.metric})});case co.KEY_METRIC_SIGNAL_CONNECTED:return hr(hr({},pt),{},{keyMetrics:hr(hr({},pt.keyMetrics),{},{signalConnected:mt.metric})});case co.KEY_METRIC_JOIN_REQ:return hr(hr({},pt),{},{keyMetrics:hr(hr({},pt.keyMetrics),{},{joinReq:mt.metric})});case co.KEY_METRIC_JOIN_REP:return hr(hr({},pt),{},{keyMetrics:hr(hr({},pt.keyMetrics),{},{joinRep:mt.metric})});case co.KEY_METRIC_JOIN_GATEWAY_START:return hr(hr({},pt),{},{keyMetrics:hr(hr({},pt.keyMetrics),{},{joinGatewayStart:mt.metric})});case co.KEY_METRIC_JOIN_GATEWAY_END:return hr(hr({},pt),{},{keyMetrics:hr(hr({},pt.keyMetrics),{},{joinGatewayEnd:mt.metric})});case co.KEY_METRIC_PEER_CONNECTION_START:return hr(hr({},pt),{},{keyMetrics:hr(hr({},pt.keyMetrics),{},{peerConnectionStart:mt.metric})});case co.KEY_METRIC_PEER_CONNECTION_END:return hr(hr({},pt),{},{keyMetrics:hr(hr({},pt.keyMetrics),{},{peerConnectionEnd:mt.metric})});case co.KEY_METRIC_DESCRIPTION_START:return hr(hr({},pt),{},{keyMetrics:hr(hr({},pt.keyMetrics),{},{descriptionStart:mt.metric})});case co.KEY_METRIC_SIGNAL_CHANNEL_OPEN:return hr(hr({},pt),{},{keyMetrics:hr(hr({},pt.keyMetrics),{},{signalChannelOpen:mt.metric})});case co.KEY_METRIC_ICE_CONNECTION_END:return hr(hr({},pt),{},{keyMetrics:hr(hr({},pt.keyMetrics),{},{iceConnectionEnd:mt.metric})});case co.KEY_METRIC_PUBLISH:{const _t=pt.keyMetrics.publish,vt=_t.findIndex(Tt=>Tt.trackId===mt.metric.trackId);return vt!==-1?(_t[vt]=hr(hr({},_t[vt]),mt.metric),hr(hr({},pt),{},{keyMetrics:hr(hr({},pt.keyMetrics),{},{publish:[..._t]})})):hr(hr({},pt),{},{keyMetrics:hr(hr({},pt.keyMetrics),{},{publish:[...pt.keyMetrics.publish,mt.metric]})})}case co.KEY_METRIC_SUBSCRIBE:{const _t=pt.keyMetrics.subscribe,vt=_t.findIndex(Tt=>Tt.userId===mt.metric.userId&&Tt.type===mt.metric.type);return vt!==-1?(_t[vt]=hr(hr({},_t[vt]),mt.metric),hr(hr({},pt),{},{keyMetrics:hr(hr({},pt.keyMetrics),{},{subscribe:[..._t]})})):hr(hr({},pt),{},{keyMetrics:hr(hr({},pt.keyMetrics),{},{subscribe:[...pt.keyMetrics.subscribe,mt.metric]})})}case co.KEY_METRIC_FIRST_VIDEO_FRAME_DECODED:{const _t=pt.keyMetrics.firstVideoFrameDecoded,vt=_t.findIndex(Tt=>Tt.userId===mt.metric.userId);return vt!==-1?(_t[vt]=hr(hr({},_t[vt]),mt.metric),hr(hr({},pt),{},{keyMetrics:hr(hr({},pt.keyMetrics),{},{firstVideoFrameDecoded:[..._t]})})):hr(hr({},pt),{},{keyMetrics:hr(hr({},pt.keyMetrics),{},{firstVideoFrameDecoded:[...pt.keyMetrics.firstVideoFrameDecoded,mt.metric]})})}case co.RESET_FIRST_VIDEO_FRAME_DECODED:return pt.keyMetrics.firstVideoFrameDecoded=[],pt;case co.SET_CLOUD_PROXY_SERVER_MODE:return pt.cloudProxyServerMode=mt.mode,pt;case co.RECORD_JOIN_CHANNEL_SERVICE:return typeof mt.index!="number"?pt.joinChannelServiceRecords=[...pt.joinChannelServiceRecords,mt.record]:(pt.joinChannelServiceRecords[mt.index]=hr(hr({},pt.joinChannelServiceRecords[mt.index]),mt.record),pt.joinChannelServiceRecords=[...pt.joinChannelServiceRecords]),pt;case co.RESET_JOIN_CHANNEL_SERVICE_RECORDS:return pt.joinChannelServiceRecords=[],pt;case co.RESET_KEY_METRICS:return pt.keyMetrics={publish:[],subscribe:[],firstVideoFrameDecoded:[]},pt;case co.SET_USE_P2P:return hr(hr({},pt),{},{useP2P:mt.val});case co.SET_TRANSPORT_TYPE:return hr(hr({},pt),{},{p2pTransport:mt.val});default:return pt}}(this.state,ut)}set autoSubscribe(ut){this.state.autoSubscribe=ut}get autoSubscribe(){return this.state.autoSubscribe}set enableInstantMuteRestore(ut){this.state.enableInstantMuteRestore=ut}get enableInstantMuteRestore(){return this.state.enableInstantMuteRestore}set sessionId(ut){this.dispatch({type:co.SET_SESSION_ID,sessionId:ut})}get sessionId(){return this.state.sessionId}set cid(ut){this.state.cid=ut}get cid(){return this.state.cid}set codec(ut){this.state.codec=ut}get codec(){return this.state.codec}get mode(){return this.state.mode}get audioCodec(){return this.state.audioCodec}get clientId(){return this.state.clientId}set p2pId(ut){this.dispatch({type:co.SET_P2P_ID,p2pId:ut})}get p2pId(){return this.state.p2pId}set dcId(ut){this.dispatch({type:co.SET_DC_ID,dcId:ut})}get dcId(){return this.state.dcId}set uid(ut){this.dispatch({type:co.SET_UID,uid:ut})}get uid(){return this.state.uid}set intUid(ut){this.dispatch({type:co.SET_INT_UID,intUid:ut})}get intUid(){return this.state.intUid}set pubId(ut){this.dispatch({type:co.SET_PUB_ID,pubId:ut})}get pubId(){return this.state.pubId}set cloudProxyServerMode(ut){this.dispatch({type:co.SET_CLOUD_PROXY_SERVER_MODE,mode:ut})}get cloudProxyServerMode(){return this.state.cloudProxyServerMode}set useP2P(ut){this.dispatch({type:co.SET_USE_P2P,val:ut})}get useP2P(){return this.state.useP2P}set p2pTransport(ut){this.dispatch({type:co.SET_TRANSPORT_TYPE,val:ut})}get p2pTransport(){return this.state.p2pTransport}set hasStartJoinChannel(ut){this.state.hasStartJoinChannel=ut}get hasStartJoinChannel(){return this.state.hasStartJoinChannel}set isABTestSuccess(ut){this.state.isABTestSuccess=ut}get isABTestSuccess(){return this.state.isABTestSuccess}clientCreated(){this.dispatch({type:co.KEY_METRIC_CLIENT_CREATED,metric:Date.now()})}joinStart(){this.dispatch({type:co.KEY_METRIC_JOIN_START,metric:Date.now()})}preloadStart(){this.dispatch({type:co.KEY_METRIC_PRELOAD_START,metric:Date.now()})}preloadEnd(){this.dispatch({type:co.KEY_METRIC_PRELOAD_END,metric:Date.now()})}joinEnd(){this.dispatch({type:co.KEY_METRIC_JOIN_END,metric:Date.now()})}requestAPStart(){this.dispatch({type:co.KEY_METRIC_REQUEST_AP_START,metric:Date.now()})}requestAPEnd(){this.dispatch({type:co.KEY_METRIC_REQUEST_AP_END,metric:Date.now()})}requestSUAEnd(){this.dispatch({type:co.KEY_METRIC_REQUEST_SUA_END,metric:Date.now()})}beforeConnect(){this.dispatch({type:co.KEY_METRIC_BEFORE_CONNECT,metric:Date.now()})}peerReceiver(){this.dispatch({type:co.KEY_METRIC_PEER_RECEIVER,metric:Date.now()})}signalConnected(){this.dispatch({type:co.KEY_METRIC_SIGNAL_CONNECTED,metric:Date.now()})}joinReq(){this.dispatch({type:co.KEY_METRIC_JOIN_REQ,metric:Date.now()})}joinRep(){this.dispatch({type:co.KEY_METRIC_JOIN_REP,metric:Date.now()})}joinGatewayStart(){this.dispatch({type:co.KEY_METRIC_JOIN_GATEWAY_START,metric:Date.now()})}joinGatewayEnd(){this.dispatch({type:co.KEY_METRIC_JOIN_GATEWAY_END,metric:Date.now()})}peerConnectionStart(){this.dispatch({type:co.KEY_METRIC_PEER_CONNECTION_START,metric:Date.now()})}peerConnectionEnd(){this.dispatch({type:co.KEY_METRIC_PEER_CONNECTION_END,metric:Date.now()})}firstVideoFrameDecoded(ut,pt){this.dispatch({type:co.KEY_METRIC_FIRST_VIDEO_FRAME_DECODED,metric:hr({userId:ut},pt)})}descriptionStart(){this.dispatch({type:co.KEY_METRIC_DESCRIPTION_START,metric:Date.now()})}signalChannelOpen(){this.dispatch({type:co.KEY_METRIC_SIGNAL_CHANNEL_OPEN,metric:Date.now()})}iceConnectionEnd(){this.dispatch({type:co.KEY_METRIC_ICE_CONNECTION_END,metric:Date.now()})}publish(ut,pt,mt,_t){this.dispatch({type:co.KEY_METRIC_PUBLISH,metric:hr(hr({trackId:ut,type:pt},mt&&{publishStart:mt}),_t&&{publishEnd:_t})})}subscribe(ut,pt,mt,_t,vt,Tt,bt){this.dispatch({type:co.KEY_METRIC_SUBSCRIBE,metric:hr(hr(hr(hr(hr({userId:ut,type:pt},mt&&{subscribeStart:mt}),_t&&{subscribeEnd:_t}),vt&&{firstFrame:vt}),Tt&&{streamAdded:Tt}),bt&&{firstDecoded:bt})})}massSubscribe(ut,pt,mt,_t){ut.forEach(vt=>{this.dispatch({type:co.KEY_METRIC_SUBSCRIBE,metric:hr(hr(hr({userId:vt.userId,type:vt.type},pt&&{subscribeStart:pt}),mt&&{subscribeEnd:mt}),_t&&{firstFrame:_t})})})}get keyMetrics(){return this.state.keyMetrics}recordJoinChannelService(ut,pt){ut.service==="gateway"&&Array.isArray(ut.urls)&&(ut.urls=ut.urls.map(mt=>mt.replace(/(\d+)-\d+-\d+-(\d+)/,"$1-*-*-$2")));try{return typeof pt!="number"?(this.dispatch({type:co.RECORD_JOIN_CHANNEL_SERVICE,record:hr(hr({},ut),{},{sessionId:this.sessionId,cloudProxyMode:this.cloudProxyServerMode,uid:this.uid})}),this.state.joinChannelServiceRecords.length-1):(pt<0||pt>=this.state.joinChannelServiceRecords.length||this.dispatch({type:co.RECORD_JOIN_CHANNEL_SERVICE,record:ut,index:pt}),pt)}catch{return 0}}resetJoinChannelServiceRecords(){this.dispatch({type:co.RESET_JOIN_CHANNEL_SERVICE_RECORDS})}resetKeyMetrics(){this.dispatch({type:co.RESET_KEY_METRICS})}resetFirstVideoFrameDecoded(){this.dispatch({type:co.RESET_FIRST_VIDEO_FRAME_DECODED})}get joinChannelServiceRecords(){try{return this.state.joinChannelServiceRecords}catch{return[]}}}(_e.codec,_e.audioCodec,_e.mode,this._clientId),this._leaveMutex=new lu("client-leave",this._clientId),this._publishMutex=new lu("client-publish",this._clientId),this._renewTokenMutex=new lu("client-renewtoken",this._clientId),this._subscribeMutex=new lu("client-subscribe",this._clientId),this.store.clientCreated(),_e.proxyServer&&this.setProxyServer(_e.proxyServer,!0),_e.turnServer&&this.setTurnServer(_e.turnServer,!0),Ut.info("[".concat(this._clientId,"] Initializing AgoraRTC client v").concat(Zp," build: ").concat(DO,", mode: ").concat(this.mode,", codec: ").concat(this.codec)),_e.clientRoleOptions)try{SO(_e.clientRoleOptions),it=Object.assign({},_e.clientRoleOptions)}catch(ut){Ut.warning("[".concat(this._clientId,"] ").concat(ut.toString()))}var ct;this._statsCollector=new NA(this.store),this._statsCollector.onStatsException=(ut,pt,mt)=>{Ut.warn("[".concat(this._clientId,"] receive exception msg, code: ").concat(ut,", msg: ").concat(pt,", uid: ").concat(mt)),ut===NM.VIDEO_ENCODE_FAILED&&this.localTracks.forEach(_t=>{_t instanceof Rw&&rn("ENABLE_ENCODE_EXCEPTION")&&_t.findClosestProfile()}),this.safeEmit(wo.EXCEPTION,{code:ut,msg:pt,uid:mt})},this._statsCollector.onUploadPublishDuration=(ut,pt,mt,_t)=>{const vt=this._users.find(Tt=>Tt.uid===ut);vt&&(this.store.keyMetrics&&(this.store.firstVideoFrameDecoded(vt._uintid,{peerPublishDuration:mt,peerPubStatusMs:Date.now()}),this._p2pChannel.reportVideoFirstFrameRender(vt)),Vr.peerPublishStatus(this._sessionId,{subscribeElapse:_t,audioPublishDuration:pt,videoPublishDuration:mt,peer:vt._uintid}))},this._statsCollector.onVideoCodecChanged=ut=>{if(rn("VIDEO_STANDARD_BITRATE_VERSION")&&(ut==="av1"||ut==="h265"||ut==="h264")){const pt=this.localTracks.find(mt=>mt instanceof Cs);pt&&pt._saveEncodeBitrateRatio!==1&&pt.setSaveEncodeBitrateRatio(ut==="h264"?rn("BASELINE_MORE_H264_BITRATE_RATIO"):void 0)}},this.store.useP2P=_e.mode==="p2p",this._gateway=new BX(this.store,{clientId:this._clientId,mode:this.mode,codec:this.codec,websocketRetryConfig:_e.websocketRetryConfig||xa,httpRetryConfig:_e.httpRetryConfig||xa,forceWaitGatewayResponse:_e.forceWaitGatewayResponse===void 0||_e.forceWaitGatewayResponse,statsCollector:this._statsCollector,role:_e.role,clientRoleOptions:it}),this._configDistribute=new XX(this._clientId,this.store),this.store.useP2P?(this._p2pChannel=(ct={store:this.store,statsCollector:this._statsCollector},gE("P2PChannel").create(ct)),this._handleP2PEvents()):this._p2pChannel=new LA(this.store,this._statsCollector),this._handleP2PChannelEvents(),this._handleGatewayEvents(),this._handleGatewaySignalEvents()}async joinMeta(_e,rt,it,ct,ut){let pt=!(arguments.length>5&&arguments[5]!==void 0)||arguments[5],mt=arguments.length>6&&arguments[6]!==void 0&&arguments[6];ns("JOIN_GATEWAY_USE_443PORT_ONLY",pt),ns("JOIN_GATEWAY_USE_DUAL_DOMAIN",mt);const _t=this._gateway.signal.websocket;return _t instanceof EM&&(_t.use443PortOnly=pt,_t.tryDoubleDomain=mt),async function(vt,Tt,bt){aw.get(vt)||aw.set(vt,[]),cw.get(vt)||cw.set(vt,Tt),O_.get(vt)||O_.set(vt,0);const Ot=aw.get(vt),Mt=cw.get(vt);if(!Ot||!Mt)throw new Error("concurrent: deferQueue or maxConcurrency is null");if(O_.get(vt)===Mt){const en=lA();Ot.push(en),await en.promise}O_.set(vt,O_.get(vt)+1);for(var Dt=arguments.length,jt=new Array(Dt>3?Dt-3:0),$t=3;$t<Dt;$t++)jt[$t-3]=arguments[$t];const Ht=await bt(...jt);return O_.set(vt,O_.get(vt)-1),O_.get(vt)===Mt-1&&Ot.length>0&&(Ot[0].resolve(),Ot.shift()),O_.get(vt)===0&&(aw.set(vt,[]),cw.set(vt,0),O_.set(vt,0)),Ht}("client.join",rn("JOIN_MAX_CONCURRENCY"),this.join.bind(this),_e,rt,it,ct,ut)}async join(_e,rt,it,ct,ut){const pt=++this._numberOfJoinCount;this.store.joinStart(),ct&&(this.store.uid=ct);const mt=(mw||mw||(mw=(window.location.protocol.split(":")[0]||"").toUpperCase(),mw))==="HTTPS",_t=$3()?window.isSecureContext:"Browser Not Support";if(!$3()&&!mt||!window.isSecureContext){const Ht="The website must be running in a secure context (About secure context: https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts ), otherwise the media collection will be restricted by the browser";Ut.warning(Ht)}let vt;Vr.setAppId(_e);try{if(!it&&it!==null)throw new $n(tn.INVALID_PARAMS,"Invalid token: ".concat(it,". If you don not use token, set it to null"));if(it&&Hl(it,"token",1,2047),Hl(_e,"appid",1,2047),Uw(rt),ct&&Bw(ct),ut)if(typeof ut=="string")Hl(ut,"optionalInfo",1,256),vt=ut;else{if(typeof ut!="object")throw new $n(tn.INVALID_PARAMS,"Invalid options: options is not a string or object");{const{autoSubscribe:Ht,enableInstantMuteRestore:en}=ut;Ht&&(t_(Ht,"autoSubscribe"),Ut.info("[".concat(this._clientId,"] join: autoSubscribe: ").concat(Ht)),this.store.autoSubscribe=Ht),en&&(t_(en,"enableInstantMuteRestore"),Ut.info("[".concat(this._clientId,"] join: enableInstantMuteRestore: ").concat(en)),this.store.enableInstantMuteRestore=en)}}}catch(Ht){throw Vr.reportApiInvoke(_0(),{name:Ks.JOIN,options:[_e,rt,it,ct],states:{isHttps:mt,isSecureContext:_t},tag:Ns.TRACER}).onError(Ht),Ht}if(this._leaveMutex.isLocked&&(Ut.debug("[".concat(this._clientId,"] join: waiting leave operation")),(await this._leaveMutex.lock())(),Ut.debug("[".concat(this._clientId,"] join: continue"))),this._joinAndNotLeaveYet=!0,this.connectionState!=="DISCONNECTED"){const Ht=new $n(tn.INVALID_OPERATION,"[".concat(this._clientId,"] Client already in connecting/connected state"));throw Vr.reportApiInvoke(_0(),{name:Ks.JOIN,options:[_e,rt,it,ct],states:{isHttps:mt,isSecureContext:_t},tag:Ns.TRACER}).onError(Ht),Ht}this._gateway.state="CONNECTING",this.store.preloadStart();const Tt=await G4({appId:_e,cname:rt,uid:ct,stringUid:typeof ct=="string"?ct:void 0,token:it||_e,cloudProxyServer:this._cloudProxyServerMode});if(this.store.preloadEnd(),!this._joinAndNotLeaveYet)throw new $n(tn.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));const bt=(Tt==null?void 0:Tt.sid)||_0();Ut.info("[".concat(this._clientId,"] start join channel ").concat(rt,", join number: ").concat(pt)),this._sessionId||(this._sessionId=bt,this.store.sessionId=this._sessionId);const Ot=Vr.reportApiInvoke(bt,{id:this._clientId,name:Ks.JOIN,options:[_e,rt,it,ct],states:{isHttps:mt,isSecureContext:_t},tag:Ns.TRACER}),Mt=Om(Om(Om({},this._rtmConfig),{},{role:this.role,clientId:this._clientId,appId:_e,sid:this._sessionId,cname:rt,uid:typeof ct!="string"?ct:null,turnServer:this._turnServer,proxyServer:this._proxyServer,token:it||_e,cloudProxyServer:this._cloudProxyServerMode,optionalInfo:vt,license:this._license,useLocalAccessPoint:this._useLocalAccessPoint,preload:!!Tt},this._remoteDefaultVideoStreamType!==void 0&&{defaultVideoStream:this._remoteDefaultVideoStreamType}),{},{apRequestDetail:rn("AP_REQUEST_DETAIL")||void 0});if(this._useLocalAccessPoint&&(Mt.setLocalAPVersion=this._setLocalAPVersion),typeof ct=="string"&&(Mt.stringUid=ct,this._uintUid?(Mt.uid=this._uintUid,this._uintUid=void 0):Mt.uid=0),this._encryptionMode!=="none"&&this._encryptionSecret){if(Mt.aesmode=this._encryptionMode,Mt.aespassword=await(async Ht=>{const en=function(vn){const hn=window.atob(`MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDCMnXAHkKIGAM+x4N22gCI+Wyu
STM9ztkT3uYslTT2PuKmZfPzhH6kVdO7PTjGCOZnAsyb3oTtWat0KcxQ4jxvqQV+
HvYl3iI1Yd4vl2c3qRMJPLtRDfNxa2Mcxgq7e9aEUibzdd0st+OJAy3tOj/Y0aVy
xQiYDz3vqa6bP29adwIDAQAB`),Ln=new Uint8Array(new ArrayBuffer(hn.length));for(let Xn=0;Xn<hn.length;Xn+=1)Ln[Xn]=hn.charCodeAt(Xn);return Ln}(),Qt=await window.crypto.subtle.importKey("spki",en,{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt"]),on=vO(Ht),Tn=await window.crypto.subtle.encrypt({name:"RSA-OAEP"},Qt,on);return function(vn){let hn="";for(let Ln=0;Ln<vn.length;Ln+=1)hn+=String.fromCharCode(vn[Ln]);return window.btoa(hn)}(new Uint8Array(Tn))})(this._encryptionSecret),!this._joinAndNotLeaveYet)throw new $n(tn.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));this._encryptionSalt&&(Mt.aessalt=this._encryptionSalt)}if(this._encryptDataStream&&(this._encryptionMode==="aes-128-gcm2"||this._encryptionMode==="aes-256-gcm2"))if(this._encryptionSalt&&this._encryptionSecret)if(window.crypto.subtle){const Ht=new TextEncoder,en=rn("USE_PURE_ENCRYPTION_MASTER_KEY")?Ht.encode(Mt.appId+this._encryptionSecret+this._encryptionSecret):Ht.encode(Mt.appId+Mt.cname+this._encryptionSecret);this._encryptDataStreamIv=await async function(Qt,on,Tn){const vn=await window.crypto.subtle.importKey("raw",on,"PBKDF2",!1,["deriveBits","deriveKey"]),hn=Qt==="aes-128-gcm2"?128:256,Ln=await window.crypto.subtle.deriveBits({name:"PBKDF2",iterations:Z3,hash:"SHA-256",salt:Tn},vn,hn+fY);return new Uint8Array(Ln).subarray(hn/8)}(this._encryptionMode,en,g0(this._encryptionSalt)),this._encryptDataStreamKey=await async function(Qt,on,Tn){const vn=await window.crypto.subtle.importKey("raw",on,"PBKDF2",!1,["deriveBits","deriveKey"]),hn=Qt==="aes-128-gcm2"?128:256;return await window.crypto.subtle.deriveKey({name:"PBKDF2",iterations:Z3,hash:"SHA-256",salt:Tn},vn,{name:"AES-GCM",length:hn},!0,["encrypt","decrypt"])}(this._encryptionMode,en,g0(this._encryptionSalt))}else _t?Ut.warning("[".concat(this._clientId,"] encrypt datastream must be running in a secure context, fallback to plain data stream")):Ut.warning("[".concat(this._clientId,"] current browser do not support WebCrypto ,fallback to plain data stream")),this._encryptDataStream=!1;else this._encryptDataStream=!1,Ut.debug("[".concat(this._clientId,"] no salt / secret, cannot support encrypt data stream, fallback to plain data stream"));this._startSession(this._sessionId,{channel:rt,appId:_e,stringUid:Mt.stringUid});const Dt=this._sessionId;setTimeout(()=>{this.connectionState==="CONNECTING"&&Dt===this._sessionId&&Vr.joinChannelTimeout(this._sessionId,5)},5e3);try{var jt;let Ht;const en=Mt.cloudProxyServer;if(Er(jt=["proxy3","proxy4","proxy5"]).call(jt,en)){const hn=rn("PROXY_SERVER_TYPE3");Array.isArray(hn)?Mt.proxyServer=hn[0]:Mt.proxyServer=hn}if(Vr.setProxyServer(Mt.proxyServer),Ut.setProxyServer(Mt.proxyServer),this.store.requestAPStart(),Tt){if(Ut.debug("[".concat(this._clientId,"] get serverInfo Success from Preload Cache ").concat(Mt.stringUid?", ".concat(Mt.stringUid," => ").concat(Tt.intUid):""," ")),Mt.stringUid&&!Mt.uid&&(Mt.uid=Tt.intUid),Ht={gatewayInfo:Tt.ap.gatewayInfo},rn("JOIN_WITH_FALLBACK_MEDIA_PROXY")&&Mt.turnServer.mode==="auto")if(Tt.ap.proxyInfo.addresses.length===0)Ut.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers");else{const hn=(await UV(Tt.ap.proxyInfo,Tt.ap.gatewayInfo.uid)).map(Ln=>({turnServerURL:Ln.address,tcpport:Ln.tcpport||iu.tcpport,udpport:Ln.udpport||iu.udpport,username:Ln.username||iu.username,password:Ln.password||iu.password,forceturn:!1,security:!0}));Mt.turnServer={mode:"manual",servers:hn}}j4(Tt,Mt.stringUid)}else{if(Mt.stringUid&&!Mt.uid){let hn;[hn,Ht]=await Ir.all([d4(Mt.stringUid,Mt,this._axiosCancelSource.token,this._config.httpRetryConfig||xa,this.store).finally(()=>{this.store.requestSUAEnd()}),u4(Mt,this._axiosCancelSource.token,this._config.httpRetryConfig||xa,!0,this.store).finally(()=>{this.store.requestAPEnd()})]),Ut.debug("[".concat(this._clientId,"] getUserAccount Success ").concat(Mt.stringUid," => ").concat(hn)),Mt.uid=hn,Ht.gatewayInfo.uid=hn,Ht.gatewayInfo.res.uid=hn}else Ht=await u4(Mt,this._axiosCancelSource.token,this._config.httpRetryConfig||xa,!0,this.store);if(!this._joinAndNotLeaveYet)throw new $n(tn.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"))}this.store.requestAPEnd(),setTimeout(()=>{this._configDistribute.startGetConfigDistribute(Mt,this._axiosCancelSource.token),this._configDistribute.on(CA.UPDATE_BITRATE_LIMIT,hn=>{this._p2pChannel.updateBitrateLimit(hn)}),this._configDistribute.on(CA.UPDATE_CLIENT_ROLE_OPTIONS,hn=>{this._setClientRoleOptions(hn)})},0),this._key=it||_e;const Qt=Ht.gatewayInfo,on=Mt.uid?Mt.uid:Qt.uid;this._joinInfo=Om(Om({},Mt),{},{cid:Qt.cid,uid:on,vid:Qt.vid,apResponse:Qt.res,apGatewayAddress:Qt.apGatewayAddress,uni_lbs_ip:Qt.uni_lbs_ip,gatewayAddrs:Qt.gatewayAddrs}),this.store.intUid=on,this.store.cid=Qt.cid;const Tn=await this._joinGateway();if(!this._joinAndNotLeaveYet)throw new $n(tn.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));Ot.onSuccess(Tn),this._appId=_e,this._channelName=Mt.cname,this._uid=Tn,this.store.uid=Tn,setTimeout(()=>{this._networkQualityInterval&&window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=window.setInterval(this._handleUpdateNetworkQuality,2e3),window.addEventListener(tu()?"beforeunload":"pagehide",this._handleBeforeUnload),this._statsCollector.startUpdateStats()},0);const vn=Mt.stringUid?"string uid: ".concat(Mt.stringUid,",uid: ").concat(Mt.uid):"uid: ".concat(this._uid);return Ut.info("[".concat(this._clientId,"] Joining channel success: channel: ").concat(rt,",").concat(vn)),setTimeout(()=>{Ut.startUpload()},5e3),this.store.joinEnd(),$t=this,Er(C0).call(C0,$t)||C0.push($t),this._cloudProxyServerMode==="disabled"&&Fo().supportWebCrypto&&rn("ENABLE_PRELOAD")&&KM(this._joinInfo),Tn}catch(Ht){const en=Array.isArray(Ht)?Ht[0]:Ht;throw en&&en.code===tn.OPERATION_ABORTED?Ut.warning("[".concat(this._clientId,"] join number: ").concat(pt,", Joining channel failed, rollback"),en):Ut.error("[".concat(this._clientId,"] join number: ").concat(pt,", Joining channel failed, rollback"),en),en.code!==tn.OPERATION_ABORTED&&this._numberOfJoinCount===pt&&(this._gateway.state="DISCONNECTED",this._reset()),Ot.onError(en),en}var $t}_joinGateway(){if(!this._joinInfo||!this._key)throw new $n(tn.INVALID_OPERATION);return this._gateway.join(this._joinInfo,this._key,!(this._joinInfo.cloudProxyServer!=="disabled"||this._joinInfo.proxyServer||!rn("JOIN_WITH_FALLBACK_SIGNAL_PROXY")))}async leave(){Ut.info("[".concat(this._clientId,"] Leaving channel")),window.removeEventListener(tu()?"beforeunload":"pagehide",this._handleBeforeUnload),this._reset(),function(rt){const it=C0.indexOf(rt);it!==-1&&C0.splice(it,1)}(this),this._statsCollector.stopUpdateStats();const _e=await this._leaveMutex.lock();if(this.connectionState==="DISCONNECTED")return Ut.info("[".concat(this._clientId,"] Leaving channel repeated, success")),void _e();await this._gateway.leave(this.connectionState!=="CONNECTED",Xo.LEAVE),Ut.info("[".concat(this._clientId,"] Leaving channel success")),this._joinAndNotLeaveYet=!1,this.store.resetJoinChannelServiceRecords(),_e()}async publish(_e){let rt=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!Array.isArray(_e)){if(!(_e instanceof CS))return this._publishDataChannel(_e);_e=[_e]}if(_e.length===0)throw new $n(tn.INVALID_PARAMS,"param list is empty");const it=_e;if(this._gateway.role==="audience")throw new $n(tn.INVALID_OPERATION,"audience can not publish stream");for(const ut of it){if(!(ut instanceof CS))throw new $n(tn.INVALID_PARAMS,"parameter is not local track");if(!ut._enabled&&rt)throw new $n(tn.TRACK_IS_DISABLED,"can not publish a disabled track: ".concat(ut.getTrackId()))}Ut.info("[".concat(this._clientId,"] Publishing tracks, id ").concat(it.map(ut=>"".concat(ut.getTrackId()," "))));const ct=await this._publishMutex.lock();await this._configDistribute.awaitConfigDistributeComplete(),rt&&it.forEach(ut=>{const pt=this._configDistribute.getBitrateLimit();ut instanceof Cs&&pt&&ut.setBitrateLimit(pt.uplink)});try{await this._publishHighStream(it),Ut.info("[".concat(this._clientId,"] Publish success, id ").concat(it.map(ut=>"".concat(ut.getTrackId()," "))))}catch(ut){throw Ut.error("[".concat(this._clientId,"] publish error"),ut.toString()),ut}finally{ct()}}async _publishDataChannel(_e){if(_e==null)throw new $n(tn.INVALID_PARAMS,"parameter is not local track or datachannel config, config is ".concat(JSON.stringify(_e)));us(_e.id,"id",0,65535,!0),t_(_e.ordered,"ordered"),Hl(_e.metadata,"metadata",0,512),Ut.info("[".concat(this._clientId,"] Publishing datachannels, id ").concat(_e.id));const rt=await this._publishMutex.lock();try{if(this._p2pChannel.getAllDataChannels().findIndex(ut=>ut.id===_e.id)!==-1)throw new $n(tn.INVALID_PARAMS,"Invalid id: ".concat(_e.id,". If you want to republish the datachannel, unpublish first"));if(!this._joinInfo||this._uid===void 0)throw new $n(tn.INVALID_OPERATION,"Can't publish datachannel, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new $n(tn.INVALID_OPERATION,"can not publish datachannel in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&rn("FORCE_TURN")&&!rn("TURN_ENABLE_TCP")&&!rn("TURN_ENABLE_UDP"))throw new $n(tn.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");const it=function(ut){return t4(ut,!1)}(_e),ct=await this._p2pChannel.publishDataChannel([it]);if(ct.length>0){if(typeof it._originDataChannelId!="number")throw Ut.error("[".concat(this._clientId,"] can not publish with mediaType datachannel, cannot get RTCDatachannel id")),new $n(tn.CREATE_DATACHANNEL_ERROR);try{await Ir.all(ct.map(ut=>this._uid&&this._gateway.publishDataChannel(this._uid,ut,!0))),await it._waitTillOpen()}catch(ut){if(ut.code!==tn.DISCONNECT_P2P)throw ut}}return Ut.info("[".concat(this._clientId,"] Publish dataChannels success, id ").concat(it.id)),it}catch(it){throw Ut.error("[".concat(this._clientId,"] publish datachannels error"),it.toString()),it}finally{rt()}}async unpublish(_e){if(!this._joinInfo||this._uid===void 0)throw new $n(tn.INVALID_OPERATION,"Can't unpublish stream, haven't joined yet!");let rt=[];if(_e)if(Array.isArray(_e))rt=_e;else{if(!(_e instanceof CS))return this._unpublishDataChannel([_e]);rt=[_e]}else this.store.useP2P||await this._unpublishDataChannel(),rt=this._p2pChannel.getAllTracks(!0);Ut.info("[".concat(this._clientId,"] Unpublish tracks, tracks ").concat(rt.map(ct=>"".concat(ct.getTrackId()," "))," "));const it=await this._publishMutex.lock();try{if(this.store.useP2P){const ct=await this._p2pChannel.unpublish(rt);ct&&await this._gateway.sendExtensionMessage(qs.UNPUBLISH,{unpubMsg:ct},!0)}else{const ct=await this._p2pChannel.unpublish(rt);ct&&await this._gateway.unpublish(ct,this._uid),Ut.info("[".concat(this._clientId,"] Unpublish success,tracks ").concat(rt.map(ut=>"".concat(ut.getTrackId()))))}}catch(ct){throw Ut.error("[".concat(this._clientId,"] unpublish error"),ct.toString()),ct}finally{it&&it()}}async _unpublishDataChannel(_e){_e!==void 0&&_e.length!==0||(_e=this._p2pChannel.getAllDataChannels()),Ut.info("[".concat(this._clientId,"] Unpublish datachannels, datachannels ").concat(_e.map(it=>"".concat(it.id," "))," "));const rt=await this._publishMutex.lock();try{const it=await this._p2pChannel.unpublishDataChannel(_e);it&&await this._gateway.unpublishDataChannel(it),Ut.info("[".concat(this._clientId,"] Unpublish dataChannel success,dataChannel ").concat(_e.map(ct=>"".concat(ct.id))))}catch(it){throw Ut.error("[".concat(this._clientId,"] unpublish dataChannel error"),it.toString()),it}finally{rt&&rt()}}async subscribe(_e,rt,it){if(!(_e instanceof pv)){const ct=this.remoteUsers.find(ut=>ut.uid===_e);if(!ct)throw new $n(tn.INVALID_REMOTE_USER,"user is not in the channel");_e=ct}return rt==="datachannel"?this._subscribeDataChannel(_e,it):this._subscribe(_e,rt)}async presubscribe(_e,rt){if(Cl(rt,"mediaType",["audio","video"]),this.store.useP2P)throw new $n(tn.INVALID_OPERATION,"can't presub at p2p mode");if(!this._joinInfo)throw new $n(tn.INVALID_OPERATION,"can't presub when not join");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new $n(tn.INVALID_OPERATION,"can't presub in ".concat(this.connectionState," state"));const it=rt===Pr.AUDIO,ct=rt===Pr.VIDEO,ut=await this._subscribeMutex.lock();try{const{ssrcId:pt,ortc:mt,rtxSsrcId:_t,cname:vt,uint_id:Tt}=await this._gateway.presubscribe(_e,rt,!0);if(pt==null)throw new $n(tn.UNEXPECTED_RESPONSE,"no ssrc id");let bt=this._users.find(Mt=>Mt.uid===_e);bt||(bt=new pv(_e,Tt||_e),bt._is_pre_created=!0,this._users.push(bt)),vt&&(bt._cname=vt),bt._uintid||(bt._uintid=Tt||_e),it&&(bt._audioSSRC=pt,bt._audio_pre_subscribed=!0,mt&&(bt._audioOrtc=mt)),ct&&(bt._videoSSRC=pt,bt._video_pre_subscribed=!0,mt&&(bt._videoOrtc=mt),_t!=null&&(bt._rtxSsrcId=_t)),Ut.info("[".concat(this._clientId,"] presub succeed ssrc: ").concat(pt)),await this._p2pChannel.subscribe(bt,rt,pt,_t,mt);const Ot=it?bt._audioTrack:bt._videoTrack;if(!Ot)throw new $n(tn.UNEXPECTED_ERROR,"can not find remote track in user");return it&&(bt._trust_audio_stream_added_state_=!0,bt._audio_added_=!0),ct&&(bt._trust_video_stream_added_state_=!0,bt._video_added_=!0),Ot}catch(pt){throw Ut.error("[".concat(this._clientId,"] presub user ").concat(_e," error"),pt),pt}finally{ut()}}async _subscribeDataChannel(_e,rt){var it;if(us(rt,"channelId",0,65535,!0),!this._joinInfo)throw new $n(tn.INVALID_OPERATION,"Can't subscribe datachannel, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new $n(tn.INVALID_OPERATION,"Can't subscribe datachannel in ".concat(this.connectionState," state"));if(!this._users.find(_t=>_t===_e))throw Ut.error("[".concat(this._clientId,"] can not subscribe ").concat(_e.uid,", this user is not in the channel")),new $n(tn.INVALID_REMOTE_USER,"user is not in the channel");if(!_e.hasAudio&&!_e.hasVideo&&_e._dataChannels.length===0)throw Ut.error("[".concat(this._clientId,"] can not subscribe ").concat(_e.uid,", user is not published")),new $n(tn.INVALID_REMOTE_USER,"user is not published");const ut=(it=_e._dataChannels)===null||it===void 0?void 0:it.find(_t=>_t.id===rt);if(!ut)throw Ut.error("[".concat(this._clientId,"] can not subscribe ").concat(_e.uid," with mediaType datachannel, remote datachannel is not published")),new $n(tn.REMOTE_USER_IS_NOT_PUBLISHED);const pt=await this._subscribeMutex.lock();Ut.info("[".concat(this._clientId,"] subscribe user ").concat(_e.uid,", mediaType: datachannel"));try{const _t=await this._p2pChannel.subscribeDataChannel(_e,[ut]);if(_t&&Er(_t).call(_t,ut.id))try{var mt;if(typeof ut._originDataChannelId!="number")throw Ut.error("[".concat(this._clientId,"] can not subscribe ").concat(_e.uid," with mediaType datachannel, cannot get RTCDatachannel")),new $n(tn.CREATE_DATACHANNEL_ERROR);const vt={id:ut.id,datachannelId:ut._originDataChannelId,ordered:ut.ordered,maxRetransmits:ut.maxRetransmits,metadata:(mt=ut.metadata)!==null&&mt!==void 0?mt:""};await this._gateway.subscribeDataChannel(_e.uid,vt,!0),await ut._waitTillOpen()}catch(vt){if((vt==null?void 0:vt.code)!==tn.WS_ABORT)throw await this._p2pChannel.unsubscribeDataChannel(_e,[ut]),vt;await this._p2pChannel.unsubscribeDataChannel(_e,[ut]),this._p2pChannel.setPendingRemoteDataChannel(_e,ut.id)}return Ut.info("[".concat(this._clientId,"] subscribe success user ").concat(_e.uid,", mediaType: datachannel")),ut}finally{pt()}}async _p2pSubscribe(_e,rt,it){if(Cl(rt,"mediaType",["audio","video"]),!this._joinInfo)throw new $n(tn.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new $n(tn.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(pt=>pt===_e)){const pt=new $n(tn.INVALID_REMOTE_USER,"user is not in the channel");throw Ut.error("[".concat(this._clientId,"] can not subscribe ").concat(_e.uid,", this user is not in the channel")),pt}if(!_e.hasAudio&&!_e.hasVideo){const pt=new $n(tn.INVALID_REMOTE_USER,"user is not published");throw Ut.error("[".concat(this._clientId,"] can not subscribe ").concat(_e.uid,", user is not published")),pt}if(!it&&(rt==="audio"&&!_e.hasAudio||rt==="video"&&!_e.hasVideo)){const pt=new $n(tn.REMOTE_USER_IS_NOT_PUBLISHED);throw Ut.error("[".concat(this._clientId,"] can not subscribe ").concat(_e.uid," with mediaType ").concat(rt,", remote track is not published")),pt}const ut=await this._subscribeMutex.lock();Ut.info("[".concat(this._clientId,"] subscribe user ").concat(_e.uid,", mediaType: ").concat(rt));try{if(await this._p2pChannel.hasRemoteMediaWithLock(_e,rt))await this._p2pChannel.unmuteRemote(_e,rt);else try{const mt=rt==="audio"?_e._audioSSRC:_e._videoSSRC,_t=rt==="audio"?_e._audioMid:_e._videoMid;this.store.subscribe(_e.uid,rt,Date.now()),this.store.useP2P&&await this._p2pChannel.subscribe(_e,rt,mt,_t)}catch(mt){throw mt}Ut.info("[".concat(this._clientId,"] subscribe success user ").concat(_e.uid,", mediaType: ").concat(rt)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(_e.uid,this._defaultStreamFallbackType).catch(mt=>{Ut.warning("[".concat(this._clientId,"] auto set fallback failed"),mt)});const pt=rt==="audio"?_e._audioTrack:_e._videoTrack;if(!pt)throw new $n(tn.UNEXPECTED_ERROR,"can not find remote track in user object");return pt}catch(pt){throw Ut.error("[".concat(this._clientId,"] subscribe user ").concat(_e.uid," error"),pt),pt}finally{ut()}}async _subscribe(_e,rt,it){if(this.store.useP2P)return this._p2pSubscribe(_e,rt);if(Cl(rt,"mediaType",["audio","video"]),!this._joinInfo)throw new $n(tn.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new $n(tn.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(Tt=>Tt===_e)){const Tt=new $n(tn.INVALID_REMOTE_USER,"user is not in the channel");throw Ut.error("[".concat(this._clientId,"] can not subscribe ").concat(_e.uid,", this user is not in the channel")),Tt}if(!_e.hasAudio&&!_e.hasVideo){const Tt=new $n(tn.INVALID_REMOTE_USER,"user is not published");throw Ut.error("[".concat(this._clientId,"] can not subscribe ").concat(_e.uid,", user is not published")),Tt}if(!(it||(rt!=="audio"||_e.hasAudio&&_e._audioSSRC!==void 0)&&(rt!=="video"||_e.hasVideo&&_e._videoSSRC!==void 0))){const Tt=new $n(tn.REMOTE_USER_IS_NOT_PUBLISHED);throw Ut.error("[".concat(this._clientId,"] can not subscribe ").concat(_e.uid," with mediaType ").concat(rt,", remote track is not published")),Tt}let ut=rt==="audio"?_e._audioSSRC:_e._videoSSRC,pt=rt==="audio"?_e._audioOrtc:_e._videoOrtc,mt=rt==="video"?_e._rtxSsrcId:void 0,_t={stream_type:rt==="audio"?Pr.AUDIO:Pr.VIDEO,ssrcId:ut};rt==="video"&&this.store.firstVideoFrameDecoded(_e.uid,{subscribeStart:Date.now()});const vt=await this._subscribeMutex.lock();Ut.info("[".concat(this._clientId,"] subscribe user ").concat(_e.uid,", mediaType: ").concat(rt));try{if(await this._p2pChannel.hasRemoteMediaWithLock(_e,rt))await this._p2pChannel.unmuteRemote(_e,rt);else try{const bt=rt==="audio"?_e._audioSSRC:_e._videoSSRC;bt!==void 0&&bt!==ut&&(ut=bt,pt=rt==="audio"?_e._audioOrtc:_e._videoOrtc,mt=rt==="video"?_e._rtxSsrcId:void 0,_t={stream_type:rt==="audio"?Pr.AUDIO:Pr.VIDEO,ssrcId:ut}),pu.markSubscribeStart(this.store.clientId,ut),this.store.subscribe(_e.uid,rt,Date.now()),await this._p2pChannel.subscribe(_e,rt,ut,mt,pt);try{this._p2pChannel.isPreSubScribe(ut)||await this._gateway.subscribe(_e.uid,_t,!0)}catch(Ot){if((Ot==null?void 0:Ot.code)!==tn.WS_ABORT)throw await this._p2pChannel.unsubscribe(_e,rt),Ot;await this._p2pChannel.unsubscribe(_e,rt,!0),this._p2pChannel.setPendingRemoteMedia(_e,rt)}this.store.subscribe(_e.uid,rt,void 0,Date.now()),this._p2pChannel.reportSubscribeEvent(!0,null,_e,rt)}catch(bt){throw this._p2pChannel.reportSubscribeEvent(!1,bt==null?void 0:bt.code,_e,rt),bt}Ut.info("[".concat(this._clientId,"] subscribe success user ").concat(_e.uid,", mediaType: ").concat(rt)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(_e.uid,this._defaultStreamFallbackType).catch(bt=>{Ut.warning("[".concat(this._clientId,"] auto set fallback failed"),bt)});const Tt=rt==="audio"?_e._audioTrack:_e._videoTrack;if(!Tt)throw new $n(tn.UNEXPECTED_ERROR,"can not find remote track in user object");return rt==="video"&&(this.store.firstVideoFrameDecoded(_e.uid,{subscribeEnd:Date.now()}),this._p2pChannel.reportVideoFirstFrameRender(_e)),Tt}catch(Tt){throw Ut.error("[".concat(this._clientId,"] subscribe user ").concat(_e.uid," error"),Tt),Tt}finally{vt()}}async massSubscribe(_e){if(pE(_e,"subscribeList"),!this._joinInfo)throw new $n(tn.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new $n(tn.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));const rt=Date.now(),it=new Map,ct=await this._subscribeMutex.lock();Ut.info("[".concat(this._clientId,"]start massSubscribe user ").concat(_e.map(_t=>{let{user:vt,mediaType:Tt}=_t;return"user: ".concat(vt==null?void 0:vt.uid,", mediaType: ").concat(Tt)}).join("; ")));const ut=(_e=[..._e]).map(_t=>{let{user:vt,mediaType:Tt}=_t;return{user:vt,mediaType:Tt}}),pt=await this._p2pChannel.globalLock();try{var mt;for(let vt=_e.length-1;vt>=0;vt--){const Tt=_e[vt],{user:bt,mediaType:Ot}=Tt;if(Cl(Ot,"mediaType",["audio","video"]),!bt){const $t=new $n(tn.INVALID_PARAMS,"user property does not exist in subscribeList item");throw Ut.error("[".concat(this._clientId,"] user property does not exist in subscribeList item")),$t}if(!this._users.find($t=>$t===bt)){const $t=new $n(tn.INVALID_REMOTE_USER,"user is not in the channel");Ut.error("[".concat(this._clientId,"] can not massSubscribe ").concat(bt.uid,", this user is not in the channel")),ut[vt].error=$t,_e.splice(vt,1);continue}if(Ot==="audio"&&(!bt.hasAudio||bt._audioSSRC===void 0)||Ot==="video"&&(!bt.hasVideo||bt._videoSSRC===void 0)){const $t=new $n(tn.REMOTE_USER_IS_NOT_PUBLISHED);Ut.error("[".concat(this._clientId,"] can not subscribe ").concat(bt.uid," with mediaType ").concat(Ot,", remote user is not published")),ut[vt].error=$t,_e.splice(vt,1);continue}const Dt=Dl.Video|Dl.LwoVideo,jt=it.get(bt);if(jt){if(Ot==="video"?jt&Dt:jt&Dl.Audio){_e.splice(vt,1),Ut.warning("[".concat(this._clientId,"] repeat massSubscribe user:").concat(bt.uid,", mediaType:").concat(Ot," twice"));continue}it.set(bt,jt|(Ot==="video"?Dt:Dl.Audio))}else it.set(bt,Ot==="video"?Dt:Dl.Audio)}for(let vt=_e.length-1;vt>=0;vt--){const Tt=_e[vt],{user:bt,mediaType:Ot}=Tt,Mt=Dl.Video|Dl.LwoVideo;if(this._p2pChannel.hasRemoteMedia(bt,Ot)){await this._p2pChannel.unmuteRemoteNoLock(bt,Ot);const Dt=it.get(bt);it.set(bt,Ot==="video"?Dt^Mt:Dt^Dl.Audio),_e.splice(vt,1)}}this.store.massSubscribe(_e.map(vt=>({userId:vt.user.uid,type:vt.mediaType})),rt);let _t=_p(mt=Array.from(it.entries())).call(mt,(vt,Tt)=>{let[bt,Ot]=Tt;if(Ot===0)return vt;const Mt={stream_id:bt.uid,stream_type:Ot};return Ot&Dl.Audio&&(Mt.audio_ssrc=bt._audioSSRC),Ot&Dl.Video&&(Mt.video_ssrc=bt._videoSSRC),vt.push(Mt),vt},[]);try{_e.length>0&&await this._p2pChannel.massSubscribeNoLock(_e.map(Tt=>{let{user:bt,mediaType:Ot}=Tt;return{user:bt,mediaType:Ot,ssrcId:Ot===Pr.VIDEO?bt._videoSSRC:bt._audioSSRC,rtxSsrcId:Ot===Pr.VIDEO?bt._rtxSsrcId:void 0}}));const vt=new Map;if(_t=_t.filter(Tt=>Tt.video_ssrc&&!this._p2pChannel.isPreSubScribe(Tt.video_ssrc)||Tt.audio_ssrc&&!this._p2pChannel.isPreSubScribe(Tt.audio_ssrc)||!Tt.video_ssrc&&!Tt.audio_ssrc),_t.length>0){const Tt=await this._gateway.subscribeAll(_t,!0);((Tt==null?void 0:Tt.users)||[]).forEach(bt=>{let{stream_id:Ot,video_error_code:Mt,audio_error_code:Dt,error_code:jt}=bt;(Mt||Dt||jt)&&vt.set(Ot,{video_error_code:Mt,audio_error_code:Dt,error_code:jt})})}if(Array.from(vt.entries()).length>0){const Tt=[];Array.from(vt.entries()).forEach(bt=>{let[Ot,Mt]=bt;const Dt=this.remoteUsers.find(jt=>jt.uid===Ot);if(Dt){let jt;Mt.error_code||Mt.video_error_code&&Mt.audio_error_code?jt=void 0:Mt.video_error_code?jt=Pr.VIDEO:Mt.audio_error_code&&(jt=Pr.AUDIO),Tt.push({user:Dt,mediaType:jt})}}),Tt.length>0&&await this._p2pChannel.massUnsubscribeNoLock(Tt)}for(const Tt of ut){const bt=vt.get(Tt.user.uid);if(bt){const Ot=bt.error_code||Tt.mediaType==="audio"&&bt.audio_error_code||Tt.mediaType==="video"&&bt.video_error_code;if(Ot){const Mt=bA(Ot);Ut.error("user:".concat(Tt.user.uid," mediaType:").concat(Tt.mediaType," has massSubscribe error ").concat(Mt.desc)),Tt.error=new $n(tn.SUBSCRIBE_FAILED,"code ".concat(Ot,": ").concat(Mt.desc))}}Tt.error||(Tt.mediaType==="video"?Tt.track=Tt.user.videoTrack:Tt.track=Tt.user.audioTrack)}return this.store.massSubscribe(ut.filter(Tt=>!Tt.error).map(Tt=>({userId:Tt.user.uid,type:Tt.mediaType})),void 0,Date.now()),ut.forEach(Tt=>{var bt;Vr.subscribe(this.store.sessionId,{succ:!!Tt.error,ec:((bt=Tt.error)===null||bt===void 0?void 0:bt.code)||null,video:Tt.mediaType===Pr.VIDEO,audio:Tt.mediaType===Pr.AUDIO,peerid:Tt.user.uid,subscribeRequestid:Tt.mediaType===Pr.VIDEO?Tt.user._videoSSRC:Tt.user._audioSSRC,p2pid:this.store.p2pId,eventElapse:Math.floor(performance.now()-rt),preSsrc:this._p2pChannel.isPreSubScribe(Tt.user._videoSSRC)},!0)}),Ut.info("[".concat(this._clientId,"] massSubscribe success ").concat(_e.map(Tt=>{let{user:bt,mediaType:Ot}=Tt;return"user: ".concat(bt==null?void 0:bt.uid,", mediaType: ").concat(Ot)}).join("; "))),ut}catch(vt){throw await this._p2pChannel.massUnsubscribeNoLock(_e),vt}}finally{pt(),ct()}}async unsubscribe(_e,rt,it){if(!(_e instanceof pv)){const pt=this.remoteUsers.find(mt=>mt.uid===_e);if(!pt)throw new $n(tn.INVALID_REMOTE_USER,"user is not in the channel");_e=pt}if(rt||this.store.useP2P){if(rt==="datachannel")return this._unsubscribeDataChannel(_e,it)}else await this._unsubscribeDataChannel(_e,it);if(rt&&Cl(rt,"mediaType",["audio","video"]),!this._joinInfo)throw new $n(tn.INVALID_OPERATION,"Can't unsubscribe stream, haven't joined yet!");if(!this._users.find(pt=>pt===_e)){const pt=new $n(tn.INVALID_REMOTE_USER,"user is not in the channel");throw Ut.error("[".concat(this._clientId,"] can not unsubscribe ").concat(_e.uid,", user is not in the channel")),pt}Ut.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(_e.uid,", mediaType: ").concat(rt));const ut=await this._subscribeMutex.lock();try{if(this.store.useP2P)await this._p2pChannel.unsubscribe(_e,rt);else{const pt=await this._p2pChannel.unsubscribe(_e,rt);pt&&await this._gateway.unsubscribe(pt,_e.uid),rt&&rt!=="audio"||(_e._audio_pre_subscribed=!1),rt&&rt!=="video"||(_e._video_pre_subscribed=!1),_e._is_pre_created&&hw(this._users,_e),Ut.info("[".concat(this._clientId,"] unsubscribe success uid: ").concat(_e.uid,", mediaType: ").concat(rt))}}catch(pt){if(pt.code===tn.DISCONNECT_P2P)return void Ut.warning("disconnecting p2p, abort unsubscribe request.");throw Ut.error("[".concat(this._clientId,"] unsubscribe user ").concat(_e.uid," error"),pt.toString()),pt}finally{ut()}}async _unsubscribeDataChannel(_e,rt){if(rt&&us(rt,"id",0,65535,!0),!this._joinInfo)throw new $n(tn.INVALID_OPERATION,"Can't unsubscribe datachannel, haven't joined yet!");if(!this._users.find(ut=>ut===_e)){const ut=new $n(tn.INVALID_REMOTE_USER,"user is not in the channel");throw Ut.error("[".concat(this._clientId,"] can not unsubscribe ").concat(_e.uid,", user is not in the channel")),ut}let ct;if(typeof rt=="number"){const ut=_e._dataChannels.find(pt=>pt.id===rt);ut&&(ct=[ut])}else ct=_e._dataChannels;if(ct===void 0){const ut=new $n(tn.REMOTE_USER_IS_NOT_PUBLISHED);throw Ut.error("[".concat(this._clientId,"] can not unsubscribe ").concat(_e.uid," with channelId ").concat(rt,", remote datachannel is not published")),ut}Ut.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(_e.uid,", mediaType: datachannel, ids: ").concat(ct.map(ut=>ut.id)));try{const ut=await this._p2pChannel.unsubscribeDataChannel(_e,ct);ut&&await this._gateway.unsubscribeDataChannel(ut,_e.uid),Ut.info("[".concat(this._clientId,"] unsubscribe datachannel success uid: ").concat(_e.uid,", mediaType: datachannel, ids: ").concat(ut))}catch(ut){if(ut.code===tn.DISCONNECT_P2P)return void Ut.warning("disconnecting p2p, abort unsubscribe request.");throw Ut.error("[".concat(this._clientId,"] unsubscribe user ").concat(_e.uid," error"),ut.toString()),ut}}async massUnsubscribe(_e){if(pE(_e,"unsubscribeList"),!this._joinInfo)throw new $n(tn.INVALID_OPERATION,"Can't unsubscribeAll stream, haven't joined yet!");Ut.info("[".concat(this._clientId,"] start massUnsubscribe ").concat(_e.map(it=>{let{user:ct,mediaType:ut}=it;return"user: ".concat(ct==null?void 0:ct.uid,", mediaType: ").concat(ut,";")}).join())),_e=[..._e];const rt=new Map;for(let it=_e.length-1;it>=0;it--){const{user:ct,mediaType:ut}=_e[it];if(!ct){const _t=new $n(tn.INVALID_PARAMS,"user property does not exist in unsubscribeList item");throw Ut.error("[".concat(this._clientId,"] user property does not exist in unsubscribeList item")),_t}if(Cl(ut,"mediaType",["video","audio",void 0]),!this._users.find(_t=>_t===ct)){Ut.warning("[".concat(this._clientId,"] can not unsubscribe ").concat(ct.uid,", user is not in the channel")),_e.splice(it,1);continue}const mt=Dl.Video|Dl.LwoVideo;if(rt.has(ct)){const _t=rt.get(ct);let vt;switch(ut){case"video":vt=_t&mt;break;case"audio":vt=_t&Dl.Audio;break;default:vt=_t&(Dl.Audio|mt)}if(vt){Ut.warning("[".concat(this._clientId,"] repeat massUnsubscribe user:").concat(ct.uid,",mediaType:").concat(ut," twice.")),_e.splice(it,1);continue}ut?ut==="audio"?rt.set(ct,_t|Dl.Audio):ut==="video"&&rt.set(ct,_t|mt):rt.set(ct,_t|Dl.Audio|mt)}else ut?ut==="audio"?rt.set(ct,Dl.Audio):ut==="video"&&rt.set(ct,mt):rt.set(ct,Dl.Audio|mt)}try{const it=await this._p2pChannel.massUnsubscribe(_e);it&&await this._gateway.massUnsubscribe(it),Ut.info("[".concat(this._clientId,"] massUnsubscribe success ").concat(_e.map(ct=>{let{user:ut,mediaType:pt}=ct;return"user: ".concat(ut==null?void 0:ut.uid,", mediaType: ").concat(pt,";")}).join()))}catch(it){if(it.code===tn.DISCONNECT_P2P)return void Ut.warning("[".concat(this._clientId,"] disconnecting p2p, abort unsubscribe request."));throw Ut.error("[".concat(this._clientId,"] massUnsubscribe error"),it.toString()),it}}async setLowStreamParameter(_e){(function(it){if(!it)throw new Yn(tn.INVALID_PARAMS);$s(it.width)||_O(it.width,"streamParameter.width"),$s(it.height)||_O(it.height,"streamParameter.height"),$s(it.framerate)||_O(it.framerate,"streamParameter.framerate"),$s(it.bitrate)||us(it.bitrate,"streamParameter.bitrate")})(_e),(!_e.width&&_e.height||_e.width&&!_e.height)&&Ut.warning("[".concat(this._clientId,"] The width and height parameters take effect only when both are set")),Ut.info("[".concat(this._clientId,"] set low stream parameter to"),JSON.stringify(_e));const rt=this._configDistribute.getLowStreamConfigDistribute();if(rt&&rt.bitrate&&_e.bitrate&&rt.bitrate<_e.bitrate&&(_e.bitrate=rt.bitrate),this._lowStreamParameter=_e,this._isDualStreamEnabled)return this._p2pChannel.updateVideoStreamParameter(_e,or.LocalVideoLowTrack)}async enableDualStream(){if(!Fo().supportDualStream)throw Vr.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),new $n(tn.NOT_SUPPORTED,"Your browser is not support dual stream");if(this._isDualStreamEnabled)throw new $n(tn.INVALID_OPERATION,"Dual stream is already enabled");if(this._p2pChannel.canPublishLowStream())try{await this._publishLowStream()}catch(_e){throw Vr.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),_e}this._isDualStreamEnabled=!0,Vr.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!0}),Ut.info("[".concat(this._clientId,"] enable dual stream"))}async disableDualStream(){if(this._isDualStreamEnabled){if(!this._joinInfo)throw new $n(tn.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this._p2pChannel.getLocalMedia(or.LocalVideoLowTrack))try{const _e=await this._p2pChannel.unpublishLowStream();_e&&await this._gateway.unpublish(_e,this._joinInfo.stringUid||this._joinInfo.uid)}catch(_e){throw Vr.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!1}),_e}this._isDualStreamEnabled=!1,Vr.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!0}),Ut.info("[".concat(this._clientId,"] disable dual stream"))}}async setClientRole(_e,rt){if(function(ct){Cl(ct,"role",["audience","host"])}(_e),rt&&SO(rt),this.mode==="rtc"||this.mode==="p2p")throw Ut.warning("[".concat(this._clientId,"]").concat(this.mode," mode can not use setClientRole")),new $n(tn.INVALID_OPERATION,"".concat(this.mode," mode can not use setClientRole"));if(rt&&rt.level&&_e==="host")throw new $n(tn.INVALID_OPERATION,"host mode can not set audience latency level");if(_e==="audience"&&this._p2pChannel.hasLocalMedia())throw new $n(tn.INVALID_OPERATION,"can not set client role to audience when publishing stream");const it=this._config.role;this._joinInfo&&(this._joinInfo.role=_e),_e!==it&&rn("ENABLE_ROLE_SELECT_EDGE")?(this._gateway.updateClientRole(_e,rt),this._config.role=_e,this._gateway.reconnect("recover",nu.REGIONAL_DISTRIBUTION)):(await this._gateway.setClientRole(_e,rt),this._config.role=_e),Ut.info("[".concat(this._clientId,"] set client role to ").concat(_e,", level: ").concat(rt&&rt.level))}async _setClientRoleOptions(_e){if(this.mode==="rtc"||this.mode==="p2p"||this._config.role!=="audience"||this._p2pChannel.hasLocalMedia())return;let rt=!1;try{_e&&SO(_e),await this._gateway.setClientRole(this._config.role,_e),rt=!0}catch{}finally{Ut.info("[".concat(this._clientId,"] set client role options ").concat(rt?"succeed":"failed",", options is ").concat(_e))}}getRemoteInboundOffset(){var _e;const rt=(_e=this._p2pChannel.getStats())===null||_e===void 0?void 0:_e.audioSend[0];if(!rt||!rt.timestamp)return 0;const it=rt.timestamp-Date.now();return Math.abs(it)>1e3+rt.rttMs+100?this.ntpAlignErrorCount+=1:this.ntpAlignErrorCount=0,this.ntpAlignErrorCount>=3?it:0}getNtpWallTimeInMs(){return document.visibilityState==="visible"&&(this.remoteInboundOffset=this.getRemoteInboundOffset()),this.remoteInboundOffset+Date.now()+this._gateway.ntpOffset}setProxyServer(_e,rt){if(Hl(_e,"proxyServer"),!rt){if(this.connectionState!=="DISCONNECTED")throw new $n(tn.INVALID_OPERATION,"Set proxy server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new $n(tn.INVALID_OPERATION,"You have already set the proxy")}this._proxyServer=_e,Vr.setProxyServer(this._proxyServer),Ut.setProxyServer(this._proxyServer),Ut.info("[".concat(this._clientId,"] Set proxy server ").concat(rt?"by initialize call":""," success."))}setTurnServer(_e,rt){if(Array.isArray(_e)||(_e=[_e]),!rt){if(this.connectionState!=="DISCONNECTED")throw new $n(tn.INVALID_OPERATION,"Set turn server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new $n(tn.INVALID_OPERATION,"You have already set the proxy")}if(pA(_e))return this._turnServer={servers:_e,mode:"original-manual"},void Ut.info("[".concat(this._clientId,"] Set original turnserver ").concat(rt?"by initialize call":""," success: ").concat(_e.map(it=>it.urls).join(","),"."));_e.forEach(it=>O3(it)),this._turnServer={servers:_e,mode:"manual"},Ut.info("[".concat(this._clientId,"] Set turnserver ").concat(rt?"by initialize call":""," success."))}setLicense(_e){if(this.connectionState!=="DISCONNECTED")throw new $n(tn.INVALID_OPERATION,"you should set license before join channel");if(Hl(_e,"license",32,32),!/^[A-Za-z\d]+$/.test(_e))throw new $n(tn.INVALID_PARAMS,"license should only contains characters from A-Z a-z 0-9");this._license=_e,Ut.info("[".concat(this._clientId,"] set license success"),_e)}startProxyServer(_e){if(this.connectionState!=="DISCONNECTED")throw new $n(tn.INVALID_OPERATION,"Start proxy server before join channel");if(this._proxyServer||this._turnServer.mode==="manual"||this._useLocalAccessPoint)throw new $n(tn.INVALID_OPERATION,"You have already set the proxy");const rt=[3,4,5];let it;switch(_e===void 0&&(_e=3),_e){case 1:case 2:throw new $n(tn.NOT_SUPPORTED,"proxy mode 1/2 has been deprecated and not supported.");case 3:it="proxy3";break;case 4:it="proxy4";break;case 5:it="proxy5";break;default:throw new $n(tn.INVALID_PARAMS,"proxy server mode must be ".concat(rt.join("|")))}this._cloudProxyServerMode=it,this.store.cloudProxyServerMode=it,Ut.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode)}stopProxyServer(){if(this.connectionState!=="DISCONNECTED")throw new $n(tn.INVALID_OPERATION,"Stop proxy server after leave channel");Vr.setProxyServer(),Ut.setProxyServer(),this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled",Ut.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode),this._proxyServer=void 0,this._turnServer={mode:"auto",servers:[]}}setLocalAccessPointsV2(_e){if(!_e.accessPoints)throw new $n(tn.INVALID_PARAMS,"accessPoints is required.");pE(_e.accessPoints.serverList,"accessPoints.serverList"),Hl(_e.accessPoints.domain,"accessPoints.domain");const rt=(Mt,Dt)=>{us(Mt,Dt,0,65535,!0)};let it=443;if(_e.accessPoints.port&&(rt(_e.accessPoints.port,"accessPoints.port"),it=_e.accessPoints.port),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new $n(tn.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");rn("CLOSE_AFB_FOR_LOCAL_AP")&&(ns("JOIN_WITH_FALLBACK_SIGNAL_PROXY",!1),ns("JOIN_WITH_FALLBACK_MEDIA_PROXY",!1));const ct=/^((\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.){3}(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/,ut=_e.accessPoints.domain,pt=_e.accessPoints.serverList.map(Mt=>ct.test(Mt)?"".concat(Mt.replace(/\./g,"-"),".").concat(ut):Mt),mt=pt.map(Mt=>"".concat(Mt,":").concat(it));this._useLocalAccessPoint=!0,this._setLocalAPVersion=2,ns("WEBCS_DOMAIN",mt),ns("WEBCS_DOMAIN_BACKUP_LIST",mt),ns("GATEWAY_DOMAINS",[ut]),_e.report&&_e.report.hostname&&Array.isArray(_e.report.hostname)&&_e.report.hostname.length?(pE(_e.report.hostname,"report.hostname"),ns("EVENT_REPORT_DOMAIN",_e.report.hostname[0]),ns("EVENT_REPORT_BACKUP_DOMAIN",_e.report.hostname[1]||_e.report.hostname[0])):(ns("EVENT_REPORT_DOMAIN",pt[0]),ns("EVENT_REPORT_BACKUP_DOMAIN",pt[1]||pt[0]));let _t=6443;_e.report&&_e.report.port&&(rt(_e.report.port,"report.port"),_t=_e.report.port),ns("STATS_COLLECTOR_PORT",_t),_e.report?ns("ENABLE_EVENT_REPORT",!0):ns("ENABLE_EVENT_REPORT",!1);let vt="";_e.log&&_e.log.hostname&&Array.isArray(_e.log.hostname)&&_e.log.hostname.length?(pE(_e.log.hostname,"log.hostname"),vt=_e.log.hostname[0]):vt=pt[0];let Tt=6444;_e.log&&_e.log.port&&(rt(_e.log.port,"log.port"),Tt=_e.log.port),ns("LOG_UPLOAD_SERVER","".concat(vt,":").concat(Tt));let bt=[];_e.cds&&_e.cds.hostname&&Array.isArray(_e.cds.hostname)&&_e.cds.hostname.length?(pE(_e.cds.hostname,"cds.hostname"),bt=_e.cds.hostname):bt=pt;let Ot=443;_e.cds&&_e.cds.port&&(rt(_e.cds.port,"cds.port"),Ot=_e.cds.port),ns("CDS_AP",bt.map(Mt=>"".concat(Mt,":").concat(Ot))),_e.cds?ns("ENABLE_CONFIG_DISTRIBUTE",!0):ns("ENABLE_CONFIG_DISTRIBUTE",!1),Ut.info("set local access point v2 success")}setLocalAccessPoints(_e,rt){if(pE(_e,"serverList"),Hl(rt,"domain"),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new $n(tn.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");const it=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;_e=_e.map(ct=>it.test(ct)?"".concat(ct.replace(/\./g,"-"),".").concat(rt):ct),this._useLocalAccessPoint=!0,this._setLocalAPVersion=1,ns("WEBCS_DOMAIN",_e),ns("WEBCS_DOMAIN_BACKUP_LIST",_e),ns("GATEWAY_DOMAINS",[rt]),ns("EVENT_REPORT_DOMAIN",_e[0]),ns("EVENT_REPORT_BACKUP_DOMAIN",_e[1]||_e[0]),ns("LOG_UPLOAD_SERVER","".concat(_e[0],":6444")),Ut.info("[".concat(this._clientId,"] set local access point success"))}async setRemoteDefaultVideoStreamType(_e){if(Cl(_e,"streamType",[0,1,4,5,6,7,8,9]),this._remoteDefaultVideoStreamType=_e,this._joinInfo)try{await this._gateway.setDefaultRemoteVideoStreamType(_e),this._joinInfo.defaultVideoStream=this._remoteDefaultVideoStreamType}catch(rt){throw Ut.error("[".concat(this._clientId,"] set default remote video stream type error"),rt.toString()),rt}else Ut.debug("[".concat(this._clientId,"] haven't joined yet, cache remoteDefaultVideoStreamType ").concat(_e))}async setRemoteVideoStreamType(_e,rt){Cl(rt,"streamType",[0,1,4,5,6,7,8,9]);try{await this._gateway.setRemoteVideoStreamType(_e,rt),setTimeout(()=>{const it=this._users.find(ct=>ct.uid===_e);it&&it.videoTrack&&it.videoTrack.updateMediaStreamTrackResolution()},2e3)}catch(it){throw Ut.error("[".concat(this._clientId,"] set remote video stream type error"),it.toString()),it}Ut.info("[".concat(this._clientId,"] set remote ").concat(_e," video stream type to ").concat(rt)),this._remoteStreamTypeCacheMap.set(_e,rt)}async setStreamFallbackOption(_e,rt){Cl(rt,"fallbackType",[0,1,2,3,4,5,6,7,8]);try{await this._gateway.setStreamFallbackOption(_e,rt)}catch(it){throw Ut.error("[".concat(this._clientId,"] set stream fallback option"),it.toString()),it}Ut.info("[".concat(this._clientId,"] set remote ").concat(_e," stream fallback type to ").concat(rt)),this._streamFallbackTypeCacheMap.set(_e,rt)}setEncryptionConfig(_e,rt,it,ct){(function(pt){Cl(pt,"encryptionMode",["aes-128-xts","aes-256-xts","aes-128-ecb","sm4-128-ecb","aes-128-gcm","aes-256-gcm","aes-128-gcm2","aes-256-gcm2","none"])})(_e),Hl(rt,"secret");const ut=["aes-128-gcm2","aes-256-gcm2"];if(Er(ut).call(ut,_e)){if(!it||!(it instanceof Uint8Array&&it.length===32))throw new $n(tn.INVALID_PARAMS,"salt must be an Uint8Array and exactly equal to 32 bytes")}else if(it)throw new $n(tn.INVALID_PARAMS,"current encrypt mode does not need salt");if(ct){if(t_(ct,"encryptDataStream"),!Er(ut).call(ut,_e))throw new $n(tn.INVALID_PARAMS,"current encrypt mode does not support data stream");this._encryptDataStream=!0}new RegExp(`^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*,.<>?/:;'"|{}\\[\\]])(?=.{8,})`).test(rt)||Ut.warning(`The secret is not strong:
      The secret must contain at least 1 lowercase alphabetical character,
      The secret must contain at least 1 uppercase alphabetical character,
      The secret must contain at least 1 numeric character,
      The secret must contain at least one special character,
      The secret must be eight characters or longer.
      `),this._encryptionMode=_e,this._encryptionSecret=rt,it&&(this._encryptionSalt=nv(it))}async renewToken(_e){if(Hl(_e,"token",1,2047),!this._key||!this._joinInfo)throw new $n(tn.INVALID_OPERATION,"renewToken should not be called before user join");const rt=this._key;this._key=_e,this._joinInfo&&(this._joinInfo.token=_e);const it=await this._renewTokenMutex.lock();try{if(rn("USE_NEW_TOKEN")){Ut.debug("[".concat(this._clientId,"] start renew token with ticket from unilbs"));const ct=await YX(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||xa);Ut.debug("[".concat(this._clientId,"] get ticket from unilbs success")),await this._gateway.renewToken({token:_e,ticket:ct})}else Ut.debug("[".concat(this._clientId,"] start renew token without ticket")),await this._gateway.renewToken({token:_e});Ut.debug("[".concat(this._clientId,"] renewToken success"))}catch(ct){throw this._key=rt,this._joinInfo.token=rt,Ut.error("[".concat(this._clientId,"] renewToken failed"),ct.toString()),ct}finally{it()}}enableAudioVolumeIndicator(){this._audioVolumeIndicationInterval?Ut.warning("you have already enabled audio volume indicator!"):this._audioVolumeIndicationInterval=window.setInterval(()=>{const _e=this._p2pChannel.getAudioLevels();this.safeEmit(wo.VOLUME_INDICATOR,_e)},rn("AUDIO_VOLUME_INDICATION_INTERVAL")||2e3)}getRTCStats(){const _e=this._statsCollector.getRTCStats(),rt=this._gateway.getInChannelInfo();return _e.Duration=Math.round(rt.duration/1e3),_e}async startLiveStreaming(_e,rt){if(!rt){if(this.codec!=="h264")throw new $n(tn.LIVE_STREAMING_INVALID_RAW_STREAM,"raw streaming is only support h264");if(!this._p2pChannel.hasLocalMedia())throw new $n(tn.LIVE_STREAMING_INVALID_RAW_STREAM,"can not find stream to raw streaming")}if(this._liveRawStreamingClient&&this._liveRawStreamingClient.hasUrl(_e)||this._liveTranscodeStreamingClient&&this._liveTranscodeStreamingClient.hasUrl(_e))throw new $n(tn.LIVE_STREAMING_TASK_CONFLICT);const it=rt?k_.TRANSCODE:k_.RAW;return this._createLiveStreamingClient(it).startLiveStreamingTask(_e,it)}setLiveTranscoding(_e){return this._createLiveStreamingClient(k_.TRANSCODE).setTranscodingConfig(_e)}async stopLiveStreaming(_e){const rt=[this._liveRawStreamingClient,this._liveTranscodeStreamingClient].filter(it=>it&&it.hasUrl(_e));if(!rt.length)throw new $n(tn.INVALID_PARAMS,"can not find live streaming url to stop");await Ir.all(rt.map(it=>it&&it.stopLiveStreamingTask(_e)))}async startChannelMediaRelay(_e){_4(_e),await this._createChannelMediaRelayClient().startChannelMediaRelay(_e)}async updateChannelMediaRelay(_e){_4(_e),await this._createChannelMediaRelayClient().updateChannelMediaRelay(_e)}async stopChannelMediaRelay(){await this._createChannelMediaRelayClient().stopChannelMediaRelay(),this._statsCollector.onStatsChanged&&(this._statsCollector.onStatsChanged=void 0)}sendAudioMetadata(_e){this._p2pChannel instanceof LA&&this._p2pChannel.addAudioMetadata(_e)}async sendStreamMessage(_e){var rt;let it=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!this._joinInfo)throw new $n(tn.INVALID_OPERATION,"can not send data stream, not joined");if((typeof _e=="string"||_e instanceof Uint8Array)&&(_e={payload:_e}),typeof _e.payload=="string"){const ut=new TextEncoder;_e.payload=ut.encode(_e.payload)}let ct=!1;if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&Er(rt=["aes-128-gcm2","aes-256-gcm2"]).call(rt,this._encryptionMode)&&(ct=!0,_e.payload=await async function(ut,pt,mt){var _t;const vt=_p(_t=Array.from(mt)).call(_t,($t,Ht)=>$t+Ht,0),Tt={serverTs:0,seq:mY++,length:mt.length,checkSum:vt},bt=new Uint8Array(B3(vt,2)),Ot=new ArrayBuffer(ES),Mt=new DataView(Ot);Mt.setUint32(0,Tt.serverTs),Mt.setUint16(4,Tt.seq),Mt.setUint16(6,Tt.length),Mt.setUint16(8,Tt.checkSum);const Dt=16-mt.length%16;mt=N3(mt,new Uint8Array(Dt));const jt=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:ut,tagLength:J3,additionalData:bt},pt,mt);return N3(new Uint8Array(Ot),new Uint8Array(jt))}(this._encryptDataStreamIv,this._encryptDataStreamKey,_e.payload)),new Blob([_e.payload]).size>1024)throw new $n(tn.INVALID_PARAMS,ct?"encrypted stream message out of range.":"stream message out of range.");return this._gateway.signal.request(_i.DATA_STREAM,{payload:nv(_e.payload),syncWithAudio:_e.syncWithAudio,sendTs:Date.now()-nq},!it)}sendMetadata(_e){if(!this._joinInfo)throw new $n(tn.INVALID_OPERATION,"can not send metadata, not joined");if(new Blob([_e]).size>1024)throw new $n(tn.METADATA_OUT_OF_RANGE);return this._gateway.signal.request(_i.SEND_METADATA,{session_id:this._joinInfo.sid,metadata:nv(_e)})}async sendCustomReportMessage(_e){if(Array.isArray(_e)||(_e=[_e]),_e.forEach(CY),!this._joinInfo)throw new $n(tn.INVALID_OPERATION,"can not send custom report, not joined");await Vr.sendCustomReportMessage(this._joinInfo.sid,_e)}getLocalAudioStats(){return this._statsCollector.getLocalAudioTrackStats()}getRemoteAudioStats(){return this._statsCollector.getRemoteAudioTrackStats()}getLocalVideoStats(){return this._statsCollector.getLocalVideoTrackStats()}getRemoteVideoStats(){return this._statsCollector.getRemoteVideoTrackStats()}getRemoteNetworkQuality(){const _e=this._statsCollector.getRemoteNetworkQualityStats();if(rn("DELETE_NEQ_AFTER_USER_LEAVE")){const rt=this._users.map(it=>it.uid+"");Object.keys(_e).forEach(it=>{Er(rt).call(rt,it)||delete _e[it]})}return _e}async pickSVCLayer(_e,rt){Cl(rt.spatialLayer,"spatialLayer",[0,1,2,3]),Cl(rt.temporalLayer,"temporalLayer",[0,1,2,3]);try{await this._gateway.pickSVCLayer(_e,rt)}catch(it){throw Ut.error("[".concat(this._clientId,"] pick SVC layer failed"),it.toString()),it}}async setRTMConfig(_e){const{apRTM:rt=!1,rtmFlag:it}=_e;if(t_(rt,"apRTM"),us(it,"rtmFlag",0),this._rtmConfig.apRTM=rt,this._rtmConfig.rtmFlag=it,Ut.debug("[".concat(this._clientId,"] setRTMconfig ").concat(JSON.stringify(_e)," in ").concat(this.connectionState," state")),(this.connectionState==="CONNECTED"||this.connectionState==="RECONNECTING")&&this._joinInfo)return this._joinInfo.apRTM=rt,this._joinInfo.rtmFlag=it,this._gateway.setRTM2Flag(it)}_reset(){if(Ut.debug("[".concat(this._clientId,"] reset client")),function(_e){const rt=OS.indexOf(_e);rt!==-1&&OS.splice(rt,1)}(this._clientId),this.store.hasStartJoinChannel=!1,this.store.isABTestSuccess=!1,this.store.autoSubscribe=!1,this._axiosCancelSource.cancel(),this._axiosCancelSource=Xu.CancelToken.source(),this._streamFallbackTypeCacheMap=new Map,this._remoteStreamTypeCacheMap=new Map,this._configDistribute.stopGetConfigDistribute(),this._joinInfo&&H4(this._joinInfo),this._joinInfo=void 0,this._proxyServer=void 0,this._defaultStreamFallbackType=void 0,this._sessionId&&Vr.removeSid(this._sessionId),this._sessionId=null,this.store.sessionId=null,this.store.resetFirstVideoFrameDecoded(),this._statsCollector.reset(),this._key=void 0,this._appId=void 0,this._uid=void 0,this.store.uid=void 0,this._channelName=void 0,this._encryptionMode="none",this._encryptionSecret=null,this._encryptionSalt=null,this._encryptDataStreamKey=null,this._encryptDataStreamIv=null,this._pendingPublishedUsers=[],this._users.forEach(_e=>{_e._audioTrack&&_e._audioTrack._destroy(),_e._videoTrack&&_e._videoTrack._destroy(),_e._dataChannels&&(_e._dataChannels.forEach(rt=>rt._close()),_e._dataChannels.length=0)}),this._users=[],this._audioVolumeIndicationInterval&&(window.clearInterval(this._audioVolumeIndicationInterval),this._audioVolumeIndicationInterval=void 0),this._cloudProxyServerMode==="fallback"&&(this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled"),this._p2pChannel.reset(),this._publishMutex=new lu("client-publish",this._clientId),this._subscribeMutex=new lu("client-subscribe",this._clientId),this._networkQualityInterval&&(window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=void 0),this._liveRawStreamingClient&&(this._liveRawStreamingClient.terminate(),this._liveRawStreamingClient.removeAllListeners(),this._liveRawStreamingClient=void 0),this._liveTranscodeStreamingClient&&(this._liveTranscodeStreamingClient.terminate(),this._liveTranscodeStreamingClient.removeAllListeners(),this._liveTranscodeStreamingClient=void 0),this._channelMediaRelayClient&&(this._channelMediaRelayClient.dispose(),this._channelMediaRelayClient=void 0),this._inspect)try{this._inspect.close(),this._inspect=void 0}catch{}if(this._moderation)try{this.setImageModeration(!1)}catch{}}_startSession(_e,rt){var it;const ct=_e||_0();_e?Ut.debug("[".concat(this._clientId,"] new Session ").concat(ct)):Ut.debug("[".concat(this._clientId,"] renewSession ").concat(this._sessionId," => ").concat(ct));const ut=_e?"":this._sessionId||"";this._sessionId=ct,this.store.sessionId=ct,Vr.addSid(ct);const pt={lts:new Date().getTime(),mode:this.mode,buildFormat:1,stringUid:(rt==null?void 0:rt.stringUid)||((it=this._joinInfo)===null||it===void 0?void 0:it.stringUid),channelProfile:this.mode==="live"?1:0,channelMode:0,isABTestSuccess:Number(this._configDistribute.isSuccess),lsid:ut,clientRole:this.role==="audience"?2:1};Vr.sessionInit(this._sessionId,Om({cname:rt.channel,appid:rt.appId},pt)),this._joinInfo&&(this._joinInfo.sid=ct),this._gateway.joinInfo&&(this._gateway.joinInfo.sid=ct)}async _publishHighStream(_e){if(!this._joinInfo||this._uid===void 0)throw new $n(tn.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new $n(tn.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&rn("FORCE_TURN")&&!rn("TURN_ENABLE_TCP")&&!rn("TURN_ENABLE_UDP"))throw new $n(tn.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");Ut.debug("[".concat(this._clientId,"] publish high stream"));try{const it=await this._p2pChannel.publish(_e,this._isDualStreamEnabled,this._lowStreamParameter);if(this.store.useP2P){const ct=(await it.next()).value;if(ct){try{await this._gateway.sendExtensionMessage(qs.PUBLISH,ct,!0)}catch(ut){throw it.throw(ut),ut}await it.next()}this._p2pChannel.reportPublishEvent(!0,null)}else{const ct=(await it.next()).value;if(ct){var rt;let ut;try{ut=await this._gateway.publish(this._uid,ct,!0)}catch(pt){if(pt.code!==tn.DISCONNECT_P2P)throw it.throw(pt),pt}await it.next(((rt=ut)===null||rt===void 0?void 0:rt.ortc)||[])}this._p2pChannel.reportPublishEvent(!0,null);for(const ut of _e)ut instanceof Cs&&ut._encoderConfig&&this._gateway.setVideoProfile(ut._encoderConfig).catch(pt=>{Ut.debug("[".concat(this._clientId,"] stop setVideoProfile, because websocket is closed"))}),!ut.muted&&ut.enabled||await this._p2pChannel.muteLocalTrack(ut)}}catch(it){if(this._p2pChannel.reportPublishEvent(!1,it==null?void 0:it.code,_e),(it==null?void 0:it.code)===tn.WS_ABORT)return;throw it}}async _publishLowStream(){if(!this._joinInfo||this._uid===void 0)throw new $n(tn.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new $n(tn.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));Ut.debug("[".concat(this._clientId,"] publish low stream"));const _e=this._configDistribute.getLowStreamConfigDistribute();_e&&_e.bitrate&&(this._lowStreamParameter||(this._lowStreamParameter={width:160,height:120,framerate:15,bitrate:50}),this._lowStreamParameter&&this._lowStreamParameter.bitrate&&_e.bitrate<this._lowStreamParameter.bitrate&&(this._lowStreamParameter.bitrate=_e.bitrate));try{const it=await this._p2pChannel.publishLowStream(this._lowStreamParameter),ct=(await it.next()).value;if(ct){var rt;let ut;try{ut=await this._gateway.publish(this._uid,ct,!0)}catch(pt){if(pt.code!==tn.DISCONNECT_P2P)throw it.throw(pt),pt}it.next(((rt=ut)===null||rt===void 0?void 0:rt.ortc)||[]),this._p2pChannel.reportPublishEvent(!0,null,void 0,!0)}}catch(it){if(this._p2pChannel.reportPublishEvent(!1,it==null?void 0:it.code,void 0,!0),(it==null?void 0:it.code)===tn.WS_ABORT)return;throw it}}_createLiveStreamingClient(_e){const rt=()=>{if(!this._joinInfo||!this._appId)return new $n(tn.INVALID_OPERATION,"can not create live streaming client, please join channel first").throw();const it=(ct={joinInfo:this._joinInfo,appId:this._appId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig},gE("LiveStreaming").create(ct));var ct;return it.onLiveStreamError=(ut,pt)=>{Vr.reportApiInvoke(this._sessionId,{name:Ks.ON_LIVE_STREAM_ERROR,options:[ut,pt],tag:Ns.TRACER}).onSuccess(),this.safeEmit(wo.LIVE_STREAMING_ERROR,ut,pt)},it.onLiveStreamWarning=(ut,pt)=>{Vr.reportApiInvoke(this._sessionId,{name:Ks.ON_LIVE_STREAM_WARNING,options:[ut,pt],tag:Ns.TRACER}).onSuccess(),this.safeEmit(wo.LIVE_STREAMING_WARNING,ut,pt)},it.on(mM.REQUEST_WORKER_MANAGER_LIST,(ut,pt,mt)=>{if(!this._joinInfo)return mt(new $n(tn.INVALID_OPERATION,"can not find join info to get worker manager"));(async function(_t,vt,Tt,bt){const Ot=rn("UAP_AP").slice(0,rn("AJAX_REQUEST_CONCURRENT")).map(Mt=>vt.proxyServer?"https://".concat(vt.proxyServer,"/ap/?url=").concat(Mt+"/api/v1?action=uap"):"https://".concat(Mt,"/api/v1?action=uap"));return await GX(Ot,_t,vt,Tt,bt)})(ut,this._joinInfo,this._axiosCancelSource.token,xa).then(pt).catch(mt)}),it};return _e===k_.RAW?(this._liveRawStreamingClient=this._liveRawStreamingClient||rt(),this._liveRawStreamingClient):(this._liveTranscodeStreamingClient=this._liveTranscodeStreamingClient||rt(),this._liveTranscodeStreamingClient)}_createChannelMediaRelayClient(){if(!this._joinInfo)return new $n(tn.INVALID_OPERATION,"can not create channel media relay client, please join channel first").throw();if(!this._channelMediaRelayClient){const{sendResolutionWidth:rt,sendResolutionHeight:it}=this.getLocalVideoStats(),ct=(_e={joinInfo:this._joinInfo,clientId:this._clientId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig,resolution:{width:rt,height:it}},gE("ChannelMediaRelay").create(_e));ct.on("state",ut=>{ut===ap.RELAY_STATE_FAILURE&&ct&&ct.dispose(),this.safeEmit(wo.CHANNEL_MEDIA_RELAY_STATE,ut)}),ct.on("event",ut=>{this.safeEmit(wo.CHANNEL_MEDIA_RELAY_EVENT,ut)}),this._channelMediaRelayClient=ct,this._statsCollector.onStatsChanged=(ut,pt)=>{var mt;ut==="resolution"&&((mt=this._channelMediaRelayClient)===null||mt===void 0||mt.setVideoProfile(pt))}}var _e;return this._channelMediaRelayClient}_handleUpdateDataChannel(_e,rt){const{added:it,deleted:ct}=_e,ut=[];if(rt){const pt=[];this._users.forEach(mt=>{mt._dataChannels.forEach(_t=>{it.every(vt=>vt.uid!==mt._uintid||vt.stream_id!==_t.id)&&pt.push({uid:mt._uintid,stream_id:_t.id,ordered:_t.ordered,max_retrans_times:_t.maxRetransmits,metadata:_t.metadata})})}),pt.length>0&&this._handleUpdateDataChannel({added:[],deleted:pt})}Array.isArray(it)&&it.length>0&&it.forEach(pt=>{const{uid:mt,stream_id:_t,ordered:vt,max_retrans_times:Tt,metadata:bt}=pt,Ot=this._users.find(Mt=>Mt._uintid===mt);if(!Ot)return void Ut.error("[".concat(this._clientId,"] can not find target user!(on_add_data_channel)"));if(Ut.debug("[".concat(this._clientId,"] data_channel added with uid ").concat(mt)),Er(ut).call(ut,Ot)||ut.push(Ot),Ot._uintid||(Ot._uintid=mt),Ot._dataChannels.findIndex(Mt=>Mt.id===pt.stream_id)===-1){const Mt={id:_t,ordered:!!vt,maxRetransmits:Tt,metadata:bt},Dt=function(jt){return t4(jt,!0)}(Mt);Ot._dataChannels.push(Dt),Ut.info("[".concat(this._clientId,"] remote user ").concat(Ot.uid," published datachannel")),rt||this.safeEmit(wo.USER_PUBLISHED,Ot,"datachannel",Mt)}this._p2pChannel.hasPendingRemoteDataChannel(Ot,pt.stream_id)&&(Ut.debug("[".concat(this._clientId,"] resubscribe datachannel for user ").concat(Ot.uid," after reconnect.")),this._subscribeDataChannel(Ot,pt.stream_id).catch(Mt=>{Ut.error("[".concat(this._clientId,"] resubscribe datachannel error"),Mt.toString())}))}),rt&&(this.safeEmit(wo.PUBLISHED_USER_LIST,this._pendingPublishedUsers),this._pendingPublishedUsers=[]),Array.isArray(ct)&&ct.length>0&&ct.forEach(pt=>{const{uid:mt,stream_id:_t}=pt,vt=this._users.find(bt=>bt._uintid===mt);if(!vt)return void Ut.error("[".concat(this._clientId,"] can not find target user!(on_delete_data_channel)"));const Tt=vt._dataChannels.find(bt=>bt.id===pt.stream_id);Tt&&(Ut.debug("[".concat(this._clientId,"] data_stream delete with uid ").concat(mt)),this._p2pChannel.unsubscribeDataChannel(vt,[Tt]).then(bt=>{if(vt._dataChannels=vt._dataChannels.filter(Ot=>Ot!==Tt),bt)return this._gateway.unsubscribeDataChannel(bt,vt.uid)}),Ut.info("[".concat(this._clientId,"] remote user ").concat(mt," unpublished datachannel ,id:").concat(Tt.id)),this.safeEmit(wo.USER_UNPUBLISHED,vt,"datachannel",Tt._config))})}_getEncodingName(_e){var rt;if(!this._joinResponse)return;const it=(rt=this._joinResponse.ortc.rtpCapabilities.sendrecv)===null||rt===void 0?void 0:rt.videoCodecs;if(it)for(const ut of it){var ct;if(ut.payloadType===_e)return ut==null||(ct=ut.rtpMap)===null||ct===void 0?void 0:ct.encodingName}}_handleRemoveDataChannels(_e){const rt=this._users.find(it=>it.uid===_e.uid);if(rt){if(rt._dataChannels!==void 0&&rt._dataChannels.length>0){Ut.debug("[".concat(this._clientId,"] datachannel removed with uid ").concat(_e.uid));const it=()=>{Ut.info("[".concat(this._clientId,"] remote user ").concat(rt.uid," unpublished datachannel")),rt._dataChannels.forEach(ct=>{this.safeEmit(wo.USER_UNPUBLISHED,rt,"datachannel",ct._config)})};this._p2pChannel.unsubscribeDataChannel(rt,rt._dataChannels).then(ct=>{if(ct)return this._gateway.unsubscribeDataChannel(ct,rt.uid)}),it()}}else Ut.warning("[".concat(this._clientId,"] can not find target user!(on_remove_datachannel)"))}_handleGatewayEvents(){this._gateway.on(Ul.UPDATE_GATEWAY_CONFIG,()=>{(function(){let _e;try{_e=window.localStorage.getItem("websdk_ng_global_parameter")}catch(rt){return void Ut.error("Error loading sdk config",rt.message)}if(_e)try{const rt=JSON.parse(window.atob(_e)),it=Date.now();Object.keys(rt).forEach(ct=>{const{value:ut,type:pt,expires:mt}=rt[ct];mt&&mt<=it||pt||cM()||!Object.prototype.hasOwnProperty.call(Ew,ct)||(r_[ct]=ut,xs[ct]=ut,Ut.debug("Update gateway parameters from config distribute",ct,ut))})}catch(rt){Ut.error("Error update config from local cache",rt.message)}})()}),this._gateway.on(Ul.DISCONNECT_P2P,async()=>{await this._p2pChannel.disconnectForReconnect()}),this._gateway.on(Ul.CONNECTION_STATE_CHANGE,(_e,rt,it)=>{var ct;if(it===Xo.FALLBACK)return;const ut=()=>{this.safeEmit(wo.CONNECTION_STATE_CHANGE,_e,rt,it)};if(Vr.reportApiInvoke(this._sessionId||((ct=this._gateway.joinInfo)===null||ct===void 0?void 0:ct.sid)||null,{name:Ks.CONNECTION_STATE_CHANGE,options:[_e,rt,it],tag:Ns.TRACER}).onSuccess(JSON.stringify({cur:_e,prev:rt,reason:it})),Ut.info("[".concat(this._clientId,"] signal connection state change: ").concat(rt," -> ").concat(_e)),_e==="DISCONNECTED")return this._reset(),void ut();if(_e==="RECONNECTING")this._users.forEach(mt=>{mt._trust_in_room_=!1,mt._trust_audio_enabled_state_=!1,mt._trust_video_enabled_state_=!1,mt._trust_audio_mute_state_=!1,mt._trust_video_mute_state_=!1,mt._trust_audio_stream_added_state_=!1,mt._trust_video_stream_added_state_=!1,mt._is_pre_created||(mt._audio_pre_subscribed||(mt._audioSSRC=void 0,mt._audioOrtc=void 0),mt._video_pre_subscribed||(mt._videoSSRC=void 0,mt._videoOrtc=void 0,mt._rtxSsrcId=void 0),mt._cname=void 0)}),this._userOfflineTimeout&&window.clearTimeout(this._userOfflineTimeout),this._streamRemovedTimeout&&window.clearTimeout(this._streamRemovedTimeout),this._userOfflineTimeout=void 0,this._streamRemovedTimeout=void 0;else if(_e==="CONNECTED"){var pt;this._streamFallbackTypeCacheMap.forEach((mt,_t)=>{this._gateway.setStreamFallbackOption(_t,mt).catch(vt=>{Ut.warning("[".concat(this._clientId,"] auto set stream fallback option failed"),vt)})}),this._remoteStreamTypeCacheMap.forEach((mt,_t)=>{this._gateway.setRemoteVideoStreamType(_t,mt).catch(vt=>{Ut.warning("[".concat(this._clientId,"] auto set remote stream type failed"),vt)})}),this._remoteDefaultVideoStreamType!==void 0&&((pt=this._joinInfo)===null||pt===void 0?void 0:pt.defaultVideoStream)===void 0&&this.setRemoteDefaultVideoStreamType(this._remoteDefaultVideoStreamType).then(()=>{Ut.debug("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway connected"))}).catch(mt=>{Ut.error("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway failed, ").concat(mt))}),this.store.useP2P||(this._p2pChannel.republish(),this._userOfflineTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._userOfflineTimeout=void 0,this._users.filter(mt=>!mt._trust_in_room_).forEach(mt=>{Ut.debug("[".concat(this._clientId,"] user offline timeout, emit user offline ").concat(mt.uid)),this._handleUserOffline({uid:mt.uid})}))},3e3),this._streamRemovedTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._streamRemovedTimeout=void 0,this._users.forEach(mt=>{mt._trust_audio_mute_state_||(Ut.debug("[".concat(this._clientId,"] auto dispatch audio unmute event ").concat(mt.uid)),this._handleMuteStream(mt.uid,Pr.AUDIO,!1)),mt._trust_video_mute_state_||(Ut.debug("[".concat(this._clientId,"] auto dispatch video unmute event ").concat(mt.uid)),this._handleMuteStream(mt.uid,Pr.VIDEO,!1)),mt._trust_audio_enabled_state_||(Ut.debug("[".concat(this._clientId,"] auto dispatch enable local audio ").concat(mt.uid)),this._handleSetStreamLocalEnable("audio",mt.uid,!0)),mt._trust_video_enabled_state_||(Ut.debug("[".concat(this._clientId,"] auto dispatch enable local video ").concat(mt.uid)),this._handleSetStreamLocalEnable("video",mt.uid,!0)),mt._trust_video_stream_added_state_||(Ut.debug("[".concat(this._clientId,"] auto dispatch reset video stream added ").concat(mt.uid)),this._handleResetAddStream(mt,"video")),mt._trust_audio_stream_added_state_||(Ut.debug("[".concat(this._clientId,"] auto dispatch reset audio stream added ").concat(mt.uid)),this._handleResetAddStream(mt,"audio")),mt._video_added_||mt._audio_added_||(Ut.debug("[".concat(this._clientId,"] auto dispatch stream remove ").concat(mt.uid)),this._handleRemoveStream({uid:mt.uid,uint_id:mt._uintid}))}))},1e3))}ut()}),this._gateway.on(Ul.REQUEST_NEW_GATEWAY_LIST,async(_e,rt)=>{if(!this._joinInfo)return rt(new $n(tn.UNEXPECTED_ERROR,"can not recover, no join info"));try{let it;const ct=await G4(Om(Om({},this._joinInfo),{},{uid:this._joinInfo.uid,stringUid:void 0}));ct?(it=ct.ap,j4(ct),this._joinInfo.preload=!0):(it=await MM(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||xa,this.store),this._joinInfo.preload=!1),this._joinInfo&&(this._joinInfo.apResponse=it.gatewayInfo.res,this._joinInfo.gatewayAddrs=it.gatewayInfo.gatewayAddrs,this._joinInfo.uni_lbs_ip=it.gatewayInfo.uni_lbs_ip);const ut=[];it.gatewayInfo.gatewayAddrs.forEach(pt=>{let{address:mt}=pt;const[_t,vt]=mt.split(":");this._joinInfo&&this._joinInfo.proxyServer?ut.push({proxy:this._joinInfo.proxyServer,host:_t,port:vt}):ut.push({host:_t,port:vt})}),_e(ut)}catch(it){rt(it)}}),this._gateway.on(Ul.NETWORK_QUALITY,_e=>{this._networkQualitySensitivity==="normal"&&this.safeEmit(wo.NETWORK_QUALITY,_e)}),this._gateway.on(Ul.STREAM_TYPE_CHANGE,(_e,rt)=>{this.safeEmit(wo.STREAM_TYPE_CHANGED,_e,rt),Vr.reportApiInvoke(this._sessionId,{name:Ks.STREAM_TYPE_CHANGE,options:[_e,rt],tag:Ns.TRACER}).onSuccess(JSON.stringify({uid:_e,streamType:rt}))}),this._gateway.isPreSub=()=>"isPreSub"in this._p2pChannel&&this._p2pChannel.isPreSub(),this._gateway.isPreallocation=()=>"isPreallocation"in this._p2pChannel&&this._p2pChannel.isPreallocation(),this._gateway.on(Ul.IS_P2P_DISCONNECTED,_e=>{this._p2pChannel.isP2PDisconnected()?_e(!0):this._p2pChannel.hasLocalMedia()||this._p2pChannel.hasRemoteMedia()?_e(!1):_e(!0)}),this._gateway.on(Ul.REQUEST_P2P_CONNECTION_PARAMS,async(_e,rt,it)=>{try{let ct=await this._p2pChannel.getEstablishParams();ct&&"isPreallocation"in this._p2pChannel&&this._p2pChannel.isPreallocation()||(ct=await this._p2pChannel.startP2PConnection(_e)),rt(ct)}catch(ct){it(ct)}}),this._gateway.on(Ul.JOIN_RESPONSE,(_e,rt)=>{if(this.store.useP2P)return;let it;this._joinResponse=_e,_e.attributes?it=_e.attributes.userAttributes.preSubSsrcs:Ut.debug("no attributes in joinResponse");const ct=HV(_e.ortc,rt,it);this._p2pChannel.connect(ct)}),this._gateway.on(Ul.PRE_CONNECT_PC,async _e=>{const{candidates:rt,fingerprint:it,turnServer:ct}=_e;if(this._joinInfo&&rt.length>0&&!this._p2pChannel.isPlanB){const{cert:pt,cid:mt}=this._joinInfo.apResponse,_t="".concat(mt,"_").concat(pt);if(_t.length<4||_t.length>256)return;await this._p2pChannel.startP2PConnection({turnServer:ct,cloudProxyServer:this._joinInfo.cloudProxyServer,isPreallocation:!0});try{var ut;await this._p2pChannel.connect({iceParameters:{iceUfrag:"".concat(mt,"_").concat(pt),icePwd:"".concat(mt,"_").concat(pt)},dtlsParameters:{fingerprints:[{hashFunction:"sha-256",fingerprint:(ut=rn("FINGERPRINT"))!==null&&ut!==void 0?ut:it}]},candidates:rt,rtpCapabilities:{send:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},recv:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]}},setup:"active",cname:"o/i14u9pJrxRKAsu",preallocation:!0})}catch(vt){vt.code&&vt.code===tn.EXCHANGE_SDP_FAILED&&await this._p2pChannel.startP2PConnection({turnServer:ct,cloudProxyServer:this._joinInfo.cloudProxyServer},!0)}}})}_handleGatewaySignalEvents(){this._gateway.signal.on(Oo.ON_USER_ONLINE,this._handleUserOnline),this._gateway.signal.on(Oo.ON_USER_OFFLINE,this._handleUserOffline),this._gateway.signal.on(Oo.ON_ADD_AUDIO_STREAM,_e=>this._handleAddAudioOrVideoStream("audio",_e.uid,_e.ssrcId,_e.cname,_e.pt,_e.uint_id,_e.ortc)),this._gateway.signal.on(Oo.ON_ADD_VIDEO_STREAM,_e=>this._handleAddAudioOrVideoStream("video",_e.uid,_e.ssrcId,_e.cname,_e.pt,_e.uint_id,_e.ortc,_e.rtxSsrcId)),this._gateway.signal.on(Oo.ON_REMOTE_DATASTREAM_UPDATE,_e=>{this._handleUpdateDataChannel(_e)}),this._gateway.signal.on(Oo.ON_REMOTE_FULL_DATASTREAM_INFO,_e=>{this._handleUpdateDataChannel({added:_e.datastreams||[],deleted:[]},!0)}),this._gateway.signal.on(Oo.ON_REMOVE_STREAM,this._handleRemoveStream),this._gateway.signal.on(Oo.ON_P2P_LOST,this._handleP2PLost),this._gateway.signal.on(Oo.MUTE_AUDIO,_e=>this._handleMuteStream(_e.uid,Pr.AUDIO,!0)),this._gateway.signal.on(Oo.UNMUTE_AUDIO,_e=>this._handleMuteStream(_e.uid,Pr.AUDIO,!1)),this._gateway.signal.on(Oo.MUTE_VIDEO,_e=>this._handleMuteStream(_e.uid,Pr.VIDEO,!0)),this._gateway.signal.on(Oo.UNMUTE_VIDEO,_e=>this._handleMuteStream(_e.uid,Pr.VIDEO,!1)),this._gateway.signal.on(Oo.RECEIVE_METADATA,_e=>{const rt=g0(_e.metadata);this.safeEmit(wo.RECEIVE_METADATA,_e.uid,rt)}),this._gateway.signal.on(Oo.ON_DATA_STREAM,async _e=>{var rt;if(!_e)return;let it=g0(_e.payload);if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&Er(rt=["aes-128-gcm2","aes-256-gcm2"]).call(rt,this._encryptionMode)){if(_e.payload.length<ES)throw new $n(tn.UNEXPECTED_RESPONSE,"payload length ".concat(_e.payload.length," is less than header length ").concat(ES));it=await async function(pt,mt,_t){const vt=_t.subarray(0,ES),Tt=vt.slice(8,ES),bt=(Tt[0]<<8)+Tt[1],Ot=(vt[6]<<8)+vt[7],Mt=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:pt,tagLength:J3,additionalData:new Uint8Array(B3(bt,2))},mt,_t.subarray(ES));return new Uint8Array(Mt).subarray(0,Ot)}(this._encryptDataStreamIv,this._encryptDataStreamKey,it)}let ct=0;if(_e.ordered||_e.syncWithAudio){const ut=this._p2pChannel.getStats(),pt=this.remoteUsers.find(_t=>_t.uid===_e.uid),mt=ut==null?void 0:ut.audioRecv.find(_t=>_t.ssrc===(pt==null?void 0:pt._audioSSRC));ct=mt==null?void 0:mt.jitterBufferMs}(ct==null||Number.isNaN(ct))&&(ct=0),iq(Om(Om({},_e),{},{payload:it}),ct,{id:this._clientId,onStreamMessage:typeof this.onStreamMessage=="function"?this.onStreamMessage.bind(this):void 0,safeEmit:this.safeEmit.bind(this)})}),this._gateway.signal.on(Oo.ON_CRYPT_ERROR,()=>{tv(()=>{Ut.warning("[".concat(this._clientId,"] on crypt error")),this.safeEmit(wo.CRYPT_ERROR)},this._sessionId)}),this._gateway.signal.on(Oo.ON_TOKEN_PRIVILEGE_WILL_EXPIRE,this._handleTokenWillExpire),this._gateway.signal.on(Oo.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{Ut.warning("[".concat(this._clientId,"] received message onTokenPrivilegeDidExpire, please get new token and join again")),this._gateway.leave(!0,Xo.TOKEN_EXPIRE),this.safeEmit(wo.ON_TOKEN_PRIVILEGE_DID_EXPIRE),this._reset()}),this._gateway.signal.on(Oo.ON_STREAM_FALLBACK_UPDATE,_e=>{Ut.debug("[".concat(this._clientId,"] stream fallback peerId: ").concat(_e.stream_id,", attr: ").concat(_e.stream_type)),this.safeEmit(wo.STREAM_FALLBACK,_e.stream_id,_e.stream_type===1?"fallback":"recover")}),this._gateway.signal.on(Oo.ON_PUBLISH_STREAM,_e=>{this.uid===this._uid&&(this._p2pChannel.reportPublishEvent(!0,null,void 0,!1,JSON.stringify({proxy:_e.proxy})),Ut.info("[".concat(this._clientId,"] on publish stream, ").concat(JSON.stringify(_e))))}),this._gateway.signal.on(Oo.ENABLE_LOCAL_VIDEO,_e=>{this._handleSetStreamLocalEnable("video",_e.uid,!0)}),this._gateway.signal.on(Oo.DISABLE_LOCAL_VIDEO,_e=>{this._handleSetStreamLocalEnable("video",_e.uid,!1)}),this._gateway.signal.on(io.REQUEST_TIMEOUT,(_e,rt)=>{if(this._joinInfo)switch(_e){case _i.PUBLISH:{if(!rt)return;const ut=rt.ortc;if(ut){var it,ct;const pt=ut.some(vt=>{let{stream_type:Tt}=vt;return Tt===es.Audio}),mt=ut.some(vt=>{let{stream_type:Tt}=vt;return Tt!==es.Audio}),_t=ut.some(vt=>{let{stream_type:Tt}=vt;return Tt===es.Screen||Tt===es.ScreenLow});rt.state==="offer"&&Vr.publish(this._joinInfo.sid,{eventElapse:pu.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:!1,ec:tn.TIMEOUT,audio:pt,video:mt,p2pid:rt.p2p_id,publishRequestid:this.store.pubId,screenshare:_t,audioName:pt?(it=ut.find(vt=>{let{stream_type:Tt}=vt;return Tt===es.Audio}))===null||it===void 0||(it=it.ssrcs[0])===null||it===void 0?void 0:it.ssrcId.toString():void 0,videoName:mt?(ct=ut.find(vt=>{let{stream_type:Tt}=vt;return Tt!==es.Audio}))===null||ct===void 0||(ct=ct.ssrcs[0])===null||ct===void 0?void 0:ct.ssrcId.toString():void 0})}break}case _i.SUBSCRIBE:rt&&Vr.subscribe(this._joinInfo.sid,{succ:!1,ec:tn.TIMEOUT,audio:rt.stream_type===Pr.AUDIO,video:rt.stream_type===Pr.VIDEO,peerid:rt.stream_id,subscribeRequestid:rt.ssrcId,p2pid:this.store.p2pId,eventElapse:pu.measureFromSubscribeStart(this.store.clientId,rt.ssrcId),preSsrc:this._p2pChannel.isPreSubScribe(rt.ssrcId)})}}),this._gateway.signal.on(Oo.ON_P2P_OK,_e=>{this.uid,this._uid}),this._gateway.signal.on(Oo.ON_PUBLISHED_USER_LIST,_e=>{if(_e==null||!_e.users)return;rn("BLOCK_LOCAL_CLIENT")&&(_e.users=_e.users.filter(ct=>!b0(ct.string_id||ct.stream_id,this.channelName)));const rt=[],it=[];for(const ct of _e.users){let ut=this._users.find(bt=>bt._uintid===ct.stream_id);ut?ut._trust_in_room_=!0:(ut=new pv(ct.string_id||ct.stream_id,ct.stream_id),this._users.push(ut),this.store.firstVideoFrameDecoded(ut.uid,{userJoinNotify:Date.now()}),this.getListeners(wo.PUBLISHED_USER_LIST).length===0&&(Ut.debug("[".concat(this._clientId,"] user online"),ct.stream_id),this.safeEmit(wo.USER_JOINED,ut)));const pt=Dl.Audio&ct.stream_type,mt=(Dl.Video|Dl.LwoVideo)&ct.stream_type,_t=(65280&ct.stream_type)!=0,vt=pt&&ut.hasAudio,Tt=mt&&ut.hasVideo;mt&&(ut._trust_video_stream_added_state_=!0,ut._video_added_=!0,ut._videoSSRC=ct.video_ssrc,ut._rtxSsrcId=ct.video_rtx),pt&&(ut._trust_audio_stream_added_state_=!0,ut._audio_added_=!0,ut._audioSSRC=ct.audio_ssrc),pt&&!vt&&this.getListeners(wo.PUBLISHED_USER_LIST).length===0&&(Ut.info("[".concat(this._clientId,"] remote user ").concat(ut.uid," published audio")),this.safeEmit(wo.USER_PUBLISHED,ut,"audio")),mt&&!Tt&&this.getListeners(wo.PUBLISHED_USER_LIST).length===0&&(Ut.info("[".concat(this._clientId,"] remote user ").concat(ut.uid," published video")),this.safeEmit(wo.USER_PUBLISHED,ut,"video")),(pt&&!vt||mt&&!Tt||_t)&&rt.push(ut),mt&&this._p2pChannel.hasPendingRemoteMedia(ut,"video")&&it.push({user:ut,mediaType:"video"}),pt&&this._p2pChannel.hasPendingRemoteMedia(ut,"audio")&&it.push({user:ut,mediaType:"audio"})}it.length>0&&(Ut.debug("[".concat(this._clientId,"] RE massSubscribe after reconnect ").concat(it.map(ct=>"user: ".concat(ct.user.uid,", mediaType: ").concat(ct.mediaType)).join("; ")," ")),this.massSubscribe(it).catch(ct=>{Ut.error("[".concat(this._clientId,"] mass resubscribe error"),ct.toString())})),this.getListeners(wo.PUBLISHED_USER_LIST).length>0?rn("ENABLE_DATASTREAM_2")?this._pendingPublishedUsers=rt:(Ut.info("[".concat(this._clientId,"] client emit user-list event, users: ").concat(rt.map(ct=>ct.uid).join(", "))),this.safeEmit(wo.PUBLISHED_USER_LIST,rt)):Ut.info("[".concat(this._clientId,"] client not emit user-list event case there is no user-list listener, users: ").concat(rt.map(ct=>ct.uid).join(", ")))}),this._gateway.signal.on(Oo.ON_RTP_CAPABILITY_CHANGE,_e=>{const{video_codec:rt}=_e;this._p2pChannel instanceof LA&&this._p2pChannel.updateRemoteRTPCapabilities(rt.map(it=>it.toLowerCase()).filter(it=>{var ct;return Er(ct=Object.keys(EA)).call(ct,it)}))})}_handleP2PEvents(){this._gateway.signal.on(Oo.ON_USER_OFFLINE,()=>{this._p2pChannel.disconnectForReconnect()}),this._gateway.signal.on(qs.PUBLISH,(_e,rt,it)=>{const{uid:ct}=_e;_e.forEach(ut=>{const{kind:pt,ssrcs:mt,mid:_t,isMuted:vt}=ut;this._handleP2PAddAudioOrVideoStream(pt,ct,mt[0].ssrcId,_t);const Tt=this._users.find(bt=>bt.uid===ct);return Tt&&this.store.useP2P?this._p2pChannel.mockSubscribe(Tt,pt,mt[0].ssrcId,_t).then(()=>{rt()}).catch(it):rt(),this._handleMuteStream(ct,pt,!!vt)})}),this._gateway.signal.on(qs.CALL,async(_e,rt,it)=>{if(this.store.useP2P)try{var ct;rt(await this._p2pChannel.startP2P({turnServer:(ct=this._joinInfo)===null||ct===void 0?void 0:ct.turnServer},_e))}catch(ut){it(ut)}}),this._gateway.signal.on(io.P2P_CONNECTION,async _e=>{this.store.useP2P&&(await this._p2pChannel).p2pConnect(_e)}),this._gateway.signal.on(qs.UNPUBLISH,async(_e,rt,it)=>{if(this.store.useP2P){const{unpubMsg:ct,uid:ut}=_e,pt=this._users.find(mt=>mt.uid===ut);if(!pt)return Ut.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(ut)),void rt();try{ct.forEach(async mt=>{let{stream_type:_t}=mt;const vt=_t===es.Audio?Pr.AUDIO:Pr.VIDEO;await this._p2pChannel.unsubscribe(pt,vt),this._handleMuteStream(ut,vt,!0)}),rt()}catch(mt){it(mt)}}}),this._gateway.signal.on(qs.CONTROL,async(_e,rt)=>{const{action:it}=_e;switch(it){case sv.MUTE_LOCAL_VIDEO:this._handleMuteStream(rt,Pr.VIDEO,!0);break;case sv.MUTE_LOCAL_AUDIO:this._handleMuteStream(rt,Pr.AUDIO,!0);break;case sv.UNMUTE_LOCAL_VIDEO:this._handleP2PAddAudioOrVideoStream("video",rt),this._handleMuteStream(rt,Pr.VIDEO,!1);break;case sv.UNMUTE_LOCAL_AUDIO:this._handleP2PAddAudioOrVideoStream("audio",rt),this._handleMuteStream(rt,Pr.AUDIO,!1)}}),this._gateway.signal.on(qs.RESTART_ICE,async(_e,rt,it)=>{if(this.store.useP2P)try{const{direction:ct,iceParameter:ut}=_e;ct!==Gu.SEND_ONLY||ut?rt(await this._p2pChannel.restartICE(ct,ut)):(this._p2pChannel.handleDisconnect(ct),rt())}catch(ct){it(ct)}}),this._gateway.signal.on(qs.CANDIDATE,_e=>{if(this.store.useP2P){const{candidate:rt,direction:it}=_e;this._p2pChannel.addRemoteCandidate(rt,it)}}),this._p2pChannel.on(jr.RequestP2PRestartICE,async(_e,rt,it)=>{try{const{direction:ct}=_e;rt(await this._gateway.sendExtensionMessage(qs.RESTART_ICE,_e,ct===Gu.SEND_ONLY))}catch(ct){it(ct)}}),this._p2pChannel.on(jr.LocalCandidate,_e=>{this._gateway.sendExtensionMessage(qs.CANDIDATE,JSON.stringify(_e),!0)}),this._p2pChannel.on(jr.RequestP2PMuteLocal,async(_e,rt,it)=>{try{await this._gateway.sendExtensionMessage(qs.CONTROL,_e,!0),rt()}catch(ct){it(ct)}}),this._p2pChannel.on(jr.RequestP2PUnmuteRemote,async(_e,rt,it)=>{if(this._joinInfo)try{await this._gateway.unmuteRemote(_e,this._joinInfo.stringUid||this._joinInfo.uid),rt()}catch(ct){ct.code===tn.DISCONNECT_P2P?rt():it(ct)}else rt()}),this._p2pChannel.on(jr.RequestP2PMuteRemote,async(_e,rt,it)=>{if(this._joinInfo)try{await this._gateway.muteRemote(_e,this._joinInfo.stringUid||this._joinInfo.uid),rt()}catch(ct){ct.code===tn.DISCONNECT_P2P?rt():it(ct)}else rt()}),this._p2pChannel.on(jr.StateChange,(_e,rt)=>{rt===qo.Connected&&this._p2pChannel.republish()})}_handleP2PChannelEvents(){this._p2pChannel.on(jr.PeerConnectionStateChange,_e=>{const rt=this._peerConnectionState;_e!==rt&&(this.safeEmit(wo.PEERCONNECTION_STATE_CHANGE,_e,rt),this._peerConnectionState=_e)}),this._p2pChannel.on(jr.RequestMuteLocal,async(_e,rt,it)=>{if(this._joinInfo)try{await this._gateway.muteLocal(_e,this._joinInfo.stringUid||this._joinInfo.uid),rt()}catch(ct){ct.code===tn.DISCONNECT_P2P?rt():it(ct)}else rt()}),this._p2pChannel.on(jr.RequestUnmuteLocal,async(_e,rt,it)=>{if(this._joinInfo)try{await this._gateway.unmuteLocal(_e,this._joinInfo.stringUid||this._joinInfo.uid),rt()}catch(ct){ct.code===tn.DISCONNECT_P2P?rt():it(ct)}else rt()}),this._p2pChannel.on(jr.RequestRePublish,(_e,rt,it)=>{this.publish(_e,!1).then(rt).catch(it)}),this._p2pChannel.on(jr.RequestRePublishDataChannel,(_e,rt,it)=>{Ir.all(_e.map(async ct=>{const ut=await this._p2pChannel.publishDataChannel([ct]);try{ut.forEach(pt=>{this._uid&&this._gateway.publishDataChannel(this._uid,pt,!0)})}catch(pt){if(pt.code!==tn.DISCONNECT_P2P)throw pt}})).then(rt).catch(it)}),this._p2pChannel.on(jr.RequestReSubscribe,async(_e,rt,it)=>{try{for(const{user:ct,kind:ut}of _e)ut===Pr.VIDEO?await this.subscribe(ct,"video"):await this.subscribe(ct,"audio");rt()}catch(ct){it(ct)}}),this._p2pChannel.on(jr.RequestUpload,(_e,rt)=>{this._gateway.upload(_e,rt)}),this._p2pChannel.on(jr.RequestUploadStats,_e=>{this._gateway.uploadWRTCStats(_e)}),this._p2pChannel.on(jr.MediaReconnectStart,_e=>{this.safeEmit(wo.MEDIA_RECONNECT_START,_e)}),this._p2pChannel.on(jr.MediaReconnectEnd,_e=>{this.safeEmit(wo.MEDIA_RECONNECT_END,_e)}),this._p2pChannel.on(jr.NeedSignalRTT,_e=>{_e(this._gateway.getSignalRTT())}),this._p2pChannel.on(jr.RequestRestartICE,async _e=>{if(this.store.useP2P)return;const rt=await this._p2pChannel.restartICE(_e),it=await rt.next();if(it.done)return;const ct=it.value;let ut;try{ut=await this._gateway.restartICE({iceParameters:ct})}catch(mt){return void rt.throw(mt)}const{iceParameters:pt}=function(mt){const _t=mt.iceParameters;return{iceParameters:{iceUfrag:_t.iceUfrag,icePwd:_t.icePwd}}}(ut);await rt.next({remoteIceParameters:pt})}),this._p2pChannel.on(jr.RequestReconnect,async()=>{this._gateway.reconnect()}),this._p2pChannel.on(jr.RequestReconnectPC,async()=>{var _e;const{iceParameters:rt,dtlsParameters:it,rtpCapabilities:ct}=await this._p2pChannel.startP2PConnection({turnServer:(_e=this._joinInfo)===null||_e===void 0?void 0:_e.turnServer}),{gatewayEstablishParams:ut,gatewayAddress:pt}=await this._gateway.reconnectPC({iceParameters:rt,dtlsParameters:it,rtpCapabilities:ct}),mt=HV(ut,pt);await this._p2pChannel.connect(mt),await this._p2pChannel.republish(),await this._p2pChannel.reSubscribe()}),this._p2pChannel.on(jr.RequestUnpublishForReconnectPC,async(_e,rt,it)=>{this._joinInfo&&this._uid!==void 0?(await this._gateway.unpublish(_e,this._uid),rt()):it()}),this._p2pChannel.on(jr.P2PLost,()=>{this.safeEmit(wo.P2P_LOST,this.store.uid)}),this._p2pChannel.on(jr.UpdateVideoEncoder,_e=>{_e._encoderConfig&&this._gateway.setVideoProfile(_e._encoderConfig)}),this._p2pChannel.on(jr.ConnectionTypeChange,_e=>{this.safeEmit(wo.IS_USING_CLOUD_PROXY,_e)}),this._p2pChannel.on(jr.RequestLowStreamParameter,_e=>{_e(this._lowStreamParameter||{width:160,height:120,framerate:15,bitrate:50})}),this._p2pChannel.on(jr.QueryClientConnectionState,_e=>{_e(this.connectionState)}),this._p2pChannel.on(jr.AudioMetadata,_e=>{this.safeEmit(wo.AUDIO_METADATA,_e)}),this._p2pChannel.on(jr.AudioPts,_e=>{this.safeEmit(wo.AUDIO_PTS,Number(_e))})}getKeyMetrics(){return this.store.keyMetrics}async enableContentInspect(_e){if(!this._joinInfo||this.connectionState!=="CONNECTED")throw new $n(tn.INVALID_OPERATION,"[".concat(this._clientId,"] can not create content inspect, please join channel first"));if(this._inspect)throw new $n(tn.INVALID_OPERATION,"[".concat(this._clientId,"] Inspect content service already in connecting/connected state"));try{const it=(rt={config:_e},gE("ContentInspect").create(rt));this._inspect=it,this.handleVideoInspectEvents(it);const{appId:ct,cname:ut,sid:pt,token:mt,uid:_t,cid:vt,vid:Tt}=this._joinInfo;await it.init({appId:ct,areaCode:"",cname:ut,sid:pt,token:mt,uid:_t,cid:vt,vid:Tt?Number(Tt):0},xa)}catch(it){throw Array.isArray(it)?it[0]:it}var rt}handleVideoInspectEvents(_e){_e.on(Bl.CONNECTION_STATE_CHANGE,(rt,it)=>{if(this.safeEmit(wo.CONTENT_INSPECT_CONNECTION_STATE_CHANGE,rt,it),it===Rm.CONNECTED){if(this.connectionState!=="CONNECTED")return void this.safeEmit(wo.CONTENT_INSPECT_ERROR,new $n(tn.OPERATION_ABORTED,"Content inspect was cancelled because it left the channel"));_e.inspectImage()}}),_e.on(Bl.INSPECT_RESULT,(rt,it)=>{var ct;if((it==null?void 0:it.code)===tn.INVALID_OPERATION&&this.connectionState==="DISCONNECTED")return Ut.debug("Stop inspect content because that has left channel"),this==null||(ct=this._inspect)===null||ct===void 0||ct.close(),void(this._inspect=void 0);this.safeEmit(wo.CONTENT_INSPECT_RESULT,rt,it)}),_e.on(Bl.CLIENT_LOCAL_VIDEO_TRACK,rt=>{rt(this.localTracks.filter(it=>it.trackMediaType==="video")[0])})}async disableContentInspect(){if(!this._inspect)throw new $n(tn.INVALID_OPERATION,"[".concat(this._clientId,"] inspectVideoContent not started"));try{this._inspect.close(),this._inspect=void 0}catch(_e){throw Array.isArray(_e)?_e[0]:_e}}async setImageModeration(_e,rt){if(t_(_e,"enabled"),_e){if(!rt)throw new $n(tn.INVALID_PARAMS,"config is required");if(o5(rt),!this._joinInfo)throw new $n(tn.INVALID_OPERATION,"can not create image moderation, please join channel first");try{if(this._moderation)this._moderation.updateConfig(rt);else{const ct=(it={config:rt},gE("ImageModeration").create(it));this._moderation=ct,this.handleImageModerationEvents(ct);const{appId:ut,cname:pt,sid:mt,token:_t,uid:vt,cid:Tt,vid:bt}=this._joinInfo;await ct.init({appId:ut,areaCode:"",cname:pt,sid:mt,token:_t,uid:vt,cid:Tt,vid:bt?Number(bt):0},xa)}}catch(ct){throw Array.isArray(ct)?ct[0]:ct}}else{var it;if(!this._moderation)throw new $n(tn.INVALID_OPERATION,"[".concat(this._clientId,"] image moderation not started"));try{this._moderation.close(),this._moderation.removeAllListeners(),this._moderation=void 0}catch(ct){throw Array.isArray(ct)?ct[0]:ct}}}handleImageModerationEvents(_e){_e.on(s_.CONNECTION_STATE_CHANGE,(rt,it)=>{if(this.safeEmit(wo.IMAGE_MODERATION_CONNECTION_STATE_CHANGE,rt,it),rt===tm.CONNECTED){if(this.connectionState!=="CONNECTED")throw this.setImageModeration(!1),new $n(tn.OPERATION_ABORTED,"Image moderation was cancelled because it left the channel");_e.inspectImage()}}),_e.on(s_.CLIENT_LOCAL_VIDEO_TRACK,rt=>{rt(this.localTracks.filter(it=>it.trackMediaType==="video")[0])})}setP2PTransport(_e){if(function(rt){Cl(rt,"transport",["default","auto","relay","sd-rtn"])}(_e),this.mode!=="p2p")throw new $n(tn.INVALID_OPERATION,"only p2p mode can set p2pTransport");this.store.p2pTransport=_e,Ut.info("[".concat(this._clientId,"] set client p2pTransport to ").concat(_e))}getJoinChannelServiceRecords(){return Ut.debug("getJoinChannelServiceRecords"),this.store.joinChannelServiceRecords}async setPublishAudioFilterEnabled(_e){t_(_e,"enabled"),ns("ENABLE_PUBLISH_AUDIO_FILTER",_e),this._joinInfo&&await this._gateway.setPublishAudioFilterEnabled(_e)}_handleResetAddStream(_e,rt){switch(rt){case"audio":_e._audio_added_=!1,_e._trust_audio_stream_added_state_=!0;break;case"video":_e._video_added_=!1,_e._trust_video_stream_added_state_=!0}}},Br(Mr.prototype,"leave",[s5],Object.getOwnPropertyDescriptor(Mr.prototype,"leave"),Mr.prototype),Br(Mr.prototype,"publish",[a5],Object.getOwnPropertyDescriptor(Mr.prototype,"publish"),Mr.prototype),Br(Mr.prototype,"unpublish",[c5],Object.getOwnPropertyDescriptor(Mr.prototype,"unpublish"),Mr.prototype),Br(Mr.prototype,"subscribe",[l5],Object.getOwnPropertyDescriptor(Mr.prototype,"subscribe"),Mr.prototype),Br(Mr.prototype,"presubscribe",[u5],Object.getOwnPropertyDescriptor(Mr.prototype,"presubscribe"),Mr.prototype),Br(Mr.prototype,"massSubscribe",[d5],Object.getOwnPropertyDescriptor(Mr.prototype,"massSubscribe"),Mr.prototype),Br(Mr.prototype,"unsubscribe",[h5],Object.getOwnPropertyDescriptor(Mr.prototype,"unsubscribe"),Mr.prototype),Br(Mr.prototype,"massUnsubscribe",[p5],Object.getOwnPropertyDescriptor(Mr.prototype,"massUnsubscribe"),Mr.prototype),Br(Mr.prototype,"setLowStreamParameter",[f5],Object.getOwnPropertyDescriptor(Mr.prototype,"setLowStreamParameter"),Mr.prototype),Br(Mr.prototype,"enableDualStream",[m5],Object.getOwnPropertyDescriptor(Mr.prototype,"enableDualStream"),Mr.prototype),Br(Mr.prototype,"disableDualStream",[g5],Object.getOwnPropertyDescriptor(Mr.prototype,"disableDualStream"),Mr.prototype),Br(Mr.prototype,"setClientRole",[_5],Object.getOwnPropertyDescriptor(Mr.prototype,"setClientRole"),Mr.prototype),Br(Mr.prototype,"_setClientRoleOptions",[E5],Object.getOwnPropertyDescriptor(Mr.prototype,"_setClientRoleOptions"),Mr.prototype),Br(Mr.prototype,"setProxyServer",[v5],Object.getOwnPropertyDescriptor(Mr.prototype,"setProxyServer"),Mr.prototype),Br(Mr.prototype,"setTurnServer",[y5],Object.getOwnPropertyDescriptor(Mr.prototype,"setTurnServer"),Mr.prototype),Br(Mr.prototype,"setLicense",[S5],Object.getOwnPropertyDescriptor(Mr.prototype,"setLicense"),Mr.prototype),Br(Mr.prototype,"startProxyServer",[T5],Object.getOwnPropertyDescriptor(Mr.prototype,"startProxyServer"),Mr.prototype),Br(Mr.prototype,"stopProxyServer",[A5],Object.getOwnPropertyDescriptor(Mr.prototype,"stopProxyServer"),Mr.prototype),Br(Mr.prototype,"setLocalAccessPointsV2",[C5],Object.getOwnPropertyDescriptor(Mr.prototype,"setLocalAccessPointsV2"),Mr.prototype),Br(Mr.prototype,"setLocalAccessPoints",[b5],Object.getOwnPropertyDescriptor(Mr.prototype,"setLocalAccessPoints"),Mr.prototype),Br(Mr.prototype,"setRemoteDefaultVideoStreamType",[R5],Object.getOwnPropertyDescriptor(Mr.prototype,"setRemoteDefaultVideoStreamType"),Mr.prototype),Br(Mr.prototype,"setRemoteVideoStreamType",[w5],Object.getOwnPropertyDescriptor(Mr.prototype,"setRemoteVideoStreamType"),Mr.prototype),Br(Mr.prototype,"setStreamFallbackOption",[I5],Object.getOwnPropertyDescriptor(Mr.prototype,"setStreamFallbackOption"),Mr.prototype),Br(Mr.prototype,"setEncryptionConfig",[x5],Object.getOwnPropertyDescriptor(Mr.prototype,"setEncryptionConfig"),Mr.prototype),Br(Mr.prototype,"renewToken",[O5],Object.getOwnPropertyDescriptor(Mr.prototype,"renewToken"),Mr.prototype),Br(Mr.prototype,"enableAudioVolumeIndicator",[M5],Object.getOwnPropertyDescriptor(Mr.prototype,"enableAudioVolumeIndicator"),Mr.prototype),Br(Mr.prototype,"startLiveStreaming",[P5],Object.getOwnPropertyDescriptor(Mr.prototype,"startLiveStreaming"),Mr.prototype),Br(Mr.prototype,"setLiveTranscoding",[N5],Object.getOwnPropertyDescriptor(Mr.prototype,"setLiveTranscoding"),Mr.prototype),Br(Mr.prototype,"stopLiveStreaming",[D5],Object.getOwnPropertyDescriptor(Mr.prototype,"stopLiveStreaming"),Mr.prototype),Br(Mr.prototype,"startChannelMediaRelay",[L5],Object.getOwnPropertyDescriptor(Mr.prototype,"startChannelMediaRelay"),Mr.prototype),Br(Mr.prototype,"updateChannelMediaRelay",[k5],Object.getOwnPropertyDescriptor(Mr.prototype,"updateChannelMediaRelay"),Mr.prototype),Br(Mr.prototype,"stopChannelMediaRelay",[U5],Object.getOwnPropertyDescriptor(Mr.prototype,"stopChannelMediaRelay"),Mr.prototype),Br(Mr.prototype,"sendCustomReportMessage",[B5],Object.getOwnPropertyDescriptor(Mr.prototype,"sendCustomReportMessage"),Mr.prototype),Br(Mr.prototype,"pickSVCLayer",[F5],Object.getOwnPropertyDescriptor(Mr.prototype,"pickSVCLayer"),Mr.prototype),Br(Mr.prototype,"setRTMConfig",[V5],Object.getOwnPropertyDescriptor(Mr.prototype,"setRTMConfig"),Mr.prototype),Br(Mr.prototype,"enableContentInspect",[G5],Object.getOwnPropertyDescriptor(Mr.prototype,"enableContentInspect"),Mr.prototype),Br(Mr.prototype,"disableContentInspect",[$5],Object.getOwnPropertyDescriptor(Mr.prototype,"disableContentInspect"),Mr.prototype),Br(Mr.prototype,"setImageModeration",[H5],Object.getOwnPropertyDescriptor(Mr.prototype,"setImageModeration"),Mr.prototype),Br(Mr.prototype,"setP2PTransport",[j5],Object.getOwnPropertyDescriptor(Mr.prototype,"setP2PTransport"),Mr.prototype),Br(Mr.prototype,"getJoinChannelServiceRecords",[z5],Object.getOwnPropertyDescriptor(Mr.prototype,"getJoinChannelServiceRecords"),Mr.prototype),Br(Mr.prototype,"setPublishAudioFilterEnabled",[W5],Object.getOwnPropertyDescriptor(Mr.prototype,"setPublishAudioFilterEnabled"),Mr.prototype),Mr);class UA{constructor(rt,it){Jt(this,"id",0),Jt(this,"element",void 0),Jt(this,"peerPair",void 0),Jt(this,"context",void 0),Jt(this,"audioPlayerElement",void 0),Jt(this,"audioTrack",void 0),UA.count+=1,this.id=UA.count,this.element=rt,this.context=it}initPeers(){this.peerPair=[new RTCPeerConnection,new RTCPeerConnection],this.peerPair[1].ontrack=rt=>{const it=document.createElement("audio");it.srcObject=new MediaStream([rt.track]),it.play(),this.audioPlayerElement=it}}async switchSdp(){if(!this.peerPair)return;const rt=async(ct,ut)=>{const pt=ut==="offer"?await ct.createOffer():await ct.createAnswer();return await ct.setLocalDescription(pt),ct.iceGatheringState==="complete"?ct.localDescription:new Ir(mt=>{ct.onicegatheringstatechange=()=>{ct.iceGatheringState==="complete"&&mt(ct.localDescription)}})},it=async(ct,ut)=>await ct.setRemoteDescription(ut);try{const ct=await rt(this.peerPair[0],"offer");await it(this.peerPair[1],ct);const ut=await rt(this.peerPair[1],"answer");await it(this.peerPair[0],ut)}catch(ct){throw new $n(tn.LOCAL_AEC_ERROR,ct.toString()).print()}}async getTracksFromMediaElement(rt){if(this.audioTrack)return this.audioTrack;let it;try{rt instanceof HTMLVideoElement&&(rt.captureStream?rt.captureStream():rt.mozCaptureStream()),it=this.context.createMediaStreamDestination(),this.context.createMediaElementSource(rt).connect(it)}catch(ut){throw new $n(tn.LOCAL_AEC_ERROR,ut.toString()).print()}if(!it)throw new $n(tn.LOCAL_AEC_ERROR,"no dest node when local aec").print();const ct=it.stream.getAudioTracks()[0];return this.audioTrack=ct,ct}getElement(){return this.element}async startEchoCancellation(){this.context.resume(),this.peerPair&&this.close(),this.initPeers();const rt=this.element,it=await this.getTracksFromMediaElement(rt);this.peerPair&&this.peerPair[0].addTrack(it),await this.switchSdp()}close(){Ut.debug("close echo cancellation unit, id is",this.id),this.audioPlayerElement&&this.audioPlayerElement.pause(),this.peerPair&&this.peerPair.forEach(rt=>{rt.close()}),this.peerPair=void 0,this.audioPlayerElement=void 0}}var Y5,p1;Jt(UA,"count",0);const Sq=window.AudioContext||window.webkitAudioContext,Tq=new(Y5=Jr({report:Vr}),Br((p1=class{constructor(){Jt(this,"units",[]),Jt(this,"context",void 0)}processExternalMediaAEC(_e){if(!this._doesEnvironmentNeedAEC())return Ut.debug("the system does not need to process local aec"),-1;this.context||(this.context=new Sq);let rt=this.units.find(it=>it&&it.getElement()===_e);return rt||(rt=new UA(_e,this.context),this.units.push(rt)),rt.startEchoCancellation(),Ut.debug("start processing local audio echo cancellation, id is",rt.id),rt.id}_doesEnvironmentNeedAEC(){return No().name!==Ho.SAFARI}}).prototype,"processExternalMediaAEC",[Y5],Object.getOwnPropertyDescriptor(p1.prototype,"processExternalMediaAEC"),p1.prototype),p1);function X5(_e,rt){var it=Object.keys(_e);if(Object.getOwnPropertySymbols){var ct=Object.getOwnPropertySymbols(_e);rt&&(ct=ct.filter(function(ut){return Object.getOwnPropertyDescriptor(_e,ut).enumerable})),it.push.apply(it,ct)}return it}function q5(_e){for(var rt=1;rt<arguments.length;rt++){var it=arguments[rt]!=null?arguments[rt]:{};rt%2?X5(Object(it),!0).forEach(function(ct){Jt(_e,ct,it[ct])}):Object.getOwnPropertyDescriptors?Object.defineProperties(_e,Object.getOwnPropertyDescriptors(it)):X5(Object(it)).forEach(function(ct){Object.defineProperty(_e,ct,Object.getOwnPropertyDescriptor(it,ct))})}return _e}const JM=window||document;function J5(_e){let rt=arguments.length>1&&arguments[1]!==void 0&&arguments[1];if(!JM)return;const it=$a._cspEventHandlerPointer;if(it&&rt)return void console.error(it,rt);const ct=ut=>{if(!(ut&&ut.blockedURI&&($a.onSecurityPolicyViolation||$a.getListeners(U_.SECURITY_POLICY_VIOLATION).length>0)))return;const pt=ut.blockedURI;rn("CSP_DETECTED_HOSTNAME_LIST").some(mt=>Er(pt).call(pt,mt))&&($a.onSecurityPolicyViolation&&typeof $a.onSecurityPolicyViolation=="function"&&$a.onSecurityPolicyViolation(ut),$a.getListeners(U_.SECURITY_POLICY_VIOLATION).length>0&&$a.safeEmit(U_.SECURITY_POLICY_VIOLATION,ut))};it&&JM.removeEventListener("securitypolicyviolation",it),(rt||_e&&typeof _e=="function"||$a.getListeners(U_.SECURITY_POLICY_VIOLATION).length>0)&&JM.addEventListener("securitypolicyviolation",ct),$a._cspEventHandlerPointer=ct}var Aq=yt,Cq=PU,Z5=RegExp.prototype,bq=function(_e){return _e===Z5||Aq(Z5,_e)?Cq(_e):_e.flags},Ou=st(bq);function zS(_e){let rt=_e.length;for(;--rt>=0;)_e[rt]=0}const ZM=256,Q5=286,BA=30,FA=15,QM=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),f1=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),Rq=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),eG=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),EE=new Array(576);zS(EE);const VA=new Array(60);zS(VA);const GA=new Array(512);zS(GA);const $A=new Array(256);zS($A);const eP=new Array(29);zS(eP);const m1=new Array(BA);function tP(_e,rt,it,ct,ut){this.static_tree=_e,this.extra_bits=rt,this.extra_base=it,this.elems=ct,this.max_length=ut,this.has_stree=_e&&_e.length}let tG,nG,rG;function nP(_e,rt){this.dyn_tree=_e,this.max_code=0,this.stat_desc=rt}zS(m1);const iG=_e=>_e<256?GA[_e]:GA[256+(_e>>>7)],HA=(_e,rt)=>{_e.pending_buf[_e.pending++]=255&rt,_e.pending_buf[_e.pending++]=rt>>>8&255},jp=(_e,rt,it)=>{_e.bi_valid>16-it?(_e.bi_buf|=rt<<_e.bi_valid&65535,HA(_e,_e.bi_buf),_e.bi_buf=rt>>16-_e.bi_valid,_e.bi_valid+=it-16):(_e.bi_buf|=rt<<_e.bi_valid&65535,_e.bi_valid+=it)},V_=(_e,rt,it)=>{jp(_e,it[2*rt],it[2*rt+1])},oG=(_e,rt)=>{let it=0;do it|=1&_e,_e>>>=1,it<<=1;while(--rt>0);return it>>>1},sG=(_e,rt,it)=>{const ct=new Array(16);let ut,pt,mt=0;for(ut=1;ut<=FA;ut++)mt=mt+it[ut-1]<<1,ct[ut]=mt;for(pt=0;pt<=rt;pt++){let _t=_e[2*pt+1];_t!==0&&(_e[2*pt]=oG(ct[_t]++,_t))}},aG=_e=>{let rt;for(rt=0;rt<Q5;rt++)_e.dyn_ltree[2*rt]=0;for(rt=0;rt<BA;rt++)_e.dyn_dtree[2*rt]=0;for(rt=0;rt<19;rt++)_e.bl_tree[2*rt]=0;_e.dyn_ltree[512]=1,_e.opt_len=_e.static_len=0,_e.sym_next=_e.matches=0},cG=_e=>{_e.bi_valid>8?HA(_e,_e.bi_buf):_e.bi_valid>0&&(_e.pending_buf[_e.pending++]=_e.bi_buf),_e.bi_buf=0,_e.bi_valid=0},lG=(_e,rt,it,ct)=>{const ut=2*rt,pt=2*it;return _e[ut]<_e[pt]||_e[ut]===_e[pt]&&ct[rt]<=ct[it]},rP=(_e,rt,it)=>{const ct=_e.heap[it];let ut=it<<1;for(;ut<=_e.heap_len&&(ut<_e.heap_len&&lG(rt,_e.heap[ut+1],_e.heap[ut],_e.depth)&&ut++,!lG(rt,ct,_e.heap[ut],_e.depth));)_e.heap[it]=_e.heap[ut],it=ut,ut<<=1;_e.heap[it]=ct},uG=(_e,rt,it)=>{let ct,ut,pt,mt,_t=0;if(_e.sym_next!==0)do ct=255&_e.pending_buf[_e.sym_buf+_t++],ct+=(255&_e.pending_buf[_e.sym_buf+_t++])<<8,ut=_e.pending_buf[_e.sym_buf+_t++],ct===0?V_(_e,ut,rt):(pt=$A[ut],V_(_e,pt+ZM+1,rt),mt=QM[pt],mt!==0&&(ut-=eP[pt],jp(_e,ut,mt)),ct--,pt=iG(ct),V_(_e,pt,it),mt=f1[pt],mt!==0&&(ct-=m1[pt],jp(_e,ct,mt)));while(_t<_e.sym_next);V_(_e,256,rt)},iP=(_e,rt)=>{const it=rt.dyn_tree,ct=rt.stat_desc.static_tree,ut=rt.stat_desc.has_stree,pt=rt.stat_desc.elems;let mt,_t,vt,Tt=-1;for(_e.heap_len=0,_e.heap_max=573,mt=0;mt<pt;mt++)it[2*mt]!==0?(_e.heap[++_e.heap_len]=Tt=mt,_e.depth[mt]=0):it[2*mt+1]=0;for(;_e.heap_len<2;)vt=_e.heap[++_e.heap_len]=Tt<2?++Tt:0,it[2*vt]=1,_e.depth[vt]=0,_e.opt_len--,ut&&(_e.static_len-=ct[2*vt+1]);for(rt.max_code=Tt,mt=_e.heap_len>>1;mt>=1;mt--)rP(_e,it,mt);vt=pt;do mt=_e.heap[1],_e.heap[1]=_e.heap[_e.heap_len--],rP(_e,it,1),_t=_e.heap[1],_e.heap[--_e.heap_max]=mt,_e.heap[--_e.heap_max]=_t,it[2*vt]=it[2*mt]+it[2*_t],_e.depth[vt]=(_e.depth[mt]>=_e.depth[_t]?_e.depth[mt]:_e.depth[_t])+1,it[2*mt+1]=it[2*_t+1]=vt,_e.heap[1]=vt++,rP(_e,it,1);while(_e.heap_len>=2);_e.heap[--_e.heap_max]=_e.heap[1],((bt,Ot)=>{const Mt=Ot.dyn_tree,Dt=Ot.max_code,jt=Ot.stat_desc.static_tree,$t=Ot.stat_desc.has_stree,Ht=Ot.stat_desc.extra_bits,en=Ot.stat_desc.extra_base,Qt=Ot.stat_desc.max_length;let on,Tn,vn,hn,Ln,Xn,Qn=0;for(hn=0;hn<=FA;hn++)bt.bl_count[hn]=0;for(Mt[2*bt.heap[bt.heap_max]+1]=0,on=bt.heap_max+1;on<573;on++)Tn=bt.heap[on],hn=Mt[2*Mt[2*Tn+1]+1]+1,hn>Qt&&(hn=Qt,Qn++),Mt[2*Tn+1]=hn,Tn>Dt||(bt.bl_count[hn]++,Ln=0,Tn>=en&&(Ln=Ht[Tn-en]),Xn=Mt[2*Tn],bt.opt_len+=Xn*(hn+Ln),$t&&(bt.static_len+=Xn*(jt[2*Tn+1]+Ln)));if(Qn!==0){do{for(hn=Qt-1;bt.bl_count[hn]===0;)hn--;bt.bl_count[hn]--,bt.bl_count[hn+1]+=2,bt.bl_count[Qt]--,Qn-=2}while(Qn>0);for(hn=Qt;hn!==0;hn--)for(Tn=bt.bl_count[hn];Tn!==0;)vn=bt.heap[--on],vn>Dt||(Mt[2*vn+1]!==hn&&(bt.opt_len+=(hn-Mt[2*vn+1])*Mt[2*vn],Mt[2*vn+1]=hn),Tn--)}})(_e,rt),sG(it,Tt,_e.bl_count)},dG=(_e,rt,it)=>{let ct,ut,pt=-1,mt=rt[1],_t=0,vt=7,Tt=4;for(mt===0&&(vt=138,Tt=3),rt[2*(it+1)+1]=65535,ct=0;ct<=it;ct++)ut=mt,mt=rt[2*(ct+1)+1],++_t<vt&&ut===mt||(_t<Tt?_e.bl_tree[2*ut]+=_t:ut!==0?(ut!==pt&&_e.bl_tree[2*ut]++,_e.bl_tree[32]++):_t<=10?_e.bl_tree[34]++:_e.bl_tree[36]++,_t=0,pt=ut,mt===0?(vt=138,Tt=3):ut===mt?(vt=6,Tt=3):(vt=7,Tt=4))},hG=(_e,rt,it)=>{let ct,ut,pt=-1,mt=rt[1],_t=0,vt=7,Tt=4;for(mt===0&&(vt=138,Tt=3),ct=0;ct<=it;ct++)if(ut=mt,mt=rt[2*(ct+1)+1],!(++_t<vt&&ut===mt)){if(_t<Tt)do V_(_e,ut,_e.bl_tree);while(--_t!=0);else ut!==0?(ut!==pt&&(V_(_e,ut,_e.bl_tree),_t--),V_(_e,16,_e.bl_tree),jp(_e,_t-3,2)):_t<=10?(V_(_e,17,_e.bl_tree),jp(_e,_t-3,3)):(V_(_e,18,_e.bl_tree),jp(_e,_t-11,7));_t=0,pt=ut,mt===0?(vt=138,Tt=3):ut===mt?(vt=6,Tt=3):(vt=7,Tt=4)}};let pG=!1;const fG=(_e,rt,it,ct)=>{jp(_e,0+(ct?1:0),3),cG(_e),HA(_e,it),HA(_e,~it),it&&_e.pending_buf.set(_e.window.subarray(rt,rt+it),_e.pending),_e.pending+=it};var wq=_e=>{pG||((()=>{let rt,it,ct,ut,pt;const mt=new Array(16);for(ct=0,ut=0;ut<28;ut++)for(eP[ut]=ct,rt=0;rt<1<<QM[ut];rt++)$A[ct++]=ut;for($A[ct-1]=ut,pt=0,ut=0;ut<16;ut++)for(m1[ut]=pt,rt=0;rt<1<<f1[ut];rt++)GA[pt++]=ut;for(pt>>=7;ut<BA;ut++)for(m1[ut]=pt<<7,rt=0;rt<1<<f1[ut]-7;rt++)GA[256+pt++]=ut;for(it=0;it<=FA;it++)mt[it]=0;for(rt=0;rt<=143;)EE[2*rt+1]=8,rt++,mt[8]++;for(;rt<=255;)EE[2*rt+1]=9,rt++,mt[9]++;for(;rt<=279;)EE[2*rt+1]=7,rt++,mt[7]++;for(;rt<=287;)EE[2*rt+1]=8,rt++,mt[8]++;for(sG(EE,287,mt),rt=0;rt<BA;rt++)VA[2*rt+1]=5,VA[2*rt]=oG(rt,5);tG=new tP(EE,QM,257,Q5,FA),nG=new tP(VA,f1,0,BA,FA),rG=new tP(new Array(0),Rq,0,19,7)})(),pG=!0),_e.l_desc=new nP(_e.dyn_ltree,tG),_e.d_desc=new nP(_e.dyn_dtree,nG),_e.bl_desc=new nP(_e.bl_tree,rG),_e.bi_buf=0,_e.bi_valid=0,aG(_e)},Iq=(_e,rt,it,ct)=>{let ut,pt,mt=0;_e.level>0?(_e.strm.data_type===2&&(_e.strm.data_type=(_t=>{let vt,Tt=4093624447;for(vt=0;vt<=31;vt++,Tt>>>=1)if(1&Tt&&_t.dyn_ltree[2*vt]!==0)return 0;if(_t.dyn_ltree[18]!==0||_t.dyn_ltree[20]!==0||_t.dyn_ltree[26]!==0)return 1;for(vt=32;vt<ZM;vt++)if(_t.dyn_ltree[2*vt]!==0)return 1;return 0})(_e)),iP(_e,_e.l_desc),iP(_e,_e.d_desc),mt=(_t=>{let vt;for(dG(_t,_t.dyn_ltree,_t.l_desc.max_code),dG(_t,_t.dyn_dtree,_t.d_desc.max_code),iP(_t,_t.bl_desc),vt=18;vt>=3&&_t.bl_tree[2*eG[vt]+1]===0;vt--);return _t.opt_len+=3*(vt+1)+5+5+4,vt})(_e),ut=_e.opt_len+3+7>>>3,pt=_e.static_len+3+7>>>3,pt<=ut&&(ut=pt)):ut=pt=it+5,it+4<=ut&&rt!==-1?fG(_e,rt,it,ct):_e.strategy===4||pt===ut?(jp(_e,2+(ct?1:0),3),uG(_e,EE,VA)):(jp(_e,4+(ct?1:0),3),((_t,vt,Tt,bt)=>{let Ot;for(jp(_t,vt-257,5),jp(_t,Tt-1,5),jp(_t,bt-4,4),Ot=0;Ot<bt;Ot++)jp(_t,_t.bl_tree[2*eG[Ot]+1],3);hG(_t,_t.dyn_ltree,vt-1),hG(_t,_t.dyn_dtree,Tt-1)})(_e,_e.l_desc.max_code+1,_e.d_desc.max_code+1,mt+1),uG(_e,_e.dyn_ltree,_e.dyn_dtree)),aG(_e),ct&&cG(_e)},xq=(_e,rt,it)=>(_e.pending_buf[_e.sym_buf+_e.sym_next++]=rt,_e.pending_buf[_e.sym_buf+_e.sym_next++]=rt>>8,_e.pending_buf[_e.sym_buf+_e.sym_next++]=it,rt===0?_e.dyn_ltree[2*it]++:(_e.matches++,rt--,_e.dyn_ltree[2*($A[it]+ZM+1)]++,_e.dyn_dtree[2*iG(rt)]++),_e.sym_next===_e.sym_end),Oq=_e=>{jp(_e,2,3),V_(_e,256,EE),(rt=>{rt.bi_valid===16?(HA(rt,rt.bi_buf),rt.bi_buf=0,rt.bi_valid=0):rt.bi_valid>=8&&(rt.pending_buf[rt.pending++]=255&rt.bi_buf,rt.bi_buf>>=8,rt.bi_valid-=8)})(_e)},Mq={_tr_init:wq,_tr_stored_block:fG,_tr_flush_block:Iq,_tr_tally:xq,_tr_align:Oq},jA=(_e,rt,it,ct)=>{let ut=65535&_e|0,pt=_e>>>16&65535|0,mt=0;for(;it!==0;){mt=it>2e3?2e3:it,it-=mt;do ut=ut+rt[ct++]|0,pt=pt+ut|0;while(--mt);ut%=65521,pt%=65521}return ut|pt<<16|0};const Pq=new Uint32Array((()=>{let _e,rt=[];for(var it=0;it<256;it++){_e=it;for(var ct=0;ct<8;ct++)_e=1&_e?3988292384^_e>>>1:_e>>>1;rt[it]=_e}return rt})());var Hu=(_e,rt,it,ct)=>{const ut=Pq,pt=ct+it;_e^=-1;for(let mt=ct;mt<pt;mt++)_e=_e>>>8^ut[255&(_e^rt[mt])];return-1^_e},M0={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},WS={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:Nq,_tr_stored_block:oP,_tr_flush_block:Dq,_tr_tally:_v,_tr_align:Lq}=Mq,{Z_NO_FLUSH:Ev,Z_PARTIAL_FLUSH:kq,Z_FULL_FLUSH:Uq,Z_FINISH:Mm,Z_BLOCK:mG,Z_OK:Qu,Z_STREAM_END:gG,Z_STREAM_ERROR:G_,Z_DATA_ERROR:Bq,Z_BUF_ERROR:sP,Z_DEFAULT_COMPRESSION:Fq,Z_FILTERED:Vq,Z_HUFFMAN_ONLY:g1,Z_RLE:Gq,Z_FIXED:$q,Z_DEFAULT_STRATEGY:Hq,Z_UNKNOWN:jq,Z_DEFLATED:_1}=WS,aP=286,zq=30,Wq=19,Kq=2*aP+1,Yq=15,P0=258,$_=262,KS=42,N0=113,zA=666,D0=(_e,rt)=>(_e.msg=M0[rt],rt),_G=_e=>2*_e-(_e>4?9:0),vv=_e=>{let rt=_e.length;for(;--rt>=0;)_e[rt]=0},Xq=_e=>{let rt,it,ct,ut=_e.w_size;rt=_e.hash_size,ct=rt;do it=_e.head[--ct],_e.head[ct]=it>=ut?it-ut:0;while(--rt);rt=ut,ct=rt;do it=_e.prev[--ct],_e.prev[ct]=it>=ut?it-ut:0;while(--rt)};let yv=(_e,rt,it)=>(rt<<_e.hash_shift^it)&_e.hash_mask;const rm=_e=>{const rt=_e.state;let it=rt.pending;it>_e.avail_out&&(it=_e.avail_out),it!==0&&(_e.output.set(rt.pending_buf.subarray(rt.pending_out,rt.pending_out+it),_e.next_out),_e.next_out+=it,rt.pending_out+=it,_e.total_out+=it,_e.avail_out-=it,rt.pending-=it,rt.pending===0&&(rt.pending_out=0))},im=(_e,rt)=>{Dq(_e,_e.block_start>=0?_e.block_start:-1,_e.strstart-_e.block_start,rt),_e.block_start=_e.strstart,rm(_e.strm)},Ys=(_e,rt)=>{_e.pending_buf[_e.pending++]=rt},WA=(_e,rt)=>{_e.pending_buf[_e.pending++]=rt>>>8&255,_e.pending_buf[_e.pending++]=255&rt},cP=(_e,rt,it,ct)=>{let ut=_e.avail_in;return ut>ct&&(ut=ct),ut===0?0:(_e.avail_in-=ut,rt.set(_e.input.subarray(_e.next_in,_e.next_in+ut),it),_e.state.wrap===1?_e.adler=jA(_e.adler,rt,ut,it):_e.state.wrap===2&&(_e.adler=Hu(_e.adler,rt,ut,it)),_e.next_in+=ut,_e.total_in+=ut,ut)},EG=(_e,rt)=>{let it,ct,ut=_e.max_chain_length,pt=_e.strstart,mt=_e.prev_length,_t=_e.nice_match;const vt=_e.strstart>_e.w_size-$_?_e.strstart-(_e.w_size-$_):0,Tt=_e.window,bt=_e.w_mask,Ot=_e.prev,Mt=_e.strstart+P0;let Dt=Tt[pt+mt-1],jt=Tt[pt+mt];_e.prev_length>=_e.good_match&&(ut>>=2),_t>_e.lookahead&&(_t=_e.lookahead);do if(it=rt,Tt[it+mt]===jt&&Tt[it+mt-1]===Dt&&Tt[it]===Tt[pt]&&Tt[++it]===Tt[pt+1]){pt+=2,it++;do;while(Tt[++pt]===Tt[++it]&&Tt[++pt]===Tt[++it]&&Tt[++pt]===Tt[++it]&&Tt[++pt]===Tt[++it]&&Tt[++pt]===Tt[++it]&&Tt[++pt]===Tt[++it]&&Tt[++pt]===Tt[++it]&&Tt[++pt]===Tt[++it]&&pt<Mt);if(ct=P0-(Mt-pt),pt=Mt-P0,ct>mt){if(_e.match_start=rt,mt=ct,ct>=_t)break;Dt=Tt[pt+mt-1],jt=Tt[pt+mt]}}while((rt=Ot[rt&bt])>vt&&--ut!=0);return mt<=_e.lookahead?mt:_e.lookahead},YS=_e=>{const rt=_e.w_size;let it,ct,ut;do{if(ct=_e.window_size-_e.lookahead-_e.strstart,_e.strstart>=rt+(rt-$_)&&(_e.window.set(_e.window.subarray(rt,rt+rt-ct),0),_e.match_start-=rt,_e.strstart-=rt,_e.block_start-=rt,_e.insert>_e.strstart&&(_e.insert=_e.strstart),Xq(_e),ct+=rt),_e.strm.avail_in===0)break;if(it=cP(_e.strm,_e.window,_e.strstart+_e.lookahead,ct),_e.lookahead+=it,_e.lookahead+_e.insert>=3)for(ut=_e.strstart-_e.insert,_e.ins_h=_e.window[ut],_e.ins_h=yv(_e,_e.ins_h,_e.window[ut+1]);_e.insert&&(_e.ins_h=yv(_e,_e.ins_h,_e.window[ut+3-1]),_e.prev[ut&_e.w_mask]=_e.head[_e.ins_h],_e.head[_e.ins_h]=ut,ut++,_e.insert--,!(_e.lookahead+_e.insert<3)););}while(_e.lookahead<$_&&_e.strm.avail_in!==0)},vG=(_e,rt)=>{let it,ct,ut,pt=_e.pending_buf_size-5>_e.w_size?_e.w_size:_e.pending_buf_size-5,mt=0,_t=_e.strm.avail_in;do{if(it=65535,ut=_e.bi_valid+42>>3,_e.strm.avail_out<ut||(ut=_e.strm.avail_out-ut,ct=_e.strstart-_e.block_start,it>ct+_e.strm.avail_in&&(it=ct+_e.strm.avail_in),it>ut&&(it=ut),it<pt&&(it===0&&rt!==Mm||rt===Ev||it!==ct+_e.strm.avail_in)))break;mt=rt===Mm&&it===ct+_e.strm.avail_in?1:0,oP(_e,0,0,mt),_e.pending_buf[_e.pending-4]=it,_e.pending_buf[_e.pending-3]=it>>8,_e.pending_buf[_e.pending-2]=~it,_e.pending_buf[_e.pending-1]=~it>>8,rm(_e.strm),ct&&(ct>it&&(ct=it),_e.strm.output.set(_e.window.subarray(_e.block_start,_e.block_start+ct),_e.strm.next_out),_e.strm.next_out+=ct,_e.strm.avail_out-=ct,_e.strm.total_out+=ct,_e.block_start+=ct,it-=ct),it&&(cP(_e.strm,_e.strm.output,_e.strm.next_out,it),_e.strm.next_out+=it,_e.strm.avail_out-=it,_e.strm.total_out+=it)}while(mt===0);return _t-=_e.strm.avail_in,_t&&(_t>=_e.w_size?(_e.matches=2,_e.window.set(_e.strm.input.subarray(_e.strm.next_in-_e.w_size,_e.strm.next_in),0),_e.strstart=_e.w_size,_e.insert=_e.strstart):(_e.window_size-_e.strstart<=_t&&(_e.strstart-=_e.w_size,_e.window.set(_e.window.subarray(_e.w_size,_e.w_size+_e.strstart),0),_e.matches<2&&_e.matches++,_e.insert>_e.strstart&&(_e.insert=_e.strstart)),_e.window.set(_e.strm.input.subarray(_e.strm.next_in-_t,_e.strm.next_in),_e.strstart),_e.strstart+=_t,_e.insert+=_t>_e.w_size-_e.insert?_e.w_size-_e.insert:_t),_e.block_start=_e.strstart),_e.high_water<_e.strstart&&(_e.high_water=_e.strstart),mt?4:rt!==Ev&&rt!==Mm&&_e.strm.avail_in===0&&_e.strstart===_e.block_start?2:(ut=_e.window_size-_e.strstart,_e.strm.avail_in>ut&&_e.block_start>=_e.w_size&&(_e.block_start-=_e.w_size,_e.strstart-=_e.w_size,_e.window.set(_e.window.subarray(_e.w_size,_e.w_size+_e.strstart),0),_e.matches<2&&_e.matches++,ut+=_e.w_size,_e.insert>_e.strstart&&(_e.insert=_e.strstart)),ut>_e.strm.avail_in&&(ut=_e.strm.avail_in),ut&&(cP(_e.strm,_e.window,_e.strstart,ut),_e.strstart+=ut,_e.insert+=ut>_e.w_size-_e.insert?_e.w_size-_e.insert:ut),_e.high_water<_e.strstart&&(_e.high_water=_e.strstart),ut=_e.bi_valid+42>>3,ut=_e.pending_buf_size-ut>65535?65535:_e.pending_buf_size-ut,pt=ut>_e.w_size?_e.w_size:ut,ct=_e.strstart-_e.block_start,(ct>=pt||(ct||rt===Mm)&&rt!==Ev&&_e.strm.avail_in===0&&ct<=ut)&&(it=ct>ut?ut:ct,mt=rt===Mm&&_e.strm.avail_in===0&&it===ct?1:0,oP(_e,_e.block_start,it,mt),_e.block_start+=it,rm(_e.strm)),mt?3:1)},lP=(_e,rt)=>{let it,ct;for(;;){if(_e.lookahead<$_){if(YS(_e),_e.lookahead<$_&&rt===Ev)return 1;if(_e.lookahead===0)break}if(it=0,_e.lookahead>=3&&(_e.ins_h=yv(_e,_e.ins_h,_e.window[_e.strstart+3-1]),it=_e.prev[_e.strstart&_e.w_mask]=_e.head[_e.ins_h],_e.head[_e.ins_h]=_e.strstart),it!==0&&_e.strstart-it<=_e.w_size-$_&&(_e.match_length=EG(_e,it)),_e.match_length>=3)if(ct=_v(_e,_e.strstart-_e.match_start,_e.match_length-3),_e.lookahead-=_e.match_length,_e.match_length<=_e.max_lazy_match&&_e.lookahead>=3){_e.match_length--;do _e.strstart++,_e.ins_h=yv(_e,_e.ins_h,_e.window[_e.strstart+3-1]),it=_e.prev[_e.strstart&_e.w_mask]=_e.head[_e.ins_h],_e.head[_e.ins_h]=_e.strstart;while(--_e.match_length!=0);_e.strstart++}else _e.strstart+=_e.match_length,_e.match_length=0,_e.ins_h=_e.window[_e.strstart],_e.ins_h=yv(_e,_e.ins_h,_e.window[_e.strstart+1]);else ct=_v(_e,0,_e.window[_e.strstart]),_e.lookahead--,_e.strstart++;if(ct&&(im(_e,!1),_e.strm.avail_out===0))return 1}return _e.insert=_e.strstart<2?_e.strstart:2,rt===Mm?(im(_e,!0),_e.strm.avail_out===0?3:4):_e.sym_next&&(im(_e,!1),_e.strm.avail_out===0)?1:2},XS=(_e,rt)=>{let it,ct,ut;for(;;){if(_e.lookahead<$_){if(YS(_e),_e.lookahead<$_&&rt===Ev)return 1;if(_e.lookahead===0)break}if(it=0,_e.lookahead>=3&&(_e.ins_h=yv(_e,_e.ins_h,_e.window[_e.strstart+3-1]),it=_e.prev[_e.strstart&_e.w_mask]=_e.head[_e.ins_h],_e.head[_e.ins_h]=_e.strstart),_e.prev_length=_e.match_length,_e.prev_match=_e.match_start,_e.match_length=2,it!==0&&_e.prev_length<_e.max_lazy_match&&_e.strstart-it<=_e.w_size-$_&&(_e.match_length=EG(_e,it),_e.match_length<=5&&(_e.strategy===Vq||_e.match_length===3&&_e.strstart-_e.match_start>4096)&&(_e.match_length=2)),_e.prev_length>=3&&_e.match_length<=_e.prev_length){ut=_e.strstart+_e.lookahead-3,ct=_v(_e,_e.strstart-1-_e.prev_match,_e.prev_length-3),_e.lookahead-=_e.prev_length-1,_e.prev_length-=2;do++_e.strstart<=ut&&(_e.ins_h=yv(_e,_e.ins_h,_e.window[_e.strstart+3-1]),it=_e.prev[_e.strstart&_e.w_mask]=_e.head[_e.ins_h],_e.head[_e.ins_h]=_e.strstart);while(--_e.prev_length!=0);if(_e.match_available=0,_e.match_length=2,_e.strstart++,ct&&(im(_e,!1),_e.strm.avail_out===0))return 1}else if(_e.match_available){if(ct=_v(_e,0,_e.window[_e.strstart-1]),ct&&im(_e,!1),_e.strstart++,_e.lookahead--,_e.strm.avail_out===0)return 1}else _e.match_available=1,_e.strstart++,_e.lookahead--}return _e.match_available&&(ct=_v(_e,0,_e.window[_e.strstart-1]),_e.match_available=0),_e.insert=_e.strstart<2?_e.strstart:2,rt===Mm?(im(_e,!0),_e.strm.avail_out===0?3:4):_e.sym_next&&(im(_e,!1),_e.strm.avail_out===0)?1:2};function H_(_e,rt,it,ct,ut){this.good_length=_e,this.max_lazy=rt,this.nice_length=it,this.max_chain=ct,this.func=ut}const KA=[new H_(0,0,0,0,vG),new H_(4,4,8,4,lP),new H_(4,5,16,8,lP),new H_(4,6,32,32,lP),new H_(4,4,16,16,XS),new H_(8,16,32,32,XS),new H_(8,16,128,128,XS),new H_(8,32,128,256,XS),new H_(32,128,258,1024,XS),new H_(32,258,258,4096,XS)];function qq(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=_1,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(2*Kq),this.dyn_dtree=new Uint16Array(2*(2*zq+1)),this.bl_tree=new Uint16Array(2*(2*Wq+1)),vv(this.dyn_ltree),vv(this.dyn_dtree),vv(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(Yq+1),this.heap=new Uint16Array(2*aP+1),vv(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*aP+1),vv(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const YA=_e=>{if(!_e)return 1;const rt=_e.state;return!rt||rt.strm!==_e||rt.status!==KS&&rt.status!==57&&rt.status!==69&&rt.status!==73&&rt.status!==91&&rt.status!==103&&rt.status!==N0&&rt.status!==zA?1:0},yG=_e=>{if(YA(_e))return D0(_e,G_);_e.total_in=_e.total_out=0,_e.data_type=jq;const rt=_e.state;return rt.pending=0,rt.pending_out=0,rt.wrap<0&&(rt.wrap=-rt.wrap),rt.status=rt.wrap===2?57:rt.wrap?KS:N0,_e.adler=rt.wrap===2?0:1,rt.last_flush=-2,Nq(rt),Qu},SG=_e=>{const rt=yG(_e);return rt===Qu&&(it=>{it.window_size=2*it.w_size,vv(it.head),it.max_lazy_match=KA[it.level].max_lazy,it.good_match=KA[it.level].good_length,it.nice_match=KA[it.level].nice_length,it.max_chain_length=KA[it.level].max_chain,it.strstart=0,it.block_start=0,it.lookahead=0,it.insert=0,it.match_length=it.prev_length=2,it.match_available=0,it.ins_h=0})(_e.state),rt},TG=(_e,rt,it,ct,ut,pt)=>{if(!_e)return G_;let mt=1;if(rt===Fq&&(rt=6),ct<0?(mt=0,ct=-ct):ct>15&&(mt=2,ct-=16),ut<1||ut>9||it!==_1||ct<8||ct>15||rt<0||rt>9||pt<0||pt>$q||ct===8&&mt!==1)return D0(_e,G_);ct===8&&(ct=9);const _t=new qq;return _e.state=_t,_t.strm=_e,_t.status=KS,_t.wrap=mt,_t.gzhead=null,_t.w_bits=ct,_t.w_size=1<<_t.w_bits,_t.w_mask=_t.w_size-1,_t.hash_bits=ut+7,_t.hash_size=1<<_t.hash_bits,_t.hash_mask=_t.hash_size-1,_t.hash_shift=~~((_t.hash_bits+3-1)/3),_t.window=new Uint8Array(2*_t.w_size),_t.head=new Uint16Array(_t.hash_size),_t.prev=new Uint16Array(_t.w_size),_t.lit_bufsize=1<<ut+6,_t.pending_buf_size=4*_t.lit_bufsize,_t.pending_buf=new Uint8Array(_t.pending_buf_size),_t.sym_buf=_t.lit_bufsize,_t.sym_end=3*(_t.lit_bufsize-1),_t.level=rt,_t.strategy=pt,_t.method=it,SG(_e)};var Jq=(_e,rt)=>{if(YA(_e)||rt>mG||rt<0)return _e?D0(_e,G_):G_;const it=_e.state;if(!_e.output||_e.avail_in!==0&&!_e.input||it.status===zA&&rt!==Mm)return D0(_e,_e.avail_out===0?sP:G_);const ct=it.last_flush;if(it.last_flush=rt,it.pending!==0){if(rm(_e),_e.avail_out===0)return it.last_flush=-1,Qu}else if(_e.avail_in===0&&_G(rt)<=_G(ct)&&rt!==Mm)return D0(_e,sP);if(it.status===zA&&_e.avail_in!==0)return D0(_e,sP);if(it.status===KS&&it.wrap===0&&(it.status=N0),it.status===KS){let ut=_1+(it.w_bits-8<<4)<<8,pt=-1;if(pt=it.strategy>=g1||it.level<2?0:it.level<6?1:it.level===6?2:3,ut|=pt<<6,it.strstart!==0&&(ut|=32),ut+=31-ut%31,WA(it,ut),it.strstart!==0&&(WA(it,_e.adler>>>16),WA(it,65535&_e.adler)),_e.adler=1,it.status=N0,rm(_e),it.pending!==0)return it.last_flush=-1,Qu}if(it.status===57){if(_e.adler=0,Ys(it,31),Ys(it,139),Ys(it,8),it.gzhead)Ys(it,(it.gzhead.text?1:0)+(it.gzhead.hcrc?2:0)+(it.gzhead.extra?4:0)+(it.gzhead.name?8:0)+(it.gzhead.comment?16:0)),Ys(it,255&it.gzhead.time),Ys(it,it.gzhead.time>>8&255),Ys(it,it.gzhead.time>>16&255),Ys(it,it.gzhead.time>>24&255),Ys(it,it.level===9?2:it.strategy>=g1||it.level<2?4:0),Ys(it,255&it.gzhead.os),it.gzhead.extra&&it.gzhead.extra.length&&(Ys(it,255&it.gzhead.extra.length),Ys(it,it.gzhead.extra.length>>8&255)),it.gzhead.hcrc&&(_e.adler=Hu(_e.adler,it.pending_buf,it.pending,0)),it.gzindex=0,it.status=69;else if(Ys(it,0),Ys(it,0),Ys(it,0),Ys(it,0),Ys(it,0),Ys(it,it.level===9?2:it.strategy>=g1||it.level<2?4:0),Ys(it,3),it.status=N0,rm(_e),it.pending!==0)return it.last_flush=-1,Qu}if(it.status===69){if(it.gzhead.extra){let ut=it.pending,pt=(65535&it.gzhead.extra.length)-it.gzindex;for(;it.pending+pt>it.pending_buf_size;){let _t=it.pending_buf_size-it.pending;if(it.pending_buf.set(it.gzhead.extra.subarray(it.gzindex,it.gzindex+_t),it.pending),it.pending=it.pending_buf_size,it.gzhead.hcrc&&it.pending>ut&&(_e.adler=Hu(_e.adler,it.pending_buf,it.pending-ut,ut)),it.gzindex+=_t,rm(_e),it.pending!==0)return it.last_flush=-1,Qu;ut=0,pt-=_t}let mt=new Uint8Array(it.gzhead.extra);it.pending_buf.set(mt.subarray(it.gzindex,it.gzindex+pt),it.pending),it.pending+=pt,it.gzhead.hcrc&&it.pending>ut&&(_e.adler=Hu(_e.adler,it.pending_buf,it.pending-ut,ut)),it.gzindex=0}it.status=73}if(it.status===73){if(it.gzhead.name){let ut,pt=it.pending;do{if(it.pending===it.pending_buf_size){if(it.gzhead.hcrc&&it.pending>pt&&(_e.adler=Hu(_e.adler,it.pending_buf,it.pending-pt,pt)),rm(_e),it.pending!==0)return it.last_flush=-1,Qu;pt=0}ut=it.gzindex<it.gzhead.name.length?255&it.gzhead.name.charCodeAt(it.gzindex++):0,Ys(it,ut)}while(ut!==0);it.gzhead.hcrc&&it.pending>pt&&(_e.adler=Hu(_e.adler,it.pending_buf,it.pending-pt,pt)),it.gzindex=0}it.status=91}if(it.status===91){if(it.gzhead.comment){let ut,pt=it.pending;do{if(it.pending===it.pending_buf_size){if(it.gzhead.hcrc&&it.pending>pt&&(_e.adler=Hu(_e.adler,it.pending_buf,it.pending-pt,pt)),rm(_e),it.pending!==0)return it.last_flush=-1,Qu;pt=0}ut=it.gzindex<it.gzhead.comment.length?255&it.gzhead.comment.charCodeAt(it.gzindex++):0,Ys(it,ut)}while(ut!==0);it.gzhead.hcrc&&it.pending>pt&&(_e.adler=Hu(_e.adler,it.pending_buf,it.pending-pt,pt))}it.status=103}if(it.status===103){if(it.gzhead.hcrc){if(it.pending+2>it.pending_buf_size&&(rm(_e),it.pending!==0))return it.last_flush=-1,Qu;Ys(it,255&_e.adler),Ys(it,_e.adler>>8&255),_e.adler=0}if(it.status=N0,rm(_e),it.pending!==0)return it.last_flush=-1,Qu}if(_e.avail_in!==0||it.lookahead!==0||rt!==Ev&&it.status!==zA){let ut=it.level===0?vG(it,rt):it.strategy===g1?((pt,mt)=>{let _t;for(;;){if(pt.lookahead===0&&(YS(pt),pt.lookahead===0)){if(mt===Ev)return 1;break}if(pt.match_length=0,_t=_v(pt,0,pt.window[pt.strstart]),pt.lookahead--,pt.strstart++,_t&&(im(pt,!1),pt.strm.avail_out===0))return 1}return pt.insert=0,mt===Mm?(im(pt,!0),pt.strm.avail_out===0?3:4):pt.sym_next&&(im(pt,!1),pt.strm.avail_out===0)?1:2})(it,rt):it.strategy===Gq?((pt,mt)=>{let _t,vt,Tt,bt;const Ot=pt.window;for(;;){if(pt.lookahead<=P0){if(YS(pt),pt.lookahead<=P0&&mt===Ev)return 1;if(pt.lookahead===0)break}if(pt.match_length=0,pt.lookahead>=3&&pt.strstart>0&&(Tt=pt.strstart-1,vt=Ot[Tt],vt===Ot[++Tt]&&vt===Ot[++Tt]&&vt===Ot[++Tt])){bt=pt.strstart+P0;do;while(vt===Ot[++Tt]&&vt===Ot[++Tt]&&vt===Ot[++Tt]&&vt===Ot[++Tt]&&vt===Ot[++Tt]&&vt===Ot[++Tt]&&vt===Ot[++Tt]&&vt===Ot[++Tt]&&Tt<bt);pt.match_length=P0-(bt-Tt),pt.match_length>pt.lookahead&&(pt.match_length=pt.lookahead)}if(pt.match_length>=3?(_t=_v(pt,1,pt.match_length-3),pt.lookahead-=pt.match_length,pt.strstart+=pt.match_length,pt.match_length=0):(_t=_v(pt,0,pt.window[pt.strstart]),pt.lookahead--,pt.strstart++),_t&&(im(pt,!1),pt.strm.avail_out===0))return 1}return pt.insert=0,mt===Mm?(im(pt,!0),pt.strm.avail_out===0?3:4):pt.sym_next&&(im(pt,!1),pt.strm.avail_out===0)?1:2})(it,rt):KA[it.level].func(it,rt);if(ut!==3&&ut!==4||(it.status=zA),ut===1||ut===3)return _e.avail_out===0&&(it.last_flush=-1),Qu;if(ut===2&&(rt===kq?Lq(it):rt!==mG&&(oP(it,0,0,!1),rt===Uq&&(vv(it.head),it.lookahead===0&&(it.strstart=0,it.block_start=0,it.insert=0))),rm(_e),_e.avail_out===0))return it.last_flush=-1,Qu}return rt!==Mm?Qu:it.wrap<=0?gG:(it.wrap===2?(Ys(it,255&_e.adler),Ys(it,_e.adler>>8&255),Ys(it,_e.adler>>16&255),Ys(it,_e.adler>>24&255),Ys(it,255&_e.total_in),Ys(it,_e.total_in>>8&255),Ys(it,_e.total_in>>16&255),Ys(it,_e.total_in>>24&255)):(WA(it,_e.adler>>>16),WA(it,65535&_e.adler)),rm(_e),it.wrap>0&&(it.wrap=-it.wrap),it.pending!==0?Qu:gG)},Zq=(_e,rt)=>{let it=rt.length;if(YA(_e))return G_;const ct=_e.state,ut=ct.wrap;if(ut===2||ut===1&&ct.status!==KS||ct.lookahead)return G_;if(ut===1&&(_e.adler=jA(_e.adler,rt,it,0)),ct.wrap=0,it>=ct.w_size){ut===0&&(vv(ct.head),ct.strstart=0,ct.block_start=0,ct.insert=0);let vt=new Uint8Array(ct.w_size);vt.set(rt.subarray(it-ct.w_size,it),0),rt=vt,it=ct.w_size}const pt=_e.avail_in,mt=_e.next_in,_t=_e.input;for(_e.avail_in=it,_e.next_in=0,_e.input=rt,YS(ct);ct.lookahead>=3;){let vt=ct.strstart,Tt=ct.lookahead-2;do ct.ins_h=yv(ct,ct.ins_h,ct.window[vt+3-1]),ct.prev[vt&ct.w_mask]=ct.head[ct.ins_h],ct.head[ct.ins_h]=vt,vt++;while(--Tt);ct.strstart=vt,ct.lookahead=2,YS(ct)}return ct.strstart+=ct.lookahead,ct.block_start=ct.strstart,ct.insert=ct.lookahead,ct.lookahead=0,ct.match_length=ct.prev_length=2,ct.match_available=0,_e.next_in=mt,_e.input=_t,_e.avail_in=pt,ct.wrap=ut,Qu},XA={deflateInit:(_e,rt)=>TG(_e,rt,_1,15,8,Hq),deflateInit2:TG,deflateReset:SG,deflateResetKeep:yG,deflateSetHeader:(_e,rt)=>YA(_e)||_e.state.wrap!==2?G_:(_e.state.gzhead=rt,Qu),deflate:Jq,deflateEnd:_e=>{if(YA(_e))return G_;const rt=_e.state.status;return _e.state=null,rt===N0?D0(_e,Bq):Qu},deflateSetDictionary:Zq,deflateInfo:"pako deflate (from Nodeca project)"};const Qq=(_e,rt)=>Object.prototype.hasOwnProperty.call(_e,rt);var E1={assign:function(_e){const rt=Array.prototype.slice.call(arguments,1);for(;rt.length;){const it=rt.shift();if(it){if(typeof it!="object")throw new TypeError(it+"must be non-object");for(const ct in it)Qq(it,ct)&&(_e[ct]=it[ct])}}return _e},flattenChunks:_e=>{let rt=0;for(let ct=0,ut=_e.length;ct<ut;ct++)rt+=_e[ct].length;const it=new Uint8Array(rt);for(let ct=0,ut=0,pt=_e.length;ct<pt;ct++){let mt=_e[ct];it.set(mt,ut),ut+=mt.length}return it}};let AG=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{AG=!1}const qA=new Uint8Array(256);for(let _e=0;_e<256;_e++)qA[_e]=_e>=252?6:_e>=248?5:_e>=240?4:_e>=224?3:_e>=192?2:1;qA[254]=qA[254]=1;var JA={string2buf:_e=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(_e);let rt,it,ct,ut,pt,mt=_e.length,_t=0;for(ut=0;ut<mt;ut++)it=_e.charCodeAt(ut),(64512&it)==55296&&ut+1<mt&&(ct=_e.charCodeAt(ut+1),(64512&ct)==56320&&(it=65536+(it-55296<<10)+(ct-56320),ut++)),_t+=it<128?1:it<2048?2:it<65536?3:4;for(rt=new Uint8Array(_t),pt=0,ut=0;pt<_t;ut++)it=_e.charCodeAt(ut),(64512&it)==55296&&ut+1<mt&&(ct=_e.charCodeAt(ut+1),(64512&ct)==56320&&(it=65536+(it-55296<<10)+(ct-56320),ut++)),it<128?rt[pt++]=it:it<2048?(rt[pt++]=192|it>>>6,rt[pt++]=128|63&it):it<65536?(rt[pt++]=224|it>>>12,rt[pt++]=128|it>>>6&63,rt[pt++]=128|63&it):(rt[pt++]=240|it>>>18,rt[pt++]=128|it>>>12&63,rt[pt++]=128|it>>>6&63,rt[pt++]=128|63&it);return rt},buf2string:(_e,rt)=>{const it=rt||_e.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(_e.subarray(0,rt));let ct,ut;const pt=new Array(2*it);for(ut=0,ct=0;ct<it;){let mt=_e[ct++];if(mt<128){pt[ut++]=mt;continue}let _t=qA[mt];if(_t>4)pt[ut++]=65533,ct+=_t-1;else{for(mt&=_t===2?31:_t===3?15:7;_t>1&&ct<it;)mt=mt<<6|63&_e[ct++],_t--;_t>1?pt[ut++]=65533:mt<65536?pt[ut++]=mt:(mt-=65536,pt[ut++]=55296|mt>>10&1023,pt[ut++]=56320|1023&mt)}}return((mt,_t)=>{if(_t<65534&&mt.subarray&&AG)return String.fromCharCode.apply(null,mt.length===_t?mt:mt.subarray(0,_t));let vt="";for(let Tt=0;Tt<_t;Tt++)vt+=String.fromCharCode(mt[Tt]);return vt})(pt,ut)},utf8border:(_e,rt)=>{(rt=rt||_e.length)>_e.length&&(rt=_e.length);let it=rt-1;for(;it>=0&&(192&_e[it])==128;)it--;return it<0||it===0?rt:it+qA[_e[it]]>rt?it:rt}},CG=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const bG=Object.prototype.toString,{Z_NO_FLUSH:eJ,Z_SYNC_FLUSH:tJ,Z_FULL_FLUSH:nJ,Z_FINISH:rJ,Z_OK:v1,Z_STREAM_END:iJ,Z_DEFAULT_COMPRESSION:oJ,Z_DEFAULT_STRATEGY:sJ,Z_DEFLATED:aJ}=WS;function ZA(_e){this.options=E1.assign({level:oJ,method:aJ,chunkSize:16384,windowBits:15,memLevel:8,strategy:sJ},_e||{});let rt=this.options;rt.raw&&rt.windowBits>0?rt.windowBits=-rt.windowBits:rt.gzip&&rt.windowBits>0&&rt.windowBits<16&&(rt.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new CG,this.strm.avail_out=0;let it=XA.deflateInit2(this.strm,rt.level,rt.method,rt.windowBits,rt.memLevel,rt.strategy);if(it!==v1)throw new Error(M0[it]);if(rt.header&&XA.deflateSetHeader(this.strm,rt.header),rt.dictionary){let ct;if(ct=typeof rt.dictionary=="string"?JA.string2buf(rt.dictionary):bG.call(rt.dictionary)==="[object ArrayBuffer]"?new Uint8Array(rt.dictionary):rt.dictionary,it=XA.deflateSetDictionary(this.strm,ct),it!==v1)throw new Error(M0[it]);this._dict_set=!0}}function uP(_e,rt){const it=new ZA(rt);if(it.push(_e,!0),it.err)throw it.msg||M0[it.err];return it.result}ZA.prototype.push=function(_e,rt){const it=this.strm,ct=this.options.chunkSize;let ut,pt;if(this.ended)return!1;for(pt=rt===~~rt?rt:rt===!0?rJ:eJ,typeof _e=="string"?it.input=JA.string2buf(_e):bG.call(_e)==="[object ArrayBuffer]"?it.input=new Uint8Array(_e):it.input=_e,it.next_in=0,it.avail_in=it.input.length;;)if(it.avail_out===0&&(it.output=new Uint8Array(ct),it.next_out=0,it.avail_out=ct),(pt===tJ||pt===nJ)&&it.avail_out<=6)this.onData(it.output.subarray(0,it.next_out)),it.avail_out=0;else{if(ut=XA.deflate(it,pt),ut===iJ)return it.next_out>0&&this.onData(it.output.subarray(0,it.next_out)),ut=XA.deflateEnd(this.strm),this.onEnd(ut),this.ended=!0,ut===v1;if(it.avail_out!==0){if(pt>0&&it.next_out>0)this.onData(it.output.subarray(0,it.next_out)),it.avail_out=0;else if(it.avail_in===0)break}else this.onData(it.output)}return!0},ZA.prototype.onData=function(_e){this.chunks.push(_e)},ZA.prototype.onEnd=function(_e){_e===v1&&(this.result=E1.flattenChunks(this.chunks)),this.chunks=[],this.err=_e,this.msg=this.strm.msg};var cJ={Deflate:ZA,deflate:uP,deflateRaw:function(_e,rt){return(rt=rt||{}).raw=!0,uP(_e,rt)},gzip:function(_e,rt){return(rt=rt||{}).gzip=!0,uP(_e,rt)},constants:WS};const y1=16209;var lJ=function(_e,rt){let it,ct,ut,pt,mt,_t,vt,Tt,bt,Ot,Mt,Dt,jt,$t,Ht,en,Qt,on,Tn,vn,hn,Ln,Xn,Qn;const ur=_e.state;it=_e.next_in,Xn=_e.input,ct=it+(_e.avail_in-5),ut=_e.next_out,Qn=_e.output,pt=ut-(rt-_e.avail_out),mt=ut+(_e.avail_out-257),_t=ur.dmax,vt=ur.wsize,Tt=ur.whave,bt=ur.wnext,Ot=ur.window,Mt=ur.hold,Dt=ur.bits,jt=ur.lencode,$t=ur.distcode,Ht=(1<<ur.lenbits)-1,en=(1<<ur.distbits)-1;e:do{Dt<15&&(Mt+=Xn[it++]<<Dt,Dt+=8,Mt+=Xn[it++]<<Dt,Dt+=8),Qt=jt[Mt&Ht];t:for(;;){if(on=Qt>>>24,Mt>>>=on,Dt-=on,on=Qt>>>16&255,on===0)Qn[ut++]=65535&Qt;else{if(!(16&on)){if(!(64&on)){Qt=jt[(65535&Qt)+(Mt&(1<<on)-1)];continue t}if(32&on){ur.mode=16191;break e}_e.msg="invalid literal/length code",ur.mode=y1;break e}Tn=65535&Qt,on&=15,on&&(Dt<on&&(Mt+=Xn[it++]<<Dt,Dt+=8),Tn+=Mt&(1<<on)-1,Mt>>>=on,Dt-=on),Dt<15&&(Mt+=Xn[it++]<<Dt,Dt+=8,Mt+=Xn[it++]<<Dt,Dt+=8),Qt=$t[Mt&en];n:for(;;){if(on=Qt>>>24,Mt>>>=on,Dt-=on,on=Qt>>>16&255,!(16&on)){if(!(64&on)){Qt=$t[(65535&Qt)+(Mt&(1<<on)-1)];continue n}_e.msg="invalid distance code",ur.mode=y1;break e}if(vn=65535&Qt,on&=15,Dt<on&&(Mt+=Xn[it++]<<Dt,Dt+=8,Dt<on&&(Mt+=Xn[it++]<<Dt,Dt+=8)),vn+=Mt&(1<<on)-1,vn>_t){_e.msg="invalid distance too far back",ur.mode=y1;break e}if(Mt>>>=on,Dt-=on,on=ut-pt,vn>on){if(on=vn-on,on>Tt&&ur.sane){_e.msg="invalid distance too far back",ur.mode=y1;break e}if(hn=0,Ln=Ot,bt===0){if(hn+=vt-on,on<Tn){Tn-=on;do Qn[ut++]=Ot[hn++];while(--on);hn=ut-vn,Ln=Qn}}else if(bt<on){if(hn+=vt+bt-on,on-=bt,on<Tn){Tn-=on;do Qn[ut++]=Ot[hn++];while(--on);if(hn=0,bt<Tn){on=bt,Tn-=on;do Qn[ut++]=Ot[hn++];while(--on);hn=ut-vn,Ln=Qn}}}else if(hn+=bt-on,on<Tn){Tn-=on;do Qn[ut++]=Ot[hn++];while(--on);hn=ut-vn,Ln=Qn}for(;Tn>2;)Qn[ut++]=Ln[hn++],Qn[ut++]=Ln[hn++],Qn[ut++]=Ln[hn++],Tn-=3;Tn&&(Qn[ut++]=Ln[hn++],Tn>1&&(Qn[ut++]=Ln[hn++]))}else{hn=ut-vn;do Qn[ut++]=Qn[hn++],Qn[ut++]=Qn[hn++],Qn[ut++]=Qn[hn++],Tn-=3;while(Tn>2);Tn&&(Qn[ut++]=Qn[hn++],Tn>1&&(Qn[ut++]=Qn[hn++]))}break}}break}}while(it<ct&&ut<mt);Tn=Dt>>3,it-=Tn,Dt-=Tn<<3,Mt&=(1<<Dt)-1,_e.next_in=it,_e.next_out=ut,_e.avail_in=it<ct?ct-it+5:5-(it-ct),_e.avail_out=ut<mt?mt-ut+257:257-(ut-mt),ur.hold=Mt,ur.bits=Dt};const S1=15,uJ=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),dJ=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),hJ=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),pJ=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var QA=(_e,rt,it,ct,ut,pt,mt,_t)=>{const vt=_t.bits;let Tt,bt,Ot,Mt,Dt,jt,$t=0,Ht=0,en=0,Qt=0,on=0,Tn=0,vn=0,hn=0,Ln=0,Xn=0,Qn=null;const ur=new Uint16Array(16),go=new Uint16Array(16);let Eo,no,Yo,jo=null;for($t=0;$t<=S1;$t++)ur[$t]=0;for(Ht=0;Ht<ct;Ht++)ur[rt[it+Ht]]++;for(on=vt,Qt=S1;Qt>=1&&ur[Qt]===0;Qt--);if(on>Qt&&(on=Qt),Qt===0)return ut[pt++]=20971520,ut[pt++]=20971520,_t.bits=1,0;for(en=1;en<Qt&&ur[en]===0;en++);for(on<en&&(on=en),hn=1,$t=1;$t<=S1;$t++)if(hn<<=1,hn-=ur[$t],hn<0)return-1;if(hn>0&&(_e===0||Qt!==1))return-1;for(go[1]=0,$t=1;$t<S1;$t++)go[$t+1]=go[$t]+ur[$t];for(Ht=0;Ht<ct;Ht++)rt[it+Ht]!==0&&(mt[go[rt[it+Ht]]++]=Ht);if(_e===0?(Qn=jo=mt,jt=20):_e===1?(Qn=uJ,jo=dJ,jt=257):(Qn=hJ,jo=pJ,jt=0),Xn=0,Ht=0,$t=en,Dt=pt,Tn=on,vn=0,Ot=-1,Ln=1<<on,Mt=Ln-1,_e===1&&Ln>852||_e===2&&Ln>592)return 1;for(;;){Eo=$t-vn,mt[Ht]+1<jt?(no=0,Yo=mt[Ht]):mt[Ht]>=jt?(no=jo[mt[Ht]-jt],Yo=Qn[mt[Ht]-jt]):(no=96,Yo=0),Tt=1<<$t-vn,bt=1<<Tn,en=bt;do bt-=Tt,ut[Dt+(Xn>>vn)+bt]=Eo<<24|no<<16|Yo|0;while(bt!==0);for(Tt=1<<$t-1;Xn&Tt;)Tt>>=1;if(Tt!==0?(Xn&=Tt-1,Xn+=Tt):Xn=0,Ht++,--ur[$t]==0){if($t===Qt)break;$t=rt[it+mt[Ht]]}if($t>on&&(Xn&Mt)!==Ot){for(vn===0&&(vn=on),Dt+=en,Tn=$t-vn,hn=1<<Tn;Tn+vn<Qt&&(hn-=ur[Tn+vn],!(hn<=0));)Tn++,hn<<=1;if(Ln+=1<<Tn,_e===1&&Ln>852||_e===2&&Ln>592)return 1;Ot=Xn&Mt,ut[Ot]=on<<24|Tn<<16|Dt-pt|0}}return Xn!==0&&(ut[Dt+Xn]=$t-vn<<24|64<<16|0),_t.bits=on,0};const{Z_FINISH:RG,Z_BLOCK:fJ,Z_TREES:T1,Z_OK:L0,Z_STREAM_END:mJ,Z_NEED_DICT:gJ,Z_STREAM_ERROR:Pm,Z_DATA_ERROR:wG,Z_MEM_ERROR:IG,Z_BUF_ERROR:_J,Z_DEFLATED:xG}=WS,A1=16180,C1=16190,vE=16191,dP=16192,hP=16194,b1=16199,R1=16200,pP=16206,Fl=16209,OG=_e=>(_e>>>24&255)+(_e>>>8&65280)+((65280&_e)<<8)+((255&_e)<<24);function EJ(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const k0=_e=>{if(!_e)return 1;const rt=_e.state;return!rt||rt.strm!==_e||rt.mode<A1||rt.mode>16211?1:0},MG=_e=>{if(k0(_e))return Pm;const rt=_e.state;return _e.total_in=_e.total_out=rt.total=0,_e.msg="",rt.wrap&&(_e.adler=1&rt.wrap),rt.mode=A1,rt.last=0,rt.havedict=0,rt.flags=-1,rt.dmax=32768,rt.head=null,rt.hold=0,rt.bits=0,rt.lencode=rt.lendyn=new Int32Array(852),rt.distcode=rt.distdyn=new Int32Array(592),rt.sane=1,rt.back=-1,L0},PG=_e=>{if(k0(_e))return Pm;const rt=_e.state;return rt.wsize=0,rt.whave=0,rt.wnext=0,MG(_e)},NG=(_e,rt)=>{let it;if(k0(_e))return Pm;const ct=_e.state;return rt<0?(it=0,rt=-rt):(it=5+(rt>>4),rt<48&&(rt&=15)),rt&&(rt<8||rt>15)?Pm:(ct.window!==null&&ct.wbits!==rt&&(ct.window=null),ct.wrap=it,ct.wbits=rt,PG(_e))},DG=(_e,rt)=>{if(!_e)return Pm;const it=new EJ;_e.state=it,it.strm=_e,it.window=null,it.mode=A1;const ct=NG(_e,rt);return ct!==L0&&(_e.state=null),ct};let fP,mP,LG=!0;const vJ=_e=>{if(LG){fP=new Int32Array(512),mP=new Int32Array(32);let rt=0;for(;rt<144;)_e.lens[rt++]=8;for(;rt<256;)_e.lens[rt++]=9;for(;rt<280;)_e.lens[rt++]=7;for(;rt<288;)_e.lens[rt++]=8;for(QA(1,_e.lens,0,288,fP,0,_e.work,{bits:9}),rt=0;rt<32;)_e.lens[rt++]=5;QA(2,_e.lens,0,32,mP,0,_e.work,{bits:5}),LG=!1}_e.lencode=fP,_e.lenbits=9,_e.distcode=mP,_e.distbits=5},kG=(_e,rt,it,ct)=>{let ut;const pt=_e.state;return pt.window===null&&(pt.wsize=1<<pt.wbits,pt.wnext=0,pt.whave=0,pt.window=new Uint8Array(pt.wsize)),ct>=pt.wsize?(pt.window.set(rt.subarray(it-pt.wsize,it),0),pt.wnext=0,pt.whave=pt.wsize):(ut=pt.wsize-pt.wnext,ut>ct&&(ut=ct),pt.window.set(rt.subarray(it-ct,it-ct+ut),pt.wnext),(ct-=ut)?(pt.window.set(rt.subarray(it-ct,it),0),pt.wnext=ct,pt.whave=pt.wsize):(pt.wnext+=ut,pt.wnext===pt.wsize&&(pt.wnext=0),pt.whave<pt.wsize&&(pt.whave+=ut))),0};var yJ=(_e,rt)=>{let it,ct,ut,pt,mt,_t,vt,Tt,bt,Ot,Mt,Dt,jt,$t,Ht,en,Qt,on,Tn,vn,hn,Ln,Xn=0;const Qn=new Uint8Array(4);let ur,go;const Eo=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(k0(_e)||!_e.output||!_e.input&&_e.avail_in!==0)return Pm;it=_e.state,it.mode===vE&&(it.mode=dP),mt=_e.next_out,ut=_e.output,vt=_e.avail_out,pt=_e.next_in,ct=_e.input,_t=_e.avail_in,Tt=it.hold,bt=it.bits,Ot=_t,Mt=vt,Ln=L0;e:for(;;)switch(it.mode){case A1:if(it.wrap===0){it.mode=dP;break}for(;bt<16;){if(_t===0)break e;_t--,Tt+=ct[pt++]<<bt,bt+=8}if(2&it.wrap&&Tt===35615){it.wbits===0&&(it.wbits=15),it.check=0,Qn[0]=255&Tt,Qn[1]=Tt>>>8&255,it.check=Hu(it.check,Qn,2,0),Tt=0,bt=0,it.mode=16181;break}if(it.head&&(it.head.done=!1),!(1&it.wrap)||(((255&Tt)<<8)+(Tt>>8))%31){_e.msg="incorrect header check",it.mode=Fl;break}if((15&Tt)!==xG){_e.msg="unknown compression method",it.mode=Fl;break}if(Tt>>>=4,bt-=4,hn=8+(15&Tt),it.wbits===0&&(it.wbits=hn),hn>15||hn>it.wbits){_e.msg="invalid window size",it.mode=Fl;break}it.dmax=1<<it.wbits,it.flags=0,_e.adler=it.check=1,it.mode=512&Tt?16189:vE,Tt=0,bt=0;break;case 16181:for(;bt<16;){if(_t===0)break e;_t--,Tt+=ct[pt++]<<bt,bt+=8}if(it.flags=Tt,(255&Ou(it))!==xG){_e.msg="unknown compression method",it.mode=Fl;break}if(57344&Ou(it)){_e.msg="unknown header flags set",it.mode=Fl;break}it.head&&(it.head.text=Tt>>8&1),512&Ou(it)&&4&it.wrap&&(Qn[0]=255&Tt,Qn[1]=Tt>>>8&255,it.check=Hu(it.check,Qn,2,0)),Tt=0,bt=0,it.mode=16182;case 16182:for(;bt<32;){if(_t===0)break e;_t--,Tt+=ct[pt++]<<bt,bt+=8}it.head&&(it.head.time=Tt),512&Ou(it)&&4&it.wrap&&(Qn[0]=255&Tt,Qn[1]=Tt>>>8&255,Qn[2]=Tt>>>16&255,Qn[3]=Tt>>>24&255,it.check=Hu(it.check,Qn,4,0)),Tt=0,bt=0,it.mode=16183;case 16183:for(;bt<16;){if(_t===0)break e;_t--,Tt+=ct[pt++]<<bt,bt+=8}it.head&&(it.head.xflags=255&Tt,it.head.os=Tt>>8),512&Ou(it)&&4&it.wrap&&(Qn[0]=255&Tt,Qn[1]=Tt>>>8&255,it.check=Hu(it.check,Qn,2,0)),Tt=0,bt=0,it.mode=16184;case 16184:if(1024&Ou(it)){for(;bt<16;){if(_t===0)break e;_t--,Tt+=ct[pt++]<<bt,bt+=8}it.length=Tt,it.head&&(it.head.extra_len=Tt),512&Ou(it)&&4&it.wrap&&(Qn[0]=255&Tt,Qn[1]=Tt>>>8&255,it.check=Hu(it.check,Qn,2,0)),Tt=0,bt=0}else it.head&&(it.head.extra=null);it.mode=16185;case 16185:if(1024&Ou(it)&&(Dt=it.length,Dt>_t&&(Dt=_t),Dt&&(it.head&&(hn=it.head.extra_len-it.length,it.head.extra||(it.head.extra=new Uint8Array(it.head.extra_len)),it.head.extra.set(ct.subarray(pt,pt+Dt),hn)),512&Ou(it)&&4&it.wrap&&(it.check=Hu(it.check,ct,Dt,pt)),_t-=Dt,pt+=Dt,it.length-=Dt),it.length))break e;it.length=0,it.mode=16186;case 16186:if(2048&Ou(it)){if(_t===0)break e;Dt=0;do hn=ct[pt+Dt++],it.head&&hn&&it.length<65536&&(it.head.name+=String.fromCharCode(hn));while(hn&&Dt<_t);if(512&Ou(it)&&4&it.wrap&&(it.check=Hu(it.check,ct,Dt,pt)),_t-=Dt,pt+=Dt,hn)break e}else it.head&&(it.head.name=null);it.length=0,it.mode=16187;case 16187:if(4096&Ou(it)){if(_t===0)break e;Dt=0;do hn=ct[pt+Dt++],it.head&&hn&&it.length<65536&&(it.head.comment+=String.fromCharCode(hn));while(hn&&Dt<_t);if(512&Ou(it)&&4&it.wrap&&(it.check=Hu(it.check,ct,Dt,pt)),_t-=Dt,pt+=Dt,hn)break e}else it.head&&(it.head.comment=null);it.mode=16188;case 16188:if(512&Ou(it)){for(;bt<16;){if(_t===0)break e;_t--,Tt+=ct[pt++]<<bt,bt+=8}if(4&it.wrap&&Tt!==(65535&it.check)){_e.msg="header crc mismatch",it.mode=Fl;break}Tt=0,bt=0}it.head&&(it.head.hcrc=Ou(it)>>9&1,it.head.done=!0),_e.adler=it.check=0,it.mode=vE;break;case 16189:for(;bt<32;){if(_t===0)break e;_t--,Tt+=ct[pt++]<<bt,bt+=8}_e.adler=it.check=OG(Tt),Tt=0,bt=0,it.mode=C1;case C1:if(it.havedict===0)return _e.next_out=mt,_e.avail_out=vt,_e.next_in=pt,_e.avail_in=_t,it.hold=Tt,it.bits=bt,gJ;_e.adler=it.check=1,it.mode=vE;case vE:if(rt===fJ||rt===T1)break e;case dP:if(it.last){Tt>>>=7&bt,bt-=7&bt,it.mode=pP;break}for(;bt<3;){if(_t===0)break e;_t--,Tt+=ct[pt++]<<bt,bt+=8}switch(it.last=1&Tt,Tt>>>=1,bt-=1,3&Tt){case 0:it.mode=16193;break;case 1:if(vJ(it),it.mode=b1,rt===T1){Tt>>>=2,bt-=2;break e}break;case 2:it.mode=16196;break;case 3:_e.msg="invalid block type",it.mode=Fl}Tt>>>=2,bt-=2;break;case 16193:for(Tt>>>=7&bt,bt-=7&bt;bt<32;){if(_t===0)break e;_t--,Tt+=ct[pt++]<<bt,bt+=8}if((65535&Tt)!=(Tt>>>16^65535)){_e.msg="invalid stored block lengths",it.mode=Fl;break}if(it.length=65535&Tt,Tt=0,bt=0,it.mode=hP,rt===T1)break e;case hP:it.mode=16195;case 16195:if(Dt=it.length,Dt){if(Dt>_t&&(Dt=_t),Dt>vt&&(Dt=vt),Dt===0)break e;ut.set(ct.subarray(pt,pt+Dt),mt),_t-=Dt,pt+=Dt,vt-=Dt,mt+=Dt,it.length-=Dt;break}it.mode=vE;break;case 16196:for(;bt<14;){if(_t===0)break e;_t--,Tt+=ct[pt++]<<bt,bt+=8}if(it.nlen=257+(31&Tt),Tt>>>=5,bt-=5,it.ndist=1+(31&Tt),Tt>>>=5,bt-=5,it.ncode=4+(15&Tt),Tt>>>=4,bt-=4,it.nlen>286||it.ndist>30){_e.msg="too many length or distance symbols",it.mode=Fl;break}it.have=0,it.mode=16197;case 16197:for(;it.have<it.ncode;){for(;bt<3;){if(_t===0)break e;_t--,Tt+=ct[pt++]<<bt,bt+=8}it.lens[Eo[it.have++]]=7&Tt,Tt>>>=3,bt-=3}for(;it.have<19;)it.lens[Eo[it.have++]]=0;if(it.lencode=it.lendyn,it.lenbits=7,ur={bits:it.lenbits},Ln=QA(0,it.lens,0,19,it.lencode,0,it.work,ur),it.lenbits=ur.bits,Ln){_e.msg="invalid code lengths set",it.mode=Fl;break}it.have=0,it.mode=16198;case 16198:for(;it.have<it.nlen+it.ndist;){for(;Xn=it.lencode[Tt&(1<<it.lenbits)-1],Ht=Xn>>>24,en=Xn>>>16&255,Qt=65535&Xn,!(Ht<=bt);){if(_t===0)break e;_t--,Tt+=ct[pt++]<<bt,bt+=8}if(Qt<16)Tt>>>=Ht,bt-=Ht,it.lens[it.have++]=Qt;else{if(Qt===16){for(go=Ht+2;bt<go;){if(_t===0)break e;_t--,Tt+=ct[pt++]<<bt,bt+=8}if(Tt>>>=Ht,bt-=Ht,it.have===0){_e.msg="invalid bit length repeat",it.mode=Fl;break}hn=it.lens[it.have-1],Dt=3+(3&Tt),Tt>>>=2,bt-=2}else if(Qt===17){for(go=Ht+3;bt<go;){if(_t===0)break e;_t--,Tt+=ct[pt++]<<bt,bt+=8}Tt>>>=Ht,bt-=Ht,hn=0,Dt=3+(7&Tt),Tt>>>=3,bt-=3}else{for(go=Ht+7;bt<go;){if(_t===0)break e;_t--,Tt+=ct[pt++]<<bt,bt+=8}Tt>>>=Ht,bt-=Ht,hn=0,Dt=11+(127&Tt),Tt>>>=7,bt-=7}if(it.have+Dt>it.nlen+it.ndist){_e.msg="invalid bit length repeat",it.mode=Fl;break}for(;Dt--;)it.lens[it.have++]=hn}}if(it.mode===Fl)break;if(it.lens[256]===0){_e.msg="invalid code -- missing end-of-block",it.mode=Fl;break}if(it.lenbits=9,ur={bits:it.lenbits},Ln=QA(1,it.lens,0,it.nlen,it.lencode,0,it.work,ur),it.lenbits=ur.bits,Ln){_e.msg="invalid literal/lengths set",it.mode=Fl;break}if(it.distbits=6,it.distcode=it.distdyn,ur={bits:it.distbits},Ln=QA(2,it.lens,it.nlen,it.ndist,it.distcode,0,it.work,ur),it.distbits=ur.bits,Ln){_e.msg="invalid distances set",it.mode=Fl;break}if(it.mode=b1,rt===T1)break e;case b1:it.mode=R1;case R1:if(_t>=6&&vt>=258){_e.next_out=mt,_e.avail_out=vt,_e.next_in=pt,_e.avail_in=_t,it.hold=Tt,it.bits=bt,lJ(_e,Mt),mt=_e.next_out,ut=_e.output,vt=_e.avail_out,pt=_e.next_in,ct=_e.input,_t=_e.avail_in,Tt=it.hold,bt=it.bits,it.mode===vE&&(it.back=-1);break}for(it.back=0;Xn=it.lencode[Tt&(1<<it.lenbits)-1],Ht=Xn>>>24,en=Xn>>>16&255,Qt=65535&Xn,!(Ht<=bt);){if(_t===0)break e;_t--,Tt+=ct[pt++]<<bt,bt+=8}if(en&&!(240&en)){for(on=Ht,Tn=en,vn=Qt;Xn=it.lencode[vn+((Tt&(1<<on+Tn)-1)>>on)],Ht=Xn>>>24,en=Xn>>>16&255,Qt=65535&Xn,!(on+Ht<=bt);){if(_t===0)break e;_t--,Tt+=ct[pt++]<<bt,bt+=8}Tt>>>=on,bt-=on,it.back+=on}if(Tt>>>=Ht,bt-=Ht,it.back+=Ht,it.length=Qt,en===0){it.mode=16205;break}if(32&en){it.back=-1,it.mode=vE;break}if(64&en){_e.msg="invalid literal/length code",it.mode=Fl;break}it.extra=15&en,it.mode=16201;case 16201:if(it.extra){for(go=it.extra;bt<go;){if(_t===0)break e;_t--,Tt+=ct[pt++]<<bt,bt+=8}it.length+=Tt&(1<<it.extra)-1,Tt>>>=it.extra,bt-=it.extra,it.back+=it.extra}it.was=it.length,it.mode=16202;case 16202:for(;Xn=it.distcode[Tt&(1<<it.distbits)-1],Ht=Xn>>>24,en=Xn>>>16&255,Qt=65535&Xn,!(Ht<=bt);){if(_t===0)break e;_t--,Tt+=ct[pt++]<<bt,bt+=8}if(!(240&en)){for(on=Ht,Tn=en,vn=Qt;Xn=it.distcode[vn+((Tt&(1<<on+Tn)-1)>>on)],Ht=Xn>>>24,en=Xn>>>16&255,Qt=65535&Xn,!(on+Ht<=bt);){if(_t===0)break e;_t--,Tt+=ct[pt++]<<bt,bt+=8}Tt>>>=on,bt-=on,it.back+=on}if(Tt>>>=Ht,bt-=Ht,it.back+=Ht,64&en){_e.msg="invalid distance code",it.mode=Fl;break}it.offset=Qt,it.extra=15&en,it.mode=16203;case 16203:if(it.extra){for(go=it.extra;bt<go;){if(_t===0)break e;_t--,Tt+=ct[pt++]<<bt,bt+=8}it.offset+=Tt&(1<<it.extra)-1,Tt>>>=it.extra,bt-=it.extra,it.back+=it.extra}if(it.offset>it.dmax){_e.msg="invalid distance too far back",it.mode=Fl;break}it.mode=16204;case 16204:if(vt===0)break e;if(Dt=Mt-vt,it.offset>Dt){if(Dt=it.offset-Dt,Dt>it.whave&&it.sane){_e.msg="invalid distance too far back",it.mode=Fl;break}Dt>it.wnext?(Dt-=it.wnext,jt=it.wsize-Dt):jt=it.wnext-Dt,Dt>it.length&&(Dt=it.length),$t=it.window}else $t=ut,jt=mt-it.offset,Dt=it.length;Dt>vt&&(Dt=vt),vt-=Dt,it.length-=Dt;do ut[mt++]=$t[jt++];while(--Dt);it.length===0&&(it.mode=R1);break;case 16205:if(vt===0)break e;ut[mt++]=it.length,vt--,it.mode=R1;break;case pP:if(it.wrap){for(;bt<32;){if(_t===0)break e;_t--,Tt|=ct[pt++]<<bt,bt+=8}if(Mt-=vt,_e.total_out+=Mt,it.total+=Mt,4&it.wrap&&Mt&&(_e.adler=it.check=Ou(it)?Hu(it.check,ut,Mt,mt-Mt):jA(it.check,ut,Mt,mt-Mt)),Mt=vt,4&it.wrap&&(Ou(it)?Tt:OG(Tt))!==it.check){_e.msg="incorrect data check",it.mode=Fl;break}Tt=0,bt=0}it.mode=16207;case 16207:if(it.wrap&&Ou(it)){for(;bt<32;){if(_t===0)break e;_t--,Tt+=ct[pt++]<<bt,bt+=8}if(4&it.wrap&&Tt!==(4294967295&it.total)){_e.msg="incorrect length check",it.mode=Fl;break}Tt=0,bt=0}it.mode=16208;case 16208:Ln=mJ;break e;case Fl:Ln=wG;break e;case 16210:return IG;default:return Pm}return _e.next_out=mt,_e.avail_out=vt,_e.next_in=pt,_e.avail_in=_t,it.hold=Tt,it.bits=bt,(it.wsize||Mt!==_e.avail_out&&it.mode<Fl&&(it.mode<pP||rt!==RG))&&kG(_e,_e.output,_e.next_out,Mt-_e.avail_out),Ot-=_e.avail_in,Mt-=_e.avail_out,_e.total_in+=Ot,_e.total_out+=Mt,it.total+=Mt,4&it.wrap&&Mt&&(_e.adler=it.check=Ou(it)?Hu(it.check,ut,Mt,_e.next_out-Mt):jA(it.check,ut,Mt,_e.next_out-Mt)),_e.data_type=it.bits+(it.last?64:0)+(it.mode===vE?128:0)+(it.mode===b1||it.mode===hP?256:0),(Ot===0&&Mt===0||rt===RG)&&Ln===L0&&(Ln=_J),Ln},yE={inflateReset:PG,inflateReset2:NG,inflateResetKeep:MG,inflateInit:_e=>DG(_e,15),inflateInit2:DG,inflate:yJ,inflateEnd:_e=>{if(k0(_e))return Pm;let rt=_e.state;return rt.window&&(rt.window=null),_e.state=null,L0},inflateGetHeader:(_e,rt)=>{if(k0(_e))return Pm;const it=_e.state;return 2&it.wrap?(it.head=rt,rt.done=!1,L0):Pm},inflateSetDictionary:(_e,rt)=>{const it=rt.length;let ct,ut,pt;return k0(_e)?Pm:(ct=_e.state,ct.wrap!==0&&ct.mode!==C1?Pm:ct.mode===C1&&(ut=1,ut=jA(ut,rt,it,0),ut!==ct.check)?wG:(pt=kG(_e,rt,it,it),pt?(ct.mode=16210,IG):(ct.havedict=1,L0)))},inflateInfo:"pako inflate (from Nodeca project)"},SJ=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const UG=Object.prototype.toString,{Z_NO_FLUSH:TJ,Z_FINISH:AJ,Z_OK:eC,Z_STREAM_END:gP,Z_NEED_DICT:_P,Z_STREAM_ERROR:CJ,Z_DATA_ERROR:BG,Z_MEM_ERROR:bJ}=WS;function tC(_e){this.options=E1.assign({chunkSize:65536,windowBits:15,to:""},_e||{});const rt=this.options;rt.raw&&rt.windowBits>=0&&rt.windowBits<16&&(rt.windowBits=-rt.windowBits,rt.windowBits===0&&(rt.windowBits=-15)),!(rt.windowBits>=0&&rt.windowBits<16)||_e&&_e.windowBits||(rt.windowBits+=32),rt.windowBits>15&&rt.windowBits<48&&!(15&rt.windowBits)&&(rt.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new CG,this.strm.avail_out=0;let it=yE.inflateInit2(this.strm,rt.windowBits);if(it!==eC)throw new Error(M0[it]);if(this.header=new SJ,yE.inflateGetHeader(this.strm,this.header),rt.dictionary&&(typeof rt.dictionary=="string"?rt.dictionary=JA.string2buf(rt.dictionary):UG.call(rt.dictionary)==="[object ArrayBuffer]"&&(rt.dictionary=new Uint8Array(rt.dictionary)),rt.raw&&(it=yE.inflateSetDictionary(this.strm,rt.dictionary),it!==eC)))throw new Error(M0[it])}function EP(_e,rt){const it=new tC(rt);if(it.push(_e),it.err)throw it.msg||M0[it.err];return it.result}tC.prototype.push=function(_e,rt){const it=this.strm,ct=this.options.chunkSize,ut=this.options.dictionary;let pt,mt,_t;if(this.ended)return!1;for(mt=rt===~~rt?rt:rt===!0?AJ:TJ,UG.call(_e)==="[object ArrayBuffer]"?it.input=new Uint8Array(_e):it.input=_e,it.next_in=0,it.avail_in=it.input.length;;){for(it.avail_out===0&&(it.output=new Uint8Array(ct),it.next_out=0,it.avail_out=ct),pt=yE.inflate(it,mt),pt===_P&&ut&&(pt=yE.inflateSetDictionary(it,ut),pt===eC?pt=yE.inflate(it,mt):pt===BG&&(pt=_P));it.avail_in>0&&pt===gP&&it.state.wrap>0&&_e[it.next_in]!==0;)yE.inflateReset(it),pt=yE.inflate(it,mt);switch(pt){case CJ:case BG:case _P:case bJ:return this.onEnd(pt),this.ended=!0,!1}if(_t=it.avail_out,it.next_out&&(it.avail_out===0||pt===gP))if(this.options.to==="string"){let vt=JA.utf8border(it.output,it.next_out),Tt=it.next_out-vt,bt=JA.buf2string(it.output,vt);it.next_out=Tt,it.avail_out=ct-Tt,Tt&&it.output.set(it.output.subarray(vt,vt+Tt),0),this.onData(bt)}else this.onData(it.output.length===it.next_out?it.output:it.output.subarray(0,it.next_out));if(pt!==eC||_t!==0){if(pt===gP)return pt=yE.inflateEnd(this.strm),this.onEnd(pt),this.ended=!0,!0;if(it.avail_in===0)break}}return!0},tC.prototype.onData=function(_e){this.chunks.push(_e)},tC.prototype.onEnd=function(_e){_e===eC&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=E1.flattenChunks(this.chunks)),this.chunks=[],this.err=_e,this.msg=this.strm.msg};var RJ={Inflate:tC,inflate:EP,inflateRaw:function(_e,rt){return(rt=rt||{}).raw=!0,EP(_e,rt)},ungzip:EP,constants:WS};const{Deflate:pZ,deflate:wJ,deflateRaw:fZ,gzip:mZ}=cJ,{Inflate:gZ,inflate:IJ,inflateRaw:_Z,ungzip:EZ}=RJ;var xJ=wJ,OJ=IJ,FG=function(_e){return _e[_e.ONE_BYTE=0]="ONE_BYTE",_e[_e.TWO_BYTE=1]="TWO_BYTE",_e}(FG||{});class MJ{constructor(){Jt(this,"_sequence",0),Jt(this,"_startTime",Date.now()),Jt(this,"isUseOneByte",!0)}get startTime(){const rt=Date.now()-this._startTime;return rt<Math.pow(2,16)?rt:(this._startTime+=Math.pow(2,16),this.startTime)}get sequence(){return this._sequence<Math.pow(2,32)?this._sequence++:(this._sequence-=Math.pow(2,32),this.sequence)}serialize(rt){const it={commonPacketHeader:{length:0,reserved:0,extension:0,sequence:this.sequence},commonStreamHeader:this.startTime,extension:void 0,payload:rt};if(rt.byteLength>128){const _t=new Uint8Array(4);_t.set([1,0,0,0]);const vt={id:0,length:4,data:_t.buffer},Tt={profile:this.isUseOneByte?0:1,length:this.isUseOneByte?5:6,datas:[vt]};it.commonPacketHeader.extension=1,it.extension=Tt,it.payload=this.compress(rt),it.commonPacketHeader.length=8+(it.extension.length+2)+it.payload.byteLength}else it.commonPacketHeader.length=8+it.payload.byteLength;rn("SHOW_DATASTREAM2_LOG")&&Ut.debug("send data header: ".concat(JSON.stringify(it.commonPacketHeader)));const ct=new ArrayBuffer(it.commonPacketHeader.length),ut=new Uint8Array(ct),pt=new DataView(ct);let mt=0;if(pt.setUint16(mt,it.commonPacketHeader.extension<<15|it.commonPacketHeader.reserved<<14|it.commonPacketHeader.length,!0),mt+=2,pt.setUint32(mt,it.commonPacketHeader.sequence,!0),mt+=4,pt.setUint16(mt,it.commonStreamHeader,!0),mt+=2,it.extension){const _t=this.serializeExtension(it.extension);ut.set(new Uint8Array(_t),mt),mt+=_t.byteLength}if(ut.set(new Uint8Array(it.payload),mt),mt+=it.payload.byteLength,mt!==it.commonPacketHeader.length)throw Error("serialize error!");return ct}deserialize(rt){if(rt.byteLength<4)return new ArrayBuffer(0);const it=new DataView(rt);let ct=0;const ut=it.getUint16(ct,!0);ct+=2;const pt={length:16383&ut,reserved:(16384&ut)>>14,extension:(32768&ut)>>15,sequence:it.getUint16(ct+2,!0)<<16|it.getUint16(ct,!0)};let mt,_t;if(ct+=4,rn("SHOW_DATASTREAM2_LOG")&&Ut.debug("receive data header: ".concat(JSON.stringify(pt))),it.getUint16(ct,!0),ct+=2,pt.extension){_t=this.deserializeExtension(rt.slice(ct)),ct+=2+_t.length,mt=rt.slice(ct);let vt=!1;if(_t.datas.length>0){const Tt=_t.datas.find(bt=>bt.id===0);Tt&&(vt=(1&new DataView(Tt.data).getUint32(0,!0))==1)}mt=vt?this.decompress(mt):mt}else mt=rt.slice(8);return mt}serializeExtension(rt){const{profile:it,length:ct,datas:ut}=rt,pt=new ArrayBuffer(ct+2),mt=new Uint8Array(pt),_t=new DataView(pt);let vt=0;if(_t.setUint8(vt++,it),_t.setUint8(vt++,ct),ut.forEach(Tt=>{it?(_t.setUint8(vt++,Tt.id),_t.setUint8(vt++,Tt.length),mt.set(new Uint8Array(Tt.data),vt),vt+=Tt.data.byteLength):(_t.setUint8(vt++,Tt.id|Tt.length<<4),mt.set(new Uint8Array(Tt.data),vt),vt+=Tt.data.byteLength)}),vt!==ct+2)throw Error("serialize extension error, is ".concat(vt,"!==").concat(ct+2));return pt}deserializeExtension(rt){const it=new DataView(rt);let ct=0;const ut=it.getUint8(ct);ct++;const pt=it.getUint8(ct);ct++;const mt=ut===FG.TWO_BYTE,_t=[],vt=new DataView(rt,2);let Tt=0;for(;Tt<pt;){let bt=0,Ot=0,Mt=new ArrayBuffer(0);mt?(bt=vt.getUint8(Tt),Tt++,Ot=vt.getUint8(Tt),Tt++):(bt=15&vt.getUint8(Tt),Ot=vt.getUint8(Tt)>>4,Tt++),Ot>0&&(Mt=vt.buffer.slice(Tt+2,Tt+2+Ot),Tt+=Mt.byteLength),_t.push({id:bt,length:Ot,data:Mt})}if(Tt!==pt)throw Error("parse error");return{profile:ut,length:pt,datas:_t}}decompress(rt){return OJ(new Uint8Array(rt))}compress(rt){return xJ(new Uint8Array(rt))}}const PJ={name:"DataStream",create:(_e,rt)=>{const it=rt?new GY(_e):new $Y(_e);return it.useDataStream(new MJ),it}};class NJ extends Fs{constructor(rt,it,ct){super(),Jt(this,"ws",void 0),Jt(this,"requestId",1),Jt(this,"heartBeatTimer",void 0),Jt(this,"joinInfo",void 0),Jt(this,"clientId",void 0),Jt(this,"onOpen",()=>{this.emit("open"),this.startHeartBeatCheck()}),Jt(this,"onClose",ut=>{this.emit("close"),this.dispose()}),Jt(this,"onMessage",ut=>{const pt=JSON.parse(ut.data);if(!pt||pt.command!=="serverResponse"||!pt.requestId)return pt&&pt.command==="serverStatus"&&pt.serverStatus&&pt.serverStatus.command?(this.emit("status",pt.serverStatus),void this.emit(pt.serverStatus.command,pt.serverStatus)):void 0;this.emit("req_".concat(pt.requestId),pt)}),this.joinInfo=rt,this.clientId=it,this.ws=new RA("cross-channel-".concat(this.clientId),ct),this.ws.on(ho.RECONNECTING,()=>{this.ws.reconnectMode="retry",this.emit("reconnecting")}),this.ws.on(ho.CONNECTED,this.onOpen),this.ws.on(ho.ON_MESSAGE,this.onMessage),this.ws.on(ho.CLOSED,this.onClose)}isConnect(){return this.ws.state==="connected"}sendMessage(rt){const it=this.requestId++;return rt.requestId=it,rt.seq=it,this.ws.sendMessage(rt),it}waitStatus(rt){return new Ir((it,ct)=>{const ut=window.setTimeout(()=>{ct(new $n(tn.TIMEOUT,"wait status timeout, status: ".concat(rt)))},5e3);this.once(rt,pt=>{window.clearTimeout(ut),pt.state&&pt.state!==0?ct(new $n(tn.CROSS_CHANNEL_WAIT_STATUS_ERROR,"wait status error, status: ".concat(rt))):it(void 0)}),this.once("dispose",()=>{window.clearTimeout(ut),ct(new $n(tn.WS_ABORT))})})}async request(rt){if(this.ws.state==="closed")throw new $n(tn.WS_DISCONNECT);const it=()=>new Ir((mt,_t)=>{this.ws.once(ho.CLOSED,()=>_t(new $n(tn.WS_ABORT))),this.ws.once(ho.CONNECTED,mt)});this.ws.state!=="connected"&&await it();const ct=this.sendMessage(rt),ut=new Ir((mt,_t)=>{const vt=()=>{_t(new $n(tn.WS_ABORT))};this.ws.once(ho.RECONNECTING,vt),this.ws.once(ho.CLOSED,vt),this.once("req_".concat(ct),mt),zl(3e3).then(()=>{this.removeAllListeners("req_".concat(ct)),this.ws.off(ho.RECONNECTING,vt),this.ws.off(ho.CLOSED,vt),_t(new $n(tn.TIMEOUT,"cross channel ws request timeout"))})}),pt=await ut;if(!pt||pt.code!==200)throw new $n(tn.CROSS_CHANNEL_SERVER_ERROR_RESPONSE,"response: ".concat(JSON.stringify(pt)));return pt}async connect(rt){this.ws.removeAllListeners(ho.REQUEST_NEW_URLS),this.ws.on(ho.REQUEST_NEW_URLS,it=>{it(rt)}),await this.ws.init(rt)}dispose(){this.clearHeartBeatCheck(),this.emit("dispose"),this.removeAllListeners(),this.ws.close()}sendPing(rt){const it=this.requestId++;return rt.requestId=it,this.ws.sendMessage(rt),it}startHeartBeatCheck(){this.heartBeatTimer&&window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=window.setInterval(()=>{this.sendPing({command:"ping",appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sid:this.joinInfo.sid,ts:+new Date,requestId:0})},3e3)}clearHeartBeatCheck(){window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=void 0}}class DJ extends Fs{set state(rt){rt!==this._state&&(rt!==ap.RELAY_STATE_FAILURE&&(this.errorCode=MS.RELAY_OK),this.emit("state",rt,this.errorCode),this._state=rt)}get state(){return this._state}constructor(rt,it,ct,ut,pt){super(),Jt(this,"joinInfo",void 0),Jt(this,"sid",void 0),Jt(this,"clientId",void 0),Jt(this,"cancelToken",Xu.CancelToken.source()),Jt(this,"workerToken",void 0),Jt(this,"requestId",0),Jt(this,"signal",void 0),Jt(this,"prevChannelMediaConfig",void 0),Jt(this,"httpRetryConfig",void 0),Jt(this,"_resolution",void 0),Jt(this,"_state",ap.RELAY_STATE_IDLE),Jt(this,"errorCode",MS.RELAY_OK),Jt(this,"onStatus",mt=>{Ut.debug("[".concat(this.clientId,"] ChannelMediaStatus: ").concat(JSON.stringify(mt))),mt&&mt.command&&(mt.command==="onAudioPacketReceived"&&this.emit("event",fE.PACKET_RECEIVED_AUDIO_FROM_SRC),mt.command==="onVideoPacketReceived"&&this.emit("event",fE.PACKET_RECEIVED_VIDEO_FROM_SRC),mt.command==="onSrcTokenPrivilegeDidExpire"&&(this.errorCode=MS.SRC_TOKEN_EXPIRED,this.state=ap.RELAY_STATE_FAILURE),mt.command==="onDestTokenPrivilegeDidExpire"&&(this.errorCode=MS.DEST_TOKEN_EXPIRED,this.state=ap.RELAY_STATE_FAILURE))}),Jt(this,"onReconnect",async()=>{Ut.debug("[".concat(this.clientId,"] ChannelMediaSocket disconnect, reconnecting")),this.emit("event",fE.NETWORK_DISCONNECTED),this.state=ap.RELAY_STATE_IDLE,this.prevChannelMediaConfig&&this.sendStartRelayMessage(this.prevChannelMediaConfig).catch(mt=>{this.state!==ap.RELAY_STATE_IDLE&&(Ut.error("auto restart channel media relay failed",mt.toString()),this.errorCode=MS.SERVER_CONNECTION_LOST,this.state=ap.RELAY_STATE_FAILURE)})}),this.joinInfo=rt,this.clientId=it,this.sid=_0(),this.signal=new NJ(this.joinInfo,this.clientId,ct),this.httpRetryConfig=ut,this._resolution=pt}async startChannelMediaRelay(rt){if(this.state!==ap.RELAY_STATE_IDLE)throw new $n(tn.INVALID_OPERATION);this.state=ap.RELAY_STATE_CONNECTING,await this.connect(),Ut.debug("[".concat(this.clientId,"] startChannelMediaRelay: connect success"));try{await this.sendStartRelayMessage(rt)}catch(it){throw it.data&&it.data.serverResponse&&it.data.serverResponse.command==="SetSourceChannel"?new $n(tn.CROSS_CHANNEL_FAILED_JOIN_SRC):it.data&&it.data.serverResponse&&it.serverResponse.command==="SetDestChannelStatus"?new $n(tn.CROSS_CHANNEL_FAILED_JOIN_DEST):it.data&&it.data.serverResponse&&it.serverResponse.command==="StartPacketTransfer"?new $n(tn.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST):it}this.prevChannelMediaConfig=rt}async updateChannelMediaRelay(rt){if(this.state!==ap.RELAY_STATE_RUNNING)throw new $n(tn.INVALID_OPERATION);await this.sendUpdateMessage(rt),this.prevChannelMediaConfig=rt}async setVideoProfile(rt){if(this._resolution=rt,this.state!==ap.RELAY_STATE_RUNNING)throw new $n(tn.INVALID_OPERATION);const it=this.genMessage($u.SetVideoProfile);await this.signal.request(it),Ut.debug("[".concat(this.clientId,"] startChannelMediaRelay: setVideoProfile success"))}async stopChannelMediaRelay(){await this.sendStopRelayMessage(),Ut.debug("[".concat(this.clientId,"] stopChannelMediaRelay: send stop message success")),this.state=ap.RELAY_STATE_IDLE,this.dispose()}dispose(){Ut.debug("[".concat(this.clientId,"] disposeChannelMediaRelay")),this.cancelToken.cancel(),this.cancelToken=Xu.CancelToken.source(),this.state=ap.RELAY_STATE_IDLE,this.emit("dispose"),this.signal.dispose(),this.prevChannelMediaConfig=void 0}async connect(){const rt=await KX(this.joinInfo,this.cancelToken.token,this.httpRetryConfig);this.workerToken=rt.workerToken,await this.signal.connect(rt.addressList),this.emit("event",fE.NETWORK_CONNECTED),this.signal.on("status",this.onStatus),this.signal.on("reconnecting",this.onReconnect)}async sendStartRelayMessage(rt){const it=this.genMessage($u.StopPacketTransfer);await this.signal.request(it),await this.signal.waitStatus("Normal Quit"),Ut.debug("[".concat(this.clientId,"] startChannelMediaRelay: StopPacketTransfer success"));const ct=this.genMessage($u.SetSdkProfile,rt);await this.signal.request(ct),Ut.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSdkProfile success"));const ut=this.genMessage($u.SetSourceChannel,rt);await this.signal.request(ut),await this.signal.waitStatus("SetSourceChannelStatus"),this.emit("event",fE.PACKET_JOINED_SRC_CHANNEL),Ut.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceChannel success"));const pt=this.genMessage($u.SetSourceUserId,rt);await this.signal.request(pt),Ut.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceUserId success"));const mt=this.genMessage($u.SetDestChannel,rt);await this.signal.request(mt),await this.signal.waitStatus("SetDestChannelStatus"),this.emit("event",fE.PACKET_JOINED_DEST_CHANNEL),Ut.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetDestChannel success"));const _t=this.genMessage($u.StartPacketTransfer,rt);await this.signal.request(_t),this.emit("event",fE.PACKET_SENT_TO_DEST_CHANNEL),this.state=ap.RELAY_STATE_RUNNING,Ut.debug("[".concat(this.clientId,"] startChannelMediaRelay: StartPacketTransfer success")),this.setVideoProfile(this._resolution)}async sendUpdateMessage(rt){const it=this.genMessage($u.UpdateDestChannel,rt);await this.signal.request(it),this.emit("event",fE.PACKET_UPDATE_DEST_CHANNEL),Ut.debug("[".concat(this.clientId,"] sendUpdateMessage: UpdateDestChannel success"))}async sendStopRelayMessage(){const rt=this.genMessage($u.StopPacketTransfer);await this.signal.request(rt),Ut.debug("[".concat(this.clientId,"] sendStopRelayMessage: StopPacketTransfer success"))}genMessage(rt,it){const ct=[],ut=[],pt=[];this.requestId+=1;const mt={appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sdkVersion:Zp,sid:this.sid,ts:Date.now(),requestId:this.requestId,seq:this.requestId,allocate:!0,clientRequest:{}};mt.sdkVersion==="4.24.0"&&(mt.sdkVersion="0.0.1");let _t=null,vt=null;switch(rt){case $u.SetSdkProfile:return mt.clientRequest={command:"SetSdkProfile",type:"multi_channel"},mt;case $u.SetSourceChannel:if(vt=it&&it.getSrcChannelMediaInfo(),!vt)throw new $n(tn.UNEXPECTED_ERROR,"can not find source config");return mt.clientRequest={command:"SetSourceChannel",uid:"0",channelName:vt.channelName,token:vt.token||this.joinInfo.appId},mt;case $u.SetSourceUserId:if(vt=it&&it.getSrcChannelMediaInfo(),!vt)throw new $n(tn.UNEXPECTED_ERROR,"can not find source config");return mt.clientRequest={command:"SetSourceUserId",uid:vt.uid+""},mt;case $u.SetDestChannel:if(_t=it&&it.getDestChannelMediaInfo(),!_t)throw new $n(tn.UNEXPECTED_ERROR,"can not find dest config");return _t.forEach(Tt=>{ct.push(Tt.channelName),ut.push(Tt.uid+""),pt.push(Tt.token||this.joinInfo.appId)}),mt.clientRequest={command:"SetDestChannel",channelName:ct,uid:ut,token:pt},mt;case $u.StartPacketTransfer:return mt.clientRequest={command:"StartPacketTransfer"},mt;case $u.Reconnect:return mt.clientRequest={command:"Reconnect"},mt;case $u.StopPacketTransfer:return mt.clientRequest={command:"StopPacketTransfer"},mt;case $u.UpdateDestChannel:if(_t=it&&it.getDestChannelMediaInfo(),!_t)throw new $n(tn.UNEXPECTED_ERROR,"can not find dest config");return _t.forEach(Tt=>{ct.push(Tt.channelName),ut.push(Tt.uid+""),pt.push(Tt.token||this.joinInfo.appId)}),mt.clientRequest={command:"UpdateDestChannel",channelName:ct,uid:ut,token:pt},mt;case $u.SetVideoProfile:mt.clientRequest={command:"SetVideoProfile",width:this._resolution.width,height:this._resolution.height}}return mt}}const LJ={name:"ChannelMediaRelay",create:function(_e){return new DJ(_e.joinInfo,_e.clientId,_e.websocketRetryConfig||xa,_e.httpRetryConfig||xa,_e.resolution)}};function VG(_e,rt){var it=Object.keys(_e);if(Object.getOwnPropertySymbols){var ct=Object.getOwnPropertySymbols(_e);rt&&(ct=ct.filter(function(ut){return Object.getOwnPropertyDescriptor(_e,ut).enumerable})),it.push.apply(it,ct)}return it}function nC(_e){for(var rt=1;rt<arguments.length;rt++){var it=arguments[rt]!=null?arguments[rt]:{};rt%2?VG(Object(it),!0).forEach(function(ct){Jt(_e,ct,it[ct])}):Object.getOwnPropertyDescriptors?Object.defineProperties(_e,Object.getOwnPropertyDescriptors(it)):VG(Object(it)).forEach(function(ct){Object.defineProperty(_e,ct,Object.getOwnPropertyDescriptor(it,ct))})}return _e}class kJ extends Fs{constructor(rt,it,ct,ut){super(),Jt(this,"spec",void 0),Jt(this,"token",void 0),Jt(this,"websocket",void 0),Jt(this,"pingpongTimer",void 0),Jt(this,"reconnectMode","retry"),Jt(this,"serviceMode",void 0),Jt(this,"reqId",0),Jt(this,"commandReqId",0),Jt(this,"handleWebSocketOpen",()=>{this.reconnectMode="retry",this.startPingPong()}),Jt(this,"handleWebSocketMessage",pt=>{if(!pt.data)return;const mt=JSON.parse(pt.data);mt.requestId?this.emit("@".concat(mt.requestId,"-").concat(mt.sid),mt):(Vr.workerEvent(this.spec.sid,{actionType:"status",serverCode:mt.code,workerType:this.serviceMode===k_.TRANSCODE?1:2}),this.emit(ov.PUBLISH_STREAM_STATUS,mt))}),this.spec=it,this.token=rt,this.serviceMode=ut,this.websocket=new RA("live-streaming",ct),this.websocket.on(ho.CONNECTED,this.handleWebSocketOpen),this.websocket.on(ho.ON_MESSAGE,this.handleWebSocketMessage),this.websocket.on(ho.REQUEST_NEW_URLS,(pt,mt)=>{ru(this,ov.REQUEST_NEW_ADDRESS).then(pt).catch(mt)}),this.websocket.on(ho.RECONNECTING,()=>{this.websocket.reconnectMode=this.reconnectMode})}init(rt){return this.websocket.init(rt)}async request(rt,it,ct,ut){this.reqId+=1,rt==="request"&&(this.commandReqId+=1);const pt=this.commandReqId,mt=this.reqId;if(!mt||!this.websocket)throw new $n(tn.UNEXPECTED_ERROR);const _t=nC({command:rt,sdkVersion:Zp==="4.24.0"?"0.0.1":Zp,seq:mt,requestId:mt,allocate:ct,cname:this.spec.cname,appId:this.spec.appId,sid:this.spec.sid,uid:this.spec.uid.toString(),ts:Math.floor(Date.now()/1e3)},it);if(this.websocket.state==="closed")throw new $n(tn.WS_DISCONNECT);const vt=()=>new Ir((Mt,Dt)=>{this.websocket.once(ho.CLOSED,()=>Dt(new $n(tn.WS_ABORT))),this.websocket.once(ho.CONNECTED,Mt)});this.websocket.state!=="connected"&&await vt(),_t.clientRequest&&(_t.clientRequest.workerToken=this.token);const Tt=new Ir((Mt,Dt)=>{const jt=()=>{Dt(new $n(tn.WS_ABORT))};this.websocket.once(ho.RECONNECTING,jt),this.websocket.once(ho.CLOSED,jt),this.once("@".concat(mt,"-").concat(this.spec.sid),$t=>{Mt($t)})});ut&&Vr.workerEvent(this.spec.sid,nC(nC({},ut),{},{requestId:pt,actionType:"request",payload:JSON.stringify(it.clientRequest),serverCode:0,code:0}));const bt=Date.now();this.websocket.sendMessage(_t);let Ot=null;try{Ot=await Tt}catch(Mt){if(this.websocket.state==="closed")throw Mt;return await vt(),await this.request(rt,it,ct)}return ut&&Vr.workerEvent(this.spec.sid,nC(nC({},ut),{},{requestId:pt,actionType:"response",payload:JSON.stringify(Ot.serverResponse),serverCode:Ot.code,success:Ot.code===200,responseTime:Date.now()-bt})),Ot.code!==200&&this.handleResponseError(Ot),Ot}tryNextAddress(){this.reconnectMode="tryNext",this.websocket.reconnect("tryNext")}close(){const rt=Zp==="4.24.0"?"0.0.1":Zp;this.reqId+=1,this.websocket.state==="connected"?(this.websocket.sendMessage({command:"request",appId:this.spec.appId,cname:this.spec.cname,uid:this.spec.uid.toString(),sdkVersion:rt,sid:this.spec.sid,seq:this.reqId,ts:Math.floor(Date.now()/1e3),requestId:this.reqId,clientRequest:{command:"DestroyWorker"}}),this.websocket.close(!1,!0)):this.websocket.close(!1),this.pingpongTimer&&(window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0)}handleResponseError(rt){switch(rt.code){case Sl.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM:return void Ut.warning("live stream response already exists stream");case Sl.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR:case Sl.LIVE_STREAM_RESPONSE_BAD_STREAM:case Sl.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR:return new $n(tn.LIVE_STREAMING_INVALID_ARGUMENT,"",{code:rt.code}).throw();case Sl.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST:if(rt.serverResponse.command==="UnpublishStream")return;throw new $n(tn.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case Sl.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED:return new $n(tn.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED,"",{code:rt.code}).throw();case Sl.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const it=new $n(tn.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE);return this.emit(ov.WARNING,it,rt.serverResponse.url)}case Sl.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN:{const it=new $n(tn.LIVE_STREAMING_WARN_FREQUENT_REQUEST);return this.emit(ov.WARNING,it,rt.serverResponse.url)}case Sl.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH:throw new $n(tn.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case Sl.LIVE_STREAM_RESPONSE_NOT_SUPPORTED:return new $n(tn.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED,"",{code:rt.code}).throw();case Sl.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM:{const it=new $n(tn.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT);return this.emit(ov.WARNING,it,rt.serverResponse.url)}case Sl.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR:return new $n(tn.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:rt.code}).throw();case Sl.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT:throw new $n(tn.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream resource limit",{retry:!0,changeAddress:!0});case Sl.LIVE_STREAM_RESPONSE_WORKER_LOST:case Sl.LIVE_STREAM_RESPONSE_WORKER_QUIT:if(rt.serverResponse.command==="UnpublishStream")return;throw new $n(tn.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case Sl.ERROR_FAIL_SEND_MESSAGE:if(rt.serverResponse.command==="UnpublishStream")return;if(rt.serverResponse.command==="UpdateTranscoding"||rt.serverResponse.command==="ControlStream")return new $n(tn.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{code:rt.code}).throw();throw new $n(tn.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case Sl.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case Sl.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case Sl.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case Sl.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:return new $n(tn.LIVE_STREAMING_CDN_ERROR,"",{code:rt.code}).throw()}}startPingPong(){this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(()=>{this.websocket.state==="connected"&&this.request("ping",{}).catch(fw)},6e3)}}function GG(_e,rt){var it=Object.keys(_e);if(Object.getOwnPropertySymbols){var ct=Object.getOwnPropertySymbols(_e);rt&&(ct=ct.filter(function(ut){return Object.getOwnPropertyDescriptor(_e,ut).enumerable})),it.push.apply(it,ct)}return it}function cp(_e){for(var rt=1;rt<arguments.length;rt++){var it=arguments[rt]!=null?arguments[rt]:{};rt%2?GG(Object(it),!0).forEach(function(ct){Jt(_e,ct,it[ct])}):Object.getOwnPropertyDescriptors?Object.defineProperties(_e,Object.getOwnPropertyDescriptors(it)):GG(Object(it)).forEach(function(ct){Object.defineProperty(_e,ct,Object.getOwnPropertyDescriptor(it,ct))})}return _e}class UJ extends Fs{constructor(rt){let it=arguments.length>1&&arguments[1]!==void 0?arguments[1]:xa,ct=arguments.length>2&&arguments[2]!==void 0?arguments[2]:xa;super(),Jt(this,"onLiveStreamWarning",void 0),Jt(this,"onLiveStreamError",void 0),Jt(this,"spec",void 0),Jt(this,"retryTimeout",1e4),Jt(this,"connection",void 0),Jt(this,"httpRetryConfig",void 0),Jt(this,"wsRetryConfig",void 0),Jt(this,"streamingTasks",new Map),Jt(this,"isStartingStreamingTask",!1),Jt(this,"taskMutex",new lu("live-streaming")),Jt(this,"cancelToken",Xu.CancelToken.source()),Jt(this,"transcodingConfig",void 0),Jt(this,"uapResponse",void 0),Jt(this,"lastTaskId",1),Jt(this,"statusError",new Map),this.spec=rt,this.httpRetryConfig=ct,this.wsRetryConfig=it}async setTranscodingConfig(rt){const it=cp(cp({},bX),rt);it.videoCodecProfile!==66&&it.videoCodecProfile!==77&&it.videoCodecProfile!==100&&(Ut.debug("[".concat(this.spec.clientId,"] set transcoding config, fix video codec profile: ").concat(it.videoCodecProfile," -> 100")),it.videoCodecProfile=100),it.transcodingUsers||(it.transcodingUsers=it.userConfigs),it.transcodingUsers&&(it.transcodingUsers=it.transcodingUsers.map(mt=>cp(cp(cp({},CX),mt),{},{zOrder:mt.zOrder?mt.zOrder+1:1}))),function(mt){$s(mt.width)||us(mt.width,"config.width",0,1e4),$s(mt.height)||us(mt.height,"config.height",0,1e4),$s(mt.videoBitrate)||us(mt.videoBitrate,"config.videoBitrate",1,1e6),$s(mt.videoFrameRate)||us(mt.videoFrameRate,"config.videoFrameRate"),$s(mt.lowLatency)||t_(mt.lowLatency,"config.lowLatency"),$s(mt.audioSampleRate)||Cl(mt.audioSampleRate,"config.audioSampleRate",[32e3,44100,48e3]),$s(mt.audioBitrate)||us(mt.audioBitrate,"config.audioBitrate",1,128),$s(mt.audioChannels)||Cl(mt.audioChannels,"config.audioChannels",[1,2,3,4,5]),$s(mt.videoGop)||us(mt.videoGop,"config.videoGop"),$s(mt.videoCodecProfile)||Cl(mt.videoCodecProfile,"config.videoCodecProfile",[66,77,100]),$s(mt.userCount)||us(mt.userCount,"config.userCount",0,17),$s(mt.backgroundColor)||us(mt.backgroundColor,"config.backgroundColor",0,16777215),$s(mt.userConfigExtraInfo)||Hl(mt.userConfigExtraInfo,"config.userConfigExtraInfo",0,4096,!1),mt.transcodingUsers&&!$s(mt.transcodingUsers)&&(pE(mt.transcodingUsers,"config.transcodingUsers"),mt.transcodingUsers.forEach((_t,vt)=>{Bw(_t.uid),$s(_t.x)||us(_t.x,"transcodingUser[".concat(vt,"].x"),0,1e4),$s(_t.y)||us(_t.y,"transcodingUser[".concat(vt,"].y"),0,1e4),$s(_t.width)||us(_t.width,"transcodingUser[".concat(vt,"].width"),0,1e4),$s(_t.height)||us(_t.height,"transcodingUser[".concat(vt,"].height"),0,1e4),$s(_t.zOrder)||us(_t.zOrder-1,"transcodingUser[".concat(vt,"].zOrder"),0,100),$s(_t.alpha)||us(_t.alpha,"transcodingUser[".concat(vt,"].alpha"),0,1,!1)})),$s(mt.watermark)||fM(mt.watermark,"watermark"),$s(mt.backgroundImage)||fM(mt.backgroundImage,"backgroundImage"),mt.images&&!$s(mt.images)&&(pE(mt.images,"config.images"),mt.images.forEach((_t,vt)=>{fM(_t,"images[".concat(vt,"]"))}))}(it);const ct=[];it.images&&ct.push(...it.images.map(mt=>cp(cp(cp({},pM),mt),{},{zOrder:255}))),it.backgroundImage&&(ct.push(cp(cp(cp({},pM),it.backgroundImage),{},{zOrder:0})),delete it.backgroundImage),it.watermark&&(ct.push(cp(cp(cp({},pM),it.watermark),{},{zOrder:255})),delete it.watermark),it.images=ct,it.transcodingUsers&&(it.userConfigs=it.transcodingUsers.map(mt=>cp({},mt)),it.userCount=it.transcodingUsers.length,delete it.transcodingUsers);const ut=(it.userConfigs||[]).map(mt=>typeof mt.uid=="number"?Ir.resolve(mt.uid):d4(mt.uid,this.spec,this.cancelToken.token,this.httpRetryConfig));if((await Ir.all(ut)).forEach((mt,_t)=>{it.userConfigs&&it.userConfigs[_t]&&(it.userConfigs[_t].uid=mt)}),this.transcodingConfig=it,this.connection)try{var pt;const mt=await this.connection.request("request",{clientRequest:{command:"UpdateTranscoding",transcodingConfig:this.transcodingConfig}},!1,{command:"UpdateTranscoding",workerType:1,requestByUser:!0,tid:Array.from(Sp(pt=this.streamingTasks).call(pt)).map(_t=>_t.taskId).join("#")});Ut.debug("[".concat(this.spec.clientId,"] update live transcoding config success, code: ").concat(mt.code,", config:"),JSON.stringify(this.transcodingConfig))}catch(mt){if(!mt.data||!mt.data.retry)throw mt;mt.data.changeAddress&&this.connection.tryNextAddress(),this.streamingTasks.forEach(_t=>{Ut.warning("[".concat(this.spec.clientId,"] live streaming receive error"),mt.toString(),"try to republish",_t.url),this.startLiveStreamingTask(_t.url,_t.mode,mt).then(()=>{Ut.debug("[".concat(this.spec.clientId,"] live streaming republish ").concat(_t.url," success"))}).catch(vt=>{Ut.error("[".concat(this.spec.clientId,"] live streaming republish failed"),_t.url,vt.toString()),this.onLiveStreamError&&this.onLiveStreamError(_t.url,vt)})})}}async startLiveStreamingTask(rt,it,ct){if(!this.transcodingConfig&&it===k_.TRANSCODE)throw new $n(tn.INVALID_OPERATION,"[LiveStreaming] no transcoding config found, can not start transcoding streaming task");const ut={command:"PublishStream",ts:Date.now(),url:rt,uid:this.spec.uid.toString(),autoDestroyTime:100,acceptImageTimeout:!0};Ut.debug("[".concat(this.spec.clientId,"] start live streaming ").concat(rt,", mode: ").concat(it));const pt=await this.taskMutex.lock();if(!this.connection&&ct)return void pt();if(this.streamingTasks.get(rt)&&!ct)return pt(),new $n(tn.LIVE_STREAMING_TASK_CONFLICT).throw();try{this.connection||(this.connection=await this.connect(it))}catch(_t){throw pt(),_t}switch(it){case k_.TRANSCODE:ut.transcodingConfig=cp({},this.transcodingConfig);case k_.RAW:}this.uapResponse&&this.uapResponse.vid&&(ut.vid=this.uapResponse.vid),this.isStartingStreamingTask=!0;const mt=this.lastTaskId++;try{const _t=new Ir((Tt,bt)=>{zl(this.retryTimeout).then(()=>{if(ct)return bt(ct);const Ot=this.statusError.get(rt);return Ot?(this.statusError.delete(rt),bt(Ot)):void 0})}),vt=await Ir.race([this.connection.request("request",{clientRequest:ut},!0,{url:rt,command:"PublishStream",workerType:it===k_.TRANSCODE?1:2,requestByUser:!ct,tid:mt.toString()}),_t]);this.isStartingStreamingTask=!1,Ut.debug("[".concat(this.spec.clientId,"] live streaming started, code: ").concat(vt.code)),this.streamingTasks.set(rt,{clientRequest:ut,mode:it,url:rt,taskId:mt}),pt()}catch(_t){if(pt(),this.isStartingStreamingTask=!1,!_t.data||!_t.data.retry||ct)throw _t;return _t.data.changeAddress?(this.connection.tryNextAddress(),await this.startLiveStreamingTask(rt,it,_t)):await this.startLiveStreamingTask(rt,it,_t)}}stopLiveStreamingTask(rt){return new Ir((it,ct)=>{const ut=this.streamingTasks.get(rt);if(!ut||!this.connection)return new $n(tn.UNEXPECTED_ERROR,"can not find streaming task to stop").throw();const pt=ut.mode;ut.abortTask=()=>{Ut.debug("[".concat(this.spec.clientId,"] stop live streaming success(worker exception)")),this.streamingTasks.delete(rt),it()},this.connection.request("request",{clientRequest:{command:"UnpublishStream",url:ut.url}},!1,{url:rt,command:"UnPublishStream",workerType:pt===k_.TRANSCODE?1:2,requestByUser:!0,tid:(this.lastTaskId++).toString()}).then(mt=>{Ut.debug("[".concat(this.spec.clientId,"] stop live streaming success, code: ").concat(mt.code)),this.streamingTasks.delete(rt),this.streamingTasks.size===0&&(this.connection&&this.connection.close(),this.connection=void 0),it()}).catch(ct)})}resetAllTask(){var rt;const it=Array.from(Sp(rt=this.streamingTasks).call(rt));this.terminate();for(const ct of it)this.startLiveStreamingTask(ct.url,ct.mode).catch(ut=>{this.onLiveStreamError&&this.onLiveStreamError(ct.url,ut)})}terminate(){this.cancelToken&&this.cancelToken.cancel(),this.streamingTasks=new Map,this.isStartingStreamingTask=!1,this.statusError=new Map,this.cancelToken=Xu.CancelToken.source(),this.uapResponse=void 0,this.connection&&this.connection.close(),this.connection=void 0}async connect(rt){if(this.connection)throw new $n(tn.UNEXPECTED_ERROR,"live streaming connection has already connected");const it=await ru(this,mM.REQUEST_WORKER_MANAGER_LIST,rt);return this.uapResponse=it,this.connection=new kJ(it.workerToken,this.spec,this.wsRetryConfig,rt),this.connection.on(ov.WARNING,(ct,ut)=>this.onLiveStreamWarning&&this.onLiveStreamWarning(ut,ct)),this.connection.on(ov.PUBLISH_STREAM_STATUS,ct=>this.handlePublishStreamServer(ct)),this.connection.on(ov.REQUEST_NEW_ADDRESS,(ct,ut)=>{if(!this.connection)return ut(new $n(tn.UNEXPECTED_ERROR,"can not get new live streaming address list"));ru(this,mM.REQUEST_WORKER_MANAGER_LIST,rt).then(pt=>{this.uapResponse=pt,ct(pt.addressList)}).catch(ut)}),await this.connection.init(it.addressList),this.connection}handlePublishStreamServer(rt){const it=rt.serverStatus&&rt.serverStatus.url||"empty_url",ct=this.streamingTasks.get(it),ut=rt.reason;switch(rt.code){case Sl.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case Sl.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case Sl.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case Sl.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:{const mt=new $n(tn.LIVE_STREAMING_CDN_ERROR,"",{code:rt.code});if(ct)return Ut.error(mt.toString()),this.onLiveStreamError&&this.onLiveStreamError(it,mt);if(!this.isStartingStreamingTask)return;this.statusError.set(it,mt)}case Sl.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const mt=new $n(tn.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE,ut);return this.onLiveStreamWarning&&this.onLiveStreamWarning(it,mt)}case Sl.LIVE_STREAM_RESPONSE_WORKER_LOST:case Sl.LIVE_STREAM_RESPONSE_WORKER_QUIT:{var pt;if(!this.connection)return;this.connection.tryNextAddress();const mt=Array.from(Sp(pt=this.streamingTasks).call(pt));for(const _t of mt)_t.abortTask?_t.abortTask():(Ut.warning("[".concat(this.spec.clientId,"] publish stream status code"),rt.code,"try to republish",_t.url),this.startLiveStreamingTask(_t.url,_t.mode,new $n(tn.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:rt.code})).then(()=>{Ut.debug("[".concat(this.spec.clientId,"] republish live stream success"),_t.url)}).catch(vt=>{Ut.error(vt.toString()),this.onLiveStreamError&&this.onLiveStreamError(_t.url,vt)}));return}}}hasUrl(rt){return this.streamingTasks.has(rt)}}const BJ={name:"LiveStreaming",create:function(_e){return new UJ(_e.joinInfo,_e.websocketRetryConfig||xa,_e.httpRetryConfig||xa)}};function FJ(_e){let rt=jG();return function(it,ct){let ut=it.appId;ut!==void 0&&(ts(ct,10),j_(ct,ut));let pt=it.cid;pt!==void 0&&(ts(ct,16),ts(ct,pt));let mt=it.cname;mt!==void 0&&(ts(ct,26),j_(ct,mt));let _t=it.deviceId;_t!==void 0&&(ts(ct,34),j_(ct,_t));let vt=it.elapse;vt!==void 0&&(ts(ct,40),Sv(ct,vt));let Tt=it.fileSize;Tt!==void 0&&(ts(ct,48),Sv(ct,qS(Tt)));let bt=it.height;bt!==void 0&&(ts(ct,56),Sv(ct,qS(bt)));let Ot=it.jpg;Ot!==void 0&&(ts(ct,66),ts(ct,Ot.length),function(fu,Jn){let _r=JS(fu,Jn.length);fu.bytes.set(Jn,_r)}(ct,Ot));let Mt=it.networkType;Mt!==void 0&&(ts(ct,72),Sv(ct,qS(Mt)));let Dt=it.osType;Dt!==void 0&&(ts(ct,80),Sv(ct,qS(Dt)));let jt=it.requestId;jt!==void 0&&(ts(ct,90),j_(ct,jt));let $t=it.sdkVersion;$t!==void 0&&(ts(ct,98),j_(ct,$t));let Ht=it.sequence;Ht!==void 0&&(ts(ct,104),Sv(ct,qS(Ht)));let en=it.sid;en!==void 0&&(ts(ct,114),j_(ct,en));let Qt=it.timestamp;Qt!==void 0&&(ts(ct,120),Sv(ct,Qt));let on=it.uid;on!==void 0&&(ts(ct,128),ts(ct,on));let Tn=it.vid;Tn!==void 0&&(ts(ct,136),ts(ct,Tn));let vn=it.width;vn!==void 0&&(ts(ct,144),Sv(ct,qS(vn)));let hn=it.service;hn!==void 0&&(ts(ct,152),ts(ct,hn));let Ln=it.callbackData;Ln!==void 0&&(ts(ct,162),j_(ct,Ln));let Xn=it.jpgEncryption;Xn!==void 0&&(ts(ct,168),ts(ct,Xn));let Qn=it.requestType;Qn!==void 0&&(ts(ct,176),ts(ct,Qn));let ur=it.scorePorn;ur!==void 0&&(ts(ct,185),AP(ct,ur));let go=it.scoreSexy;go!==void 0&&(ts(ct,193),AP(ct,go));let Eo=it.scoreNeutral;Eo!==void 0&&(ts(ct,201),AP(ct,Eo));let no=it.scene;no!==void 0&&(ts(ct,208),ts(ct,no));let Yo=it.ossFilePrefix;Yo!==void 0&&(ts(ct,218),j_(ct,Yo));let jo=it.serviceVendor;if(jo!==void 0)for(let fu of jo){ts(ct,226);let Jn=jG();$J(fu,Jn),ts(ct,Jn.limit),WJ(ct,Jn),zJ(Jn)}}(_e,rt),function(it){let ct=it.bytes,ut=it.limit;return ct.length===ut?ct:ct.subarray(0,ut)}(rt)}function VJ(_e){return function(it){let ct={};e:for(;!zG(it);){let ut=z_(it);switch(ut>>>3){case 0:break e;case 1:ct.code=z_(it);break;case 2:ct.msg=WG(it,z_(it));break;case 3:{let pt=HJ(it);ct.data=GJ(it),it.limit=pt;break}default:$G(it,7&ut)}}return ct}({bytes:rt=_e,offset:0,limit:rt.length});var rt}function GJ(_e){let rt={};e:for(;!zG(_e);){let it=z_(_e);switch(it>>>3){case 0:break e;case 1:rt.requestId=WG(_e,z_(_e));break;case 2:rt.requestType=z_(_e)>>>0;break;case 3:rt.scorePorn=TP(_e);break;case 4:rt.scoreSexy=TP(_e);break;case 5:rt.scoreNeutral=TP(_e);break;case 6:rt.requestScene=z_(_e)>>>0;break;case 7:rt.scene=z_(_e)>>>0;break;default:$G(_e,7&it)}}return rt}function $J(_e,rt){let it=_e.service;it!==void 0&&(ts(rt,8),ts(rt,it));let ct=_e.vendor;ct!==void 0&&(ts(rt,16),ts(rt,ct));let ut=_e.token;ut!==void 0&&(ts(rt,26),j_(rt,ut));let pt=_e.callbackUrl;pt!==void 0&&(ts(rt,34),j_(rt,pt))}function HJ(_e){let rt=z_(_e),it=_e.limit;return _e.limit=_e.offset+rt,it}function $G(_e,rt){switch(rt){case 0:for(;128&KG(_e););break;case 2:yP(_e,z_(_e));break;case 5:yP(_e,4);break;case 1:yP(_e,8);break;default:throw new Error("Unimplemented type: "+rt)}}let jJ=new Float32Array(1);new Uint8Array(jJ.buffer);let vP=new Float64Array(1),lp=new Uint8Array(vP.buffer);function qS(_e){return{low:_e|=0,high:_e>>31,unsigned:_e>=0}}let HG=[];function jG(){const _e=HG.pop();return _e?(_e.offset=_e.limit=0,_e):{bytes:new Uint8Array(64),offset:0,limit:0}}function zJ(_e){HG.push(_e)}function yP(_e,rt){if(_e.offset+rt>_e.limit)throw new Error("Skip past limit");_e.offset+=rt}function zG(_e){return _e.offset>=_e.limit}function JS(_e,rt){let it=_e.bytes,ct=_e.offset,ut=_e.limit,pt=ct+rt;if(pt>it.length){let mt=new Uint8Array(2*pt);mt.set(it),_e.bytes=mt}return _e.offset=pt,pt>ut&&(_e.limit=pt),ct}function SP(_e,rt){let it=_e.offset;if(it+rt>_e.limit)throw new Error("Read past limit");return _e.offset+=rt,it}function WG(_e,rt){let it=SP(_e,rt),ct=String.fromCharCode,ut=_e.bytes,pt="",mt="";for(let _t=0;_t<rt;_t++){let vt,Tt,bt,Ot,Mt=ut[_t+it];128&Mt?(224&Mt)==192?_t+1>=rt?mt+=pt:(vt=ut[_t+it+1],(192&vt)!=128?mt+=pt:(Ot=(31&Mt)<<6|63&vt,Ot<128?mt+=pt:(mt+=ct(Ot),_t++))):(240&Mt)==224?_t+2>=rt?mt+=pt:(vt=ut[_t+it+1],Tt=ut[_t+it+2],(49344&(vt|Tt<<8))!=32896?mt+=pt:(Ot=(15&Mt)<<12|(63&vt)<<6|63&Tt,Ot<2048||Ot>=55296&&Ot<=57343?mt+=pt:(mt+=ct(Ot),_t+=2))):(248&Mt)==240?_t+3>=rt?mt+=pt:(vt=ut[_t+it+1],Tt=ut[_t+it+2],bt=ut[_t+it+3],(12632256&(vt|Tt<<8|bt<<16))!=8421504?mt+=pt:(Ot=(7&Mt)<<18|(63&vt)<<12|(63&Tt)<<6|63&bt,Ot<65536||Ot>1114111?mt+=pt:(Ot-=65536,mt+=ct(55296+(Ot>>10),56320+(1023&Ot)),_t+=3))):mt+=pt:mt+=ct(Mt)}return mt}function j_(_e,rt){let it=rt.length,ct=0;for(let mt=0;mt<it;mt++){let _t=rt.charCodeAt(mt);_t>=55296&&_t<=56319&&mt+1<it&&(_t=(_t<<10)+rt.charCodeAt(++mt)-56613888),ct+=_t<128?1:_t<2048?2:_t<65536?3:4}ts(_e,ct);let ut=JS(_e,ct),pt=_e.bytes;for(let mt=0;mt<it;mt++){let _t=rt.charCodeAt(mt);_t>=55296&&_t<=56319&&mt+1<it&&(_t=(_t<<10)+rt.charCodeAt(++mt)-56613888),_t<128?pt[ut++]=_t:(_t<2048?pt[ut++]=_t>>6&31|192:(_t<65536?pt[ut++]=_t>>12&15|224:(pt[ut++]=_t>>18&7|240,pt[ut++]=_t>>12&63|128),pt[ut++]=_t>>6&63|128),pt[ut++]=63&_t|128)}}function WJ(_e,rt){let it=JS(_e,rt.limit),ct=_e.bytes,ut=rt.bytes;for(let pt=0,mt=rt.limit;pt<mt;pt++)ct[pt+it]=ut[pt]}function KG(_e){return _e.bytes[SP(_e,1)]}function YG(_e,rt){let it=JS(_e,1);_e.bytes[it]=rt}function TP(_e){let rt=SP(_e,8),it=_e.bytes;return lp[0]=it[rt++],lp[1]=it[rt++],lp[2]=it[rt++],lp[3]=it[rt++],lp[4]=it[rt++],lp[5]=it[rt++],lp[6]=it[rt++],lp[7]=it[rt++],vP[0]}function AP(_e,rt){let it=JS(_e,8),ct=_e.bytes;vP[0]=rt,ct[it++]=lp[0],ct[it++]=lp[1],ct[it++]=lp[2],ct[it++]=lp[3],ct[it++]=lp[4],ct[it++]=lp[5],ct[it++]=lp[6],ct[it++]=lp[7]}function z_(_e){let rt,it=0,ct=0;do rt=KG(_e),it<32&&(ct|=(127&rt)<<it),it+=7;while(128&rt);return ct}function ts(_e,rt){for(rt>>>=0;rt>=128;)YG(_e,127&rt|128),rt>>>=7;YG(_e,rt)}function Sv(_e,rt){let it=rt.low>>>0,ct=(rt.low>>>28|rt.high<<4)>>>0,ut=rt.high>>>24,pt=ut===0?ct===0?it<16384?it<128?1:2:it<1<<21?3:4:ct<16384?ct<128?5:6:ct<1<<21?7:8:ut<128?9:10,mt=JS(_e,pt),_t=_e.bytes;switch(pt){case 10:_t[mt+9]=ut>>>7&1;case 9:_t[mt+8]=pt!==9?128|ut:127&ut;case 8:_t[mt+7]=pt!==8?ct>>>21|128:ct>>>21&127;case 7:_t[mt+6]=pt!==7?ct>>>14|128:ct>>>14&127;case 6:_t[mt+5]=pt!==6?ct>>>7|128:ct>>>7&127;case 5:_t[mt+4]=pt!==5?128|ct:127&ct;case 4:_t[mt+3]=pt!==4?it>>>21|128:it>>>21&127;case 3:_t[mt+2]=pt!==3?it>>>14|128:it>>>14&127;case 2:_t[mt+1]=pt!==2?it>>>7|128:it>>>7&127;case 1:_t[mt]=pt!==1?128|it:127&it}}function XG(_e,rt){var it=Object.keys(_e);if(Object.getOwnPropertySymbols){var ct=Object.getOwnPropertySymbols(_e);rt&&(ct=ct.filter(function(ut){return Object.getOwnPropertyDescriptor(_e,ut).enumerable})),it.push.apply(it,ct)}return it}const KJ=new Map([["moderation",1],["supervise",2]]);class YJ extends Fs{get connectionState(){return this._connectionState}set connectionState(rt){if(this._connectionState===rt)return;const it=this._connectionState;this._connectionState=rt,this.emit(Bl.CONNECTION_STATE_CHANGE,it,rt)}get inspectType(){return this._inspectType}set inspectType(rt){var it;this._inspectMode=_p(it=rt.map(ct=>KJ.get(ct)||0)).call(it,(ct,ut)=>ct+ut),this._inspectType=rt}get quality(){return this._quality}set quality(rt){this._quality=rt>1?1:rt<.1?.1:rt,this.qualityTimer&&(window.clearTimeout(this.qualityTimer),this.qualityTimer=null),this._quality>=1||(this.qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this.qualityRatio},6e4))}constructor(rt){super(),Jt(this,"name","AgoraRTCVideoContentInspect"),Jt(this,"_connectionState",Rm.CONNECTING),Jt(this,"_innerConnectionState",void 0),Jt(this,"sequence",0),Jt(this,"inspectStartTime",void 0),Jt(this,"workerManagerConnection",void 0),Jt(this,"workerConnection",void 0),Jt(this,"workerMessageLengthLimit",void 0),Jt(this,"inspectIntervalMinimum",void 0),Jt(this,"qualityRatio",void 0),Jt(this,"_connectInfo",void 0),Jt(this,"_cancelTokenSource",Xu.CancelToken.source()),Jt(this,"_retryConfig",void 0),Jt(this,"wmSequence",0),Jt(this,"inspectInterval",void 0),Jt(this,"inspectTimer",null),Jt(this,"ossFilePrefix",void 0),Jt(this,"extraInfo",void 0),Jt(this,"_inspectType",void 0),Jt(this,"_inspectMode",void 0),Jt(this,"_quality",1),Jt(this,"qualityTimer",null),Jt(this,"_inspectId",void 0),Jt(this,"_needWorkUrlOnly",!1),Jt(this,"inspectImage",()=>{if(this.connectionState!==Rm.CONNECTED)throw new $n(tn.OPERATION_ABORTED,"content inspect service connection status is ".concat(this.connectionState));this.inspectTimer&&(window.clearInterval(this.inspectTimer),this.inspectTimer=null),this.inspectTimer=window.setInterval(()=>{this.connectionState===Rm.CONNECTED?this.requestToInspectImage():Ut.debug("[".concat(this._inspectId,"] Inspect State is not connected , "),this.connectionState)},this.inspectInterval<this.inspectIntervalMinimum?this.inspectIntervalMinimum:this.inspectInterval),this.requestToInspectImage()}),this._inspectId=ms(5,"inspect-"),this.workerMessageLengthLimit=rn("VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT"),this.inspectIntervalMinimum=rn("VIDEO_INSPECT_INTERVAL_MINIMUM"),this.qualityRatio=rn("VIDEO_INSPECT_QUALITY_RATIO"),this.inspectInterval=rt.interval,this.ossFilePrefix=rt.ossFilePrefix,this.extraInfo=rt.extraInfo,this.inspectType=rt.inspectType,this.inspectStartTime=Number(Date.now()),this.workerManagerConnection=new RA("worker-manager-"+this._inspectId,xa),this.on(Bl.STATE_CHANGE,(it,ct)=>{this._innerConnectionState=it,Ut.debug("[".concat(this._inspectId,"] Inspect operation :").concat(wm[it]," ").concat(ct||""))}),this.handleWorkerManagerEvents(),this.workerConnection=new RA("worker-"+this._inspectId,xa),this.handleWorkerEvents()}async init(rt,it){this.emit(Bl.STATE_CHANGE,wm.CONNECT_AP),this._connectInfo=rt;const ct=this._cancelTokenSource.token;return this._retryConfig=it,new Ir((ut,pt)=>{this.on(Bl.CONNECTION_STATE_CHANGE,(mt,_t)=>{_t===Rm.CONNECTED&&ut()}),this.requestAP(rt,ct,it).then(mt=>{this.connectWorkerManager(mt)}).catch(mt=>{pt(mt)})})}async requestAP(rt,it,ct){const ut=rn("WEBCS_DOMAIN").map(_t=>"https://".concat(_t,"/api/v1")),pt=await function(_t,vt,Tt,bt){let{appId:Ot,areaCode:Mt,cname:Dt,sid:jt,token:$t,uid:Ht}=vt;BS++;const en="image_moderation_api",Qt={service_name:en,json_body:JSON.stringify({appId:Ot,areaCode:Mt,cname:Dt,command:"allocateEdge",requestId:BS,seq:BS,sid:jt,token:$t,ts:Date.now(),uid:Ht+""})};let on,Tn,vn=_t[0];return n_(async()=>{on=Date.now();const hn=await a_(vn,{data:Qt,cancelToken:Tt,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(Tn=Date.now()-on,hn.code!==0){const ur=new $n(tn.UNEXPECTED_RESPONSE,"image inspect ap error, code"+hn.code,{retry:!0,responseTime:Tn});throw Ut.error(ur.toString()),ur}const Ln=JSON.parse(hn.json_body);if(Ln.code!==200){const ur=new $n(tn.UNEXPECTED_RESPONSE,"image inspect ap error, code: ".concat(Ln.code,", reason: ").concat(Ln.reason),{code:Ln.code,responseTime:Tn});throw Ut.error(ur.toString()),ur}if(!Ln.servers||!Array.isArray(Ln.servers)||Ln.servers.length===0){const ur=new $n(tn.UNEXPECTED_RESPONSE,"image inspect ap empty server",{code:Ln.code,responseTime:Tn});throw Ut.error(ur.toString()),ur}const Xn=rn("VIDEO_INSPECT_WORKER_MANAGER_HOST"),Qn=rn("VIDEO_INSPECT_WORKER_MANAGER_PORT");return{addressList:Ln.servers.map(ur=>{let{address:go,wss:Eo}=ur;if(go&&Eo)return"wss://".concat(go.replace(/\./g,"-"),".").concat(Xn,":").concat(Qn||Eo)}).filter(ur=>!!ur),workerToken:Ln.workerToken,vid:Ln.vid,responseTime:Tn}},(hn,Ln)=>(Vr.apworkerEvent(jt,{success:!0,sc:200,serviceName:en,responseDetail:JSON.stringify(hn.addressList),firstSuccess:Ln===0,responseTime:Tn,serverIp:_t[Ln%_t.length]}),!1),(hn,Ln)=>(Vr.apworkerEvent(jt,{success:!1,sc:hn.data&&hn.data.code||200,serviceName:en,responseTime:Tn,serverIp:_t[Ln%_t.length]}),!!(hn.code!==tn.OPERATION_ABORTED&&hn.code!==tn.UNEXPECTED_RESPONSE||hn.data&&hn.data.retry)&&(vn=_t[(Ln+1)%_t.length],!0)),bt)}(ut,rt,it,ct);this.emit(Bl.STATE_CHANGE,wm.AP_CONNECTED);const{addressList:mt}=pt;return this.wmSequence++,mt}async connectWorkerManager(rt){let it=arguments.length>1&&arguments[1]!==void 0&&arguments[1];this._needWorkUrlOnly=it,this.emit(Bl.STATE_CHANGE,wm.CONNECT_WORKER_MANAGER),await this.workerManagerConnection.init(rt,1e4)}async connectWorker(rt){await this.workerConnection.init([rt])}handleWorkerManagerEvents(){this.workerManagerConnection.on(ho.CONNECTED,async()=>{this.emit(Bl.STATE_CHANGE,wm.WORKER_MANAGER_CONNECTED,this.workerManagerConnection.url),this.workerManagerConnection.sendMessage({appId:this._connectInfo.appId,cname:this._connectInfo.cname,uid:this._connectInfo.uid+"",sdkVersion:"4.24.0",sid:this._connectInfo.sid,seq:this.wmSequence,ts:Number(Date.now()),requestId:Math.floor(1e12*Math.random()),allocate:!0,clientRequest:{command:"join"}},!0)}),this.workerManagerConnection.on(ho.CLOSED,()=>{this._innerConnectionState<wm.GET_WORKER_MANAGER_RESPONSE&&Ut.debug("[".concat(this._inspectId,"] Inspect worker manager is closed before connecting worker"))}),this.workerManagerConnection.on(ho.FAILED,()=>{this._innerConnectionState<wm.GET_WORKER_MANAGER_RESPONSE&&Ut.debug("[".concat(this._inspectId,"] Connecting inspect worker manager is failed before connecting worker"))}),this.workerManagerConnection.on(ho.RECONNECTING,()=>{this._innerConnectionState<wm.GET_WORKER_MANAGER_RESPONSE&&Ut.debug("[".concat(this._inspectId,"] Inspect worker manager is reconnecting before connecting worker"))}),this.workerManagerConnection.on(ho.ON_MESSAGE,async rt=>{this.emit(Bl.STATE_CHANGE,wm.GET_WORKER_MANAGER_RESPONSE);const it=this.workerManagerConnection.url;this.workerManagerConnection.close();const ct=JSON.parse(rt.data);if(ct.code!==200)throw Ut.error("[".concat(this._inspectId,"] Unexpected code ").concat(ct.code," from worker manager")),new $n(tn.UNEXPECTED_RESPONSE,"response code of worker is unexpected",ct);if(!(ct.serverResponse&&ct.serverResponse.portWss&&it))throw Ut.error("[".concat(this._inspectId,"] Unexpected content from worker manager : ").concat(JSON.stringify(ct))),new $n(tn.UNEXPECTED_RESPONSE,"response content of worker is unexpected",ct);{const ut=rn("VIDEO_INSPECT_WORKER_PORT")||ct.serverResponse.portWss,pt=it.replace(/:\d+\/?$/,":".concat(ut));this.emit(Bl.STATE_CHANGE,wm.CONNECT_WORKER,pt),this._needWorkUrlOnly?this.emit(Bl.REQUEST_NEW_WORKER_URL,pt):await this.connectWorker(pt)}}),this.workerManagerConnection.on(ho.WILL_RECONNECT,(rt,it,ct)=>{ct(rt)}),this.workerManagerConnection.on(ho.REQUEST_NEW_URLS,(rt,it)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(rt).catch(it)})}handleWorkerEvents(){this.workerConnection.on(ho.CONNECTED,async()=>{this.emit(Bl.STATE_CHANGE,wm.WORKER_CONNECTED,this.workerConnection.url),this.connectionState=Rm.CONNECTED}),this.workerConnection.on(ho.ON_MESSAGE,async rt=>{if(rt.data instanceof ArrayBuffer){const ct=VJ(new Uint8Array(rt.data));if(rn("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")&&Ut.debug("[".concat(this._inspectId,"] Response message for worker of inspect content "),JSON.stringify(ct)),ct.code===200){if(Array.isArray(this.inspectType)&&this.inspectType.length===1&&this.inspectType[0]==="supervise")return void this.emit(Bl.INSPECT_RESULT,void 0,void 0);if(ct.data&&ct.data.scorePorn&&ct.data.scoreSexy&&ct.data.scoreNeutral){var it;const ut={porn:ct.data.scorePorn,sexy:ct.data.scoreSexy,neutral:ct.data.scoreNeutral},pt=_p(it=Object.keys(ut)).call(it,(_t,vt)=>ut[_t]>ut[vt]?_t:vt,"porn"),mt=Object.keys(ut).find(_t=>_t===pt);this.emit(Bl.INSPECT_RESULT,mt)}else this.emit(Bl.INSPECT_RESULT,void 0,new $n(tn.UNEXPECTED_RESPONSE,ct.code+"","There is an unexpected data on message"))}else this.emit(Bl.INSPECT_RESULT,void 0,new $n(tn.UNEXPECTED_RESPONSE,ct.code+"",ct.msg))}else Ut.error("[".concat(this._inspectId,"] Unexpected message type from worker")),this.emit(Bl.INSPECT_RESULT,void 0,new $n(tn.UNEXPECTED_RESPONSE,"invalid worker message type"))}),this.workerConnection.on(ho.CLOSED,()=>{this.connectionState=Rm.CLOSED}),this.workerConnection.on(ho.FAILED,()=>{this.connectionState=Rm.CLOSED}),this.workerConnection.on(ho.RECONNECTING,()=>{this.connectionState=this.connectionState===Rm.CONNECTED?Rm.RECONNECTING:Rm.CONNECTING}),this.workerConnection.on(ho.WILL_RECONNECT,(rt,it,ct)=>{rt==="recover"&&ct(rt),ct("tryNext")}),this.workerConnection.on(ho.REQUEST_NEW_URLS,(rt,it)=>{this.workerManagerConnection.close(),this.once(Bl.REQUEST_NEW_WORKER_URL,ct=>{rt([ct])}),this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(ct=>{this.connectWorkerManager(ct,!0)}).catch(ct=>{it(ct)})})}async requestToInspectImage(){this.sequence++;const rt=Dp(this,Bl.CLIENT_LOCAL_VIDEO_TRACK),it={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(rt){if(!rt.isPlaying)return void this.emit(Bl.INSPECT_RESULT,void 0,new $n(tn.INVALID_OPERATION,"Only the track being played can be inspected"));const ct=await this.generateRequestData(rt,it);this.workerConnection.sendMessage(ct,!0,!0)}else this.emit(Bl.INSPECT_RESULT,void 0,new $n(tn.INVALID_OPERATION,"Only the track being published can be inspected"))}async generateRequestData(rt,it){let{appId:ct,cname:ut,cid:pt,vid:mt,sid:_t,uid:vt}=it;const Tt=Date.now(),bt=await rt.getCurrentFrameImage("image/jpeg",this.quality),Ot=await IB(bt,ct,ut),Mt=this.sequence+"-"+pt+"-"+vt+"-"+Tt+"-"+ms(12,""),Dt={appId:ct,cid:pt,cname:ut,deviceId:"",elapse:(jt=Number(Tt-this.inspectStartTime),{low:jt|=0,high:jt>>31,unsigned:jt>=0}),fileSize:Ot.byteLength,jpgEncryption:2,height:bt.height,width:bt.width,jpg:Ot,networkType:6,osType:7,requestId:Mt,sdkVersion:"4.24.0",sequence:this.sequence,sid:_t,timestamp:r5(Tt),uid:vt,vid:mt,service:this._inspectMode,callbackData:this.extraInfo,ossFilePrefix:this.ossFilePrefix};var jt;this.extraInfo===void 0&&delete Dt.callbackData,this.ossFilePrefix===void 0&&delete Dt.ossFilePrefix;const $t=FJ(Dt);if($t.byteLength<this.workerMessageLengthLimit){if(rn("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")){const Ht=function(en){for(var Qt=1;Qt<arguments.length;Qt++){var on=arguments[Qt]!=null?arguments[Qt]:{};Qt%2?XG(Object(on),!0).forEach(function(Tn){Jt(en,Tn,on[Tn])}):Object.getOwnPropertyDescriptors?Object.defineProperties(en,Object.getOwnPropertyDescriptors(on)):XG(Object(on)).forEach(function(Tn){Object.defineProperty(en,Tn,Object.getOwnPropertyDescriptor(on,Tn))})}return en}({},Dt);delete Ht.jpg,Ut.debug("[".concat(this._inspectId,"] Request message for worker of inspect content "),JSON.stringify(Ht))}return $t}{const Ht=this.quality*this.qualityRatio;return this.quality=Ht,await this.generateRequestData(rt,{appId:ct,cname:ut,cid:pt,vid:mt,sid:_t,uid:vt})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=Xu.CancelToken.source(),this.workerManagerConnection&&this.workerManagerConnection.close(),this.workerConnection&&this.workerConnection.close(),this.inspectTimer&&window.clearInterval(this.inspectTimer),this.inspectTimer=null,this.connectionState=Rm.CLOSED,this.emit(Bl.STATE_CHANGE,wm.CLOSED)}}const XJ={name:"ContentInspect",create:function(_e){let{config:rt}=_e;return function(it){if(!it)throw new $n(tn.INVALID_PARAMS,"inspectConfig is necessary.");if(!it.inspectType||!Array.isArray(it.inspectType))throw new $n(tn.INVALID_PARAMS,"inspectConfig.inspectType is necessary and is an instance of Array.");{const ct=[...new Set(it.inspectType)];ct.forEach(ut=>{var pt;if(!Er(pt=["supervise","moderation"]).call(pt,ut))throw new $n(tn.INVALID_PARAMS,"".concat(ut," is not a valid inspect type."))}),it.inspectType=ct}if(it&&it.extraInfo&&it.extraInfo.length>1024)throw new $n(tn.INVALID_PARAMS,"inspectConfig.extraInfo length cannot exceed 1024 bytes")}(rt),new YJ(rt)}};var qG=st(rr.Object.getOwnPropertySymbols),qJ=Ko,JJ=eE.indexOf,ZJ=Dv,CP=qt([].indexOf),JG=!!CP&&1/CP([1],1,-0)<0;qJ({target:"Array",proto:!0,forced:JG||!ZJ("indexOf")},{indexOf:function(_e){var rt=arguments.length>1?arguments[1]:void 0;return JG?CP(this,_e,rt)||0:JJ(this,_e,rt)}});var QJ=tp("Array","indexOf"),eZ=yt,tZ=QJ,bP=Array.prototype,nZ=function(_e){var rt=_e.indexOf;return _e===bP||eZ(bP,_e)&&rt===bP.indexOf?tZ:rt},ZG=st(nZ);function rZ(_e,rt){if(_e==null)return{};var it,ct,ut=function(mt,_t){if(mt==null)return{};var vt={};for(var Tt in mt)if({}.hasOwnProperty.call(mt,Tt)){if(ZG(_t).call(_t,Tt)!==-1)continue;vt[Tt]=mt[Tt]}return vt}(_e,rt);if(qG){var pt=qG(_e);for(ct=0;ct<pt.length;ct++)it=pt[ct],ZG(rt).call(rt,it)===-1&&{}.propertyIsEnumerable.call(_e,it)&&(ut[it]=_e[it])}return ut}let QG=class{get localCapabilities(){return Ds(this._localCapabilities)}get rtpCapabilities(){return Ds(this._rtpCapabilities)}get candidates(){return Ds(this._candidates)}get iceParameters(){return Ds(this._iceParameters)}get dtlsParameters(){return Ds(this._dtlsParameters)}constructor(_e){Jt(this,"sessionDesc",void 0),Jt(this,"_localCapabilities",void 0),Jt(this,"_rtpCapabilities",void 0),Jt(this,"_candidates",void 0),Jt(this,"_iceParameters",void 0),Jt(this,"_dtlsParameters",void 0),Jt(this,"setup",void 0),Jt(this,"currentMidIndex",void 0),Jt(this,"cname","o/i14u9pJrxRKAsu"),Jt(this,"firefoxSsrcMidMap",new Map),_e=Ds(_e);const{remoteIceParameters:rt,remoteDtlsParameters:it,candidates:ct,remoteRTPCapabilities:ut,localCapabilities:pt,direction:mt,setup:_t,videoCodec:vt,audioCodec:Tt}=_e;let bt;this.setup=_t,bt=mt===Gu.RECEIVE_ONLY?op(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`):op(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`),this._rtpCapabilities=ut,this._candidates=ct,this._iceParameters=rt,this._dtlsParameters=it,this._localCapabilities=pt;const Ot=mt===Gu.RECEIVE_ONLY?this.rtpCapabilities.send:this.rtpCapabilities.recv,Mt=mt===Gu.RECEIVE_ONLY?this._localCapabilities.recv:this._localCapabilities.send,Dt=mt===Gu.RECEIVE_ONLY?ut.send.videoCodecs:OA(Pr.VIDEO,Ot,Mt,vt),jt=mt===Gu.RECEIVE_ONLY?ut.send.audioCodecs:OA(Pr.AUDIO,Ot,Mt,Tt);for(const $t of bt.mediaDescriptions)$t.attributes.iceUfrag=rt.iceUfrag,$t.attributes.icePwd=rt.icePwd,$t.attributes.fingerprints=it.fingerprints,$t.attributes.candidates=ct,$t.attributes.setup=this.setup,$t.media.mediaType==="application"&&($t.attributes.sctpPort="5000"),$t.media.mediaType==="video"&&($t.media.fmts=Dt.map(Ht=>Ht.payloadType.toString(10)),$t.attributes.payloads=Dt,$t.attributes.extmaps=Ot.videoExtensions),$t.media.mediaType==="audio"&&($t.media.fmts=jt.map(Ht=>Ht.payloadType.toString(10)),$t.attributes.payloads=jt,$t.attributes.extmaps=Ot.audioExtensions,US($t));this.sessionDesc=bt,this.currentMidIndex=bt.mediaDescriptions.length-1}toString(){return rv(this.sessionDesc)}hasMid(_e){return Array.isArray(_e)?_e.every(rt=>this.hasMid(rt)):this.sessionDesc.mediaDescriptions.some(rt=>rt.attributes.mid===_e)}send(_e,rt,it,ct,ut){it=it.replace(/ /g,"-");const{ssrcs:pt,ssrcGroups:mt}=xA(rt,this.cname,rn("SYNC_GROUP")?it:void 0),_t=this.findPreloadMediaDesc(pt);if(_t){if(Gs()&&this.firefoxSsrcMidMap.set(pt[0].ssrcId,_t.attributes.mid),ut&&(ut.twcc||ut.remb)){const vt=this.sessionDesc.mediaDescriptions.indexOf(_t);return this.sessionDesc.mediaDescriptions[vt]=this.mungSendMediaDesc(_t,ut),{mid:_t.attributes.mid,needExchangeSDP:!0}}return{mid:_t.attributes.mid,needExchangeSDP:!1}}{const vt=this.findAvailableMediaIndex(_e,pt,ct);let Tt;return vt===-1?(Tt=this.createOrRecycleSendMedia(_e,pt,mt,"sendonly",ct,ut),this.updateBundleMids()):(Tt=Ds(this.sessionDesc.mediaDescriptions[vt]),Tt.attributes.direction="sendonly",Tt.attributes.ssrcs=pt,Tt.attributes.ssrcGroups=mt,this.sessionDesc.mediaDescriptions[vt]=this.mungSendMediaDesc(Tt,ut)),Gs()&&this.firefoxSsrcMidMap.set(pt[0].ssrcId,Tt.attributes.mid),{needExchangeSDP:!0,mid:Tt.attributes.mid}}}stopSending(_e){const rt=this.sessionDesc.mediaDescriptions.filter(it=>it.attributes.mid&&_e.indexOf(it.attributes.mid)!==-1);if(rt.length!==_e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");rt.forEach(it=>{it.attributes.ssrcs=[]}),this.updateBundleMids()}receive(_e,rt,it){const ct=[];return _e.forEach(ut=>{const pt=ut._mediaStreamTrack.kind,mt=this.findAvailableRecvMediaIndex(pt);let _t,vt=!1;mt===-1?(vt=!0,_t=this.createOrRecycleRecvMedia(ut,[],"recvonly",rt,it),this.updateBundleMids()):(_t=Ds(this.sessionDesc.mediaDescriptions[mt]),_t.attributes.direction="recvonly"),ct.push({mid:_t.attributes.mid,needCreateTransceiver:vt})}),ct}stopReceiving(_e){const rt=this.sessionDesc.mediaDescriptions.filter(it=>_e.indexOf(it.attributes.mid)!==-1);if(rt.length!==_e.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");rt.forEach(it=>{it.media.port="0",it.attributes.direction="inactive"}),this.updateBundleMids()}addRemoteCandidate(_e){const{foundation:rt,protocol:it,address:ct,port:ut,type:pt,relatedAddress:mt,relatedPort:_t,priority:vt}=new RTCIceCandidate(_e),Tt={foundation:rt??"",componentId:"1",transport:it??"",priority:vt?vt+"":"",connectionAddress:ct??"",port:ut?ut+"":"",type:pt?pt+"":"",relAddr:mt??"",relPort:_t?_t+"":"",extension:{}};this.candidates.some(bt=>bt.priority===Tt.priority&&bt.connectionAddress===Tt.connectionAddress&&bt.port===Tt.port)||(this._candidates.push(Tt),this.sessionDesc.mediaDescriptions.forEach(bt=>{bt.attributes.candidates=this.candidates}))}clearRemoteCandidate(){this._candidates=[],this.sessionDesc.mediaDescriptions[0].attributes.candidates=this._candidates}createOrRecycleRecvMedia(_e,rt,it,ct,ut){const pt=_e._mediaStreamTrack.kind,mt=this.rtpCapabilities.recv,_t=OA(pt,mt,this.localCapabilities.send,pt===Pr.AUDIO?ut:ct),vt=pt===Pr.VIDEO?mt.videoExtensions:mt.audioExtensions,Tt="".concat(++this.currentMidIndex);let bt={media:{mediaType:pt,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:_t.map(Mt=>Mt.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:vt,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:rt,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:_t,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:it,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(Tt)}};bt=this.mungRecvMediaDsec(bt,_e);const Ot=this.findFirstClosedMedia(pt);if(Ot){const Mt=this.sessionDesc.mediaDescriptions.indexOf(Ot);this.sessionDesc.mediaDescriptions[Mt]=bt}else this.sessionDesc.mediaDescriptions.push(bt);return bt}muteRemote(_e){const rt=this.sessionDesc.mediaDescriptions.filter(it=>Er(_e).call(_e,it.attributes.mid||""));if(rt.length!==_e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");rt.forEach(it=>{it.attributes.direction="inactive"})}unmuteRemote(_e){const rt=this.sessionDesc.mediaDescriptions.filter(it=>Er(_e).call(_e,it.attributes.mid||""));if(rt.length!==_e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");rt.forEach(it=>{it.attributes.direction="recvonly"})}findAvailableMediaIndex(_e,rt,it){return this.sessionDesc.mediaDescriptions.findIndex(ct=>{const ut=ct.media.mediaType===_e&&ct.media.port!=="0"&&(ct.attributes.direction==="sendonly"||ct.attributes.direction==="sendrecv")&&ct.attributes.ssrcs.length===0;if(Gs()){if(ut){const pt=this.firefoxSsrcMidMap.get(rt[0].ssrcId);return!(pt||ct.attributes.mid!=="0"&&ct.attributes.mid!=="1")||!(!pt||pt!==ct.attributes.mid)}return!1}return ut&&ct.attributes.mid===it})}findAvailableRecvMediaIndex(_e){return this.sessionDesc.mediaDescriptions.findIndex(rt=>{const it=rt.media.mediaType===_e&&rt.media.port!=="0"&&(rt.attributes.direction==="recvonly"||rt.attributes.direction==="sendrecv");return rt.attributes.mid!=="0"&&rt.attributes.mid!=="1"&&it})}predictReceivingMids(_e){const rt=[];for(let it=0;it<_e;it++)rt.push((this.currentMidIndex+it+1).toString(10));return rt}restartICE(_e){_e=Ds(_e),this._iceParameters=_e,this.sessionDesc.mediaDescriptions.forEach(rt=>{rt.attributes.iceUfrag=_e.iceUfrag,rt.attributes.icePwd=_e.icePwd})}createOrRecycleSendMedia(_e,rt,it,ct,ut,pt){const mt=this.rtpCapabilities.send,_t=_e===Pr.VIDEO?mt.videoCodecs:mt.audioCodecs,vt=_e===Pr.VIDEO?mt.videoExtensions:mt.audioExtensions;Gs()&&(ut="".concat(++this.currentMidIndex));let Tt={media:{mediaType:_e,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:_t.map(Ot=>Ot.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:vt,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:rt,ssrcGroups:it,rtcpFeedbackWildcards:[],payloads:_t,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:ct,rtcpMux:!0,rtcpRsize:!0,mid:ut}};Tt=this.mungSendMediaDesc(Tt,pt);const bt=this.findFirstClosedMedia(_e);if(bt){const Ot=this.sessionDesc.mediaDescriptions.indexOf(bt);this.sessionDesc.mediaDescriptions[Ot]=Tt}else this.sessionDesc.mediaDescriptions.push(Tt);return Tt}mungRecvMediaDsec(_e,rt,it){const ct=Ds(_e);return SM(ct),kS(ct,rt),TM(ct,rt),zV(ct),Ww(ct,it,this.localCapabilities.send),ct}mungSendMediaDesc(_e,rt){const it=Ds(_e);return Ww(it,rt,this.localCapabilities.recv),US(it),it}updateRecvMedia(_e,rt){const it=this.sessionDesc.mediaDescriptions.findIndex(ct=>ct.attributes.mid===_e);if(it!==-1){const ct=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[it],rt);this.sessionDesc.mediaDescriptions[it]=ct}}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(_e=>_e.media.port!=="0").map(_e=>_e.attributes.mid)}findPreloadMediaDesc(_e){return this.sessionDesc.mediaDescriptions.find(rt=>{var it;return((it=rt.attributes)===null||it===void 0||(it=it.ssrcs[0])===null||it===void 0?void 0:it.ssrcId)===_e[0].ssrcId})}findFirstClosedMedia(_e){return this.sessionDesc.mediaDescriptions.find(rt=>Gs()?rt.media.port==="0"&&rt.media.mediaType===_e:rt.media.port==="0")}};const iZ=["sdp"];var bs;function e$(_e,rt){var it=Object.keys(_e);if(Object.getOwnPropertySymbols){var ct=Object.getOwnPropertySymbols(_e);rt&&(ct=ct.filter(function(ut){return Object.getOwnPropertyDescriptor(_e,ut).enumerable})),it.push.apply(it,ct)}return it}function Tv(_e){for(var rt=1;rt<arguments.length;rt++){var it=arguments[rt]!=null?arguments[rt]:{};rt%2?e$(Object(it),!0).forEach(function(ct){Jt(_e,ct,it[ct])}):Object.getOwnPropertyDescriptors?Object.defineProperties(_e,Object.getOwnPropertyDescriptors(it)):e$(Object(it)).forEach(function(ct){Object.defineProperty(_e,ct,Object.getOwnPropertyDescriptor(it,ct))})}return _e}let t$=(bs=class QS extends wV{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var rt,it;return(rt=(it=this.peerConnection.getReceivers()[0])===null||it===void 0||(it=it.transport)===null||it===void 0?void 0:it.state)!==null&&rt!==void 0?rt:null}get localCodecs(){return[]}set isInRestartIce(rt){this._isInRestartIce=rt}get isInRestartIce(){return this._isInRestartIce}constructor(rt,it,ct){super(rt,it),Jt(this,"direction",void 0),Jt(this,"name",void 0),Jt(this,"store",void 0),Jt(this,"spec",void 0),Jt(this,"peerConnection",void 0),Jt(this,"initialOffer",void 0),Jt(this,"transport",void 0),Jt(this,"statsFilter",void 0),Jt(this,"localCandidateCount",0),Jt(this,"_isInRestartIce",!1),Jt(this,"mutex",void 0),Jt(this,"onLocalCandidate",void 0),Jt(this,"remoteSDP",void 0),Jt(this,"pendingCandidates",[]),Jt(this,"localCapabilities",void 0),Jt(this,"isReady",!1),Jt(this,"restartCnt",0),Jt(this,"curTurnServerIndex",0),this.store=it,this.spec=rt,this.mutex=new lu("P2PConnection-mutex",it.clientId),this.peerConnection=new RTCPeerConnection(QS.resolvePCConfiguration(rt,it.p2pTransport),{optional:[{googDscp:!0}]}),this.direction=ct??Gu.SEND_ONLY,this.name=this.direction===Gu.SEND_ONLY?"sendP2PConnection":"recvP2PConnection",this.statsFilter=OO(this.peerConnection,rn("STATS_UPDATE_INTERVAL"),void 0,Gs()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1}async establish(rt){try{const it=await KV();if(this.localCapabilities=Kw(it),rt){const{sdp:ct}=rt,ut=rZ(rt,iZ),pt=function(){const bt={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},Ot=IA(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"sendonly"),Mt={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},Dt={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},jt={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(Im(Ot,bt,"videoExtensions",Mt,Dt,jt),Im(Ot,bt,"videoCodecs",Mt,Dt,jt),Im(Ot,bt,"audioExtensions",Mt,Dt,jt),Im(Ot,bt,"audioCodecs",Mt,Dt,jt),rn("RAISE_H264_BASELINE_PRIORITY")){const $t=jt.videoCodecs.findIndex(Ht=>Ht.rtpMap&&Ht.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&Ht.fmtp&&Ht.fmtp.parameters["profile-level-id"]==="42001f");if($t!==-1){const Ht=jt.videoCodecs.findIndex(en=>en.rtpMap&&en.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(Ht<$t){Ut.debug("raising H264 baseline profile priority");const en=jt.videoCodecs[$t];jt.videoCodecs.splice($t,1),jt.videoCodecs.splice(Ht,0,en)}Ht!==-1&&rn("FILTER_SEND_H264_BASELINE")&&(Mt.videoCodecs=Mt.videoCodecs.filter(en=>!(en.rtpMap&&en.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&en.fmtp&&en.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:Mt,recv:Dt,sendrecv:jt}}({},{},ct);this.remoteSDP=new QG({remoteIceParameters:ut.iceParameters,remoteDtlsParameters:ut.dtlsParameters,candidates:[],remoteRTPCapabilities:pt,localCapabilities:this.localCapabilities,direction:this.direction,setup:"actpass",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()}),this.isReady=!0;const mt=await this.peerConnection.createAnswer();if(!mt.sdp)throw new Error("Cannot get answer sdp when trying to establish PeerConnection.");const _t=lv(mt.sdp);await this.peerConnection.setLocalDescription(mt);const vt=await YV({},{},mt.sdp);this.localCapabilities=Kw(vt);const Tt=this.peerConnection.getTransceivers()[0];return Tt!=null&&Tt.receiver&&Tt.receiver.transport&&this.tryBindTransportEvents(Tt.receiver.transport),Tv(Tv({},_t),{},{sdp:mt.sdp})}{this.peerConnection.addTransceiver("video",{direction:"sendonly"}),this.peerConnection.addTransceiver("audio",{direction:"sendonly"});const ct=await this.peerConnection.createOffer();if(!ct.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const ut=lv(ct.sdp);return this.initialOffer=ct,Tv(Tv({},ut),{},{sdp:ct.sdp})}}catch(it){throw new Yn(tn.GET_LOCAL_CONNECTION_PARAMS_FAILED,it.toString())}}async connect(rt){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");await this.peerConnection.setLocalDescription(this.initialOffer);const{sdp:it,iceParameters:ct,dtlsParameters:ut}=rt,pt=await YV({},{},it);this.remoteSDP=new QG({remoteIceParameters:ct,remoteDtlsParameters:ut,candidates:[],remoteRTPCapabilities:pt,localCapabilities:this.localCapabilities,direction:this.direction,setup:"active",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()});const mt=this.peerConnection.getTransceivers()[0];mt!=null&&mt.sender&&mt.sender.transport&&this.tryBindTransportEvents(mt.sender.transport)}catch(it){throw new Yn(tn.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(it.toString()))}}async addRemoteCandidate(rt){try{rt&&this.pendingCandidates.push(rt),this.peerConnection.remoteDescription&&this.isReady&&(this.pendingCandidates.forEach(it=>{this.peerConnection.addIceCandidate(it)}),this.pendingCandidates=[])}catch(it){throw new Yn(tn.ADD_CANDIDATE_FAILED,"P2PConnection.addRemoteCandidate failed; ".concat(it.toString()))}}send(rt,it,ct){var ut=this;return Jp(function*(){const pt=yield Bo(ut.mutex.lock("From P2PConnection.send"));try{if(!ut.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const mt=[],_t=ut.remoteSDP.receive(rt,it,ct);rt.forEach((Ht,en)=>{if(_t[en].needCreateTransceiver){const Qt=ut.peerConnection.addTransceiver(Ht._mediaStreamTrack,{direction:"sendonly"});mt.push(Qt),Ht._updateRtpTransceiver(Qt)}else{const Qt=ut.peerConnection.getTransceivers().find(on=>on.mid===_t[en].mid);if(!Qt)throw new Error("cannot find transceiver when sendPeerconnection send, mid is ".concat(_t[en].mid));mt.push(Qt),Ht._updateRtpTransceiver(Qt)}}),Gs()&&rn("SIMULCAST")===!0&&(yield Bo(ut.applySimulcastForFirefox(mt,rt)));const vt=_t.map(Ht=>Ht.mid),Tt=yield Bo(ut.peerConnection.createOffer()),bt=ut.mungSendOfferSDP(Tt.sdp,rt,vt),Ot=op(bt),Mt=vt.map(Ht=>{const en=Ot.mediaDescriptions.find(Qt=>Qt.attributes.mid===Ht);if(!en)throw new Error("Cannot extract ssrc from mediaDescription.");return $V(en,rn("USE_PUB_RTX"))}),Dt=mt.map((Ht,en)=>{const Qt=vt[en];return{localSSRC:Mt[en],id:Qt}});yield Bo(ut.peerConnection.setLocalDescription({type:"offer",sdp:bt}));try{yield Dt}catch(Ht){const en=ut.remoteSDP.toString();throw yield Bo(ut.peerConnection.setLocalDescription({type:"offer",sdp:bt})),yield Bo(ut.peerConnection.setRemoteDescription({type:"answer",sdp:en})),yield Bo(ut.stopSending(vt,!0)),Ht}yield Bo(ut.applySimulcastEncodings(mt,rt)),yield Bo(ut.applySendEncodings(mt,rt));const jt=ut.remoteSDP.toString(),$t=ut.logSDPExchange(bt,"offer","local","send");return $t==null||$t(jt),yield Bo(ut.setRemoteDescription({type:"answer",sdp:jt})),mt.map((Ht,en)=>{const Qt=vt[en];return{localSSRC:Mt[en],id:Qt}})}catch(mt){throw mt instanceof Yn?mt:new Yn(tn.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(mt.toString()))}finally{pt()}})()}async stopSending(rt,it){const ct=it?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const ut=this.peerConnection.getTransceivers().filter(vt=>rt.indexOf(vt.mid)!==-1);if(ut.length!==rt.length)throw new Error("Transceivers' length (".concat(ut.length,") doesn't match mids' length (").concat(rt.length,") when trying to call P2PConnection.stopSending."));ut.map(vt=>{var Tt;vt.direction="inactive",(Tt=vt.stop)===null||Tt===void 0||Tt.call(vt)});const pt=await this.peerConnection.createOffer(),mt=this.logSDPExchange(pt.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(pt),this.remoteSDP.stopReceiving(rt);const _t=this.remoteSDP.toString();mt==null||mt(_t),await this.setRemoteDescription({type:"answer",sdp:_t})}catch(ut){throw new Yn(tn.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(ut.toString()))}finally{ct&&ct()}}async receive(rt,it,ct,ut){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(rt," before remoteSDP created."));const{mid:pt,needExchangeSDP:mt}=this.remoteSDP.send(rt,it,ct,ut);if(mt){const vt=this.remoteSDP.toString(),Tt=this.logSDPExchange(vt,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:vt});const bt=await this.peerConnection.createAnswer(),Ot=this.mungReceiveAnswerSDP(bt.sdp,pt,rt);Tt==null||Tt(Ot||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:Ot}),Ut.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(rt," by exchanging SDP."))}else Ut.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(rt," no need to exchange SDP."));const _t=this.peerConnection.getTransceivers().find(vt=>vt.mid===pt);if(!_t||_t.mid===null)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:_t.receiver.track,mid:_t.mid,transceiver:_t}}catch(pt){throw new Yn(tn.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(pt.toString()))}}async mockReceive(rt,it,ct,ut){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(rt," before remoteSDP created."));const{mid:pt,needExchangeSDP:mt}=this.remoteSDP.send(rt,it,ct,ut);if(mt){const _t=this.remoteSDP.toString(),vt=this.logSDPExchange(_t,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:_t});const Tt=await this.peerConnection.createAnswer(),bt=this.mungReceiveAnswerSDP(Tt.sdp,pt,rt);vt==null||vt(bt||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:bt}),Ut.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(rt," by exchanging SDP."))}else Ut.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(rt," no need to exchange SDP."))}catch(pt){throw new Yn(tn.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(pt.toString()))}}async stopReceiving(rt){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(rt);const it=this.remoteSDP.toString(),ct=this.logSDPExchange(it,"offer","remote","stopReceiving");await this.setRemoteDescription({type:"offer",sdp:it});const ut=await this.peerConnection.createAnswer();ct==null||ct(ut.sdp||""),await this.peerConnection.setLocalDescription(ut)}catch(it){throw new Yn(tn.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(it.toString()))}}async restartICE(rt){try{if(this.store.p2pTransport===E0.Auto&&(this.store.p2pTransport=E0.SdRtn,Fo().supportPCSetConfiguration&&this.peerConnection.setConfiguration(QS.resolvePCConfiguration(this.spec,this.store.p2pTransport))),this.restartCnt>3&&(this.restartCnt=0,Fo().supportPCSetConfiguration&&this.peerConnection.setConfiguration(QS.resolvePCConfiguration(this.spec,this.store.p2pTransport,++this.curTurnServerIndex))),!rt){this.restartCnt++,this.isReady=!1;const it=await this.peerConnection.createOffer({iceRestart:!0});if(!it.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const{iceParameters:ct}=lv(it.sdp);return this.store.descriptionStart(),this.direction===Gu.SEND_ONLY&&await this.peerConnection.setLocalDescription(it),ct}if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");if(this.remoteSDP.restartICE(rt),this.store.descriptionStart(),this.direction===Gu.RECEIVE_ONLY){this.restartCnt++,await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()});const it=await this.peerConnection.createAnswer();if(!it.sdp)throw new Error("Cannot get answer sdp when trying to iceRestart.");const{iceParameters:ct}=lv(it.sdp);return await this.peerConnection.setLocalDescription(it),ct}await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()}),this.isReady=!0}catch(it){throw new Yn(tn.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(it.toString()))}}close(){var rt;this.peerConnection.close(),this.peerConnection.onicecandidate=null,(rt=this.onConnectionStateChange)===null||rt===void 0||rt.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.transport=void 0,this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(rt){return this.statsFilter.getVideoIsReady(rt)}async updateEncoderConfig(rt,it){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const ct=await this.peerConnection.createOffer(),ut=this.mungSendOfferSDP(ct.sdp,[it],[rt]);this.remoteSDP.updateRecvMedia(rt,it);const pt=this.remoteSDP.toString(),mt=this.logSDPExchange(ut,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:ut}),mt==null||mt(pt),await this.peerConnection.setRemoteDescription({type:"answer",sdp:pt})}catch(ct){throw new Yn(tn.EXCHANGE_SDP_FAILED,ct.toString())}}async updateSendParameters(rt,it){const ct=this.peerConnection.getTransceivers().filter(ut=>ut.mid===rt);ct.length===1&&(this.isVP8Simulcast(it)?Gs()||await this.applySimulcastEncodings(ct,[it]):await this.applySendEncodings(ct,[it]))}setStatsRemoteVideoIsReady(rt,it){this.statsFilter.setVideoIsReady2(rt,it)}async replaceTrack(rt,it){const ct=this.peerConnection.getTransceivers().find(ut=>ut.mid===it);ct&&await ct.sender.replaceTrack(rt._mediaStreamTrack)}async getSelectedCandidatePair(){const rt=this.peerConnection.getReceivers();if(rt.length>0&&rt[0].transport&&rt[0].transport.iceTransport&&rt[0].transport.iceTransport.getSelectedCandidatePair&&rt[0].transport.iceTransport.getSelectedCandidatePair()){const it=rt[0].transport.iceTransport,{local:ct,remote:ut}=it.getSelectedCandidatePair();return{local:Tv(Tv({},P_),{},{candidateType:ct.type,protocol:ct.protocol,address:ct.address,port:ct.port}),remote:Tv(Tv({},P_),{},{candidateType:ut.type,protocol:ut.protocol,address:ut.address,port:ut.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var rt,it;Er(rt=["connected","completed"]).call(rt,this.peerConnection.iceConnectionState)&&(this.isReady=!1),(it=this.onICEConnectionStateChange)===null||it===void 0||it.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var rt;this.peerConnection.connectionState==="connected"&&(this.restartCnt=0),(rt=this.onConnectionStateChange)===null||rt===void 0||rt.call(this,this.peerConnection.connectionState)},this.startICECandidate()}startICECandidate(){this.peerConnection.onicecandidate||(this.localCandidateCount=0,this.peerConnection.onicecandidate=rt=>{if(rt.candidate){var it;rt.candidate.candidate&&((it=this.onLocalCandidate)===null||it===void 0||it.call(this,rt.candidate.toJSON())),this.localCandidateCount+=1}else Ut.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount)})}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(rt,it){let ct=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const ut={iceServers:[]};var pt;return rt.iceServers?ut.iceServers=rt.iceServers:rt.turnServer&&rt.turnServer.mode!=="off"&&(pA(rt.turnServer.servers)?ut.iceServers=rt.turnServer.servers:(ut.iceServers&&ut.iceServers.push(...QS.turnServerConfigToIceServers(rt.turnServer.servers,it,ct)),rn("USE_TURN_SERVER_OF_GATEWAY")&&ut.iceServers&&rt.turnServer.serversFromGateway&&ut.iceServers.push(...QS.turnServerConfigToIceServers(rt.turnServer.serversFromGateway,it,ct)),Er(pt=[E0.Relay,E0.SdRtn]).call(pt,it)&&(ut.iceTransportPolicy="relay"),rn("FORCE_TURN_TCP")?ut.iceTransportPolicy="relay":rt.turnServer.servers.concat(rt.turnServer.serversFromGateway||[]).forEach(mt=>{mt.forceturn&&(ut.iceTransportPolicy="relay")}))),rn("ENABLE_ENCODED_TRANSFORM")&&Fo().supportWebRTCEncodedTransform&&(ut.encodedInsertableStreams=!0),Ut.debug("P2PConnection p2pTransport is ".concat(it)),ut}static turnServerConfigToIceServers(rt,it){let ct=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const ut=[],pt=rt.filter(_t=>_t.tcpport);Ut.debug("P2PConnection turnServers is ".concat(pt,", current index is ").concat(ct));const mt=pt.length>ct?pt[ct]:pt[0];switch(it){case E0.SdRtn:const _t=rt.filter(Tt=>{var bt;return Er(bt=Tt.username).call(bt,"glb:")&&Tt.turnServerURL==Tt.turnServerURL}),vt=_t.length>ct?_t[ct]:_t[0];vt&&(ut.push({username:vt.username,credential:vt.password,credentialType:"password",urls:"turn:".concat(av(vt.turnServerURL),":").concat(vt.tcpport,"?transport=udp")}),ut.push({username:vt.username,credential:vt.password,credentialType:"password",urls:"turns:".concat(av(vt.turnServerURL),":").concat(vt.tcpport,"?transport=tcp")}));break;case E0.Relay:mt&&(ut.push({username:mt.username,credential:mt.password,credentialType:"password",urls:"turn:".concat(mt.turnServerURL,":").concat(mt.tcpport,"?transport=udp")}),ut.push({username:mt.username,credential:mt.password,credentialType:"password",urls:"turns:".concat(av(mt.turnServerURL),":").concat(mt.tcpport,"?transport=tcp")}));break;default:mt&&(ut.push({username:mt.username,credential:mt.password,credentialType:"password",urls:"turn:".concat(mt.turnServerURL,":").concat(mt.tcpport,"?transport=udp")}),ut.push({username:mt.username,credential:mt.password,credentialType:"password",urls:"turns:".concat(av(mt.turnServerURL),":").concat(mt.tcpport,"?transport=tcp")}),ut.push({username:mt.username,credential:mt.password,credentialType:"password",urls:"stun:".concat(mt.turnServerURL,":").concat(mt.tcpport)}))}return ut}tryBindTransportEvents(rt){if(rt){this.transport=rt,rt.onstatechange=()=>{var ct;rt!=null&&rt.state&&((ct=this.onDTLSTransportStateChange)===null||ct===void 0||ct.call(this,rt.state))},rt.onerror=ct=>{var ut;(ut=this.onDTLSTransportError)===null||ut===void 0||ut.call(this,"error"in ct?ct.error:ct)};const it=rt.iceTransport;it&&(it.onstatechange=()=>{const ct=rt==null?void 0:rt.iceTransport.state;var ut;ct&&((ut=this.onICETransportStateChange)===null||ut===void 0||ut.call(this,ct))},it.getSelectedCandidatePair&&(it.onselectedcandidatepairchange=()=>{if(it.getSelectedCandidatePair()){const{local:ct,remote:ut}=it.getSelectedCandidatePair()||{};if(ct&&ut){const pt=ct.address+":"+ct.port,mt=ut.address+":"+ut.port;Ut.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify(R0(pt)),", remote ").concat(JSON.stringify(R0(mt))))}}}))}}tryUnbindTransportEvents(){this.transport&&(this.transport.onstatechange=null,this.transport.onerror=null,this.transport.iceTransport&&(this.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(rt,it){var ct;if(it||(it=this.peerConnection.getSenders().find(bt=>bt.track===rt._mediaStreamTrack)),!it)return Ut.warn("[".concat(rt.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(rt))return Ut.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!Fo().supportSetRtpSenderParameters)return Ut.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const ut={},pt={};switch(rt._optimizationMode){case"motion":ut.degradationPreference="maintain-framerate";break;case"detail":ut.degradationPreference="maintain-resolution";break;default:ut.degradationPreference="balanced"}if(rt._encoderConfig){var mt;const{bitrateMax:bt,frameRate:Ot,scaleResolutionDownBy:Mt}=rt._encoderConfig;bt&&(pt.maxBitrate=1e3*bt),Er(mt=rt._hints).call(mt,ds.LOW_STREAM)&&(Ot&&(pt.maxFramerate=bp(Ot)),Mt&&Mt>=1&&(pt.scaleResolutionDownBy=Mt))}if(rn("DSCP_TYPE")&&hE()){var _t;const bt=rn("DSCP_TYPE");Er(_t=["very-low","low","medium","high"]).call(_t,bt)&&(pt.networkPriority=bt)}const vt=it.getParameters(),Tt=(ct=vt.encodings)===null||ct===void 0?void 0:ct[0];Gs()&&!Tt&&(ut.encodings=[pt]),Tt&&Object.assign(Tt,pt),Object.assign(vt,ut),Ut.debug("[".concat(rt.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(vt.encodings))),await it.setParameters(vt)}async applySendEncodings(rt,it){try{if(!Fo().supportSetRtpSenderParameters||rt.length!==it.length)return;for(let ct=0;ct<rt.length;ct++){const ut=rt[ct],pt=it[ct];pt instanceof Cs&&!this.isVP8Simulcast(pt)&&await this.updateRtpSenderEncodings(pt,ut.sender)}}catch{Ut.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(rt,it,ct){const ut=op(rt);return it.forEach((pt,mt)=>{const _t=ct[mt],vt=ut.mediaDescriptions.find(Tt=>Tt.attributes.mid===_t);vt&&(kS(vt,pt),WV(vt,pt,this.store.codec))}),rv(ut)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=rt=>{var it;(it=this.onFirstAudioReceived)===null||it===void 0||it.call(this,rt)},this.statsFilter.onFirstVideoReceived=rt=>{var it;(it=this.onFirstVideoReceived)===null||it===void 0||it.call(this,rt)},this.statsFilter.onFirstAudioDecoded=rt=>{var it;(it=this.onFirstAudioDecoded)===null||it===void 0||it.call(this,rt)},this.statsFilter.onFirstVideoDecoded=(rt,it,ct)=>{var ut;(ut=this.onFirstVideoDecoded)===null||ut===void 0||ut.call(this,rt,it,ct)},this.statsFilter.onSelectedLocalCandidateChanged=(rt,it)=>{var ct;(ct=this.onSelectedLocalCandidateChanged)===null||ct===void 0||ct.call(this,rt,it)},this.statsFilter.onSelectedRemoteCandidateChanged=(rt,it)=>{var ct;(ct=this.onSelectedRemoteCandidateChanged)===null||ct===void 0||ct.call(this,rt,it)},this.statsFilter.onFirstVideoDecodedTimeout=rt=>{var it;(it=this.onFirstVideoDecodedTimeout)===null||it===void 0||it.call(this,rt)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(rt,it){if(rt.length===it.length)for(let vt=0;vt<rt.length;vt++){var ct,ut,pt,mt,_t;const Tt=rt[vt],bt=it[vt];if(bt instanceof Cs&&!Er(ct=bt._hints).call(ct,ds.LOW_STREAM)&&(ut=bt._encoderConfig)!==null&&ut!==void 0&&ut.bitrateMax&&((pt=bt._encoderConfig)===null||pt===void 0?void 0:pt.bitrateMax)>200&&(mt=bt._scalabilityMode)!==null&&mt!==void 0&&mt.numSpatialLayers&&((_t=bt._scalabilityMode)===null||_t===void 0?void 0:_t.numSpatialLayers)>1&&this.store.codec==="vp8"){const Ot={},Mt={high:1e3*(bt._encoderConfig.bitrateMax-50),medium:5e4};Ot.encodings=[{rid:"m",active:!0,maxBitrate:Mt.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:Mt.high}];const Dt=Tt.sender.getParameters();await Tt.sender.setParameters(Object.assign(Dt,Ot))}}}async applySimulcastEncodings(rt,it){if(!Gs()&&rt.length===it.length)for(let ct=0;ct<rt.length;ct++){const ut=it[ct];if(ut instanceof Cs&&this.isVP8Simulcast(ut)){const pt=rt[ct],mt={},_t={high:1e3*(ut._encoderConfig.bitrateMax-50),medium:5e4};mt.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:_t.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:_t.medium,scaleResolutionDownBy:4}];const vt=pt.sender.getParameters();await pt.sender.setParameters(Object.assign(vt,mt))}}}isVP8Simulcast(rt){var it,ct,ut,pt,mt;return!!(rt instanceof Cs&&rn("SIMULCAST")&&this.store.codec==="vp8"&&!Er(it=rt._hints).call(it,ds.LOW_STREAM)&&(ct=rt._encoderConfig)!==null&&ct!==void 0&&ct.bitrateMax&&((ut=rt._encoderConfig)===null||ut===void 0?void 0:ut.bitrateMax)>200&&(pt=rt._scalabilityMode)!==null&&pt!==void 0&&pt.numSpatialLayers&&((mt=rt._scalabilityMode)===null||mt===void 0?void 0:mt.numSpatialLayers)>1)}logSDPExchange(rt,it,ct,ut){if(rn("SDP_LOGGING"))return Ut.upload("[".concat(this.store.clientId,"] exchanging ").concat(ct," ").concat(it," SDP during P2PConnection.").concat(ut,`
`),rt),it==="offer"?pt=>{this.logSDPExchange(pt,"answer",ct==="local"?"remote":"local",ut)}:void 0}async muteLocal(rt){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const it=this.peerConnection.getTransceivers().filter(mt=>mt.mid&&rt.indexOf(mt.mid)!==-1);if(it.length!==rt.length)throw new Error("Transceivers' length doesn't match mids' length.");it.map(mt=>{mt.direction="inactive"});const ct=await this.peerConnection.createOffer(),ut=this.logSDPExchange(ct.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(ct),this.remoteSDP.muteRemote(rt);const pt=this.remoteSDP.toString();ut==null||ut(pt),await this.setRemoteDescription({type:"answer",sdp:pt})}catch(it){throw new Yn(tn.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(it.toString()))}}async unmuteLocal(rt){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const it=this.peerConnection.getTransceivers().filter(mt=>mt.mid&&rt.indexOf(mt.mid)!==-1);if(it.length!==rt.length)throw new Error("Transceivers' length doesn't match mids' length.");it.map(async mt=>{mt.direction="sendonly"});const ct=await this.peerConnection.createOffer(),ut=this.logSDPExchange(ct.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(ct),this.remoteSDP.unmuteRemote(rt);const pt=this.remoteSDP.toString();ut==null||ut(pt),await this.setRemoteDescription({type:"answer",sdp:pt})}catch(it){throw new Yn(tn.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(it.toString()))}}async getRemoteSSRC(rt,it){var ct;if(it=it??((ct=this.currentRemoteDescription)===null||ct===void 0?void 0:ct.sdp)){var ut;const pt=(ut=op(it).mediaDescriptions.find(mt=>mt.attributes.mid===rt))===null||ut===void 0?void 0:ut.attributes.ssrcs;return pt==null?void 0:pt[0].ssrcId}}async setRemoteDescription(rt){var it;await this.peerConnection.setRemoteDescription(rt),Er(it=["connected","completed"]).call(it,this.peerConnection.iceConnectionState)||(this.isReady=!0,this.addRemoteCandidate())}mungReceiveAnswerSDP(rt,it,ct){const ut=op(rt),pt=ut.mediaDescriptions.find(mt=>mt.attributes.mid===it);return pt&&ct===Pr.AUDIO&&pt.media.mediaType==="audio"&&US(pt),rv(ut)}},Br(bs.prototype,"establish",[Nm],Object.getOwnPropertyDescriptor(bs.prototype,"establish"),bs.prototype),Br(bs.prototype,"connect",[Nm],Object.getOwnPropertyDescriptor(bs.prototype,"connect"),bs.prototype),Br(bs.prototype,"receive",[Nm],Object.getOwnPropertyDescriptor(bs.prototype,"receive"),bs.prototype),Br(bs.prototype,"mockReceive",[Nm],Object.getOwnPropertyDescriptor(bs.prototype,"mockReceive"),bs.prototype),Br(bs.prototype,"stopReceiving",[Nm],Object.getOwnPropertyDescriptor(bs.prototype,"stopReceiving"),bs.prototype),Br(bs.prototype,"restartICE",[Nm],Object.getOwnPropertyDescriptor(bs.prototype,"restartICE"),bs.prototype),Br(bs.prototype,"close",[Nm],Object.getOwnPropertyDescriptor(bs.prototype,"close"),bs.prototype),Br(bs.prototype,"updateEncoderConfig",[Nm],Object.getOwnPropertyDescriptor(bs.prototype,"updateEncoderConfig"),bs.prototype),Br(bs.prototype,"updateSendParameters",[Nm],Object.getOwnPropertyDescriptor(bs.prototype,"updateSendParameters"),bs.prototype),Br(bs.prototype,"replaceTrack",[Nm],Object.getOwnPropertyDescriptor(bs.prototype,"replaceTrack"),bs.prototype),Br(bs.prototype,"muteLocal",[Nm],Object.getOwnPropertyDescriptor(bs.prototype,"muteLocal"),bs.prototype),Br(bs.prototype,"unmuteLocal",[Nm],Object.getOwnPropertyDescriptor(bs.prototype,"unmuteLocal"),bs.prototype),bs);function Nm(_e,rt,it){const ct=_e[rt];if(typeof ct!="function")throw new Error("Cannot use mutex on object property.");return it.value=async function(){const ut=this.mutex,pt=await ut.lock("From P2PConnection.".concat(rt));try{for(var mt=arguments.length,_t=new Array(mt),vt=0;vt<mt;vt++)_t[vt]=arguments[vt];return await ct.apply(this,_t)}finally{pt()}},it}let u_=function(_e){return _e.SEND_ONLY="SEND_ONLY",_e.RECEIVE_ONLY="RECEIVE_ONLY",_e}({});var n$,r$,i$,o$,s$,a$,c$,l$,u$,d$,h$,Ls;function p$(_e,rt){var it=Object.keys(_e);if(Object.getOwnPropertySymbols){var ct=Object.getOwnPropertySymbols(_e);rt&&(ct=ct.filter(function(ut){return Object.getOwnPropertyDescriptor(_e,ut).enumerable})),it.push.apply(it,ct)}return it}function w1(_e){for(var rt=1;rt<arguments.length;rt++){var it=arguments[rt]!=null?arguments[rt]:{};rt%2?p$(Object(it),!0).forEach(function(ct){Jt(_e,ct,it[ct])}):Object.getOwnPropertyDescriptors?Object.defineProperties(_e,Object.getOwnPropertyDescriptors(it)):p$(Object(it)).forEach(function(ct){Object.defineProperty(_e,ct,Object.getOwnPropertyDescriptor(it,ct))})}return _e}let oZ=(n$=d_(u_.SEND_ONLY),r$=d_(u_.SEND_ONLY),i$=d_(),o$=d_(u_.RECEIVE_ONLY),s$=d_(u_.RECEIVE_ONLY),a$=d_(u_.RECEIVE_ONLY),c$=d_(u_.RECEIVE_ONLY),l$=d_(u_.RECEIVE_ONLY),u$=d_(u_.RECEIVE_ONLY),d$=d_(),h$=d_(u_.RECEIVE_ONLY),Ls=class extends Fs{get state(){return this._state}set state(_e){const rt=this._state;this._state=_e,this.emit(jr.StateChange,rt,this._state)}constructor(_e,rt){super(),Jt(this,"isPlanB",!1),Jt(this,"store",void 0),Jt(this,"statsUploader",void 0),Jt(this,"sendConnection",void 0),Jt(this,"recvConnection",void 0),Jt(this,"localTrackMap",new Map),Jt(this,"remoteUserMap",new Map),Jt(this,"localDataChannels",[]),Jt(this,"pendingLocalTracks",[]),Jt(this,"pendingRemoteTracks",[]),Jt(this,"statsCollector",void 0),Jt(this,"dtlsFailedCount",0),Jt(this,"sendMutex",void 0),Jt(this,"recvMutex",void 0),Jt(this,"_state",qo.Disconnected),Jt(this,"_restartStates",["disconnected","failed"]),Jt(this,"reconnectInterval",void 0),Jt(this,"uploadUnplinkStarted",!1),Jt(this,"uploadDownlinkStarted",!1),Jt(this,"uplinkStateUploadInterval",void 0),Jt(this,"downlinkStatsUploadInterval",void 0),Jt(this,"handleMuteLocalTrack",async(it,ct,ut)=>{const pt=await this.sendMutex.lock("Locking from P2PChannel2.handleMuteLocalTrack");try{if(!this.sendConnection||this.state!==qo.Connected)return void ut(new Yn(tn.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established."));const vt=this.filterTobeMutedTracks(it);if(vt.length===0)return void ct();const Tt=vt.find(Dt=>Dt[0]==="videoLowTrack");Tt&&Tt[1].track._originMediaStreamTrack.stop(),await this.sendConnection.muteLocal(vt.map(Dt=>{let[,{id:jt}]=Dt;return jt}));let bt=!1;var mt,_t;it.trackMediaType==="video"?bt=!((mt=this.localTrackMap.get(or.LocalAudioTrack))===null||mt===void 0||!mt.track._muted):bt=((_t=this.localTrackMap.get(or.LocalVideoTrack))===null||_t===void 0?void 0:_t.id)===void 0;const Ot=this.createMuteMessage(vt);await ps(this,jr.RequestMuteLocal,Ot);const Mt=it.trackMediaType==="video"?sv.MUTE_LOCAL_VIDEO:sv.MUTE_LOCAL_AUDIO;await ps(this,jr.RequestP2PMuteLocal,{action:Mt,message:Ot,isMuteAll:bt}),ct()}catch(vt){ut(vt)}finally{pt()}}),Jt(this,"handleUnmuteLocalTrack",async(it,ct,ut)=>{const pt=await this.sendMutex.lock("Locking from P2PChannel2.handleUnmuteLocalTrack");try{if(!this.sendConnection||this.state!==qo.Connected)return void ut(new Yn(tn.INVALID_OPERATION,"Cannot call P2PChannel2.handleUnmuteLocalTrack before sendConnection established."));const mt=this.filterTobeUnmutedTracks(it);if(mt.length===0)return void ct();await this.sendConnection.unmuteLocal(mt.map(Tt=>{let[,{id:bt}]=Tt;return bt}));const _t=this.createUnmuteMessage(mt),vt=it.trackMediaType==="video"?sv.UNMUTE_LOCAL_VIDEO:sv.UNMUTE_LOCAL_AUDIO;await ps(this,jr.RequestP2PMuteLocal,{action:vt,message:_t}),ct()}catch(mt){ut(mt)}finally{pt()}}),Jt(this,"handleUpdateVideoEncoder",async(it,ct,ut,pt)=>{let mt;typeof pt=="boolean"&&pt||(mt=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoEncoder"));try{const vt=this.localTrackMap.get(or.LocalVideoTrack);if(!this.sendConnection||!vt||vt.track!==it||this.state!==qo.Connected)return void ct();const{id:Tt,track:bt}=vt;Tt&&(await this.sendConnection.updateSendParameters(Tt,bt),await this.sendConnection.updateEncoderConfig(Tt,bt),this.emit(jr.UpdateVideoEncoder,bt)),ct()}catch(vt){ut(vt)}finally{var _t;(_t=mt)===null||_t===void 0||_t()}}),Jt(this,"handleUpdateVideoSendParameters",async(it,ct,ut)=>{const pt=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoSendParameters");try{const mt=this.localTrackMap.get(or.LocalVideoTrack);if(!this.sendConnection||!mt||mt.track!==it||this.state!==qo.Connected)return void ct();const{id:_t,track:vt}=mt;_t&&await this.sendConnection.updateSendParameters(_t,vt),ct()}catch(mt){ut(mt)}finally{pt()}}),Jt(this,"handleReplaceTrack",async(it,ct,ut,pt)=>{let mt;Ut.debug("[".concat(this.store.clientId,"] P2PChannel2 handleReplaceTrack for [track-id-").concat(it.getTrackId(),"]")),typeof pt=="boolean"&&pt||(mt=await this.sendMutex.lock("From P2PChannel2.handleReplaceTrack"));try{var _t;const Tt=Array.from(this.localTrackMap.entries()).find(bt=>{let[,{track:Ot}]=bt;return it===Ot});if(!this.sendConnection||!Tt||Tt[1].id===void 0||this.state!==qo.Connected)return void ct();if(await((_t=this.sendConnection)===null||_t===void 0?void 0:_t.replaceTrack(it,Tt[1].id)),Tt[0]===or.LocalVideoTrack&&Fo().supportDualStreamEncoding){const bt=this.localTrackMap.get(or.LocalVideoLowTrack);if(bt){const Ot=it._mediaStreamTrack.clone();bt.track._originMediaStreamTrack.stop(),bt.track._mediaStreamTrack=Ot,bt.track._originMediaStreamTrack=Ot,await new Ir((Mt,Dt)=>{this.handleReplaceTrack(bt.track,Mt,Dt,!0)})}}ct()}catch(Tt){ut(Tt)}finally{var vt;(vt=mt)===null||vt===void 0||vt()}}),Jt(this,"handleGetLocalVideoStats",it=>{it(this.statsCollector.getLocalVideoTrackStats())}),Jt(this,"handleGetLocalAudioStats",it=>{it(this.statsCollector.getLocalAudioTrackStats())}),Jt(this,"handleGetRemoteVideoStats",it=>this.statsCollector.getRemoteVideoTrackStats(it.uid)[it.uid]),Jt(this,"handleGetRemoteAudioStats",it=>this.statsCollector.getRemoteAudioTrackStats(it.uid)[it.uid]),this.store=_e,this.statsCollector=rt,this.statsCollector.addP2PChannel(this),this.statsUploader=new x4(_e),this.bindStatsUploaderEvents(),this.sendMutex=new lu("P2PChannel2-send-mutex",_e.clientId),this.recvMutex=new lu("P2PChannel2-recv-mutex",_e.clientId),this.reconnectInterval=window.setInterval(()=>{[this.sendConnection,this.recvConnection].forEach(it=>{it&&(it.iceConnectionState!=="disconnected"&&it.iceConnectionState!=="failed"||this.handleDisconnect(it.direction))})},rn("ICE_RESTART_INTERVAL"))}async startP2PConnection(_e,rt){throw new Yn(tn.NOT_SUPPORTED,"p2p mode does not support startP2PConnection.")}async connect(_e){throw new Yn(tn.NOT_SUPPORTED,"p2p mode does not support connect.")}async startP2P(_e,rt){let it;try{if(rt){this.recvConnection&&(Ut.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset recvConnection.")),this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection)),it=await this.recvMutex.lock("From P2PChannel.startP2P"),this.recvConnection=new t$(_e,this.store,Gu.RECEIVE_ONLY),this.bindConnectionEvents(this.recvConnection);const ct=await this.recvConnection.establish(rt);return{iceParameters:ct.iceParameters,dtlsParameters:ct.dtlsParameters,sdp:ct.sdp}}{this.state=qo.New,this.sendConnection&&(Ut.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset sendConnection.")),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection)),it=await this.sendMutex.lock("From P2PChannel.startP2P"),this.sendConnection=new t$(_e,this.store),this.store.peerConnectionStart(),this.bindConnectionEvents(this.sendConnection);const ct=await this.sendConnection.establish();return{iceParameters:ct.iceParameters,dtlsParameters:ct.dtlsParameters,sdp:ct.sdp}}}finally{it&&it()}}async p2pConnect(_e){if(!this.sendConnection)throw new Yn(tn.UNEXPECTED_ERROR,"Cannot P2PChannel2.p2pConnect before P2PChannel2.startP2PConnection .");this.store.peerConnectionStart(),await this.sendConnection.connect(_e),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=qo.Connected}async addRemoteCandidate(_e,rt){if(rt===Gu.RECEIVE_ONLY){if(!this.sendConnection)throw new Yn(tn.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.sendConnection.addRemoteCandidate(_e)}else{if(!this.recvConnection)throw new Yn(tn.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.recvConnection.addRemoteCandidate(_e)}}publish(_e,rt,it){var ct=this;return Jp(function*(){const ut=yield Bo(ct.sendMutex.lock("From P2PChannel.publish"));try{if(!ct.sendConnection||ct.state!==qo.Connected){ct.throwIfTrackTypeNotMatch(_e);const Tt=_e.filter(bt=>ct.pendingLocalTracks.indexOf(bt)===-1);return void(ct.pendingLocalTracks=ct.pendingLocalTracks.concat(Tt))}ct.store.pubId=ct.store.pubId+1,pu.markPublishStart(ct.store.clientId,ct.store.pubId);const pt=ct.filterTobePublishedTracks(_e,rt,it);if(pt.length===0)return void(yield Bo(ct.tryToUnmuteAudio(_e)));pt.forEach(Tt=>{let{track:bt,type:Ot}=Tt;const Mt=Date.now();ct.store.publish(bt.getTrackId(),Ot===or.LocalAudioTrack?"audio":"video",Mt)}),ct.bindLocalTrackEvents(pt);const mt=yield Bo(ct.sendConnection.send(pt.map(Tt=>{let{track:bt}=Tt;return bt}),ct.store.codec,ct.store.audioCodec)),_t=(yield Bo(mt.next())).value,vt=ct.createGatewayPublishMessage(pt,_t);try{yield vt}catch(Tt){throw mt.throw(Tt),(Tt==null?void 0:Tt.code)===tn.WS_ABORT&&pt.forEach(bt=>{let{track:Ot}=bt;ct.pendingLocalTracks.indexOf(Ot)===-1&&ct.pendingLocalTracks.push(Ot)}),ct.unbindLocalTrackEvents(pt),Tt}yield Bo(mt.next()),pt.forEach(Tt=>{let{type:bt}=Tt;ct.statsCollector.addLocalStats(bt)}),ct.statsUploader.startUploadOutboundStats(),ct.assignLocalTracks(pt,_t),pt.forEach(Tt=>{let{track:bt,type:Ot}=Tt;const Mt=Date.now();ct.store.publish(bt.getTrackId(),Ot===or.LocalAudioTrack?"audio":"video",void 0,Mt)}),ct.startUploadUplinkState()}finally{ut()}})()}async unpublish(_e){if(!this.sendConnection||this.state!==qo.Connected)return void(_e.length===0?this.pendingLocalTracks.length=0:this.pendingLocalTracks=this.pendingLocalTracks.filter(ut=>!Er(_e).call(_e,ut)));const rt=this.filterTobeUnpublishedTracks(_e);if(rt.length===0)return;const it=rt.find(ut=>ut[0]==="videoLowTrack");it&&it[1].track.close();const ct=this.createGatewayUnpublishMessage(rt);if(await this.sendConnection.stopSending(rt.map(ut=>{let[,{id:pt}]=ut;return pt})),this.withdrawLocalTracks(rt),this.unbindLocalTrackEvents(rt.map(ut=>{let[pt,{track:mt}]=ut;return{type:pt,track:mt}})),rt.forEach(ut=>{let[pt]=ut;this.statsCollector.removeLocalStats(pt)}),this.localTrackMap.size===0&&(this.statsUploader.stopUploadOutboundStats(),this.stopUploadUplinkState()),this.sendConnection&&this.state===qo.Connected)return it&&it[1].track.close(),ct;_e.forEach(ut=>{const pt=this.pendingLocalTracks.indexOf(ut);pt!==-1&&this.pendingLocalTracks.splice(pt,1)})}startUploadUplinkState(){if(this.uploadUnplinkStarted)return;this.uploadUnplinkStarted=!0,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval);const _e=()=>{const rt=[],it=[];Array.from(this.localTrackMap.entries()).forEach(ct=>{let[ut,{track:pt,ssrcs:mt}]=ct;const _t={stream_type:ZX(pt,ut),ssrcs:mt};pt._muted||!pt._enabled?rt.push(_t):it.push(_t)}),rt.length>0&&rt.forEach(ct=>{ps(this,jr.RequestMuteLocal,[ct])}),it.length>0&&it.forEach(ct=>{ps(this,jr.RequestUnmuteLocal,[ct])})};_e(),this.uplinkStateUploadInterval=window.setInterval(()=>{_e()},3e3)}stopUploadUplinkState(){this.uploadUnplinkStarted&&(this.uploadUnplinkStarted=!1,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval))}publishLowStream(_e){return Jp(function*(){throw new Yn(tn.NOT_SUPPORTED,"p2p mode does not support publishLowStream.")})()}async republish(){this.pendingLocalTracks.length>0&&(Ut.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await ru(this,jr.RequestRePublish,this.pendingLocalTracks),this.emit(jr.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[])}async unpublishLowStream(){throw new Yn(tn.NOT_SUPPORTED,"p2p mode does not support unpublishLowStream.")}async subscribe(_e,rt,it,ct){var ut;if(!this.recvConnection)throw new Yn(tn.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");if((ut=this.remoteUserMap.get(_e))!==null&&ut!==void 0&&ut.has(rt))return;const{track:pt,mid:mt,transceiver:_t}=await this.recvConnection.receive(rt,[{ssrcId:it}],String(_e.uid),ct);rt===Pr.AUDIO?(_e._audioTrack?_e._audioTrack._updateOriginMediaStreamTrack(pt):(_e._audioTrack=new IS(pt,_e.uid,_e._uintid,this.store),Ut.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(_e._audioTrack.getTrackId()))),_t&&_e._audioTrack._updateRtpTransceiver(_t),this.bindRemoteTrackEvents(_e,_e._audioTrack)):(_e._videoSSRC=it,_e._videoTrack?_e._videoTrack._updateOriginMediaStreamTrack(pt):(_e._videoTrack=new wS(pt,_e.uid,_e._uintid,this.store),Ut.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(_e._videoTrack.getTrackId()))),_t&&_e._videoTrack._updateRtpTransceiver(_t),this.bindRemoteTrackEvents(_e,_e._videoTrack));const vt=this.remoteUserMap.get(_e);vt?vt.set(rt,mt):this.remoteUserMap.set(_e,new Map([[rt,mt]])),this.statsCollector.addRemoteStats(_e.uid),this.statsUploader.startUploadInboundStats(),this.startUploadDownlinkState();const Tt=this.pendingRemoteTracks.findIndex(bt=>{let{user:Ot,kind:Mt}=bt;return Ot.uid===_e.uid&&rt===Mt});Tt!==-1&&(this.pendingRemoteTracks.splice(Tt,1),this.emit(jr.MediaReconnectEnd,_e.uid))}async mockSubscribe(_e,rt,it,ct){if(!this.recvConnection)throw new Yn(tn.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");await this.recvConnection.mockReceive(rt,[{ssrcId:it}],String(_e.uid),ct)}async unsubscribe(_e,rt,it){const ct=this.pendingRemoteTracks.filter(pt=>{let{user:mt,kind:_t}=pt;return rt!==void 0?mt.uid===_e.uid&&rt===_t:mt.uid===_e.uid});if(ct.forEach(pt=>{const mt=this.pendingRemoteTracks.indexOf(pt);this.pendingRemoteTracks.splice(mt,1)}),this.recvConnection||it||ct.forEach(pt=>{let{kind:mt}=pt;var _t;if(mt===Pr.AUDIO)(_t=_e._audioTrack)===null||_t===void 0||_t._destroy(),_e._audioTrack=void 0;else if(mt===Pr.VIDEO){var vt;(vt=_e._videoTrack)===null||vt===void 0||vt._destroy(),_e._videoTrack=void 0}}),!this.recvConnection)return;const ut=this.filterTobeUnSubscribedTracks(_e,rt);ut.length!==0&&(await this.recvConnection.stopReceiving(ut.map(pt=>{let[,{id:mt}]=pt;return mt})),this.withdrawRemoteTracks(ut),this.remoteUserMap.size===0&&(this.statsUploader.stopUploadInboundStats(),this.stopUploadDownlinkState()),ut.forEach(pt=>{let[mt,{kind:_t}]=pt;var vt,Tt;if(_t===Pr.VIDEO&&mt._videoSSRC&&((vt=this.recvConnection)===null||vt===void 0||vt.setStatsRemoteVideoIsReady(mt._videoSSRC,!1)),_t===Pr.VIDEO)this.unbindRemoteTrackEvents(mt._videoTrack),it||((Tt=mt._videoTrack)===null||Tt===void 0||Tt._destroy(),mt._videoTrack=void 0);else if(_t===Pr.AUDIO){var bt;this.unbindRemoteTrackEvents(mt._audioTrack),!it&&((bt=mt._audioTrack)===null||bt===void 0||bt._destroy(),mt._audioTrack=void 0)}}),ut.forEach(pt=>{let[,{kind:mt}]=pt;ps(this,jr.RequestP2PMuteRemote,mt)}))}startUploadDownlinkState(){if(this.uploadDownlinkStarted)return;this.uploadDownlinkStarted=!0,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval);const _e=()=>Array.from(this.remoteUserMap.entries()).forEach(rt=>{let[,it]=rt;[Pr.VIDEO,Pr.AUDIO].forEach(ct=>{it.has(ct)?ps(this,jr.RequestP2PUnmuteRemote,ct):ps(this,jr.RequestP2PMuteRemote,ct)})});_e(),this.downlinkStatsUploadInterval=window.setInterval(()=>{_e()},3e3)}stopUploadDownlinkState(){this.uploadDownlinkStarted&&(this.uploadDownlinkStarted=!1,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval))}getAllDataChannels(){return this.localDataChannels}async massSubscribe(_e){throw new Yn(tn.NOT_SUPPORTED,"p2p mode does not support massSubscribe.")}async massSubscribeNoLock(_e){throw new Yn(tn.NOT_SUPPORTED,"p2p mode does not support massSubscribeNoLock.")}async massUnsubscribe(_e){throw new Yn(tn.NOT_SUPPORTED,"p2p mode does not support massUnsubscribe.")}async massUnsubscribeNoLock(_e){throw new Yn(tn.NOT_SUPPORTED,"p2p mode does not support massUnsubscribeNoLock.")}async muteRemote(_e,rt){if(!this.recvConnection)return;const it=this.remoteUserMap.get(_e);if(!it)return void Ut.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(_e.uid,"."));if(!it.get(rt))return void Ut.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(_e.uid," media type ").concat(rt,"."));const ct=rt===Pr.VIDEO?_e._videoSSRC:_e._audioSSRC;ct!==void 0&&this.recvConnection.setStatsRemoteVideoIsReady(ct,!1)}async unmuteRemote(_e,rt){return this.unmuteRemoteNoLock(_e,rt)}async unmuteRemoteNoLock(_e,rt){if(!this.recvConnection)return;const it=this.remoteUserMap.get(_e);if(!it)return void Ut.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(_e.uid,"."));it.get(rt)||Ut.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(_e.uid," media type ").concat(rt,"."))}getAllTracks(_e){const rt=this.localTrackMap.get(or.LocalAudioTrack);if((rt==null?void 0:rt.track)instanceof yl){const it=rt.track;return Array.from(this.localTrackMap.entries()).filter(ct=>{let[ut]=ct;return ut!==or.LocalAudioTrack}).filter(ct=>{let[ut]=ct;return!(_e&&ut===or.LocalVideoLowTrack)}).map(ct=>{let[,{track:ut}]=ct;return ut}).concat(it.trackList)}return Array.from(this.localTrackMap.entries()).filter(it=>{let[ct]=it;return!(_e&&ct===or.LocalVideoLowTrack)}).map(it=>{let[,{track:ct}]=it;return ct})}reportPublishEvent(_e,rt,it,ct,ut){if(_e){const mt=this.localTrackMap.get(or.LocalAudioTrack),_t=ct?this.localTrackMap.get(or.LocalVideoLowTrack):this.localTrackMap.get(or.LocalVideoTrack);Vr.publish(this.store.sessionId,{eventElapse:pu.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:_e,ec:rt,audioName:mt==null?void 0:mt.track.getTrackLabel(),videoName:_t==null?void 0:_t.track.getTrackLabel(),screenshare:(_t==null?void 0:_t.track._hints.indexOf(ds.SCREEN_TRACK))!==-1,audio:!!mt,video:!!_t,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:ut})}else{var pt;it||(it=[]);const mt=it.find(vt=>vt instanceof Ws),_t=ct?(pt=this.localTrackMap.get(or.LocalVideoTrack))===null||pt===void 0?void 0:pt.track:it.find(vt=>vt instanceof Cs);Vr.publish(this.store.sessionId,{eventElapse:pu.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:_e,ec:rt,audioName:mt==null?void 0:mt.getTrackLabel(),videoName:_t==null?void 0:_t.getTrackLabel(),screenshare:(_t==null?void 0:_t._hints.indexOf(ds.SCREEN_TRACK))!==-1,audio:!!mt,video:!!_t,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:ut})}}reportSubscribeEvent(_e,rt,it,ct){const ut=ct===Pr.VIDEO?it._videoSSRC:it._audioSSRC;ut&&Vr.subscribe(this.store.sessionId,{succ:_e,ec:rt,video:ct===Pr.VIDEO,audio:ct===Pr.AUDIO,peerid:it.uid,subscribeRequestid:ct===Pr.VIDEO?it._videoSSRC:it._audioSSRC,p2pid:this.store.p2pId,eventElapse:pu.measureFromSubscribeStart(this.store.clientId,ut)})}reset(){Ut.debug("[".concat(this.store.clientId,"] P2PChannel2.reset")),this.sendMutex=new lu("P2PChannel2-send-mutex",this.store.clientId),this.sendMutex=new lu("P2PChannel2-recv-mutex",this.store.clientId),this.sendConnection&&(this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0),this.recvConnection&&(this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const _e=this.localTrackMap.get(or.LocalAudioTrack);if((_e==null?void 0:_e.track)instanceof yl){if(_e.track.trackList.length>0){const rt=_e.track;_e.track.trackList.forEach(it=>{rt.removeAudioTrack(it)})}_e.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.reconnectInterval&&(window.clearInterval(this.reconnectInterval),this.reconnectInterval=void 0),this.state=qo.Disconnected}getStats(_e){var rt,it;return _e?(it=this.recvConnection)===null||it===void 0?void 0:it.getStats():(rt=this.sendConnection)===null||rt===void 0?void 0:rt.getStats()}getRemoteVideoIsReady(_e){var rt;return((rt=this.recvConnection)===null||rt===void 0?void 0:rt.getRemoteVideoIsReady(_e))||!1}getLocalAudioVolume(){const _e=this.localTrackMap.get(or.LocalAudioTrack);if(_e)return _e.track.getVolumeLevel()}getLocalVideoSize(){const _e=this.localTrackMap.get(or.LocalVideoTrack);if(_e)return{width:_e.track.videoWidth||0,height:_e.track.videoHeight||0}}getEncoderConfig(_e){const rt=this.localTrackMap.get(_e);return rt&&rt.track instanceof Cs||rt&&rt.track instanceof Ws?rt.track._encoderConfig:void 0}getLocalMedia(_e){return this.localTrackMap.get(_e)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(_e,rt){if(!_e)return this.remoteUserMap.size>0;const it=this.remoteUserMap.get(_e);return!!it&&(!rt||it.has(rt))}async hasRemoteMediaWithLock(_e,rt){if(!_e)return this.remoteUserMap.size>0;const it=this.remoteUserMap.get(_e);return!!it&&(!rt||it.has(rt))}getRemoteMedia(_e){var rt;const it=Array.from(sp(rt=this.remoteUserMap).call(rt)).find(ct=>ct.uid===_e);return it?{audioTrack:it.audioTrack,audioSSRC:it._audioSSRC,videoTrack:it.videoTrack,videoSSRC:it._videoSSRC}:{}}getAudioLevels(){let _e=Array.from(this.remoteUserMap.entries()).map(it=>{let[ct]=it;return{uid:ct.uid,level:ct.audioTrack?100*ct.audioTrack._source.getAccurateVolumeLevel():0}});const rt=this.localTrackMap.get(or.LocalAudioTrack);return rt&&_e.push({level:100*rt.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),_e=s0(_e).call(_e,(it,ct)=>it.level-ct.level),_e}async disconnectForReconnect(){this.sendConnection&&this.recvConnection&&(Ut.debug("[".concat(this.store.clientId,"] P2PChannel2.disconnectForReconnect closing P2PConnection")),this.state=qo.Reconnecting,rn("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(_e=>{let[rt]=_e;var it;rt._videoTrack&&rt._videoTrack._player&&((it=rt._videoTrack._player.getVideoElement())===null||it===void 0||it.pause(),rt._videoTrack._player.isKeepLastFrame=!0,rt._videoTrack._originMediaStreamTrack.stop())}),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0,this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0,this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(_e=>{var rt;let[it,{track:ct}]=_e;switch(it){case or.LocalVideoTrack:Er(rt=ct._hints).call(rt,ds.LOW_STREAM)?ct.close():this.pendingLocalTracks.push(ct);break;case or.LocalAudioTrack:ct instanceof yl?this.pendingLocalTracks=this.pendingLocalTracks.concat(ct.trackList):this.pendingLocalTracks.push(ct);case or.LocalVideoLowTrack:}}),this.emit(jr.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(_e=>{let[rt,it]=_e;Array.from(sp(it).call(it)).forEach(ct=>{this.setPendingRemoteMedia(rt,ct)}),this.emit(jr.MediaReconnectStart,rt.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),Ut.debug("[".concat(this.store.clientId,"] P2PChannel2 disconnected, waiting to reconnect.")))}hasPendingRemoteMedia(_e,rt){for(const it of this.pendingRemoteTracks){const{user:ct,kind:ut}=it;if((_e instanceof pv?_e.uid:_e)===ct.uid&&rt===ut)return!0}return!1}setPendingRemoteMedia(_e,rt){this.hasPendingRemoteMedia(_e,rt)||this.pendingRemoteTracks.push({user:_e,kind:rt})}async restartICE(_e,rt){let it,ct;if(_e===Gu.SEND_ONLY){if(!this.sendConnection)throw new Yn(tn.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established.");it=await this.sendMutex.lock("From P2PChannel.restartICE"),ct=this.sendConnection}else{if(!this.recvConnection)throw new Yn(tn.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before recvConnection established.");it=await this.recvMutex.lock("From P2PChannel.restartICE"),ct=this.recvConnection}try{if(rt){const ut=await ct.restartICE(rt);return ct.isInRestartIce=!1,ut}{const ut=await ct.restartICE();if(ut){const pt=await ru(this,jr.RequestP2PRestartICE,{direction:Gu.RECEIVE_ONLY,iceParameter:ut});await ct.restartICE(pt),ct.isInRestartIce=!1}}}finally{it()}}getUplinkNetworkQuality(){if(!this.sendConnection)return 0;const _e=this.sendConnection.getStats(),rt=this.localTrackMap.get(or.LocalVideoTrack),it=this.localTrackMap.get(or.LocalAudioTrack),ct=_e.videoSend.find(Dt=>{var jt;return Dt.ssrc===(rt==null||(jt=rt.ssrcs)===null||jt===void 0?void 0:jt[0].ssrcId)}),ut=_e.audioSend.find(Dt=>{var jt;return Dt.ssrc===(it==null||(jt=it.ssrcs)===null||jt===void 0?void 0:jt[0].ssrcId)});if(!ct||!ut)return 1;const pt=Dp(this,jr.NeedSignalRTT),mt=ct?ct.rttMs:void 0,_t=ut?ut.rttMs:void 0,vt=mt&&_t?(mt+_t)/2:mt||_t,Tt=(vt&&pt?(vt+pt)/2:vt||pt)||0,bt=100*_e.sendPacketLossRate*.7/50+.3*Tt/1500,Ot=bt<.17?1:bt<.36?2:bt<.59?3:bt<.1?4:5,Mt=rt==null?void 0:rt.track;if(Mt&&Mt._encoderConfig&&Mt._hints.indexOf(ds.SCREEN_TRACK)===-1){const Dt=Mt._encoderConfig.bitrateMax,jt=_e.bitrate.actualEncoded;if(Dt&&jt){const $t=(1e3*Dt-jt)/(1e3*Dt);return vV[$t<.15?0:$t<.3?1:$t<.45?2:$t<.6?3:4][Ot]}}return Ot}getDownlinkNetworkQuality(){if(!this.recvConnection)return 0;const _e=this.recvConnection.getStats();let rt=0;return Array.from(this.remoteUserMap.entries()).forEach(it=>{let[ct]=it;const ut=ct._audioSSRC,pt=ct._videoSSRC,mt=_e.audioRecv.find(jt=>jt.ssrc===ut),_t=_e.videoRecv.find(jt=>jt.ssrc===pt);if(!mt&&!_t)return void(rt+=1);const vt=Dp(this,jr.NeedSignalRTT),Tt=_e.rtt,bt=(Tt&&vt?(Tt+vt)/2:Tt||vt)||0,Ot=mt?mt.jitterMs:void 0,Mt=_e.recvPacketLossRate;let Dt=.7*Mt*100/50+.3*bt/1500;Ot&&(Dt=.6*Mt*100/50+.2*bt/1500+.2*Ot/400),rt+=Dt<.1?1:Dt<.17?2:Dt<.36?3:Dt<.59?4:5}),this.remoteUserMap.size>0?Math.round(rt/this.remoteUserMap.size):rt}async muteLocalTrack(_e){return new Ir((rt,it)=>{this.handleMuteLocalTrack(_e,rt,it)})}filterTobePublishedTracks(_e,rt,it){const ct=[],ut=Fo(),pt=this.getAllTracks();_e=fS(_e=_e.filter(vt=>pt.indexOf(vt)===-1));let mt=!1,_t=!1;for(const vt of _e){if(vt instanceof Cs&&(this.localTrackMap.has(or.LocalVideoTrack)||mt?new Yn(tn.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(ct.push({track:vt,type:or.LocalVideoTrack}),mt=!0),rt)){const Tt=this.getLowVideoTrack(vt,it);ct.push({track:Tt,type:or.LocalVideoLowTrack})}if(vt instanceof Ws){const Tt=this.localTrackMap.get(or.LocalAudioTrack);if(Tt){if(!(Tt.track instanceof yl))throw new Yn(tn.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(vt._bypassWebAudio)throw new Yn(tn.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");Tt.track.addAudioTrack(vt),this.bindLocalAudioTrackEvents(vt,!0)}else if(_t){const bt=ct.find(Ot=>{let{type:Mt}=Ot;return Mt===or.LocalAudioTrack});if(!(bt.track instanceof yl))throw new Yn(tn.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(vt._bypassWebAudio)throw new Yn(tn.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");bt.track.addAudioTrack(vt)}else{if(!ut.webAudioMediaStreamDest||vt instanceof yl||vt._bypassWebAudio)ct.push({track:vt,type:or.LocalAudioTrack});else{const bt=new yl;bt.addAudioTrack(vt),ct.push({track:bt,type:or.LocalAudioTrack})}_t=!0}}}return ct}filterTobeUnpublishedTracks(_e){const rt=[],it=this.getAllTracks();_e=fS(_e=_e.filter(ct=>it.indexOf(ct)!==-1));for(const ct of _e){if(ct instanceof Ws){const ut=this.localTrackMap.get(or.LocalAudioTrack);if(!ut)continue;ut.track instanceof yl?(ut.track.removeAudioTrack(ct),this.unbindLocalAudioTrackEvents(ct),ut.track.trackList.length===0&&(rt.push([or.LocalAudioTrack,ut]),ut.track.close())):rt.push([or.LocalAudioTrack,ut])}if(ct instanceof Cs){const ut=this.localTrackMap.get(or.LocalVideoTrack);if(!ut)continue;rt.push([or.LocalVideoTrack,ut]);const pt=this.localTrackMap.get(or.LocalVideoLowTrack);pt&&rt.push([or.LocalVideoLowTrack,pt])}}return rt}bindLocalTrackEvents(_e){_e.forEach(rt=>{let{track:it,type:ct}=rt;switch(ct){case or.LocalVideoTrack:it.addListener(Lr.GET_STATS,this.handleGetLocalVideoStats),it.addListener(Lr.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),it.addListener(Lr.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),it.addListener(Lr.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),it.addListener(Lr.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),it.addListener(Lr.NEED_REPLACE_TRACK,this.handleReplaceTrack),it.addListener(Lr.NEED_MUTE_TRACK,this.handleMuteLocalTrack),it.addListener(Lr.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case or.LocalAudioTrack:this.bindLocalAudioTrackEvents(it);case or.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(_e,rt){_e instanceof yl?_e.trackList.forEach(it=>{it.addListener(Lr.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),it.addListener(Lr.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),it.addListener(Lr.GET_STATS,this.handleGetLocalAudioStats),it.addListener(Lr.NEED_MUTE_TRACK,this.handleMuteLocalTrack),it.addListener(Lr.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(_e.addListener(Lr.GET_STATS,this.handleGetLocalAudioStats),_e.addListener(Lr.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),_e.addListener(Lr.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),_e.addListener(Lr.NEED_MUTE_TRACK,this.handleMuteLocalTrack),_e.addListener(Lr.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),rt||_e.addListener(Lr.NEED_REPLACE_TRACK,this.handleReplaceTrack))}unbindLocalTrackEvents(_e){_e||(_e=Array.from(this.localTrackMap.entries()).map(rt=>{let[it,{track:ct}]=rt;return{track:ct,type:it}})),_e.forEach(rt=>{let{track:it,type:ct}=rt;switch(ct){case or.LocalVideoTrack:it.off(Lr.GET_STATS,this.handleGetLocalVideoStats),it.off(Lr.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),it.off(Lr.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),it.off(Lr.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),it.off(Lr.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),it.off(Lr.NEED_REPLACE_TRACK,this.handleReplaceTrack),it.off(Lr.NEED_MUTE_TRACK,this.handleMuteLocalTrack),it.off(Lr.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case or.LocalAudioTrack:this.unbindLocalAudioTrackEvents(it);case or.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(_e){_e instanceof yl?_e.trackList.forEach(rt=>{rt.off(Lr.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),rt.off(Lr.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),rt.off(Lr.GET_STATS,this.handleGetLocalAudioStats),rt.off(Lr.NEED_MUTE_TRACK,this.handleMuteLocalTrack),rt.off(Lr.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(_e.off(Lr.GET_STATS,this.handleGetLocalAudioStats),_e.off(Lr.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),_e.off(Lr.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),_e.off(Lr.NEED_REPLACE_TRACK,this.handleReplaceTrack),_e.off(Lr.NEED_MUTE_TRACK,this.handleMuteLocalTrack),_e.off(Lr.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(_e,rt){rt instanceof wS&&rt.addListener(Lr.GET_STATS,it=>{it(this.handleGetRemoteVideoStats(_e))}),rt instanceof IS&&rt.addListener(Lr.GET_STATS,it=>{it(this.handleGetRemoteAudioStats(_e))})}unbindRemoteTrackEvents(_e){_e&&_e.removeAllListeners(Lr.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(_e=>{let[rt,it]=_e;it.has(Pr.AUDIO)&&this.unbindRemoteTrackEvents(rt._audioTrack),it.has(Pr.VIDEO)&&this.unbindRemoteTrackEvents(rt._videoTrack)})}createGatewayPublishMessage(_e,rt){return _e.map((it,ct)=>{var ut;let pt,{track:mt,type:_t}=it;switch(_t){case or.LocalAudioTrack:pt=es.Audio;break;case or.LocalVideoTrack:pt=Er(ut=mt._hints).call(ut,ds.SCREEN_TRACK)?es.Screen:es.High;break;case or.LocalVideoLowTrack:pt=es.Low}return{kind:_t===or.LocalAudioTrack?Pr.AUDIO:Pr.VIDEO,stream_type:pt,mid:rt[ct].id,ssrcs:rt[ct].localSSRC,isMuted:mt.muted||!mt.enabled}})}createGatewayUnpublishMessage(_e){return _e.map(rt=>{var it;let ct,[ut,{track:pt,ssrcs:mt,id:_t}]=rt;switch(ut){case or.LocalVideoTrack:ct=Er(it=pt._hints).call(it,ds.SCREEN_TRACK)?es.Screen:es.High;break;case or.LocalAudioTrack:ct=es.Audio;break;case or.LocalVideoLowTrack:ct=es.Low}return{stream_type:ct,ssrcs:mt,mid:_t}})}assignLocalTracks(_e,rt){_e.forEach((it,ct)=>{let{track:ut,type:pt}=it;this.localTrackMap.set(pt,{track:ut,id:rt[ct].id,ssrcs:rt[ct].localSSRC})})}withdrawLocalTracks(_e){_e.forEach(rt=>{let[it]=rt;this.localTrackMap.delete(it)})}bindConnectionEvents(_e){_e.onConnectionStateChange=async rt=>{var it;Ut.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: ").concat(_e.name,".onConnectionStateChange(").concat(rt,")")),this.emit(jr.PeerConnectionStateChange,rt),rt!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),rt==="connected"&&(_e.isInRestartIce=!1),Er(it=this._restartStates).call(it,rt)&&!_e.isInRestartIce&&(rt==="disconnected"&&await zl(800),_e.iceConnectionState!=="disconnected"&&_e.iceConnectionState!=="failed"||this.handleDisconnect(_e.direction))},_e.onICEConnectionStateChange=rt=>{rt!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),Ut.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(rt,")")),Vr.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:rt,tag:Ns.TRACER}).onSuccess(),this.emit(jr.IceConnectionStateChange,rt)},_e.onICETransportStateChange=rt=>{Ut.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(rt,")"))},_e.onDTLSTransportStateChange=rt=>{Ut.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(rt,")"))},_e.onDTLSTransportError=rt=>{Ut.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(rt,")"))},_e.onFirstAudioDecoded=rt=>{var it;const ct=Array.from(sp(it=this.remoteUserMap).call(it)).find(pt=>pt._audioSSRC===rt);var ut;ct&&(this.store.subscribe(ct.uid,"audio",void 0,void 0,void 0,Date.now()),(ut=ct.audioTrack)===null||ut===void 0||ut.emit(_f.FIRST_FRAME_DECODED),Vr.firstRemoteFrame(this.store.sessionId,Rl.FIRST_AUDIO_DECODE,Os.FIRST_AUDIO_DECODE,{peer:ct._uintid,subscribeElapse:pu.measureFromSubscribeStart(this.store.clientId,rt),subscribeRequestid:rt,p2pid:this.store.p2pId}))},_e.onFirstAudioReceived=rt=>{var it;const ct=Array.from(sp(it=this.remoteUserMap).call(it)).find(ut=>ut._audioSSRC===rt);ct&&Vr.firstRemoteFrame(this.store.sessionId,Rl.FIRST_AUDIO_RECEIVED,Os.FIRST_AUDIO_RECEIVED,{peer:ct._uintid,subscribeElapse:pu.measureFromSubscribeStart(this.store.clientId,rt),subscribeRequestid:rt,p2pid:this.store.p2pId})},_e.onFirstVideoDecoded=(rt,it,ct)=>{this.reportVideoFirstFrameDecoded(rt,it,ct)},_e.onFirstVideoReceived=rt=>{var it;const ct=Array.from(sp(it=this.remoteUserMap).call(it)).find(ut=>ut._videoSSRC===rt);ct&&Vr.firstRemoteFrame(this.store.sessionId,Rl.FIRST_VIDEO_RECEIVED,Os.FIRST_VIDEO_RECEIVED,{peer:ct._uintid,subscribeElapse:pu.measureFromSubscribeStart(this.store.clientId,rt),subscribeRequestid:rt,p2pid:this.store.p2pId})},_e.onSelectedLocalCandidateChanged=(rt,it)=>{const ct=rt.candidateType==="relay",ut=it.candidateType==="relay";it.candidateType!=="unknown"&&ct===ut||this.emit(jr.ConnectionTypeChange,ct),Ut.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(cv(it))," -> ").concat(JSON.stringify(cv(rt)),")"))},_e.onSelectedRemoteCandidateChanged=(rt,it)=>{Ut.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(cv(it))," -> ").concat(JSON.stringify(cv(rt)),")"))},_e.onFirstVideoDecodedTimeout=rt=>{this.reportVideoFirstFrameDecoded(rt,void 0,void 0,!0)},_e.onLocalCandidate=rt=>{this.emit(jr.LocalCandidate,{candidate:rt,direction:_e.direction})}}unbindConnectionEvents(_e){_e.onConnectionStateChange=void 0,_e.onICEConnectionStateChange=void 0,_e.onICETransportStateChange=void 0,_e.onDTLSTransportStateChange=void 0,_e.onDTLSTransportError=void 0,_e.onFirstAudioDecoded=void 0,_e.onFirstAudioReceived=void 0,_e.onFirstVideoDecoded=void 0,_e.onFirstVideoReceived=void 0,_e.onSelectedLocalCandidateChanged=void 0,_e.onSelectedRemoteCandidateChanged=void 0,_e.onFirstVideoDecodedTimeout=void 0,_e.onLocalCandidate=void 0}async handleDisconnect(_e){const rt=_e===Gu.SEND_ONLY?this.sendConnection:this.recvConnection;rt&&!rt.isInRestartIce&&(rt.isInRestartIce=!0,Ut.debug("[".concat(this.store.clientId,"] [P2PChannel-").concat(rt.name,"] start use restartICE")),_e===Gu.SEND_ONLY?this.restartICE(_e):ru(this,jr.RequestP2PRestartICE,{direction:Gu.SEND_ONLY}))}filterTobeMutedTracks(_e){const rt=[];if(this.getAllTracks().indexOf(_e)===-1)return rt;const it=this.localTrackMap.get(or.LocalAudioTrack);if(_e instanceof Ws&&(it==null?void 0:it.track)instanceof yl)return it.track.isActive||rt.push([or.LocalAudioTrack,it]),rt;const ct=Array.from(this.localTrackMap.entries()).find(ut=>{let[,{track:pt}]=ut;return _e===pt});if(ct&&(rt.push(ct),ct[0]===or.LocalVideoTrack)){const ut=this.localTrackMap.get(or.LocalVideoLowTrack);ut&&rt.push([or.LocalVideoLowTrack,ut])}return rt}filterTobeUnmutedTracks(_e){const rt=[],it=this.localTrackMap.get(or.LocalAudioTrack);if(_e instanceof Ws&&(it==null?void 0:it.track)instanceof yl)return it.track.isActive&&rt.push([or.LocalAudioTrack,it]),rt;const ct=Array.from(this.localTrackMap.entries()).find(ut=>{let[,{track:pt}]=ut;return _e===pt});if(ct)if(ct[0]===or.LocalVideoTrack){rt.push(ct);const ut=this.localTrackMap.get(or.LocalVideoLowTrack);ut&&rt.push([or.LocalVideoLowTrack,ut])}else rt.push(ct);return rt}createMuteMessage(_e){return _e.map(rt=>{var it;let ct,[ut,{track:pt,ssrcs:mt,id:_t}]=rt;switch(ut){case or.LocalAudioTrack:ct=es.Audio;break;case or.LocalVideoTrack:ct=Er(it=pt._hints).call(it,ds.SCREEN_TRACK)?es.Screen:es.High;break;case or.LocalVideoLowTrack:ct=es.Low}return{stream_type:ct,ssrcs:mt,mid:_t}})}createUnmuteMessage(_e){return _e.map(rt=>{var it;let ct,[ut,{track:pt,ssrcs:mt,id:_t}]=rt;switch(ut){case or.LocalAudioTrack:ct=es.Audio;break;case or.LocalVideoTrack:ct=Er(it=pt._hints).call(it,ds.SCREEN_TRACK)?es.Screen:es.High;break;case or.LocalVideoLowTrack:ct=es.Low}return{stream_type:ct,ssrcs:mt,mid:_t}})}filterTobeUnSubscribedTracks(_e,rt){const it=[],ct=this.remoteUserMap.get(_e);if(!ct)return it;if(rt){const ut=ct.get(rt);if(!ut)return it;it.push([_e,{kind:rt,id:ut}])}else Array.from(ct.entries()).forEach(ut=>{let[pt,mt]=ut;it.push([_e,{kind:pt,id:mt}])});return it}createUnsubscribeMessage(_e){const rt=[];return _e.forEach(it=>{let[ct,{kind:ut,id:pt}]=it;switch(ut){case Pr.VIDEO:return void(ct._videoSSRC&&rt.push({stream_type:Pr.VIDEO,ssrcId:ct._videoSSRC}));case Pr.AUDIO:return void(ct._audioSSRC&&rt.push({stream_type:Pr.AUDIO,ssrcId:ct._audioSSRC}))}}),rt}withdrawRemoteTracks(_e){_e.forEach(rt=>{let[it,{kind:ct}]=rt;const ut=this.remoteUserMap.get(it);ut&&(ut.delete(ct),Array.from(ut.entries()).length===0&&this.remoteUserMap.delete(it))})}async updateBitrateLimit(_e){const rt=this.localTrackMap.get(or.LocalVideoTrack),it=this.localTrackMap.get(or.LocalVideoLowTrack);rt&&(await rt.track.setBitrateLimit(_e.uplink),await new Ir((ct,ut)=>{this.handleUpdateVideoEncoder(rt.track,ct,ut,!0)})),it&&_e.low_stream_uplink&&(await it.track.setBitrateLimit({max_bitrate:_e.low_stream_uplink.bitrate,min_bitrate:_e.low_stream_uplink.bitrate||0}),await new Ir((ct,ut)=>{this.handleUpdateVideoEncoder(it.track,ct,ut,!0)}))}isP2PDisconnected(){if(this.sendConnection&&this.recvConnection){const _e=this.sendConnection.peerConnectionState,rt=this.recvConnection.peerConnectionState;return _e!=="connected"&&rt!=="connected"}return!0}async tryToUnmuteAudio(_e){for(let rt=0;rt<_e.length;rt++)if(_e[rt]instanceof Ws){const it=this.filterTobeUnmutedTracks(_e[rt]);if(it.length===0)continue;const ct=this.createUnmuteMessage(it);return void await ps(this,jr.RequestUnmuteLocal,ct)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=_e=>this.getStats(_e),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()).filter(_e=>{let[,{ssrcs:rt}]=_e;return!!rt}),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=_e=>{var rt;return!((rt=this.recvConnection)===null||rt===void 0||!rt.getRemoteVideoIsReady(_e))},this.statsUploader.requestUpload=(_e,rt)=>this.emit(jr.RequestUpload,_e,rt),this.statsUploader.requestUploadStats=_e=>this.emit(jr.RequestUploadStats,_e),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await zl(CO(this.dtlsFailedCount,xa)),this.emit(jr.RequestReconnect)}async reconnectP2P(){}canPublishLowStream(){return this.localTrackMap.has(or.LocalVideoTrack)||this.pendingLocalTracks.some(_e=>_e instanceof Cs)}throwIfTrackTypeNotMatch(_e){if(_e.filter(rt=>rt instanceof Cs).length>1)throw new Yn(tn.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(_e.filter(rt=>rt instanceof Ws).length>1&&(_e.some(rt=>rt instanceof Ws&&rt._bypassWebAudio)||!Fo().webAudioMediaStreamDest))throw new Yn(tn.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const rt of _e){if(rt instanceof Cs&&this.pendingLocalTracks.some(it=>it instanceof Cs))throw new Yn(tn.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(rt instanceof Ws&&this.pendingLocalTracks.some(it=>it instanceof Ws)&&(!Fo().webAudioMediaStreamDest||rt._bypassWebAudio||this.pendingLocalTracks.some(it=>it instanceof Ws&&it._bypassWebAudio)))throw new Yn(tn.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(_e,rt){const it=!rn("DISABLE_DUAL_STREAM_USE_ENCODING")&&Fo().supportDualStreamEncoding,ct=w1(w1({},{width:160,height:120,framerate:15,bitrate:50}),rt);let ut;ut=it?_e._mediaStreamTrack.clone():VM(_e,ct);const pt=ms(8,"track-low-"),mt=new Cs(ut,w1(w1({},it&&{scaleResolutionDownBy:yM(ct,_e)}),{},{frameRate:ct.framerate,bitrateMax:ct.bitrate,bitrateMin:ct.bitrate}),void 0,void 0,pt);return mt.on(v0.TRANSCEIVER_UPDATED,_t=>{_e._updateRtpTransceiver(_t,SS.LOW_STREAM)}),mt._hints.push(ds.LOW_STREAM),_e.addListener(Lr.NEED_CLOSE,()=>{mt.close()}),mt}async globalLock(){return this.recvMutex.lock("From P2PChannel2.globalLock")}reportVideoFirstFrameDecoded(_e,rt,it,ct){var ut;const pt=Array.from(sp(ut=this.remoteUserMap).call(ut)).find(mt=>mt._videoSSRC===_e);if(pt){ct||this.store.subscribe(pt.uid,"video",void 0,void 0,void 0,void 0,Date.now());const mt=this.store.keyMetrics,_t=mt.subscribe.find(vt=>vt.userId===pt.uid&&vt.type==="video");Vr.firstRemoteVideoDecode(this.store.sessionId,Rl.FIRST_VIDEO_DECODE,Os.FIRST_VIDEO_DECODE,{peer:pt._uintid,videowidth:rt,videoheight:it,subscribeElapse:pu.measureFromSubscribeStart(this.store.clientId,_e),subscribeRequestid:_e,p2pid:this.store.p2pId,apEnd:mt.requestAPEnd||0,apStart:mt.requestAPStart||0,joinGwEnd:mt.joinGatewayEnd||0,joinGwStart:mt.joinGatewayStart||0,pcEnd:mt.peerConnectionEnd||0,pcStart:mt.peerConnectionStart||0,subscriberEnd:(_t==null?void 0:_t.subscribeEnd)||0,subscriberStart:(_t==null?void 0:_t.subscribeStart)||0,videoAddNotify:(_t==null?void 0:_t.streamAdded)||0,state:ct?1:0})}}async remoteMediaSsrcChanged(_e,rt,it){if(!this.recvConnection)return!1;const ct=this.remoteUserMap.get(_e);if(!ct)return!1;const ut=ct.get(rt);if(!ut)return!1;const pt=await this.recvConnection.getRemoteSSRC(ut);return pt!==void 0&&pt!==it}isPreSubScribe(_e){return!1}async publishDataChannel(_e){throw new Yn(tn.NOT_SUPPORTED)}async unpublishDataChannel(_e){throw new Yn(tn.NOT_SUPPORTED)}async subscribeDataChannel(_e,rt){throw new Yn(tn.NOT_SUPPORTED)}async unsubscribeDataChannel(_e,rt){throw new Yn(tn.NOT_SUPPORTED)}hasPendingRemoteDataChannel(_e,rt){throw new Yn(tn.NOT_SUPPORTED)}setPendingRemoteDataChannel(_e,rt){throw new Yn(tn.NOT_SUPPORTED)}async preConnect(_e){throw new Yn(tn.NOT_SUPPORTED)}getEstablishParams(){throw new Yn(tn.NOT_SUPPORTED)}async reSubscribe(_e){throw new Yn(tn.NOT_SUPPORTED)}reportVideoFirstFrameRender(_e){}async updateVideoStreamParameter(_e,rt){throw new Yn(tn.NOT_SUPPORTED)}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(_e=>{let[rt,{track:it}]=_e;rt===or.LocalVideoLowTrack?it._updateRtpTransceiver(void 0,SS.LOW_STREAM):it._updateRtpTransceiver(void 0)})}},Br(Ls.prototype,"p2pConnect",[n$],Object.getOwnPropertyDescriptor(Ls.prototype,"p2pConnect"),Ls.prototype),Br(Ls.prototype,"unpublish",[r$],Object.getOwnPropertyDescriptor(Ls.prototype,"unpublish"),Ls.prototype),Br(Ls.prototype,"unpublishLowStream",[i$],Object.getOwnPropertyDescriptor(Ls.prototype,"unpublishLowStream"),Ls.prototype),Br(Ls.prototype,"subscribe",[o$],Object.getOwnPropertyDescriptor(Ls.prototype,"subscribe"),Ls.prototype),Br(Ls.prototype,"mockSubscribe",[s$],Object.getOwnPropertyDescriptor(Ls.prototype,"mockSubscribe"),Ls.prototype),Br(Ls.prototype,"unsubscribe",[a$],Object.getOwnPropertyDescriptor(Ls.prototype,"unsubscribe"),Ls.prototype),Br(Ls.prototype,"muteRemote",[c$],Object.getOwnPropertyDescriptor(Ls.prototype,"muteRemote"),Ls.prototype),Br(Ls.prototype,"unmuteRemote",[l$],Object.getOwnPropertyDescriptor(Ls.prototype,"unmuteRemote"),Ls.prototype),Br(Ls.prototype,"hasRemoteMediaWithLock",[u$],Object.getOwnPropertyDescriptor(Ls.prototype,"hasRemoteMediaWithLock"),Ls.prototype),Br(Ls.prototype,"disconnectForReconnect",[d$],Object.getOwnPropertyDescriptor(Ls.prototype,"disconnectForReconnect"),Ls.prototype),Br(Ls.prototype,"remoteMediaSsrcChanged",[h$],Object.getOwnPropertyDescriptor(Ls.prototype,"remoteMediaSsrcChanged"),Ls.prototype),Ls);function d_(_e){return function(rt,it,ct){const ut=rt[it];if(typeof ut!="function")throw new Error("Cannot use mutex on object property.");return ct.value=async function(){for(var pt=arguments.length,mt=new Array(pt),_t=0;_t<pt;_t++)mt[_t]=arguments[_t];switch(_e){case u_.SEND_ONLY:{const vt=await this.sendMutex.lock("From P2PChannel2.".concat(it));try{return await ut.apply(this,mt)}finally{vt()}}case u_.RECEIVE_ONLY:{const vt=await this.recvMutex.lock("From P2PChannel2.".concat(it));try{return await ut.apply(this,mt)}finally{vt()}}default:{const vt=await this.sendMutex.lock("From P2PChannel2.".concat(it)),Tt=await this.recvMutex.lock("From P2PChannel2.".concat(it));try{return await ut.apply(this,mt)}finally{vt(),Tt()}}}},ct}}class U0 extends Fs{constructor(rt,it){super(),Jt(this,"signal",void 0),Jt(this,"token",void 0),Jt(this,"tokenTimeout",void 0),Jt(this,"tokenInterval",void 0),Jt(this,"_sequence",0),Jt(this,"userMap",new Map),Jt(this,"encoder",new TextEncoder),this.signal=rt,this.token=it;const ct=()=>{this.signal.connectionState===Ts.CONNECTED&&this.check(),this.userMap.size===0?this.tokenInterval=window.setTimeout(ct,1e3):this.tokenInterval=window.setTimeout(ct,3*rn("P2P_TOKEN_INTERVAL"))};ct()}async send(rt,it,ct,ut,pt){var mt;if(this.userMap.size===0)return;const _t=Array.from(Sp(mt=this.userMap).call(mt))[0].token;typeof it!="string"&&(it=JSON.stringify(it)),ut=ut??ms(6,""),pt=pt??this._sequence++;const vt={_id:ut,_type:rt,_seq:pt,_message:it,token:"".concat(this.token,"_").concat(_t)};rn("SHOW_P2P_LOG")&&Ut.debug("send message",vt,"noNeedResponse : ".concat(ct)),this.splitMessage(JSON.stringify(vt)).forEach(bt=>{this.signal.request(_i.DATA_STREAM,{payload:nv(this.encoder.encode(bt))})});const Tt=new Ir((bt,Ot)=>{const Mt=window.setTimeout(()=>{this.off("res-@".concat(ut,"_ack"),Dt),this.off("res-@".concat(ut),$t),this.off(NS.ABORT,jt),Ut.debug("[external-signal] request timeout, type: ".concat(rt,", requestId: ").concat(ut)),this.userMap.size===0?Ot(new Yn(tn.INVALID_REMOTE_USER)):Ot(new Yn(tn.TIMEOUT))},rn("EXTERNAL_SIGNAL_REQUEST_TIMEOUT")),Dt=()=>{Mt&&window.clearTimeout(Mt),this.off(NS.ABORT,jt),ct&&bt()},jt=()=>{Mt&&window.clearTimeout(Mt),this.off("res-@".concat(ut,"_ack"),Dt),this.off("res-@".concat(ut),$t),Ot(new Yn(tn.EXTERNAL_SIGNAL_ABORT,"type: ".concat(rt,", requestId: ").concat(ut)))};this.once(NS.ABORT,jt),this.once("res-@".concat(ut,"_ack"),Dt);const $t=(en,Qt)=>{Ht=!0,Mt&&window.clearTimeout(Mt),this.off("res-@".concat(ut,"_ack"),Dt),this.off(NS.ABORT,jt),en==="success"?bt(Qt):Ot(new Yn(tn.P2P_MESSAGE_FAILED,"request ".concat(rt," failed, requestId: ").concat(ut)))};let Ht=!1;ct||(this.once("res-@".concat(ut),$t),zl(rn("SIGNAL_REQUEST_TIMEOUT")).then(()=>{Ht||Ut.warning("external_signal request timeout, type: ".concat(rt,", requestId: ").concat(ut,", ").concat(vt))}))});try{return await Tt}catch(bt){if(bt.code===tn.TIMEOUT)return await this.send(rt,it,ct,ut,pt);throw bt}}onMessage(rt){var it;const{_uid:ct}=rt;let ut,pt=this.userMap.get(ct);if(pt)ut=pt.splitMessageMap;else{if(this.userMap.size>0||!("_type"in rt)||rt._type!==qs.CHECK)return;const{token:Tt}=rt;ut=new Map,pt={uid:ct,isStart:!0,token:Tt,splitMessageMap:ut,nextExpectedSequenceNumber:0,receivedMessagesMap:new Map},this.userMap.set(ct,pt),this.signal.emit(Oo.ON_USER_ONLINE,{uid:ct}),this.handleUserOnline()}if("id"in rt&&"total"in rt){var mt;const{id:Tt,total:bt}=rt,Ot=(mt=ut.get(Tt))!==null&&mt!==void 0?mt:[];if(Ot.push(rt),ut.has(Tt)||ut.set(Tt,Ot),Ot.length!==bt)return;{const Mt=s0(Ot).call(Ot,(Dt,jt)=>Dt.index-jt.index).map(Dt=>Dt.payload).join("");ut.delete(Tt),(rt=JSON.parse(Mt))._uid=ct}}const{_type:_t,token:vt}=rt;if(Er(it=[qs.ACK,qs.CHECK]).call(it,_t))return _t===qs.CHECK&&this.handleCheckToken(pt,vt),void this.receiveMessage(rt);vt==="".concat(pt.token,"_").concat(this.token)?this.handleReceivedMessage(rt):Ut.debug('Receive unexpected message", '.concat(vt,", cur_token: ").concat(pt.token,"_").concat(this.token),rt)}check(){const rt={_id:ms(6,""),token:this.token,_type:qs.CHECK};rn("SHOW_P2P_LOG")&&Ut.debug("send message",rt),this.signal.request(_i.DATA_STREAM,{payload:nv(this.encoder.encode(JSON.stringify(rt)))})}ack(rt){const it={_id:rt,_type:qs.ACK,token:this.token};rn("SHOW_P2P_LOG")&&Ut.debug("send message",it),this.signal.request(_i.DATA_STREAM,{payload:nv(this.encoder.encode(JSON.stringify(it)))})}response(rt,it,ct){this.send(qs.RESPONSE,JSON.stringify({success:!ct,message:it}),!0,rt)}handleReceivedMessage(rt){const it=()=>{this.userMap.forEach(Tt=>{const{receivedMessagesMap:bt,nextExpectedSequenceNumber:Ot}=Tt;for(;bt.has(Ot);){const Mt=bt.get(Ot);bt.delete(Ot),this.receiveMessage(Mt),Tt.nextExpectedSequenceNumber++}})};if(!rt)return void it();const{_uid:ct,_seq:ut}=rt,pt=this.userMap.get(ct),{receivedMessagesMap:mt,isStart:_t,nextExpectedSequenceNumber:vt}=pt;if(ut<vt)return this.ack(rt._id),void Ut.debug("[external-signal] receive old message, seq: ".concat(ut,", ").concat(rt._message));mt.set(ut,rt),_t&&ut===vt&&(this.receiveMessage(rt),mt.delete(vt),pt.nextExpectedSequenceNumber++,it())}receiveMessage(rt){const{_id:it,_type:ct,_message:ut,_uid:pt}=rt;if(rn("SHOW_P2P_LOG")&&Ut.debug("receive message",rt),it){let mt;switch(rt._type!==qs.ACK&&(ut&&(mt=JSON.parse(ut)),this.ack(rt._id)),rt._type){case qs.CANDIDATE:case qs.CONTROL:this.signal.emit(ct,mt,pt);break;case qs.PUBLISH:case qs.UNPUBLISH:case qs.RESTART_ICE:case qs.CALL:mt.uid=pt,ru(this.signal,ct,mt).then(_t=>{this.response(rt._id,_t)}).catch(()=>{this.response(rt._id,void 0,!0)});break;case qs.ACK:this.getListeners("res-@".concat(it,"_ack")).length>0&&this.emit("res-@".concat(it,"_ack"));break;case qs.RESPONSE:{const{success:_t,message:vt}=mt;this.emit("res-@".concat(it),_t?"success":"failed",vt);break}}}}splitMessage(rt){if(rt.length<U0.MAX_MESSAGE_SIZE)return[rt];const it=[],{remoteToken:ct}=JSON.parse(rt),ut=ms(6,"");let pt=0,mt=800;const _t=Math.ceil(rt.length/mt);for(;rt.length>0;){pt++;const vt={id:ut,index:pt,total:_t,payload:rt.slice(0,mt),token:"".concat(this.token,"_").concat(ct)};JSON.stringify(vt).length>U0.MAX_MESSAGE_SIZE?mt-=50:(it.push(vt),rt=rt.slice(mt))}return it.map(vt=>JSON.stringify(vt))}handleCheckToken(rt,it){return rt.token!==it?(Ut.debug("token changed, from ".concat(rt.token," to ").concat(it)),this.reset(rt.uid,it),!1):(this.tokenTimeout&&(window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0),this.tokenTimeout=window.setTimeout(()=>{Ut.debug("token timeout, ".concat(it)),this.reset(rt.uid)},rn("MAX_P2P_TIMEOUT")),!0)}async handleUserOnline(){const rt=await ru(this.signal,qs.CALL,void 0),it=await this.send(qs.CALL,rt);this.signal.emit(io.P2P_CONNECTION,it,!0)}async reset(rt,it){const ct=this.userMap.get(rt);ct&&(this.emit(NS.ABORT),this.signal.emit(Oo.ON_USER_OFFLINE,{uid:ct.uid,reason:RX.P2P_TOKEN_CHANGED}),this._sequence=0,this.userMap.clear(),it||(Ut.debug("change local token from ".concat(it," to ").concat(it)),this.token=ms(6,"")))}clear(){this._sequence=0,this.userMap.clear(),this.tokenInterval&&window.clearTimeout(this.tokenInterval),this.tokenInterval=void 0,this.tokenTimeout&&window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0,this.emit(NS.ABORT)}}Jt(U0,"MAX_SIZE",1),Jt(U0,"MAX_MESSAGE_SIZE",1024);class sZ extends Fs{get connectionState(){return this._connectionState}set connectionState(rt){rt!==this._connectionState&&(this._connectionState=rt,rt===Ts.CONNECTED?this.emit(io.WS_CONNECTED):rt===Ts.RECONNECTING?this.emit(io.WS_RECONNECTING,this._websocketReconnectReason):rt===Ts.CLOSED&&this.emit(io.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(rt,it){super(),Jt(this,"_disconnectedReason",void 0),Jt(this,"_websocketReconnectReason",void 0),Jt(this,"_connectionState",Ts.CLOSED),Jt(this,"reconnectToken",void 0),Jt(this,"p2pToken",void 0),Jt(this,"websocket",void 0),Jt(this,"openConnectionTime",void 0),Jt(this,"clientId",void 0),Jt(this,"lastMsgTime",Date.now()),Jt(this,"uploadCache",[]),Jt(this,"uploadCacheInterval",void 0),Jt(this,"rttRolling",new G3(5)),Jt(this,"pingpongTimer",void 0),Jt(this,"pingpongTimeoutCount",0),Jt(this,"joinResponse",void 0),Jt(this,"multiIpOption",void 0),Jt(this,"initError",void 0),Jt(this,"spec",void 0),Jt(this,"store",void 0),Jt(this,"_external_signal",void 0),Jt(this,"onWebsocketMessage",ct=>{if(ct.data instanceof ArrayBuffer)return void this.emit(io.ON_BINARY_DATA,ct.data);const ut=JSON.parse(ct.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(ut,"_id")){const pt="res-@".concat(ut._id);this.emit(pt,ut._result,ut._message)}else if(Object.prototype.hasOwnProperty.call(ut,"_type")){switch(ut._type){case Oo.ON_DATA_STREAM:return void this.handleDataStream(ut._message);case Oo.MUTE_AUDIO:case Oo.MUTE_VIDEO:case Oo.ON_P2P_LOST:case Oo.ON_USER_ONLINE:return;case Oo.ON_USER_OFFLINE:const{uid:pt}=ut._message;return Ut.debug("[".concat(this.clientId,"] user-offline uid: ").concat(pt)),void this._external_signal.reset(pt)}if(this.emit(ut._type,ut._message),ut._type===Oo.ON_NOTIFICATION&&this.handleNotification(ut._message),ut._type===Oo.ON_USER_BANNED)switch(ut._message.error_code){case 14:this.close(Xo.UID_BANNED);break;case 15:this.close(Xo.IP_BANNED);break;case 16:this.close(Xo.CHANNEL_BANNED)}if(ut._type===Oo.ON_USER_LICENSE_BANNED)switch(ut._message.error_code){case Xr.ERR_LICENSE_MISSING:this.close(Xo.LICENSE_MISSING);break;case Xr.ERR_LICENSE_EXPIRED:this.close(Xo.LICENSE_EXPIRED);break;case Xr.ERR_LICENSE_MINUTES_EXCEEDED:this.close(Xo.LICENSE_MINUTES_EXCEEDED);break;case Xr.ERR_LICENSE_PERIOD_INVALID:this.close(Xo.LICENSE_PERIOD_INVALID);break;case Xr.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(Xo.LICENSE_MULTIPLE_SDK_SERVICE);break;case Xr.ERR_LICENSE_ILLEGAL:this.close(Xo.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=rt.clientId,this.spec=rt,this.store=it,this.websocket=new EM("gateway-".concat(this.clientId),this.spec.retryConfig,!0,rn("JOIN_GATEWAY_USE_DUAL_DOMAIN"),rn("JOIN_GATEWAY_USE_443PORT_ONLY"),it),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===Ts.CONNECTED&&this.reconnect("retry",nu.OFFLINE)}),this.p2pToken=ms(6,""),this._external_signal=new U0(this,this.p2pToken)}async request(rt,it,ct,ut){const pt=ms(6,""),mt={_id:pt,_type:rt,_message:it},_t=this.websocket.connectionID,vt=()=>new Ir((jt,$t)=>{if(this.connectionState===Ts.CONNECTED)return jt();const Ht=()=>{this.off(io.WS_CLOSED,en),jt()},en=()=>{this.off(io.WS_CONNECTED,Ht),$t(new Yn(tn.WS_ABORT))};this.once(io.WS_CONNECTED,Ht),this.once(io.WS_CLOSED,en)});if(this.connectionState!==Ts.CONNECTING&&this.connectionState!==Ts.RECONNECTING||rt===_i.JOIN||rt===_i.REJOIN||await vt(),this.websocket.sendMessage(mt,!0),ut)return;const Tt=new Ir((jt,$t)=>{let Ht=!1;const en=(on,Tn)=>{Ht=!0,jt({isSuccess:on==="success",message:Tn||{}}),this.off(io.WS_CLOSED,Qt),this.off(io.WS_RECONNECTING,Qt),this.emit(io.REQUEST_SUCCESS,rt,it)};this.once("res-@".concat(pt),en);const Qt=()=>{$t(new Yn(tn.WS_ABORT,"type: ".concat(rt))),this.off(io.WS_CLOSED,Qt),this.off(io.WS_RECONNECTING,Qt),this.off("res-@".concat(pt),en)};this.once(io.WS_CLOSED,Qt),this.once(io.WS_RECONNECTING,Qt),zl(rn("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==_t||Ht||(Ut.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(rt)),this.emit(io.REQUEST_TIMEOUT,rt,it))})});let bt=null;try{bt=await Tt}catch(jt){if(this.connectionState===Ts.CLOSED||rt===_i.LEAVE)throw new Yn(tn.WS_ABORT);return!this.spec.forceWaitGatewayResponse||ct?jt.throw():rt===_i.JOIN||rt===_i.REJOIN?null:(await vt(),await this.request(rt,it))}if(bt.isSuccess)return bt.message;const Ot=Number(bt.message.error_code||bt.message.code),Mt=bA(Ot),Dt=new Yn(tn.UNEXPECTED_RESPONSE,"".concat(Mt.desc,": ").concat(bt.message.error_str),{code:Ot,data:bt.message,desc:Mt.desc});return Mt.action==="success"?bt.message:(Ut.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(rt,", error_code: ").concat(Ot,", message: ").concat(Mt.desc,", action: ").concat(Mt.action)),Ot===Xr.ERR_TOO_MANY_BROADCASTERS?((rt===_i.JOIN||rt===_i.REJOIN)&&(this.initError=Dt,this.close()),Dt.throw()):Mt.action==="failed"?Dt.throw():Mt.action==="quit"?(this.initError=Dt,this.close(),Dt.throw()):(Ot===Xr.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=bt.message.option,Ut.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",nu.MULTI_IP)):this.reconnect(Mt.action,nu.SERVER_ERROR),rt===_i.JOIN||rt===_i.REJOIN?null:await this.request(rt,it)))}waitMessage(rt,it){return new Ir(ct=>{const ut=pt=>{(!it||it(pt))&&(this.off(rt,ut),ct(pt))};this.on(rt,ut)})}uploadWRTCStats(rt){if(!this.store.sessionId)return void Ut.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const it={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:rt};this.upload(AA.WRTC_STATS,it)}upload(rt,it){const ct={_type:rt,_message:it};try{this.websocket.sendMessage(ct)}catch{const pt=rn("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(ct),this.uploadCache.length>pt&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==Ts.CONNECTED)return;const mt=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(mt._type,mt._message)},rn("UPLOAD_CACHE_INTERVAL")||2e3))}}send(rt,it){const ct={_type:rt,_message:it};this.websocket.sendMessage(ct)}async sendExtensionMessage(rt,it,ct){return await this._external_signal.send(rt,it,ct)}init(rt){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new Ir((it,ct)=>{this.once(io.WS_CONNECTED,()=>it(this.joinResponse)),this.once(io.WS_CLOSED,()=>ct(this.initError||new Yn(tn.WS_ABORT))),this.connectionState=Ts.CONNECTING,this.websocket.init(rt).catch(ct)})}close(rt){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._external_signal.clear(),this._disconnectedReason=rt||Xo.LEAVE,this.connectionState=Ts.CLOSED,Ut.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close(),this.p2pToken=ms(6,""),this._external_signal.clear(),this._external_signal=new U0(this,this.p2pToken)}async join(){if(!this.joinResponse){this.emit(io.ABORT_P2P_EXECUTION);const rt=await ru(this,io.REQUEST_JOIN_INFO),it=await this.request(_i.JOIN,rt);if(!it)return this.emit(io.REPORT_JOIN_GATEWAY,tn.TIMEOUT,this.url||""),!1;this.joinResponse=it,this.emit(io.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=Ts.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}reconnect(rt,it){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(rt,it)}async downgradeCodec(rt){return!1}handleDataStream(rt){try{var it;const ct=g0(rt.payload),ut=new TextDecoder().decode(ct),pt=JSON.parse(ut);"total"in pt&&"id"in pt||Er(it=Object.values(qs)).call(it,pt._type)?(pt._uid=rt.uid,this._external_signal.onMessage(pt)):this.emit(Oo.ON_DATA_STREAM,rt)}catch{this.emit(Oo.ON_DATA_STREAM,rt)}}handleNotification(rt){Ut.debug("[".concat(this.clientId,"] receive notification: "),rt);const it=bA(rt.code);if(it.action!=="success"){if(it.action!=="failed")return it.action==="quit"?(it.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(Xo.UID_BANNED),void this.close()):void this.reconnect(it.action,nu.SERVER_ERROR);Ut.error("[".concat(this.clientId,"] ignore error: "),it.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const rt=rn("PING_PONG_TIME_OUT"),it=Date.now();this.pingpongTimeoutCount>=rt&&(Ut.warning("[".concat(this.clientId,"] PINGPONG Timeout. Last Socket Message: ").concat(it-this.lastMsgTime,"ms")),it-this.lastMsgTime>rn("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",nu.TIMEOUT):this.request(_i.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const ct=Date.now()-it;this.rttRolling.add(ct),rn("REPORT_STATS")&&this.send(_i.PING_BACK,{pingpongElapse:ct})}).catch(ct=>{})}handleWebsocketEvents(){this.websocket.on(ho.RECONNECT_CREATE_CONNECTION,rt=>{this.emit(io.WS_RECONNECT_CREATE_CONNECTION,rt)}),this.websocket.on(ho.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(ho.CLOSED,()=>{this.connectionState=Ts.CLOSED}),this.websocket.on(ho.FAILED,()=>{this._disconnectedReason=Xo.NETWORK_ERROR,this.connectionState=Ts.CLOSED}),this.websocket.on(ho.RECONNECTING,rt=>{this._websocketReconnectReason=rt,this.joinResponse=void 0,this.connectionState===Ts.CONNECTED?this.connectionState=Ts.RECONNECTING:this.connectionState=Ts.CONNECTING}),this.websocket.on(ho.WILL_RECONNECT,(rt,it,ct)=>{rt!=="retry"?(Ut.debug("".concat(this.clientId," websocket will_connect event, renewSession reconnectMode is ").concat(rt)),this.reconnectToken=void 0):Ut.debug("".concat(this.clientId," reconnect mode is retry, no need to renew session")),ct(rt)}),this.websocket.on(ho.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.join().catch(rt=>{if(this.emit(io.REPORT_JOIN_GATEWAY,rt,this.url||""),rt instanceof Yn&&rt.code===tn.UNEXPECTED_RESPONSE&&rt.data.code===Xr.ERR_NO_AUTHORIZED)return Ut.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",nu.SERVER_ERROR);Ut.error("[".concat(this.clientId,"] join gateway request failed"),rt.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",nu.SERVER_ERROR):(this.initError=rt,this.close())})}),this.websocket.on(ho.REQUEST_NEW_URLS,(rt,it)=>{ru(this,io.REQUEST_RECOVER,this.multiIpOption).then(rt).catch(it)}),this.websocket.on(ho.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(Oo.ON_TOKEN_PRIVILEGE_DID_EXPIRE)})}}const aZ={name:"P2PChannel",create:function(_e){let{store:rt,statsCollector:it}=_e;return new oZ(rt,it)},createSubmodule:function(_e){let{store:rt,spec:it}=_e;return new sZ(it,rt)}};function f$(_e,rt){var it=Object.keys(_e);if(Object.getOwnPropertySymbols){var ct=Object.getOwnPropertySymbols(_e);rt&&(ct=ct.filter(function(ut){return Object.getOwnPropertyDescriptor(_e,ut).enumerable})),it.push.apply(it,ct)}return it}function m$(_e){for(var rt=1;rt<arguments.length;rt++){var it=arguments[rt]!=null?arguments[rt]:{};rt%2?f$(Object(it),!0).forEach(function(ct){Jt(_e,ct,it[ct])}):Object.getOwnPropertyDescriptors?Object.defineProperties(_e,Object.getOwnPropertyDescriptors(it)):f$(Object(it)).forEach(function(ct){Object.defineProperty(_e,ct,Object.getOwnPropertyDescriptor(it,ct))})}return _e}class cZ{constructor(rt){Jt(this,"sessionDesc",void 0),Jt(this,"localCapabilities",void 0),Jt(this,"rtpCapabilities",void 0),Jt(this,"candidates",void 0),Jt(this,"_originCandidates",void 0),Jt(this,"iceParameters",void 0),Jt(this,"dtlsParameters",void 0),Jt(this,"setup",void 0),Jt(this,"currentMidIndex",void 0),Jt(this,"cname",void 0),rt=Ds(rt);const{iceParameters:it,dtlsParameters:ct,candidates:ut,rtpCapabilities:pt,setup:mt,localCapabilities:_t,sdkCodec:vt,cname:Tt}=rt,bt=op(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE audio video
a=msid-semantic: WMS
a=ice-lite
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:audio
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:video
`);this.rtpCapabilities=pt,this.candidates=ut,this._originCandidates=Ds(ut),this.iceParameters=it,this.dtlsParameters=ct,this.setup=mt,this.localCapabilities=_t,this.cname=Tt;for(let Ot=0;Ot<bt.mediaDescriptions.length;Ot++){const Mt=bt.mediaDescriptions[Ot];if(Mt.attributes.iceUfrag=it.iceUfrag,Mt.attributes.icePwd=it.icePwd,Mt.attributes.fingerprints=ct.fingerprints,Mt.attributes.candidates=ut,Mt.attributes.setup=mt,Mt.media.mediaType==="video"){Mt.media.fmts=pt.videoCodecs.map($t=>$t.payloadType.toString(10));const Dt=pt.videoCodecs.filter($t=>{var Ht,en;return(Ht=$t.rtpMap)===null||Ht===void 0?void 0:Er(en=Ht.encodingName.toLowerCase()).call(en,vt)}),jt=pt.videoCodecs.filter($t=>!Er(Dt).call(Dt,$t));Mt.attributes.payloads=[...Dt,...jt],Mt.attributes.extmaps=pt.videoExtensions}Mt.media.mediaType==="audio"&&(Mt.media.fmts=pt.audioCodecs.map(Dt=>Dt.payloadType.toString(10)),Mt.attributes.payloads=pt.audioCodecs,Mt.attributes.extmaps=pt.audioExtensions),bt.mediaDescriptions[Ot]=this.mungMediaDesc(Mt)}this.sessionDesc=bt,this.currentMidIndex=bt.mediaDescriptions.length-1}toString(){return rv(this.sessionDesc)}send(rt,it,ct){const{ssrcs:ut,ssrcGroups:pt}=xA(it,this.cname),mt=this.sessionDesc.mediaDescriptions.find(Tt=>rt===Pr.VIDEO?Tt.media.mediaType==="video":Tt.media.mediaType==="audio"),_t=ut[0].attributes.label,vt=ut[0].attributes.mslabel;return mt.attributes.ssrcs=mt.attributes.ssrcs.concat(ut),mt.attributes.ssrcGroups=mt.attributes.ssrcGroups.concat(pt),{id:_t,mslabel:vt}}batchSend(rt){return rt.map(it=>{let{kind:ct,ssrcMsg:ut}=it;return this.send(ct,ut,void 0)})}stopSending(rt){this.sessionDesc.mediaDescriptions.forEach(it=>{const ct=[],ut=[],pt=[];it.attributes.ssrcs.forEach(mt=>{Er(rt).call(rt,mt.attributes.label||"")?pt.push(mt):ct.push(mt)}),it.attributes.ssrcGroups.forEach(mt=>{var _t;Er(_t=pt.map(vt=>vt.ssrcId)).call(_t,mt.ssrcIds[0])||ut.push(mt)}),it.attributes.ssrcs=ct,it.attributes.ssrcGroups=ut})}mute(rt){const it=this.sessionDesc.mediaDescriptions.find(ct=>ct.attributes.mid===rt);if(!it)throw new Error("mediaDescription not found with ".concat(rt," in remote SDP when calling RemoteSDP.mute."));it.attributes.direction="inactive"}unmute(rt){const it=this.sessionDesc.mediaDescriptions.find(ct=>ct.attributes.mid===rt);if(!it)throw new Error("mediaDescription not found with ".concat(rt," in remote SDP when calling RemoteSDP.unmute."));it.attributes.direction="sendonly"}receive(rt,it,ct){rt.forEach((ut,pt)=>{const mt=ut._mediaStreamTrack,_t=this.sessionDesc.mediaDescriptions.findIndex(Tt=>Tt.attributes.mid===mt.kind),vt=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[_t],ut);this.sessionDesc.mediaDescriptions[_t]=vt})}stopReceiving(rt){}updateCandidates(rt){const it=this._originCandidates.filter(ut=>ut.transport==="udp"),ct=[];if(it.forEach(ut=>{ct.push(m$(m$({},ut),{},{foundation:"tcpcandidate",priority:Number(ut.priority)-1+"",transport:"tcp",port:Number(ut.port)+90+""}))}),it.length!==0){switch(rt){case hu.TCP_RELAY:this.candidates=ct;break;case hu.UDP_TCP_RELAY:case hu.RELAY:this.candidates=[...it,...ct];break;default:this.candidates=it}for(const ut of this.sessionDesc.mediaDescriptions)ut.attributes.candidates=this.candidates}}restartICE(rt){rt=Ds(rt),this.iceParameters=rt,this.sessionDesc.mediaDescriptions.forEach(it=>{it.attributes.iceUfrag=rt.iceUfrag,it.attributes.icePwd=rt.icePwd})}predictReceivingMids(rt){const it=[];for(let ct=0;ct<rt;ct++)it.push((this.currentMidIndex+ct+1).toString(10));return it}mungRecvMediaDsec(rt,it){const ct=Ds(rt);return kS(ct,it),TM(ct,it),ct}updateRecvMedia(rt,it){const ct=this.sessionDesc.mediaDescriptions.findIndex(ut=>ut.attributes.mid===rt);if(ct!==-1){const ut=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[ct],it);this.sessionDesc.mediaDescriptions[ct]=ut}}bumpMid(rt){this.currentMidIndex+=rt}updateTrackLabel(rt,it,ct){const ut=this.sessionDesc.mediaDescriptions.find(mt=>rt===Pr.VIDEO?mt.attributes.mid==="video":mt.attributes.mid==="audio");if(ut){const mt=ut.attributes.ssrcs.find(_t=>_t.attributes.label===it);var pt;mt&&(mt.attributes.label=ct,(pt=mt.attributes.msid)===null||pt===void 0||pt.replace(it,ct))}}mungMediaDesc(rt){const it=Ds(rt);return SM(it),function(ct){const ut=ct.attributes.extmaps.find(pt=>zw(pt.extensionName));ut&&ct.attributes.extmaps.splice(ct.attributes.extmaps.indexOf(ut),1),ct.attributes.payloads.forEach(pt=>{const mt=pt.rtcpFeedbacks.findIndex(_t=>_t.type==="transport-cc");mt!==-1&&pt.rtcpFeedbacks.splice(mt,1)})}(it),it}getSSRC(rt){for(const it of this.sessionDesc.mediaDescriptions)for(const ct of it.attributes.ssrcs)if(ct.attributes.label===rt)return[ct]}}var gs;function g$(_e,rt){var it=Object.keys(_e);if(Object.getOwnPropertySymbols){var ct=Object.getOwnPropertySymbols(_e);rt&&(ct=ct.filter(function(ut){return Object.getOwnPropertyDescriptor(_e,ut).enumerable})),it.push.apply(it,ct)}return it}function I1(_e){for(var rt=1;rt<arguments.length;rt++){var it=arguments[rt]!=null?arguments[rt]:{};rt%2?g$(Object(it),!0).forEach(function(ct){Jt(_e,ct,it[ct])}):Object.getOwnPropertyDescriptors?Object.defineProperties(_e,Object.getOwnPropertyDescriptors(it)):g$(Object(it)).forEach(function(ct){Object.defineProperty(_e,ct,Object.getOwnPropertyDescriptor(it,ct))})}return _e}let lZ=(gs=class iC extends IV{get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.videoCodecs.map(rt=>rt.rtpMap&&rt.rtpMap.encodingName.toLowerCase()||"").filter(rt=>{var it;return Er(it=Object.keys(EA)).call(it,rt)}))]}constructor(rt,it){super(rt,it),Jt(this,"store",void 0),Jt(this,"peerConnection",void 0),Jt(this,"remoteSDP",void 0),Jt(this,"initialOffer",void 0),Jt(this,"statsFilter",void 0),Jt(this,"useRTX",!1),Jt(this,"localCapabilities",void 0),Jt(this,"localCandidateCount",0),Jt(this,"allCandidatesReceived",!1),Jt(this,"establishPromise",void 0),Jt(this,"mutex",void 0),this.store=it,this.mutex=new lu("P2PConnection-mutex",it.clientId),this.peerConnection=new RTCPeerConnection(iC.resolvePCConfiguration(rt),{optional:[{googDscp:!0}]}),this.statsFilter=OO(this.peerConnection,rn("STATS_UPDATE_INTERVAL"),void 0,Gs()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async establish(){try{const rt=await this.peerConnection.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});if(!rt.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const it=lv(rt.sdp),ct=IA(rt.sdp,{filterRTX:!this.useRTX,filterVideoFec:rn("FILTER_VIDEO_FEC"),filterAudioFec:rn("FILTER_AUDIO_FEC"),filterAudioCodec:["opus"]});return this.localCapabilities=ct,this.initialOffer=rt,I1(I1({},it),{},{rtpCapabilities:{send:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},recv:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},sendrecv:ct},offerSDP:rt.sdp})}catch(rt){throw new Yn(tn.GET_LOCAL_CONNECTION_PARAMS_FAILED,rt.toString())}}async updateRemoteConnect(){}async connect(rt){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new cZ(I1(I1({},rt),{},{rtpCapabilities:rt.rtpCapabilities.send,localCapabilities:this.localCapabilities,sdkCodec:this.store.codec}));const it=this.remoteSDP.toString();await this.peerConnection.setLocalDescription(this.initialOffer),await this.peerConnection.setRemoteDescription({type:"answer",sdp:it})}catch(it){throw new Yn(tn.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(it.toString()))}}async updateRemoteRTPCapabilities(rt,it){throw new Yn(tn.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}getPreMedia(rt){}send(rt,it){var ct=this;return Jp(function*(){const ut=yield Bo(ct.mutex.lock());try{if(!ct.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const pt=rt.map(Mt=>ct.peerConnection.addTrack(Mt._mediaStreamTrack)),mt=yield Bo(ct.peerConnection.createOffer()),_t=op(mt.sdp),vt=rt.map(Mt=>{const Dt=Mt._mediaStreamTrack,jt=_t.mediaDescriptions.find($t=>$t.attributes.mid===Dt.kind);if(!jt)throw new Error("Cannot extract ssrc from mediaDescription.");return function($t,Ht,en){const Qt=$t.attributes.ssrcs.filter(Tn=>Tn.attributes.label===Ht),on=$t.attributes.ssrcGroups;if(Qt.length===0)throw new Error("Cannot extract ssrc from plan-b SDP.");if(on&&Qt.length>1){const Tn=on.find(vn=>vn.ssrcIds.indexOf(Qt[0].ssrcId)!==-1);return Tn?[{ssrcId:Tn.ssrcIds[0],rtx:en?Tn.ssrcIds[1]:void 0}]:[{ssrcId:Qt[0].ssrcId}]}return[{ssrcId:Qt[0].ssrcId}]}(jt,Dt.id,ct.useRTX)});let Tt;try{Tt=yield vt}catch(Mt){throw pt.forEach(Dt=>{tu()&&Dt.replaceTrack(null),ct.peerConnection.removeTrack(Dt)}),Mt}const bt=ct.mungSendOfferSDP(mt.sdp,rt);ct.remoteSDP.receive(rt,it,Tt);const Ot=ct.remoteSDP.toString();return yield Bo(ct.peerConnection.setLocalDescription({type:"offer",sdp:bt})),yield Bo(ct.applySendEncodings(pt,rt)),yield Bo(ct.peerConnection.setRemoteDescription({type:"answer",sdp:Ot})),rt.map((Mt,Dt)=>{const jt=Mt._mediaStreamTrack.id;return{localSSRC:vt[Dt],id:jt}})}catch(pt){throw new Yn(tn.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(pt.toString()))}finally{ut()}})()}async stopSending(rt){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const it=this.peerConnection.getSenders().filter(pt=>{var mt;return rt.indexOf(((mt=pt.track)===null||mt===void 0?void 0:mt.id)||"")!==-1});if(it.length!==rt.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");it.map(pt=>{tu()&&pt.replaceTrack(null),this.peerConnection.removeTrack(pt)});const ct=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(ct),this.remoteSDP.stopReceiving(rt);const ut=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:ut})}catch(it){throw new Yn(tn.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(it.toString()))}}async receive(rt,it,ct,ut){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(rt," before remoteSDP created."));const{id:pt,mslabel:mt}=this.remoteSDP.send(rt,it,ut),_t=new Ir((bt,Ot)=>{const Mt=setTimeout(()=>{Ot(new Error("Cannot receive track, id: ".concat(pt)))},1e4),Dt=jt=>{const $t=No();if(($t.name==="Safari"&&Number($t.version)===11||Tu())&&jt.track.id!==pt&&jt.streams[0].id===mt){var Ht;const en=jt.streams[0].getTracks()[0];return(Ht=this.remoteSDP)===null||Ht===void 0||Ht.updateTrackLabel(rt,pt,jt.track.id),this.peerConnection.removeEventListener("track",Dt),clearTimeout(Mt),void bt(en)}if(jt.track.id===pt)return this.peerConnection.removeEventListener("track",Dt),clearTimeout(Mt),void bt(jt.track)};this.peerConnection.addEventListener("track",Dt)}),vt=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:vt});const Tt=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(Tt),{track:await _t,id:pt}}catch(pt){throw new Yn(tn.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(pt.toString()))}}async stopReceiving(rt){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(rt);const it=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:it});const ct=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(ct)}catch(it){throw new Yn(tn.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(it.toString()))}}async muteRemote(rt){}async unmuteRemote(rt){}async muteLocal(rt){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const it=this.peerConnection.getSenders().filter(ct=>{var ut;return rt.indexOf(((ut=ct.track)===null||ut===void 0?void 0:ut.id)||"")!==-1});if(it.length!==rt.length)throw new Error("sender' length doesn't match mids' length.");it.map(ct=>{if(tu()&&ct.track)ct.track.enabled=!1;else{const ut=ct.getParameters();ut.encodings.forEach(pt=>pt.active=!1),ct.setParameters(ut)}})}catch(it){throw new Yn(tn.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(it.toString()))}}async unmuteLocal(rt){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const it=this.peerConnection.getSenders().filter(pt=>{var mt;return rt.indexOf(((mt=pt.track)===null||mt===void 0?void 0:mt.id)||"")!==-1});if(it.length!==rt.length)throw new Error("Senders' length doesn't match mids' length.");it.map(async pt=>{if(tu()&&pt.track)pt.track.enabled=!0;else{const mt=pt.getParameters();mt.encodings.forEach(_t=>_t.active=!0),await pt.setParameters(mt)}});const ct=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(ct);const ut=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:ut})}catch(it){throw new Yn(tn.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(it.toString()))}}restartICE(rt){var it=this;return Jp(function*(){const ct=yield Bo(it.mutex.lock("From P2PConnection.restartICE"));try{if(!it.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");const ut=Fo().supportPCSetConfiguration;if(rt===hu.RELAY&&!ut)return;if(ut){const Tt=it.peerConnection.getConfiguration(),bt=rt===hu.RELAY?"relay":"all";Tt.iceTransportPolicy!==bt&&(Ut.debug("[".concat(it.store.clientId,"] restartICE change iceTransportPolicy from [").concat(Tt.iceTransportPolicy,"] to [").concat(bt,"]")),Tt.iceTransportPolicy=bt,it.peerConnection.setConfiguration(Tt))}rt!==hu.RELAY&&it.remoteSDP.updateCandidates(rt);const pt=yield Bo(it.peerConnection.createOffer({iceRestart:!0}));if(!pt.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const mt=lv(pt.sdp),{remoteIceParameters:_t}=yield mt.iceParameters;it.remoteSDP.restartICE(_t);const vt=it.remoteSDP.toString();yield Bo(it.peerConnection.setLocalDescription(pt)),yield Bo(it.peerConnection.setRemoteDescription({type:"answer",sdp:vt}))}catch(ut){Ut.warning("[".concat(it.store.clientId,"] restart ICE failed, abort operation"),ut)}finally{ct()}})()}close(){var rt;this.peerConnection.close(),(rt=this.onConnectionStateChange)===null||rt===void 0||rt.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(rt){return this.statsFilter.getVideoIsReady(rt)}async updateEncoderConfig(rt,it){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const ct=await this.peerConnection.createOffer(),ut=this.mungSendOfferSDP(ct.sdp,[it]);this.remoteSDP.updateRecvMedia(it._mediaStreamTrack.kind,it);const pt=this.remoteSDP.toString();await this.peerConnection.setLocalDescription({type:"offer",sdp:ut}),await this.peerConnection.setRemoteDescription({type:"answer",sdp:pt})}catch(ct){throw new Yn(tn.EXCHANGE_SDP_FAILED,ct.toString())}}async updateSendParameters(rt,it){const ct=this.peerConnection.getSenders().filter(ut=>{var pt;return((pt=ut.track)===null||pt===void 0?void 0:pt.id)===rt});ct.length===1&&await this.applySendEncodings(ct,[it])}setStatsRemoteVideoIsReady(rt,it){this.statsFilter.setVideoIsReady2(rt,it)}async replaceTrack(rt,it){const ct=this.peerConnection.getSenders().find(ut=>{var pt;return((pt=ut.track)===null||pt===void 0?void 0:pt.id)===it});ct&&await ct.replaceTrack(rt._mediaStreamTrack)}createDataChannels(rt,it){throw new Yn(tn.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}stopDataChannels(rt){throw new Yn(tn.NOT_SUPPORTED,"Planb mode does not support stopDataChannels.")}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var rt;(rt=this.onICEConnectionStateChange)===null||rt===void 0||rt.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var rt;(rt=this.onConnectionStateChange)===null||rt===void 0||rt.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=rt=>{rt.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,Ut.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,Ut.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},rn("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(rt){const it={iceServers:[],sdpSemantics:"plan-b"};return rt.iceServers?it.iceServers=rt.iceServers:rt.turnServer&&rt.turnServer.mode!=="off"&&(pA(rt.turnServer.servers)?it.iceServers=rt.turnServer.servers:(it.iceServers&&it.iceServers.push(...iC.turnServerConfigToIceServers(rt.turnServer.servers)),rn("USE_TURN_SERVER_OF_GATEWAY")&&it.iceServers&&rt.turnServer.serversFromGateway&&it.iceServers.push(...iC.turnServerConfigToIceServers(rt.turnServer.serversFromGateway)),rt.turnServer.servers.concat(rt.turnServer.serversFromGateway||[]).forEach(ct=>{ct.forceturn&&(it.iceTransportPolicy="relay")}))),it}static turnServerConfigToIceServers(rt){const it=[];return rt.forEach(ct=>{ct.security?ct.tcpport&&it.push({username:ct.username,credential:ct.password,credentialType:"password",urls:"turns:".concat(ct.turnServerURL,":").concat(ct.tcpport,"?transport=tcp")}):(ct.udpport&&it.push({username:ct.username,credential:ct.password,credentialType:"password",urls:"turn:".concat(ct.turnServerURL,":").concat(ct.udpport,"?transport=udp")}),ct.tcpport&&it.push({username:ct.username,credential:ct.password,credentialType:"password",urls:"turn:".concat(ct.turnServerURL,":").concat(ct.tcpport,"?transport=tcp")}))}),it}async updateRtpSenderEncodings(rt,it){var ct;if(it||(it=this.peerConnection.getSenders().find(Tt=>{var bt;return((bt=Tt.track)===null||bt===void 0?void 0:bt.id)===rt._mediaStreamTrack.id})),!it)return Ut.warn("[".concat(rt.getTrackId(),"] no rtpSender found}"));if(!Fo().supportSetRtpSenderParameters)return Ut.warn("Browser not support set rtp-sender parameters");const ut={},pt={};if(rt instanceof Cs)switch(rt._optimizationMode){case"motion":ut.degradationPreference="maintain-framerate";break;case"detail":ut.degradationPreference="maintain-resolution";break;default:ut.degradationPreference="balanced"}if(rn("DSCP_TYPE")&&hE()){var mt;const Tt=rn("DSCP_TYPE");Er(mt=["very-low","low","medium","high"]).call(mt,Tt)&&(pt.networkPriority=Tt)}const _t=it.getParameters(),vt=(ct=_t.encodings)===null||ct===void 0?void 0:ct[0];vt&&Object.assign(vt,pt),Object.assign(_t,ut),Ut.debug("[".concat(rt.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(_t.encodings))),await it.setParameters(_t)}async applySendEncodings(rt,it){try{if(!Fo().supportSetRtpSenderParameters||rt.length!==it.length)return;for(let ct=0;ct<rt.length;ct++){const ut=rt[ct],pt=it[ct];ut&&pt&&await this.updateRtpSenderEncodings(pt,ut)}}catch{Ut.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(rt,it){const ct=op(rt);return it.forEach((ut,pt)=>{const mt=ut._mediaStreamTrack,_t=ct.mediaDescriptions.find(vt=>vt.attributes.mid===mt.kind);_t&&kS(_t,ut)}),rv(ct)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=rt=>{var it;(it=this.onFirstAudioReceived)===null||it===void 0||it.call(this,rt)},this.statsFilter.onFirstVideoReceived=rt=>{var it;(it=this.onFirstVideoReceived)===null||it===void 0||it.call(this,rt)},this.statsFilter.onFirstAudioDecoded=rt=>{var it;(it=this.onFirstAudioDecoded)===null||it===void 0||it.call(this,rt)},this.statsFilter.onFirstVideoDecoded=(rt,it,ct)=>{var ut;(ut=this.onFirstVideoDecoded)===null||ut===void 0||ut.call(this,rt,it,ct)},this.statsFilter.onSelectedLocalCandidateChanged=(rt,it)=>{var ct;(ct=this.onSelectedLocalCandidateChanged)===null||ct===void 0||ct.call(this,rt,it)},this.statsFilter.onSelectedRemoteCandidateChanged=(rt,it)=>{var ct;(ct=this.onSelectedRemoteCandidateChanged)===null||ct===void 0||ct.call(this,rt,it)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0}async batchReceive(rt){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const it=this.remoteSDP.batchSend(rt).map((pt,mt)=>{let{id:_t,mslabel:vt}=pt;const{kind:Tt}=rt[mt];return new Ir((bt,Ot)=>{const Mt=setTimeout(()=>{Ot(new Error("Cannot receive track, id: ".concat(_t)))},1e4),Dt=jt=>{const $t=No();if($t.name==="Safari"&&Number($t.version)===11&&jt.track.id!==_t&&jt.streams[0].id===vt){var Ht;const en=jt.streams[0].getTracks()[0];return(Ht=this.remoteSDP)===null||Ht===void 0||Ht.updateTrackLabel(Tt,_t,jt.track.id),this.peerConnection.removeEventListener("track",Dt),clearTimeout(Mt),void bt({track:en,id:_t})}if(jt.track.id===_t)return this.peerConnection.removeEventListener("track",Dt),clearTimeout(Mt),void bt({track:jt.track,id:_t})};this.peerConnection.addEventListener("track",Dt)})}),ct=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:ct});const ut=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(ut),await Ir.all(it)}catch(it){throw new Yn(tn.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(it.toString()))}}async getRemoteSSRC(rt){if(!this.remoteSDP)return;const it=this.remoteSDP.getSSRC(rt);return it==null?void 0:it[0].ssrcId}setConfiguration(rt){if(Fo().supportPCSetConfiguration){const it=iC.resolvePCConfiguration(rt);this.peerConnection.setConfiguration(it)}}},Br(gs.prototype,"connect",[om],Object.getOwnPropertyDescriptor(gs.prototype,"connect"),gs.prototype),Br(gs.prototype,"stopSending",[om],Object.getOwnPropertyDescriptor(gs.prototype,"stopSending"),gs.prototype),Br(gs.prototype,"receive",[om],Object.getOwnPropertyDescriptor(gs.prototype,"receive"),gs.prototype),Br(gs.prototype,"stopReceiving",[om],Object.getOwnPropertyDescriptor(gs.prototype,"stopReceiving"),gs.prototype),Br(gs.prototype,"muteRemote",[om],Object.getOwnPropertyDescriptor(gs.prototype,"muteRemote"),gs.prototype),Br(gs.prototype,"unmuteRemote",[om],Object.getOwnPropertyDescriptor(gs.prototype,"unmuteRemote"),gs.prototype),Br(gs.prototype,"muteLocal",[om],Object.getOwnPropertyDescriptor(gs.prototype,"muteLocal"),gs.prototype),Br(gs.prototype,"unmuteLocal",[om],Object.getOwnPropertyDescriptor(gs.prototype,"unmuteLocal"),gs.prototype),Br(gs.prototype,"close",[om],Object.getOwnPropertyDescriptor(gs.prototype,"close"),gs.prototype),Br(gs.prototype,"updateEncoderConfig",[om],Object.getOwnPropertyDescriptor(gs.prototype,"updateEncoderConfig"),gs.prototype),Br(gs.prototype,"updateSendParameters",[om],Object.getOwnPropertyDescriptor(gs.prototype,"updateSendParameters"),gs.prototype),Br(gs.prototype,"replaceTrack",[om],Object.getOwnPropertyDescriptor(gs.prototype,"replaceTrack"),gs.prototype),Br(gs.prototype,"getRemoteSSRC",[om],Object.getOwnPropertyDescriptor(gs.prototype,"getRemoteSSRC"),gs.prototype),gs);function om(_e,rt,it){const ct=_e[rt];if(typeof ct!="function")throw new Error("Cannot use mutex on object property.");return it.value=async function(){const ut=this.mutex,pt=await ut.lock("Locking from P2PConnection.".concat(rt));try{for(var mt=arguments.length,_t=new Array(mt),vt=0;vt<mt;vt++)_t[vt]=arguments[vt];return await ct.apply(this,_t)}finally{pt()}},it}const uZ={name:"PlanBConnection",create:function(_e){let{store:rt,spec:it}=_e;return new lZ(it,rt)}},dZ={interceptLocalAudioFrame:async function(_e){let rt=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!Fo().supportWebRTCEncodedTransform)return void Ut.warning("browser not support audio encoded transform");if(Iw.has(_e)||!_e.track)return;const it={track:_e.track};if(dE()){if(!_e.createEncodedStreams)return void Ut.warning("browser not support createEncodedStreams() API");let ut=null;try{ut=_e.createEncodedStreams()}catch(mt){return void Ut.error("create audio-encoded-streams error",mt&&mt.message)}const pt=new TransformStream({transform(mt,_t){it.controller||(it.controller=_t),_e.track&&_e.track.id!==it.track.id&&(Ut.debug("audio track changed: ".concat(it.track.id," => ").concat(_e.track.id)),it.track.removeEventListener("ended",ct),it.track=_e.track,it.track.addEventListener("ended",ct));const vt=rt.metadata&&rt.metadata();vt?function(Tt,bt){const{chunk:Ot,controller:Mt}=bt,Dt=iv.METADATA;Ot.data=function(jt,$t,Ht){const en=Ht.byteLength,Qt=en+tM+dV,on=QO+eM+Qt,Tn=new ArrayBuffer(jt.byteLength+on),vn=new DataView(Tn);vn.setUint8(0,uV),vn.setUint16(1,Qt),vn.setUint8(3,$t),vn.setUint16(4,en);for(let Ln=0;Ln<en;Ln++)vn.setUint8(6+Ln,Ht[Ln]);const hn=new Uint8Array(vn.buffer);return hn.set(new Uint8Array(jt),on),hn.buffer}(Ot.data,Dt,Tt),Mt.enqueue(Ot)}(vt,{sender:_e,chunk:mt,controller:_t}):_t.enqueue(mt)}});ut.readable.pipeThrough(pt).pipeTo(ut.writable)}else if(tu()){if(typeof RTCRtpScriptTransform>"u")return void Ut.warning("browser not support RTCRtpScriptTransform");const ut=ww(),pt=new MessageChannel;await new Ir(_t=>ut.onmessage=vt=>{vt.data==="registered"&&_t(void 0)});const mt=new RTCRtpScriptTransform(ut,{name:"audio-metadata-tx",port:pt.port2},[pt.port2]);_e.transform=mt,await new Ir(_t=>ut.onmessage=vt=>{vt.data==="started"&&_t(void 0)}),pt.port1.onmessage=_t=>{var vt;if(_t.data.transformed&&_e.track&&((vt=_e.track)===null||vt===void 0?void 0:vt.id)!==it.track.id)Ut.debug("audio track changed: ".concat(it.track.id," => ").concat(_e.track.id)),it.track.removeEventListener("ended",ct),it.track=_e.track,it.track.addEventListener("ended",ct);else if(_t.data.getMetadata){const Tt=rt.metadata&&rt.metadata();Tt&&pt.port1.postMessage({metadata:Tt})}},it.worker=ut}function ct(){if(_e.track){if(this.id!==_e.track.id)return;_e.track.removeEventListener("ended",ct)}const ut=Iw.get(_e);if(ut){Iw.delete(_e);try{var pt,mt;(pt=ut.controller)===null||pt===void 0||pt.terminate(),(mt=ut.worker)===null||mt===void 0||mt.terminate()}catch(_t){Ut.warning(_t&&_t.message)}}}Iw.set(_e,it),_e.track.addEventListener("ended",ct)},interceptRemoteAudioFrame:async function(_e){let rt=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!Fo().supportWebRTCEncodedTransform)return void Ut.warning("browser not support audio encoded transform");if(Dw.has(_e))return;const it={track:_e.track,onMetadata:rt.onMetadata,onPts:rt.onPts};if(dE()&&!Tu()){if(!_e.createEncodedStreams)return void Ut.warning("browser not support createEncodedStreams() API");uO(Ho.CHROME,87,116)||(rt.enableTopn=!1);let ut=null;try{ut=_e.createEncodedStreams()}catch(mt){return void Ut.error("create audio-encoded-streams error",mt&&mt.message)}const pt=new TransformStream({transform(mt,_t){it.controller||(it.controller=_t),_e.track&&_e.track.id!==it.track.id&&(Ut.debug("audio track changed: ".concat(it.track.id," => ").concat(_e.track.id)),it.track.removeEventListener("ended",ct),it.track=_e.track,it.track.addEventListener("ended",ct)),rt.enableTopn?function(vt,Tt,bt){var Ot;const Mt=nM(new DataView(Tt.data));if(!Mt)return bt.enqueue(Tt);const Dt=vt.track.id;KY.set(Dt,vt.track);const jt=(Ot=Mt.tlv.find(Tn=>Tn.tag===iv.AUDIO_LEVEL))===null||Ot===void 0?void 0:Ot.value;let $t=0;typeof jt=="number"&&($t=127-jt);const Ht=Math.round(Math.pow(10,$t/60)-1),{selected:en,speaker:Qt}=function(Tn,vn){let hn=xS.get(Tn);if(hn||(hn=function(Ln){const Xn=new pV;return xS.set(Ln,Xn),i_||(i_=new zY(rn("TOPN_SILENCE_THRESHOLD")||500),i_.on("ActiveSpeakerChanged",Qn=>{Qn!=null&&(Mw=Qn)})),i_.addSpeakers([Xn]),Xn}(Tn)),xS.size<=fV)return{selected:!0,speaker:hn};if(!i_)throw new Error("no active speaker detector");return i_.levelChanged(hn.id,vn),A0=i_.loudest.map(Ln=>Ln.id),Mw&&!Er(A0).call(A0,Mw)&&A0.length>=fV&&A0.pop(),{selected:Er(A0).call(A0,hn.id)||hn.id===Mw,speaker:hn}}(vt,Ht),on=function(Tn,vn,hn){const Ln=o_.get(Tn)||new WY(Tn,vn);return Ln.score=hn,o_.set(Tn,Ln),function(Xn){if(Pw.set(Xn,!0),!Nw)return void(Nw=Date.now());const Qn=Date.now();Qn-Nw>1e3&&(Pw.get(Xn)?Pw.set(Xn,!1):(mV(Xn),Pw.delete(Xn)),Nw=Qn)}(Tn),Ln}(Dt,vt.track,Qt.energyScore);on.addSample(en),on.active&&(Tt.data=Mt.frame.buffer,bt.enqueue(Tt))}(_e,mt,_t):rt.enableMetadata||rt.enablePts?function(vt,Tt,bt,Ot){const Mt=new DataView(vt.data),Dt=Mt.getUint8(0);let jt;if(128&Dt&&Dt!==71){const en=function(Qt){if(Qt.byteLength<=0)return[];const on=[];let Tn=0;for(;Tn<Qt.byteLength;){const hn=(128&Qt.getUint8(Tn))>>7,Ln=127&Qt.getUint8(Tn);if(!(hn&&Tn+4<=Qt.byteLength)){Tn++;break}{const Xn=Qt.getUint32(Tn,!1),Qn=(16776192&Xn)>>10,ur=1023&Xn;on.push({pt:Ln,ts_offset:Qn,length:ur,data:new Uint8Array}),Tn+=4}}let vn=Qt.byteLength-Tn;for(const hn of on){if(hn.length>vn)return console.warn("Broken red payload"),[];hn.length>0&&(hn.data=new Uint8Array(Qt.buffer,Qt.byteOffset+Tn,hn.length),Tn+=hn.length,vn-=hn.length)}if(vn>0){const hn={pt:on.length>0?on[on.length-1].pt:0,ts_offset:0,length:vn,data:new Uint8Array(Qt.buffer,Qt.byteOffset+Tn,vn)};on.push(hn)}return on}(Mt);if(en.length>0){const Qt=function(on){let Tn=0;for(let Ln=0;Ln<on.length;Ln++)Tn+=Ln<on.length-1?4:1,Tn+=on[Ln].length;const vn=new Uint8Array(Tn);let hn=0;for(let Ln=0;Ln<on.length;Ln++)if(Ln<on.length-1){const Xn=(2147483648|(127&on[Ln].pt)<<24|(262143&on[Ln].ts_offset)<<10|1023&on[Ln].length)>>>0;vn[hn++]=Xn>>24&255,vn[hn++]=Xn>>16&255,vn[hn++]=Xn>>8&255,vn[hn++]=255&Xn}else vn[hn++]=127&on[Ln].pt;for(const Ln of on)vn.set(Ln.data,hn),hn+=Ln.length;return vn}(en.map(on=>{const Tn=new Uint8Array(on.length);Tn.set(on.data);const vn=nM(new DataView(Tn.buffer));return vn!=null&&vn.frame&&(on.data=vn==null?void 0:vn.frame),jt=vn,on}));vt.data=Qt.buffer}}else jt=nM(Mt),jt&&(vt.data=jt.frame.buffer);if(Tt.enqueue(vt),!jt)return;const $t=jt.tlv.find(en=>en.tag===iv.METADATA);$t&&bt&&$t.value instanceof Uint8Array&&bt($t.value);const Ht=jt.tlv.find(en=>en.tag===iv.AUDIO_64_BIT_PTS);Ht&&Ot&&Ht.value instanceof Uint8Array&&Ht.value.length==8&&Ot(new DataView(Ht.value.buffer).getBigUint64(0,!0))}(mt,_t,rt.onMetadata,rt.onPts):_t.enqueue(mt)}});ut.readable.pipeThrough(pt).pipeTo(ut.writable)}else{if(typeof RTCRtpScriptTransform>"u")return void Ut.warning("browser not support RTCRtpScriptTransform");const ut=ww(),pt=new MessageChannel;await new Ir(_t=>ut.onmessage=vt=>{vt.data==="registered"&&_t(void 0)});const mt=new RTCRtpScriptTransform(ut,{name:"audio-metadata-rx",port:pt.port2},[pt.port2]);_e.transform=mt,await new Ir(_t=>ut.onmessage=vt=>{vt.data==="started"&&_t(void 0)}),pt.port1.onmessage=_t=>{var vt;_t.data.transformed&&_e.track&&((vt=_e.track)===null||vt===void 0?void 0:vt.id)!==it.track.id?(Ut.debug("audio track changed: ".concat(it.track.id," => ").concat(_e.track.id)),it.track.removeEventListener("ended",ct),it.track=_e.track,it.track.addEventListener("ended",ct)):_t.data.metadata&&it.onMetadata?it.onMetadata(_t.data.metadata):_t.data.pts&&it.onPts&&it.onPts(_t.data.pts)},it.worker=ut}function ct(){_e.track.removeEventListener("ended",ct),function(ut){const pt=Dw.get(ut);if(pt){(function(vt){const Tt=xS.get(vt);Tt&&(xS.delete(vt),i_&&(i_.removeSpeakers([Tt]),xS.size===0&&(i_.destroy(),i_=null)))})(ut),mV(ut.track.id),Dw.delete(ut);try{var mt,_t;(mt=pt.controller)===null||mt===void 0||mt.terminate(),(_t=pt.worker)===null||_t===void 0||_t.terminate()}catch(vt){Ut.warning(vt&&vt.message)}}}(_e)}Dw.set(_e,it),_e.track.addEventListener("ended",ct)},interceptLocalVideoFrame:async function(_e,rt){if(!Fo().supportWebRTCEncodedTransform)return void Ut.warning("browser not support video encoded transform");if(Lw.has(_e)||!_e.track)return;const it={track:_e.track};if(dE()){if(!_e.createEncodedStreams)return void Ut.warning("browser not support createEncodedStreams() API");let ut=null;try{ut=_e.createEncodedStreams()}catch(_t){return void Ut.error("create video-encoded-streams error",_t&&_t.message)}const pt=[];rt.on("sei-to-send",_t=>{pt.push(_t)});const mt=new TransformStream({transform(_t,vt){it.controller||(it.controller=vt),_e.track&&_e.track.id!==it.track.id&&(Ut.debug("video track changed: ".concat(it.track.id," => ").concat(_e.track.id)),it.track.removeEventListener("ended",ct),it.track=_e.track,it.track.addEventListener("ended",ct));const Tt=EV(new Uint8Array(_t.data)),bt=pt.shift();if(bt){const Ot=function(Mt,Dt,jt){switch(jt){case sM:return function($t,Ht){const en=_V(Ht),Qt=en.length,on=Math.floor(Qt/255),Tn=Qt%255,vn=new Uint8Array(6+on+1+Qt+$t.byteLength);vn[0]=0,vn[1]=0,vn[2]=0,vn[3]=1,vn[4]=6,vn[5]=101;let hn=0;for(;hn<on;)vn[6+hn]=255,hn++;return vn[6+hn]=Tn,hn++,vn.set(en,6+hn),vn.set(new Uint8Array($t),6+hn+Qt),vn.buffer}(Mt,Dt);case aM:return function($t,Ht){const en=_V(Ht),Qt=en.length,on=Math.floor(Qt/255),Tn=Qt%255,vn=new Uint8Array(7+on+1+Qt+1+$t.byteLength);vn[0]=0,vn[1]=0,vn[2]=0,vn[3]=1,vn[4]=78,vn[5]=1,vn[6]=101;let hn=0;for(;hn<on;)vn[7+hn]=255,hn++;return vn[7+hn]=Tn,hn++,vn.set(en,7+hn),hn+=Qt,vn[7+hn]=128,hn++,vn.set(new Uint8Array($t),7+hn),vn.buffer}(Mt,Dt);default:return null}}(_t.data,bt,Tt);Ot&&(_t.data=Ot)}vt.enqueue(_t)}});ut.readable.pipeThrough(mt).pipeTo(ut.writable)}else{if(!tu())return;{if(typeof RTCRtpScriptTransform>"u")return void Ut.warning("browser not support RTCRtpScriptTransform");const ut=ww(),pt=new MessageChannel;await new Ir(_t=>ut.onmessage=vt=>{vt.data==="registered"&&_t(void 0)});const mt=new RTCRtpScriptTransform(ut,{name:"sei-tx",port:pt.port2},[pt.port2]);_e.transform=mt,await new Ir(_t=>ut.onmessage=vt=>{vt.data==="started"&&_t(void 0)}),rt.on("sei-to-send",_t=>{pt.port1.postMessage({sei:_t})}),pt.port1.onmessage=_t=>{var vt;_t.data.transformed&&_e.track&&((vt=_e.track)===null||vt===void 0?void 0:vt.id)!==it.track.id&&(Ut.debug("video track changed: ".concat(it.track.id," => ").concat(_e.track.id)),it.track.removeEventListener("ended",ct),it.track=_e.track,it.track.addEventListener("ended",ct))},it.worker=ut}}function ct(){if(_e.track){if(this.id!==_e.track.id)return;_e.track.removeEventListener("ended",ct)}const ut=Lw.get(_e);if(ut){Lw.delete(_e);try{var pt,mt;(pt=ut.controller)===null||pt===void 0||pt.terminate(),(mt=ut.worker)===null||mt===void 0||mt.terminate()}catch(_t){Ut.warning(_t&&_t.message)}}}Lw.set(_e,it),_e.track.addEventListener("ended",ct)},interceptRemoteVideoFrame:async function(_e){let rt=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!Fo().supportWebRTCEncodedTransform)return void Ut.warning("browser not support video encoded transform");if(!_e.track)return;if(TA.has(_e)){const ut=TA.get(_e);return void(ut&&(ut.onSei=rt.onSei))}const it={track:_e.track,onSei:rt.onSei};if(dE()){if(!_e.createEncodedStreams)return void Ut.warning("browser not support createEncodedStreams() API");let ut=null;try{ut=_e.createEncodedStreams()}catch(mt){return void Ut.error("create video-encoded-streams error",mt&&mt.message)}const pt=new TransformStream({transform(mt,_t){it.controller||(it.controller=_t),_e.track&&_e.track.id!==it.track.id&&(Ut.debug("video track changed: ".concat(it.track.id," => ").concat(_e.track.id)),it.track.removeEventListener("ended",ct),it.track=_e.track,it.track.addEventListener("ended",ct));const vt=function(Tt,bt){switch(bt){case sM:return function(Ot){const Mt=new DataView(Ot.data);let Dt=0;for(;Dt+4<Ot.data.byteLength;){if(Mt.getUint8(Dt+0)===0&&Mt.getUint8(Dt+1)===0&&Mt.getUint8(Dt+2)===0&&Mt.getUint8(Dt+3)===1&&Mt.getUint8(Dt+4)===6){let jt=Dt+6,$t=0,Ht=0;for(;(Ht=Mt.getUint8(jt++))===255;)$t+=255;$t+=Ht;const en=gV(Ot.data,jt,$t);return new Uint8Array(en)}Dt++}return null}(Tt);case aM:return function(Ot){const Mt=new DataView(Ot.data);let Dt=0;for(;Dt+5<Ot.data.byteLength;){if(Mt.getUint8(Dt+0)===0&&Mt.getUint8(Dt+1)===0&&Mt.getUint8(Dt+2)===0&&Mt.getUint8(Dt+3)===1&&Mt.getUint8(Dt+4)===78&&Mt.getUint8(Dt+5)===1&&Mt.getUint8(Dt+6)===101){let jt=Dt+7,$t=0,Ht=0;for(;(Ht=Mt.getUint8(jt++))===255;)$t+=255;$t+=Ht;const en=gV(Ot.data,jt,$t);return new Uint8Array(en)}Dt++}return null}(Tt);default:return null}}(mt,EV(new Uint8Array(mt.data)));vt&&it.onSei&&it.onSei(vt),_t.enqueue(mt)}});ut.readable.pipeThrough(pt).pipeTo(ut.writable)}else if(tu()){if(typeof RTCRtpScriptTransform>"u")return void Ut.warning("browser not support RTCRtpScriptTransform");const ut=ww(),pt=new MessageChannel;await new Ir(_t=>ut.onmessage=vt=>{vt.data==="registered"&&_t(void 0)});const mt=new RTCRtpScriptTransform(ut,{name:"sei-rx",port:pt.port2},[pt.port2]);_e.transform=mt,await new Ir(_t=>ut.onmessage=vt=>{vt.data==="started"&&_t(void 0)}),pt.port1.onmessage=_t=>{var vt;_t.data.transformed&&_e.track&&((vt=_e.track)===null||vt===void 0?void 0:vt.id)!==it.track.id?(Ut.debug("video track changed: ".concat(it.track.id," => ").concat(_e.track.id)),it.track.removeEventListener("ended",ct),it.track=_e.track,it.track.addEventListener("ended",ct)):_t.data.sei&&it.onSei&&it.onSei(_t.data.sei)},it.worker=ut}function ct(){if(_e.track){if(this.id!==_e.track.id)return;_e.track.removeEventListener("ended",ct)}(function(ut){const pt=TA.get(ut);if(pt){TA.delete(ut);try{var mt,_t;(mt=pt.controller)===null||mt===void 0||mt.terminate(),(_t=pt.worker)===null||_t===void 0||_t.terminate()}catch(vt){Ut.warning(vt&&vt.message)}}})(_e)}TA.set(_e,it),_e.track.addEventListener("ended",ct)}},hZ={name:"InterceptFrame",create:()=>dZ};MO(),ns("PROCESS_ID","process-".concat(ms(8,""),"-").concat(ms(4,""),"-").concat(ms(4,""),"-").concat(ms(4,""),"-").concat(ms(12,""))),function(){let _e;try{_e=window.localStorage.getItem("websdk_ng_global_parameter")}catch(rt){return void Ut.error("Error loading sdk config",rt.message)}if(_e)try{const rt=JSON.parse(window.atob(_e)),it=Date.now();Ut.debug("Loading global parameters from cache",rt),Object.keys(rt).forEach(ct=>{if(Object.prototype.hasOwnProperty.call(xs,ct)){const{value:ut,expires:pt}=rt[ct];if(pt&&pt<=it)return;r_[ct]=ut,xs[ct]=ut}})}catch(rt){Ut.error("Error loading mutableParamsCache: ".concat(_e),rt.message)}}(),Array.isArray(r_.AREAS)&&r_.AREAS.length>0&&RM(r_.AREAS,!0);const _$=(_e,rt,it)=>{Ut.debug("setParameter key:".concat(_e,", value:").concat(JSON.stringify(rt))),ns(_e,rt,it)};hv(LJ,!1),hv(BJ,!1),hv(vq,!1),hv(XJ,!1),hv(PJ,!1),hv(aZ,!1),hv(uZ,!1),hv(hZ,!1);const $a=function(_e){const rt=new Fs,it=_e,ct={getListeners:rt.getListeners.bind(rt),on:(ut,pt)=>(function(mt,_t){mt===U_.SECURITY_POLICY_VIOLATION&&J5(_t,!0)}(ut,pt),rt.on.bind(rt)(ut,pt)),addListener:rt.addListener.bind(rt),once:rt.once.bind(rt),off:rt.off.bind(rt),removeAllListeners:rt.removeAllListeners.bind(rt),emit:rt.emit.bind(rt),safeEmit:rt.safeEmit.bind(rt)};return q5(q5({},it),ct)}({__TRACK_LIST__:yS,VERSION:Zp,BUILD:DO,ESM_BUNDLER:!1,ESM:!1,UMD:!0,DEV:!1,setParameter:_$,getParameter:rn,getSupportedCodec:async function(){let _e={audio:[],video:[]};try{let rt=new RTCPeerConnection;const it=await async function(ct){let ut;return Fo().supportUnifiedPlan?(ct.addTransceiver("video",{direction:"recvonly"}),ct.addTransceiver("audio",{direction:"recvonly"}),ut=(await ct.createOffer()).sdp):ut=(await ct.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0})).sdp,ut}(rt);if(!it)return _e;rt.close(),rt=null,_e=function(ct){const ut={video:[],audio:[]};return ct.match(/ VP8/i)&&ut.video.push("VP8"),ct.match(/ VP9/i)&&ut.video.push("VP9"),ct.match(/ AV1/i)&&ut.video.push("AV1"),ct.match(/ H264/i)&&ut.video.push("H264"),ct.match(/ H265/i)&&ut.video.push("H265"),ct.match(/ opus/i)&&ut.audio.push("OPUS"),ct.match(/ PCMU/i)&&ut.audio.push("PCMU"),ct.match(/ PCMA/i)&&ut.audio.push("PCMA"),ct.match(/ G722/i)&&ut.audio.push("G722"),ut}(it)}catch(rt){throw new $n(tn.CREATE_OFFER_FAILED,rt.toString&&rt.toString()).print()}return _e},checkSystemRequirements:function(){const _e=Vr.reportApiInvoke(null,{name:Ks.CHECK_SYSTEM_REQUIREMENTS,options:[],tag:Ns.TRACER});let rt=!1;try{const pt=window.RTCPeerConnection,mt=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia,_t=window.WebSocket;rt=!!(pt&&mt&&_t),rt&&gO()&&g3(75)&&new pt().close()}catch(pt){return Ut.error("check system requirement failed: ",pt),!1}let it=!1;const ct=No();ct.name===Ho.CHROME&&Number(ct.version)>=58&&(e_.engine.name!=="WebKit"||function(){const pt=No();if(uw()){if(pt.os===Nl.MAC_OS)return!0;if(pt.os===Nl.IOS){const mt=e_.os.version&&e_.os.version.split(".");if(mt&&Number(mt[0])===14&&mt[1]&&Number(mt[1])>=3||mt&&Number(mt[0])>14)return!0}}return!1}())&&(it=!0),(ct.name===Ho.FIREFOX&&Number(ct.version)>=56||ct.name===Ho.OPERA&&Number(ct.version)>=45||ct.name===Ho.SAFARI&&Number(ct.version)>=11||ct.name==="WebKit"&&(Tu()||Sm())&&ct.osVersion&&Number(ct.osVersion.split(".")[0])>=11||T3()||No().name===Ho.QQ)&&(it=!0),Ut.debug("checkSystemRequirements, api:",rt,"browser",it);const ut=rt&&it;return _e.onSuccess(ut),ut},getDevices:function(_e){return Vp.enumerateDevices(!0,!0,_e)},getMicrophones:function(_e){return Vp.getRecordingDevices(_e)},getCameras:function(_e){return Vp.getCamerasDevices(_e)},getElectronScreenSources:gB,getPlaybackDevices:function(_e){return Vp.getSpeakers(_e)},createClient:function(){var _e;let rt=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{codec:"vp8",audioCodec:"opus",mode:"rtc"};const it=ms(5,"client-"),ct=Vr.reportApiInvoke(null,{id:it,name:Ks.CREATE_CLIENT,options:[rt],tag:Ns.TRACER});try{(function(ut){Cl(ut.codec,"config.codec",["vp8","vp9","av1","h264","h265"]),Cl(ut.mode,"config.mode",["rtc","live","p2p"]),ut.audioCodec!==void 0&&Cl(ut.audioCodec,"config.audioCodec",["opus","pcmu","pcma","g722"]),ut.proxyServer!==void 0&&Hl(ut.proxyServer,"config.proxyServer",1,1e4),ut.turnServer!==void 0&&O3(ut.turnServer),ut.httpRetryConfig!==void 0&&x3(ut.httpRetryConfig),ut.websocketRetryConfig!==void 0&&x3(ut.websocketRetryConfig)})(rt)}catch(ut){throw ct.onError(ut),ut}return(v3(16,0,!0)||pO(16,0,!0))&&(rt.codec==="vp9"&&(rt.codec="vp8",Ut.debug("browser not support vp9, force use vp8")),ns("UNSUPPORTED_VIDEO_CODEC",["vp9"])),rt.audioCodec===void 0&&(rt.audioCodec="opus"),ct.onSuccess(),new yq(Om(Om({forceWaitGatewayResponse:!0},rt),{},{role:Er(_e=["rtc","p2p"]).call(_e,rt.mode)?"host":rt.role||"audience"}),it)},createCameraVideoTrack:async function(){let _e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const rt=rn("CAMERA_CAPTURE_CONFIG"),it=ms(8,"track-cam-"),ct=Vr.reportApiInvoke(null,{id:it,tag:Ns.TRACER,name:Ks.CREATE_CAM_VIDEO_TRACK,options:[Ss({},_e),rt]});rt&&(_e.encoderConfig=rt);const ut=bw(_e);let pt=null;Ut.info("start create camera video track with config",JSON.stringify(_e),"trackId",it);try{pt=(await Fp({video:ut},it)).getVideoTracks()[0]||null}catch(_t){throw ct.onError(_t),_t}if(!pt){const _t=new Yn(tn.UNEXPECTED_ERROR,"can not find track in media stream");return ct.onError(_t),_t.throw(Ut)}if(_e.optimizationMode&&ZO(it,pt,_e,Cm(_e.encoderConfig)),rn("USE_STANDARD_BITRATE_DEFAULT")){const _t=Cm(_e.encoderConfig);_e.encoderConfig=_t,delete _t.bitrateMax,delete _t.bitrateMin}const mt=new Rw(pt,_e,ut,_e.scalabiltyMode?Sw(_e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},_e.optimizationMode,it);return ct.onSuccess(mt.getTrackId()),Ut.info("create camera video success, trackId:",it),mt},createCustomVideoTrack:function(_e){const rt=ms(8,"track-cus-"),it=Vr.reportApiInvoke(null,{id:rt,tag:Ns.TRACER,name:Ks.CREATE_CUSTOM_VIDEO_TRACK,options:[_e]});rn("USE_STANDARD_BITRATE_DEFAULT")&&(delete _e.bitrateMax,delete _e.bitrateMin);const ct=new Cs(_e.mediaStreamTrack,{width:_e.width,height:_e.height,frameRate:_e.frameRate,bitrateMax:_e.bitrateMax,bitrateMin:_e.bitrateMin},_e.scalabiltyMode?Sw(_e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},_e.optimizationMode,rt,[ds.CUSTOM_TRACK]);return it.onSuccess(ct.getTrackId()),Ut.info("create custom video track success with config",_e,"trackId",ct.getTrackId()),ct},createScreenVideoTrack:async function(){let _e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},rt=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"disable";const it=typeof rt=="object"?function(Mt){return RB(Mt)}(rt):void 0;it&&(rt="auto");const ct=ms(8,"track-scr-v-"),ut=Vr.reportApiInvoke(null,{id:ct,tag:Ns.TRACER,name:Ks.CREATE_SCREEN_VIDEO_TRACK,options:[Ss({},_e),rt]});_e.encoderConfig?typeof _e.encoderConfig=="string"||_e.encoderConfig.width&&_e.encoderConfig.height||(_e.encoderConfig.width={max:1920},_e.encoderConfig.height={max:1080}):_e.encoderConfig="1080p_2";const pt=function(Mt){const Dt={};Mt.screenSourceType&&(Dt.mediaSource=Mt.screenSourceType),Mt.extensionId&&dE()&&(Dt.extensionId=Mt.extensionId);const{displaySurface:jt,selfBrowserSurface:$t,surfaceSwitching:Ht,systemAudio:en,preferCurrentTab:Qt}=Mt;(dS(107)||dO(107)||fO(93))&&(jt&&(Cl(jt,"displaySurface",["browser","window","monitor"]),Dt.displaySurface=jt),$t?(Cl($t,"selfBrowserSurface",["exclude","include"]),Dt.selfBrowserSurface=$t):Dt.selfBrowserSurface="include",Ht&&(Cl(Ht,"surfaceSwitching",["exclude","include"]),Dt.surfaceSwitching=Ht)),(dS(105)||dO(105)||fO(91))&&en&&(Cl(en,"systemAudio",["exclude","include"]),Dt.systemAudio=en),(dS(94)||dO(94)||fO(80))&&Qt&&(Dt.preferCurrentTab=!0),Mt.electronScreenSourceId&&(Dt.sourceId=Mt.electronScreenSourceId);const on=Mt.encoderConfig?VO(Mt.encoderConfig):null;return Dt.mandatory={chromeMediaSource:"desktop",maxWidth:on?on.width:void 0,maxHeight:on?on.height:void 0},on&&(on.frameRate&&(typeof on.frameRate=="number"?(Dt.mandatory.maxFrameRate=on.frameRate,Dt.mandatory.minFrameRate=on.frameRate):(Dt.mandatory.maxFrameRate=on.frameRate.max||on.frameRate.ideal||on.frameRate.exact||void 0,Dt.mandatory.minFrameRate=on.frameRate.min||on.frameRate.ideal||on.frameRate.exact||void 0),Dt.frameRate=on.frameRate),on.width&&(Dt.width=on.width),on.height&&(Dt.height=on.height)),Dt}(_e);let mt=null,_t=null;const vt=Fo();if(!vt.supportShareAudio&&rt==="enable"){const Mt=new Yn(tn.NOT_SUPPORTED,"your browser or platform is not support share-screen with audio");return ut.onError(Mt),Mt.throw(Ut)}Ut.info("start create screen video track with config",_e,"withAudio",rt,"trackId",ct);const Tt=vt.supportShareAudio&&rt!=="disable";try{const Mt=await Fp({screen:pt,screenAudio:Tt?it||!0:void 0},ct);mt=Mt.getVideoTracks()[0]||null,_t=Mt.getAudioTracks()[0]||null}catch(Mt){throw ut.onError(Mt),Mt}if(!mt){const Mt=new Yn(tn.UNEXPECTED_ERROR,"can not find track in media stream");return ut.onError(Mt),Mt.throw(Ut)}if(!_t&&rt==="enable"){mt&&mt.stop();const Mt=new Yn(tn.SHARE_AUDIO_NOT_ALLOWED);return ut.onError(Mt),Mt.throw(Ut)}_e.optimizationMode||(_e.optimizationMode="detail"),_e.optimizationMode&&(ZO(ct,mt,_e,_e.encoderConfig&&VO(_e.encoderConfig)||void 0),_e.encoderConfig&&typeof _e.encoderConfig!="string"&&(_e.encoderConfig.bitrateMin=_e.encoderConfig.bitrateMax));const bt=new Cs(mt,_e.encoderConfig?VO(_e.encoderConfig):{},_e.scalabiltyMode?Sw(_e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},_e.optimizationMode,ct,[ds.SCREEN_TRACK]);if(!_t)return ut.onSuccess(bt.getTrackId()),Ut.info("create screen video track success","video:",bt.getTrackId()),bt;const Ot=new Ws(_t,void 0,ms(8,"track-scr-a-"),!1);return ut.onSuccess([bt.getTrackId(),Ot.getTrackId()]),Ut.info("create screen video track success","video:",bt.getTrackId(),"audio:",Ot.getTrackId()),[bt,Ot]},createMicrophoneAndCameraTracks:async function(){let _e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},rt=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const it=rn("CAMERA_CAPTURE_CONFIG"),ct=ms(8,"track-mic-"),ut=ms(8,"track-cam-"),pt=Vr.reportApiInvoke(null,{id:"".concat(ct,"-").concat(ut),tag:Ns.TRACER,name:Ks.CREATE_MIC_AND_CAM_TRACKS,options:[_e,rt,it]});it&&(rt.encoderConfig=it);const mt=bw(rt),_t=wB(_e);let vt=null,Tt=null;Ut.info("start create camera video track(".concat(ut,") and microphone audio track(").concat(ct,") with config, audio: ").concat(JSON.stringify(_e),", video: ").concat(JSON.stringify(rt)));try{const Mt=await Fp({audio:_t,video:mt},"".concat(ct,"-").concat(ut));vt=Mt.getAudioTracks()[0],Tt=Mt.getVideoTracks()[0]}catch(Mt){throw pt.onError(Mt),Mt}if(!vt||!Tt){const Mt=new Yn(tn.UNEXPECTED_ERROR,"can not find tracks in media stream");return pt.onError(Mt),Mt.throw(Ut)}if(rt.optimizationMode&&ZO(ut,Tt,rt,Cm(rt.encoderConfig)),rn("USE_STANDARD_BITRATE_DEFAULT")){const Mt=Cm(rt.encoderConfig);rt.encoderConfig=Mt,delete Mt.bitrateMax,delete Mt.bitrateMin}const bt=new SA(vt,_e,_t,ct),Ot=new Rw(Tt,rt,mt,rt.scalabiltyMode?Sw(rt.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},rt.optimizationMode,ut);return pt.onSuccess([bt.getTrackId(),Ot.getTrackId()]),Ut.info("create camera video track(".concat(ut,") and microphone audio track(").concat(ct,") success")),[bt,Ot]},createMicrophoneAudioTrack:async function(){let _e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const rt=ms(8,"track-mic-"),it=Vr.reportApiInvoke(null,{id:rt,tag:Ns.TRACER,name:Ks.CREATE_MIC_AUDIO_TRACK,options:[_e]}),ct=wB(_e);let ut=null;Ut.info("start create microphone audio track with config",JSON.stringify(_e),"trackId",rt);try{ut=(await Fp({audio:ct},rt)).getAudioTracks()[0]||null}catch(mt){throw it.onError(mt),mt}if(!ut){const mt=new Yn(tn.UNEXPECTED_ERROR,"can not find track in media stream");return it.onError(mt),mt.throw(Ut)}const pt=new SA(ut,_e,ct,rt);return it.onSuccess(pt.getTrackId()),Ut.info("create microphone audio track success, trackId:",rt),pt},createCustomAudioTrack:function(_e){const rt=ms(8,"track-cus-"),it=Vr.reportApiInvoke(null,{id:rt,tag:Ns.TRACER,name:Ks.CREATE_CUSTOM_AUDIO_TRACK,options:[_e]}),ct=new Ws(_e.mediaStreamTrack,_e.encoderConfig?Tw(_e.encoderConfig):{},rt,!1);return Ut.info("create custom audio track success with config",_e,"trackId",ct.getTrackId()),it.onSuccess(ct.getTrackId()),ct},createBufferSourceAudioTrack:async function(_e){var rt;const{cacheOnlineFile:it,encoderConfig:ct}=_e;let{source:ut}=_e;const pt={source:ut instanceof AudioBuffer?"AudioBuffer":ut instanceof File?(rt=File.name)!==null&&rt!==void 0?rt:"File":ut,cacheOnlineFile:it,encoderConfig:ct},mt=ms(8,"track-buf-"),_t=Vr.reportApiInvoke(null,{id:mt,tag:Ns.TRACER,name:Ks.CREATE_BUFFER_AUDIO_TRACK,options:[pt]});if(rn("DISABLE_WEBAUDIO"))throw new Yn(tn.NOT_SUPPORTED,"can not create BufferSourceAudioTrack when WebAudio disabled");Ut.info("start create buffer source audio track with config",JSON.stringify(pt),"trackId",mt);const vt=ut;if(!(ut instanceof AudioBuffer))try{ut=await async function(Ot,Mt){let Dt=null;if(typeof Ot=="string"){const $t=pF.get(Ot);if($t)return Ut.debug("use cached audio resource: ",Ot),$t;try{Dt=(await n_(()=>Xu.get(Ot,{responseType:"arraybuffer"}),void 0,void 0,{maxRetryCount:3})).data}catch(Ht){throw new Yn(tn.FETCH_AUDIO_FILE_FAILED,Ht.toString())}}else Dt=await new Ir((Ht,en)=>{const Qt=new FileReader;Qt.onload=on=>{on.target?Ht(on.target.result):en(new Yn(tn.READ_LOCAL_AUDIO_FILE_ERROR))},Qt.onerror=()=>{en(new Yn(tn.READ_LOCAL_AUDIO_FILE_ERROR))},Qt.readAsArrayBuffer(Ot)});const jt=await function($t){const Ht=bS();return new Ir((en,Qt)=>{Ht.decodeAudioData($t,on=>{en(on)},on=>{Qt(new Yn(tn.DECODE_AUDIO_FILE_FAILED,on.toString()))})})}(Dt);return typeof Ot=="string"&&Mt&&pF.set(Ot,jt),jt}(ut,it)}catch(Ot){return _t.onError(Ot),Ot.throw(Ut)}const Tt=new VY(ut),bt=new FY(vt,Tt,ct?Tw(ct):{},mt);return Ut.info("create buffer source audio track success, trackId:",mt),_t.onSuccess(bt.getTrackId()),bt},setAppType:function(_e){if(Ut.debug("setAppType: ".concat(_e)),!(Number.isInteger(_e)&&_e>=0))throw Ut.debug("Invalid appType"),new $n(tn.INVALID_PARAMS,"invalid app type",_e);ns("APP_TYPE",Math.floor(_e))},setLogLevel:function(_e){Ut.setLogLevel(_e)},enableLogUpload:function(){rn("USE_NEW_LOG")?ns("UPLOAD_LOG",!0):Ut.enableLogUpload()},disableLogUpload:function(){rn("USE_NEW_LOG")?ns("UPLOAD_LOG",!1):Ut.disableLogUpload()},createChannelMediaRelayConfiguration:function(){return new g4},checkAudioTrackIsActive:async function(_e){let rt=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const it=Vr.reportApiInvoke(null,{tag:Ns.TRACER,name:Ks.CHECK_AUDIO_TRACK_IS_ACTIVE,options:[rt]});if(!(_e instanceof Ws||_e instanceof IS)){const vt=new $n(tn.INVALID_TRACK,"the parameter is not a audio track");return it.onError(vt),vt.throw()}rt&&rt<1e3&&(rt=1e3);const ct=_e instanceof Ws?_e.getTrackLabel():"remote_track",ut=_e.getVolumeLevel();let pt=ut,mt=ut;const _t=Date.now();return new Ir(vt=>{const Tt=setInterval(()=>{const bt=_e.getVolumeLevel();pt=bt>pt?bt:pt,mt=bt<mt?bt:mt;const Ot=pt-mt>1e-4,Mt=Date.now()-_t;if(Ot||Mt>rt){clearInterval(Tt);const Dt=Ot,jt={duration:Mt,deviceLabel:ct,maxVolumeLevel:pt,result:Dt};Ut.info("[track-".concat(_e.getTrackId(),"] check audio track active completed. ").concat(JSON.stringify(jt))),it.onSuccess(jt),vt(Dt)}},200)})},checkVideoTrackIsActive:async function(_e){let rt=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const it=Vr.reportApiInvoke(null,{tag:Ns.TRACER,name:Ks.CHECK_VIDEO_TRACK_IS_ACTIVE,options:[rt]});if(!(_e instanceof Cs||_e instanceof wS)){const Ot=new $n(tn.INVALID_TRACK,"the parameter is not a video track");return it.onError(Ot),Ot.throw()}rt&&rt<1e3&&(rt=1e3);const ct=_e instanceof Cs?_e.getTrackLabel():"remote_track",ut=_e.getMediaStreamTrack(!0),pt=document.createElement("video");pt.style.width="1px",pt.style.height="1px",pt.setAttribute("muted",""),pt.muted=!0,pt.setAttribute("playsinline",""),pt.controls=!1,(tu()||uw())&&(pt.style.opacity="0.01",pt.style.position="fixed",pt.style.left="0",pt.style.top="0",document.body.appendChild(pt)),pt.srcObject=new MediaStream([ut]),pt.play();const mt=document.createElement("canvas");mt.width=160,mt.height=120;let _t=0,vt=0;try{const Ot=Date.now();_t=await function(Mt,Dt,jt,$t){let Ht,en=0,Qt=null;return new Ir((on,Tn)=>{function vn(){en>$t&&Ht&&(Ht(),on(en));const hn=jt.getContext("2d");if(!hn){const Qn=new $n(tn.UNEXPECTED_ERROR,"can not get canvas 2d context.");return Ut.error(Qn.toString()),void Tn(Qn)}hn.drawImage(Mt,0,0,160,120);const Ln=hn.getImageData(0,0,jt.width,jt.height),Xn=Math.floor(Ln.data.length/3);if(Qt){for(let Qn=0;Qn<Xn;Qn+=3)if(Ln.data[Qn]!==Qt[Qn])return en+=1,void(Qt=Ln.data);Qt=Ln.data}else Qt=Ln.data}setTimeout(()=>{Ht&&(Ht(),on(en))},Dt),Ht=zO(()=>{vn()},30)})}(pt,rt,mt,4),vt=Date.now()-Ot}catch(Ot){throw it.onError(Ot),Ot}oq===Ho.SAFARI&&(pt.pause(),pt.remove()),pt.srcObject=null;const Tt=_t>4,bt={duration:vt,changedPicNum:_t,deviceLabel:ct,result:Tt};return Ut.info("[track-".concat(_e.getTrackId(),"] check video track active completed. ").concat(JSON.stringify(bt))),it.onSuccess(bt),Tt},setArea:RM,audioElementPlayCenter:qu,resumeAudioContext:function(){qu.autoResumeAfterInterruption(!0)},processExternalMediaAEC:function(_e){Tq.processExternalMediaAEC(_e)},registerExtensions:function(_e){const rt=rn("PLUGIN_INFO")||[];_e.forEach(it=>{"name"in it&&!Er(rt).call(rt,it.name)&&rt.push(it.name);const ct=it;ct.__registered__=!0,ct.logger.hookLog=Ut.extLog,ct.reporter.hookApiInvoke=Vr.extApiInvoke,ct.parameters&&Object.keys(ct.parameters).forEach(ut=>{ct.parameters[ut]=rn(ut)})}),_$("PLUGIN_INFO",rt)},ChannelMediaRelayError:MS,ChannelMediaRelayEvent:fE,ChannelMediaRelayState:ap,RemoteStreamFallbackType:PY,RemoteStreamType:MY,ConnectionDisconnectedReason:Xo,AudienceLatencyLevelType:cY,AREAS:Wo,preload:async function(_e,rt,it,ct){return V4(_e,rt,it,ct)}});return Object.defineProperties($a,{onAudioAutoplayFailed:{get:()=>Gp.onAudioAutoplayFailed,set:_e=>{Gp.onAudioAutoplayFailed=_e}},onAutoplayFailed:{get:()=>Gp.onAutoplayFailed,set:_e=>{Gp.onAutoplayFailed=_e}},_onSecurityPolicyViolation:{value:void 0,writable:!0},_cspEventHandlerPointer:{value:void 0,writable:!0},onSecurityPolicyViolation:{get:()=>$a._onSecurityPolicyViolation,set(_e){$a._onSecurityPolicyViolation=_e,J5(_e)}},__CLIENT_LIST__:{get:()=>rn("SHOW_GLOBAL_CLIENT_LIST")?C0:[]}}),Vp.on(y0.CAMERA_DEVICE_CHANGED,_e=>{Ut.info("camera device changed",JSON.stringify(_e)),$a.onCameraChanged&&$a.onCameraChanged(_e),$a.safeEmit(U_.CAMERA_CHANGED,_e)}),Vp.on(y0.RECORDING_DEVICE_CHANGED,_e=>{Ut.info("microphone device changed",JSON.stringify(_e)),$a.onMicrophoneChanged&&$a.onMicrophoneChanged(_e),$a.safeEmit(U_.MICROPHONE_CHANGED,_e)}),Vp.on(y0.PLAYOUT_DEVICE_CHANGED,_e=>{Ut.debug("playout device changed",JSON.stringify(_e)),$a.onPlaybackDeviceChanged&&$a.onPlaybackDeviceChanged(_e),$a.safeEmit(U_.PLAYBACK_DEVICE_CHANGED,_e)}),qu.onAutoplayFailed=()=>{Ut.info("detect audio element autoplay failed"),Gp.onAudioAutoplayFailed&&Gp.onAudioAutoplayFailed()},rs.on("autoplay-failed",()=>{Ut.info("detect webaudio autoplay failed"),Gp.onAudioAutoplayFailed&&Gp.onAudioAutoplayFailed(),$a.safeEmit(U_.AUTOPLAY_FAILED)}),rs.on(Kl.STATE_CHANGE,(_e,rt)=>{Ut.info("audio context state changed: ".concat(rt," => ").concat(_e)),$a.onAudioContextStateChanged&&$a.onAudioContextStateChanged(_e,rt),$a.safeEmit(U_.AUDIO_CONTEXT_STATE_CHANGED,_e,rt)}),Qs.on(pS.NETWORK_STATE_CHANGE,(_e,rt)=>{Ut.info("[network-indicator] network state changed, ".concat(rt," => ").concat(_e))}),window&&(window.__ARTC__=$a),$a})})(AgoraRTC_NProduction);var AgoraRTC_NProductionExports=AgoraRTC_NProduction.exports;const AgoraRTC=getDefaultExportFromCjs(AgoraRTC_NProductionExports);var src={exports:{}},indexLight={exports:{}},indexMinimal={},minimal={},aspromise=asPromise$1;function asPromise$1(nt,_){for(var tt=new Array(arguments.length-1),ot=0,st=2,at=!0;st<arguments.length;)tt[ot++]=arguments[st++];return new Promise(function(dt,ht){tt[ot]=function(gt){if(at)if(at=!1,gt)ht(gt);else{for(var Et=new Array(arguments.length-1),yt=0;yt<Et.length;)Et[yt++]=arguments[yt];dt.apply(null,Et)}};try{nt.apply(_||null,tt)}catch(ft){at&&(at=!1,ht(ft))}})}var base64$1={};(function(nt){var _=nt;_.length=function(dt){var ht=dt.length;if(!ht)return 0;for(var ft=0;--ht%4>1&&dt.charAt(ht)==="=";)++ft;return Math.ceil(dt.length*3)/4-ft};for(var tt=new Array(64),ot=new Array(123),st=0;st<64;)ot[tt[st]=st<26?st+65:st<52?st+71:st<62?st-4:st-59|43]=st++;_.encode=function(dt,ht,ft){for(var gt=null,Et=[],yt=0,Ct=0,wt;ht<ft;){var It=dt[ht++];switch(Ct){case 0:Et[yt++]=tt[It>>2],wt=(It&3)<<4,Ct=1;break;case 1:Et[yt++]=tt[wt|It>>4],wt=(It&15)<<2,Ct=2;break;case 2:Et[yt++]=tt[wt|It>>6],Et[yt++]=tt[It&63],Ct=0;break}yt>8191&&((gt||(gt=[])).push(String.fromCharCode.apply(String,Et)),yt=0)}return Ct&&(Et[yt++]=tt[wt],Et[yt++]=61,Ct===1&&(Et[yt++]=61)),gt?(yt&&gt.push(String.fromCharCode.apply(String,Et.slice(0,yt))),gt.join("")):String.fromCharCode.apply(String,Et.slice(0,yt))};var at="invalid encoding";_.decode=function(dt,ht,ft){for(var gt=ft,Et=0,yt,Ct=0;Ct<dt.length;){var wt=dt.charCodeAt(Ct++);if(wt===61&&Et>1)break;if((wt=ot[wt])===void 0)throw Error(at);switch(Et){case 0:yt=wt,Et=1;break;case 1:ht[ft++]=yt<<2|(wt&48)>>4,yt=wt,Et=2;break;case 2:ht[ft++]=(yt&15)<<4|(wt&60)>>2,yt=wt,Et=3;break;case 3:ht[ft++]=(yt&3)<<6|wt,Et=0;break}}if(Et===1)throw Error(at);return ft-gt},_.test=function(dt){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(dt)}})(base64$1);var eventemitter=EventEmitter;function EventEmitter(){this._listeners={}}EventEmitter.prototype.on=function(_,tt,ot){return(this._listeners[_]||(this._listeners[_]=[])).push({fn:tt,ctx:ot||this}),this};EventEmitter.prototype.off=function(_,tt){if(_===void 0)this._listeners={};else if(tt===void 0)this._listeners[_]=[];else for(var ot=this._listeners[_],st=0;st<ot.length;)ot[st].fn===tt?ot.splice(st,1):++st;return this};EventEmitter.prototype.emit=function(_){var tt=this._listeners[_];if(tt){for(var ot=[],st=1;st<arguments.length;)ot.push(arguments[st++]);for(st=0;st<tt.length;)tt[st].fn.apply(tt[st++].ctx,ot)}return this};var float=factory(factory);function factory(nt){return typeof Float32Array<"u"?function(){var _=new Float32Array([-0]),tt=new Uint8Array(_.buffer),ot=tt[3]===128;function st(ht,ft,gt){_[0]=ht,ft[gt]=tt[0],ft[gt+1]=tt[1],ft[gt+2]=tt[2],ft[gt+3]=tt[3]}function at(ht,ft,gt){_[0]=ht,ft[gt]=tt[3],ft[gt+1]=tt[2],ft[gt+2]=tt[1],ft[gt+3]=tt[0]}nt.writeFloatLE=ot?st:at,nt.writeFloatBE=ot?at:st;function lt(ht,ft){return tt[0]=ht[ft],tt[1]=ht[ft+1],tt[2]=ht[ft+2],tt[3]=ht[ft+3],_[0]}function dt(ht,ft){return tt[3]=ht[ft],tt[2]=ht[ft+1],tt[1]=ht[ft+2],tt[0]=ht[ft+3],_[0]}nt.readFloatLE=ot?lt:dt,nt.readFloatBE=ot?dt:lt}():function(){function _(ot,st,at,lt){var dt=st<0?1:0;if(dt&&(st=-st),st===0)ot(1/st>0?0:2147483648,at,lt);else if(isNaN(st))ot(2143289344,at,lt);else if(st>34028234663852886e22)ot((dt<<31|2139095040)>>>0,at,lt);else if(st<11754943508222875e-54)ot((dt<<31|Math.round(st/1401298464324817e-60))>>>0,at,lt);else{var ht=Math.floor(Math.log(st)/Math.LN2),ft=Math.round(st*Math.pow(2,-ht)*8388608)&8388607;ot((dt<<31|ht+127<<23|ft)>>>0,at,lt)}}nt.writeFloatLE=_.bind(null,writeUintLE),nt.writeFloatBE=_.bind(null,writeUintBE);function tt(ot,st,at){var lt=ot(st,at),dt=(lt>>31)*2+1,ht=lt>>>23&255,ft=lt&8388607;return ht===255?ft?NaN:dt*(1/0):ht===0?dt*1401298464324817e-60*ft:dt*Math.pow(2,ht-150)*(ft+8388608)}nt.readFloatLE=tt.bind(null,readUintLE),nt.readFloatBE=tt.bind(null,readUintBE)}(),typeof Float64Array<"u"?function(){var _=new Float64Array([-0]),tt=new Uint8Array(_.buffer),ot=tt[7]===128;function st(ht,ft,gt){_[0]=ht,ft[gt]=tt[0],ft[gt+1]=tt[1],ft[gt+2]=tt[2],ft[gt+3]=tt[3],ft[gt+4]=tt[4],ft[gt+5]=tt[5],ft[gt+6]=tt[6],ft[gt+7]=tt[7]}function at(ht,ft,gt){_[0]=ht,ft[gt]=tt[7],ft[gt+1]=tt[6],ft[gt+2]=tt[5],ft[gt+3]=tt[4],ft[gt+4]=tt[3],ft[gt+5]=tt[2],ft[gt+6]=tt[1],ft[gt+7]=tt[0]}nt.writeDoubleLE=ot?st:at,nt.writeDoubleBE=ot?at:st;function lt(ht,ft){return tt[0]=ht[ft],tt[1]=ht[ft+1],tt[2]=ht[ft+2],tt[3]=ht[ft+3],tt[4]=ht[ft+4],tt[5]=ht[ft+5],tt[6]=ht[ft+6],tt[7]=ht[ft+7],_[0]}function dt(ht,ft){return tt[7]=ht[ft],tt[6]=ht[ft+1],tt[5]=ht[ft+2],tt[4]=ht[ft+3],tt[3]=ht[ft+4],tt[2]=ht[ft+5],tt[1]=ht[ft+6],tt[0]=ht[ft+7],_[0]}nt.readDoubleLE=ot?lt:dt,nt.readDoubleBE=ot?dt:lt}():function(){function _(ot,st,at,lt,dt,ht){var ft=lt<0?1:0;if(ft&&(lt=-lt),lt===0)ot(0,dt,ht+st),ot(1/lt>0?0:2147483648,dt,ht+at);else if(isNaN(lt))ot(0,dt,ht+st),ot(2146959360,dt,ht+at);else if(lt>17976931348623157e292)ot(0,dt,ht+st),ot((ft<<31|2146435072)>>>0,dt,ht+at);else{var gt;if(lt<22250738585072014e-324)gt=lt/5e-324,ot(gt>>>0,dt,ht+st),ot((ft<<31|gt/4294967296)>>>0,dt,ht+at);else{var Et=Math.floor(Math.log(lt)/Math.LN2);Et===1024&&(Et=1023),gt=lt*Math.pow(2,-Et),ot(gt*4503599627370496>>>0,dt,ht+st),ot((ft<<31|Et+1023<<20|gt*1048576&1048575)>>>0,dt,ht+at)}}}nt.writeDoubleLE=_.bind(null,writeUintLE,0,4),nt.writeDoubleBE=_.bind(null,writeUintBE,4,0);function tt(ot,st,at,lt,dt){var ht=ot(lt,dt+st),ft=ot(lt,dt+at),gt=(ft>>31)*2+1,Et=ft>>>20&2047,yt=4294967296*(ft&1048575)+ht;return Et===2047?yt?NaN:gt*(1/0):Et===0?gt*5e-324*yt:gt*Math.pow(2,Et-1075)*(yt+4503599627370496)}nt.readDoubleLE=tt.bind(null,readUintLE,0,4),nt.readDoubleBE=tt.bind(null,readUintBE,4,0)}(),nt}function writeUintLE(nt,_,tt){_[tt]=nt&255,_[tt+1]=nt>>>8&255,_[tt+2]=nt>>>16&255,_[tt+3]=nt>>>24}function writeUintBE(nt,_,tt){_[tt]=nt>>>24,_[tt+1]=nt>>>16&255,_[tt+2]=nt>>>8&255,_[tt+3]=nt&255}function readUintLE(nt,_){return(nt[_]|nt[_+1]<<8|nt[_+2]<<16|nt[_+3]<<24)>>>0}function readUintBE(nt,_){return(nt[_]<<24|nt[_+1]<<16|nt[_+2]<<8|nt[_+3])>>>0}var inquire_1=inquire$1;function inquire$1(moduleName){try{var mod=eval("quire".replace(/^/,"re"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(nt){}return null}var utf8$2={};(function(nt){var _=nt;_.length=function(ot){for(var st=0,at=0,lt=0;lt<ot.length;++lt)at=ot.charCodeAt(lt),at<128?st+=1:at<2048?st+=2:(at&64512)===55296&&(ot.charCodeAt(lt+1)&64512)===56320?(++lt,st+=4):st+=3;return st},_.read=function(ot,st,at){var lt=at-st;if(lt<1)return"";for(var dt=null,ht=[],ft=0,gt;st<at;)gt=ot[st++],gt<128?ht[ft++]=gt:gt>191&&gt<224?ht[ft++]=(gt&31)<<6|ot[st++]&63:gt>239&&gt<365?(gt=((gt&7)<<18|(ot[st++]&63)<<12|(ot[st++]&63)<<6|ot[st++]&63)-65536,ht[ft++]=55296+(gt>>10),ht[ft++]=56320+(gt&1023)):ht[ft++]=(gt&15)<<12|(ot[st++]&63)<<6|ot[st++]&63,ft>8191&&((dt||(dt=[])).push(String.fromCharCode.apply(String,ht)),ft=0);return dt?(ft&&dt.push(String.fromCharCode.apply(String,ht.slice(0,ft))),dt.join("")):String.fromCharCode.apply(String,ht.slice(0,ft))},_.write=function(ot,st,at){for(var lt=at,dt,ht,ft=0;ft<ot.length;++ft)dt=ot.charCodeAt(ft),dt<128?st[at++]=dt:dt<2048?(st[at++]=dt>>6|192,st[at++]=dt&63|128):(dt&64512)===55296&&((ht=ot.charCodeAt(ft+1))&64512)===56320?(dt=65536+((dt&1023)<<10)+(ht&1023),++ft,st[at++]=dt>>18|240,st[at++]=dt>>12&63|128,st[at++]=dt>>6&63|128,st[at++]=dt&63|128):(st[at++]=dt>>12|224,st[at++]=dt>>6&63|128,st[at++]=dt&63|128);return at-lt}})(utf8$2);var pool_1=pool;function pool(nt,_,tt){var ot=tt||8192,st=ot>>>1,at=null,lt=ot;return function(ht){if(ht<1||ht>st)return nt(ht);lt+ht>ot&&(at=nt(ot),lt=0);var ft=_.call(at,lt,lt+=ht);return lt&7&&(lt=(lt|7)+1),ft}}var longbits,hasRequiredLongbits;function requireLongbits(){if(hasRequiredLongbits)return longbits;hasRequiredLongbits=1,longbits=_;var nt=requireMinimal();function _(at,lt){this.lo=at>>>0,this.hi=lt>>>0}var tt=_.zero=new _(0,0);tt.toNumber=function(){return 0},tt.zzEncode=tt.zzDecode=function(){return this},tt.length=function(){return 1};var ot=_.zeroHash="\0\0\0\0\0\0\0\0";_.fromNumber=function(lt){if(lt===0)return tt;var dt=lt<0;dt&&(lt=-lt);var ht=lt>>>0,ft=(lt-ht)/4294967296>>>0;return dt&&(ft=~ft>>>0,ht=~ht>>>0,++ht>4294967295&&(ht=0,++ft>4294967295&&(ft=0))),new _(ht,ft)},_.from=function(lt){if(typeof lt=="number")return _.fromNumber(lt);if(nt.isString(lt))if(nt.Long)lt=nt.Long.fromString(lt);else return _.fromNumber(parseInt(lt,10));return lt.low||lt.high?new _(lt.low>>>0,lt.high>>>0):tt},_.prototype.toNumber=function(lt){if(!lt&&this.hi>>>31){var dt=~this.lo+1>>>0,ht=~this.hi>>>0;return dt||(ht=ht+1>>>0),-(dt+ht*4294967296)}return this.lo+this.hi*4294967296},_.prototype.toLong=function(lt){return nt.Long?new nt.Long(this.lo|0,this.hi|0,!!lt):{low:this.lo|0,high:this.hi|0,unsigned:!!lt}};var st=String.prototype.charCodeAt;return _.fromHash=function(lt){return lt===ot?tt:new _((st.call(lt,0)|st.call(lt,1)<<8|st.call(lt,2)<<16|st.call(lt,3)<<24)>>>0,(st.call(lt,4)|st.call(lt,5)<<8|st.call(lt,6)<<16|st.call(lt,7)<<24)>>>0)},_.prototype.toHash=function(){return String.fromCharCode(this.lo&255,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,this.hi&255,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},_.prototype.zzEncode=function(){var lt=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^lt)>>>0,this.lo=(this.lo<<1^lt)>>>0,this},_.prototype.zzDecode=function(){var lt=-(this.lo&1);return this.lo=((this.lo>>>1|this.hi<<31)^lt)>>>0,this.hi=(this.hi>>>1^lt)>>>0,this},_.prototype.length=function(){var lt=this.lo,dt=(this.lo>>>28|this.hi<<4)>>>0,ht=this.hi>>>24;return ht===0?dt===0?lt<16384?lt<128?1:2:lt<2097152?3:4:dt<16384?dt<128?5:6:dt<2097152?7:8:ht<128?9:10},longbits}var hasRequiredMinimal;function requireMinimal(){return hasRequiredMinimal||(hasRequiredMinimal=1,function(nt){var _=nt;_.asPromise=aspromise,_.base64=base64$1,_.EventEmitter=eventemitter,_.float=float,_.inquire=inquire_1,_.utf8=utf8$2,_.pool=pool_1,_.LongBits=requireLongbits(),_.isNode=!!(typeof commonjsGlobal<"u"&&commonjsGlobal&&commonjsGlobal.process&&commonjsGlobal.process.versions&&commonjsGlobal.process.versions.node),_.global=_.isNode&&commonjsGlobal||typeof window<"u"&&window||typeof self<"u"&&self||commonjsGlobal,_.emptyArray=Object.freeze?Object.freeze([]):[],_.emptyObject=Object.freeze?Object.freeze({}):{},_.isInteger=Number.isInteger||function(at){return typeof at=="number"&&isFinite(at)&&Math.floor(at)===at},_.isString=function(at){return typeof at=="string"||at instanceof String},_.isObject=function(at){return at&&typeof at=="object"},_.isset=_.isSet=function(at,lt){var dt=at[lt];return dt!=null&&at.hasOwnProperty(lt)?typeof dt!="object"||(Array.isArray(dt)?dt.length:Object.keys(dt).length)>0:!1},_.Buffer=function(){try{var st=_.inquire("buffer").Buffer;return st.prototype.utf8Write?st:null}catch{return null}}(),_._Buffer_from=null,_._Buffer_allocUnsafe=null,_.newBuffer=function(at){return typeof at=="number"?_.Buffer?_._Buffer_allocUnsafe(at):new _.Array(at):_.Buffer?_._Buffer_from(at):typeof Uint8Array>"u"?at:new Uint8Array(at)},_.Array=typeof Uint8Array<"u"?Uint8Array:Array,_.Long=_.global.dcodeIO&&_.global.dcodeIO.Long||_.global.Long||_.inquire("long"),_.key2Re=/^true|false|0|1$/,_.key32Re=/^-?(?:0|[1-9][0-9]*)$/,_.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,_.longToHash=function(at){return at?_.LongBits.from(at).toHash():_.LongBits.zeroHash},_.longFromHash=function(at,lt){var dt=_.LongBits.fromHash(at);return _.Long?_.Long.fromBits(dt.lo,dt.hi,lt):dt.toNumber(!!lt)};function tt(st,at,lt){for(var dt=Object.keys(at),ht=0;ht<dt.length;++ht)(st[dt[ht]]===void 0||!lt)&&(st[dt[ht]]=at[dt[ht]]);return st}_.merge=tt,_.lcFirst=function(at){return at.charAt(0).toLowerCase()+at.substring(1)};function ot(st){function at(lt,dt){if(!(this instanceof at))return new at(lt,dt);Object.defineProperty(this,"message",{get:function(){return lt}}),Error.captureStackTrace?Error.captureStackTrace(this,at):Object.defineProperty(this,"stack",{value:new Error().stack||""}),dt&&tt(this,dt)}return at.prototype=Object.create(Error.prototype,{constructor:{value:at,writable:!0,enumerable:!1,configurable:!0},name:{get:function(){return st},set:void 0,enumerable:!1,configurable:!0},toString:{value:function(){return this.name+": "+this.message},writable:!0,enumerable:!1,configurable:!0}}),at}_.newError=ot,_.ProtocolError=ot("ProtocolError"),_.oneOfGetter=function(at){for(var lt={},dt=0;dt<at.length;++dt)lt[at[dt]]=1;return function(){for(var ht=Object.keys(this),ft=ht.length-1;ft>-1;--ft)if(lt[ht[ft]]===1&&this[ht[ft]]!==void 0&&this[ht[ft]]!==null)return ht[ft]}},_.oneOfSetter=function(at){return function(lt){for(var dt=0;dt<at.length;++dt)at[dt]!==lt&&delete this[at[dt]]}},_.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},_._configure=function(){var st=_.Buffer;if(!st){_._Buffer_from=_._Buffer_allocUnsafe=null;return}_._Buffer_from=st.from!==Uint8Array.from&&st.from||function(lt,dt){return new st(lt,dt)},_._Buffer_allocUnsafe=st.allocUnsafe||function(lt){return new st(lt)}}}(minimal)),minimal}var writer=Writer$1,util$7=requireMinimal(),BufferWriter$1,LongBits$1=util$7.LongBits,base64=util$7.base64,utf8$1=util$7.utf8;function Op(nt,_,tt){this.fn=nt,this.len=_,this.next=void 0,this.val=tt}function noop(){}function State(nt){this.head=nt.head,this.tail=nt.tail,this.len=nt.len,this.next=nt.states}function Writer$1(){this.len=0,this.head=new Op(noop,0,0),this.tail=this.head,this.states=null}var create$1=function nt(){return util$7.Buffer?function(){return(Writer$1.create=function(){return new BufferWriter$1})()}:function(){return new Writer$1}};Writer$1.create=create$1();Writer$1.alloc=function nt(_){return new util$7.Array(_)};util$7.Array!==Array&&(Writer$1.alloc=util$7.pool(Writer$1.alloc,util$7.Array.prototype.subarray));Writer$1.prototype._push=function nt(_,tt,ot){return this.tail=this.tail.next=new Op(_,tt,ot),this.len+=tt,this};function writeByte(nt,_,tt){_[tt]=nt&255}function writeVarint32(nt,_,tt){for(;nt>127;)_[tt++]=nt&127|128,nt>>>=7;_[tt]=nt}function VarintOp(nt,_){this.len=nt,this.next=void 0,this.val=_}VarintOp.prototype=Object.create(Op.prototype);VarintOp.prototype.fn=writeVarint32;Writer$1.prototype.uint32=function nt(_){return this.len+=(this.tail=this.tail.next=new VarintOp((_=_>>>0)<128?1:_<16384?2:_<2097152?3:_<268435456?4:5,_)).len,this};Writer$1.prototype.int32=function nt(_){return _<0?this._push(writeVarint64,10,LongBits$1.fromNumber(_)):this.uint32(_)};Writer$1.prototype.sint32=function nt(_){return this.uint32((_<<1^_>>31)>>>0)};function writeVarint64(nt,_,tt){for(;nt.hi;)_[tt++]=nt.lo&127|128,nt.lo=(nt.lo>>>7|nt.hi<<25)>>>0,nt.hi>>>=7;for(;nt.lo>127;)_[tt++]=nt.lo&127|128,nt.lo=nt.lo>>>7;_[tt++]=nt.lo}Writer$1.prototype.uint64=function nt(_){var tt=LongBits$1.from(_);return this._push(writeVarint64,tt.length(),tt)};Writer$1.prototype.int64=Writer$1.prototype.uint64;Writer$1.prototype.sint64=function nt(_){var tt=LongBits$1.from(_).zzEncode();return this._push(writeVarint64,tt.length(),tt)};Writer$1.prototype.bool=function nt(_){return this._push(writeByte,1,_?1:0)};function writeFixed32(nt,_,tt){_[tt]=nt&255,_[tt+1]=nt>>>8&255,_[tt+2]=nt>>>16&255,_[tt+3]=nt>>>24}Writer$1.prototype.fixed32=function nt(_){return this._push(writeFixed32,4,_>>>0)};Writer$1.prototype.sfixed32=Writer$1.prototype.fixed32;Writer$1.prototype.fixed64=function nt(_){var tt=LongBits$1.from(_);return this._push(writeFixed32,4,tt.lo)._push(writeFixed32,4,tt.hi)};Writer$1.prototype.sfixed64=Writer$1.prototype.fixed64;Writer$1.prototype.float=function nt(_){return this._push(util$7.float.writeFloatLE,4,_)};Writer$1.prototype.double=function nt(_){return this._push(util$7.float.writeDoubleLE,8,_)};var writeBytes=util$7.Array.prototype.set?function nt(_,tt,ot){tt.set(_,ot)}:function nt(_,tt,ot){for(var st=0;st<_.length;++st)tt[ot+st]=_[st]};Writer$1.prototype.bytes=function nt(_){var tt=_.length>>>0;if(!tt)return this._push(writeByte,1,0);if(util$7.isString(_)){var ot=Writer$1.alloc(tt=base64.length(_));base64.decode(_,ot,0),_=ot}return this.uint32(tt)._push(writeBytes,tt,_)};Writer$1.prototype.string=function nt(_){var tt=utf8$1.length(_);return tt?this.uint32(tt)._push(utf8$1.write,tt,_):this._push(writeByte,1,0)};Writer$1.prototype.fork=function nt(){return this.states=new State(this),this.head=this.tail=new Op(noop,0,0),this.len=0,this};Writer$1.prototype.reset=function nt(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new Op(noop,0,0),this.len=0),this};Writer$1.prototype.ldelim=function nt(){var _=this.head,tt=this.tail,ot=this.len;return this.reset().uint32(ot),ot&&(this.tail.next=_.next,this.tail=tt,this.len+=ot),this};Writer$1.prototype.finish=function nt(){for(var _=this.head.next,tt=this.constructor.alloc(this.len),ot=0;_;)_.fn(_.val,tt,ot),ot+=_.len,_=_.next;return tt};Writer$1._configure=function(nt){BufferWriter$1=nt,Writer$1.create=create$1(),BufferWriter$1._configure()};var writer_buffer=BufferWriter,Writer=writer;(BufferWriter.prototype=Object.create(Writer.prototype)).constructor=BufferWriter;var util$6=requireMinimal();function BufferWriter(){Writer.call(this)}BufferWriter._configure=function(){BufferWriter.alloc=util$6._Buffer_allocUnsafe,BufferWriter.writeBytesBuffer=util$6.Buffer&&util$6.Buffer.prototype instanceof Uint8Array&&util$6.Buffer.prototype.set.name==="set"?function(_,tt,ot){tt.set(_,ot)}:function(_,tt,ot){if(_.copy)_.copy(tt,ot,0,_.length);else for(var st=0;st<_.length;)tt[ot++]=_[st++]}};BufferWriter.prototype.bytes=function nt(_){util$6.isString(_)&&(_=util$6._Buffer_from(_,"base64"));var tt=_.length>>>0;return this.uint32(tt),tt&&this._push(BufferWriter.writeBytesBuffer,tt,_),this};function writeStringBuffer(nt,_,tt){nt.length<40?util$6.utf8.write(nt,_,tt):_.utf8Write?_.utf8Write(nt,tt):_.write(nt,tt)}BufferWriter.prototype.string=function nt(_){var tt=util$6.Buffer.byteLength(_);return this.uint32(tt),tt&&this._push(writeStringBuffer,tt,_),this};BufferWriter._configure();var reader=Reader$1,util$5=requireMinimal(),BufferReader$1,LongBits=util$5.LongBits,utf8=util$5.utf8;function indexOutOfRange(nt,_){return RangeError("index out of range: "+nt.pos+" + "+(_||1)+" > "+nt.len)}function Reader$1(nt){this.buf=nt,this.pos=0,this.len=nt.length}var create_array=typeof Uint8Array<"u"?function nt(_){if(_ instanceof Uint8Array||Array.isArray(_))return new Reader$1(_);throw Error("illegal buffer")}:function nt(_){if(Array.isArray(_))return new Reader$1(_);throw Error("illegal buffer")},create=function nt(){return util$5.Buffer?function(tt){return(Reader$1.create=function(st){return util$5.Buffer.isBuffer(st)?new BufferReader$1(st):create_array(st)})(tt)}:create_array};Reader$1.create=create();Reader$1.prototype._slice=util$5.Array.prototype.subarray||util$5.Array.prototype.slice;Reader$1.prototype.uint32=function nt(){var _=4294967295;return function(){if(_=(this.buf[this.pos]&127)>>>0,this.buf[this.pos++]<128||(_=(_|(this.buf[this.pos]&127)<<7)>>>0,this.buf[this.pos++]<128)||(_=(_|(this.buf[this.pos]&127)<<14)>>>0,this.buf[this.pos++]<128)||(_=(_|(this.buf[this.pos]&127)<<21)>>>0,this.buf[this.pos++]<128)||(_=(_|(this.buf[this.pos]&15)<<28)>>>0,this.buf[this.pos++]<128))return _;if((this.pos+=5)>this.len)throw this.pos=this.len,indexOutOfRange(this,10);return _}}();Reader$1.prototype.int32=function nt(){return this.uint32()|0};Reader$1.prototype.sint32=function nt(){var _=this.uint32();return _>>>1^-(_&1)|0};function readLongVarint(){var nt=new LongBits(0,0),_=0;if(this.len-this.pos>4){for(;_<4;++_)if(nt.lo=(nt.lo|(this.buf[this.pos]&127)<<_*7)>>>0,this.buf[this.pos++]<128)return nt;if(nt.lo=(nt.lo|(this.buf[this.pos]&127)<<28)>>>0,nt.hi=(nt.hi|(this.buf[this.pos]&127)>>4)>>>0,this.buf[this.pos++]<128)return nt;_=0}else{for(;_<3;++_){if(this.pos>=this.len)throw indexOutOfRange(this);if(nt.lo=(nt.lo|(this.buf[this.pos]&127)<<_*7)>>>0,this.buf[this.pos++]<128)return nt}return nt.lo=(nt.lo|(this.buf[this.pos++]&127)<<_*7)>>>0,nt}if(this.len-this.pos>4){for(;_<5;++_)if(nt.hi=(nt.hi|(this.buf[this.pos]&127)<<_*7+3)>>>0,this.buf[this.pos++]<128)return nt}else for(;_<5;++_){if(this.pos>=this.len)throw indexOutOfRange(this);if(nt.hi=(nt.hi|(this.buf[this.pos]&127)<<_*7+3)>>>0,this.buf[this.pos++]<128)return nt}throw Error("invalid varint encoding")}Reader$1.prototype.bool=function nt(){return this.uint32()!==0};function readFixed32_end(nt,_){return(nt[_-4]|nt[_-3]<<8|nt[_-2]<<16|nt[_-1]<<24)>>>0}Reader$1.prototype.fixed32=function nt(){if(this.pos+4>this.len)throw indexOutOfRange(this,4);return readFixed32_end(this.buf,this.pos+=4)};Reader$1.prototype.sfixed32=function nt(){if(this.pos+4>this.len)throw indexOutOfRange(this,4);return readFixed32_end(this.buf,this.pos+=4)|0};function readFixed64(){if(this.pos+8>this.len)throw indexOutOfRange(this,8);return new LongBits(readFixed32_end(this.buf,this.pos+=4),readFixed32_end(this.buf,this.pos+=4))}Reader$1.prototype.float=function nt(){if(this.pos+4>this.len)throw indexOutOfRange(this,4);var _=util$5.float.readFloatLE(this.buf,this.pos);return this.pos+=4,_};Reader$1.prototype.double=function nt(){if(this.pos+8>this.len)throw indexOutOfRange(this,4);var _=util$5.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,_};Reader$1.prototype.bytes=function nt(){var _=this.uint32(),tt=this.pos,ot=this.pos+_;if(ot>this.len)throw indexOutOfRange(this,_);if(this.pos+=_,Array.isArray(this.buf))return this.buf.slice(tt,ot);if(tt===ot){var st=util$5.Buffer;return st?st.alloc(0):new this.buf.constructor(0)}return this._slice.call(this.buf,tt,ot)};Reader$1.prototype.string=function nt(){var _=this.bytes();return utf8.read(_,0,_.length)};Reader$1.prototype.skip=function nt(_){if(typeof _=="number"){if(this.pos+_>this.len)throw indexOutOfRange(this,_);this.pos+=_}else do if(this.pos>=this.len)throw indexOutOfRange(this);while(this.buf[this.pos++]&128);return this};Reader$1.prototype.skipType=function(nt){switch(nt){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;(nt=this.uint32()&7)!==4;)this.skipType(nt);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+nt+" at offset "+this.pos)}return this};Reader$1._configure=function(nt){BufferReader$1=nt,Reader$1.create=create(),BufferReader$1._configure();var _=util$5.Long?"toLong":"toNumber";util$5.merge(Reader$1.prototype,{int64:function(){return readLongVarint.call(this)[_](!1)},uint64:function(){return readLongVarint.call(this)[_](!0)},sint64:function(){return readLongVarint.call(this).zzDecode()[_](!1)},fixed64:function(){return readFixed64.call(this)[_](!0)},sfixed64:function(){return readFixed64.call(this)[_](!1)}})};var reader_buffer=BufferReader,Reader=reader;(BufferReader.prototype=Object.create(Reader.prototype)).constructor=BufferReader;var util$4=requireMinimal();function BufferReader(nt){Reader.call(this,nt)}BufferReader._configure=function(){util$4.Buffer&&(BufferReader.prototype._slice=util$4.Buffer.prototype.slice)};BufferReader.prototype.string=function nt(){var _=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+_,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+_,this.len))};BufferReader._configure();var rpc={},service$1=Service$1,util$3=requireMinimal();(Service$1.prototype=Object.create(util$3.EventEmitter.prototype)).constructor=Service$1;function Service$1(nt,_,tt){if(typeof nt!="function")throw TypeError("rpcImpl must be a function");util$3.EventEmitter.call(this),this.rpcImpl=nt,this.requestDelimited=!!_,this.responseDelimited=!!tt}Service$1.prototype.rpcCall=function nt(_,tt,ot,st,at){if(!st)throw TypeError("request must be specified");var lt=this;if(!at)return util$3.asPromise(nt,lt,_,tt,ot,st);if(!lt.rpcImpl){setTimeout(function(){at(Error("already ended"))},0);return}try{return lt.rpcImpl(_,tt[lt.requestDelimited?"encodeDelimited":"encode"](st).finish(),function(ht,ft){if(ht)return lt.emit("error",ht,_),at(ht);if(ft===null){lt.end(!0);return}if(!(ft instanceof ot))try{ft=ot[lt.responseDelimited?"decodeDelimited":"decode"](ft)}catch(gt){return lt.emit("error",gt,_),at(gt)}return lt.emit("data",ft,_),at(null,ft)})}catch(dt){lt.emit("error",dt,_),setTimeout(function(){at(dt)},0);return}};Service$1.prototype.end=function nt(_){return this.rpcImpl&&(_||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this};(function(nt){var _=nt;_.Service=service$1})(rpc);var roots={};(function(nt){var _=nt;_.build="minimal",_.Writer=writer,_.BufferWriter=writer_buffer,_.Reader=reader,_.BufferReader=reader_buffer,_.util=requireMinimal(),_.rpc=rpc,_.roots=roots,_.configure=tt;function tt(){_.util._configure(),_.Writer._configure(_.BufferWriter),_.Reader._configure(_.BufferReader)}tt()})(indexMinimal);var types$1={},util$2={exports:{}},codegen_1=codegen;function codegen(nt,_){typeof nt=="string"&&(_=nt,nt=void 0);var tt=[];function ot(at){if(typeof at!="string"){var lt=st();if(codegen.verbose&&console.log("codegen: "+lt),lt="return "+lt,at){for(var dt=Object.keys(at),ht=new Array(dt.length+1),ft=new Array(dt.length),gt=0;gt<dt.length;)ht[gt]=dt[gt],ft[gt]=at[dt[gt++]];return ht[gt]=lt,Function.apply(null,ht).apply(null,ft)}return Function(lt)()}for(var Et=new Array(arguments.length-1),yt=0;yt<Et.length;)Et[yt]=arguments[++yt];if(yt=0,at=at.replace(/%([%dfijs])/g,function(wt,It){var Pt=Et[yt++];switch(It){case"d":case"f":return String(Number(Pt));case"i":return String(Math.floor(Pt));case"j":return JSON.stringify(Pt);case"s":return String(Pt)}return"%"}),yt!==Et.length)throw Error("parameter count mismatch");return tt.push(at),ot}function st(at){return"function "+(at||_||"")+"("+(nt&&nt.join(",")||"")+`){
  `+tt.join(`
  `)+`
}`}return ot.toString=st,ot}codegen.verbose=!1;var fetch_1=fetch$1,asPromise=aspromise,inquire=inquire_1,fs=inquire("fs");function fetch$1(nt,_,tt){return typeof _=="function"?(tt=_,_={}):_||(_={}),tt?!_.xhr&&fs&&fs.readFile?fs.readFile(nt,function(st,at){return st&&typeof XMLHttpRequest<"u"?fetch$1.xhr(nt,_,tt):st?tt(st):tt(null,_.binary?at:at.toString("utf8"))}):fetch$1.xhr(nt,_,tt):asPromise(fetch$1,this,nt,_)}fetch$1.xhr=function nt(_,tt,ot){var st=new XMLHttpRequest;st.onreadystatechange=function(){if(st.readyState===4){if(st.status!==0&&st.status!==200)return ot(Error("status "+st.status));if(tt.binary){var lt=st.response;if(!lt){lt=[];for(var dt=0;dt<st.responseText.length;++dt)lt.push(st.responseText.charCodeAt(dt)&255)}return ot(null,typeof Uint8Array<"u"?new Uint8Array(lt):lt)}return ot(null,st.responseText)}},tt.binary&&("overrideMimeType"in st&&st.overrideMimeType("text/plain; charset=x-user-defined"),st.responseType="arraybuffer"),st.open("GET",_),st.send()};var path={};(function(nt){var _=nt,tt=_.isAbsolute=function(at){return/^(?:\/|\w+:)/.test(at)},ot=_.normalize=function(at){at=at.replace(/\\/g,"/").replace(/\/{2,}/g,"/");var lt=at.split("/"),dt=tt(at),ht="";dt&&(ht=lt.shift()+"/");for(var ft=0;ft<lt.length;)lt[ft]===".."?ft>0&&lt[ft-1]!==".."?lt.splice(--ft,2):dt?lt.splice(ft,1):++ft:lt[ft]==="."?lt.splice(ft,1):++ft;return ht+lt.join("/")};_.resolve=function(at,lt,dt){return dt||(lt=ot(lt)),tt(lt)?lt:(dt||(at=ot(at)),(at=at.replace(/(?:\/|^)[^/]+$/,"")).length?ot(at+"/"+lt):lt)}})(path);var namespace,hasRequiredNamespace;function requireNamespace(){if(hasRequiredNamespace)return namespace;hasRequiredNamespace=1,namespace=ht;var nt=requireObject();((ht.prototype=Object.create(nt.prototype)).constructor=ht).className="Namespace";var _=requireField(),tt=requireUtil(),ot=requireOneof(),st,at,lt;ht.fromJSON=function(Et,yt){return new ht(Et,yt.options).addJSON(yt.nested)};function dt(gt,Et){if(gt&&gt.length){for(var yt={},Ct=0;Ct<gt.length;++Ct)yt[gt[Ct].name]=gt[Ct].toJSON(Et);return yt}}ht.arrayToJSON=dt,ht.isReservedId=function(Et,yt){if(Et){for(var Ct=0;Ct<Et.length;++Ct)if(typeof Et[Ct]!="string"&&Et[Ct][0]<=yt&&Et[Ct][1]>yt)return!0}return!1},ht.isReservedName=function(Et,yt){if(Et){for(var Ct=0;Ct<Et.length;++Ct)if(Et[Ct]===yt)return!0}return!1};function ht(gt,Et){nt.call(this,gt,Et),this.nested=void 0,this._nestedArray=null,this._lookupCache={},this._needsRecursiveFeatureResolution=!0,this._needsRecursiveResolve=!0}function ft(gt){gt._nestedArray=null,gt._lookupCache={};for(var Et=gt;Et=Et.parent;)Et._lookupCache={};return gt}return Object.defineProperty(ht.prototype,"nestedArray",{get:function(){return this._nestedArray||(this._nestedArray=tt.toArray(this.nested))}}),ht.prototype.toJSON=function(Et){return tt.toObject(["options",this.options,"nested",dt(this.nestedArray,Et)])},ht.prototype.addJSON=function(Et){var yt=this;if(Et)for(var Ct=Object.keys(Et),wt=0,It;wt<Ct.length;++wt)It=Et[Ct[wt]],yt.add((It.fields!==void 0?st.fromJSON:It.values!==void 0?lt.fromJSON:It.methods!==void 0?at.fromJSON:It.id!==void 0?_.fromJSON:ht.fromJSON)(Ct[wt],It));return this},ht.prototype.get=function(Et){return this.nested&&this.nested[Et]||null},ht.prototype.getEnum=function(Et){if(this.nested&&this.nested[Et]instanceof lt)return this.nested[Et].values;throw Error("no such enum: "+Et)},ht.prototype.add=function(Et){if(!(Et instanceof _&&Et.extend!==void 0||Et instanceof st||Et instanceof ot||Et instanceof lt||Et instanceof at||Et instanceof ht))throw TypeError("object must be a valid nested object");if(!this.nested)this.nested={};else{var yt=this.get(Et.name);if(yt)if(yt instanceof ht&&Et instanceof ht&&!(yt instanceof st||yt instanceof at)){for(var Ct=yt.nestedArray,wt=0;wt<Ct.length;++wt)Et.add(Ct[wt]);this.remove(yt),this.nested||(this.nested={}),Et.setOptions(yt.options,!0)}else throw Error("duplicate name '"+Et.name+"' in "+this)}this.nested[Et.name]=Et,this instanceof st||this instanceof at||this instanceof lt||this instanceof _||Et._edition||(Et._edition=Et._defaultEdition),this._needsRecursiveFeatureResolution=!0,this._needsRecursiveResolve=!0;for(var It=this;It=It.parent;)It._needsRecursiveFeatureResolution=!0,It._needsRecursiveResolve=!0;return Et.onAdd(this),ft(this)},ht.prototype.remove=function(Et){if(!(Et instanceof nt))throw TypeError("object must be a ReflectionObject");if(Et.parent!==this)throw Error(Et+" is not a member of "+this);return delete this.nested[Et.name],Object.keys(this.nested).length||(this.nested=void 0),Et.onRemove(this),ft(this)},ht.prototype.define=function(Et,yt){if(tt.isString(Et))Et=Et.split(".");else if(!Array.isArray(Et))throw TypeError("illegal path");if(Et&&Et.length&&Et[0]==="")throw Error("path must be relative");for(var Ct=this;Et.length>0;){var wt=Et.shift();if(Ct.nested&&Ct.nested[wt]){if(Ct=Ct.nested[wt],!(Ct instanceof ht))throw Error("path conflicts with non-namespace objects")}else Ct.add(Ct=new ht(wt))}return yt&&Ct.addJSON(yt),Ct},ht.prototype.resolveAll=function(){if(!this._needsRecursiveResolve)return this;this._resolveFeaturesRecursive(this._edition);var Et=this.nestedArray,yt=0;for(this.resolve();yt<Et.length;)Et[yt]instanceof ht?Et[yt++].resolveAll():Et[yt++].resolve();return this._needsRecursiveResolve=!1,this},ht.prototype._resolveFeaturesRecursive=function(Et){return this._needsRecursiveFeatureResolution?(this._needsRecursiveFeatureResolution=!1,Et=this._edition||Et,nt.prototype._resolveFeaturesRecursive.call(this,Et),this.nestedArray.forEach(yt=>{yt._resolveFeaturesRecursive(Et)}),this):this},ht.prototype.lookup=function(Et,yt,Ct){if(typeof yt=="boolean"?(Ct=yt,yt=void 0):yt&&!Array.isArray(yt)&&(yt=[yt]),tt.isString(Et)&&Et.length){if(Et===".")return this.root;Et=Et.split(".")}else if(!Et.length)return this;var wt=Et.join(".");if(Et[0]==="")return this.root.lookup(Et.slice(1),yt);var It=this.root._fullyQualifiedObjects&&this.root._fullyQualifiedObjects["."+wt];if(It&&(!yt||yt.indexOf(It.constructor)>-1)||(It=this._lookupImpl(Et,wt),It&&(!yt||yt.indexOf(It.constructor)>-1)))return It;if(Ct)return null;for(var Pt=this;Pt.parent;){if(It=Pt.parent._lookupImpl(Et,wt),It&&(!yt||yt.indexOf(It.constructor)>-1))return It;Pt=Pt.parent}return null},ht.prototype._lookupImpl=function(Et,yt){if(Object.prototype.hasOwnProperty.call(this._lookupCache,yt))return this._lookupCache[yt];var Ct=this.get(Et[0]),wt=null;if(Ct)Et.length===1?wt=Ct:Ct instanceof ht&&(Et=Et.slice(1),wt=Ct._lookupImpl(Et,Et.join(".")));else for(var It=0;It<this.nestedArray.length;++It)this._nestedArray[It]instanceof ht&&(Ct=this._nestedArray[It]._lookupImpl(Et,yt))&&(wt=Ct);return this._lookupCache[yt]=wt,wt},ht.prototype.lookupType=function(Et){var yt=this.lookup(Et,[st]);if(!yt)throw Error("no such type: "+Et);return yt},ht.prototype.lookupEnum=function(Et){var yt=this.lookup(Et,[lt]);if(!yt)throw Error("no such Enum '"+Et+"' in "+this);return yt},ht.prototype.lookupTypeOrEnum=function(Et){var yt=this.lookup(Et,[st,lt]);if(!yt)throw Error("no such Type or Enum '"+Et+"' in "+this);return yt},ht.prototype.lookupService=function(Et){var yt=this.lookup(Et,[at]);if(!yt)throw Error("no such Service '"+Et+"' in "+this);return yt},ht._configure=function(gt,Et,yt){st=gt,at=Et,lt=yt},namespace}var mapfield,hasRequiredMapfield;function requireMapfield(){if(hasRequiredMapfield)return mapfield;hasRequiredMapfield=1,mapfield=ot;var nt=requireField();((ot.prototype=Object.create(nt.prototype)).constructor=ot).className="MapField";var _=requireTypes(),tt=requireUtil();function ot(st,at,lt,dt,ht,ft){if(nt.call(this,st,at,dt,void 0,void 0,ht,ft),!tt.isString(lt))throw TypeError("keyType must be a string");this.keyType=lt,this.resolvedKeyType=null,this.map=!0}return ot.fromJSON=function(at,lt){return new ot(at,lt.id,lt.keyType,lt.type,lt.options,lt.comment)},ot.prototype.toJSON=function(at){var lt=at?!!at.keepComments:!1;return tt.toObject(["keyType",this.keyType,"type",this.type,"id",this.id,"extend",this.extend,"options",this.options,"comment",lt?this.comment:void 0])},ot.prototype.resolve=function(){if(this.resolved)return this;if(_.mapKey[this.keyType]===void 0)throw Error("invalid key type: "+this.keyType);return nt.prototype.resolve.call(this)},ot.d=function(at,lt,dt){return typeof dt=="function"?dt=tt.decorateType(dt).name:dt&&typeof dt=="object"&&(dt=tt.decorateEnum(dt).name),function(ft,gt){tt.decorateType(ft.constructor).add(new ot(gt,at,lt,dt))}},mapfield}var method,hasRequiredMethod;function requireMethod(){if(hasRequiredMethod)return method;hasRequiredMethod=1,method=tt;var nt=requireObject();((tt.prototype=Object.create(nt.prototype)).constructor=tt).className="Method";var _=requireUtil();function tt(ot,st,at,lt,dt,ht,ft,gt,Et){if(_.isObject(dt)?(ft=dt,dt=ht=void 0):_.isObject(ht)&&(ft=ht,ht=void 0),!(st===void 0||_.isString(st)))throw TypeError("type must be a string");if(!_.isString(at))throw TypeError("requestType must be a string");if(!_.isString(lt))throw TypeError("responseType must be a string");nt.call(this,ot,ft),this.type=st||"rpc",this.requestType=at,this.requestStream=dt?!0:void 0,this.responseType=lt,this.responseStream=ht?!0:void 0,this.resolvedRequestType=null,this.resolvedResponseType=null,this.comment=gt,this.parsedOptions=Et}return tt.fromJSON=function(st,at){return new tt(st,at.type,at.requestType,at.responseType,at.requestStream,at.responseStream,at.options,at.comment,at.parsedOptions)},tt.prototype.toJSON=function(st){var at=st?!!st.keepComments:!1;return _.toObject(["type",this.type!=="rpc"&&this.type||void 0,"requestType",this.requestType,"requestStream",this.requestStream,"responseType",this.responseType,"responseStream",this.responseStream,"options",this.options,"comment",at?this.comment:void 0,"parsedOptions",this.parsedOptions])},tt.prototype.resolve=function(){return this.resolved?this:(this.resolvedRequestType=this.parent.lookupType(this.requestType),this.resolvedResponseType=this.parent.lookupType(this.responseType),nt.prototype.resolve.call(this))},method}var service,hasRequiredService;function requireService(){if(hasRequiredService)return service;hasRequiredService=1,service=st;var nt=requireNamespace();((st.prototype=Object.create(nt.prototype)).constructor=st).className="Service";var _=requireMethod(),tt=requireUtil(),ot=rpc;function st(lt,dt){nt.call(this,lt,dt),this.methods={},this._methodsArray=null}st.fromJSON=function(dt,ht){var ft=new st(dt,ht.options);if(ht.methods)for(var gt=Object.keys(ht.methods),Et=0;Et<gt.length;++Et)ft.add(_.fromJSON(gt[Et],ht.methods[gt[Et]]));return ht.nested&&ft.addJSON(ht.nested),ht.edition&&(ft._edition=ht.edition),ft.comment=ht.comment,ft._defaultEdition="proto3",ft},st.prototype.toJSON=function(dt){var ht=nt.prototype.toJSON.call(this,dt),ft=dt?!!dt.keepComments:!1;return tt.toObject(["edition",this._editionToJSON(),"options",ht&&ht.options||void 0,"methods",nt.arrayToJSON(this.methodsArray,dt)||{},"nested",ht&&ht.nested||void 0,"comment",ft?this.comment:void 0])},Object.defineProperty(st.prototype,"methodsArray",{get:function(){return this._methodsArray||(this._methodsArray=tt.toArray(this.methods))}});function at(lt){return lt._methodsArray=null,lt}return st.prototype.get=function(dt){return this.methods[dt]||nt.prototype.get.call(this,dt)},st.prototype.resolveAll=function(){if(!this._needsRecursiveResolve)return this;nt.prototype.resolve.call(this);for(var dt=this.methodsArray,ht=0;ht<dt.length;++ht)dt[ht].resolve();return this},st.prototype._resolveFeaturesRecursive=function(dt){return this._needsRecursiveFeatureResolution?(dt=this._edition||dt,nt.prototype._resolveFeaturesRecursive.call(this,dt),this.methodsArray.forEach(ht=>{ht._resolveFeaturesRecursive(dt)}),this):this},st.prototype.add=function(dt){if(this.get(dt.name))throw Error("duplicate name '"+dt.name+"' in "+this);return dt instanceof _?(this.methods[dt.name]=dt,dt.parent=this,at(this)):nt.prototype.add.call(this,dt)},st.prototype.remove=function(dt){if(dt instanceof _){if(this.methods[dt.name]!==dt)throw Error(dt+" is not a member of "+this);return delete this.methods[dt.name],dt.parent=null,at(this)}return nt.prototype.remove.call(this,dt)},st.prototype.create=function(dt,ht,ft){for(var gt=new ot.Service(dt,ht,ft),Et=0,yt;Et<this.methodsArray.length;++Et){var Ct=tt.lcFirst((yt=this._methodsArray[Et]).resolve().name).replace(/[^$\w_]/g,"");gt[Ct]=tt.codegen(["r","c"],tt.isReserved(Ct)?Ct+"_":Ct)("return this.rpcCall(m,q,s,r,c)")({m:yt,q:yt.resolvedRequestType.ctor,s:yt.resolvedResponseType.ctor})}return gt},service}var message=Message,util$1=requireMinimal();function Message(nt){if(nt)for(var _=Object.keys(nt),tt=0;tt<_.length;++tt)this[_[tt]]=nt[_[tt]]}Message.create=function nt(_){return this.$type.create(_)};Message.encode=function nt(_,tt){return this.$type.encode(_,tt)};Message.encodeDelimited=function nt(_,tt){return this.$type.encodeDelimited(_,tt)};Message.decode=function nt(_){return this.$type.decode(_)};Message.decodeDelimited=function nt(_){return this.$type.decodeDelimited(_)};Message.verify=function nt(_){return this.$type.verify(_)};Message.fromObject=function nt(_){return this.$type.fromObject(_)};Message.toObject=function nt(_,tt){return this.$type.toObject(_,tt)};Message.prototype.toJSON=function nt(){return this.$type.toObject(this,util$1.toJSONOptions)};var decoder_1,hasRequiredDecoder;function requireDecoder(){if(hasRequiredDecoder)return decoder_1;hasRequiredDecoder=1,decoder_1=st;var nt=require_enum(),_=requireTypes(),tt=requireUtil();function ot(at){return"missing required '"+at.name+"'"}function st(at){for(var lt=tt.codegen(["r","l","e"],at.name+"$decode")("if(!(r instanceof Reader))")("r=Reader.create(r)")("var c=l===undefined?r.len:r.pos+l,m=new this.ctor"+(at.fieldsArray.filter(function(yt){return yt.map}).length?",k,value":""))("while(r.pos<c){")("var t=r.uint32()")("if(t===e)")("break")("switch(t>>>3){"),dt=0;dt<at.fieldsArray.length;++dt){var ht=at._fieldsArray[dt].resolve(),ft=ht.resolvedType instanceof nt?"int32":ht.type,gt="m"+tt.safeProp(ht.name);lt("case %i: {",ht.id),ht.map?(lt("if(%s===util.emptyObject)",gt)("%s={}",gt)("var c2 = r.uint32()+r.pos"),_.defaults[ht.keyType]!==void 0?lt("k=%j",_.defaults[ht.keyType]):lt("k=null"),_.defaults[ft]!==void 0?lt("value=%j",_.defaults[ft]):lt("value=null"),lt("while(r.pos<c2){")("var tag2=r.uint32()")("switch(tag2>>>3){")("case 1: k=r.%s(); break",ht.keyType)("case 2:"),_.basic[ft]===void 0?lt("value=types[%i].decode(r,r.uint32())",dt):lt("value=r.%s()",ft),lt("break")("default:")("r.skipType(tag2&7)")("break")("}")("}"),_.long[ht.keyType]!==void 0?lt('%s[typeof k==="object"?util.longToHash(k):k]=value',gt):lt("%s[k]=value",gt)):ht.repeated?(lt("if(!(%s&&%s.length))",gt,gt)("%s=[]",gt),_.packed[ft]!==void 0&&lt("if((t&7)===2){")("var c2=r.uint32()+r.pos")("while(r.pos<c2)")("%s.push(r.%s())",gt,ft)("}else"),_.basic[ft]===void 0?lt(ht.delimited?"%s.push(types[%i].decode(r,undefined,((t&~7)|4)))":"%s.push(types[%i].decode(r,r.uint32()))",gt,dt):lt("%s.push(r.%s())",gt,ft)):_.basic[ft]===void 0?lt(ht.delimited?"%s=types[%i].decode(r,undefined,((t&~7)|4))":"%s=types[%i].decode(r,r.uint32())",gt,dt):lt("%s=r.%s()",gt,ft),lt("break")("}")}for(lt("default:")("r.skipType(t&7)")("break")("}")("}"),dt=0;dt<at._fieldsArray.length;++dt){var Et=at._fieldsArray[dt];Et.required&&lt("if(!m.hasOwnProperty(%j))",Et.name)("throw util.ProtocolError(%j,{instance:m})",ot(Et))}return lt("return m")}return decoder_1}var verifier_1,hasRequiredVerifier;function requireVerifier(){if(hasRequiredVerifier)return verifier_1;hasRequiredVerifier=1,verifier_1=at;var nt=require_enum(),_=requireUtil();function tt(lt,dt){return lt.name+": "+dt+(lt.repeated&&dt!=="array"?"[]":lt.map&&dt!=="object"?"{k:"+lt.keyType+"}":"")+" expected"}function ot(lt,dt,ht,ft){if(dt.resolvedType)if(dt.resolvedType instanceof nt){lt("switch(%s){",ft)("default:")("return%j",tt(dt,"enum value"));for(var gt=Object.keys(dt.resolvedType.values),Et=0;Et<gt.length;++Et)lt("case %i:",dt.resolvedType.values[gt[Et]]);lt("break")("}")}else lt("{")("var e=types[%i].verify(%s);",ht,ft)("if(e)")("return%j+e",dt.name+".")("}");else switch(dt.type){case"int32":case"uint32":case"sint32":case"fixed32":case"sfixed32":lt("if(!util.isInteger(%s))",ft)("return%j",tt(dt,"integer"));break;case"int64":case"uint64":case"sint64":case"fixed64":case"sfixed64":lt("if(!util.isInteger(%s)&&!(%s&&util.isInteger(%s.low)&&util.isInteger(%s.high)))",ft,ft,ft,ft)("return%j",tt(dt,"integer|Long"));break;case"float":case"double":lt('if(typeof %s!=="number")',ft)("return%j",tt(dt,"number"));break;case"bool":lt('if(typeof %s!=="boolean")',ft)("return%j",tt(dt,"boolean"));break;case"string":lt("if(!util.isString(%s))",ft)("return%j",tt(dt,"string"));break;case"bytes":lt('if(!(%s&&typeof %s.length==="number"||util.isString(%s)))',ft,ft,ft)("return%j",tt(dt,"buffer"));break}return lt}function st(lt,dt,ht){switch(dt.keyType){case"int32":case"uint32":case"sint32":case"fixed32":case"sfixed32":lt("if(!util.key32Re.test(%s))",ht)("return%j",tt(dt,"integer key"));break;case"int64":case"uint64":case"sint64":case"fixed64":case"sfixed64":lt("if(!util.key64Re.test(%s))",ht)("return%j",tt(dt,"integer|Long key"));break;case"bool":lt("if(!util.key2Re.test(%s))",ht)("return%j",tt(dt,"boolean key"));break}return lt}function at(lt){var dt=_.codegen(["m"],lt.name+"$verify")('if(typeof m!=="object"||m===null)')("return%j","object expected"),ht=lt.oneofsArray,ft={};ht.length&&dt("var p={}");for(var gt=0;gt<lt.fieldsArray.length;++gt){var Et=lt._fieldsArray[gt].resolve(),yt="m"+_.safeProp(Et.name);if(Et.optional&&dt("if(%s!=null&&m.hasOwnProperty(%j)){",yt,Et.name),Et.map)dt("if(!util.isObject(%s))",yt)("return%j",tt(Et,"object"))("var k=Object.keys(%s)",yt)("for(var i=0;i<k.length;++i){"),st(dt,Et,"k[i]"),ot(dt,Et,gt,yt+"[k[i]]")("}");else if(Et.repeated)dt("if(!Array.isArray(%s))",yt)("return%j",tt(Et,"array"))("for(var i=0;i<%s.length;++i){",yt),ot(dt,Et,gt,yt+"[i]")("}");else{if(Et.partOf){var Ct=_.safeProp(Et.partOf.name);ft[Et.partOf.name]===1&&dt("if(p%s===1)",Ct)("return%j",Et.partOf.name+": multiple values"),ft[Et.partOf.name]=1,dt("p%s=1",Ct)}ot(dt,Et,gt,yt)}Et.optional&&dt("}")}return dt("return null")}return verifier_1}var converter={},hasRequiredConverter;function requireConverter(){return hasRequiredConverter||(hasRequiredConverter=1,function(nt){var _=nt,tt=require_enum(),ot=requireUtil();function st(lt,dt,ht,ft){var gt=!1;if(dt.resolvedType)if(dt.resolvedType instanceof tt){lt("switch(d%s){",ft);for(var Et=dt.resolvedType.values,yt=Object.keys(Et),Ct=0;Ct<yt.length;++Ct)Et[yt[Ct]]===dt.typeDefault&&!gt&&(lt("default:")('if(typeof(d%s)==="number"){m%s=d%s;break}',ft,ft,ft),dt.repeated||lt("break"),gt=!0),lt("case%j:",yt[Ct])("case %i:",Et[yt[Ct]])("m%s=%j",ft,Et[yt[Ct]])("break");lt("}")}else lt('if(typeof d%s!=="object")',ft)("throw TypeError(%j)",dt.fullName+": object expected")("m%s=types[%i].fromObject(d%s)",ft,ht,ft);else{var wt=!1;switch(dt.type){case"double":case"float":lt("m%s=Number(d%s)",ft,ft);break;case"uint32":case"fixed32":lt("m%s=d%s>>>0",ft,ft);break;case"int32":case"sint32":case"sfixed32":lt("m%s=d%s|0",ft,ft);break;case"uint64":wt=!0;case"int64":case"sint64":case"fixed64":case"sfixed64":lt("if(util.Long)")("(m%s=util.Long.fromValue(d%s)).unsigned=%j",ft,ft,wt)('else if(typeof d%s==="string")',ft)("m%s=parseInt(d%s,10)",ft,ft)('else if(typeof d%s==="number")',ft)("m%s=d%s",ft,ft)('else if(typeof d%s==="object")',ft)("m%s=new util.LongBits(d%s.low>>>0,d%s.high>>>0).toNumber(%s)",ft,ft,ft,wt?"true":"");break;case"bytes":lt('if(typeof d%s==="string")',ft)("util.base64.decode(d%s,m%s=util.newBuffer(util.base64.length(d%s)),0)",ft,ft,ft)("else if(d%s.length >= 0)",ft)("m%s=d%s",ft,ft);break;case"string":lt("m%s=String(d%s)",ft,ft);break;case"bool":lt("m%s=Boolean(d%s)",ft,ft);break}}return lt}_.fromObject=function(dt){var ht=dt.fieldsArray,ft=ot.codegen(["d"],dt.name+"$fromObject")("if(d instanceof this.ctor)")("return d");if(!ht.length)return ft("return new this.ctor");ft("var m=new this.ctor");for(var gt=0;gt<ht.length;++gt){var Et=ht[gt].resolve(),yt=ot.safeProp(Et.name);Et.map?(ft("if(d%s){",yt)('if(typeof d%s!=="object")',yt)("throw TypeError(%j)",Et.fullName+": object expected")("m%s={}",yt)("for(var ks=Object.keys(d%s),i=0;i<ks.length;++i){",yt),st(ft,Et,gt,yt+"[ks[i]]")("}")("}")):Et.repeated?(ft("if(d%s){",yt)("if(!Array.isArray(d%s))",yt)("throw TypeError(%j)",Et.fullName+": array expected")("m%s=[]",yt)("for(var i=0;i<d%s.length;++i){",yt),st(ft,Et,gt,yt+"[i]")("}")("}")):(Et.resolvedType instanceof tt||ft("if(d%s!=null){",yt),st(ft,Et,gt,yt),Et.resolvedType instanceof tt||ft("}"))}return ft("return m")};function at(lt,dt,ht,ft){if(dt.resolvedType)dt.resolvedType instanceof tt?lt("d%s=o.enums===String?(types[%i].values[m%s]===undefined?m%s:types[%i].values[m%s]):m%s",ft,ht,ft,ft,ht,ft,ft):lt("d%s=types[%i].toObject(m%s,o)",ft,ht,ft);else{var gt=!1;switch(dt.type){case"double":case"float":lt("d%s=o.json&&!isFinite(m%s)?String(m%s):m%s",ft,ft,ft,ft);break;case"uint64":gt=!0;case"int64":case"sint64":case"fixed64":case"sfixed64":lt('if(typeof m%s==="number")',ft)("d%s=o.longs===String?String(m%s):m%s",ft,ft,ft)("else")("d%s=o.longs===String?util.Long.prototype.toString.call(m%s):o.longs===Number?new util.LongBits(m%s.low>>>0,m%s.high>>>0).toNumber(%s):m%s",ft,ft,ft,ft,gt?"true":"",ft);break;case"bytes":lt("d%s=o.bytes===String?util.base64.encode(m%s,0,m%s.length):o.bytes===Array?Array.prototype.slice.call(m%s):m%s",ft,ft,ft,ft,ft);break;default:lt("d%s=m%s",ft,ft);break}}return lt}_.toObject=function(dt){var ht=dt.fieldsArray.slice().sort(ot.compareFieldsById);if(!ht.length)return ot.codegen()("return {}");for(var ft=ot.codegen(["m","o"],dt.name+"$toObject")("if(!o)")("o={}")("var d={}"),gt=[],Et=[],yt=[],Ct=0;Ct<ht.length;++Ct)ht[Ct].partOf||(ht[Ct].resolve().repeated?gt:ht[Ct].map?Et:yt).push(ht[Ct]);if(gt.length){for(ft("if(o.arrays||o.defaults){"),Ct=0;Ct<gt.length;++Ct)ft("d%s=[]",ot.safeProp(gt[Ct].name));ft("}")}if(Et.length){for(ft("if(o.objects||o.defaults){"),Ct=0;Ct<Et.length;++Ct)ft("d%s={}",ot.safeProp(Et[Ct].name));ft("}")}if(yt.length){for(ft("if(o.defaults){"),Ct=0;Ct<yt.length;++Ct){var wt=yt[Ct],It=ot.safeProp(wt.name);if(wt.resolvedType instanceof tt)ft("d%s=o.enums===String?%j:%j",It,wt.resolvedType.valuesById[wt.typeDefault],wt.typeDefault);else if(wt.long)ft("if(util.Long){")("var n=new util.Long(%i,%i,%j)",wt.typeDefault.low,wt.typeDefault.high,wt.typeDefault.unsigned)("d%s=o.longs===String?n.toString():o.longs===Number?n.toNumber():n",It)("}else")("d%s=o.longs===String?%j:%i",It,wt.typeDefault.toString(),wt.typeDefault.toNumber());else if(wt.bytes){var Pt="["+Array.prototype.slice.call(wt.typeDefault).join(",")+"]";ft("if(o.bytes===String)d%s=%j",It,String.fromCharCode.apply(String,wt.typeDefault))("else{")("d%s=%s",It,Pt)("if(o.bytes!==Array)d%s=util.newBuffer(d%s)",It,It)("}")}else ft("d%s=%j",It,wt.typeDefault)}ft("}")}var Rt=!1;for(Ct=0;Ct<ht.length;++Ct){var wt=ht[Ct],xt=dt._fieldsArray.indexOf(wt),It=ot.safeProp(wt.name);wt.map?(Rt||(Rt=!0,ft("var ks2")),ft("if(m%s&&(ks2=Object.keys(m%s)).length){",It,It)("d%s={}",It)("for(var j=0;j<ks2.length;++j){"),at(ft,wt,xt,It+"[ks2[j]]")("}")):wt.repeated?(ft("if(m%s&&m%s.length){",It,It)("d%s=[]",It)("for(var j=0;j<m%s.length;++j){",It),at(ft,wt,xt,It+"[j]")("}")):(ft("if(m%s!=null&&m.hasOwnProperty(%j)){",It,wt.name),at(ft,wt,xt,It),wt.partOf&&ft("if(o.oneofs)")("d%s=%j",ot.safeProp(wt.partOf.name),wt.name)),ft("}")}return ft("return d")}}(converter)),converter}var wrappers={};(function(nt){var _=nt,tt=message;_[".google.protobuf.Any"]={fromObject:function(ot){if(ot&&ot["@type"]){var st=ot["@type"].substring(ot["@type"].lastIndexOf("/")+1),at=this.lookup(st);if(at){var lt=ot["@type"].charAt(0)==="."?ot["@type"].slice(1):ot["@type"];return lt.indexOf("/")===-1&&(lt="/"+lt),this.create({type_url:lt,value:at.encode(at.fromObject(ot)).finish()})}}return this.fromObject(ot)},toObject:function(ot,st){var at="type.googleapis.com/",lt="",dt="";if(st&&st.json&&ot.type_url&&ot.value){dt=ot.type_url.substring(ot.type_url.lastIndexOf("/")+1),lt=ot.type_url.substring(0,ot.type_url.lastIndexOf("/")+1);var ht=this.lookup(dt);ht&&(ot=ht.decode(ot.value))}if(!(ot instanceof this.ctor)&&ot instanceof tt){var ft=ot.$type.toObject(ot,st),gt=ot.$type.fullName[0]==="."?ot.$type.fullName.slice(1):ot.$type.fullName;return lt===""&&(lt=at),dt=lt+gt,ft["@type"]=dt,ft}return this.toObject(ot,st)}}})(wrappers);var type,hasRequiredType;function requireType(){if(hasRequiredType)return type;hasRequiredType=1,type=It;var nt=requireNamespace();((It.prototype=Object.create(nt.prototype)).constructor=It).className="Type";var _=require_enum(),tt=requireOneof(),ot=requireField(),st=requireMapfield(),at=requireService(),lt=message,dt=reader,ht=writer,ft=requireUtil(),gt=requireEncoder(),Et=requireDecoder(),yt=requireVerifier(),Ct=requireConverter(),wt=wrappers;function It(Rt,xt){nt.call(this,Rt,xt),this.fields={},this.oneofs=void 0,this.extensions=void 0,this.reserved=void 0,this.group=void 0,this._fieldsById=null,this._fieldsArray=null,this._oneofsArray=null,this._ctor=null}Object.defineProperties(It.prototype,{fieldsById:{get:function(){if(this._fieldsById)return this._fieldsById;this._fieldsById={};for(var Rt=Object.keys(this.fields),xt=0;xt<Rt.length;++xt){var Nt=this.fields[Rt[xt]],kt=Nt.id;if(this._fieldsById[kt])throw Error("duplicate id "+kt+" in "+this);this._fieldsById[kt]=Nt}return this._fieldsById}},fieldsArray:{get:function(){return this._fieldsArray||(this._fieldsArray=ft.toArray(this.fields))}},oneofsArray:{get:function(){return this._oneofsArray||(this._oneofsArray=ft.toArray(this.oneofs))}},ctor:{get:function(){return this._ctor||(this.ctor=It.generateConstructor(this)())},set:function(Rt){var xt=Rt.prototype;xt instanceof lt||((Rt.prototype=new lt).constructor=Rt,ft.merge(Rt.prototype,xt)),Rt.$type=Rt.prototype.$type=this,ft.merge(Rt,lt,!0),this._ctor=Rt;for(var Nt=0;Nt<this.fieldsArray.length;++Nt)this._fieldsArray[Nt].resolve();var kt={};for(Nt=0;Nt<this.oneofsArray.length;++Nt)kt[this._oneofsArray[Nt].resolve().name]={get:ft.oneOfGetter(this._oneofsArray[Nt].oneof),set:ft.oneOfSetter(this._oneofsArray[Nt].oneof)};Nt&&Object.defineProperties(Rt.prototype,kt)}}}),It.generateConstructor=function(xt){for(var Nt=ft.codegen(["p"],xt.name),kt=0,Vt;kt<xt.fieldsArray.length;++kt)(Vt=xt._fieldsArray[kt]).map?Nt("this%s={}",ft.safeProp(Vt.name)):Vt.repeated&&Nt("this%s=[]",ft.safeProp(Vt.name));return Nt("if(p)for(var ks=Object.keys(p),i=0;i<ks.length;++i)if(p[ks[i]]!=null)")("this[ks[i]]=p[ks[i]]")};function Pt(Rt){return Rt._fieldsById=Rt._fieldsArray=Rt._oneofsArray=null,delete Rt.encode,delete Rt.decode,delete Rt.verify,Rt}return It.fromJSON=function(xt,Nt){var kt=new It(xt,Nt.options);kt.extensions=Nt.extensions,kt.reserved=Nt.reserved;for(var Vt=Object.keys(Nt.fields),Ft=0;Ft<Vt.length;++Ft)kt.add((typeof Nt.fields[Vt[Ft]].keyType<"u"?st.fromJSON:ot.fromJSON)(Vt[Ft],Nt.fields[Vt[Ft]]));if(Nt.oneofs)for(Vt=Object.keys(Nt.oneofs),Ft=0;Ft<Vt.length;++Ft)kt.add(tt.fromJSON(Vt[Ft],Nt.oneofs[Vt[Ft]]));if(Nt.nested)for(Vt=Object.keys(Nt.nested),Ft=0;Ft<Vt.length;++Ft){var zt=Nt.nested[Vt[Ft]];kt.add((zt.id!==void 0?ot.fromJSON:zt.fields!==void 0?It.fromJSON:zt.values!==void 0?_.fromJSON:zt.methods!==void 0?at.fromJSON:nt.fromJSON)(Vt[Ft],zt))}return Nt.extensions&&Nt.extensions.length&&(kt.extensions=Nt.extensions),Nt.reserved&&Nt.reserved.length&&(kt.reserved=Nt.reserved),Nt.group&&(kt.group=!0),Nt.comment&&(kt.comment=Nt.comment),Nt.edition&&(kt._edition=Nt.edition),kt._defaultEdition="proto3",kt},It.prototype.toJSON=function(xt){var Nt=nt.prototype.toJSON.call(this,xt),kt=xt?!!xt.keepComments:!1;return ft.toObject(["edition",this._editionToJSON(),"options",Nt&&Nt.options||void 0,"oneofs",nt.arrayToJSON(this.oneofsArray,xt),"fields",nt.arrayToJSON(this.fieldsArray.filter(function(Vt){return!Vt.declaringField}),xt)||{},"extensions",this.extensions&&this.extensions.length?this.extensions:void 0,"reserved",this.reserved&&this.reserved.length?this.reserved:void 0,"group",this.group||void 0,"nested",Nt&&Nt.nested||void 0,"comment",kt?this.comment:void 0])},It.prototype.resolveAll=function(){if(!this._needsRecursiveResolve)return this;nt.prototype.resolveAll.call(this);var xt=this.oneofsArray;for(kt=0;kt<xt.length;)xt[kt++].resolve();for(var Nt=this.fieldsArray,kt=0;kt<Nt.length;)Nt[kt++].resolve();return this},It.prototype._resolveFeaturesRecursive=function(xt){return this._needsRecursiveFeatureResolution?(xt=this._edition||xt,nt.prototype._resolveFeaturesRecursive.call(this,xt),this.oneofsArray.forEach(Nt=>{Nt._resolveFeatures(xt)}),this.fieldsArray.forEach(Nt=>{Nt._resolveFeatures(xt)}),this):this},It.prototype.get=function(xt){return this.fields[xt]||this.oneofs&&this.oneofs[xt]||this.nested&&this.nested[xt]||null},It.prototype.add=function(xt){if(this.get(xt.name))throw Error("duplicate name '"+xt.name+"' in "+this);if(xt instanceof ot&&xt.extend===void 0){if(this._fieldsById?this._fieldsById[xt.id]:this.fieldsById[xt.id])throw Error("duplicate id "+xt.id+" in "+this);if(this.isReservedId(xt.id))throw Error("id "+xt.id+" is reserved in "+this);if(this.isReservedName(xt.name))throw Error("name '"+xt.name+"' is reserved in "+this);return xt.parent&&xt.parent.remove(xt),this.fields[xt.name]=xt,xt.message=this,xt.onAdd(this),Pt(this)}return xt instanceof tt?(this.oneofs||(this.oneofs={}),this.oneofs[xt.name]=xt,xt.onAdd(this),Pt(this)):nt.prototype.add.call(this,xt)},It.prototype.remove=function(xt){if(xt instanceof ot&&xt.extend===void 0){if(!this.fields||this.fields[xt.name]!==xt)throw Error(xt+" is not a member of "+this);return delete this.fields[xt.name],xt.parent=null,xt.onRemove(this),Pt(this)}if(xt instanceof tt){if(!this.oneofs||this.oneofs[xt.name]!==xt)throw Error(xt+" is not a member of "+this);return delete this.oneofs[xt.name],xt.parent=null,xt.onRemove(this),Pt(this)}return nt.prototype.remove.call(this,xt)},It.prototype.isReservedId=function(xt){return nt.isReservedId(this.reserved,xt)},It.prototype.isReservedName=function(xt){return nt.isReservedName(this.reserved,xt)},It.prototype.create=function(xt){return new this.ctor(xt)},It.prototype.setup=function(){for(var xt=this.fullName,Nt=[],kt=0;kt<this.fieldsArray.length;++kt)Nt.push(this._fieldsArray[kt].resolve().resolvedType);this.encode=gt(this)({Writer:ht,types:Nt,util:ft}),this.decode=Et(this)({Reader:dt,types:Nt,util:ft}),this.verify=yt(this)({types:Nt,util:ft}),this.fromObject=Ct.fromObject(this)({types:Nt,util:ft}),this.toObject=Ct.toObject(this)({types:Nt,util:ft});var Vt=wt[xt];if(Vt){var Ft=Object.create(this);Ft.fromObject=this.fromObject,this.fromObject=Vt.fromObject.bind(Ft),Ft.toObject=this.toObject,this.toObject=Vt.toObject.bind(Ft)}return this},It.prototype.encode=function(xt,Nt){return this.setup().encode(xt,Nt)},It.prototype.encodeDelimited=function(xt,Nt){return this.encode(xt,Nt&&Nt.len?Nt.fork():Nt).ldelim()},It.prototype.decode=function(xt,Nt){return this.setup().decode(xt,Nt)},It.prototype.decodeDelimited=function(xt){return xt instanceof dt||(xt=dt.create(xt)),this.decode(xt,xt.uint32())},It.prototype.verify=function(xt){return this.setup().verify(xt)},It.prototype.fromObject=function(xt){return this.setup().fromObject(xt)},It.prototype.toObject=function(xt,Nt){return this.setup().toObject(xt,Nt)},It.d=function(xt){return function(kt){ft.decorateType(kt,xt)}},type}var root,hasRequiredRoot;function requireRoot(){if(hasRequiredRoot)return root;hasRequiredRoot=1,root=ht;var nt=requireNamespace();((ht.prototype=Object.create(nt.prototype)).constructor=ht).className="Root";var _=requireField(),tt=require_enum(),ot=requireOneof(),st=requireUtil(),at,lt,dt;function ht(yt){nt.call(this,"",yt),this.deferred=[],this.files=[],this._edition="proto2",this._fullyQualifiedObjects={}}ht.fromJSON=function(Ct,wt){return wt||(wt=new ht),Ct.options&&wt.setOptions(Ct.options),wt.addJSON(Ct.nested).resolveAll()},ht.prototype.resolvePath=st.path.resolve,ht.prototype.fetch=st.fetch;function ft(){}ht.prototype.load=function yt(Ct,wt,It){typeof wt=="function"&&(It=wt,wt=void 0);var Pt=this;if(!It)return st.asPromise(yt,Pt,Ct,wt);var Rt=It===ft;function xt(Kt,qt){if(It){if(Rt)throw Kt;qt&&qt.resolveAll();var pn=It;It=null,pn(Kt,qt)}}function Nt(Kt){var qt=Kt.lastIndexOf("google/protobuf/");if(qt>-1){var pn=Kt.substring(qt);if(pn in dt)return pn}return null}function kt(Kt,qt){try{if(st.isString(qt)&&qt.charAt(0)==="{"&&(qt=JSON.parse(qt)),!st.isString(qt))Pt.setOptions(qt.options).addJSON(qt.nested);else{lt.filename=Kt;var pn=lt(qt,Pt,wt),an,fn=0;if(pn.imports)for(;fn<pn.imports.length;++fn)(an=Nt(pn.imports[fn])||Pt.resolvePath(Kt,pn.imports[fn]))&&Vt(an);if(pn.weakImports)for(fn=0;fn<pn.weakImports.length;++fn)(an=Nt(pn.weakImports[fn])||Pt.resolvePath(Kt,pn.weakImports[fn]))&&Vt(an,!0)}}catch(dn){xt(dn)}!Rt&&!Ft&&xt(null,Pt)}function Vt(Kt,qt){if(Kt=Nt(Kt)||Kt,!(Pt.files.indexOf(Kt)>-1)){if(Pt.files.push(Kt),Kt in dt){Rt?kt(Kt,dt[Kt]):(++Ft,setTimeout(function(){--Ft,kt(Kt,dt[Kt])}));return}if(Rt){var pn;try{pn=st.fs.readFileSync(Kt).toString("utf8")}catch(an){qt||xt(an);return}kt(Kt,pn)}else++Ft,Pt.fetch(Kt,function(an,fn){if(--Ft,!!It){if(an){qt?Ft||xt(null,Pt):xt(an);return}kt(Kt,fn)}})}}var Ft=0;st.isString(Ct)&&(Ct=[Ct]);for(var zt=0,Yt;zt<Ct.length;++zt)(Yt=Pt.resolvePath("",Ct[zt]))&&Vt(Yt);return Rt?(Pt.resolveAll(),Pt):(Ft||xt(null,Pt),Pt)},ht.prototype.loadSync=function(Ct,wt){if(!st.isNode)throw Error("not supported");return this.load(Ct,wt,ft)},ht.prototype.resolveAll=function(){if(!this._needsRecursiveResolve)return this;if(this.deferred.length)throw Error("unresolvable extensions: "+this.deferred.map(function(Ct){return"'extend "+Ct.extend+"' in "+Ct.parent.fullName}).join(", "));return nt.prototype.resolveAll.call(this)};var gt=/^[A-Z]/;function Et(yt,Ct){var wt=Ct.parent.lookup(Ct.extend);if(wt){var It=new _(Ct.fullName,Ct.id,Ct.type,Ct.rule,void 0,Ct.options);return wt.get(It.name)||(It.declaringField=Ct,Ct.extensionField=It,wt.add(It)),!0}return!1}return ht.prototype._handleAdd=function(Ct){if(Ct instanceof _)Ct.extend!==void 0&&!Ct.extensionField&&(Et(this,Ct)||this.deferred.push(Ct));else if(Ct instanceof tt)gt.test(Ct.name)&&(Ct.parent[Ct.name]=Ct.values);else if(!(Ct instanceof ot)){if(Ct instanceof at)for(var wt=0;wt<this.deferred.length;)Et(this,this.deferred[wt])?this.deferred.splice(wt,1):++wt;for(var It=0;It<Ct.nestedArray.length;++It)this._handleAdd(Ct._nestedArray[It]);gt.test(Ct.name)&&(Ct.parent[Ct.name]=Ct)}(Ct instanceof at||Ct instanceof tt||Ct instanceof _)&&(this._fullyQualifiedObjects[Ct.fullName]=Ct)},ht.prototype._handleRemove=function(Ct){if(Ct instanceof _){if(Ct.extend!==void 0)if(Ct.extensionField)Ct.extensionField.parent.remove(Ct.extensionField),Ct.extensionField=null;else{var wt=this.deferred.indexOf(Ct);wt>-1&&this.deferred.splice(wt,1)}}else if(Ct instanceof tt)gt.test(Ct.name)&&delete Ct.parent[Ct.name];else if(Ct instanceof nt){for(var It=0;It<Ct.nestedArray.length;++It)this._handleRemove(Ct._nestedArray[It]);gt.test(Ct.name)&&delete Ct.parent[Ct.name]}delete this._fullyQualifiedObjects[Ct.fullName]},ht._configure=function(yt,Ct,wt){at=yt,lt=Ct,dt=wt},root}var hasRequiredUtil;function requireUtil(){if(hasRequiredUtil)return util$2.exports;hasRequiredUtil=1;var nt=util$2.exports=requireMinimal(),_=roots,tt,ot;nt.codegen=codegen_1,nt.fetch=fetch_1,nt.path=path,nt.fs=nt.inquire("fs"),nt.toArray=function(ft){if(ft){for(var gt=Object.keys(ft),Et=new Array(gt.length),yt=0;yt<gt.length;)Et[yt]=ft[gt[yt++]];return Et}return[]},nt.toObject=function(ft){for(var gt={},Et=0;Et<ft.length;){var yt=ft[Et++],Ct=ft[Et++];Ct!==void 0&&(gt[yt]=Ct)}return gt};var st=/\\/g,at=/"/g;nt.isReserved=function(ft){return/^(?:do|if|in|for|let|new|try|var|case|else|enum|eval|false|null|this|true|void|with|break|catch|class|const|super|throw|while|yield|delete|export|import|public|return|static|switch|typeof|default|extends|finally|package|private|continue|debugger|function|arguments|interface|protected|implements|instanceof)$/.test(ft)},nt.safeProp=function(ft){return!/^[$\w_]+$/.test(ft)||nt.isReserved(ft)?'["'+ft.replace(st,"\\\\").replace(at,'\\"')+'"]':"."+ft},nt.ucFirst=function(ft){return ft.charAt(0).toUpperCase()+ft.substring(1)};var lt=/_([a-z])/g;nt.camelCase=function(ft){return ft.substring(0,1)+ft.substring(1).replace(lt,function(gt,Et){return Et.toUpperCase()})},nt.compareFieldsById=function(ft,gt){return ft.id-gt.id},nt.decorateType=function(ft,gt){if(ft.$type)return gt&&ft.$type.name!==gt&&(nt.decorateRoot.remove(ft.$type),ft.$type.name=gt,nt.decorateRoot.add(ft.$type)),ft.$type;tt||(tt=requireType());var Et=new tt(gt||ft.name);return nt.decorateRoot.add(Et),Et.ctor=ft,Object.defineProperty(ft,"$type",{value:Et,enumerable:!1}),Object.defineProperty(ft.prototype,"$type",{value:Et,enumerable:!1}),Et};var dt=0;return nt.decorateEnum=function(ft){if(ft.$type)return ft.$type;ot||(ot=require_enum());var gt=new ot("Enum"+dt++,ft);return nt.decorateRoot.add(gt),Object.defineProperty(ft,"$type",{value:gt,enumerable:!1}),gt},nt.setProperty=function(ft,gt,Et,yt){function Ct(wt,It,Pt){var Rt=It.shift();if(Rt==="__proto__"||Rt==="prototype")return wt;if(It.length>0)wt[Rt]=Ct(wt[Rt]||{},It,Pt);else{var xt=wt[Rt];if(xt&&yt)return wt;xt&&(Pt=[].concat(xt).concat(Pt)),wt[Rt]=Pt}return wt}if(typeof ft!="object")throw TypeError("dst must be an object");if(!gt)throw TypeError("path must be specified");return gt=gt.split("."),Ct(ft,gt,Et)},Object.defineProperty(nt,"decorateRoot",{get:function(){return _.decorated||(_.decorated=new(requireRoot()))}}),util$2.exports}var hasRequiredTypes;function requireTypes(){return hasRequiredTypes||(hasRequiredTypes=1,function(nt){var _=nt,tt=requireUtil(),ot=["double","float","int32","uint32","sint32","fixed32","sfixed32","int64","uint64","sint64","fixed64","sfixed64","bool","string","bytes"];function st(at,lt){var dt=0,ht={};for(lt|=0;dt<at.length;)ht[ot[dt+lt]]=at[dt++];return ht}_.basic=st([1,5,0,0,0,5,5,0,0,0,1,1,0,2,2]),_.defaults=st([0,0,0,0,0,0,0,0,0,0,0,0,!1,"",tt.emptyArray,null]),_.long=st([0,0,0,1,1],7),_.mapKey=st([0,0,0,5,5,0,0,0,1,1,0,2],2),_.packed=st([1,5,0,0,0,5,5,0,0,0,1,1,0])}(types$1)),types$1}var field,hasRequiredField;function requireField(){if(hasRequiredField)return field;hasRequiredField=1,field=lt;var nt=requireObject();((lt.prototype=Object.create(nt.prototype)).constructor=lt).className="Field";var _=require_enum(),tt=requireTypes(),ot=requireUtil(),st,at=/^required|optional|repeated$/;lt.fromJSON=function(ht,ft){var gt=new lt(ht,ft.id,ft.type,ft.rule,ft.extend,ft.options,ft.comment);return ft.edition&&(gt._edition=ft.edition),gt._defaultEdition="proto3",gt};function lt(dt,ht,ft,gt,Et,yt,Ct){if(ot.isObject(gt)?(Ct=Et,yt=gt,gt=Et=void 0):ot.isObject(Et)&&(Ct=yt,yt=Et,Et=void 0),nt.call(this,dt,yt),!ot.isInteger(ht)||ht<0)throw TypeError("id must be a non-negative integer");if(!ot.isString(ft))throw TypeError("type must be a string");if(gt!==void 0&&!at.test(gt=gt.toString().toLowerCase()))throw TypeError("rule must be a string rule");if(Et!==void 0&&!ot.isString(Et))throw TypeError("extend must be a string");gt==="proto3_optional"&&(gt="optional"),this.rule=gt&&gt!=="optional"?gt:void 0,this.type=ft,this.id=ht,this.extend=Et||void 0,this.repeated=gt==="repeated",this.map=!1,this.message=null,this.partOf=null,this.typeDefault=null,this.defaultValue=null,this.long=ot.Long?tt.long[ft]!==void 0:!1,this.bytes=ft==="bytes",this.resolvedType=null,this.extensionField=null,this.declaringField=null,this.comment=Ct}return Object.defineProperty(lt.prototype,"required",{get:function(){return this._features.field_presence==="LEGACY_REQUIRED"}}),Object.defineProperty(lt.prototype,"optional",{get:function(){return!this.required}}),Object.defineProperty(lt.prototype,"delimited",{get:function(){return this.resolvedType instanceof st&&this._features.message_encoding==="DELIMITED"}}),Object.defineProperty(lt.prototype,"packed",{get:function(){return this._features.repeated_field_encoding==="PACKED"}}),Object.defineProperty(lt.prototype,"hasPresence",{get:function(){return this.repeated||this.map?!1:this.partOf||this.declaringField||this.extensionField||this._features.field_presence!=="IMPLICIT"}}),lt.prototype.setOption=function(ht,ft,gt){return nt.prototype.setOption.call(this,ht,ft,gt)},lt.prototype.toJSON=function(ht){var ft=ht?!!ht.keepComments:!1;return ot.toObject(["edition",this._editionToJSON(),"rule",this.rule!=="optional"&&this.rule||void 0,"type",this.type,"id",this.id,"extend",this.extend,"options",this.options,"comment",ft?this.comment:void 0])},lt.prototype.resolve=function(){if(this.resolved)return this;if((this.typeDefault=tt.defaults[this.type])===void 0?(this.resolvedType=(this.declaringField?this.declaringField.parent:this.parent).lookupTypeOrEnum(this.type),this.resolvedType instanceof st?this.typeDefault=null:this.typeDefault=this.resolvedType.values[Object.keys(this.resolvedType.values)[0]]):this.options&&this.options.proto3_optional&&(this.typeDefault=null),this.options&&this.options.default!=null&&(this.typeDefault=this.options.default,this.resolvedType instanceof _&&typeof this.typeDefault=="string"&&(this.typeDefault=this.resolvedType.values[this.typeDefault])),this.options&&(this.options.packed!==void 0&&this.resolvedType&&!(this.resolvedType instanceof _)&&delete this.options.packed,Object.keys(this.options).length||(this.options=void 0)),this.long)this.typeDefault=ot.Long.fromNumber(this.typeDefault,this.type.charAt(0)==="u"),Object.freeze&&Object.freeze(this.typeDefault);else if(this.bytes&&typeof this.typeDefault=="string"){var ht;ot.base64.test(this.typeDefault)?ot.base64.decode(this.typeDefault,ht=ot.newBuffer(ot.base64.length(this.typeDefault)),0):ot.utf8.write(this.typeDefault,ht=ot.newBuffer(ot.utf8.length(this.typeDefault)),0),this.typeDefault=ht}return this.map?this.defaultValue=ot.emptyObject:this.repeated?this.defaultValue=ot.emptyArray:this.defaultValue=this.typeDefault,this.parent instanceof st&&(this.parent.ctor.prototype[this.name]=this.defaultValue),nt.prototype.resolve.call(this)},lt.prototype._inferLegacyProtoFeatures=function(ht){if(ht!=="proto2"&&ht!=="proto3")return{};var ft={};if(this.rule==="required"&&(ft.field_presence="LEGACY_REQUIRED"),this.parent&&tt.defaults[this.type]===void 0){var gt=this.parent.get(this.type.split(".").pop());gt&&gt instanceof st&&gt.group&&(ft.message_encoding="DELIMITED")}return this.getOption("packed")===!0?ft.repeated_field_encoding="PACKED":this.getOption("packed")===!1&&(ft.repeated_field_encoding="EXPANDED"),ft},lt.prototype._resolveFeatures=function(ht){return nt.prototype._resolveFeatures.call(this,this._edition||ht)},lt.d=function(ht,ft,gt,Et){return typeof ft=="function"?ft=ot.decorateType(ft).name:ft&&typeof ft=="object"&&(ft=ot.decorateEnum(ft).name),function(Ct,wt){ot.decorateType(Ct.constructor).add(new lt(wt,ht,ft,gt,{default:Et}))}},lt._configure=function(ht){st=ht},field}var oneof,hasRequiredOneof;function requireOneof(){if(hasRequiredOneof)return oneof;hasRequiredOneof=1,oneof=ot;var nt=requireObject();((ot.prototype=Object.create(nt.prototype)).constructor=ot).className="OneOf";var _=requireField(),tt=requireUtil();function ot(at,lt,dt,ht){if(Array.isArray(lt)||(dt=lt,lt=void 0),nt.call(this,at,dt),!(lt===void 0||Array.isArray(lt)))throw TypeError("fieldNames must be an Array");this.oneof=lt||[],this.fieldsArray=[],this.comment=ht}ot.fromJSON=function(lt,dt){return new ot(lt,dt.oneof,dt.options,dt.comment)},ot.prototype.toJSON=function(lt){var dt=lt?!!lt.keepComments:!1;return tt.toObject(["options",this.options,"oneof",this.oneof,"comment",dt?this.comment:void 0])};function st(at){if(at.parent)for(var lt=0;lt<at.fieldsArray.length;++lt)at.fieldsArray[lt].parent||at.parent.add(at.fieldsArray[lt])}return ot.prototype.add=function(lt){if(!(lt instanceof _))throw TypeError("field must be a Field");return lt.parent&&lt.parent!==this.parent&&lt.parent.remove(lt),this.oneof.push(lt.name),this.fieldsArray.push(lt),lt.partOf=this,st(this),this},ot.prototype.remove=function(lt){if(!(lt instanceof _))throw TypeError("field must be a Field");var dt=this.fieldsArray.indexOf(lt);if(dt<0)throw Error(lt+" is not a member of "+this);return this.fieldsArray.splice(dt,1),dt=this.oneof.indexOf(lt.name),dt>-1&&this.oneof.splice(dt,1),lt.partOf=null,this},ot.prototype.onAdd=function(lt){nt.prototype.onAdd.call(this,lt);for(var dt=this,ht=0;ht<this.oneof.length;++ht){var ft=lt.get(this.oneof[ht]);ft&&!ft.partOf&&(ft.partOf=dt,dt.fieldsArray.push(ft))}st(this)},ot.prototype.onRemove=function(lt){for(var dt=0,ht;dt<this.fieldsArray.length;++dt)(ht=this.fieldsArray[dt]).parent&&ht.parent.remove(ht);nt.prototype.onRemove.call(this,lt)},Object.defineProperty(ot.prototype,"isProto3Optional",{get:function(){if(this.fieldsArray==null||this.fieldsArray.length!==1)return!1;var at=this.fieldsArray[0];return at.options!=null&&at.options.proto3_optional===!0}}),ot.d=function(){for(var lt=new Array(arguments.length),dt=0;dt<arguments.length;)lt[dt]=arguments[dt++];return function(ft,gt){tt.decorateType(ft.constructor).add(new ot(gt,lt)),Object.defineProperty(ft,gt,{get:tt.oneOfGetter(lt),set:tt.oneOfSetter(lt)})}},oneof}var object,hasRequiredObject;function requireObject(){if(hasRequiredObject)return object;hasRequiredObject=1,object=lt,lt.className="ReflectionObject";const nt=requireOneof();var _=requireUtil(),tt,ot={enum_type:"OPEN",field_presence:"EXPLICIT",json_format:"ALLOW",message_encoding:"LENGTH_PREFIXED",repeated_field_encoding:"PACKED",utf8_validation:"VERIFY"},st={enum_type:"CLOSED",field_presence:"EXPLICIT",json_format:"LEGACY_BEST_EFFORT",message_encoding:"LENGTH_PREFIXED",repeated_field_encoding:"EXPANDED",utf8_validation:"NONE"},at={enum_type:"OPEN",field_presence:"IMPLICIT",json_format:"ALLOW",message_encoding:"LENGTH_PREFIXED",repeated_field_encoding:"PACKED",utf8_validation:"VERIFY"};function lt(dt,ht){if(!_.isString(dt))throw TypeError("name must be a string");if(ht&&!_.isObject(ht))throw TypeError("options must be an object");this.options=ht,this.parsedOptions=null,this.name=dt,this._edition=null,this._defaultEdition="proto2",this._features={},this._featuresResolved=!1,this.parent=null,this.resolved=!1,this.comment=null,this.filename=null}return Object.defineProperties(lt.prototype,{root:{get:function(){for(var dt=this;dt.parent!==null;)dt=dt.parent;return dt}},fullName:{get:function(){for(var dt=[this.name],ht=this.parent;ht;)dt.unshift(ht.name),ht=ht.parent;return dt.join(".")}}}),lt.prototype.toJSON=function(){throw Error()},lt.prototype.onAdd=function(ht){this.parent&&this.parent!==ht&&this.parent.remove(this),this.parent=ht,this.resolved=!1;var ft=ht.root;ft instanceof tt&&ft._handleAdd(this)},lt.prototype.onRemove=function(ht){var ft=ht.root;ft instanceof tt&&ft._handleRemove(this),this.parent=null,this.resolved=!1},lt.prototype.resolve=function(){return this.resolved?this:(this.root instanceof tt&&(this.resolved=!0),this)},lt.prototype._resolveFeaturesRecursive=function(ht){return this._resolveFeatures(this._edition||ht)},lt.prototype._resolveFeatures=function(ht){if(!this._featuresResolved){var ft={};if(!ht)throw new Error("Unknown edition for "+this.fullName);var gt=Object.assign(this.options?Object.assign({},this.options.features):{},this._inferLegacyProtoFeatures(ht));if(this._edition){if(ht==="proto2")ft=Object.assign({},st);else if(ht==="proto3")ft=Object.assign({},at);else if(ht==="2023")ft=Object.assign({},ot);else throw new Error("Unknown edition: "+ht);this._features=Object.assign(ft,gt||{}),this._featuresResolved=!0;return}if(this.partOf instanceof nt){var Et=Object.assign({},this.partOf._features);this._features=Object.assign(Et,gt||{})}else if(!this.declaringField)if(this.parent){var yt=Object.assign({},this.parent._features);this._features=Object.assign(yt,gt||{})}else throw new Error("Unable to find a parent for "+this.fullName);this.extensionField&&(this.extensionField._features=this._features),this._featuresResolved=!0}},lt.prototype._inferLegacyProtoFeatures=function(){return{}},lt.prototype.getOption=function(ht){if(this.options)return this.options[ht]},lt.prototype.setOption=function(ht,ft,gt){return this.options||(this.options={}),/^features\./.test(ht)?_.setProperty(this.options,ht,ft,gt):(!gt||this.options[ht]===void 0)&&(this.getOption(ht)!==ft&&(this.resolved=!1),this.options[ht]=ft),this},lt.prototype.setParsedOption=function(ht,ft,gt){this.parsedOptions||(this.parsedOptions=[]);var Et=this.parsedOptions;if(gt){var yt=Et.find(function(It){return Object.prototype.hasOwnProperty.call(It,ht)});if(yt){var Ct=yt[ht];_.setProperty(Ct,gt,ft)}else yt={},yt[ht]=_.setProperty({},gt,ft),Et.push(yt)}else{var wt={};wt[ht]=ft,Et.push(wt)}return this},lt.prototype.setOptions=function(ht,ft){if(ht)for(var gt=Object.keys(ht),Et=0;Et<gt.length;++Et)this.setOption(gt[Et],ht[gt[Et]],ft);return this},lt.prototype.toString=function(){var ht=this.constructor.className,ft=this.fullName;return ft.length?ht+" "+ft:ht},lt.prototype._editionToJSON=function(){if(!(!this._edition||this._edition==="proto3"))return this._edition},lt._configure=function(dt){tt=dt},object}var _enum,hasRequired_enum;function require_enum(){if(hasRequired_enum)return _enum;hasRequired_enum=1,_enum=ot;var nt=requireObject();((ot.prototype=Object.create(nt.prototype)).constructor=ot).className="Enum";var _=requireNamespace(),tt=requireUtil();function ot(st,at,lt,dt,ht,ft){if(nt.call(this,st,lt),at&&typeof at!="object")throw TypeError("values must be an object");if(this.valuesById={},this.values=Object.create(this.valuesById),this.comment=dt,this.comments=ht||{},this.valuesOptions=ft,this._valuesFeatures={},this.reserved=void 0,at)for(var gt=Object.keys(at),Et=0;Et<gt.length;++Et)typeof at[gt[Et]]=="number"&&(this.valuesById[this.values[gt[Et]]=at[gt[Et]]]=gt[Et])}return ot.prototype._resolveFeatures=function(at){return at=this._edition||at,nt.prototype._resolveFeatures.call(this,at),Object.keys(this.values).forEach(lt=>{var dt=Object.assign({},this._features);this._valuesFeatures[lt]=Object.assign(dt,this.valuesOptions&&this.valuesOptions[lt]&&this.valuesOptions[lt].features)}),this},ot.fromJSON=function(at,lt){var dt=new ot(at,lt.values,lt.options,lt.comment,lt.comments);return dt.reserved=lt.reserved,lt.edition&&(dt._edition=lt.edition),dt._defaultEdition="proto3",dt},ot.prototype.toJSON=function(at){var lt=at?!!at.keepComments:!1;return tt.toObject(["edition",this._editionToJSON(),"options",this.options,"valuesOptions",this.valuesOptions,"values",this.values,"reserved",this.reserved&&this.reserved.length?this.reserved:void 0,"comment",lt?this.comment:void 0,"comments",lt?this.comments:void 0])},ot.prototype.add=function(at,lt,dt,ht){if(!tt.isString(at))throw TypeError("name must be a string");if(!tt.isInteger(lt))throw TypeError("id must be an integer");if(this.values[at]!==void 0)throw Error("duplicate name '"+at+"' in "+this);if(this.isReservedId(lt))throw Error("id "+lt+" is reserved in "+this);if(this.isReservedName(at))throw Error("name '"+at+"' is reserved in "+this);if(this.valuesById[lt]!==void 0){if(!(this.options&&this.options.allow_alias))throw Error("duplicate id "+lt+" in "+this);this.values[at]=lt}else this.valuesById[this.values[at]=lt]=at;return ht&&(this.valuesOptions===void 0&&(this.valuesOptions={}),this.valuesOptions[at]=ht||null),this.comments[at]=dt||null,this},ot.prototype.remove=function(at){if(!tt.isString(at))throw TypeError("name must be a string");var lt=this.values[at];if(lt==null)throw Error("name '"+at+"' does not exist in "+this);return delete this.valuesById[lt],delete this.values[at],delete this.comments[at],this.valuesOptions&&delete this.valuesOptions[at],this},ot.prototype.isReservedId=function(at){return _.isReservedId(this.reserved,at)},ot.prototype.isReservedName=function(at){return _.isReservedName(this.reserved,at)},_enum}var encoder_1,hasRequiredEncoder;function requireEncoder(){if(hasRequiredEncoder)return encoder_1;hasRequiredEncoder=1,encoder_1=st;var nt=require_enum(),_=requireTypes(),tt=requireUtil();function ot(at,lt,dt,ht){return lt.delimited?at("types[%i].encode(%s,w.uint32(%i)).uint32(%i)",dt,ht,(lt.id<<3|3)>>>0,(lt.id<<3|4)>>>0):at("types[%i].encode(%s,w.uint32(%i).fork()).ldelim()",dt,ht,(lt.id<<3|2)>>>0)}function st(at){for(var lt=tt.codegen(["m","w"],at.name+"$encode")("if(!w)")("w=Writer.create()"),dt,ht,ft=at.fieldsArray.slice().sort(tt.compareFieldsById),dt=0;dt<ft.length;++dt){var gt=ft[dt].resolve(),Et=at._fieldsArray.indexOf(gt),yt=gt.resolvedType instanceof nt?"int32":gt.type,Ct=_.basic[yt];ht="m"+tt.safeProp(gt.name),gt.map?(lt("if(%s!=null&&Object.hasOwnProperty.call(m,%j)){",ht,gt.name)("for(var ks=Object.keys(%s),i=0;i<ks.length;++i){",ht)("w.uint32(%i).fork().uint32(%i).%s(ks[i])",(gt.id<<3|2)>>>0,8|_.mapKey[gt.keyType],gt.keyType),Ct===void 0?lt("types[%i].encode(%s[ks[i]],w.uint32(18).fork()).ldelim().ldelim()",Et,ht):lt(".uint32(%i).%s(%s[ks[i]]).ldelim()",16|Ct,yt,ht),lt("}")("}")):gt.repeated?(lt("if(%s!=null&&%s.length){",ht,ht),gt.packed&&_.packed[yt]!==void 0?lt("w.uint32(%i).fork()",(gt.id<<3|2)>>>0)("for(var i=0;i<%s.length;++i)",ht)("w.%s(%s[i])",yt,ht)("w.ldelim()"):(lt("for(var i=0;i<%s.length;++i)",ht),Ct===void 0?ot(lt,gt,Et,ht+"[i]"):lt("w.uint32(%i).%s(%s[i])",(gt.id<<3|Ct)>>>0,yt,ht)),lt("}")):(gt.optional&&lt("if(%s!=null&&Object.hasOwnProperty.call(m,%j))",ht,gt.name),Ct===void 0?ot(lt,gt,Et,ht):lt("w.uint32(%i).%s(%s)",(gt.id<<3|Ct)>>>0,yt,ht))}return lt("return w")}return encoder_1}var protobuf$2=indexLight.exports=indexMinimal;protobuf$2.build="light";function load(nt,_,tt){return typeof _=="function"?(tt=_,_=new protobuf$2.Root):_||(_=new protobuf$2.Root),_.load(nt,tt)}protobuf$2.load=load;function loadSync(nt,_){return _||(_=new protobuf$2.Root),_.loadSync(nt)}protobuf$2.loadSync=loadSync;protobuf$2.encoder=requireEncoder();protobuf$2.decoder=requireDecoder();protobuf$2.verifier=requireVerifier();protobuf$2.converter=requireConverter();protobuf$2.ReflectionObject=requireObject();protobuf$2.Namespace=requireNamespace();protobuf$2.Root=requireRoot();protobuf$2.Enum=require_enum();protobuf$2.Type=requireType();protobuf$2.Field=requireField();protobuf$2.OneOf=requireOneof();protobuf$2.MapField=requireMapfield();protobuf$2.Service=requireService();protobuf$2.Method=requireMethod();protobuf$2.Message=message;protobuf$2.wrappers=wrappers;protobuf$2.types=requireTypes();protobuf$2.util=requireUtil();protobuf$2.ReflectionObject._configure(protobuf$2.Root);protobuf$2.Namespace._configure(protobuf$2.Type,protobuf$2.Service,protobuf$2.Enum);protobuf$2.Root._configure(protobuf$2.Type);protobuf$2.Field._configure(protobuf$2.Type);var indexLightExports=indexLight.exports,tokenize_1=tokenize$1,delimRe=/[\s{}=;:[\],'"()<>]/g,stringDoubleRe=/(?:"([^"\\]*(?:\\.[^"\\]*)*)")/g,stringSingleRe=/(?:'([^'\\]*(?:\\.[^'\\]*)*)')/g,setCommentRe=/^ *[*/]+ */,setCommentAltRe=/^\s*\*?\/*/,setCommentSplitRe=/\n/g,whitespaceRe=/\s/,unescapeRe=/\\(.?)/g,unescapeMap={0:"\0",r:"\r",n:`
`,t:"	"};function unescape$1(nt){return nt.replace(unescapeRe,function(_,tt){switch(tt){case"\\":case"":return tt;default:return unescapeMap[tt]||""}})}tokenize$1.unescape=unescape$1;function tokenize$1(nt,_){nt=nt.toString();var tt=0,ot=nt.length,st=1,at=0,lt={},dt=[],ht=null;function ft(kt){return Error("illegal "+kt+" (line "+st+")")}function gt(){var kt=ht==="'"?stringSingleRe:stringDoubleRe;kt.lastIndex=tt-1;var Vt=kt.exec(nt);if(!Vt)throw ft("string");return tt=kt.lastIndex,Pt(ht),ht=null,unescape$1(Vt[1])}function Et(kt){return nt.charAt(kt)}function yt(kt,Vt,Ft){var zt={type:nt.charAt(kt++),lineEmpty:!1,leading:Ft},Yt;_?Yt=2:Yt=3;var Kt=kt-Yt,qt;do if(--Kt<0||(qt=nt.charAt(Kt))===`
`){zt.lineEmpty=!0;break}while(qt===" "||qt==="	");for(var pn=nt.substring(kt,Vt).split(setCommentSplitRe),an=0;an<pn.length;++an)pn[an]=pn[an].replace(_?setCommentAltRe:setCommentRe,"").trim();zt.text=pn.join(`
`).trim(),lt[st]=zt,at=st}function Ct(kt){var Vt=wt(kt),Ft=nt.substring(kt,Vt),zt=/^\s*\/\//.test(Ft);return zt}function wt(kt){for(var Vt=kt;Vt<ot&&Et(Vt)!==`
`;)Vt++;return Vt}function It(){if(dt.length>0)return dt.shift();if(ht)return gt();var kt,Vt,Ft,zt,Yt,Kt=tt===0;do{if(tt===ot)return null;for(kt=!1;whitespaceRe.test(Ft=Et(tt));)if(Ft===`
`&&(Kt=!0,++st),++tt===ot)return null;if(Et(tt)==="/"){if(++tt===ot)throw ft("comment");if(Et(tt)==="/")if(_){if(zt=tt,Yt=!1,Ct(tt-1)){Yt=!0;do if(tt=wt(tt),tt===ot||(tt++,!Kt))break;while(Ct(tt))}else tt=Math.min(ot,wt(tt)+1);Yt&&(yt(zt,tt,Kt),Kt=!0),st++,kt=!0}else{for(Yt=Et(zt=tt+1)==="/";Et(++tt)!==`
`;)if(tt===ot)return null;++tt,Yt&&(yt(zt,tt-1,Kt),Kt=!0),++st,kt=!0}else if((Ft=Et(tt))==="*"){zt=tt+1,Yt=_||Et(zt)==="*";do{if(Ft===`
`&&++st,++tt===ot)throw ft("comment");Vt=Ft,Ft=Et(tt)}while(Vt!=="*"||Ft!=="/");++tt,Yt&&(yt(zt,tt-2,Kt),Kt=!0),kt=!0}else return"/"}}while(kt);var qt=tt;delimRe.lastIndex=0;var pn=delimRe.test(Et(qt++));if(!pn)for(;qt<ot&&!delimRe.test(Et(qt));)++qt;var an=nt.substring(tt,tt=qt);return(an==='"'||an==="'")&&(ht=an),an}function Pt(kt){dt.push(kt)}function Rt(){if(!dt.length){var kt=It();if(kt===null)return null;Pt(kt)}return dt[0]}function xt(kt,Vt){var Ft=Rt(),zt=Ft===kt;if(zt)return It(),!0;if(!Vt)throw ft("token '"+Ft+"', '"+kt+"' expected");return!1}function Nt(kt){var Vt=null,Ft;return kt===void 0?(Ft=lt[st-1],delete lt[st-1],Ft&&(_||Ft.type==="*"||Ft.lineEmpty)&&(Vt=Ft.leading?Ft.text:null)):(at<kt&&Rt(),Ft=lt[kt],delete lt[kt],Ft&&!Ft.lineEmpty&&(_||Ft.type==="/")&&(Vt=Ft.leading?null:Ft.text)),Vt}return Object.defineProperty({next:It,peek:Rt,push:Pt,skip:xt,cmnt:Nt},"line",{get:function(){return st}})}var parse_1=parse;parse.filename=null;parse.defaults={keepCase:!1};var tokenize=tokenize_1,Root=requireRoot(),Type=requireType(),Field=requireField(),MapField=requireMapfield(),OneOf=requireOneof(),Enum=require_enum(),Service=requireService(),Method=requireMethod(),ReflectionObject=requireObject(),types=requireTypes(),util=requireUtil(),base10Re=/^[1-9][0-9]*$/,base10NegRe=/^-?[1-9][0-9]*$/,base16Re=/^0[x][0-9a-fA-F]+$/,base16NegRe=/^-?0[x][0-9a-fA-F]+$/,base8Re=/^0[0-7]+$/,base8NegRe=/^-?0[0-7]+$/,numberRe=/^(?![eE])[0-9]*(?:\.[0-9]*)?(?:[eE][+-]?[0-9]+)?$/,nameRe=/^[a-zA-Z_][a-zA-Z_0-9]*$/,typeRefRe=/^(?:\.?[a-zA-Z_][a-zA-Z_0-9]*)(?:\.[a-zA-Z_][a-zA-Z_0-9]*)*$/;function parse(nt,_,tt){_ instanceof Root||(tt=_,_=new Root),tt||(tt=parse.defaults);var ot=tt.preferTrailingComment||!1,st=tokenize(nt,tt.alternateCommentMode||!1),at=st.next,lt=st.push,dt=st.peek,ht=st.skip,ft=st.cmnt,gt=!0,Et,yt,Ct,wt="proto2",It=_,Pt=[],Rt={},xt=tt.keepCase?function(Zt){return Zt}:util.camelCase;function Nt(){Pt.forEach(Zt=>{Zt._edition=wt,Object.keys(Rt).forEach(wn=>{Zt.getOption(wn)===void 0&&Zt.setOption(wn,Rt[wn],!0)})})}function kt(Zt,wn,xn){var Hn=parse.filename;return xn||(parse.filename=null),Error("illegal "+(wn||"token")+" '"+Zt+"' ("+(Hn?Hn+", ":"")+"line "+st.line+")")}function Vt(){var Zt=[],wn;do{if((wn=at())!=='"'&&wn!=="'")throw kt(wn);Zt.push(at()),ht(wn),wn=dt()}while(wn==='"'||wn==="'");return Zt.join("")}function Ft(Zt){var wn=at();switch(wn){case"'":case'"':return lt(wn),Vt();case"true":case"TRUE":return!0;case"false":case"FALSE":return!1}try{return Yt(wn,!0)}catch{if(Zt&&typeRefRe.test(wn))return wn;throw kt(wn,"value")}}function zt(Zt,wn){var xn,Hn;do if(wn&&((xn=dt())==='"'||xn==="'")){var Bn=Vt();if(Zt.push(Bn),wt>=2023)throw kt(Bn,"id")}else try{Zt.push([Hn=Kt(at()),ht("to",!0)?Kt(at()):Hn])}catch(Wn){if(wn&&typeRefRe.test(xn)&&wt>=2023)Zt.push(xn);else throw Wn}while(ht(",",!0));var cr={options:void 0};cr.setOption=function(Wn,rr){this.options===void 0&&(this.options={}),this.options[Wn]=rr},Cn(cr,function(rr){if(rr==="option")Rn(cr,rr),ht(";");else throw kt(rr)},function(){Gn(cr)})}function Yt(Zt,wn){var xn=1;switch(Zt.charAt(0)==="-"&&(xn=-1,Zt=Zt.substring(1)),Zt){case"inf":case"INF":case"Inf":return xn*(1/0);case"nan":case"NAN":case"Nan":case"NaN":return NaN;case"0":return 0}if(base10Re.test(Zt))return xn*parseInt(Zt,10);if(base16Re.test(Zt))return xn*parseInt(Zt,16);if(base8Re.test(Zt))return xn*parseInt(Zt,8);if(numberRe.test(Zt))return xn*parseFloat(Zt);throw kt(Zt,"number",wn)}function Kt(Zt,wn){switch(Zt){case"max":case"MAX":case"Max":return 536870911;case"0":return 0}if(!wn&&Zt.charAt(0)==="-")throw kt(Zt,"id");if(base10NegRe.test(Zt))return parseInt(Zt,10);if(base16NegRe.test(Zt))return parseInt(Zt,16);if(base8NegRe.test(Zt))return parseInt(Zt,8);throw kt(Zt,"id")}function qt(){if(Et!==void 0)throw kt("package");if(Et=at(),!typeRefRe.test(Et))throw kt(Et,"name");It=It.define(Et),ht(";")}function pn(){var Zt=dt(),wn;switch(Zt){case"weak":wn=Ct||(Ct=[]),at();break;case"public":at();default:wn=yt||(yt=[]);break}Zt=Vt(),ht(";"),wn.push(Zt)}function an(){if(ht("="),wt=Vt(),wt<2023)throw kt(wt,"syntax");ht(";")}function fn(){if(ht("="),wt=Vt(),!["2023"].includes(wt))throw kt(wt,"edition");ht(";")}function dn(Zt,wn){switch(wn){case"option":return Rn(Zt,wn),ht(";"),!0;case"message":return On(Zt,wn),!0;case"enum":return gn(Zt,wn),!0;case"service":return Vn(Zt,wn),!0;case"extend":return Tr(Zt,wn),!0}return!1}function Cn(Zt,wn,xn){var Hn=st.line;if(Zt&&(typeof Zt.comment!="string"&&(Zt.comment=ft()),Zt.filename=parse.filename),ht("{",!0)){for(var Bn;(Bn=at())!=="}";)wn(Bn);ht(";",!0)}else xn&&xn(),ht(";"),Zt&&(typeof Zt.comment!="string"||ot)&&(Zt.comment=ft(Hn)||Zt.comment)}function On(Zt,wn){if(!nameRe.test(wn=at()))throw kt(wn,"type name");var xn=new Type(wn);Cn(xn,function(Bn){if(!dn(xn,Bn))switch(Bn){case"map":An(xn);break;case"required":if(wt!=="proto2")throw kt(Bn);case"repeated":Pn(xn,Bn);break;case"optional":if(wt==="proto3")Pn(xn,"proto3_optional");else{if(wt!=="proto2")throw kt(Bn);Pn(xn,"optional")}break;case"oneof":Sn(xn,Bn);break;case"extensions":zt(xn.extensions||(xn.extensions=[]));break;case"reserved":zt(xn.reserved||(xn.reserved=[]),!0);break;default:if(wt==="proto2"||!typeRefRe.test(Bn))throw kt(Bn);lt(Bn),Pn(xn,"optional");break}}),Zt.add(xn),Zt===It&&Pt.push(xn)}function Pn(Zt,wn,xn){var Hn=at();if(Hn==="group"){yn(Zt,wn);return}for(;Hn.endsWith(".")||dt().startsWith(".");)Hn+=at();if(!typeRefRe.test(Hn))throw kt(Hn,"type");var Bn=at();if(!nameRe.test(Bn))throw kt(Bn,"name");Bn=xt(Bn),ht("=");var cr=new Field(Bn,Kt(at()),Hn,wn,xn);if(Cn(cr,function(sr){if(sr==="option")Rn(cr,sr),ht(";");else throw kt(sr)},function(){Gn(cr)}),wn==="proto3_optional"){var Wn=new OneOf("_"+Bn);cr.setOption("proto3_optional",!0),Wn.add(cr),Zt.add(Wn)}else Zt.add(cr);Zt===It&&Pt.push(cr)}function yn(Zt,wn){if(wt>=2023)throw kt("group");var xn=at();if(!nameRe.test(xn))throw kt(xn,"name");var Hn=util.lcFirst(xn);xn===Hn&&(xn=util.ucFirst(xn)),ht("=");var Bn=Kt(at()),cr=new Type(xn);cr.group=!0;var Wn=new Field(Hn,Bn,xn,wn);Wn.filename=parse.filename,Cn(cr,function(sr){switch(sr){case"option":Rn(cr,sr),ht(";");break;case"required":case"repeated":Pn(cr,sr);break;case"optional":wt==="proto3"?Pn(cr,"proto3_optional"):Pn(cr,"optional");break;case"message":On(cr,sr);break;case"enum":gn(cr,sr);break;case"reserved":zt(cr.reserved||(cr.reserved=[]),!0);break;default:throw kt(sr)}}),Zt.add(cr).add(Wn)}function An(Zt){ht("<");var wn=at();if(types.mapKey[wn]===void 0)throw kt(wn,"type");ht(",");var xn=at();if(!typeRefRe.test(xn))throw kt(xn,"type");ht(">");var Hn=at();if(!nameRe.test(Hn))throw kt(Hn,"name");ht("=");var Bn=new MapField(xt(Hn),Kt(at()),wn,xn);Cn(Bn,function(Wn){if(Wn==="option")Rn(Bn,Wn),ht(";");else throw kt(Wn)},function(){Gn(Bn)}),Zt.add(Bn)}function Sn(Zt,wn){if(!nameRe.test(wn=at()))throw kt(wn,"name");var xn=new OneOf(xt(wn));Cn(xn,function(Bn){Bn==="option"?(Rn(xn,Bn),ht(";")):(lt(Bn),Pn(xn,"optional"))}),Zt.add(xn)}function gn(Zt,wn){if(!nameRe.test(wn=at()))throw kt(wn,"name");var xn=new Enum(wn);Cn(xn,function(Bn){switch(Bn){case"option":Rn(xn,Bn),ht(";");break;case"reserved":zt(xn.reserved||(xn.reserved=[]),!0),xn.reserved===void 0&&(xn.reserved=[]);break;default:_n(xn,Bn)}}),Zt.add(xn),Zt===It&&Pt.push(xn)}function _n(Zt,wn){if(!nameRe.test(wn))throw kt(wn,"name");ht("=");var xn=Kt(at(),!0),Hn={options:void 0};Hn.getOption=function(Bn){return this.options[Bn]},Hn.setOption=function(Bn,cr){ReflectionObject.prototype.setOption.call(Hn,Bn,cr)},Hn.setParsedOption=function(){},Cn(Hn,function(cr){if(cr==="option")Rn(Hn,cr),ht(";");else throw kt(cr)},function(){Gn(Hn)}),Zt.add(wn,xn,Hn.comment,Hn.parsedOptions||Hn.options)}function Rn(Zt,wn){var xn,Hn,Bn=!0;for(wn==="option"&&(wn=at());wn!=="=";){if(wn==="("){var cr=at();ht(")"),wn="("+cr+")"}if(Bn){if(Bn=!1,wn.includes(".")&&!wn.includes("(")){var Wn=wn.split(".");xn=Wn[0]+".",wn=Wn[1];continue}xn=wn}else Hn=Hn?Hn+=wn:wn;wn=at()}var rr=Hn?xn.concat(Hn):xn,sr=bn(Zt,rr);Hn=Hn&&Hn[0]==="."?Hn.slice(1):Hn,xn=xn&&xn[xn.length-1]==="."?xn.slice(0,-1):xn,kn(Zt,xn,sr,Hn)}function bn(Zt,wn){if(ht("{",!0)){for(var xn={};!ht("}",!0);){if(!nameRe.test(Mn=at()))throw kt(Mn,"name");if(Mn===null)throw kt(Mn,"end of input");var Hn,Bn=Mn;if(ht(":",!0),dt()==="{")Hn=bn(Zt,wn+"."+Mn);else if(dt()==="["){Hn=[];var cr;if(ht("[",!0)){do cr=Ft(!0),Hn.push(cr);while(ht(",",!0));ht("]"),typeof cr<"u"&&jn(Zt,wn+"."+Mn,cr)}}else Hn=Ft(!0),jn(Zt,wn+"."+Mn,Hn);var Wn=xn[Bn];Wn&&(Hn=[].concat(Wn).concat(Hn)),xn[Bn]=Hn,ht(",",!0),ht(";",!0)}return xn}var rr=Ft(!0);return jn(Zt,wn,rr),rr}function jn(Zt,wn,xn){if(It===Zt&&/^features\./.test(wn)){Rt[wn]=xn;return}Zt.setOption&&Zt.setOption(wn,xn)}function kn(Zt,wn,xn,Hn){Zt.setParsedOption&&Zt.setParsedOption(wn,xn,Hn)}function Gn(Zt){if(ht("[",!0)){do Rn(Zt,"option");while(ht(",",!0));ht("]")}return Zt}function Vn(Zt,wn){if(!nameRe.test(wn=at()))throw kt(wn,"service name");var xn=new Service(wn);Cn(xn,function(Bn){if(!dn(xn,Bn))if(Bn==="rpc")qn(xn,Bn);else throw kt(Bn)}),Zt.add(xn),Zt===It&&Pt.push(xn)}function qn(Zt,wn){var xn=ft(),Hn=wn;if(!nameRe.test(wn=at()))throw kt(wn,"name");var Bn=wn,cr,Wn,rr,sr;if(ht("("),ht("stream",!0)&&(Wn=!0),!typeRefRe.test(wn=at())||(cr=wn,ht(")"),ht("returns"),ht("("),ht("stream",!0)&&(sr=!0),!typeRefRe.test(wn=at())))throw kt(wn);rr=wn,ht(")");var ir=new Method(Bn,Hn,cr,rr,Wn,sr);ir.comment=xn,Cn(ir,function(un){if(un==="option")Rn(ir,un),ht(";");else throw kt(un)}),Zt.add(ir)}function Tr(Zt,wn){if(!typeRefRe.test(wn=at()))throw kt(wn,"reference");var xn=wn;Cn(null,function(Bn){switch(Bn){case"required":case"repeated":Pn(Zt,Bn,xn);break;case"optional":wt==="proto3"?Pn(Zt,"proto3_optional",xn):Pn(Zt,"optional",xn);break;default:if(wt==="proto2"||!typeRefRe.test(Bn))throw kt(Bn);lt(Bn),Pn(Zt,"optional",xn);break}})}for(var Mn;(Mn=at())!==null;)switch(Mn){case"package":if(!gt)throw kt(Mn);qt();break;case"import":if(!gt)throw kt(Mn);pn();break;case"syntax":if(!gt)throw kt(Mn);an();break;case"edition":if(!gt)throw kt(Mn);fn();break;case"option":Rn(It,Mn),ht(";",!0);break;default:if(dn(It,Mn)){gt=!1;continue}throw kt(Mn)}return Nt(),parse.filename=null,{package:Et,imports:yt,weakImports:Ct,root:_}}var common_1=common,commonRe=/\/|\./;function common(nt,_){commonRe.test(nt)||(nt="google/protobuf/"+nt+".proto",_={nested:{google:{nested:{protobuf:{nested:_}}}}}),common[nt]=_}common("any",{Any:{fields:{type_url:{type:"string",id:1},value:{type:"bytes",id:2}}}});var timeType;common("duration",{Duration:timeType={fields:{seconds:{type:"int64",id:1},nanos:{type:"int32",id:2}}}});common("timestamp",{Timestamp:timeType});common("empty",{Empty:{fields:{}}});common("struct",{Struct:{fields:{fields:{keyType:"string",type:"Value",id:1}}},Value:{oneofs:{kind:{oneof:["nullValue","numberValue","stringValue","boolValue","structValue","listValue"]}},fields:{nullValue:{type:"NullValue",id:1},numberValue:{type:"double",id:2},stringValue:{type:"string",id:3},boolValue:{type:"bool",id:4},structValue:{type:"Struct",id:5},listValue:{type:"ListValue",id:6}}},NullValue:{values:{NULL_VALUE:0}},ListValue:{fields:{values:{rule:"repeated",type:"Value",id:1}}}});common("wrappers",{DoubleValue:{fields:{value:{type:"double",id:1}}},FloatValue:{fields:{value:{type:"float",id:1}}},Int64Value:{fields:{value:{type:"int64",id:1}}},UInt64Value:{fields:{value:{type:"uint64",id:1}}},Int32Value:{fields:{value:{type:"int32",id:1}}},UInt32Value:{fields:{value:{type:"uint32",id:1}}},BoolValue:{fields:{value:{type:"bool",id:1}}},StringValue:{fields:{value:{type:"string",id:1}}},BytesValue:{fields:{value:{type:"bytes",id:1}}}});common("field_mask",{FieldMask:{fields:{paths:{rule:"repeated",type:"string",id:1}}}});common.get=function nt(_){return common[_]||null};var protobuf$1=src.exports=indexLightExports;protobuf$1.build="full";protobuf$1.tokenize=tokenize_1;protobuf$1.parse=parse_1;protobuf$1.common=common_1;protobuf$1.Root._configure(protobuf$1.Type,protobuf$1.parse,protobuf$1.common);var srcExports=src.exports,protobufjs=srcExports;const protobuf=getDefaultExportFromCjs(protobufjs),AgoraContext=reactExports.createContext();let protoRoot=null,SomeMessage=null;const loadProtoSchema=async()=>{if(!protoRoot)try{protoRoot=await protobuf.load("/agora-agent/schema.proto"),SomeMessage=protoRoot.lookupType("SomeMessage"),console.log(" Protobuf schema loaded successfully")}catch(nt){console.error(" Failed to load protobuf schema:",nt);const _=`
        syntax = "proto3";
        message SomeMessage {
          oneof data {
            Metadata metadata = 1;
            Words words = 2;
          }
        }
        message Metadata {
          string session_id = 1;
          string conversation_id = 2;
          string request_id = 3;
        }
        message Words {
          repeated Word words = 1;
        }
        message Word {
          string word = 1;
          double start = 2;
          double end = 3;
          float confidence = 4;
          bool speaker = 5;
        }
      `;protoRoot=protobuf.parse(_).root,SomeMessage=protoRoot.lookupType("SomeMessage"),console.log(" Protobuf schema loaded from inline definition")}return{protoRoot,SomeMessage}},getConfigValue=(nt,_=null)=>{const tt=sessionStorage.getItem(nt),ot={BASE_URL:"/RPM-agora-agent/",MODE:"production",DEV:!1,PROD:!0,SSR:!1}[nt];return tt||ot||_},getAgoraConfig=()=>({appId:getConfigValue("VITE_AGORA_APP_ID"),token:getConfigValue("VITE_AGORA_TOKEN"),channel:getConfigValue("VITE_AGORA_CHANNEL","AgoraAgent_Channel"),uid:null,convoAIUid:parseInt(getConfigValue("VITE_CONVOAI_AGENT_UID","8888"))}),getConvoAIConfig=()=>({baseUrl:getConfigValue("VITE_CONVOAI_API_BASE_URL","https://api.agora.io/api/conversational-ai-agent/v2"),apiKey:getConfigValue("VITE_RESTFUL_API_KEY"),password:getConfigValue("VITE_RESTFUL_PASSWORD"),agentUid:parseInt(getConfigValue("VITE_CONVOAI_AGENT_UID","8888")),agentName:getConfigValue("VITE_CONVOAI_AGENT_NAME","Agora Agent"),llmUrl:getConfigValue("VITE_LLM_URL","https://api.openai.com/v1/chat/completions"),llmApiKey:getConfigValue("VITE_LLM_API_KEY"),llmModel:getConfigValue("VITE_LLM_MODEL","gpt-4o-mini"),systemMessage:getConfigValue("VITE_LLM_SYSTEM_MESSAGE","You are a friendly Agora agent assistant."),greeting:getConfigValue("VITE_LLM_GREETING","Hello! I'm your Agora agent. How can I help you today?"),ttsApiKey:getConfigValue("VITE_TTS_API_KEY"),ttsRegion:getConfigValue("VITE_TTS_REGION","eastus"),ttsVoiceName:getConfigValue("VITE_TTS_VOICE_NAME","en-US-AriaNeural"),asrLanguage:getConfigValue("VITE_ASR_LANGUAGE","en-US")}),generateBasicAuthHeader=()=>{const nt=getConvoAIConfig(),_=nt.apiKey,tt=nt.password;if(!_||!tt||_.trim()===""||tt.trim()===""){console.error(" Missing ConvoAI credentials:",{apiKey:_?"SET":"MISSING",password:tt?"SET":"MISSING"}),console.log(" Trying fallback to old variable names...");const ot=getConfigValue("VITE_CONVOAI_API_KEY"),st=getConfigValue("VITE_CONVOAI_PASSWORD");return console.log(" Fallback credentials:",{fallbackApiKey:ot?"FOUND":"MISSING",fallbackPassword:st?"FOUND":"MISSING"}),ot&&st?(console.log(" Using fallback credentials from old variable names"),generateBasicAuthHeaderWithCredentials(ot,st)):null}return generateBasicAuthHeaderWithCredentials(_,tt)},generateBasicAuthHeaderWithCredentials=(nt,_)=>{if(["your-api-key","your-password","replace-with","enter-your","api-key-here","password-here","test-key","test-password","example","placeholder","change-me","update-me"].some(ft=>nt.toLowerCase().includes(ft)||_.toLowerCase().includes(ft)))return console.error(" Detected placeholder credentials. Please set real API key and password."),null;const st=nt.trim(),at=_.trim(),lt=`${st}:${at}`,ht=`Basic ${btoa(lt)}`;return console.log(" Auth header generated successfully"),ht},testBasicAuthCredentials=()=>{const nt=generateBasicAuthHeader();if(!nt)return console.error(" Cannot test - no auth header generated"),!1;const _=getConvoAIConfig();try{const tt=nt.replace("Basic ",""),ot=atob(tt),[st,at]=ot.split(":"),lt=st===_.apiKey.trim()&&at===_.password.trim();return console.log(" Basic Auth Test:",{authHeaderValid:nt.startsWith("Basic "),canDecode:!!ot,credentialsMatch:lt,decodedLength:ot.length,originalApiKeyLength:_.apiKey?_.apiKey.trim().length:0,originalPasswordLength:_.password?_.password.trim().length:0}),lt}catch(tt){return console.error(" Basic Auth Test Failed:",tt),!1}},AgoraProvider=({children:nt})=>{const[_,tt]=reactExports.useState(null),[ot,st]=reactExports.useState(null),[at,lt]=reactExports.useState([]),[dt,ht]=reactExports.useState(!1),[ft,gt]=reactExports.useState(!1),[Et,yt]=reactExports.useState(0),[Ct,wt]=reactExports.useState(null),[It,Pt]=reactExports.useState(null),[Rt,xt]=reactExports.useState(0),[Nt,kt]=reactExports.useState([]),[Vt,Ft]=reactExports.useState(new Set),[zt,Yt]=reactExports.useState(new Map),Kt=()=>`${Date.now()}-${Math.random().toString(36).substr(2,9)}`,qt=async(Rn,bn)=>{try{console.log(" Processing complete message:",Rn,"Length:",bn.length);const{SomeMessage:jn}=await loadProtoSchema();let kn;try{kn=new Uint8Array(bn.length);for(let Gn=0;Gn<bn.length;Gn++)kn[Gn]=bn.charCodeAt(Gn)&255;if(console.log(" Buffer created, length:",kn.length,"First few bytes:",Array.from(kn.slice(0,10))),kn.length===0)throw new Error("Empty buffer - no data to decode");if(kn.length>1e6)throw new Error(`Buffer too large: ${kn.length} bytes`)}catch(Gn){throw console.error(" Buffer creation failed:",Gn),new Error(`Buffer creation failed: ${Gn.message}`)}try{const Gn=bn.trim();if(Gn.startsWith("{")&&Gn.endsWith("}"))throw console.log(" Data appears to be JSON, skipping protobuf decode"),new Error("Data appears to be JSON format");const Vn=jn.decode(kn);if(console.log(" Protobuf decoded successfully:",Vn),Vn.words&&Vn.words.words){console.log(" Found Words message with",Vn.words.words.length,"words");const Tr=Vn.words.words.map(Mn=>({word:Mn.word,start:Mn.start,end:Mn.end,confidence:Mn.confidence,speaker:Mn.speaker?"user":"agent"})).filter(Mn=>Mn.word&&Mn.word.trim().length>0);if(Tr.length>0){const Mn=Tr.map(wn=>wn.word).join(" "),Zt=Tr.some(wn=>wn.speaker==="user")?"user":"agent";console.log(" Real-time transcript update:",Mn),an({id:Rn,timestamp:new Date,speaker:Zt,message:Mn.trim(),type:"transcript",words:Tr,raw:Vn})}}else Vn.metadata&&console.log(" Found Metadata message:",Vn.metadata)}catch(Gn){console.warn(" Protobuf decode failed, trying JSON fallback:",{error:Gn.message,bufferLength:kn.length,dataLength:bn.length,firstBytes:Array.from(kn.slice(0,20)),errorType:Gn.constructor.name});try{const Vn=JSON.parse(bn);if(console.log(" JSON decoded successfully:",Vn),Vn.object==="assistant.transcription"){console.log(" Processing assistant.transcription message");const qn=Vn.transcript||Vn.text||"",Tr=Vn.role==="user"?"user":"agent";let Mn=[];Vn.words&&Array.isArray(Vn.words)&&(Mn=Vn.words.map(Zt=>({word:Zt.word||Zt.text||Zt,start:Zt.start||Zt.start_time||0,end:Zt.end||Zt.end_time||0,confidence:Zt.confidence||1,speaker:Zt.speaker||Tr})).filter(Zt=>Zt.word&&Zt.word.trim().length>0)),(qn.trim()||Mn.length>0)&&(console.log(" Real-time transcript update from JSON:",qn),an({id:Rn,timestamp:new Date,speaker:Tr,message:qn.trim()||Mn.map(Zt=>Zt.word).join(" "),type:"transcript",words:Mn.length>0?Mn:null,raw:Vn}))}else console.log(" Filtering out non-assistant.transcription message:",Vn.object)}catch(Vn){console.warn(" Both protobuf and JSON decode failed:",{jsonError:Vn.message,dataSnippet:bn.substring(0,100)+"...",dataLength:bn.length,isPrintable:/^[\x20-\x7E]*$/.test(bn.substring(0,50))});const qn=bn.trim();qn.length>0&&qn.length<1e4&&(console.log(" Treating as plain text message"),an({id:Rn,timestamp:new Date,speaker:"agent",message:qn,type:"text",raw:{originalData:bn}}))}}Ft(Gn=>new Set([...Gn,Rn]))}catch(jn){console.error(" Error processing complete message:",jn)}},pn=async(Rn,bn)=>{try{const{SomeMessage:jn}=await loadProtoSchema(),kn=new Uint8Array(bn.length);for(let Gn=0;Gn<bn.length;Gn++)kn[Gn]=bn.charCodeAt(Gn);try{const Gn=jn.decode(kn);if(Gn.words&&Gn.words.words){const Vn=Gn.words.words.map(qn=>({word:qn.word,start:qn.start,end:qn.end,confidence:qn.confidence,speaker:qn.speaker?"user":"agent"})).filter(qn=>qn.word&&qn.word.trim().length>0);if(Vn.length>0){const qn=Vn.some(Tr=>Tr.speaker==="user")?"user":"agent";console.log(" Real-time partial update:",Vn.map(Tr=>Tr.word).join(" ")),an({id:Rn,timestamp:new Date,speaker:qn,message:Vn.map(Tr=>Tr.word).join(" ")+"...",type:"transcript",words:Vn,isPartial:!0,raw:Gn})}}}catch{console.log(" Partial decode failed (expected for incomplete data)")}}catch{}},an=Rn=>{kt(bn=>{const jn=bn.findIndex(kn=>kn.id===Rn.id);if(jn!==-1){console.log(" Updating existing message:",Rn.id);const kn=[...bn],Gn=kn[jn];let Vn=Gn.words||[];return Rn.words&&Rn.words.forEach(qn=>{const Tr=Vn.findIndex(Mn=>Math.abs(Mn.start-qn.start)<.01&&Mn.word===qn.word);Tr===-1?(Vn.push(qn),Vn.sort((Mn,Zt)=>Mn.start-Zt.start)):Vn[Tr]={...Vn[Tr],...qn}}),kn[jn]={...Gn,message:Vn.map(qn=>qn.word).join(" "),words:Vn,lastUpdated:new Date,raw:Rn.raw||Gn.raw},console.log(" Message updated with",Vn.length,"words"),kn}else{console.log(" Creating new message:",Rn.id);const kn=[...bn,{...Rn,createdAt:new Date,lastUpdated:new Date}];return console.log(" Chat history updated, new length:",kn.length),kn}})},fn=reactExports.useRef(null),dn=reactExports.useRef(null);reactExports.useEffect(()=>{(async()=>{const jn=getAgoraConfig();if(!jn.appId||!jn.token){console.log(" Skipping Agora client initialization - missing credentials"),console.log("Missing:",{appId:jn.appId?"SET":"MISSING",token:jn.token?"SET":"MISSING"});return}try{console.log(" Initializing Agora client..."),AgoraRTC.setLogLevel(1);const kn=AgoraRTC.createClient({mode:"live",codec:"vp8"});await kn.setClientRole("audience"),console.log(" Agora client created in LIVE mode with AUDIENCE role"),kn.on("user-published",async(Vn,qn)=>{console.log(" USER PUBLISHED EVENT:",{uid:Vn.uid,uidType:typeof Vn.uid,mediaType:qn,expectedConvoAIUid:getAgoraConfig().convoAIUid,isConvoAIAgent:Vn.uid==getAgoraConfig().convoAIUid});try{await kn.subscribe(Vn,qn),console.log(" Successfully subscribed to user:",Vn.uid,"for",qn)}catch(Mn){console.error(" Failed to subscribe to user:",Vn.uid,Mn);return}const Tr=getAgoraConfig();if(qn==="audio"&&Vn.uid==Tr.convoAIUid){console.log(" ConvoAI Agent audio track received! Setting up playback and lip sync...");const Mn=Vn.audioTrack;if(Mn){console.log(" Audio track found, checking properties..."),console.log("Audio track details:",{enabled:Mn.enabled,muted:Mn.muted,volume:Mn.getVolumeLevel?Mn.getVolumeLevel():"unknown",isPlaying:Mn.isPlaying});try{console.log(" Starting audio playback..."),Mn.play(),console.log(" Audio track play() called successfully"),Mn.setVolume&&(Mn.setVolume(100),console.log(" Set audio volume to 100%"))}catch(Zt){console.error(" Failed to play audio track:",Zt)}try{console.log(" Setting up Web Audio API for real-time lip sync...");const Zt=Mn.getMediaStreamTrack();console.log("MediaStreamTrack:",{enabled:Zt.enabled,muted:Zt.muted,readyState:Zt.readyState});const wn=new(window.AudioContext||window.webkitAudioContext);console.log("AudioContext state:",wn.state),wn.state==="suspended"&&(console.log(" Resuming suspended audio context..."),await wn.resume(),console.log(" Audio context resumed, new state:",wn.state));const xn=wn.createMediaStreamSource(new MediaStream([Zt])),Hn=wn.createAnalyser();xn.connect(Hn),Hn.fftSize=256,fn.current=Hn,console.log(" Real-time audio analysis setup complete, starting ConvoAI lip sync...");const Bn=()=>{if(fn.current){const cr=new Uint8Array(fn.current.frequencyBinCount);fn.current.getByteFrequencyData(cr);const rr=cr.reduce((ir,kr)=>ir+kr,0)/cr.length/255;yt(rr);let sr="viseme_sil";if(rr>.02){const ir=cr.slice(0,8).reduce((lr,vr)=>lr+vr,0)/8,kr=cr.slice(8,20).reduce((lr,vr)=>lr+vr,0)/12,un=cr.slice(20,40).reduce((lr,vr)=>lr+vr,0)/20,sn=cr.slice(40,70).reduce((lr,vr)=>lr+vr,0)/30,Kn=cr.slice(70,110).reduce((lr,vr)=>lr+vr,0)/40,Sr=ir+kr+un+sn+Kn;if(Sr>10){const lr=ir/Sr,vr=kr/Sr,Fr=un/Sr,Gr=sn/Sr,dr=Kn/Sr;lr>.25&&vr<.2?sr="viseme_aa":vr>.25&&dr>.2?sr="viseme_I":lr>.2&&vr>.2?sr="viseme_E":lr<.15&&vr<.2&&dr>.25?sr="viseme_U":lr<.2&&vr>.2&&Fr>.2?sr="viseme_O":dr>.35?sr=Math.random()>.5?"viseme_SS":"viseme_CH":dr>.25?sr=Math.random()>.5?"viseme_FF":"viseme_TH":lr<.15&&vr<.2&&dr<.2?sr="viseme_PP":vr<.2&&Fr>.2?sr="viseme_kk":sr="viseme_DD"}}wt({viseme:sr,audioLevel:rr,frequencies:{low:cr.slice(0,15).reduce((ir,kr)=>ir+kr,0)/15,mid:cr.slice(15,60).reduce((ir,kr)=>ir+kr,0)/45,high:cr.slice(60,100).reduce((ir,kr)=>ir+kr,0)/40}})}dn.current=requestAnimationFrame(Bn)};Bn()}catch(Zt){console.error(" Error setting up real-time audio analysis:",Zt)}}else console.warn("  Audio track is null/undefined")}else console.log(" Regular user audio or different media type");lt(Mn=>[...Mn,Vn])}),kn.on("user-unpublished",Vn=>{console.log(" USER UNPUBLISHED:",{uid:Vn.uid,expectedConvoAIUid:getAgoraConfig().convoAIUid,isConvoAIAgent:Vn.uid==getAgoraConfig().convoAIUid}),lt(qn=>qn.filter(Tr=>Tr.uid!==Vn.uid))}),kn.on("user-joined",Vn=>{console.log(" USER JOINED CHANNEL:",{uid:Vn.uid,expectedConvoAIUid:getAgoraConfig().convoAIUid,isConvoAIAgent:Vn.uid==getAgoraConfig().convoAIUid})}),kn.on("user-left",Vn=>{console.log(" USER LEFT CHANNEL:",{uid:Vn.uid,expectedConvoAIUid:getAgoraConfig().convoAIUid,isConvoAIAgent:Vn.uid==getAgoraConfig().convoAIUid})});const Gn=(Vn,qn)=>qn&&Vt.has(qn)?(console.log(` Skipping duplicate message ID: ${qn}`),!1):Vn&&Vn.object?Vn.object==="assistant.transcription"?Vn.words&&Array.isArray(Vn.words)&&Vn.words.length>0?(console.log(" Valid assistant.transcription message with words"),!0):Vn.text&&Vn.text.trim()?(console.log(" Valid assistant.transcription message with text"),!0):(console.log(" assistant.transcription message has no meaningful content"),!1):(console.log(` Filtering out message type: ${Vn.object}`),!1):Vn&&Vn.words&&Vn.words.words&&Vn.words.words.length>0?Vn.words.words.some(Mn=>Mn.word&&Mn.word.trim())?(console.log(" Valid protobuf Words message with content"),!0):(console.log(" Protobuf message has empty words"),!1):(console.log(" Message does not meet criteria for chat display"),!1);kn.on("connection-state-change",Vn=>{console.log("Agora connection state:",Vn),ht(Vn==="CONNECTED")}),kn.on("stream-message",async(Vn,qn)=>{if(console.log(" RTC DATA STREAM MESSAGE:",{uid:Vn,payloadType:typeof qn,payloadSize:qn?qn.length||qn.byteLength:0,isFromConvoAI:Vn==getAgoraConfig().convoAIUid}),Vn==getAgoraConfig().convoAIUid)try{let Tr=new TextDecoder().decode(qn);if(!Tr.includes("|")){console.warn(" Message format invalid - missing separators");return}const Mn=Tr.split("|");if(Mn.length!==4){console.warn(" Message format invalid - expected 4 parts, got:",Mn.length);return}const[Zt,wn,xn,Hn]=Mn,Bn=parseInt(wn),cr=parseInt(xn);if(console.log(" Message chunk:",{messageId:Zt,partNum:Bn,totalNum:cr}),Vt.has(Zt)){console.log(` Ignoring duplicate complete message: ${Zt}`);return}let Wn;try{Wn=atob(Hn)}catch(rr){console.warn(" Base64 decode failed:",rr);return}Yt(rr=>{const sr=new Map(rr);if(Vt.has(Zt))return console.log(` Skipping chunk for already processed message: ${Zt}`),sr;sr.has(Zt)||sr.set(Zt,{parts:new Map,totalParts:cr,receivedAt:Date.now()});const ir=sr.get(Zt);if(ir.parts.has(Bn))return console.log(` Already have part ${Bn} for message ${Zt}, ignoring duplicate`),sr;if(ir.parts.set(Bn,Wn),console.log(` Received part ${Bn}/${cr} for message ${Zt} (${ir.parts.size}/${cr} complete)`),ir.parts.size===cr){console.log(` All parts received for message ${Zt}, assembling...`);let kr="";for(let un=1;un<=cr;un++)if(ir.parts.has(un))kr+=ir.parts.get(un);else return console.error(` Missing part ${un} for message ${Zt}`),sr;qt(Zt,kr),sr.delete(Zt)}else pn(Zt,Wn);return sr})}catch(Tr){console.error(" Stream message processing error:",Tr)}}),tt(kn)}catch(kn){console.error(" Failed to initialize Agora client:",kn),console.log(" Please check your Agora App ID and Token configuration")}})();const bn=()=>{xt(jn=>jn+1)};return window.addEventListener("storage",bn),window.addEventListener("sessionStorageUpdate",bn),()=>{dn.current&&cancelAnimationFrame(dn.current),window.removeEventListener("storage",bn),window.removeEventListener("sessionStorageUpdate",bn)}},[]);const Cn=reactExports.useCallback(async()=>{try{console.log("Starting ConvoAI Agent via REST API...");const Rn=getAgoraConfig(),bn=getConvoAIConfig();let jn=generateBasicAuthHeader();if(!jn){console.error(" Failed to generate auth header - check API Key and Password");return}if(!jn)throw new Error("ConvoAI API credentials not configured. Please set valid API Key and Password in Settings.");if(!testBasicAuthCredentials())throw new Error("ConvoAI API credentials encoding test failed. Please check your API Key and Password.");const Gn=`agora-agent-${Date.now()}`,Vn=`${bn.baseUrl}/projects/${Rn.appId}/join`,qn={name:Gn,properties:{channel:Rn.channel,token:Rn.token,name:bn.agentName,agent_rtc_uid:bn.agentUid.toString(),remote_rtc_uids:["*"],idle_timeout:120,llm:{url:bn.llmUrl,api_key:bn.llmApiKey,system_messages:[{role:"system",content:bn.systemMessage}],max_history:32,greeting_message:bn.greeting,failure_message:"I'm sorry, I'm having trouble processing that. Please try again.",params:{model:bn.llmModel}},tts:{vendor:"microsoft",params:{key:bn.ttsApiKey,region:bn.ttsRegion,voice_name:bn.ttsVoiceName}},asr:{language:bn.asrLanguage}}};console.log(" ConvoAI Agent Join Request:",{url:Vn,agentUid:bn.agentUid,agentUidType:typeof bn.agentUid,body:qn}),console.log(" Auth Debug:",{authHeaderPresent:!!jn,authHeaderLength:jn?jn.length:0,apiKeyPresent:!!bn.apiKey,passwordPresent:!!bn.password,baseUrl:bn.baseUrl});const Tr=await fetch(Vn,{method:"POST",headers:{"Content-Type":"application/json",Authorization:jn},body:JSON.stringify(qn)});if(!Tr.ok){const Zt=await Tr.text();throw new Error(`ConvoAI API Error (${Tr.status}): ${Zt}`)}const Mn=await Tr.json();return console.log(" ConvoAI Agent started successfully:",Mn),(Mn.agent_id||Mn.id)&&(Pt(Mn.agent_id||Mn.id),console.log(" Stored agent ID:",Mn.agent_id||Mn.id)),console.log(" Agent should start speaking greeting message..."),Mn}catch(Rn){throw console.error("Failed to start ConvoAI Agent:",Rn),Rn}},[]),On=reactExports.useCallback(async()=>{try{if(!It){console.warn("No agent ID available for stopping");return}console.log("Stopping ConvoAI Agent...");const Rn=getAgoraConfig(),bn=getConvoAIConfig(),jn=generateBasicAuthHeader();if(!jn){console.warn("ConvoAI API credentials not available for stopping agent");return}const kn=`${bn.baseUrl}/projects/${Rn.appId}/agents/${It}/leave`,Gn=await fetch(kn,{method:"POST",headers:{"Content-Type":"application/json",Authorization:jn}});if(!Gn.ok){const qn=await Gn.text();console.warn(`ConvoAI Stop API Warning (${Gn.status}): ${qn}`)}const Vn=await Gn.json();console.log("ConvoAI Agent stopped:",Vn),Pt(null)}catch(Rn){console.warn("Failed to stop ConvoAI Agent:",Rn)}},[It]),Pn=reactExports.useCallback(async()=>{if(!_||ft){console.warn("Cannot join: client not ready or already joined",{client:!!_,isJoined:ft});return}try{console.log("Joining Agora channel and starting ConvoAI Agent...");const Rn=getAgoraConfig();if(console.log(" Joining Agora channel:",Rn.channel),!Rn.appId)throw new Error("Agora App ID is required. Please configure it in Settings.");if(!Rn.token)throw new Error("Agora Token is required. Please configure it in Settings.");if(!/^[a-f0-9]{32}$/i.test(Rn.appId))throw new Error(`Invalid Agora App ID format. Expected 32 character hex string, got: ${Rn.appId}`);console.log("Creating microphone audio track...");const bn=await AgoraRTC.createMicrophoneAudioTrack({encoderConfig:{sampleRate:48e3,stereo:!1,bitrate:128}});st(bn),console.log("Joining Agora channel with params:",{appId:Rn.appId,channel:Rn.channel,tokenPresent:!!Rn.token,uid:Rn.uid}),await _.join(Rn.appId,Rn.channel,Rn.token,Rn.uid),console.log(" Switching to HOST role to publish audio..."),await _.setClientRole("host"),console.log("Publishing local audio track..."),await _.publish([bn]),gt(!0),ht(!0),console.log(`Successfully joined Agora channel: ${Rn.channel}`),setTimeout(()=>{console.log(" Checking all remote users after 3 seconds..."),console.log("Current remote users:",at.map(jn=>({uid:jn.uid,hasAudio:!!jn.audioTrack,hasVideo:!!jn.videoTrack})))},3e3);try{console.log("Starting ConvoAI Agent..."),await Cn(),console.log(`ConvoAI Agent (UID: ${Rn.convoAIUid}) should now join the channel`)}catch(jn){console.error("Failed to start ConvoAI Agent, but user connection successful:",jn),alert(`Connected to Agora, but ConvoAI Agent failed to start: ${jn.message}`)}}catch(Rn){console.error("Failed to join channel:",Rn),alert(`Connection failed: ${Rn.message}`),gt(!1),ht(!1),ot&&(ot.close(),st(null))}},[_,ft,Cn,ot]),yn=reactExports.useCallback(async()=>{if(!(!_||!ft))try{console.log("Leaving Agora channel and stopping ConvoAI Agent...");try{await On()}catch(Rn){console.warn("Failed to stop ConvoAI Agent (continuing with disconnect):",Rn)}dn.current&&cancelAnimationFrame(dn.current),ot&&(ot.close(),st(null)),await _.leave(),gt(!1),ht(!1),lt([]),yt(0),wt(null),kt([]),window.messagesMap&&window.messagesMap.clear(),console.log("Successfully left Agora channel")}catch(Rn){console.error("Failed to leave channel:",Rn)}},[_,ft,ot,On]),An=reactExports.useCallback(async Rn=>{if(!It)return console.warn("No agent ID available - cannot update configuration"),!1;try{console.log("Updating ConvoAI Agent configuration...");const bn=getAgoraConfig(),jn=getConvoAIConfig(),kn=generateBasicAuthHeader();if(!kn)return console.error(" Failed to generate auth header - check API Key and Password"),!1;const Gn=`${jn.baseUrl}/projects/${bn.appId}/agents/${It}/update`,Vn={properties:{...Rn}};console.log(" ConvoAI Agent Update Request:",{url:Gn,agentId:It,body:Vn});const qn=await fetch(Gn,{method:"POST",headers:{"Content-Type":"application/json",Authorization:kn},body:JSON.stringify(Vn)});if(!qn.ok){const Mn=await qn.text();throw new Error(`ConvoAI Update API Error (${qn.status}): ${Mn}`)}const Tr=await qn.json();return console.log(" ConvoAI Agent configuration updated successfully:",Tr),Tr}catch(bn){throw console.error("Failed to update ConvoAI Agent configuration:",bn),bn}},[It]),Sn=reactExports.useCallback(async()=>{if(!It){console.warn("No agent ID available for triggering speech");return}try{return console.log(" Triggering agent to speak..."),console.log("Agent should respond to user input with voice..."),!0}catch(Rn){console.error("Failed to trigger agent speech:",Rn)}},[It]),gn=reactExports.useCallback(()=>{const Rn=getAgoraConfig(),bn=getConvoAIConfig(),jn=qn=>qn&&qn!==""&&!qn.includes("your-")&&!qn.includes("replace-")&&!qn.includes("api-key")&&!qn.includes("password"),kn=jn(bn.apiKey)&&jn(bn.password),Gn=jn(bn.llmApiKey),Vn=jn(bn.ttsApiKey);return{channel:Rn.channel,convoAIUid:Rn.convoAIUid,hasCredentials:kn,hasLLMKey:Gn,hasTTSKey:Vn}},[Rt]),_n={client:_,localAudioTrack:ot,remoteUsers:at,isConnected:dt,isJoined:ft,audioLevel:Et,lipSyncData:Ct,agentId:It,chatHistory:Nt,joinChannel:Pn,leaveChannel:yn,updateConvoAIConfigs:An,startConvoAIAgent:Cn,stopConvoAIAgent:On,triggerAgentSpeech:Sn,clearChatHistory:()=>{console.log(" Clearing chat history, processed message IDs, and message chunks..."),kt([]),Ft(new Set),Yt(new Map)},testChatMessage:()=>{console.log(" Adding test message with word details to chat..."),kt(Rn=>[...Rn,{id:Kt(),timestamp:new Date,speaker:"agent",message:"Hello! This is a test message with protobuf word details.",type:"transcript",words:[{word:"Hello!",start:0,end:.5,confidence:.98,speaker:!1},{word:"This",start:.6,end:.8,confidence:.95,speaker:!1},{word:"is",start:.9,end:1,confidence:.99,speaker:!1},{word:"a",start:1.1,end:1.15,confidence:.97,speaker:!1},{word:"test",start:1.2,end:1.5,confidence:.96,speaker:!1},{word:"message",start:1.6,end:2,confidence:.94,speaker:!1},{word:"with",start:2.1,end:2.3,confidence:.98,speaker:!1},{word:"protobuf",start:2.4,end:2.8,confidence:.92,speaker:!1},{word:"word",start:2.9,end:3.1,confidence:.99,speaker:!1},{word:"details.",start:3.2,end:3.6,confidence:.93,speaker:!1}]}]),console.log(" Test message with word details added")},testProtobufDecoding:async()=>{console.log(" Testing protobuf decoding...");try{const{SomeMessage:Rn}=await loadProtoSchema();console.log(" Protobuf schema loaded for testing"),kt(bn=>[...bn,{id:Kt(),timestamp:new Date,speaker:"system",message:"Protobuf schema loaded successfully! Only assistant.transcription messages will appear.",type:"test"}])}catch(Rn){console.error(" Protobuf schema test failed:",Rn),kt(bn=>[...bn,{id:Kt(),timestamp:new Date,speaker:"error",message:`Protobuf test failed: ${Rn.message}`,type:"error"}])}},testFilteredMessage:()=>{console.log(" Testing message filtering...");const Rn=[{object:"assistant.transcription",words:[{word:"Hello",start:0,end:.5}],text:"Hello"},{object:"debug.info",text:"This should be filtered out"},{object:"silence.detection",text:"This should also be filtered out"}];console.log(" Message filtering test results:"),Rn.forEach((bn,jn)=>{const kn=bn.object==="assistant.transcription";console.log(`Message ${jn+1} (${bn.object}): ${kn?"WOULD SHOW ":"WOULD FILTER "}`)}),kt(bn=>[...bn,{id:Kt(),timestamp:new Date,speaker:"system",message:"Filter test complete! Only assistant.transcription messages will be shown in real chat.",type:"test"}])},testRealTimeUpdates:()=>{console.log(" Testing real-time word-by-word updates...");const Rn="test-realtime-"+Date.now(),bn=[{word:"This",start:0,end:.3,confidence:.95},{word:"is",start:.4,end:.5,confidence:.99},{word:"a",start:.6,end:.65,confidence:.97},{word:"real-time",start:.7,end:1.2,confidence:.93},{word:"transcription",start:1.3,end:2,confidence:.96},{word:"demo!",start:2.1,end:2.5,confidence:.98}];bn.forEach((jn,kn)=>{setTimeout(()=>{const Gn=bn.slice(0,kn+1),Vn=kn===bn.length-1;an({id:Rn,timestamp:new Date,speaker:"agent",message:Gn.map(qn=>qn.word).join(" ")+(Vn?"":"..."),type:"transcript",words:Gn,isPartial:!Vn}),console.log(` Added word ${kn+1}/${bn.length}: "${jn.word}"`)},kn*500)})},config:gn(),testBasicAuth:testBasicAuthCredentials,generateAuthHeader:generateBasicAuthHeader,debugCredentials:()=>{console.log(" Current credential status:"),console.log("SessionStorage VITE_RESTFUL_API_KEY:",sessionStorage.getItem("VITE_RESTFUL_API_KEY")?"SET":"MISSING"),console.log("SessionStorage VITE_RESTFUL_PASSWORD:",sessionStorage.getItem("VITE_RESTFUL_PASSWORD")?"SET":"MISSING"),console.log("Environment VITE_RESTFUL_API_KEY:",{}.VITE_RESTFUL_API_KEY?"SET":"MISSING"),console.log("Environment VITE_RESTFUL_PASSWORD:",{}.VITE_RESTFUL_PASSWORD?"SET":"MISSING");const Rn=getConvoAIConfig();console.log("Final resolved:",{apiKey:Rn.apiKey?"SET":"MISSING",password:Rn.password?"SET":"MISSING"})}};return jsx(AgoraContext.Provider,{value:_n,children:nt})},useAgora=()=>{const nt=reactExports.useContext(AgoraContext);if(!nt)throw new Error("useAgora must be used within an AgoraProvider");return nt},ChatContext=reactExports.createContext(),ChatProvider=({children:nt})=>{const{sendMessageToConvoAI:_,isConnected:tt}=useAgora(),[ot,st]=reactExports.useState([]),[at,lt]=reactExports.useState(),[dt,ht]=reactExports.useState(!1),[ft,gt]=reactExports.useState(!0),Et=async Ct=>{if(!tt){console.warn("Not connected to Agora channel");return}ht(!0);try{await _(Ct);const wt={text:Ct,audio:null,lipsync:null,animation:"Talking_0",facialExpression:"default",sender:"user"};st(It=>[...It,wt])}catch(wt){console.error("Failed to send message:",wt)}finally{ht(!1)}},yt=()=>{st(Ct=>Ct.slice(1))};return reactExports.useEffect(()=>{if(ot.length>0){const Ct=ot.filter(wt=>wt.sender!=="user");Ct.length>0?lt(Ct[0]):lt(null)}else lt(null)},[ot]),jsx(ChatContext.Provider,{value:{chat:Et,message:at,onMessagePlayed:yt,loading:dt,cameraZoomed:ft,setCameraZoomed:gt},children:nt})},useChat=()=>{const nt=reactExports.useContext(ChatContext);if(!nt)throw new Error("useChat must be used within a ChatProvider");return nt},facialExpressions={default:{},smile:{browInnerUp:.15,eyeSquintLeft:.3,eyeSquintRight:.3,mouthSmileLeft:.8,mouthSmileRight:.8,cheekSquintLeft:.4,cheekSquintRight:.4},funnyFace:{jawLeft:.63,mouthPucker:.53,noseSneerLeft:1,noseSneerRight:.39,mouthLeft:1,eyeLookUpLeft:1,eyeLookUpRight:1,cheekPuff:.9999924982764238,mouthDimpleLeft:.414743888682652,mouthRollLower:.32,mouthSmileLeft:.35499733688813034,mouthSmileRight:.35499733688813034},sad:{mouthFrownLeft:1,mouthFrownRight:1,mouthShrugLower:.78341,browInnerUp:.452,eyeSquintLeft:.72,eyeSquintRight:.75,eyeLookDownLeft:.5,eyeLookDownRight:.5,jawForward:1},surprised:{eyeWideLeft:.5,eyeWideRight:.5,jawOpen:.351,mouthFunnel:1,browInnerUp:1},angry:{browDownLeft:1,browDownRight:1,eyeSquintLeft:1,eyeSquintRight:1,jawForward:1,jawLeft:1,mouthShrugLower:1,noseSneerLeft:1,noseSneerRight:.42,eyeLookDownLeft:.16,eyeLookDownRight:.16,cheekSquintLeft:1,cheekSquintRight:1,mouthClose:.23,mouthFunnel:.63,mouthDimpleRight:1},crazy:{browInnerUp:.9,jawForward:1,noseSneerLeft:.5700000000000001,noseSneerRight:.51,eyeLookDownLeft:.39435766259644545,eyeLookUpRight:.4039761421719682,eyeLookInLeft:.9618479575523053,eyeLookInRight:.9618479575523053,jawOpen:.9618479575523053,mouthDimpleLeft:.9618479575523053,mouthDimpleRight:.9618479575523053,mouthStretchLeft:.27893590769016857,mouthStretchRight:.2885543872656917,mouthSmileLeft:.5578718153803371,mouthSmileRight:.38473918302092225,tongueOut:.9618479575523053}},corresponding={A:"viseme_PP",B:"viseme_kk",C:"viseme_I",D:"viseme_aa",E:"viseme_O",F:"viseme_U",G:"viseme_FF",H:"viseme_TH",X:"viseme_sil"};let setupMode=!1;function Avatar({currentExpression:nt,currentAnimation:_,currentAvatar:tt="Aurora",manualBlendShapes:ot=null,manualViseme:st=null,visualizerViseme:at=null,visualizerAudioLevel:lt=0,showWireframe:dt=!1,...ht}){const ft={Aurora:"Aurora.glb",Celeste:"Celeste.glb",Lyra:"Lyra.glb"},gt=ft[tt]||ft.Aurora,{nodes:Et,materials:yt,scene:Ct}=useGLTF(`/RPM-agora-agent/models/Avatars/${gt}`),{message:wt,onMessagePlayed:It,chat:Pt}=useChat(),{lipSyncData:Rt,audioLevel:xt}=useAgora(),[Nt,kt]=reactExports.useState(),Vt=reactExports.useRef(0),Ft=reactExports.useRef("X"),zt=reactExports.useRef(0),Yt=reactExports.useRef({});reactExports.useEffect(()=>{if(console.log(wt),!wt){_||On("Idle");return}_||On(wt.animation),nt||kn(wt.facialExpression),kt(wt.lipsync);const Mn=new Audio("data:audio/mp3;base64,"+wt.audio);Mn.play(),Vn(Mn),Mn.onended=It},[wt,_,nt]);const{animations:Kt}=useGLTF("/RPM-agora-agent/models/animations.glb");reactExports.useEffect(()=>{console.log("Available animations:",Kt.map(Mn=>Mn.name)),console.log("Current avatar:",tt),console.log("Avatar model path:",`/RPM-agora-agent/models/Avatars/${gt}`)},[Kt,tt,gt]);const qt=reactExports.useRef(),pn=reactExports.useRef(),an=reactExports.useRef({});reactExports.useEffect(()=>(qt.current&&Kt.length>0&&Ct&&(console.log(` Setting up animations for avatar: ${tt}`),console.log("Group children count:",qt.current.children.length),pn.current&&(console.log("Clearing previous animation mixer"),pn.current.stopAllAction(),pn.current.setTime(0),pn.current=null),setTimeout(()=>{if(!qt.current)return;let Mn=null;Ct.traverse(Hn=>{Hn.type==="Bone"&&Hn.name==="Hips"&&(Mn=Hn,console.log(`Found skeleton root: ${Hn.name}`))});const Zt=Mn||qt.current;console.log(` Animation target: ${Zt.name||Zt.type}`),pn.current=new AnimationMixer(Zt),pn.current.addEventListener("loop",()=>{});const wn=console.warn;console.warn=(...Hn)=>{var Bn,cr,Wn,rr;(cr=(Bn=Hn[0])==null?void 0:Bn.includes)!=null&&cr.call(Bn,"PropertyBinding")||(rr=(Wn=Hn[0])==null?void 0:Wn.includes)!=null&&rr.call(Wn,"trying to update node")||wn.apply(console,Hn)},an.current={};let xn=0;Kt.forEach(Hn=>{try{const Bn=pn.current.clipAction(Hn);Bn.setLoop(LoopRepeat),an.current[Hn.name]=Bn,xn++,console.log(` Created action for: ${Hn.name}`)}catch(Bn){console.warn(` Failed to create action for ${Hn.name}:`,Bn.message)}}),console.warn=wn,console.log(` Animation setup complete: ${xn}/${Kt.length} actions created for ${tt}`),console.log("Available actions:",Object.keys(an.current)),an.current.Idle&&(console.log(" Starting default Idle animation"),an.current.Idle.play())},100)),()=>{pn.current&&(console.log(` Cleaning up animations for ${tt}`),pn.current.stopAllAction(),pn.current=null)}),[tt,Kt,Ct]),reactExports.useEffect(()=>{if(Ct)return Ct.traverse(Mn=>{(Mn.isMesh||Mn.isSkinnedMesh)&&Mn.material&&(Array.isArray(Mn.material)?Mn.material:[Mn.material]).forEach(wn=>{wn.wireframe=dt})}),()=>{Ct.traverse(Mn=>{(Mn.isMesh||Mn.isSkinnedMesh)&&Mn.material&&(Array.isArray(Mn.material)?Mn.material:[Mn.material]).forEach(wn=>{wn.wireframe=!1})})}},[dt,Ct]),useFrame((Mn,Zt)=>{pn.current&&pn.current.update(Zt);const wn=qn();if(!setupMode&&wn&&wn.morphTargetDictionary&&Object.keys(wn.morphTargetDictionary).forEach(Wn=>{const rr=facialExpressions[jn];Wn==="eyeBlinkLeft"||Wn==="eyeBlinkRight"||(rr&&rr[Wn]?Pn(Wn,rr[Wn],.1):Pn(Wn,0,.1))}),Pn("eyeBlinkLeft",An||gn?1:0,.5),Pn("eyeBlinkRight",An||Rn?1:0,.5),setupMode)return;if(ot&&Object.entries(ot).forEach(([Wn,rr])=>{Pn(Wn,rr,.2)}),st){Pn(st,1,.2),Pn("jawOpen",.4,.2);return}const xn=[],Hn=at||Rt&&Rt.viseme,Bn=lt>0?lt:xt||0;if(Hn&&Bn>.01){const Wn=Hn;Ft.current!==Hn&&(zt.current=0,Ft.current=Hn),zt.current=Math.min(zt.current+Zt*20,1);const rr=Math.min(Bn*4,1)*zt.current;Pn(Wn,rr,.5),xn.push(Wn);const sr=Bn*.8*zt.current;sr>.03&&(Pn("jawOpen",Math.min(sr,.8),.5),xn.push("jawOpen"))}else if(wt&&Nt){const Wn=Gn.currentTime;for(let rr=0;rr<Nt.mouthCues.length;rr++){const sr=Nt.mouthCues[rr];if(Wn>=sr.start&&Wn<=sr.end){const ir=sr.value,kr=corresponding[ir],un=mouthMorphTargets[ir];kr&&(xn.push(kr),Pn(kr,1,.4)),un&&Object.entries(un).forEach(([sn,Kn])=>{yn(sn,Kn,Zt),xn.push(sn)});break}}}Object.values(corresponding).forEach(Wn=>{xn.includes(Wn)||Pn(Wn,0,.2)}),["jawOpen","mouthOpen","mouthWide","mouthSmileLeft","mouthSmileRight","mouthFunnel","mouthPucker","mouthPressLeft","mouthPressRight","mouthClose","tongueOut","mouthLeft","mouthRight"].forEach(Wn=>{xn.includes(Wn)||yn(Wn,0,Zt)}),(!Rt||Vt.current<=.01)&&(yn("jawOpen",.02,Zt),yn("mouthOpen",.01,Zt))});const{actions:fn,mixer:dn}=useAnimations(Kt,qt),[Cn,On]=reactExports.useState(Kt.find(Mn=>Mn.name==="Idle")?"Idle":Kt[0].name);reactExports.useEffect(()=>{if(_)if(Kt.find(Zt=>Zt.name===_)){if(On(_),!nt){const wn={Idle:"",Laughing:"funnyFace",Crying:"sad",Angry:"angry",Terrified:"surprised",Talking_0:"",Talking_1:"smile",Talking_2:"surprised"}[_];wn!==void 0&&kn(wn)}}else console.warn(`Animation "${_}" not found. Available animations:`,Kt.map(Zt=>Zt.name)),On("Idle");else wt||On("Idle")},[_,wt,Kt,nt]),reactExports.useEffect(()=>{if(console.log(`Attempting to play animation: ${Cn} for avatar: ${tt}`),console.log("Custom actions available:",Object.keys(an.current)),an.current[Cn]){console.log(` Playing animation: ${Cn} using custom system`),Object.entries(an.current).forEach(([Zt,wn])=>{Zt!==Cn&&wn.isRunning()&&wn.fadeOut(.3)});const Mn=an.current[Cn];return Mn.reset(),Mn.fadeIn(.3),Mn.play(),()=>{Mn&&Mn.isRunning()&&Mn.fadeOut(.3)}}else{if(console.warn(` Animation "${Cn}" not found in custom actions for ${tt}:`,Object.keys(an.current)),fn[Cn])return console.log(`Fallback: Using legacy action for ${Cn}`),fn[Cn].reset().fadeIn(dn&&dn.stats.actions.inUse===0?0:.5).play(),()=>{fn[Cn]&&fn[Cn].fadeOut(.5)};console.warn(`Animation "${Cn}" not found in either system`)}},[Cn,fn,dn,tt]);const Pn=(Mn,Zt,wn=.1)=>{Ct.traverse(xn=>{if(xn.isSkinnedMesh&&xn.morphTargetDictionary){const Hn=xn.morphTargetDictionary[Mn];if(Hn===void 0||xn.morphTargetInfluences[Hn]===void 0)return;if(xn.morphTargetInfluences[Hn]=MathUtils.lerp(xn.morphTargetInfluences[Hn],Zt,wn),!setupMode)try{Tr({[Mn]:Zt})}catch{}}})},yn=(Mn,Zt,wn)=>{Yt.current[Mn]||(Yt.current[Mn]=0);const Hn=Zt>Yt.current[Mn]?15:18;Yt.current[Mn]=MathUtils.lerp(Yt.current[Mn],Zt,1-Math.exp(-Hn*wn)),Pn(Mn,Yt.current[Mn],.9)},[An,Sn]=reactExports.useState(!1),[gn,_n]=reactExports.useState(!1),[Rn,bn]=reactExports.useState(!1),[jn,kn]=reactExports.useState(""),[Gn,Vn]=reactExports.useState();reactExports.useEffect(()=>{nt?kn(nt):wt||kn("")},[nt,wt]);const qn=()=>{let Mn=null;return Ct.traverse(Zt=>{!Mn&&Zt.isSkinnedMesh&&Zt.morphTargetDictionary&&Object.keys(Zt.morphTargetDictionary).length>0&&(Mn=Zt)}),Mn};useControls("FacialExpressions",{chat:button(()=>Pt()),winkLeft:button(()=>{_n(!0),setTimeout(()=>_n(!1),300)}),winkRight:button(()=>{bn(!0),setTimeout(()=>bn(!1),300)}),animation:{value:Cn,options:Kt.map(Mn=>Mn.name),onChange:Mn=>On(Mn)},facialExpression:{options:Object.keys(facialExpressions),onChange:Mn=>kn(Mn)},enableSetupMode:button(()=>{setupMode=!0}),disableSetupMode:button(()=>{setupMode=!1}),logMorphTargetValues:button(()=>{const Mn=qn();if(!Mn||!Mn.morphTargetDictionary){console.log("No morph target mesh found for current avatar");return}const Zt={};Object.keys(Mn.morphTargetDictionary).forEach(wn=>{if(wn==="eyeBlinkLeft"||wn==="eyeBlinkRight")return;const xn=Mn.morphTargetInfluences[Mn.morphTargetDictionary[wn]];xn>.01&&(Zt[wn]=xn)}),console.log(JSON.stringify(Zt,null,2))})});const[,Tr]=useControls("MorphTarget",()=>{const Mn=qn();return!Mn||!Mn.morphTargetDictionary?{}:Object.assign({},...Object.keys(Mn.morphTargetDictionary).map(Zt=>({[Zt]:{label:Zt,value:0,min:Mn.morphTargetInfluences[Mn.morphTargetDictionary[Zt]],max:1,onChange:wn=>{setupMode&&Pn(Zt,wn,1)}}})))});return reactExports.useEffect(()=>{let Mn;const Zt=()=>{Mn=setTimeout(()=>{Sn(!0),setTimeout(()=>{Sn(!1),Zt()},200)},MathUtils.randInt(1e3,5e3))};return Zt(),()=>clearTimeout(Mn)},[]),jsxs("group",{...ht,dispose:null,ref:qt,children:[jsx("primitive",{object:Et.Hips}),jsx("skinnedMesh",{name:"Wolf3D_Body",geometry:Et.Wolf3D_Body.geometry,material:yt.Wolf3D_Body,skeleton:Et.Wolf3D_Body.skeleton}),jsx("skinnedMesh",{name:"Wolf3D_Outfit_Bottom",geometry:Et.Wolf3D_Outfit_Bottom.geometry,material:yt.Wolf3D_Outfit_Bottom,skeleton:Et.Wolf3D_Outfit_Bottom.skeleton}),jsx("skinnedMesh",{name:"Wolf3D_Outfit_Footwear",geometry:Et.Wolf3D_Outfit_Footwear.geometry,material:yt.Wolf3D_Outfit_Footwear,skeleton:Et.Wolf3D_Outfit_Footwear.skeleton}),jsx("skinnedMesh",{name:"Wolf3D_Outfit_Top",geometry:Et.Wolf3D_Outfit_Top.geometry,material:yt.Wolf3D_Outfit_Top,skeleton:Et.Wolf3D_Outfit_Top.skeleton}),jsx("skinnedMesh",{name:"Wolf3D_Hair",geometry:Et.Wolf3D_Hair.geometry,material:yt.Wolf3D_Hair,skeleton:Et.Wolf3D_Hair.skeleton}),jsx("skinnedMesh",{name:"EyeLeft",geometry:Et.EyeLeft.geometry,material:yt.Wolf3D_Eye,skeleton:Et.EyeLeft.skeleton,morphTargetDictionary:Et.EyeLeft.morphTargetDictionary,morphTargetInfluences:Et.EyeLeft.morphTargetInfluences}),jsx("skinnedMesh",{name:"EyeRight",geometry:Et.EyeRight.geometry,material:yt.Wolf3D_Eye,skeleton:Et.EyeRight.skeleton,morphTargetDictionary:Et.EyeRight.morphTargetDictionary,morphTargetInfluences:Et.EyeRight.morphTargetInfluences}),jsx("skinnedMesh",{name:"Wolf3D_Head",geometry:Et.Wolf3D_Head.geometry,material:yt.Wolf3D_Skin,skeleton:Et.Wolf3D_Head.skeleton,morphTargetDictionary:Et.Wolf3D_Head.morphTargetDictionary,morphTargetInfluences:Et.Wolf3D_Head.morphTargetInfluences}),jsx("skinnedMesh",{name:"Wolf3D_Teeth",geometry:Et.Wolf3D_Teeth.geometry,material:yt.Wolf3D_Teeth,skeleton:Et.Wolf3D_Teeth.skeleton,morphTargetDictionary:Et.Wolf3D_Teeth.morphTargetDictionary,morphTargetInfluences:Et.Wolf3D_Teeth.morphTargetInfluences})]})}useGLTF.preload("/RPM-agora-agent/models/Avatars/Aurora.glb");useGLTF.preload("/RPM-agora-agent/models/Avatars/Celeste.glb");useGLTF.preload("/RPM-agora-agent/models/Avatars/Lyra.glb");useGLTF.preload("/RPM-agora-agent/models/animations.glb");const Dots=nt=>{const{loading:_}=useChat(),[tt,ot]=reactExports.useState("");return reactExports.useEffect(()=>{if(_){const st=setInterval(()=>{ot(at=>at.length>2?".":at+".")},800);return()=>clearInterval(st)}else ot("")},[_]),_?jsx("group",{...nt,children:jsxs(Text,{fontSize:.14,anchorX:"left",anchorY:"bottom",children:[tt,jsx("meshBasicMaterial",{attach:"material",color:"black"})]})}):null},Experience=({currentExpression:nt,currentAnimation:_,currentAvatar:tt,manualBlendShapes:ot,manualViseme:st,visualizerViseme:at,visualizerAudioLevel:lt,showWireframe:dt,showVertices:ht})=>{const ft=reactExports.useRef(),{cameraZoomed:gt}=useChat();return reactExports.useEffect(()=>{ft.current.setLookAt(0,2,5,0,1.5,0)},[]),reactExports.useEffect(()=>{gt?ft.current.setLookAt(0,1.5,1.5,0,1.5,0,!0):ft.current.setLookAt(0,2.2,5,0,1,0,!0)},[gt]),jsxs(Fragment,{children:[jsx(CameraControls,{ref:ft}),jsx(Environment,{preset:"sunset"}),jsx(reactExports.Suspense,{children:jsx(Dots,{"position-y":1.75,"position-x":-.02})}),jsx(reactExports.Suspense,{fallback:null,children:jsx(Avatar,{currentExpression:nt,currentAnimation:_,currentAvatar:tt,manualBlendShapes:ot,manualViseme:st,visualizerViseme:at,visualizerAudioLevel:lt,showWireframe:dt,showVertices:ht},tt)}),jsx(ContactShadows,{opacity:.7})]})},Settings=({isOpen:nt,onClose:_})=>{const[tt,ot]=reactExports.useState({agoraAppId:"",agoraToken:"",agoraChannel:"",convoaiApiBaseUrl:"",restfulApiKey:"",restfulPassword:"",convoaiAgentName:"",convoaiAgentUid:"",llmUrl:"",llmApiKey:"",llmModel:"",llmSystemMessage:"",llmGreeting:"",ttsApiKey:"",ttsRegion:"",ttsVoiceName:"",asrLanguage:""});reactExports.useEffect(()=>{nt&&ot({agoraAppId:{}.VITE_AGORA_APP_ID||"",agoraToken:{}.VITE_AGORA_TOKEN||"",agoraChannel:{}.VITE_AGORA_CHANNEL||"AgoraAgent_Channel",convoaiApiBaseUrl:{}.VITE_CONVOAI_API_BASE_URL||"https://api.agora.io/api/conversational-ai-agent/v2",restfulApiKey:{}.VITE_RESTFUL_API_KEY||"",restfulPassword:{}.VITE_RESTFUL_PASSWORD||"",convoaiAgentName:{}.VITE_CONVOAI_AGENT_NAME||"Agora Agent",convoaiAgentUid:{}.VITE_CONVOAI_AGENT_UID||"8888",llmUrl:{}.VITE_LLM_URL||"https://api.openai.com/v1/chat/completions",llmApiKey:{}.VITE_LLM_API_KEY||"",llmModel:{}.VITE_LLM_MODEL||"gpt-4o-mini",llmSystemMessage:{}.VITE_LLM_SYSTEM_MESSAGE||"You are a friendly Agora agent assistant.",llmGreeting:{}.VITE_LLM_GREETING||"Hello! I'm your Agora agent. How can I help you today?",ttsApiKey:{}.VITE_TTS_API_KEY||"",ttsRegion:{}.VITE_TTS_REGION||"eastus",ttsVoiceName:{}.VITE_TTS_VOICE_NAME||"en-US-AriaNeural",asrLanguage:{}.VITE_ASR_LANGUAGE||"en-US"})},[nt]);const st=(dt,ht)=>{ot(ft=>({...ft,[dt]:ht}))},at=()=>{const dt={VITE_AGORA_APP_ID:tt.agoraAppId,VITE_AGORA_TOKEN:tt.agoraToken,VITE_AGORA_CHANNEL:tt.agoraChannel,VITE_RESTFUL_API_KEY:tt.restfulApiKey,VITE_RESTFUL_PASSWORD:tt.restfulPassword,VITE_CONVOAI_AGENT_NAME:tt.convoaiAgentName,VITE_CONVOAI_AGENT_UID:tt.convoaiAgentUid,VITE_CONVOAI_API_BASE_URL:tt.convoaiApiBaseUrl,VITE_LLM_URL:tt.llmUrl,VITE_LLM_API_KEY:tt.llmApiKey,VITE_LLM_MODEL:tt.llmModel,VITE_LLM_SYSTEM_MESSAGE:tt.llmSystemMessage,VITE_LLM_GREETING:tt.llmGreeting,VITE_TTS_API_KEY:tt.ttsApiKey,VITE_TTS_REGION:tt.ttsRegion,VITE_TTS_VOICE_NAME:tt.ttsVoiceName,VITE_ASR_LANGUAGE:tt.asrLanguage};Object.entries(dt).forEach(([ht,ft])=>{ft&&sessionStorage.setItem(ht,ft)}),window.dispatchEvent(new Event("sessionStorageUpdate")),alert("Settings saved! Please refresh the page for changes to take effect."),_()},lt=()=>{Object.keys(tt).forEach(dt=>{const ht=dt.replace(/([A-Z])/g,"_$1").toUpperCase();sessionStorage.removeItem(`VITE_${ht}`)}),ot({agoraAppId:"",agoraToken:"",agoraChannel:"AgoraAgent_Channel",convoaiApiBaseUrl:"https://api.agora.io/api/conversational-ai-agent/v2",authCode:"",restfulApiKey:"",restfulPassword:"",convoaiAgentName:"Agora Agent",convoaiAgentUid:"8888",llmUrl:"https://api.openai.com/v1/chat/completions",llmApiKey:"",llmModel:"gpt-4o-mini",llmSystemMessage:"You are a friendly Agora agent assistant.",llmGreeting:"Hello! I am your Agora agent. How can I help you today?",ttsApiKey:"",ttsRegion:"eastus",ttsVoiceName:"en-US-AriaNeural",asrLanguage:"en-US"})};return nt?jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:[jsxs("div",{className:"sticky top-0 bg-white border-b px-6 py-4 flex justify-between items-center",children:[jsx("h2",{className:"text-2xl font-bold text-gray-800",children:"Configuration Settings"}),jsx("button",{onClick:_,className:"text-gray-500 hover:text-gray-700 text-2xl font-bold",children:""})]}),jsxs("div",{className:"p-6 space-y-8",children:[jsxs("div",{className:"border rounded-lg p-4 bg-blue-50",children:[jsx("h3",{className:"text-lg font-semibold text-blue-800 mb-4",children:" Agora Configuration"}),jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[jsxs("div",{children:[jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"App ID *"}),jsx("input",{type:"text",value:tt.agoraAppId,onChange:dt=>st("agoraAppId",dt.target.value),className:"w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Your Agora App ID"})]}),jsxs("div",{children:[jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Channel Name *"}),jsx("input",{type:"text",value:tt.agoraChannel,onChange:dt=>st("agoraChannel",dt.target.value),className:"w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"AgoraAgent_Channel"})]}),jsxs("div",{className:"md:col-span-2",children:[jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Token *"}),jsx("textarea",{value:tt.agoraToken,onChange:dt=>st("agoraToken",dt.target.value),rows:2,className:"w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Your Agora Token"})]})]})]}),jsxs("div",{className:"border rounded-lg p-4 bg-green-50",children:[jsx("h3",{className:"text-lg font-semibold text-green-800 mb-4",children:" ConvoAI REST API"}),jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[jsxs("div",{className:"md:col-span-2",children:[jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"API Base URL *"}),jsx("input",{type:"url",value:tt.convoaiApiBaseUrl,onChange:dt=>st("convoaiApiBaseUrl",dt.target.value),className:"w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-green-500 focus:border-transparent",placeholder:"https://api.agora.io/api/conversational-ai-agent/v2"}),jsx("p",{className:"text-xs text-gray-500 mt-1",children:"The Agora ConvoAI REST API endpoint"})]}),jsxs("div",{children:[jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"RESTful API Key *"}),jsx("input",{type:"password",value:tt.restfulApiKey,onChange:dt=>st("restfulApiKey",dt.target.value),className:"w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-green-500 focus:border-transparent",placeholder:"Your RESTful API Key"})]}),jsxs("div",{children:[jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"RESTful API Password *"}),jsx("input",{type:"password",value:tt.restfulPassword,onChange:dt=>st("restfulPassword",dt.target.value),className:"w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-green-500 focus:border-transparent",placeholder:"Your RESTful API Password"})]}),jsxs("div",{children:[jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Agent Name"}),jsx("input",{type:"text",value:tt.convoaiAgentName,onChange:dt=>st("convoaiAgentName",dt.target.value),className:"w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-green-500 focus:border-transparent",placeholder:"Agora Agent"})]}),jsxs("div",{children:[jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Agent UID"}),jsx("input",{type:"text",value:tt.convoaiAgentUid,onChange:dt=>st("convoaiAgentUid",dt.target.value),className:"w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-green-500 focus:border-transparent",placeholder:"8888"})]})]})]}),jsxs("div",{className:"border rounded-lg p-4 bg-purple-50",children:[jsx("h3",{className:"text-lg font-semibold text-purple-800 mb-4",children:" LLM Settings"}),jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[jsxs("div",{className:"md:col-span-2",children:[jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"LLM API URL *"}),jsx("input",{type:"url",value:tt.llmUrl,onChange:dt=>st("llmUrl",dt.target.value),className:"w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-purple-500 focus:border-transparent",placeholder:"https://api.openai.com/v1/chat/completions"}),jsx("p",{className:"text-xs text-gray-500 mt-1",children:"The endpoint URL for your LLM service (e.g., OpenAI, Azure OpenAI, etc.)"})]}),jsxs("div",{children:[jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"OpenAI API Key *"}),jsx("input",{type:"password",value:tt.llmApiKey,onChange:dt=>st("llmApiKey",dt.target.value),className:"w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-purple-500 focus:border-transparent",placeholder:"sk-..."})]}),jsxs("div",{children:[jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Model"}),jsxs("select",{value:tt.llmModel,onChange:dt=>st("llmModel",dt.target.value),className:"w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-purple-500 focus:border-transparent",children:[jsx("option",{value:"gpt-4o-mini",children:"GPT-4o Mini"}),jsx("option",{value:"gpt-4o",children:"GPT-4o"}),jsx("option",{value:"gpt-4-turbo",children:"GPT-4 Turbo"}),jsx("option",{value:"gpt-3.5-turbo",children:"GPT-3.5 Turbo"})]})]}),jsxs("div",{className:"md:col-span-2",children:[jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"System Message"}),jsx("textarea",{value:tt.llmSystemMessage,onChange:dt=>st("llmSystemMessage",dt.target.value),rows:2,className:"w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-purple-500 focus:border-transparent",placeholder:"You are a friendly Agora agent assistant."})]}),jsxs("div",{className:"md:col-span-2",children:[jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Greeting Message"}),jsx("textarea",{value:tt.llmGreeting,onChange:dt=>st("llmGreeting",dt.target.value),rows:2,className:"w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-purple-500 focus:border-transparent",placeholder:"Hello! I'm your Agora agent. How can I help you today?"})]})]})]}),jsxs("div",{className:"border rounded-lg p-4 bg-orange-50",children:[jsx("h3",{className:"text-lg font-semibold text-orange-800 mb-4",children:" Text-to-Speech (TTS)"}),jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[jsxs("div",{children:[jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Azure TTS API Key *"}),jsx("input",{type:"password",value:tt.ttsApiKey,onChange:dt=>st("ttsApiKey",dt.target.value),className:"w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-orange-500 focus:border-transparent",placeholder:"Your Azure TTS API Key"})]}),jsxs("div",{children:[jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Region"}),jsxs("select",{value:tt.ttsRegion,onChange:dt=>st("ttsRegion",dt.target.value),className:"w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-orange-500 focus:border-transparent",children:[jsx("option",{value:"eastus",children:"East US"}),jsx("option",{value:"westus",children:"West US"}),jsx("option",{value:"eastus2",children:"East US 2"}),jsx("option",{value:"westus2",children:"West US 2"}),jsx("option",{value:"centralus",children:"Central US"}),jsx("option",{value:"northeurope",children:"North Europe"}),jsx("option",{value:"westeurope",children:"West Europe"})]})]}),jsxs("div",{children:[jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Voice Name"}),jsxs("select",{value:tt.ttsVoiceName,onChange:dt=>st("ttsVoiceName",dt.target.value),className:"w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-orange-500 focus:border-transparent",children:[jsx("option",{value:"en-US-AriaNeural",children:"Aria (English US, Female)"}),jsx("option",{value:"en-US-JennyNeural",children:"Jenny (English US, Female)"}),jsx("option",{value:"en-US-GuyNeural",children:"Guy (English US, Male)"}),jsx("option",{value:"en-US-DavisNeural",children:"Davis (English US, Male)"}),jsx("option",{value:"en-GB-SoniaNeural",children:"Sonia (English UK, Female)"}),jsx("option",{value:"en-GB-RyanNeural",children:"Ryan (English UK, Male)"})]})]}),jsxs("div",{children:[jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"ASR Language"}),jsxs("select",{value:tt.asrLanguage,onChange:dt=>st("asrLanguage",dt.target.value),className:"w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-orange-500 focus:border-transparent",children:[jsx("option",{value:"en-US",children:"English (US)"}),jsx("option",{value:"en-GB",children:"English (UK)"}),jsx("option",{value:"es-ES",children:"Spanish"}),jsx("option",{value:"fr-FR",children:"French"}),jsx("option",{value:"de-DE",children:"German"}),jsx("option",{value:"ja-JP",children:"Japanese"}),jsx("option",{value:"ko-KR",children:"Korean"}),jsx("option",{value:"zh-CN",children:"Chinese (Simplified)"})]})]})]})]})]}),jsxs("div",{className:"sticky bottom-0 bg-gray-50 border-t px-6 py-4 flex justify-between",children:[jsx("button",{onClick:lt,className:"px-4 py-2 text-gray-600 bg-gray-200 rounded-md hover:bg-gray-300 transition-colors",children:"Reset to Defaults"}),jsxs("div",{className:"space-x-3",children:[jsx("button",{onClick:_,className:"px-4 py-2 text-gray-600 bg-gray-200 rounded-md hover:bg-gray-300 transition-colors",children:"Cancel"}),jsx("button",{onClick:at,className:"px-6 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors",children:"Save Settings"})]})]}),jsxs("div",{className:"px-6 pb-4 text-sm text-gray-600",children:[jsxs("p",{className:"mb-2",children:[jsx("strong",{children:"Note:"})," Settings are saved in your browser session and will persist until you refresh the page or close the browser."]}),jsxs("p",{children:["Fields marked with ",jsx("span",{className:"text-red-500",children:"*"})," are required for the application to function properly."]})]})]})}):null},CombinedChat=({isConnected:nt})=>{const[_,tt]=reactExports.useState(!1),[ot,st]=reactExports.useState(!0),{chatHistory:at,clearChatHistory:lt,testChatMessage:dt}=useAgora(),{chat:ht,loading:ft,message:gt}=useChat(),Et=reactExports.useRef(null),yt=reactExports.useRef();reactExports.useEffect(()=>{var It;_&&((It=Et.current)==null||It.scrollIntoView({behavior:"smooth"}))},[at,_]);const Ct=()=>{const It=yt.current.value;!ft&&!gt&&nt&&It.trim()&&(ht(It),yt.current.value="")},wt=It=>new Date(It).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",second:"2-digit"});return jsxs("div",{className:"fixed bottom-4 left-4 z-50",children:[ot&&jsxs("button",{onClick:()=>{st(!1),tt(!0)},className:"bg-blue-600 hover:bg-blue-700 text-white p-3 rounded-full shadow-lg transition-all duration-200 hover:scale-105",title:"Open Chat",children:[jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:"w-6 h-6",children:jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8.625 12a.375.375 0 11-.75 0 .375.375 0 01.75 0zm0 0H8.25m4.125 0a.375.375 0 11-.75 0 .375.375 0 01.75 0zm0 0H12m4.125 0a.375.375 0 11-.75 0 .375.375 0 01.75 0zm0 0h-.375M21 12c0 4.556-4.03 8.25-9 8.25a9.764 9.764 0 01-2.555-.337A5.972 5.972 0 015.41 20.97a5.969 5.969 0 01-.474-.065 4.48 4.48 0 00.978-2.025c.09-.457-.133-.901-.467-1.226C3.93 16.178 3 14.189 3 12c0-4.556 4.03-8.25 9-8.25s9 3.694 9 8.25z"})}),at.length>0&&jsx("span",{className:"absolute -top-2 -right-2 bg-red-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center",children:at.length})]}),!ot&&jsxs("div",{className:`bg-black/80 backdrop-blur-sm border border-white/20 rounded-lg shadow-2xl transition-all duration-300 ${_?"w-96 h-96":"w-96 h-16"}`,children:[jsxs("div",{className:"flex items-center justify-between p-3 border-b border-white/20 bg-black/60 rounded-t-lg",children:[jsxs("h3",{className:"text-white font-semibold text-sm flex items-center gap-2",children:[" Chat",at.length>0&&jsx("span",{className:"bg-blue-600 text-white text-xs px-2 py-0.5 rounded-full",children:at.length})]}),jsxs("div",{className:"flex items-center gap-1",children:[jsx("button",{onClick:dt,className:"text-white/70 hover:text-white text-sm px-2 py-1 rounded hover:bg-white/10 transition-colors",title:"Add test message",children:""}),jsx("button",{onClick:()=>tt(!_),className:"text-white/70 hover:text-white text-sm px-2 py-1 rounded hover:bg-white/10 transition-colors",title:_?"Collapse":"Expand",children:_?"":"+"}),jsx("button",{onClick:lt,className:"text-white/70 hover:text-white text-sm px-2 py-1 rounded hover:bg-white/10 transition-colors",title:"Clear chat history",children:""}),jsx("button",{onClick:()=>st(!0),className:"text-white/70 hover:text-white text-xl leading-none hover:bg-white/10 w-7 h-7 rounded flex items-center justify-center transition-colors",title:"Minimize chat",children:""})]})]}),_&&jsxs("div",{className:"h-64 overflow-y-auto p-3 space-y-2",children:[at.length===0?jsx("div",{className:"text-white/50 text-center text-sm mt-8",children:"Start a conversation to see the transcript here..."}):at.map((It,Pt)=>{var Rt;return jsxs("div",{className:`flex flex-col ${It.speaker==="user"?"items-end":"items-start"}`,children:[jsx("div",{className:`max-w-[80%] p-2 rounded-lg text-sm ${It.speaker==="user"?"bg-blue-600/80 text-white ml-4":"bg-gray-700/80 text-white mr-4"}`,children:jsxs("div",{className:"flex items-start justify-between",children:[jsxs("p",{className:"leading-relaxed break-words flex-1",children:[It.message,It.isPartial&&jsx("span",{className:"inline-block w-2 h-4 ml-1 bg-current animate-pulse opacity-70",children:"|"})]}),It.isPartial&&jsx("span",{className:"text-xs text-white/50 ml-2 flex-shrink-0",children:" Live"})]})}),jsxs("div",{className:`text-xs text-white/50 mt-0.5 ${It.speaker==="user"?"text-right":"text-left"}`,children:[jsx("span",{className:"font-medium",children:It.speaker==="user"?"":""}),jsx("span",{className:"ml-1",children:It.lastUpdated?`${wt(It.lastUpdated)} ${It.isPartial?"(live)":""}`:wt(It.timestamp)}),It.words&&It.words.length>0&&jsxs("span",{className:"ml-2 text-white/40",children:[" ",It.words.length,"w"]})]})]},`${It.id}-${Pt}-${((Rt=It.timestamp)==null?void 0:Rt.getTime())||Pt}`)}),jsx("div",{ref:Et})]}),jsxs("div",{className:"p-3 border-t border-white/20 bg-black/40 rounded-b-lg",children:[jsxs("div",{className:"flex items-center gap-2",children:[jsx("input",{ref:yt,className:"flex-1 bg-white/10 text-white placeholder-white/50 p-2 rounded text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 border border-white/20",placeholder:nt?"Type a message...":"Connect to Agora first...",disabled:!nt,onKeyDown:It=>{It.key==="Enter"&&Ct()}}),jsx("button",{disabled:ft||gt||!nt,onClick:Ct,className:`bg-blue-600 hover:bg-blue-700 text-white px-3 py-2 text-sm font-medium rounded transition-colors ${ft||gt||!nt?"cursor-not-allowed opacity-50":""}`,children:ft?"...":"Send"})]}),jsxs("div",{className:"mt-2 text-xs text-center",children:[jsx("span",{className:`${nt?"text-green-400":"text-red-400"}`,children:nt?" Connected":" Disconnected"}),at.length>0&&jsxs("span",{className:"text-white/60 ml-2",children:[" ",at.length," message",at.length!==1?"s":""]})]})]})]})]})},AgoraProductsPanel=()=>{const[nt,_]=reactExports.useState(!1),[tt,ot]=reactExports.useState("core"),st={core:[{name:"Conversational AI Engine",description:"Build voice AI agents and integrate into your app",url:"https://www.agora.io/en/products/conversational-ai-engine/",icon:"",badge:"Beta"},{name:"Voice Calling",description:"Embed real-time voice chat into any app",url:"https://www.agora.io/en/products/voice-call/",icon:""},{name:"Video Calling",description:"Embed real-time video calling anywhere",url:"https://www.agora.io/en/products/video-call/",icon:""},{name:"Interactive Live Streaming",description:"Ultra-low latency live streaming",url:"https://www.agora.io/en/products/interactive-live-streaming/",icon:""},{name:"Chat",description:"Create customized messaging experiences",url:"https://www.agora.io/en/products/chat/",icon:""},{name:"Interactive Whiteboard",description:"Custom real-time digital whiteboard",url:"https://www.agora.io/en/products/interactive-whiteboard/",icon:""}],extensions:[{name:"AI Noise Suppression",description:"Reduce background noise for real-time audio and video",url:"https://www.agora.io/en/products/ai-noise-suppression/",icon:""},{name:"3D Spatial Audio",description:"Add dynamic, immersive audio to your real-time experience",url:"https://www.agora.io/en/products/3d-spatial-audio/",icon:""},{name:"Recording",description:"Record audio streams, video streams, and web pages",url:"https://www.agora.io/en/products/recording/",icon:""},{name:"Agora Analytics",description:"Monitor, measure, and improve quality of experience",url:"https://www.agora.io/en/products/agora-analytics/",icon:""},{name:"Extensions Marketplace",description:"Integrate powerful features into your app",url:"https://www.agora.io/en/extensions-marketplace/",icon:""}],tools:[{name:"App Builder",description:"The fastest way to integrate real-time engagement without code",url:"https://www.agora.io/en/tools/app-builder/",icon:""},{name:"Flexible Classroom",description:"Build full-featured virtual classrooms with low code",url:"https://www.agora.io/en/tools/flexible-classroom/",icon:""},{name:"Download SDKs",description:"Build your vision with Agora's real-time SDKs",url:"https://docs.agora.io/en/sdks/",icon:""}]};return jsxs(Fragment,{children:[jsx("div",{className:"fixed bottom-20 left-4 z-50",children:jsxs("button",{onClick:()=>_(!nt),className:`group relative w-12 h-12 rounded-full shadow-lg transition-all duration-300 transform hover:scale-110 ${nt?"bg-blue-600 text-white rotate-45":"bg-gradient-to-r from-blue-500 to-purple-600 text-white hover:from-blue-600 hover:to-purple-700"}`,title:"Explore Agora Products",children:[jsx("div",{className:"flex items-center justify-center w-full h-full",children:nt?jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})}):jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"})})}),!nt&&jsx("div",{className:"absolute inset-0 rounded-full bg-blue-400 opacity-75 animate-ping"})]})}),nt&&jsxs("div",{className:"fixed bottom-32 left-4 w-96 bg-white rounded-xl shadow-2xl border border-gray-200 z-40 max-h-[70vh] overflow-hidden flex flex-col",children:[jsxs("div",{className:"bg-gradient-to-r from-blue-600 to-purple-600 text-white p-4",children:[jsxs("div",{className:"flex items-center space-x-2",children:[jsx("img",{src:"https://www.agora.io/favicon.ico",alt:"Agora",className:"w-6 h-6",onError:lt=>{lt.target.style.display="none"}}),jsx("h3",{className:"text-lg font-bold",children:"Agora Products"})]}),jsx("p",{className:"text-blue-100 text-sm mt-1",children:"Explore real-time engagement solutions"})]}),jsx("div",{className:"flex border-b border-gray-200 bg-gray-50",children:[{key:"core",label:"Core Products",icon:""},{key:"extensions",label:"Extensions",icon:""},{key:"tools",label:"Tools",icon:""}].map(lt=>jsxs("button",{onClick:()=>ot(lt.key),className:`flex-1 px-3 py-2 text-xs font-medium transition-colors ${tt===lt.key?"bg-white text-blue-600 border-b-2 border-blue-600":"text-gray-600 hover:text-gray-800 hover:bg-gray-100"}`,children:[jsx("span",{className:"mr-1",children:lt.icon}),lt.label]},lt.key))}),jsx("div",{className:"flex-1 overflow-y-auto p-4 space-y-3",children:st[tt].map((lt,dt)=>jsx("a",{href:lt.url,target:"_blank",rel:"noopener noreferrer",className:"block p-3 bg-gray-50 rounded-lg hover:bg-blue-50 hover:border-blue-200 border border-gray-200 transition-all duration-200 transform hover:scale-[1.02] group",children:jsxs("div",{className:"flex items-start space-x-3",children:[jsx("div",{className:"text-2xl flex-shrink-0 group-hover:scale-110 transition-transform",children:lt.icon}),jsxs("div",{className:"flex-1 min-w-0",children:[jsxs("div",{className:"flex items-center space-x-2",children:[jsx("h4",{className:"font-semibold text-gray-900 text-sm group-hover:text-blue-600",children:lt.name}),lt.badge&&jsx("span",{className:"px-2 py-1 text-xs bg-green-100 text-green-800 rounded-full",children:lt.badge})]}),jsx("p",{className:"text-xs text-gray-600 mt-1 line-clamp-2",children:lt.description})]}),jsx("svg",{className:"w-4 h-4 text-gray-400 group-hover:text-blue-600 transition-colors flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"})})]})},dt))}),jsx("div",{className:"border-t border-gray-200 p-3 bg-gray-50",children:jsxs("div",{className:"flex items-center justify-between",children:[jsx("a",{href:"https://www.agora.io/en/products/",target:"_blank",rel:"noopener noreferrer",className:"text-xs text-blue-600 hover:text-blue-800 font-medium",children:"View All Products "}),jsx("a",{href:"https://sso.agora.io/en/signup",target:"_blank",rel:"noopener noreferrer",className:"text-xs bg-blue-600 text-white px-3 py-1 rounded-full hover:bg-blue-700 transition-colors",children:"Get Started For Free here"})]})})]}),nt&&jsx("div",{className:"fixed inset-0 bg-black bg-opacity-20 z-30",onClick:()=>_(!1)})]})},UI=({hidden:nt,currentExpression:_,setCurrentExpression:tt,currentAnimation:ot,setCurrentAnimation:st,currentAvatar:at,setCurrentAvatar:lt,showBlendShapeController:dt,setShowBlendShapeController:ht,showVisualizer:ft,setShowVisualizer:gt,showWireframe:Et,setShowWireframe:yt,...Ct})=>{var Sn;const[wt,It]=reactExports.useState(!1),[Pt,Rt]=reactExports.useState(!1),[xt,Nt]=reactExports.useState(!1),{chat:kt,loading:Vt,cameraZoomed:Ft,setCameraZoomed:zt,message:Yt}=useChat(),{isConnected:Kt,isJoined:qt,joinChannel:pn,leaveChannel:an,audioLevel:fn,config:dn,agentId:Cn}=useAgora(),On=[{name:"Aurora",label:" Aurora",emoji:"",description:"Elegant & Graceful"},{name:"Celeste",label:" Celeste",emoji:"",description:"Mystical & Enchanting"},{name:"Lyra",label:" Lyra",emoji:"",description:"Musical & Harmonious"}],Pn=[{name:"default",label:" Default",emoji:""},{name:"smile",label:" Smile",emoji:""},{name:"surprised",label:" Surprised",emoji:""},{name:"funnyFace",label:" Funny",emoji:""},{name:"sad",label:" Sad",emoji:""},{name:"angry",label:" Angry",emoji:""},{name:"crazy",label:" Crazy",emoji:""}],yn=[{name:"Idle",label:" Idle",emoji:"",expression:"default"},{name:"Talking_0",label:" Talking 1",emoji:"",expression:"default"},{name:"Talking_1",label:" Talking 2",emoji:"",expression:"smile"},{name:"Talking_2",label:" Talking 3",emoji:"",expression:"surprised"},{name:"Laughing",label:" Laughing",emoji:"",expression:"smile"},{name:"Crying",label:" Crying",emoji:"",expression:"sad"},{name:"Angry",label:" Angry",emoji:"",expression:"angry"},{name:"Terrified",label:" Terrified",emoji:"",expression:"surprised"}],An=gn=>{st(gn.name),tt(gn.expression==="default"?"":gn.expression),console.log(` Animation: ${gn.name}  Expression: ${gn.expression}`)};return nt?null:jsxs(Fragment,{children:[jsx("div",{className:"fixed top-4 left-1/2 transform -translate-x-1/2 z-20",children:jsx("div",{className:`backdrop-blur-md bg-white bg-opacity-50 rounded-lg transition-all duration-300 ${xt?"max-w-4xl":"max-w-fit"}`,children:xt?jsxs("div",{className:"p-4",children:[jsxs("div",{className:"flex justify-between items-center mb-3",children:[jsx("h3",{className:"font-medium text-sm",children:" Avatar Control Center"}),jsxs("div",{className:"flex items-center gap-4",children:[jsxs("div",{className:"text-xs text-gray-600 flex gap-3",children:[jsxs("span",{children:[" ",at]}),jsxs("span",{children:[" ",ot||"Auto"]}),jsxs("span",{children:[" ",_||"default"]})]}),jsx("button",{onClick:()=>Nt(!1),className:"pointer-events-auto text-gray-600 hover:text-gray-800 p-1",title:"Collapse panel",children:jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"m4.5 15.75 7.5-7.5 7.5 7.5"})})})]})]}),jsxs("div",{className:"grid grid-cols-3 gap-4",children:[jsxs("div",{children:[jsx("p",{className:"text-xs text-gray-600 mb-2",children:" Choose Avatar:"}),jsx("div",{className:"flex gap-2",children:On.map(gn=>jsxs("button",{onClick:()=>lt(gn.name),className:`pointer-events-auto p-2 rounded text-xs transition-colors flex-1 ${at===gn.name?"bg-blue-500 text-white":"bg-white bg-opacity-70 hover:bg-blue-200"}`,title:gn.description,children:[jsx("div",{className:"text-lg",children:gn.emoji}),jsx("div",{className:"text-xs leading-tight",children:gn.name})]},gn.name))}),jsxs("div",{className:"mt-3 pt-3 border-t border-gray-300",children:[jsx("p",{className:"text-xs text-gray-600 mb-2",children:" Visualization:"}),jsxs("button",{onClick:()=>yt(!Et),className:`pointer-events-auto w-full px-3 py-2 rounded text-xs font-medium transition-all ${Et?"bg-green-500 text-white shadow-md":"bg-white bg-opacity-70 text-gray-700 hover:bg-green-100"}`,title:"Toggle wireframe/mesh view",children:[jsx("span",{className:"mr-1",children:Et?"":""}),"Wireframe Mode"]})]})]}),jsxs("div",{children:[jsx("p",{className:"text-xs text-gray-600 mb-2",children:" Animations:"}),jsx("div",{className:"grid grid-cols-4 gap-1",children:yn.map(gn=>jsxs("button",{onClick:()=>An(gn),className:`pointer-events-auto p-1 rounded text-xs transition-colors ${ot===gn.name?"bg-purple-500 text-white":"bg-white bg-opacity-70 hover:bg-purple-200"}`,title:gn.label,children:[jsx("div",{className:"text-sm",children:gn.emoji}),jsx("div",{className:"text-xs leading-tight",children:gn.label.split(" ")[1]||gn.name.slice(0,4)})]},gn.name))})]}),jsxs("div",{children:[jsx("p",{className:"text-xs text-gray-600 mb-2",children:" Expressions:"}),jsx("div",{className:"grid grid-cols-4 gap-1",children:Pn.map(gn=>jsx("button",{onClick:()=>tt(gn.name==="default"?"":gn.name),className:`pointer-events-auto w-8 h-8 rounded text-sm transition-colors ${_===""&&gn.name==="default"||_===gn.name?"bg-pink-500 text-white":"bg-white bg-opacity-50 hover:bg-pink-200"}`,title:gn.label,children:gn.emoji},gn.name))})]})]})]}):jsxs("div",{className:"flex items-center gap-2 p-2",children:[jsx("span",{className:"text-xs font-medium",children:""}),jsx("div",{className:"text-lg bg-blue-500 text-white w-8 h-8 rounded-md flex items-center justify-center",title:`Current Avatar: ${at}`,children:((Sn=On.find(gn=>gn.name===at))==null?void 0:Sn.emoji)||""}),yn.slice(0,5).map(gn=>jsx("button",{onClick:()=>An(gn),className:`pointer-events-auto w-8 h-8 rounded-md text-lg transition-colors ${ot===gn.name?"bg-purple-500 text-white":"bg-white bg-opacity-50 hover:bg-purple-200"}`,title:gn.label,children:gn.emoji},gn.name)),jsx("button",{onClick:()=>Nt(!0),className:"pointer-events-auto text-gray-600 hover:text-gray-800 p-1",title:"Expand avatar panel",children:jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"m19.5 8.25-7.5 7.5-7.5-7.5"})})})]})})}),jsxs("div",{className:"fixed top-0 left-0 right-0 bottom-0 z-10 flex justify-between p-4 flex-col pointer-events-none",children:[jsxs("div",{className:"flex justify-between items-start",children:[jsx("div",{className:"flex items-start gap-4",children:jsx("div",{className:"flex flex-col gap-4",children:jsxs("div",{className:"self-start backdrop-blur-md bg-white bg-opacity-50 p-4 rounded-lg",children:[jsxs("div",{className:"flex justify-between items-center mb-2",children:[jsx("div",{className:"flex items-center gap-3",children:jsxs("div",{className:"flex items-center gap-2",children:[jsxs("svg",{width:"24",height:"24",viewBox:"0 0 100 100",className:"text-blue-600",children:[jsx("circle",{cx:"50",cy:"50",r:"45",fill:"currentColor",opacity:"0.1"}),jsx("circle",{cx:"50",cy:"50",r:"35",fill:"none",stroke:"currentColor",strokeWidth:"3"}),jsx("circle",{cx:"35",cy:"35",r:"8",fill:"currentColor"}),jsx("circle",{cx:"65",cy:"35",r:"8",fill:"currentColor"}),jsx("circle",{cx:"50",cy:"65",r:"8",fill:"currentColor"}),jsx("path",{d:"M35 35 L65 35 L50 65 Z",fill:"none",stroke:"currentColor",strokeWidth:"2"})]}),jsx("h1",{className:"font-black text-xl",children:"Agora Agent "})]})}),jsx("button",{onClick:()=>Rt(!Pt),className:"pointer-events-auto text-gray-600 hover:text-gray-800 transition-colors",title:Pt?"Hide connection details":"Show connection details",children:jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:`w-4 h-4 transition-transform ${Pt?"rotate-180":""}`,children:jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m19.5 8.25-7.5 7.5-7.5-7.5"})})})]}),jsx("p",{}),Pt&&jsxs("div",{className:"mt-2 text-sm space-y-1",children:[jsx("p",{className:`font-semibold ${Kt?"text-green-600":"text-red-600"}`,children:Kt?" Connected to Agora":" Not connected"}),jsxs("p",{className:"text-gray-600",children:["Channel: ",jsx("span",{className:"font-mono",children:(dn==null?void 0:dn.channel)||"ConvoAINPC"})]}),jsxs("p",{className:"text-gray-600",children:["ConvoAI UID: ",jsx("span",{className:"font-mono",children:(dn==null?void 0:dn.convoAIUid)||"8888"})]}),Cn&&jsxs("p",{className:"text-green-600",children:[" Agent Active: ",jsx("span",{className:"font-mono text-xs",children:Cn})]}),jsxs("div",{className:"flex gap-2",children:[jsxs("p",{className:`text-xs ${dn!=null&&dn.hasCredentials?"text-green-600":"text-red-600"}`,children:[dn!=null&&dn.hasCredentials?"":""," Auth"]}),jsxs("p",{className:`text-xs ${dn!=null&&dn.hasLLMKey?"text-green-600":"text-red-600"}`,children:[dn!=null&&dn.hasLLMKey?"":""," LLM"]}),jsxs("p",{className:`text-xs ${dn!=null&&dn.hasTTSKey?"text-green-600":"text-red-600"}`,children:[dn!=null&&dn.hasTTSKey?"":""," TTS"]})]}),jsxs("p",{className:"text-blue-600",children:[" Audio Level: ",(fn*100).toFixed(1),"%"]}),jsx("div",{className:"mt-3 pt-2 border-t border-gray-300",children:qt?jsxs("button",{onClick:an,className:"pointer-events-auto bg-red-500 hover:bg-red-600 text-white px-3 py-2 rounded-lg text-sm font-medium transition-colors flex items-center gap-2 w-full justify-center",title:"Disconnect from ConvoAI Channel",children:[jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-4 h-4",children:jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5.25 7.5A2.25 2.25 0 017.5 9.75V15a2.25 2.25 0 01-2.25 2.25H3.75A2.25 2.25 0 011.5 15V9.75A2.25 2.25 0 013.75 7.5H5.25z"})}),"Disconnect"]}):jsxs("button",{onClick:pn,className:"pointer-events-auto bg-green-500 hover:bg-green-600 text-white px-3 py-2 rounded-lg text-sm font-medium transition-colors flex items-center gap-2 w-full justify-center",title:"Connect to ConvoAI Channel",children:[jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-4 h-4",children:jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 18.75a6 6 0 006-6v-1.5m-6 7.5a6 6 0 01-6-6v-1.5m6 7.5v3.75m-3.75 0h7.5M12 15.75a3 3 0 01-3-3V4.5a3 3 0 116 0v8.25a3 3 0 01-3 3z"})}),"Connect"]})})]})]})})}),jsxs("div",{className:"flex gap-2",children:[jsx("button",{onClick:()=>gt(!ft),className:`pointer-events-auto backdrop-blur-md p-3 rounded-lg transition-colors ${ft?"bg-blue-500 bg-opacity-80 hover:bg-opacity-90":"bg-white bg-opacity-50 hover:bg-opacity-70"}`,title:ft?"Hide Audio Visualizer":"Show Audio Visualizer",children:jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:`w-6 h-6 ${ft?"text-white":"text-gray-700"}`,children:jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 9l10.5-3m0 6.553v3.75a2.25 2.25 0 01-1.632 2.163l-1.32.377a1.803 1.803 0 11-.99-3.467l2.31-.66a2.25 2.25 0 001.632-2.163zm0 0V2.25L9 5.25v10.303m0 0v3.75a2.25 2.25 0 01-1.632 2.163l-1.32.377a1.803 1.803 0 01-.99-3.467l2.31-.66A2.25 2.25 0 009 15.553z"})})}),jsx("button",{onClick:()=>ht(!dt),className:`pointer-events-auto backdrop-blur-md p-3 rounded-lg transition-colors ${dt?"bg-purple-500 bg-opacity-80 hover:bg-opacity-90":"bg-white bg-opacity-50 hover:bg-opacity-70"}`,title:dt?"Hide Blend Shape Controller":"Show Blend Shape Controller",children:jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:`w-6 h-6 ${dt?"text-white":"text-gray-700"}`,children:jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 6a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0zM4.501 20.118a7.5 7.5 0 0114.998 0A17.933 17.933 0 0112 21.75c-2.676 0-5.216-.584-7.499-1.632z"})})}),jsx("button",{onClick:()=>It(!0),className:"pointer-events-auto backdrop-blur-md bg-white bg-opacity-50 p-3 rounded-lg hover:bg-opacity-70 transition-colors",title:"Configuration Settings",children:jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:"w-6 h-6 text-gray-700",children:jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M10.5 6h9.75M10.5 6a1.5 1.5 0 11-3 0m3 0a1.5 1.5 0 10-3 0M3.75 6H7.5m0 6h9.75m-9.75 0a1.5 1.5 0 11-3 0m3 0a1.5 1.5 0 10-3 0m-3.75 0H4.5m0 6h9.75m-9.75 0a1.5 1.5 0 11-3 0m3 0a1.5 1.5 0 10-3 0m-3.75 0H1.5"})})})]})]}),jsxs("div",{className:"w-full flex flex-col items-end justify-center gap-4",children:[jsx("button",{onClick:()=>zt(!Ft),className:"pointer-events-auto bg-pink-500 hover:bg-pink-600 text-white p-4 rounded-md",title:Ft?"Zoom Out":"Zoom In",children:Ft?jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-6 h-6",children:jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607zM13.5 10.5h-6"})}):jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-6 h-6",children:jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607zM10.5 7.5v6m3-3h-6"})})}),jsx("button",{onClick:()=>{const gn=document.querySelector("body");gn.classList.contains("greenScreen")?gn.classList.remove("greenScreen"):gn.classList.add("greenScreen")},className:"pointer-events-auto bg-pink-500 hover:bg-pink-600 text-white p-4 rounded-md",children:jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-6 h-6",children:jsx("path",{strokeLinecap:"round",d:"M15.75 10.5l4.72-4.72a.75.75 0 011.28.53v11.38a.75.75 0 01-1.28.53l-4.72-4.72M4.5 18.75h9a2.25 2.25 0 002.25-2.25v-9a2.25 2.25 0 00-2.25-2.25h-9A2.25 2.25 0 002.25 7.5v9a2.25 2.25 0 002.25 2.25z"})})})]})]}),jsx(Settings,{isOpen:wt,onClose:()=>It(!1)}),jsx(CombinedChat,{isConnected:Kt}),jsx(AgoraProductsPanel,{})]})},BlendShapeController=({onBlendShapeChange:nt,onVisemeSelect:_,isVisible:tt=!0})=>{const ot=[{code:"viseme_sil",label:"Silence / Rest",phoneme:"Silent"},{code:"viseme_PP",label:"viseme_PP (P, B, M)",phoneme:"PP"},{code:"viseme_FF",label:"viseme_FF (F, V)",phoneme:"FF"},{code:"viseme_TH",label:"viseme_TH (TH)",phoneme:"TH"},{code:"viseme_DD",label:"viseme_DD (D, T, N, L)",phoneme:"DD"},{code:"viseme_kk",label:"viseme_kk (K, G)",phoneme:"kk"},{code:"viseme_CH",label:"viseme_CH (CH, J, SH)",phoneme:"CH"},{code:"viseme_SS",label:"viseme_SS (S, Z)",phoneme:"SS"},{code:"viseme_nn",label:"viseme_nn (N, NG)",phoneme:"nn"},{code:"viseme_RR",label:"viseme_RR (R)",phoneme:"RR"},{code:"viseme_aa",label:"viseme_aa (AA - father)",phoneme:"aa"},{code:"viseme_E",label:"viseme_E (EH - bed)",phoneme:"E"},{code:"viseme_I",label:"viseme_I (EE - see)",phoneme:"I"},{code:"viseme_O",label:"viseme_O (OH - go)",phoneme:"O"},{code:"viseme_U",label:"viseme_U (OO - boot)",phoneme:"U"}],st=[{name:"jawOpen",label:"Jaw Open",min:0,max:1,step:.01,default:0},{name:"jawForward",label:"Jaw Forward",min:0,max:1,step:.01,default:0},{name:"jawLeft",label:"Jaw Left",min:0,max:1,step:.01,default:0},{name:"jawRight",label:"Jaw Right",min:0,max:1,step:.01,default:0},{name:"mouthOpen",label:"Mouth Open",min:0,max:1,step:.01,default:0},{name:"mouthClose",label:"Mouth Close",min:0,max:1,step:.01,default:0},{name:"mouthSmileLeft",label:"Smile Left",min:0,max:1,step:.01,default:0},{name:"mouthSmileRight",label:"Smile Right",min:0,max:1,step:.01,default:0},{name:"mouthFrownLeft",label:"Frown Left",min:0,max:1,step:.01,default:0},{name:"mouthFrownRight",label:"Frown Right",min:0,max:1,step:.01,default:0},{name:"mouthPucker",label:"Mouth Pucker",min:0,max:1,step:.01,default:0},{name:"mouthFunnel",label:"Mouth Funnel",min:0,max:1,step:.01,default:0},{name:"mouthLeft",label:"Mouth Left",min:0,max:1,step:.01,default:0},{name:"mouthRight",label:"Mouth Right",min:0,max:1,step:.01,default:0},{name:"mouthDimpleLeft",label:"Dimple Left",min:0,max:1,step:.01,default:0},{name:"mouthDimpleRight",label:"Dimple Right",min:0,max:1,step:.01,default:0},{name:"mouthStretchLeft",label:"Stretch Left",min:0,max:1,step:.01,default:0},{name:"mouthStretchRight",label:"Stretch Right",min:0,max:1,step:.01,default:0},{name:"mouthPressLeft",label:"Press Left",min:0,max:1,step:.01,default:0},{name:"mouthPressRight",label:"Press Right",min:0,max:1,step:.01,default:0},{name:"mouthRollLower",label:"Roll Lower",min:0,max:1,step:.01,default:0},{name:"mouthRollUpper",label:"Roll Upper",min:0,max:1,step:.01,default:0},{name:"mouthShrugLower",label:"Shrug Lower",min:0,max:1,step:.01,default:0},{name:"mouthShrugUpper",label:"Shrug Upper",min:0,max:1,step:.01,default:0},{name:"eyeBlinkLeft",label:"Blink Left",min:0,max:1,step:.01,default:0},{name:"eyeBlinkRight",label:"Blink Right",min:0,max:1,step:.01,default:0},{name:"eyeSquintLeft",label:"Squint Left",min:0,max:1,step:.01,default:0},{name:"eyeSquintRight",label:"Squint Right",min:0,max:1,step:.01,default:0},{name:"eyeWideLeft",label:"Wide Left",min:0,max:1,step:.01,default:0},{name:"eyeWideRight",label:"Wide Right",min:0,max:1,step:.01,default:0},{name:"browDownLeft",label:"Brow Down Left",min:0,max:1,step:.01,default:0},{name:"browDownRight",label:"Brow Down Right",min:0,max:1,step:.01,default:0},{name:"browInnerUp",label:"Brow Inner Up",min:0,max:1,step:.01,default:0},{name:"browOuterUpLeft",label:"Brow Outer Up Left",min:0,max:1,step:.01,default:0},{name:"browOuterUpRight",label:"Brow Outer Up Right",min:0,max:1,step:.01,default:0},{name:"cheekPuff",label:"Cheek Puff",min:0,max:1,step:.01,default:0},{name:"cheekSquintLeft",label:"Cheek Squint Left",min:0,max:1,step:.01,default:0},{name:"cheekSquintRight",label:"Cheek Squint Right",min:0,max:1,step:.01,default:0},{name:"noseSneerLeft",label:"Nose Sneer Left",min:0,max:1,step:.01,default:0},{name:"noseSneerRight",label:"Nose Sneer Right",min:0,max:1,step:.01,default:0},{name:"tongueOut",label:"Tongue Out",min:0,max:1,step:.01,default:0}],[at,lt]=reactExports.useState("X"),[dt,ht]=reactExports.useState(()=>{const It={};return st.forEach(Pt=>{It[Pt.name]=Pt.default}),It}),[ft,gt]=reactExports.useState({visemes:!0,jaw:!0,mouth:!0,eyes:!1,brows:!1,cheeks:!1,nose:!1,tongue:!1}),Et=It=>{lt(It),_&&_(It)},yt=(It,Pt)=>{const Rt={...dt,[It]:parseFloat(Pt)};ht(Rt),nt&&nt(It,parseFloat(Pt))},Ct=()=>{const It={};st.forEach(Pt=>{It[Pt.name]=Pt.default}),ht(It),nt&&Object.keys(It).forEach(Pt=>{nt(Pt,It[Pt])})},wt=It=>{const Pt={jaw:["jawOpen","jawForward","jawLeft","jawRight"],mouth:st.filter(Rt=>Rt.name.startsWith("mouth")).map(Rt=>Rt.name),eyes:st.filter(Rt=>Rt.name.startsWith("eye")).map(Rt=>Rt.name),brows:st.filter(Rt=>Rt.name.startsWith("brow")).map(Rt=>Rt.name),cheeks:st.filter(Rt=>Rt.name.startsWith("cheek")).map(Rt=>Rt.name),nose:st.filter(Rt=>Rt.name.startsWith("nose")).map(Rt=>Rt.name),tongue:["tongueOut"]};return st.filter(Rt=>{var xt;return(xt=Pt[It])==null?void 0:xt.includes(Rt.name)})};return tt?jsxs("div",{className:"fixed right-4 top-1/2 transform -translate-y-1/2 w-80 max-h-[90vh] bg-gradient-to-br from-gray-900/95 to-gray-800/95 backdrop-blur-md rounded-2xl shadow-2xl border border-purple-500/30 overflow-hidden z-50",children:[jsxs("div",{className:"bg-gradient-to-r from-purple-600 to-pink-600 p-4 sticky top-0 z-10",children:[jsxs("h2",{className:"text-white font-bold text-lg flex items-center gap-2",children:[jsx("span",{className:"text-2xl",children:""}),"Blend Shape Controller"]}),jsx("p",{className:"text-purple-100 text-xs mt-1",children:"Test avatar facial expressions"})]}),jsxs("div",{className:"overflow-y-auto max-h-[calc(90vh-80px)] p-4 space-y-4 custom-scrollbar",children:[jsxs("div",{className:"space-y-2",children:[jsxs("button",{onClick:()=>gt(It=>({...It,visemes:!It.visemes})),className:"w-full flex items-center justify-between bg-purple-700/30 hover:bg-purple-700/50 p-3 rounded-lg transition-all",children:[jsxs("span",{className:"text-white font-semibold flex items-center gap-2",children:[jsx("span",{className:"text-xl",children:""}),"Viseme Phonemes"]}),jsx("span",{className:"text-white",children:ft.visemes?"":""})]}),ft.visemes&&jsx("div",{className:"grid grid-cols-3 gap-2",children:ot.map(It=>jsx("button",{onClick:()=>Et(It.code),className:`p-2 rounded-lg text-xs font-medium transition-all ${at===It.code?"bg-gradient-to-r from-purple-500 to-pink-500 text-white shadow-lg scale-105":"bg-gray-700/50 text-gray-300 hover:bg-gray-600/50"}`,title:It.label,children:It.phoneme},It.code))})]}),["jaw","mouth","eyes","brows","cheeks","nose","tongue"].map(It=>{const Pt=wt(It);return Pt.length===0?null:jsxs("div",{className:"space-y-2",children:[jsxs("button",{onClick:()=>gt(xt=>({...xt,[It]:!xt[It]})),className:"w-full flex items-center justify-between bg-blue-700/30 hover:bg-blue-700/50 p-3 rounded-lg transition-all",children:[jsxs("span",{className:"text-white font-semibold flex items-center gap-2",children:[jsx("span",{className:"text-xl",children:{jaw:"",mouth:"",eyes:"",brows:"",cheeks:"",nose:"",tongue:""}[It]}),It.charAt(0).toUpperCase()+It.slice(1)," (",Pt.length,")"]}),jsx("span",{className:"text-white",children:ft[It]?"":""})]}),ft[It]&&jsx("div",{className:"space-y-3 pl-2",children:Pt.map(xt=>jsxs("div",{className:"space-y-1",children:[jsxs("div",{className:"flex justify-between items-center",children:[jsx("label",{className:"text-gray-300 text-xs font-medium",children:xt.label}),jsx("span",{className:"text-purple-400 text-xs font-mono bg-gray-800/50 px-2 py-1 rounded",children:dt[xt.name].toFixed(2)})]}),jsx("input",{type:"range",min:xt.min,max:xt.max,step:xt.step,value:dt[xt.name],onChange:Nt=>yt(xt.name,Nt.target.value),className:"w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer slider-thumb"})]},xt.name))})]},It)}),jsx("button",{onClick:Ct,className:"w-full bg-gradient-to-r from-red-600 to-orange-600 hover:from-red-700 hover:to-orange-700 text-white font-bold py-3 px-4 rounded-lg transition-all shadow-lg",children:" Reset All"})]}),jsx("style",{jsx:!0,children:`
        .custom-scrollbar::-webkit-scrollbar {
          width: 8px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
          background: rgba(0, 0, 0, 0.2);
          border-radius: 10px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
          background: linear-gradient(180deg, #9333ea, #ec4899);
          border-radius: 10px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
          background: linear-gradient(180deg, #7c3aed, #db2777);
        }
        
        .slider-thumb::-webkit-slider-thumb {
          appearance: none;
          width: 18px;
          height: 18px;
          background: linear-gradient(135deg, #9333ea, #ec4899);
          cursor: pointer;
          border-radius: 50%;
          box-shadow: 0 0 10px rgba(147, 51, 234, 0.5);
        }
        .slider-thumb::-moz-range-thumb {
          width: 18px;
          height: 18px;
          background: linear-gradient(135deg, #9333ea, #ec4899);
          cursor: pointer;
          border-radius: 50%;
          border: none;
          box-shadow: 0 0 10px rgba(147, 51, 234, 0.5);
        }
      `})]}):null},useLipSync=()=>{const[nt,_]=reactExports.useState("viseme_PP"),[tt,ot]=reactExports.useState({volume:0,centroid:0,bands:[]}),[st,at]=reactExports.useState(!1),lt=reactExports.useRef(null),dt=reactExports.useRef(null),ht=reactExports.useRef(null),ft=reactExports.useCallback(()=>{if(lt.current)return;const yt=()=>{if(dt.current&&ht.current)try{const Ct=new Uint8Array(dt.current.frequencyBinCount);dt.current.getByteFrequencyData(Ct);const It=Ct.reduce((zt,Yt)=>zt+Yt,0)/Ct.length/255;let Pt=0,Rt=0;for(let zt=0;zt<Ct.length;zt++){const Yt=zt*(ht.current.sampleRate/2)/Ct.length;Pt+=Yt*Ct[zt],Rt+=Ct[zt]}const xt=Rt>0?Pt/Rt:0,Nt=8,kt=[],Vt=Math.floor(Ct.length/Nt);for(let zt=0;zt<Nt;zt++){const Yt=zt*Vt,Kt=Yt+Vt,qt=Ct.slice(Yt,Kt).reduce((pn,an)=>pn+an,0)/Vt;kt.push(qt/255)}let Ft="viseme_sil";if(It>.02){const zt=Ct.slice(0,8).reduce((fn,dn)=>fn+dn,0)/8,Yt=Ct.slice(8,20).reduce((fn,dn)=>fn+dn,0)/12,Kt=Ct.slice(20,40).reduce((fn,dn)=>fn+dn,0)/20,qt=Ct.slice(40,70).reduce((fn,dn)=>fn+dn,0)/30,pn=Ct.slice(70,110).reduce((fn,dn)=>fn+dn,0)/40,an=zt+Yt+Kt+qt+pn;if(an>10){const fn=zt/an,dn=Yt/an,Cn=Kt/an,On=qt/an,Pn=pn/an;fn>.25&&dn<.2?Ft="viseme_aa":dn>.25&&Pn>.2?Ft="viseme_I":fn>.2&&dn>.2?Ft="viseme_E":fn<.15&&dn<.2&&Pn>.25?Ft="viseme_U":fn<.2&&dn>.2&&Cn>.2?Ft="viseme_O":Pn>.35?Ft=Math.random()>.5?"viseme_SS":"viseme_CH":Pn>.25?Ft=Math.random()>.5?"viseme_FF":"viseme_TH":fn<.15&&dn<.2&&Pn<.2?Ft="viseme_PP":dn<.2&&Cn>.2?Ft="viseme_kk":Ft="viseme_DD"}}_(Ft),ot({volume:It,centroid:xt,bands:kt})}catch(Ct){console.error(" Error in lip sync analysis:",Ct)}lt.current=requestAnimationFrame(yt)};yt()},[]),gt=reactExports.useCallback(yt=>{if(yt&&!ht.current){console.log(" Connecting audio element to WebAudio analyzer");try{const Ct=new(window.AudioContext||window.webkitAudioContext);ht.current=Ct;const wt=Ct.createAnalyser();wt.fftSize=256,wt.smoothingTimeConstant=.8,dt.current=wt,yt._audioSourceConnected||(Ct.createMediaElementSource(yt).connect(wt),wt.connect(Ct.destination),yt._audioSourceConnected=!0),at(!0),lt.current||ft()}catch(Ct){console.error(" Error connecting audio to WebAudio:",Ct),at(!1)}}else yt&&ht.current&&(ht.current.state==="suspended"&&ht.current.resume(),at(!0),lt.current||ft())},[ft]),Et=reactExports.useCallback(()=>{lt.current&&(cancelAnimationFrame(lt.current),lt.current=null),at(!1),_("viseme_PP"),ot({volume:0,centroid:0,bands:[]})},[]);return reactExports.useEffect(()=>()=>{Et()},[Et]),{viseme:nt,features:tt,isConnected:st,connectAudio:gt,disconnectAudio:Et}},audioFiles=[{name:"Emma",files:[{name:"A",path:"models/audios/Emma_a.mp3"},{name:"E",path:"models/audios/Emma_e.mp3"},{name:"O",path:"models/audios/Emma_o.mp3"},{name:"You",path:"models/audios/Emma_you.mp3"},{name:"Vowels",path:"models/audios/Emma_vowels.mp3"},{name:"Ta",path:"models/audios/Emma_ta.mp3"},{name:"Click",path:"models/audios/Emma_click.mp3"},{name:"Bump",path:"models/audios/Emma_bump.mp3"},{name:"Not",path:"models/audios/Emma_not.mp3"},{name:"Lot",path:"models/audios/Emma_lot.mp3"},{name:"Think",path:"models/audios/Emma_think.mp3"},{name:"Fan",path:"models/audios/Emma_fan.mp3"},{name:"This",path:"models/audios/Emma_this.mp3"},{name:"Consonants",path:"models/audios/Emma_consonants.mp3"}]}],Visualizer=({onVisemeChange:nt,onAudioLevelChange:_})=>{const tt=reactExports.useRef(null),ot=reactExports.useRef(null),st=reactExports.useRef(null),at=reactExports.useRef(null),lt=reactExports.useRef(null),[dt,ht]=reactExports.useState(""),{viseme:ft,features:gt,isConnected:Et,connectAudio:yt,disconnectAudio:Ct}=useLipSync();reactExports.useEffect(()=>{nt&&nt(ft),_&&gt&&_(gt.volume||0)},[ft,gt,nt,_]),reactExports.useEffect(()=>{var xt;const Rt=()=>{ht("")};return(xt=lt.current)==null||xt.addEventListener("ended",Rt),()=>{var Nt;(Nt=lt.current)==null||Nt.removeEventListener("ended",Rt)}},[]),reactExports.useEffect(()=>{if(!dt)return;It([]);const Rt=`/RPM-agora-agent/${dt}`;return lt.current.src=Rt,new Promise((Nt,kt)=>{const Vt=lt.current;if(!Vt)return kt(new Error("Audio element missing"));const Ft=()=>{Vt.removeEventListener("loadedmetadata",Ft),Nt()},zt=Yt=>{Vt.removeEventListener("error",zt),kt(new Error("Audio element error"))};Vt.addEventListener("loadedmetadata",Ft,{once:!0}),Vt.addEventListener("error",zt,{once:!0});try{Vt.load()}catch{}setTimeout(()=>Nt(),3e3)}).then(()=>{try{yt(lt.current),console.log(" Visualizer connected static audio to useLipSync",Rt)}catch(Nt){console.warn(" Failed to connect static audio to useLipSync",Nt)}lt.current.play().catch(Nt=>console.warn(" audio play failed",Nt))}).catch(Nt=>{console.warn(" Metadata wait failed, attempting to connect/play anyway",Nt);try{yt(lt.current)}catch{}lt.current.play().catch(()=>{})}),()=>{lt.current&&lt.current.pause()}},[dt,yt]);const[wt,It]=reactExports.useState([]),Pt=reactExports.useRef(null);return reactExports.useEffect(()=>{const Rt=(kt,Vt)=>{if(!tt.current)return;const Ft=tt.current.getContext("2d");if(!Ft)return;const zt=tt.current.width,Yt=tt.current.height,Kt=7e3,qt={left:60,right:60,top:60,bottom:30},pn=zt-qt.left-qt.right,an=Yt-qt.top-qt.bottom,fn=pn/kt.bands.length;Ft.fillStyle="black",Ft.fillRect(0,0,zt,Yt),kt.bands.forEach((yn,An)=>{const Sn=yn*an;Ft.fillStyle=`hsl(${An*(360/kt.bands.length)}, 70%, 50%)`,Ft.fillRect(qt.left+An*fn,Yt-qt.bottom-Sn,fn-2,Sn)});const dn=qt.left+kt.centroid/Kt*pn;Ft.strokeStyle="white",Ft.lineWidth=2,Ft.beginPath(),Ft.moveTo(dn,qt.top),Ft.lineTo(dn,Yt-qt.bottom),Ft.stroke(),Ft.fillStyle="white",Ft.font="15px monospace",Ft.textAlign="center",Ft.textBaseline="top",[0,200,400,800,1500,2500,4e3,8e3].forEach((yn,An)=>{const Sn=qt.left+An*fn;Ft.fillText(`${yn} Hz`,Sn,Yt-qt.bottom+5),Ft.beginPath(),Ft.moveTo(Sn,Yt-qt.bottom-5),Ft.lineTo(Sn,Yt-qt.bottom),Ft.stroke()}),[0,1e3,2e3,3e3,4e3,5e3,6e3,7e3].forEach((yn,An)=>{const Sn=qt.left+An*fn;Ft.fillText(`${yn} Hz`,Sn,qt.top+5),Ft.beginPath(),Ft.moveTo(Sn,qt.top-5),Ft.lineTo(Sn,qt.top),Ft.stroke()}),Ft.textAlign="right",Ft.textBaseline="middle",[0,.25,.5,.75,1].forEach(yn=>{const An=Yt-qt.bottom-yn*an;Ft.fillText(yn.toFixed(2),qt.left-10,An),Ft.beginPath(),Ft.moveTo(qt.left-5,An),Ft.lineTo(qt.left,An),Ft.stroke()})};let xt=null;const Nt=()=>{xt=requestAnimationFrame(Nt);try{const kt=gt||{volume:0,centroid:0,bands:new Array(64).fill(0)};ot.current&&(ot.current.innerText=ft),st.current&&(st.current.innerText=(kt.volume||0).toFixed(2)),at.current&&(at.current.innerText=`${(kt.centroid||0).toFixed(2)} Hz`);try{Rt(kt,ft)}catch{}ft!==Pt.current&&(It(Vt=>[...Vt,ft]),Pt.current=ft)}catch(kt){console.warn("Visualizer analyzeAudio error:",kt)}};return Nt(),()=>{typeof xt=="number"&&cancelAnimationFrame(xt)}},[ft,gt]),jsxs("div",{className:"flex flex-col gap-4",children:[jsxs("section",{className:"flex flex-col gap-4",children:[jsx("canvas",{ref:tt,className:"w-full rounded-lg",width:1e3,height:500}),jsx("audio",{ref:lt,controls:!0,className:"w-full"}),jsxs("div",{className:"flex flex-row items-center justify-between gap-2",children:[jsxs("div",{className:"text-center",children:[jsx("p",{className:"text-sm font-mono",ref:ot,children:"SI"}),jsx("h2",{children:"Viseme"})]}),jsxs("div",{className:"text-center",children:[jsx("p",{className:"text-sm font-mono",ref:st,children:"122db"}),jsx("h2",{children:"Volume"})]}),jsxs("div",{className:"text-center",children:[jsx("p",{className:"text-sm font-mono",ref:at,children:"1000 Hz"}),jsx("h2",{children:"Centroid"})]})]})]}),jsx("div",{className:"pointer-events-auto flex flex-col gap-4",children:audioFiles.map((Rt,xt)=>jsxs("div",{className:"flex flex-col gap-2",children:[jsx("h2",{className:"text-lg font-bold text-left",children:"Audios"}),jsx("div",{className:"flex flex-row items-center justify-start gap-2 flex-wrap",children:Rt.files.map((Nt,kt)=>jsx("button",{className:"p-2 text-white bg-indigo-500 hover:bg-indigo-600 cursor-pointer rounded min-w-12",onClick:()=>ht(Nt.path),children:Nt.name},kt))})]},xt))}),wt.length>0&&jsxs("div",{className:"flex flex-col gap-2",children:[jsx("h2",{className:"text-lg font-bold text-left",children:"Detected Visemes"}),jsx("div",{className:"flex flex-row items-center justify-start gap-2  flex-wrap",children:wt.map((Rt,xt)=>jsx("span",{className:"px-3 py-2 text-black font-medium bg-pink-100 rounded flex items-center",children:jsx("span",{className:"text-sm font-bold text-purple-600",children:Rt})},xt))})]})]})};function App(){const[nt,_]=reactExports.useState(""),[tt,ot]=reactExports.useState(""),[st,at]=reactExports.useState("Aurora"),[lt,dt]=reactExports.useState(!1),[ht,ft]=reactExports.useState({}),[gt,Et]=reactExports.useState(null),[yt,Ct]=reactExports.useState(!1),[wt,It]=reactExports.useState(null),[Pt,Rt]=reactExports.useState(0),[xt,Nt]=reactExports.useState(!1);return jsxs(Fragment,{children:[jsx(Loader,{}),jsx(Leva,{hidden:!0}),jsx(UI,{currentExpression:nt,setCurrentExpression:_,currentAnimation:tt,setCurrentAnimation:ot,currentAvatar:st,setCurrentAvatar:at,showBlendShapeController:lt,setShowBlendShapeController:dt,showVisualizer:yt,setShowVisualizer:Ct,showWireframe:xt,setShowWireframe:Nt}),jsx(BlendShapeController,{isVisible:lt,onBlendShapeChange:(Ft,zt)=>{ft(Yt=>({...Yt,[Ft]:zt}))},onVisemeSelect:Ft=>{Et(Ft)}}),yt&&jsxs("div",{className:"fixed left-4 top-1/2 transform -translate-y-1/2 w-[450px] max-h-[90vh] bg-gradient-to-br from-gray-900/95 to-gray-800/95 backdrop-blur-md rounded-2xl shadow-2xl border border-blue-500/30 overflow-hidden z-50",children:[jsx("div",{className:"bg-gradient-to-r from-blue-600 to-cyan-600 p-4 sticky top-0 z-10",children:jsxs("div",{className:"flex items-center justify-between",children:[jsxs("div",{children:[jsxs("h2",{className:"text-white font-bold text-lg flex items-center gap-2",children:[jsx("span",{className:"text-2xl",children:""}),"Audio Visualizer"]}),jsx("p",{className:"text-blue-100 text-xs mt-1",children:"Test audio files with viseme detection"})]}),jsx("button",{onClick:()=>Ct(!1),className:"text-white hover:bg-white/20 rounded-lg p-2 transition-colors",title:"Close Visualizer",children:jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})}),jsx("div",{className:"overflow-y-auto max-h-[calc(90vh-80px)] p-4 visualizer-scrollbar",children:jsx(Visualizer,{onVisemeChange:It,onAudioLevelChange:Rt})})]}),jsx(Canvas$1,{shadows:!0,camera:{position:[0,0,1],fov:30},children:jsx(Experience,{currentExpression:nt,currentAnimation:tt,currentAvatar:st,manualBlendShapes:lt?ht:null,manualViseme:lt?gt:null,visualizerViseme:yt?wt:null,visualizerAudioLevel:yt?Pt:0,showWireframe:xt})})]})}const index="",originalWarn=console.warn,originalError=console.error;console.warn=function(...nt){const _=nt.join(" ");_.includes("PropertyBinding")&&_.includes("not found")||originalWarn.apply(console,nt)};console.error=function(...nt){const _=nt.join(" ");if(_.includes("WebSocket connection")&&_.includes("failed")){console.log(" WebSocket connection failed - this is normal if Agora credentials are not configured");return}if(_.includes("WebSocket is closed before the connection is established")){console.log(" WebSocket closed during connection - this is normal if Agora credentials are not configured");return}originalError.apply(console,nt)};client.createRoot(document.getElementById("root")).render(jsx(React.StrictMode,{children:jsx(AgoraProvider,{children:jsx(ChatProvider,{children:jsx(App,{})})})}));
